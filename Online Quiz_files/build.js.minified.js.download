!function (t, e) { "object" == typeof exports && "undefined" != typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define(e) : t.ES6Promise = e(); }(this, function () {
    "use strict";
    function t(t) { var e = typeof t; return null !== t && ("object" === e || "function" === e); }
    function e(t) { return "function" == typeof t; }
    function n(t) { B = t; }
    function r(t) { G = t; }
    function o() { return function () { return process.nextTick(a); }; }
    function i() { return "undefined" != typeof z ? function () { z(a); } : c(); }
    function s() { var t = 0, e = new J(a), n = document.createTextNode(""); return e.observe(n, { characterData: !0 }), function () { n.data = t = ++t % 2; }; }
    function u() { var t = new MessageChannel; return t.port1.onmessage = a, function () { return t.port2.postMessage(0); }; }
    function c() { var t = setTimeout; return function () { return t(a, 1); }; }
    function a() { for (var t = 0; t < W; t += 2) {
        var e = V[t], n = V[t + 1];
        e(n), V[t] = void 0, V[t + 1] = void 0;
    } W = 0; }
    function f() { try {
        var t = Function("return this")().require("vertx");
        return z = t.runOnLoop || t.runOnContext, i();
    }
    catch (e) {
        return c();
    } }
    function l(t, e) { var n = this, r = new this.constructor(p); void 0 === r[Z] && O(r); var o = n._state; if (o) {
        var i = arguments[o - 1];
        G(function () { return P(o, r, i, n._result); });
    }
    else
        E(n, r, t, e); return r; }
    function h(t) { var e = this; if (t && "object" == typeof t && t.constructor === e)
        return t; var n = new e(p); return g(n, t), n; }
    function p() { }
    function v() { return new TypeError("You cannot resolve a promise with itself"); }
    function d() { return new TypeError("A promises callback cannot return that same promise."); }
    function _(t) { try {
        return t.then;
    }
    catch (e) {
        return nt.error = e, nt;
    } }
    function y(t, e, n, r) { try {
        t.call(e, n, r);
    }
    catch (o) {
        return o;
    } }
    function m(t, e, n) { G(function (t) { var r = !1, o = y(n, e, function (n) { r || (r = !0, e !== n ? g(t, n) : S(t, n)); }, function (e) { r || (r = !0, j(t, e)); }, "Settle: " + (t._label || " unknown promise")); !r && o && (r = !0, j(t, o)); }, t); }
    function b(t, e) { e._state === tt ? S(t, e._result) : e._state === et ? j(t, e._result) : E(e, void 0, function (e) { return g(t, e); }, function (e) { return j(t, e); }); }
    function w(t, n, r) { n.constructor === t.constructor && r === l && n.constructor.resolve === h ? b(t, n) : r === nt ? (j(t, nt.error), nt.error = null) : void 0 === r ? S(t, n) : e(r) ? m(t, n, r) : S(t, n); }
    function g(e, n) { e === n ? j(e, v()) : t(n) ? w(e, n, _(n)) : S(e, n); }
    function A(t) { t._onerror && t._onerror(t._result), T(t); }
    function S(t, e) { t._state === $ && (t._result = e, t._state = tt, 0 !== t._subscribers.length && G(T, t)); }
    function j(t, e) { t._state === $ && (t._state = et, t._result = e, G(A, t)); }
    function E(t, e, n, r) { var o = t._subscribers, i = o.length; t._onerror = null, o[i] = e, o[i + tt] = n, o[i + et] = r, 0 === i && t._state && G(T, t); }
    function T(t) { var e = t._subscribers, n = t._state; if (0 !== e.length) {
        for (var r = void 0, o = void 0, i = t._result, s = 0; s < e.length; s += 3)
            r = e[s], o = e[s + n], r ? P(n, r, o, i) : o(i);
        t._subscribers.length = 0;
    } }
    function M(t, e) { try {
        return t(e);
    }
    catch (n) {
        return nt.error = n, nt;
    } }
    function P(t, n, r, o) { var i = e(r), s = void 0, u = void 0, c = void 0, a = void 0; if (i) {
        if (s = M(r, o), s === nt ? (a = !0, u = s.error, s.error = null) : c = !0, n === s)
            return void j(n, d());
    }
    else
        s = o, c = !0; n._state !== $ || (i && c ? g(n, s) : a ? j(n, u) : t === tt ? S(n, s) : t === et && j(n, s)); }
    function x(t, e) { try {
        e(function (e) { g(t, e); }, function (e) { j(t, e); });
    }
    catch (n) {
        j(t, n);
    } }
    function C() { return rt++; }
    function O(t) { t[Z] = rt++, t._state = void 0, t._result = void 0, t._subscribers = []; }
    function k() { return new Error("Array Methods must be provided an Array"); }
    function F(t) { return new ot(this, t).promise; }
    function Y(t) { var e = this; return new e(U(t) ? function (n, r) { for (var o = t.length, i = 0; i < o; i++)
        e.resolve(t[i]).then(n, r); } : function (t, e) { return e(new TypeError("You must pass an array to race.")); }); }
    function q(t) { var e = this, n = new e(p); return j(n, t), n; }
    function D() { throw new TypeError("You must pass a resolver function as the first argument to the promise constructor"); }
    function K() { throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function."); }
    function L() { var t = void 0; if ("undefined" != typeof global)
        t = global;
    else if ("undefined" != typeof self)
        t = self;
    else
        try {
            t = Function("return this")();
        }
        catch (e) {
            throw new Error("polyfill failed because global object is unavailable in this environment");
        } var n = t.Promise; if (n) {
        var r = null;
        try {
            r = Object.prototype.toString.call(n.resolve());
        }
        catch (e) { }
        if ("[object Promise]" === r && !n.cast)
            return;
    } t.Promise = it; }
    var N = void 0;
    N = Array.isArray ? Array.isArray : function (t) { return "[object Array]" === Object.prototype.toString.call(t); };
    var U = N, W = 0, z = void 0, B = void 0, G = function (t, e) { V[W] = t, V[W + 1] = e, W += 2, 2 === W && (B ? B(a) : X()); }, H = "undefined" != typeof window ? window : void 0, I = H || {}, J = I.MutationObserver || I.WebKitMutationObserver, Q = "undefined" == typeof self && "undefined" != typeof process && "[object process]" === {}.toString.call(process), R = "undefined" != typeof Uint8ClampedArray && "undefined" != typeof importScripts && "undefined" != typeof MessageChannel, V = new Array(1e3), X = void 0;
    X = Q ? o() : J ? s() : R ? u() : void 0 === H && "function" == typeof require ? f() : c();
    var Z = Math.random().toString(36).substring(2), $ = void 0, tt = 1, et = 2, nt = { error: null }, rt = 0, ot = function () { function t(t, e) { this._instanceConstructor = t, this.promise = new t(p), this.promise[Z] || O(this.promise), U(e) ? (this.length = e.length, this._remaining = e.length, this._result = new Array(this.length), 0 === this.length ? S(this.promise, this._result) : (this.length = this.length || 0, this._enumerate(e), 0 === this._remaining && S(this.promise, this._result))) : j(this.promise, k()); } return t.prototype._enumerate = function (t) { for (var e = 0; this._state === $ && e < t.length; e++)
        this._eachEntry(t[e], e); }, t.prototype._eachEntry = function (t, e) { var n = this._instanceConstructor, r = n.resolve; if (r === h) {
        var o = _(t);
        if (o === l && t._state !== $)
            this._settledAt(t._state, e, t._result);
        else if ("function" != typeof o)
            this._remaining--, this._result[e] = t;
        else if (n === it) {
            var i = new n(p);
            w(i, t, o), this._willSettleAt(i, e);
        }
        else
            this._willSettleAt(new n(function (e) { return e(t); }), e);
    }
    else
        this._willSettleAt(r(t), e); }, t.prototype._settledAt = function (t, e, n) { var r = this.promise; r._state === $ && (this._remaining--, t === et ? j(r, n) : this._result[e] = n), 0 === this._remaining && S(r, this._result); }, t.prototype._willSettleAt = function (t, e) { var n = this; E(t, void 0, function (t) { return n._settledAt(tt, e, t); }, function (t) { return n._settledAt(et, e, t); }); }, t; }(), it = function () { function t(e) { this[Z] = C(), this._result = this._state = void 0, this._subscribers = [], p !== e && ("function" != typeof e && D(), this instanceof t ? x(this, e) : K()); } return t.prototype["catch"] = function (t) { return this.then(null, t); }, t.prototype["finally"] = function (t) { var n = this, r = n.constructor; return e(t) ? n.then(function (e) { return r.resolve(t()).then(function () { return e; }); }, function (e) { return r.resolve(t()).then(function () { throw e; }); }) : n.then(t, t); }, t; }();
    return it.prototype.then = l, it.all = F, it.race = Y, it.resolve = h, it.reject = q, it._setScheduler = n, it._setAsap = r, it._asap = G, it.polyfill = L, it.Promise = it, it.polyfill(), it;
});
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */
if ("document" in window.self) {
    if (!("classList" in document.createElement("_"))
        || document.createElementNS && !("classList" in document.createElementNS("http://www.w3.org/2000/svg", "g"))) {
        (function (view) {
            "use strict";
            if (!('Element' in view))
                return;
            var classListProp = "classList", protoProp = "prototype", elemCtrProto = view.Element[protoProp], objCtr = Object, strTrim = String[protoProp].trim || function () {
                return this.replace(/^\s+|\s+$/g, "");
            }, arrIndexOf = Array[protoProp].indexOf || function (item) {
                var i = 0, len = this.length;
                for (; i < len; i++) {
                    if (i in this && this[i] === item) {
                        return i;
                    }
                }
                return -1;
            }, DOMEx = function (type, message) {
                this.name = type;
                this.code = DOMException[type];
                this.message = message;
            }, checkTokenAndGetIndex = function (classList, token) {
                if (token === "") {
                    throw new DOMEx("SYNTAX_ERR", "An invalid or illegal string was specified");
                }
                if (/\s/.test(token)) {
                    throw new DOMEx("INVALID_CHARACTER_ERR", "String contains an invalid character");
                }
                return arrIndexOf.call(classList, token);
            }, ClassList = function (elem) {
                var trimmedClasses = strTrim.call(elem.getAttribute("class") || ""), classes = trimmedClasses ? trimmedClasses.split(/\s+/) : [], i = 0, len = classes.length;
                for (; i < len; i++) {
                    this.push(classes[i]);
                }
                this._updateClassName = function () {
                    elem.setAttribute("class", this.toString());
                };
            }, classListProto = ClassList[protoProp] = [], classListGetter = function () {
                return new ClassList(this);
            };
            DOMEx[protoProp] = Error[protoProp];
            classListProto.item = function (i) {
                return this[i] || null;
            };
            classListProto.contains = function (token) {
                token += "";
                return checkTokenAndGetIndex(this, token) !== -1;
            };
            classListProto.add = function () {
                var tokens = arguments, i = 0, l = tokens.length, token, updated = false;
                do {
                    token = tokens[i] + "";
                    if (checkTokenAndGetIndex(this, token) === -1) {
                        this.push(token);
                        updated = true;
                    }
                } while (++i < l);
                if (updated) {
                    this._updateClassName();
                }
            };
            classListProto.remove = function () {
                var tokens = arguments, i = 0, l = tokens.length, token, updated = false, index;
                do {
                    token = tokens[i] + "";
                    index = checkTokenAndGetIndex(this, token);
                    while (index !== -1) {
                        this.splice(index, 1);
                        updated = true;
                        index = checkTokenAndGetIndex(this, token);
                    }
                } while (++i < l);
                if (updated) {
                    this._updateClassName();
                }
            };
            classListProto.toggle = function (token, force) {
                token += "";
                var result = this.contains(token), method = result ?
                    force !== true && "remove"
                    :
                        force !== false && "add";
                if (method) {
                    this[method](token);
                }
                if (force === true || force === false) {
                    return force;
                }
                else {
                    return !result;
                }
            };
            classListProto.toString = function () {
                return this.join(" ");
            };
            if (objCtr.defineProperty) {
                var classListPropDesc = {
                    get: classListGetter,
                    enumerable: true,
                    configurable: true
                };
                try {
                    objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);
                }
                catch (ex) {
                    if (ex.number === undefined || ex.number === -0x7FF5EC54) {
                        classListPropDesc.enumerable = false;
                        objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);
                    }
                }
            }
            else if (objCtr[protoProp].__defineGetter__) {
                elemCtrProto.__defineGetter__(classListProp, classListGetter);
            }
        }(window.self));
    }
    (function () {
        "use strict";
        var testElement = document.createElement("_");
        testElement.classList.add("c1", "c2");
        if (!testElement.classList.contains("c2")) {
            var createMethod = function (method) {
                var original = DOMTokenList.prototype[method];
                DOMTokenList.prototype[method] = function (token) {
                    var i, len = arguments.length;
                    for (i = 0; i < len; i++) {
                        token = arguments[i];
                        original.call(this, token);
                    }
                };
            };
            createMethod('add');
            createMethod('remove');
        }
        testElement.classList.toggle("c3", false);
        if (testElement.classList.contains("c3")) {
            var _toggle = DOMTokenList.prototype.toggle;
            DOMTokenList.prototype.toggle = function (token, force) {
                if (1 in arguments && !this.contains(token) === !force) {
                    return force;
                }
                else {
                    return _toggle.call(this, token);
                }
            };
        }
        testElement = null;
    }());
}
if (window.NodeList && !NodeList.prototype.forEach) {
    NodeList.prototype.forEach = Array.prototype.forEach;
}
;
(function () {
    function n(n, t, r) { switch (r.length) {
        case 0: return n.call(t);
        case 1: return n.call(t, r[0]);
        case 2: return n.call(t, r[0], r[1]);
        case 3: return n.call(t, r[0], r[1], r[2]);
    } return n.apply(t, r); }
    function t(n, t, r, e) { for (var u = -1, i = null == n ? 0 : n.length; ++u < i;) {
        var o = n[u];
        t(e, o, r(o), n);
    } return e; }
    function r(n, t) { for (var r = -1, e = null == n ? 0 : n.length; ++r < e && false !== t(n[r], r, n);)
        ; return n; }
    function e(n, t) { for (var r = null == n ? 0 : n.length; r-- && false !== t(n[r], r, n);)
        ; return n; }
    function u(n, t) {
        for (var r = -1, e = null == n ? 0 : n.length; ++r < e;)
            if (!t(n[r], r, n))
                return false;
        return true;
    }
    function i(n, t) { for (var r = -1, e = null == n ? 0 : n.length, u = 0, i = []; ++r < e;) {
        var o = n[r];
        t(o, r, n) && (i[u++] = o);
    } return i; }
    function o(n, t) { return !(null == n || !n.length) && -1 < v(n, t, 0); }
    function f(n, t, r) { for (var e = -1, u = null == n ? 0 : n.length; ++e < u;)
        if (r(t, n[e]))
            return true; return false; }
    function c(n, t) { for (var r = -1, e = null == n ? 0 : n.length, u = Array(e); ++r < e;)
        u[r] = t(n[r], r, n); return u; }
    function a(n, t) { for (var r = -1, e = t.length, u = n.length; ++r < e;)
        n[u + r] = t[r]; return n; }
    function l(n, t, r, e) {
        var u = -1, i = null == n ? 0 : n.length;
        for (e && i && (r = n[++u]); ++u < i;)
            r = t(r, n[u], u, n);
        return r;
    }
    function s(n, t, r, e) { var u = null == n ? 0 : n.length; for (e && u && (r = n[--u]); u--;)
        r = t(r, n[u], u, n); return r; }
    function h(n, t) { for (var r = -1, e = null == n ? 0 : n.length; ++r < e;)
        if (t(n[r], r, n))
            return true; return false; }
    function p(n, t, r) { var e; return r(n, function (n, r, u) { if (t(n, r, u))
        return e = r, false; }), e; }
    function _(n, t, r, e) { var u = n.length; for (r += e ? 1 : -1; e ? r-- : ++r < u;)
        if (t(n[r], r, n))
            return r; return -1; }
    function v(n, t, r) { if (t === t)
        n: {
            --r;
            for (var e = n.length; ++r < e;)
                if (n[r] === t) {
                    n = r;
                    break n;
                }
            n = -1;
        }
    else
        n = _(n, d, r); return n; }
    function g(n, t, r, e) {
        --r;
        for (var u = n.length; ++r < u;)
            if (e(n[r], t))
                return r;
        return -1;
    }
    function d(n) { return n !== n; }
    function y(n, t) { var r = null == n ? 0 : n.length; return r ? m(n, t) / r : F; }
    function b(n) { return function (t) { return null == t ? T : t[n]; }; }
    function x(n) { return function (t) { return null == n ? T : n[t]; }; }
    function j(n, t, r, e, u) { return u(n, function (n, u, i) { r = e ? (e = false, n) : t(r, n, u, i); }), r; }
    function w(n, t) { var r = n.length; for (n.sort(t); r--;)
        n[r] = n[r].c; return n; }
    function m(n, t) {
        for (var r, e = -1, u = n.length; ++e < u;) {
            var i = t(n[e]);
            i !== T && (r = r === T ? i : r + i);
        }
        return r;
    }
    function A(n, t) { for (var r = -1, e = Array(n); ++r < n;)
        e[r] = t(r); return e; }
    function k(n, t) { return c(t, function (t) { return [t, n[t]]; }); }
    function E(n) { return function (t) { return n(t); }; }
    function S(n, t) { return c(t, function (t) { return n[t]; }); }
    function O(n, t) { return n.has(t); }
    function I(n, t) { for (var r = -1, e = n.length; ++r < e && -1 < v(t, n[r], 0);)
        ; return r; }
    function R(n, t) { for (var r = n.length; r-- && -1 < v(t, n[r], 0);)
        ; return r; }
    function z(n) { return "\\" + Ln[n]; }
    function W(n) {
        var t = -1, r = Array(n.size);
        return n.forEach(function (n, e) {
            r[++t] = [e, n];
        }), r;
    }
    function U(n, t) { return function (r) { return n(t(r)); }; }
    function B(n, t) { for (var r = -1, e = n.length, u = 0, i = []; ++r < e;) {
        var o = n[r];
        o !== t && "__lodash_placeholder__" !== o || (n[r] = "__lodash_placeholder__", i[u++] = r);
    } return i; }
    function L(n) { var t = -1, r = Array(n.size); return n.forEach(function (n) { r[++t] = n; }), r; }
    function C(n) { var t = -1, r = Array(n.size); return n.forEach(function (n) { r[++t] = [n, n]; }), r; }
    function D(n) { if (Rn.test(n)) {
        for (var t = On.lastIndex = 0; On.test(n);)
            ++t;
        n = t;
    }
    else
        n = Qn(n); return n; }
    function M(n) {
        return Rn.test(n) ? n.match(On) || [] : n.split("");
    }
    var T, $ = 1 / 0, F = NaN, N = [["ary", 128], ["bind", 1], ["bindKey", 2], ["curry", 8], ["curryRight", 16], ["flip", 512], ["partial", 32], ["partialRight", 64], ["rearg", 256]], P = /\b__p\+='';/g, Z = /\b(__p\+=)''\+/g, q = /(__e\(.*?\)|\b__t\))\+'';/g, V = /&(?:amp|lt|gt|quot|#39);/g, K = /[&<>"']/g, G = RegExp(V.source), H = RegExp(K.source), J = /<%-([\s\S]+?)%>/g, Y = /<%([\s\S]+?)%>/g, Q = /<%=([\s\S]+?)%>/g, X = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/, nn = /^\w*$/, tn = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g, rn = /[\\^$.*+?()[\]{}|]/g, en = RegExp(rn.source), un = /^\s+|\s+$/g, on = /^\s+/, fn = /\s+$/, cn = /\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/, an = /\{\n\/\* \[wrapped with (.+)\] \*/, ln = /,? & /, sn = /[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g, hn = /\\(\\)?/g, pn = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g, _n = /\w*$/, vn = /^[-+]0x[0-9a-f]+$/i, gn = /^0b[01]+$/i, dn = /^\[object .+?Constructor\]$/, yn = /^0o[0-7]+$/i, bn = /^(?:0|[1-9]\d*)$/, xn = /[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g, jn = /($^)/, wn = /['\n\r\u2028\u2029\\]/g, mn = "[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*", An = "(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])" + mn, kn = "(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])", En = RegExp("['\u2019]", "g"), Sn = RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]", "g"), On = RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|" + kn + mn, "g"), In = RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['\u2019](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['\u2019](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?|\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+", An].join("|"), "g"), Rn = RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"), zn = /[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/, Wn = "Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "), Un = {};
    Un["[object Float32Array]"] = Un["[object Float64Array]"] = Un["[object Int8Array]"] = Un["[object Int16Array]"] = Un["[object Int32Array]"] = Un["[object Uint8Array]"] = Un["[object Uint8ClampedArray]"] = Un["[object Uint16Array]"] = Un["[object Uint32Array]"] = true, Un["[object Arguments]"] = Un["[object Array]"] = Un["[object ArrayBuffer]"] = Un["[object Boolean]"] = Un["[object DataView]"] = Un["[object Date]"] = Un["[object Error]"] = Un["[object Function]"] = Un["[object Map]"] = Un["[object Number]"] = Un["[object Object]"] = Un["[object RegExp]"] = Un["[object Set]"] = Un["[object String]"] = Un["[object WeakMap]"] = false;
    var Bn = {};
    Bn["[object Arguments]"] = Bn["[object Array]"] = Bn["[object ArrayBuffer]"] = Bn["[object DataView]"] = Bn["[object Boolean]"] = Bn["[object Date]"] = Bn["[object Float32Array]"] = Bn["[object Float64Array]"] = Bn["[object Int8Array]"] = Bn["[object Int16Array]"] = Bn["[object Int32Array]"] = Bn["[object Map]"] = Bn["[object Number]"] = Bn["[object Object]"] = Bn["[object RegExp]"] = Bn["[object Set]"] = Bn["[object String]"] = Bn["[object Symbol]"] = Bn["[object Uint8Array]"] = Bn["[object Uint8ClampedArray]"] = Bn["[object Uint16Array]"] = Bn["[object Uint32Array]"] = true,
        Bn["[object Error]"] = Bn["[object Function]"] = Bn["[object WeakMap]"] = false;
    var Ln = { "\\": "\\", "'": "'", "\n": "n", "\r": "r", "\u2028": "u2028", "\u2029": "u2029" }, Cn = parseFloat, Dn = parseInt, Mn = typeof global == "object" && global && global.Object === Object && global, Tn = typeof self == "object" && self && self.Object === Object && self, $n = Mn || Tn || Function("return this")(), Fn = typeof exports == "object" && exports && !exports.nodeType && exports, Nn = Fn && typeof module == "object" && module && !module.nodeType && module, Pn = Nn && Nn.exports === Fn, Zn = Pn && Mn.process, qn = function () {
        try {
            var n = Nn && Nn.require && Nn.require("util").types;
            return n ? n : Zn && Zn.binding && Zn.binding("util");
        }
        catch (n) { }
    }(), Vn = qn && qn.isArrayBuffer, Kn = qn && qn.isDate, Gn = qn && qn.isMap, Hn = qn && qn.isRegExp, Jn = qn && qn.isSet, Yn = qn && qn.isTypedArray, Qn = b("length"), Xn = x({ "\xc0": "A", "\xc1": "A", "\xc2": "A", "\xc3": "A", "\xc4": "A", "\xc5": "A", "\xe0": "a", "\xe1": "a", "\xe2": "a", "\xe3": "a", "\xe4": "a", "\xe5": "a", "\xc7": "C", "\xe7": "c", "\xd0": "D", "\xf0": "d", "\xc8": "E", "\xc9": "E", "\xca": "E", "\xcb": "E", "\xe8": "e", "\xe9": "e", "\xea": "e", "\xeb": "e",
        "\xcc": "I", "\xcd": "I", "\xce": "I", "\xcf": "I", "\xec": "i", "\xed": "i", "\xee": "i", "\xef": "i", "\xd1": "N", "\xf1": "n", "\xd2": "O", "\xd3": "O", "\xd4": "O", "\xd5": "O", "\xd6": "O", "\xd8": "O", "\xf2": "o", "\xf3": "o", "\xf4": "o", "\xf5": "o", "\xf6": "o", "\xf8": "o", "\xd9": "U", "\xda": "U", "\xdb": "U", "\xdc": "U", "\xf9": "u", "\xfa": "u", "\xfb": "u", "\xfc": "u", "\xdd": "Y", "\xfd": "y", "\xff": "y", "\xc6": "Ae", "\xe6": "ae", "\xde": "Th", "\xfe": "th", "\xdf": "ss", "\u0100": "A", "\u0102": "A", "\u0104": "A", "\u0101": "a", "\u0103": "a", "\u0105": "a",
        "\u0106": "C", "\u0108": "C", "\u010a": "C", "\u010c": "C", "\u0107": "c", "\u0109": "c", "\u010b": "c", "\u010d": "c", "\u010e": "D", "\u0110": "D", "\u010f": "d", "\u0111": "d", "\u0112": "E", "\u0114": "E", "\u0116": "E", "\u0118": "E", "\u011a": "E", "\u0113": "e", "\u0115": "e", "\u0117": "e", "\u0119": "e", "\u011b": "e", "\u011c": "G", "\u011e": "G", "\u0120": "G", "\u0122": "G", "\u011d": "g", "\u011f": "g", "\u0121": "g", "\u0123": "g", "\u0124": "H", "\u0126": "H", "\u0125": "h", "\u0127": "h", "\u0128": "I", "\u012a": "I", "\u012c": "I", "\u012e": "I", "\u0130": "I",
        "\u0129": "i", "\u012b": "i", "\u012d": "i", "\u012f": "i", "\u0131": "i", "\u0134": "J", "\u0135": "j", "\u0136": "K", "\u0137": "k", "\u0138": "k", "\u0139": "L", "\u013b": "L", "\u013d": "L", "\u013f": "L", "\u0141": "L", "\u013a": "l", "\u013c": "l", "\u013e": "l", "\u0140": "l", "\u0142": "l", "\u0143": "N", "\u0145": "N", "\u0147": "N", "\u014a": "N", "\u0144": "n", "\u0146": "n", "\u0148": "n", "\u014b": "n", "\u014c": "O", "\u014e": "O", "\u0150": "O", "\u014d": "o", "\u014f": "o", "\u0151": "o", "\u0154": "R", "\u0156": "R", "\u0158": "R", "\u0155": "r", "\u0157": "r",
        "\u0159": "r", "\u015a": "S", "\u015c": "S", "\u015e": "S", "\u0160": "S", "\u015b": "s", "\u015d": "s", "\u015f": "s", "\u0161": "s", "\u0162": "T", "\u0164": "T", "\u0166": "T", "\u0163": "t", "\u0165": "t", "\u0167": "t", "\u0168": "U", "\u016a": "U", "\u016c": "U", "\u016e": "U", "\u0170": "U", "\u0172": "U", "\u0169": "u", "\u016b": "u", "\u016d": "u", "\u016f": "u", "\u0171": "u", "\u0173": "u", "\u0174": "W", "\u0175": "w", "\u0176": "Y", "\u0177": "y", "\u0178": "Y", "\u0179": "Z", "\u017b": "Z", "\u017d": "Z", "\u017a": "z", "\u017c": "z", "\u017e": "z", "\u0132": "IJ",
        "\u0133": "ij", "\u0152": "Oe", "\u0153": "oe", "\u0149": "'n", "\u017f": "s" }), nt = x({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }), tt = x({ "&amp;": "&", "&lt;": "<", "&gt;": ">", "&quot;": '"', "&#39;": "'" }), rt = function x(mn) {
        function An(n) { if (yu(n) && !ff(n) && !(n instanceof Ln)) {
            if (n instanceof On)
                return n;
            if (oi.call(n, "__wrapped__"))
                return Fe(n);
        } return new On(n); }
        function kn() { }
        function On(n, t) { this.__wrapped__ = n, this.__actions__ = [], this.__chain__ = !!t, this.__index__ = 0, this.__values__ = T; }
        function Ln(n) {
            this.__wrapped__ = n, this.__actions__ = [], this.__dir__ = 1, this.__filtered__ = false, this.__iteratees__ = [], this.__takeCount__ = 4294967295, this.__views__ = [];
        }
        function Mn(n) { var t = -1, r = null == n ? 0 : n.length; for (this.clear(); ++t < r;) {
            var e = n[t];
            this.set(e[0], e[1]);
        } }
        function Tn(n) { var t = -1, r = null == n ? 0 : n.length; for (this.clear(); ++t < r;) {
            var e = n[t];
            this.set(e[0], e[1]);
        } }
        function Fn(n) { var t = -1, r = null == n ? 0 : n.length; for (this.clear(); ++t < r;) {
            var e = n[t];
            this.set(e[0], e[1]);
        } }
        function Nn(n) {
            var t = -1, r = null == n ? 0 : n.length;
            for (this.__data__ = new Fn; ++t < r;)
                this.add(n[t]);
        }
        function Zn(n) { this.size = (this.__data__ = new Tn(n)).size; }
        function qn(n, t) { var r, e = ff(n), u = !e && of(n), i = !e && !u && af(n), o = !e && !u && !i && _f(n), u = (e = e || u || i || o) ? A(n.length, ni) : [], f = u.length; for (r in n)
            !t && !oi.call(n, r) || e && ("length" == r || i && ("offset" == r || "parent" == r) || o && ("buffer" == r || "byteLength" == r || "byteOffset" == r) || Se(r, f)) || u.push(r); return u; }
        function Qn(n) { var t = n.length; return t ? n[ir(0, t - 1)] : T; }
        function et(n, t) { return De(Lr(n), pt(t, 0, n.length)); }
        function ut(n) { return De(Lr(n)); }
        function it(n, t, r) {
            (r === T || lu(n[t], r)) && (r !== T || t in n) || st(n, t, r);
        }
        function ot(n, t, r) { var e = n[t]; oi.call(n, t) && lu(e, r) && (r !== T || t in n) || st(n, t, r); }
        function ft(n, t) { for (var r = n.length; r--;)
            if (lu(n[r][0], t))
                return r; return -1; }
        function ct(n, t, r, e) { return uo(n, function (n, u, i) { t(e, n, r(n), i); }), e; }
        function at(n, t) { return n && Cr(t, Wu(t), n); }
        function lt(n, t) { return n && Cr(t, Uu(t), n); }
        function st(n, t, r) { "__proto__" == t && Ai ? Ai(n, t, { configurable: true, enumerable: true, value: r, writable: true }) : n[t] = r; }
        function ht(n, t) {
            for (var r = -1, e = t.length, u = Ku(e), i = null == n; ++r < e;)
                u[r] = i ? T : Ru(n, t[r]);
            return u;
        }
        function pt(n, t, r) { return n === n && (r !== T && (n = n <= r ? n : r), t !== T && (n = n >= t ? n : t)), n; }
        function _t(n, t, e, u, i, o) {
            var f, c = 1 & t, a = 2 & t, l = 4 & t;
            if (e && (f = i ? e(n, u, i, o) : e(n)), f !== T)
                return f;
            if (!du(n))
                return n;
            if (u = ff(n)) {
                if (f = me(n), !c)
                    return Lr(n, f);
            }
            else {
                var s = vo(n), h = "[object Function]" == s || "[object GeneratorFunction]" == s;
                if (af(n))
                    return Ir(n, c);
                if ("[object Object]" == s || "[object Arguments]" == s || h && !i) {
                    if (f = a || h ? {} : Ae(n), !c)
                        return a ? Mr(n, lt(f, n)) : Dr(n, at(f, n));
                }
                else {
                    if (!Bn[s])
                        return i ? n : {};
                    f = ke(n, s, c);
                }
            }
            if (o || (o = new Zn),
                i = o.get(n))
                return i;
            if (o.set(n, f), pf(n))
                return n.forEach(function (r) { f.add(_t(r, t, e, r, n, o)); }), f;
            if (sf(n))
                return n.forEach(function (r, u) { f.set(u, _t(r, t, e, u, n, o)); }), f;
            var a = l ? a ? ve : _e : a ? Uu : Wu, p = u ? T : a(n);
            return r(p || n, function (r, u) { p && (u = r, r = n[u]), ot(f, u, _t(r, t, e, u, n, o)); }), f;
        }
        function vt(n) { var t = Wu(n); return function (r) { return gt(r, n, t); }; }
        function gt(n, t, r) { var e = r.length; if (null == n)
            return !e; for (n = Qu(n); e--;) {
            var u = r[e], i = t[u], o = n[u];
            if (o === T && !(u in n) || !i(o))
                return false;
        } return true; }
        function dt(n, t, r) {
            if (typeof n != "function")
                throw new ti("Expected a function");
            return bo(function () { n.apply(T, r); }, t);
        }
        function yt(n, t, r, e) { var u = -1, i = o, a = true, l = n.length, s = [], h = t.length; if (!l)
            return s; r && (t = c(t, E(r))), e ? (i = f, a = false) : 200 <= t.length && (i = O, a = false, t = new Nn(t)); n: for (; ++u < l;) {
            var p = n[u], _ = null == r ? p : r(p), p = e || 0 !== p ? p : 0;
            if (a && _ === _) {
                for (var v = h; v--;)
                    if (t[v] === _)
                        continue n;
                s.push(p);
            }
            else
                i(t, _, e) || s.push(p);
        } return s; }
        function bt(n, t) { var r = true; return uo(n, function (n, e, u) { return r = !!t(n, e, u); }), r; }
        function xt(n, t, r) {
            for (var e = -1, u = n.length; ++e < u;) {
                var i = n[e], o = t(i);
                if (null != o && (f === T ? o === o && !wu(o) : r(o, f)))
                    var f = o, c = i;
            }
            return c;
        }
        function jt(n, t) { var r = []; return uo(n, function (n, e, u) { t(n, e, u) && r.push(n); }), r; }
        function wt(n, t, r, e, u) { var i = -1, o = n.length; for (r || (r = Ee), u || (u = []); ++i < o;) {
            var f = n[i];
            0 < t && r(f) ? 1 < t ? wt(f, t - 1, r, e, u) : a(u, f) : e || (u[u.length] = f);
        } return u; }
        function mt(n, t) { return n && oo(n, t, Wu); }
        function At(n, t) { return n && fo(n, t, Wu); }
        function kt(n, t) { return i(t, function (t) { return _u(n[t]); }); }
        function Et(n, t) { t = Sr(t, n); for (var r = 0, e = t.length; null != n && r < e;)
            n = n[Me(t[r++])]; return r && r == e ? n : T; }
        function St(n, t, r) {
            return t = t(n),
                ff(n) ? t : a(t, r(n));
        }
        function Ot(n) { if (null == n)
            return n === T ? "[object Undefined]" : "[object Null]"; if (mi && mi in Qu(n)) {
            var t = oi.call(n, mi), r = n[mi];
            try {
                n[mi] = T;
                var e = true;
            }
            catch (n) { }
            var u = ai.call(n);
            e && (t ? n[mi] = r : delete n[mi]), n = u;
        }
        else
            n = ai.call(n); return n; }
        function It(n, t) { return n > t; }
        function Rt(n, t) { return null != n && oi.call(n, t); }
        function zt(n, t) { return null != n && t in Qu(n); }
        function Wt(n, t, r) {
            for (var e = r ? f : o, u = n[0].length, i = n.length, a = i, l = Ku(i), s = 1 / 0, h = []; a--;) {
                var p = n[a];
                a && t && (p = c(p, E(t))), s = Ci(p.length, s),
                    l[a] = !r && (t || 120 <= u && 120 <= p.length) ? new Nn(a && p) : T;
            }
            var p = n[0], _ = -1, v = l[0];
            n: for (; ++_ < u && h.length < s;) {
                var g = p[_], d = t ? t(g) : g, g = r || 0 !== g ? g : 0;
                if (v ? !O(v, d) : !e(h, d, r)) {
                    for (a = i; --a;) {
                        var y = l[a];
                        if (y ? !O(y, d) : !e(n[a], d, r))
                            continue n;
                    }
                    v && v.push(d), h.push(g);
                }
            }
            return h;
        }
        function Ut(n, t, r, e) { return mt(n, function (n, u, i) { t(e, r(n), u, i); }), e; }
        function Bt(t, r, e) { return r = Sr(r, t), t = 2 > r.length ? t : Et(t, hr(r, 0, -1)), r = null == t ? t : t[Me(Ve(r))], null == r ? T : n(r, t, e); }
        function Lt(n) { return yu(n) && "[object Arguments]" == Ot(n); }
        function Ct(n) {
            return yu(n) && "[object ArrayBuffer]" == Ot(n);
        }
        function Dt(n) { return yu(n) && "[object Date]" == Ot(n); }
        function Mt(n, t, r, e, u) {
            if (n === t)
                return true;
            if (null == n || null == t || !yu(n) && !yu(t))
                return n !== n && t !== t;
            n: {
                var i = ff(n), o = ff(t), f = i ? "[object Array]" : vo(n), c = o ? "[object Array]" : vo(t), f = "[object Arguments]" == f ? "[object Object]" : f, c = "[object Arguments]" == c ? "[object Object]" : c, a = "[object Object]" == f, o = "[object Object]" == c;
                if ((c = f == c) && af(n)) {
                    if (!af(t)) {
                        t = false;
                        break n;
                    }
                    i = true, a = false;
                }
                if (c && !a)
                    u || (u = new Zn), t = i || _f(n) ? se(n, t, r, e, Mt, u) : he(n, t, f, r, e, Mt, u);
                else {
                    if (!(1 & r) && (i = a && oi.call(n, "__wrapped__"), f = o && oi.call(t, "__wrapped__"), i || f)) {
                        n = i ? n.value() : n, t = f ? t.value() : t, u || (u = new Zn), t = Mt(n, t, r, e, u);
                        break n;
                    }
                    if (c)
                        t: if (u || (u = new Zn), i = 1 & r, f = _e(n), o = f.length, c = _e(t).length, o == c || i) {
                            for (a = o; a--;) {
                                var l = f[a];
                                if (!(i ? l in t : oi.call(t, l))) {
                                    t = false;
                                    break t;
                                }
                            }
                            if ((c = u.get(n)) && u.get(t))
                                t = c == t;
                            else {
                                c = true, u.set(n, t), u.set(t, n);
                                for (var s = i; ++a < o;) {
                                    var l = f[a], h = n[l], p = t[l];
                                    if (e)
                                        var _ = i ? e(p, h, l, t, n, u) : e(h, p, l, n, t, u);
                                    if (_ === T ? h !== p && !Mt(h, p, r, e, u) : !_) {
                                        c = false;
                                        break;
                                    }
                                    s || (s = "constructor" == l);
                                }
                                c && !s && (r = n.constructor, e = t.constructor, r != e && "constructor" in n && "constructor" in t && !(typeof r == "function" && r instanceof r && typeof e == "function" && e instanceof e) && (c = false)), u.delete(n), u.delete(t), t = c;
                            }
                        }
                        else
                            t = false;
                    else
                        t = false;
                }
            }
            return t;
        }
        function Tt(n) { return yu(n) && "[object Map]" == vo(n); }
        function $t(n, t, r, e) {
            var u = r.length, i = u, o = !e;
            if (null == n)
                return !i;
            for (n = Qu(n); u--;) {
                var f = r[u];
                if (o && f[2] ? f[1] !== n[f[0]] : !(f[0] in n))
                    return false;
            }
            for (; ++u < i;) {
                var f = r[u], c = f[0], a = n[c], l = f[1];
                if (o && f[2]) {
                    if (a === T && !(c in n))
                        return false;
                }
                else {
                    if (f = new Zn, e)
                        var s = e(a, l, c, n, t, f);
                    if (s === T ? !Mt(l, a, 3, e, f) : !s)
                        return false;
                }
            }
            return true;
        }
        function Ft(n) { return !(!du(n) || ci && ci in n) && (_u(n) ? hi : dn).test(Te(n)); }
        function Nt(n) { return yu(n) && "[object RegExp]" == Ot(n); }
        function Pt(n) { return yu(n) && "[object Set]" == vo(n); }
        function Zt(n) { return yu(n) && gu(n.length) && !!Un[Ot(n)]; }
        function qt(n) { return typeof n == "function" ? n : null == n ? $u : typeof n == "object" ? ff(n) ? Jt(n[0], n[1]) : Ht(n) : Zu(n); }
        function Vt(n) {
            if (!ze(n))
                return Bi(n);
            var t, r = [];
            for (t in Qu(n))
                oi.call(n, t) && "constructor" != t && r.push(t);
            return r;
        }
        function Kt(n, t) { return n < t; }
        function Gt(n, t) { var r = -1, e = su(n) ? Ku(n.length) : []; return uo(n, function (n, u, i) { e[++r] = t(n, u, i); }), e; }
        function Ht(n) { var t = xe(n); return 1 == t.length && t[0][2] ? We(t[0][0], t[0][1]) : function (r) { return r === n || $t(r, n, t); }; }
        function Jt(n, t) { return Ie(n) && t === t && !du(t) ? We(Me(n), t) : function (r) { var e = Ru(r, n); return e === T && e === t ? zu(r, n) : Mt(t, e, 3); }; }
        function Yt(n, t, r, e, u) {
            n !== t && oo(t, function (i, o) {
                if (du(i)) {
                    u || (u = new Zn);
                    var f = u, c = Be(n, o), a = Be(t, o), l = f.get(a);
                    if (!l) {
                        var l = e ? e(c, a, o + "", n, t, f) : T, s = l === T;
                        if (s) {
                            var h = ff(a), p = !h && af(a), _ = !h && !p && _f(a), l = a;
                            h || p || _ ? ff(c) ? l = c : hu(c) ? l = Lr(c) : p ? (s = false, l = Ir(a, true)) : _ ? (s = false, l = zr(a, true)) : l = [] : xu(a) || of(a) ? (l = c, of(c) ? l = Ou(c) : du(c) && !_u(c) || (l = Ae(a))) : s = false;
                        }
                        s && (f.set(a, l), Yt(l, a, r, e, f), f.delete(a));
                    }
                    it(n, o, l);
                }
                else
                    f = e ? e(Be(n, o), i, o + "", n, t, u) : T, f === T && (f = i), it(n, o, f);
            }, Uu);
        }
        function Qt(n, t) { var r = n.length; if (r)
            return t += 0 > t ? r : 0, Se(t, r) ? n[t] : T; }
        function Xt(n, t, r) {
            var e = -1;
            return t = c(t.length ? t : [$u], E(ye())), n = Gt(n, function (n, r, u) {
                return { a: c(t, function (t) { return t(n); }),
                    b: ++e, c: n };
            }), w(n, function (n, t) { var e; n: {
                e = -1;
                for (var u = n.a, i = t.a, o = u.length, f = r.length; ++e < o;) {
                    var c = Wr(u[e], i[e]);
                    if (c) {
                        if (e >= f) {
                            e = c;
                            break n;
                        }
                        e = c * ("desc" == r[e] ? -1 : 1);
                        break n;
                    }
                }
                e = n.b - t.b;
            } return e; });
        }
        function nr(n, t) { return tr(n, t, function (t, r) { return zu(n, r); }); }
        function tr(n, t, r) { for (var e = -1, u = t.length, i = {}; ++e < u;) {
            var o = t[e], f = Et(n, o);
            r(f, o) && lr(i, Sr(o, n), f);
        } return i; }
        function rr(n) { return function (t) { return Et(t, n); }; }
        function er(n, t, r, e) {
            var u = e ? g : v, i = -1, o = t.length, f = n;
            for (n === t && (t = Lr(t)), r && (f = c(n, E(r))); ++i < o;)
                for (var a = 0, l = t[i], l = r ? r(l) : l; -1 < (a = u(f, l, a, e));)
                    f !== n && xi.call(f, a, 1),
                        xi.call(n, a, 1);
            return n;
        }
        function ur(n, t) { for (var r = n ? t.length : 0, e = r - 1; r--;) {
            var u = t[r];
            if (r == e || u !== i) {
                var i = u;
                Se(u) ? xi.call(n, u, 1) : xr(n, u);
            }
        } return n; }
        function ir(n, t) { return n + Ii(Ti() * (t - n + 1)); }
        function or(n, t) { var r = ""; if (!n || 1 > t || 9007199254740991 < t)
            return r; do
            t % 2 && (r += n), (t = Ii(t / 2)) && (n += n);
        while (t); return r; }
        function fr(n, t) { return xo(Ue(n, t, $u), n + ""); }
        function cr(n) { return Qn(Lu(n)); }
        function ar(n, t) { var r = Lu(n); return De(r, pt(t, 0, r.length)); }
        function lr(n, t, r, e) {
            if (!du(n))
                return n;
            t = Sr(t, n);
            for (var u = -1, i = t.length, o = i - 1, f = n; null != f && ++u < i;) {
                var c = Me(t[u]), a = r;
                if (u != o) {
                    var l = f[c], a = e ? e(l, c, f) : T;
                    a === T && (a = du(l) ? l : Se(t[u + 1]) ? [] : {});
                }
                ot(f, c, a), f = f[c];
            }
            return n;
        }
        function sr(n) { return De(Lu(n)); }
        function hr(n, t, r) { var e = -1, u = n.length; for (0 > t && (t = -t > u ? 0 : u + t), r = r > u ? u : r, 0 > r && (r += u), u = t > r ? 0 : r - t >>> 0, t >>>= 0, r = Ku(u); ++e < u;)
            r[e] = n[e + t]; return r; }
        function pr(n, t) { var r; return uo(n, function (n, e, u) { return r = t(n, e, u), !r; }), !!r; }
        function _r(n, t, r) {
            var e = 0, u = null == n ? e : n.length;
            if (typeof t == "number" && t === t && 2147483647 >= u) {
                for (; e < u;) {
                    var i = e + u >>> 1, o = n[i];
                    null !== o && !wu(o) && (r ? o <= t : o < t) ? e = i + 1 : u = i;
                }
                return u;
            }
            return vr(n, t, $u, r);
        }
        function vr(n, t, r, e) { t = r(t); for (var u = 0, i = null == n ? 0 : n.length, o = t !== t, f = null === t, c = wu(t), a = t === T; u < i;) {
            var l = Ii((u + i) / 2), s = r(n[l]), h = s !== T, p = null === s, _ = s === s, v = wu(s);
            (o ? e || _ : a ? _ && (e || h) : f ? _ && h && (e || !p) : c ? _ && h && !p && (e || !v) : p || v ? 0 : e ? s <= t : s < t) ? u = l + 1 : i = l;
        } return Ci(i, 4294967294); }
        function gr(n, t) { for (var r = -1, e = n.length, u = 0, i = []; ++r < e;) {
            var o = n[r], f = t ? t(o) : o;
            if (!r || !lu(f, c)) {
                var c = f;
                i[u++] = 0 === o ? 0 : o;
            }
        } return i; }
        function dr(n) { return typeof n == "number" ? n : wu(n) ? F : +n; }
        function yr(n) {
            if (typeof n == "string")
                return n;
            if (ff(n))
                return c(n, yr) + "";
            if (wu(n))
                return ro ? ro.call(n) : "";
            var t = n + "";
            return "0" == t && 1 / n == -$ ? "-0" : t;
        }
        function br(n, t, r) { var e = -1, u = o, i = n.length, c = true, a = [], l = a; if (r)
            c = false, u = f;
        else if (200 <= i) {
            if (u = t ? null : so(n))
                return L(u);
            c = false, u = O, l = new Nn;
        }
        else
            l = t ? [] : a; n: for (; ++e < i;) {
            var s = n[e], h = t ? t(s) : s, s = r || 0 !== s ? s : 0;
            if (c && h === h) {
                for (var p = l.length; p--;)
                    if (l[p] === h)
                        continue n;
                t && l.push(h), a.push(s);
            }
            else
                u(l, h, r) || (l !== a && l.push(h), a.push(s));
        } return a; }
        function xr(n, t) {
            return t = Sr(t, n),
                n = 2 > t.length ? n : Et(n, hr(t, 0, -1)), null == n || delete n[Me(Ve(t))];
        }
        function jr(n, t, r, e) { for (var u = n.length, i = e ? u : -1; (e ? i-- : ++i < u) && t(n[i], i, n);)
            ; return r ? hr(n, e ? 0 : i, e ? i + 1 : u) : hr(n, e ? i + 1 : 0, e ? u : i); }
        function wr(n, t) { var r = n; return r instanceof Ln && (r = r.value()), l(t, function (n, t) { return t.func.apply(t.thisArg, a([n], t.args)); }, r); }
        function mr(n, t, r) { var e = n.length; if (2 > e)
            return e ? br(n[0]) : []; for (var u = -1, i = Ku(e); ++u < e;)
            for (var o = n[u], f = -1; ++f < e;)
                f != u && (i[u] = yt(i[u] || o, n[f], t, r)); return br(wt(i, 1), t, r); }
        function Ar(n, t, r) {
            for (var e = -1, u = n.length, i = t.length, o = {}; ++e < u;)
                r(o, n[e], e < i ? t[e] : T);
            return o;
        }
        function kr(n) { return hu(n) ? n : []; }
        function Er(n) { return typeof n == "function" ? n : $u; }
        function Sr(n, t) { return ff(n) ? n : Ie(n, t) ? [n] : jo(Iu(n)); }
        function Or(n, t, r) { var e = n.length; return r = r === T ? e : r, !t && r >= e ? n : hr(n, t, r); }
        function Ir(n, t) { if (t)
            return n.slice(); var r = n.length, r = gi ? gi(r) : new n.constructor(r); return n.copy(r), r; }
        function Rr(n) { var t = new n.constructor(n.byteLength); return new vi(t).set(new vi(n)), t; }
        function zr(n, t) {
            return new n.constructor(t ? Rr(n.buffer) : n.buffer, n.byteOffset, n.length);
        }
        function Wr(n, t) { if (n !== t) {
            var r = n !== T, e = null === n, u = n === n, i = wu(n), o = t !== T, f = null === t, c = t === t, a = wu(t);
            if (!f && !a && !i && n > t || i && o && c && !f && !a || e && o && c || !r && c || !u)
                return 1;
            if (!e && !i && !a && n < t || a && r && u && !e && !i || f && r && u || !o && u || !c)
                return -1;
        } return 0; }
        function Ur(n, t, r, e) { var u = -1, i = n.length, o = r.length, f = -1, c = t.length, a = Li(i - o, 0), l = Ku(c + a); for (e = !e; ++f < c;)
            l[f] = t[f]; for (; ++u < o;)
            (e || u < i) && (l[r[u]] = n[u]); for (; a--;)
            l[f++] = n[u++]; return l; }
        function Br(n, t, r, e) {
            var u = -1, i = n.length, o = -1, f = r.length, c = -1, a = t.length, l = Li(i - f, 0), s = Ku(l + a);
            for (e = !e; ++u < l;)
                s[u] = n[u];
            for (l = u; ++c < a;)
                s[l + c] = t[c];
            for (; ++o < f;)
                (e || u < i) && (s[l + r[o]] = n[u++]);
            return s;
        }
        function Lr(n, t) { var r = -1, e = n.length; for (t || (t = Ku(e)); ++r < e;)
            t[r] = n[r]; return t; }
        function Cr(n, t, r, e) { var u = !r; r || (r = {}); for (var i = -1, o = t.length; ++i < o;) {
            var f = t[i], c = e ? e(r[f], n[f], f, r, n) : T;
            c === T && (c = n[f]), u ? st(r, f, c) : ot(r, f, c);
        } return r; }
        function Dr(n, t) { return Cr(n, po(n), t); }
        function Mr(n, t) { return Cr(n, _o(n), t); }
        function Tr(n, r) {
            return function (e, u) {
                var i = ff(e) ? t : ct, o = r ? r() : {};
                return i(e, n, ye(u, 2), o);
            };
        }
        function $r(n) { return fr(function (t, r) { var e = -1, u = r.length, i = 1 < u ? r[u - 1] : T, o = 2 < u ? r[2] : T, i = 3 < n.length && typeof i == "function" ? (u--, i) : T; for (o && Oe(r[0], r[1], o) && (i = 3 > u ? T : i, u = 1), t = Qu(t); ++e < u;)
            (o = r[e]) && n(t, o, e, i); return t; }); }
        function Fr(n, t) { return function (r, e) { if (null == r)
            return r; if (!su(r))
            return n(r, e); for (var u = r.length, i = t ? u : -1, o = Qu(r); (t ? i-- : ++i < u) && false !== e(o[i], i, o);)
            ; return r; }; }
        function Nr(n) {
            return function (t, r, e) {
                var u = -1, i = Qu(t);
                e = e(t);
                for (var o = e.length; o--;) {
                    var f = e[n ? o : ++u];
                    if (false === r(i[f], f, i))
                        break;
                }
                return t;
            };
        }
        function Pr(n, t, r) { function e() { return (this && this !== $n && this instanceof e ? i : n).apply(u ? r : this, arguments); } var u = 1 & t, i = Vr(n); return e; }
        function Zr(n) { return function (t) { t = Iu(t); var r = Rn.test(t) ? M(t) : T, e = r ? r[0] : t.charAt(0); return t = r ? Or(r, 1).join("") : t.slice(1), e[n]() + t; }; }
        function qr(n) { return function (t) { return l(Mu(Du(t).replace(En, "")), n, ""); }; }
        function Vr(n) {
            return function () {
                var t = arguments;
                switch (t.length) {
                    case 0: return new n;
                    case 1: return new n(t[0]);
                    case 2: return new n(t[0], t[1]);
                    case 3:
                        return new n(t[0], t[1], t[2]);
                    case 4: return new n(t[0], t[1], t[2], t[3]);
                    case 5: return new n(t[0], t[1], t[2], t[3], t[4]);
                    case 6: return new n(t[0], t[1], t[2], t[3], t[4], t[5]);
                    case 7: return new n(t[0], t[1], t[2], t[3], t[4], t[5], t[6]);
                }
                var r = eo(n.prototype), t = n.apply(r, t);
                return du(t) ? t : r;
            };
        }
        function Kr(t, r, e) {
            function u() {
                for (var o = arguments.length, f = Ku(o), c = o, a = de(u); c--;)
                    f[c] = arguments[c];
                return c = 3 > o && f[0] !== a && f[o - 1] !== a ? [] : B(f, a), o -= c.length, o < e ? ue(t, r, Jr, u.placeholder, T, f, c, T, T, e - o) : n(this && this !== $n && this instanceof u ? i : t, this, f);
            }
            var i = Vr(t);
            return u;
        }
        function Gr(n) { return function (t, r, e) { var u = Qu(t); if (!su(t)) {
            var i = ye(r, 3);
            t = Wu(t), r = function (n) { return i(u[n], n, u); };
        } return r = n(t, r, e), -1 < r ? u[i ? t[r] : r] : T; }; }
        function Hr(n) {
            return pe(function (t) {
                var r = t.length, e = r, u = On.prototype.thru;
                for (n && t.reverse(); e--;) {
                    var i = t[e];
                    if (typeof i != "function")
                        throw new ti("Expected a function");
                    if (u && !o && "wrapper" == ge(i))
                        var o = new On([], true);
                }
                for (e = o ? e : r; ++e < r;)
                    var i = t[e], u = ge(i), f = "wrapper" == u ? ho(i) : T, o = f && Re(f[0]) && 424 == f[1] && !f[4].length && 1 == f[9] ? o[ge(f[0])].apply(o, f[3]) : 1 == i.length && Re(i) ? o[u]() : o.thru(i);
                return function () { var n = arguments, e = n[0]; if (o && 1 == n.length && ff(e))
                    return o.plant(e).value(); for (var u = 0, n = r ? t[u].apply(this, n) : e; ++u < r;)
                    n = t[u].call(this, n); return n; };
            });
        }
        function Jr(n, t, r, e, u, i, o, f, c, a) {
            function l() {
                for (var d = arguments.length, y = Ku(d), b = d; b--;)
                    y[b] = arguments[b];
                if (_) {
                    var x, j = de(l), b = y.length;
                    for (x = 0; b--;)
                        y[b] === j && ++x;
                }
                if (e && (y = Ur(y, e, u, _)), i && (y = Br(y, i, o, _)), d -= x, _ && d < a)
                    return j = B(y, j), ue(n, t, Jr, l.placeholder, r, y, j, f, c, a - d);
                if (j = h ? r : this, b = p ? j[n] : n, d = y.length, f) {
                    x = y.length;
                    for (var w = Ci(f.length, x), m = Lr(y); w--;) {
                        var A = f[w];
                        y[w] = Se(A, x) ? m[A] : T;
                    }
                }
                else
                    v && 1 < d && y.reverse();
                return s && c < d && (y.length = c), this && this !== $n && this instanceof l && (b = g || Vr(b)), b.apply(j, y);
            }
            var s = 128 & t, h = 1 & t, p = 2 & t, _ = 24 & t, v = 512 & t, g = p ? T : Vr(n);
            return l;
        }
        function Yr(n, t) { return function (r, e) { return Ut(r, n, t(e), {}); }; }
        function Qr(n, t) { return function (r, e) { var u; if (r === T && e === T)
            return t; if (r !== T && (u = r), e !== T) {
            if (u === T)
                return e;
            typeof r == "string" || typeof e == "string" ? (r = yr(r), e = yr(e)) : (r = dr(r), e = dr(e)), u = n(r, e);
        } return u; }; }
        function Xr(t) {
            return pe(function (r) {
                return r = c(r, E(ye())), fr(function (e) { var u = this; return t(r, function (t) { return n(t, u, e); }); });
            });
        }
        function ne(n, t) { t = t === T ? " " : yr(t); var r = t.length; return 2 > r ? r ? or(t, n) : t : (r = or(t, Oi(n / D(t))), Rn.test(t) ? Or(M(r), 0, n).join("") : r.slice(0, n)); }
        function te(t, r, e, u) { function i() { for (var r = -1, c = arguments.length, a = -1, l = u.length, s = Ku(l + c), h = this && this !== $n && this instanceof i ? f : t; ++a < l;)
            s[a] = u[a]; for (; c--;)
            s[a++] = arguments[++r]; return n(h, o ? e : this, s); } var o = 1 & r, f = Vr(t); return i; }
        function re(n) {
            return function (t, r, e) {
                e && typeof e != "number" && Oe(t, r, e) && (r = e = T), t = Au(t), r === T ? (r = t, t = 0) : r = Au(r), e = e === T ? t < r ? 1 : -1 : Au(e);
                var u = -1;
                r = Li(Oi((r - t) / (e || 1)), 0);
                for (var i = Ku(r); r--;)
                    i[n ? r : ++u] = t, t += e;
                return i;
            };
        }
        function ee(n) { return function (t, r) { return typeof t == "string" && typeof r == "string" || (t = Su(t), r = Su(r)), n(t, r); }; }
        function ue(n, t, r, e, u, i, o, f, c, a) { var l = 8 & t, s = l ? o : T; o = l ? T : o; var h = l ? i : T; return i = l ? T : i, t = (t | (l ? 32 : 64)) & ~(l ? 64 : 32), 4 & t || (t &= -4), u = [n, t, u, h, s, i, o, f, c, a], r = r.apply(T, u), Re(n) && yo(r, u), r.placeholder = e, Le(r, n, t); }
        function ie(n) {
            var t = Yu[n];
            return function (n, r) { if (n = Su(n), r = null == r ? 0 : Ci(ku(r), 292)) {
                var e = (Iu(n) + "e").split("e"), e = t(e[0] + "e" + (+e[1] + r)), e = (Iu(e) + "e").split("e");
                return +(e[0] + "e" + (+e[1] - r));
            } return t(n); };
        }
        function oe(n) { return function (t) { var r = vo(t); return "[object Map]" == r ? W(t) : "[object Set]" == r ? C(t) : k(t, n(t)); }; }
        function fe(n, t, r, e, u, i, o, f) {
            var c = 2 & t;
            if (!c && typeof n != "function")
                throw new ti("Expected a function");
            var a = e ? e.length : 0;
            if (a || (t &= -97, e = u = T), o = o === T ? o : Li(ku(o), 0), f = f === T ? f : ku(f), a -= u ? u.length : 0, 64 & t) {
                var l = e, s = u;
                e = u = T;
            }
            var h = c ? T : ho(n);
            return i = [n, t, r, e, u, l, s, i, o, f], h && (r = i[1], n = h[1], t = r | n, e = 128 == n && 8 == r || 128 == n && 256 == r && i[7].length <= h[8] || 384 == n && h[7].length <= h[8] && 8 == r, 131 > t || e) && (1 & n && (i[2] = h[2], t |= 1 & r ? 0 : 4), (r = h[3]) && (e = i[3], i[3] = e ? Ur(e, r, h[4]) : r, i[4] = e ? B(i[3], "__lodash_placeholder__") : h[4]), (r = h[5]) && (e = i[5], i[5] = e ? Br(e, r, h[6]) : r, i[6] = e ? B(i[5], "__lodash_placeholder__") : h[6]), (r = h[7]) && (i[7] = r), 128 & n && (i[8] = null == i[8] ? h[8] : Ci(i[8], h[8])), null == i[9] && (i[9] = h[9]), i[0] = h[0], i[1] = t), n = i[0], t = i[1],
                r = i[2], e = i[3], u = i[4], f = i[9] = i[9] === T ? c ? 0 : n.length : Li(i[9] - a, 0), !f && 24 & t && (t &= -25), c = t && 1 != t ? 8 == t || 16 == t ? Kr(n, t, f) : 32 != t && 33 != t || u.length ? Jr.apply(T, i) : te(n, t, r, e) : Pr(n, t, r), Le((h ? co : yo)(c, i), n, t);
        }
        function ce(n, t, r, e) { return n === T || lu(n, ei[r]) && !oi.call(e, r) ? t : n; }
        function ae(n, t, r, e, u, i) { return du(n) && du(t) && (i.set(t, n), Yt(n, t, T, ae, i), i.delete(t)), n; }
        function le(n) { return xu(n) ? T : n; }
        function se(n, t, r, e, u, i) {
            var o = 1 & r, f = n.length, c = t.length;
            if (f != c && !(o && c > f))
                return false;
            if ((c = i.get(n)) && i.get(t))
                return c == t;
            var c = -1, a = true, l = 2 & r ? new Nn : T;
            for (i.set(n, t), i.set(t, n); ++c < f;) {
                var s = n[c], p = t[c];
                if (e)
                    var _ = o ? e(p, s, c, t, n, i) : e(s, p, c, n, t, i);
                if (_ !== T) {
                    if (_)
                        continue;
                    a = false;
                    break;
                }
                if (l) {
                    if (!h(t, function (n, t) { if (!O(l, t) && (s === n || u(s, n, r, e, i)))
                        return l.push(t); })) {
                        a = false;
                        break;
                    }
                }
                else if (s !== p && !u(s, p, r, e, i)) {
                    a = false;
                    break;
                }
            }
            return i.delete(n), i.delete(t), a;
        }
        function he(n, t, r, e, u, i, o) {
            switch (r) {
                case "[object DataView]":
                    if (n.byteLength != t.byteLength || n.byteOffset != t.byteOffset)
                        break;
                    n = n.buffer, t = t.buffer;
                case "[object ArrayBuffer]":
                    if (n.byteLength != t.byteLength || !i(new vi(n), new vi(t)))
                        break;
                    return true;
                case "[object Boolean]":
                case "[object Date]":
                case "[object Number]": return lu(+n, +t);
                case "[object Error]": return n.name == t.name && n.message == t.message;
                case "[object RegExp]":
                case "[object String]": return n == t + "";
                case "[object Map]": var f = W;
                case "[object Set]":
                    if (f || (f = L), n.size != t.size && !(1 & e))
                        break;
                    return (r = o.get(n)) ? r == t : (e |= 2, o.set(n, t), t = se(f(n), f(t), e, u, i, o), o.delete(n), t);
                case "[object Symbol]": if (to)
                    return to.call(n) == to.call(t);
            }
            return false;
        }
        function pe(n) { return xo(Ue(n, T, Ze), n + ""); }
        function _e(n) { return St(n, Wu, po); }
        function ve(n) { return St(n, Uu, _o); }
        function ge(n) { for (var t = n.name + "", r = Gi[t], e = oi.call(Gi, t) ? r.length : 0; e--;) {
            var u = r[e], i = u.func;
            if (null == i || i == n)
                return u.name;
        } return t; }
        function de(n) { return (oi.call(An, "placeholder") ? An : n).placeholder; }
        function ye() { var n = An.iteratee || Fu, n = n === Fu ? qt : n; return arguments.length ? n(arguments[0], arguments[1]) : n; }
        function be(n, t) {
            var r = n.__data__, e = typeof t;
            return ("string" == e || "number" == e || "symbol" == e || "boolean" == e ? "__proto__" !== t : null === t) ? r[typeof t == "string" ? "string" : "hash"] : r.map;
        }
        function xe(n) { for (var t = Wu(n), r = t.length; r--;) {
            var e = t[r], u = n[e];
            t[r] = [e, u, u === u && !du(u)];
        } return t; }
        function je(n, t) { var r = null == n ? T : n[t]; return Ft(r) ? r : T; }
        function we(n, t, r) { t = Sr(t, n); for (var e = -1, u = t.length, i = false; ++e < u;) {
            var o = Me(t[e]);
            if (!(i = null != n && r(n, o)))
                break;
            n = n[o];
        } return i || ++e != u ? i : (u = null == n ? 0 : n.length, !!u && gu(u) && Se(o, u) && (ff(n) || of(n))); }
        function me(n) { var t = n.length, r = new n.constructor(t); return t && "string" == typeof n[0] && oi.call(n, "index") && (r.index = n.index, r.input = n.input), r; }
        function Ae(n) {
            return typeof n.constructor != "function" || ze(n) ? {} : eo(di(n));
        }
        function ke(n, t, r) {
            var e = n.constructor;
            switch (t) {
                case "[object ArrayBuffer]": return Rr(n);
                case "[object Boolean]":
                case "[object Date]": return new e(+n);
                case "[object DataView]": return t = r ? Rr(n.buffer) : n.buffer, new n.constructor(t, n.byteOffset, n.byteLength);
                case "[object Float32Array]":
                case "[object Float64Array]":
                case "[object Int8Array]":
                case "[object Int16Array]":
                case "[object Int32Array]":
                case "[object Uint8Array]":
                case "[object Uint8ClampedArray]":
                case "[object Uint16Array]":
                case "[object Uint32Array]": return zr(n, r);
                case "[object Map]": return new e;
                case "[object Number]":
                case "[object String]": return new e(n);
                case "[object RegExp]": return t = new n.constructor(n.source, _n.exec(n)), t.lastIndex = n.lastIndex, t;
                case "[object Set]": return new e;
                case "[object Symbol]": return to ? Qu(to.call(n)) : {};
            }
        }
        function Ee(n) { return ff(n) || of(n) || !!(ji && n && n[ji]); }
        function Se(n, t) {
            var r = typeof n;
            return t = null == t ? 9007199254740991 : t, !!t && ("number" == r || "symbol" != r && bn.test(n)) && -1 < n && 0 == n % 1 && n < t;
        }
        function Oe(n, t, r) { if (!du(r))
            return false; var e = typeof t; return !!("number" == e ? su(r) && Se(t, r.length) : "string" == e && t in r) && lu(r[t], n); }
        function Ie(n, t) { if (ff(n))
            return false; var r = typeof n; return !("number" != r && "symbol" != r && "boolean" != r && null != n && !wu(n)) || (nn.test(n) || !X.test(n) || null != t && n in Qu(t)); }
        function Re(n) { var t = ge(n), r = An[t]; return typeof r == "function" && t in Ln.prototype && (n === r || (t = ho(r), !!t && n === t[0])); }
        function ze(n) { var t = n && n.constructor; return n === (typeof t == "function" && t.prototype || ei); }
        function We(n, t) {
            return function (r) { return null != r && (r[n] === t && (t !== T || n in Qu(r))); };
        }
        function Ue(t, r, e) { return r = Li(r === T ? t.length - 1 : r, 0), function () { for (var u = arguments, i = -1, o = Li(u.length - r, 0), f = Ku(o); ++i < o;)
            f[i] = u[r + i]; for (i = -1, o = Ku(r + 1); ++i < r;)
            o[i] = u[i]; return o[r] = e(f), n(t, this, o); }; }
        function Be(n, t) { if ("__proto__" != t)
            return n[t]; }
        function Le(n, t, r) {
            var e = t + "";
            t = xo;
            var u, i = $e;
            return u = (u = e.match(an)) ? u[1].split(ln) : [], r = i(u, r), (i = r.length) && (u = i - 1, r[u] = (1 < i ? "& " : "") + r[u], r = r.join(2 < i ? ", " : " "), e = e.replace(cn, "{\n/* [wrapped with " + r + "] */\n")),
                t(n, e);
        }
        function Ce(n) { var t = 0, r = 0; return function () { var e = Di(), u = 16 - (e - r); if (r = e, 0 < u) {
            if (800 <= ++t)
                return arguments[0];
        }
        else
            t = 0; return n.apply(T, arguments); }; }
        function De(n, t) { var r = -1, e = n.length, u = e - 1; for (t = t === T ? e : t; ++r < t;) {
            var e = ir(r, u), i = n[e];
            n[e] = n[r], n[r] = i;
        } return n.length = t, n; }
        function Me(n) { if (typeof n == "string" || wu(n))
            return n; var t = n + ""; return "0" == t && 1 / n == -$ ? "-0" : t; }
        function Te(n) { if (null != n) {
            try {
                return ii.call(n);
            }
            catch (n) { }
            return n + "";
        } return ""; }
        function $e(n, t) {
            return r(N, function (r) {
                var e = "_." + r[0];
                t & r[1] && !o(n, e) && n.push(e);
            }), n.sort();
        }
        function Fe(n) { if (n instanceof Ln)
            return n.clone(); var t = new On(n.__wrapped__, n.__chain__); return t.__actions__ = Lr(n.__actions__), t.__index__ = n.__index__, t.__values__ = n.__values__, t; }
        function Ne(n, t, r) { var e = null == n ? 0 : n.length; return e ? (r = null == r ? 0 : ku(r), 0 > r && (r = Li(e + r, 0)), _(n, ye(t, 3), r)) : -1; }
        function Pe(n, t, r) { var e = null == n ? 0 : n.length; if (!e)
            return -1; var u = e - 1; return r !== T && (u = ku(r), u = 0 > r ? Li(e + u, 0) : Ci(u, e - 1)), _(n, ye(t, 3), u, true); }
        function Ze(n) {
            return (null == n ? 0 : n.length) ? wt(n, 1) : [];
        }
        function qe(n) { return n && n.length ? n[0] : T; }
        function Ve(n) { var t = null == n ? 0 : n.length; return t ? n[t - 1] : T; }
        function Ke(n, t) { return n && n.length && t && t.length ? er(n, t) : n; }
        function Ge(n) { return null == n ? n : $i.call(n); }
        function He(n) { if (!n || !n.length)
            return []; var t = 0; return n = i(n, function (n) { if (hu(n))
            return t = Li(n.length, t), true; }), A(t, function (t) { return c(n, b(t)); }); }
        function Je(t, r) { if (!t || !t.length)
            return []; var e = He(t); return null == r ? e : c(e, function (t) { return n(r, T, t); }); }
        function Ye(n) {
            return n = An(n), n.__chain__ = true, n;
        }
        function Qe(n, t) { return t(n); }
        function Xe() { return this; }
        function nu(n, t) { return (ff(n) ? r : uo)(n, ye(t, 3)); }
        function tu(n, t) { return (ff(n) ? e : io)(n, ye(t, 3)); }
        function ru(n, t) { return (ff(n) ? c : Gt)(n, ye(t, 3)); }
        function eu(n, t, r) { return t = r ? T : t, t = n && null == t ? n.length : t, fe(n, 128, T, T, T, T, t); }
        function uu(n, t) { var r; if (typeof t != "function")
            throw new ti("Expected a function"); return n = ku(n), function () { return 0 < --n && (r = t.apply(this, arguments)), 1 >= n && (t = T), r; }; }
        function iu(n, t, r) {
            return t = r ? T : t, n = fe(n, 8, T, T, T, T, T, t), n.placeholder = iu.placeholder,
                n;
        }
        function ou(n, t, r) { return t = r ? T : t, n = fe(n, 16, T, T, T, T, T, t), n.placeholder = ou.placeholder, n; }
        function fu(n, t, r) {
            function e(t) { var r = c, e = a; return c = a = T, _ = t, s = n.apply(e, r); }
            function u(n) { var r = n - p; return n -= _, p === T || r >= t || 0 > r || g && n >= l; }
            function i() { var n = Go(); if (u(n))
                return o(n); var r, e = bo; r = n - _, n = t - (n - p), r = g ? Ci(n, l - r) : n, h = e(i, r); }
            function o(n) { return h = T, d && c ? e(n) : (c = a = T, s); }
            function f() {
                var n = Go(), r = u(n);
                if (c = arguments, a = this, p = n, r) {
                    if (h === T)
                        return _ = n = p, h = bo(i, t), v ? e(n) : s;
                    if (g)
                        return h = bo(i, t), e(p);
                }
                return h === T && (h = bo(i, t)),
                    s;
            }
            var c, a, l, s, h, p, _ = 0, v = false, g = false, d = true;
            if (typeof n != "function")
                throw new ti("Expected a function");
            return t = Su(t) || 0, du(r) && (v = !!r.leading, l = (g = "maxWait" in r) ? Li(Su(r.maxWait) || 0, t) : l, d = "trailing" in r ? !!r.trailing : d), f.cancel = function () { h !== T && lo(h), _ = 0, c = p = a = h = T; }, f.flush = function () { return h === T ? s : o(Go()); }, f;
        }
        function cu(n, t) {
            if (typeof n != "function" || null != t && typeof t != "function")
                throw new ti("Expected a function");
            var r = function () {
                var e = arguments, u = t ? t.apply(this, e) : e[0], i = r.cache;
                return i.has(u) ? i.get(u) : (e = n.apply(this, e),
                    r.cache = i.set(u, e) || i, e);
            };
            return r.cache = new (cu.Cache || Fn), r;
        }
        function au(n) { if (typeof n != "function")
            throw new ti("Expected a function"); return function () { var t = arguments; switch (t.length) {
            case 0: return !n.call(this);
            case 1: return !n.call(this, t[0]);
            case 2: return !n.call(this, t[0], t[1]);
            case 3: return !n.call(this, t[0], t[1], t[2]);
        } return !n.apply(this, t); }; }
        function lu(n, t) { return n === t || n !== n && t !== t; }
        function su(n) { return null != n && gu(n.length) && !_u(n); }
        function hu(n) { return yu(n) && su(n); }
        function pu(n) {
            if (!yu(n))
                return false;
            var t = Ot(n);
            return "[object Error]" == t || "[object DOMException]" == t || typeof n.message == "string" && typeof n.name == "string" && !xu(n);
        }
        function _u(n) { return !!du(n) && (n = Ot(n), "[object Function]" == n || "[object GeneratorFunction]" == n || "[object AsyncFunction]" == n || "[object Proxy]" == n); }
        function vu(n) { return typeof n == "number" && n == ku(n); }
        function gu(n) { return typeof n == "number" && -1 < n && 0 == n % 1 && 9007199254740991 >= n; }
        function du(n) { var t = typeof n; return null != n && ("object" == t || "function" == t); }
        function yu(n) {
            return null != n && typeof n == "object";
        }
        function bu(n) { return typeof n == "number" || yu(n) && "[object Number]" == Ot(n); }
        function xu(n) { return !(!yu(n) || "[object Object]" != Ot(n)) && (n = di(n), null === n || (n = oi.call(n, "constructor") && n.constructor, typeof n == "function" && n instanceof n && ii.call(n) == li)); }
        function ju(n) { return typeof n == "string" || !ff(n) && yu(n) && "[object String]" == Ot(n); }
        function wu(n) { return typeof n == "symbol" || yu(n) && "[object Symbol]" == Ot(n); }
        function mu(n) {
            if (!n)
                return [];
            if (su(n))
                return ju(n) ? M(n) : Lr(n);
            if (wi && n[wi]) {
                n = n[wi]();
                for (var t, r = []; !(t = n.next()).done;)
                    r.push(t.value);
                return r;
            }
            return t = vo(n), ("[object Map]" == t ? W : "[object Set]" == t ? L : Lu)(n);
        }
        function Au(n) { return n ? (n = Su(n), n === $ || n === -$ ? 1.7976931348623157e308 * (0 > n ? -1 : 1) : n === n ? n : 0) : 0 === n ? n : 0; }
        function ku(n) { n = Au(n); var t = n % 1; return n === n ? t ? n - t : n : 0; }
        function Eu(n) { return n ? pt(ku(n), 0, 4294967295) : 0; }
        function Su(n) {
            if (typeof n == "number")
                return n;
            if (wu(n))
                return F;
            if (du(n) && (n = typeof n.valueOf == "function" ? n.valueOf() : n, n = du(n) ? n + "" : n), typeof n != "string")
                return 0 === n ? n : +n;
            n = n.replace(un, "");
            var t = gn.test(n);
            return t || yn.test(n) ? Dn(n.slice(2), t ? 2 : 8) : vn.test(n) ? F : +n;
        }
        function Ou(n) { return Cr(n, Uu(n)); }
        function Iu(n) { return null == n ? "" : yr(n); }
        function Ru(n, t, r) { return n = null == n ? T : Et(n, t), n === T ? r : n; }
        function zu(n, t) { return null != n && we(n, t, zt); }
        function Wu(n) { return su(n) ? qn(n) : Vt(n); }
        function Uu(n) { if (su(n))
            n = qn(n, true);
        else if (du(n)) {
            var t, r = ze(n), e = [];
            for (t in n)
                ("constructor" != t || !r && oi.call(n, t)) && e.push(t);
            n = e;
        }
        else {
            if (t = [], null != n)
                for (r in Qu(n))
                    t.push(r);
            n = t;
        } return n; }
        function Bu(n, t) {
            if (null == n)
                return {};
            var r = c(ve(n), function (n) { return [n]; });
            return t = ye(t), tr(n, r, function (n, r) {
                return t(n, r[0]);
            });
        }
        function Lu(n) { return null == n ? [] : S(n, Wu(n)); }
        function Cu(n) { return $f(Iu(n).toLowerCase()); }
        function Du(n) { return (n = Iu(n)) && n.replace(xn, Xn).replace(Sn, ""); }
        function Mu(n, t, r) { return n = Iu(n), t = r ? T : t, t === T ? zn.test(n) ? n.match(In) || [] : n.match(sn) || [] : n.match(t) || []; }
        function Tu(n) { return function () { return n; }; }
        function $u(n) { return n; }
        function Fu(n) { return qt(typeof n == "function" ? n : _t(n, 1)); }
        function Nu(n, t, e) {
            var u = Wu(t), i = kt(t, u);
            null != e || du(t) && (i.length || !u.length) || (e = t, t = n, n = this, i = kt(t, Wu(t)));
            var o = !(du(e) && "chain" in e && !e.chain), f = _u(n);
            return r(i, function (r) { var e = t[r]; n[r] = e, f && (n.prototype[r] = function () { var t = this.__chain__; if (o || t) {
                var r = n(this.__wrapped__);
                return (r.__actions__ = Lr(this.__actions__)).push({ func: e, args: arguments, thisArg: n }), r.__chain__ = t, r;
            } return e.apply(n, a([this.value()], arguments)); }); }), n;
        }
        function Pu() { }
        function Zu(n) { return Ie(n) ? b(Me(n)) : rr(n); }
        function qu() { return []; }
        function Vu() { return false; }
        mn = null == mn ? $n : rt.defaults($n.Object(), mn, rt.pick($n, Wn));
        var Ku = mn.Array, Gu = mn.Date, Hu = mn.Error, Ju = mn.Function, Yu = mn.Math, Qu = mn.Object, Xu = mn.RegExp, ni = mn.String, ti = mn.TypeError, ri = Ku.prototype, ei = Qu.prototype, ui = mn["__core-js_shared__"], ii = Ju.prototype.toString, oi = ei.hasOwnProperty, fi = 0, ci = function () {
            var n = /[^.]+$/.exec(ui && ui.keys && ui.keys.IE_PROTO || "");
            return n ? "Symbol(src)_1." + n : "";
        }(), ai = ei.toString, li = ii.call(Qu), si = $n._, hi = Xu("^" + ii.call(oi).replace(rn, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"), pi = Pn ? mn.Buffer : T, _i = mn.Symbol, vi = mn.Uint8Array, gi = pi ? pi.allocUnsafe : T, di = U(Qu.getPrototypeOf, Qu), yi = Qu.create, bi = ei.propertyIsEnumerable, xi = ri.splice, ji = _i ? _i.isConcatSpreadable : T, wi = _i ? _i.iterator : T, mi = _i ? _i.toStringTag : T, Ai = function () {
            try {
                var n = je(Qu, "defineProperty");
                return n({}, "", {}), n;
            }
            catch (n) { }
        }(), ki = mn.clearTimeout !== $n.clearTimeout && mn.clearTimeout, Ei = Gu && Gu.now !== $n.Date.now && Gu.now, Si = mn.setTimeout !== $n.setTimeout && mn.setTimeout, Oi = Yu.ceil, Ii = Yu.floor, Ri = Qu.getOwnPropertySymbols, zi = pi ? pi.isBuffer : T, Wi = mn.isFinite, Ui = ri.join, Bi = U(Qu.keys, Qu), Li = Yu.max, Ci = Yu.min, Di = Gu.now, Mi = mn.parseInt, Ti = Yu.random, $i = ri.reverse, Fi = je(mn, "DataView"), Ni = je(mn, "Map"), Pi = je(mn, "Promise"), Zi = je(mn, "Set"), qi = je(mn, "WeakMap"), Vi = je(Qu, "create"), Ki = qi && new qi, Gi = {}, Hi = Te(Fi), Ji = Te(Ni), Yi = Te(Pi), Qi = Te(Zi), Xi = Te(qi), no = _i ? _i.prototype : T, to = no ? no.valueOf : T, ro = no ? no.toString : T, eo = function () {
            function n() { }
            return function (t) { return du(t) ? yi ? yi(t) : (n.prototype = t, t = new n, n.prototype = T, t) : {}; };
        }();
        An.templateSettings = { escape: J, evaluate: Y, interpolate: Q, variable: "", imports: { _: An } }, An.prototype = kn.prototype, An.prototype.constructor = An, On.prototype = eo(kn.prototype), On.prototype.constructor = On, Ln.prototype = eo(kn.prototype), Ln.prototype.constructor = Ln, Mn.prototype.clear = function () { this.__data__ = Vi ? Vi(null) : {}, this.size = 0; }, Mn.prototype.delete = function (n) {
            return n = this.has(n) && delete this.__data__[n],
                this.size -= n ? 1 : 0, n;
        }, Mn.prototype.get = function (n) { var t = this.__data__; return Vi ? (n = t[n], "__lodash_hash_undefined__" === n ? T : n) : oi.call(t, n) ? t[n] : T; }, Mn.prototype.has = function (n) { var t = this.__data__; return Vi ? t[n] !== T : oi.call(t, n); }, Mn.prototype.set = function (n, t) { var r = this.__data__; return this.size += this.has(n) ? 0 : 1, r[n] = Vi && t === T ? "__lodash_hash_undefined__" : t, this; }, Tn.prototype.clear = function () { this.__data__ = [], this.size = 0; }, Tn.prototype.delete = function (n) {
            var t = this.__data__;
            return n = ft(t, n), !(0 > n) && (n == t.length - 1 ? t.pop() : xi.call(t, n, 1),
                --this.size, true);
        }, Tn.prototype.get = function (n) { var t = this.__data__; return n = ft(t, n), 0 > n ? T : t[n][1]; }, Tn.prototype.has = function (n) { return -1 < ft(this.__data__, n); }, Tn.prototype.set = function (n, t) { var r = this.__data__, e = ft(r, n); return 0 > e ? (++this.size, r.push([n, t])) : r[e][1] = t, this; }, Fn.prototype.clear = function () { this.size = 0, this.__data__ = { hash: new Mn, map: new (Ni || Tn), string: new Mn }; }, Fn.prototype.delete = function (n) { return n = be(this, n).delete(n), this.size -= n ? 1 : 0, n; }, Fn.prototype.get = function (n) {
            return be(this, n).get(n);
        }, Fn.prototype.has = function (n) { return be(this, n).has(n); }, Fn.prototype.set = function (n, t) { var r = be(this, n), e = r.size; return r.set(n, t), this.size += r.size == e ? 0 : 1, this; }, Nn.prototype.add = Nn.prototype.push = function (n) { return this.__data__.set(n, "__lodash_hash_undefined__"), this; }, Nn.prototype.has = function (n) { return this.__data__.has(n); }, Zn.prototype.clear = function () { this.__data__ = new Tn, this.size = 0; }, Zn.prototype.delete = function (n) { var t = this.__data__; return n = t.delete(n), this.size = t.size, n; }, Zn.prototype.get = function (n) {
            return this.__data__.get(n);
        }, Zn.prototype.has = function (n) { return this.__data__.has(n); }, Zn.prototype.set = function (n, t) { var r = this.__data__; if (r instanceof Tn) {
            var e = r.__data__;
            if (!Ni || 199 > e.length)
                return e.push([n, t]), this.size = ++r.size, this;
            r = this.__data__ = new Fn(e);
        } return r.set(n, t), this.size = r.size, this; };
        var uo = Fr(mt), io = Fr(At, true), oo = Nr(), fo = Nr(true), co = Ki ? function (n, t) { return Ki.set(n, t), n; } : $u, ao = Ai ? function (n, t) { return Ai(n, "toString", { configurable: true, enumerable: false, value: Tu(t), writable: true }); } : $u, lo = ki || function (n) {
            return $n.clearTimeout(n);
        }, so = Zi && 1 / L(new Zi([, -0]))[1] == $ ? function (n) { return new Zi(n); } : Pu, ho = Ki ? function (n) { return Ki.get(n); } : Pu, po = Ri ? function (n) { return null == n ? [] : (n = Qu(n), i(Ri(n), function (t) { return bi.call(n, t); })); } : qu, _o = Ri ? function (n) { for (var t = []; n;)
            a(t, po(n)), n = di(n); return t; } : qu, vo = Ot;
        (Fi && "[object DataView]" != vo(new Fi(new ArrayBuffer(1))) || Ni && "[object Map]" != vo(new Ni) || Pi && "[object Promise]" != vo(Pi.resolve()) || Zi && "[object Set]" != vo(new Zi) || qi && "[object WeakMap]" != vo(new qi)) && (vo = function (n) {
            var t = Ot(n);
            if (n = (n = "[object Object]" == t ? n.constructor : T) ? Te(n) : "")
                switch (n) {
                    case Hi: return "[object DataView]";
                    case Ji: return "[object Map]";
                    case Yi: return "[object Promise]";
                    case Qi: return "[object Set]";
                    case Xi: return "[object WeakMap]";
                }
            return t;
        });
        var go = ui ? _u : Vu, yo = Ce(co), bo = Si || function (n, t) { return $n.setTimeout(n, t); }, xo = Ce(ao), jo = function (n) { n = cu(n, function (n) { return 500 === t.size && t.clear(), n; }); var t = n.cache; return n; }(function (n) {
            var t = [];
            return 46 === n.charCodeAt(0) && t.push(""), n.replace(tn, function (n, r, e, u) {
                t.push(e ? u.replace(hn, "$1") : r || n);
            }), t;
        }), wo = fr(function (n, t) { return hu(n) ? yt(n, wt(t, 1, hu, true)) : []; }), mo = fr(function (n, t) { var r = Ve(t); return hu(r) && (r = T), hu(n) ? yt(n, wt(t, 1, hu, true), ye(r, 2)) : []; }), Ao = fr(function (n, t) { var r = Ve(t); return hu(r) && (r = T), hu(n) ? yt(n, wt(t, 1, hu, true), T, r) : []; }), ko = fr(function (n) { var t = c(n, kr); return t.length && t[0] === n[0] ? Wt(t) : []; }), Eo = fr(function (n) { var t = Ve(n), r = c(n, kr); return t === Ve(r) ? t = T : r.pop(), r.length && r[0] === n[0] ? Wt(r, ye(t, 2)) : []; }), So = fr(function (n) {
            var t = Ve(n), r = c(n, kr);
            return (t = typeof t == "function" ? t : T) && r.pop(),
                r.length && r[0] === n[0] ? Wt(r, T, t) : [];
        }), Oo = fr(Ke), Io = pe(function (n, t) { var r = null == n ? 0 : n.length, e = ht(n, t); return ur(n, c(t, function (n) { return Se(n, r) ? +n : n; }).sort(Wr)), e; }), Ro = fr(function (n) { return br(wt(n, 1, hu, true)); }), zo = fr(function (n) { var t = Ve(n); return hu(t) && (t = T), br(wt(n, 1, hu, true), ye(t, 2)); }), Wo = fr(function (n) { var t = Ve(n), t = typeof t == "function" ? t : T; return br(wt(n, 1, hu, true), T, t); }), Uo = fr(function (n, t) { return hu(n) ? yt(n, t) : []; }), Bo = fr(function (n) { return mr(i(n, hu)); }), Lo = fr(function (n) {
            var t = Ve(n);
            return hu(t) && (t = T),
                mr(i(n, hu), ye(t, 2));
        }), Co = fr(function (n) { var t = Ve(n), t = typeof t == "function" ? t : T; return mr(i(n, hu), T, t); }), Do = fr(He), Mo = fr(function (n) { var t = n.length, t = 1 < t ? n[t - 1] : T, t = typeof t == "function" ? (n.pop(), t) : T; return Je(n, t); }), To = pe(function (n) {
            var t = n.length, r = t ? n[0] : 0, e = this.__wrapped__, u = function (t) { return ht(t, n); };
            return !(1 < t || this.__actions__.length) && e instanceof Ln && Se(r) ? (e = e.slice(r, +r + (t ? 1 : 0)), e.__actions__.push({ func: Qe, args: [u], thisArg: T }), new On(e, this.__chain__).thru(function (n) {
                return t && !n.length && n.push(T),
                    n;
            })) : this.thru(u);
        }), $o = Tr(function (n, t, r) { oi.call(n, r) ? ++n[r] : st(n, r, 1); }), Fo = Gr(Ne), No = Gr(Pe), Po = Tr(function (n, t, r) { oi.call(n, r) ? n[r].push(t) : st(n, r, [t]); }), Zo = fr(function (t, r, e) { var u = -1, i = typeof r == "function", o = su(t) ? Ku(t.length) : []; return uo(t, function (t) { o[++u] = i ? n(r, t, e) : Bt(t, r, e); }), o; }), qo = Tr(function (n, t, r) { st(n, r, t); }), Vo = Tr(function (n, t, r) { n[r ? 0 : 1].push(t); }, function () { return [[], []]; }), Ko = fr(function (n, t) {
            if (null == n)
                return [];
            var r = t.length;
            return 1 < r && Oe(n, t[0], t[1]) ? t = [] : 2 < r && Oe(t[0], t[1], t[2]) && (t = [t[0]]),
                Xt(n, wt(t, 1), []);
        }), Go = Ei || function () { return $n.Date.now(); }, Ho = fr(function (n, t, r) { var e = 1; if (r.length)
            var u = B(r, de(Ho)), e = 32 | e; return fe(n, e, t, r, u); }), Jo = fr(function (n, t, r) { var e = 3; if (r.length)
            var u = B(r, de(Jo)), e = 32 | e; return fe(t, e, n, r, u); }), Yo = fr(function (n, t) { return dt(n, 1, t); }), Qo = fr(function (n, t, r) { return dt(n, Su(t) || 0, r); });
        cu.Cache = Fn;
        var Xo = fr(function (t, r) {
            r = 1 == r.length && ff(r[0]) ? c(r[0], E(ye())) : c(wt(r, 1), E(ye()));
            var e = r.length;
            return fr(function (u) {
                for (var i = -1, o = Ci(u.length, e); ++i < o;)
                    u[i] = r[i].call(this, u[i]);
                return n(t, this, u);
            });
        }), nf = fr(function (n, t) { return fe(n, 32, T, t, B(t, de(nf))); }), tf = fr(function (n, t) { return fe(n, 64, T, t, B(t, de(tf))); }), rf = pe(function (n, t) { return fe(n, 256, T, T, T, t); }), ef = ee(It), uf = ee(function (n, t) { return n >= t; }), of = Lt(function () { return arguments; }()) ? Lt : function (n) { return yu(n) && oi.call(n, "callee") && !bi.call(n, "callee"); }, ff = Ku.isArray, cf = Vn ? E(Vn) : Ct, af = zi || Vu, lf = Kn ? E(Kn) : Dt, sf = Gn ? E(Gn) : Tt, hf = Hn ? E(Hn) : Nt, pf = Jn ? E(Jn) : Pt, _f = Yn ? E(Yn) : Zt, vf = ee(Kt), gf = ee(function (n, t) { return n <= t; }), df = $r(function (n, t) {
            if (ze(t) || su(t))
                Cr(t, Wu(t), n);
            else
                for (var r in t)
                    oi.call(t, r) && ot(n, r, t[r]);
        }), yf = $r(function (n, t) { Cr(t, Uu(t), n); }), bf = $r(function (n, t, r, e) { Cr(t, Uu(t), n, e); }), xf = $r(function (n, t, r, e) { Cr(t, Wu(t), n, e); }), jf = pe(ht), wf = fr(function (n, t) { n = Qu(n); var r = -1, e = t.length, u = 2 < e ? t[2] : T; for (u && Oe(t[0], t[1], u) && (e = 1); ++r < e;)
            for (var u = t[r], i = Uu(u), o = -1, f = i.length; ++o < f;) {
                var c = i[o], a = n[c];
                (a === T || lu(a, ei[c]) && !oi.call(n, c)) && (n[c] = u[c]);
            } return n; }), mf = fr(function (t) { return t.push(T, ae), n(Of, T, t); }), Af = Yr(function (n, t, r) {
            null != t && typeof t.toString != "function" && (t = ai.call(t)), n[t] = r;
        }, Tu($u)), kf = Yr(function (n, t, r) { null != t && typeof t.toString != "function" && (t = ai.call(t)), oi.call(n, t) ? n[t].push(r) : n[t] = [r]; }, ye), Ef = fr(Bt), Sf = $r(function (n, t, r) { Yt(n, t, r); }), Of = $r(function (n, t, r, e) { Yt(n, t, r, e); }), If = pe(function (n, t) { var r = {}; if (null == n)
            return r; var e = false; t = c(t, function (t) { return t = Sr(t, n), e || (e = 1 < t.length), t; }), Cr(n, ve(n), r), e && (r = _t(r, 7, le)); for (var u = t.length; u--;)
            xr(r, t[u]); return r; }), Rf = pe(function (n, t) {
            return null == n ? {} : nr(n, t);
        }), zf = oe(Wu), Wf = oe(Uu), Uf = qr(function (n, t, r) { return t = t.toLowerCase(), n + (r ? Cu(t) : t); }), Bf = qr(function (n, t, r) { return n + (r ? "-" : "") + t.toLowerCase(); }), Lf = qr(function (n, t, r) { return n + (r ? " " : "") + t.toLowerCase(); }), Cf = Zr("toLowerCase"), Df = qr(function (n, t, r) { return n + (r ? "_" : "") + t.toLowerCase(); }), Mf = qr(function (n, t, r) { return n + (r ? " " : "") + $f(t); }), Tf = qr(function (n, t, r) { return n + (r ? " " : "") + t.toUpperCase(); }), $f = Zr("toUpperCase"), Ff = fr(function (t, r) { try {
            return n(t, T, r);
        }
        catch (n) {
            return pu(n) ? n : new Hu(n);
        } }), Nf = pe(function (n, t) {
            return r(t, function (t) { t = Me(t), st(n, t, Ho(n[t], n)); }), n;
        }), Pf = Hr(), Zf = Hr(true), qf = fr(function (n, t) { return function (r) { return Bt(r, n, t); }; }), Vf = fr(function (n, t) { return function (r) { return Bt(n, r, t); }; }), Kf = Xr(c), Gf = Xr(u), Hf = Xr(h), Jf = re(), Yf = re(true), Qf = Qr(function (n, t) { return n + t; }, 0), Xf = ie("ceil"), nc = Qr(function (n, t) { return n / t; }, 1), tc = ie("floor"), rc = Qr(function (n, t) { return n * t; }, 1), ec = ie("round"), uc = Qr(function (n, t) { return n - t; }, 0);
        return An.after = function (n, t) {
            if (typeof t != "function")
                throw new ti("Expected a function");
            return n = ku(n), function () { if (1 > --n)
                return t.apply(this, arguments); };
        }, An.ary = eu, An.assign = df, An.assignIn = yf, An.assignInWith = bf, An.assignWith = xf, An.at = jf, An.before = uu, An.bind = Ho, An.bindAll = Nf, An.bindKey = Jo, An.castArray = function () { if (!arguments.length)
            return []; var n = arguments[0]; return ff(n) ? n : [n]; }, An.chain = Ye, An.chunk = function (n, t, r) { if (t = (r ? Oe(n, t, r) : t === T) ? 1 : Li(ku(t), 0), r = null == n ? 0 : n.length, !r || 1 > t)
            return []; for (var e = 0, u = 0, i = Ku(Oi(r / t)); e < r;)
            i[u++] = hr(n, e, e += t); return i; }, An.compact = function (n) {
            for (var t = -1, r = null == n ? 0 : n.length, e = 0, u = []; ++t < r;) {
                var i = n[t];
                i && (u[e++] = i);
            }
            return u;
        }, An.concat = function () { var n = arguments.length; if (!n)
            return []; for (var t = Ku(n - 1), r = arguments[0]; n--;)
            t[n - 1] = arguments[n]; return a(ff(r) ? Lr(r) : [r], wt(t, 1)); }, An.cond = function (t) { var r = null == t ? 0 : t.length, e = ye(); return t = r ? c(t, function (n) { if ("function" != typeof n[1])
            throw new ti("Expected a function"); return [e(n[0]), n[1]]; }) : [], fr(function (e) { for (var u = -1; ++u < r;) {
            var i = t[u];
            if (n(i[0], this, e))
                return n(i[1], this, e);
        } }); }, An.conforms = function (n) { return vt(_t(n, 1)); }, An.constant = Tu,
            An.countBy = $o, An.create = function (n, t) { var r = eo(n); return null == t ? r : at(r, t); }, An.curry = iu, An.curryRight = ou, An.debounce = fu, An.defaults = wf, An.defaultsDeep = mf, An.defer = Yo, An.delay = Qo, An.difference = wo, An.differenceBy = mo, An.differenceWith = Ao, An.drop = function (n, t, r) { var e = null == n ? 0 : n.length; return e ? (t = r || t === T ? 1 : ku(t), hr(n, 0 > t ? 0 : t, e)) : []; }, An.dropRight = function (n, t, r) { var e = null == n ? 0 : n.length; return e ? (t = r || t === T ? 1 : ku(t), t = e - t, hr(n, 0, 0 > t ? 0 : t)) : []; }, An.dropRightWhile = function (n, t) {
            return n && n.length ? jr(n, ye(t, 3), true, true) : [];
        }, An.dropWhile = function (n, t) { return n && n.length ? jr(n, ye(t, 3), true) : []; }, An.fill = function (n, t, r, e) { var u = null == n ? 0 : n.length; if (!u)
            return []; for (r && typeof r != "number" && Oe(n, t, r) && (r = 0, e = u), u = n.length, r = ku(r), 0 > r && (r = -r > u ? 0 : u + r), e = e === T || e > u ? u : ku(e), 0 > e && (e += u), e = r > e ? 0 : Eu(e); r < e;)
            n[r++] = t; return n; }, An.filter = function (n, t) { return (ff(n) ? i : jt)(n, ye(t, 3)); }, An.flatMap = function (n, t) { return wt(ru(n, t), 1); }, An.flatMapDeep = function (n, t) { return wt(ru(n, t), $); }, An.flatMapDepth = function (n, t, r) {
            return r = r === T ? 1 : ku(r),
                wt(ru(n, t), r);
        }, An.flatten = Ze, An.flattenDeep = function (n) { return (null == n ? 0 : n.length) ? wt(n, $) : []; }, An.flattenDepth = function (n, t) { return null != n && n.length ? (t = t === T ? 1 : ku(t), wt(n, t)) : []; }, An.flip = function (n) { return fe(n, 512); }, An.flow = Pf, An.flowRight = Zf, An.fromPairs = function (n) { for (var t = -1, r = null == n ? 0 : n.length, e = {}; ++t < r;) {
            var u = n[t];
            e[u[0]] = u[1];
        } return e; }, An.functions = function (n) { return null == n ? [] : kt(n, Wu(n)); }, An.functionsIn = function (n) { return null == n ? [] : kt(n, Uu(n)); }, An.groupBy = Po, An.initial = function (n) {
            return (null == n ? 0 : n.length) ? hr(n, 0, -1) : [];
        }, An.intersection = ko, An.intersectionBy = Eo, An.intersectionWith = So, An.invert = Af, An.invertBy = kf, An.invokeMap = Zo, An.iteratee = Fu, An.keyBy = qo, An.keys = Wu, An.keysIn = Uu, An.map = ru, An.mapKeys = function (n, t) { var r = {}; return t = ye(t, 3), mt(n, function (n, e, u) { st(r, t(n, e, u), n); }), r; }, An.mapValues = function (n, t) { var r = {}; return t = ye(t, 3), mt(n, function (n, e, u) { st(r, e, t(n, e, u)); }), r; }, An.matches = function (n) { return Ht(_t(n, 1)); }, An.matchesProperty = function (n, t) { return Jt(n, _t(t, 1)); }, An.memoize = cu,
            An.merge = Sf, An.mergeWith = Of, An.method = qf, An.methodOf = Vf, An.mixin = Nu, An.negate = au, An.nthArg = function (n) { return n = ku(n), fr(function (t) { return Qt(t, n); }); }, An.omit = If, An.omitBy = function (n, t) { return Bu(n, au(ye(t))); }, An.once = function (n) { return uu(2, n); }, An.orderBy = function (n, t, r, e) { return null == n ? [] : (ff(t) || (t = null == t ? [] : [t]), r = e ? T : r, ff(r) || (r = null == r ? [] : [r]), Xt(n, t, r)); }, An.over = Kf, An.overArgs = Xo, An.overEvery = Gf, An.overSome = Hf, An.partial = nf, An.partialRight = tf, An.partition = Vo, An.pick = Rf, An.pickBy = Bu, An.property = Zu,
            An.propertyOf = function (n) { return function (t) { return null == n ? T : Et(n, t); }; }, An.pull = Oo, An.pullAll = Ke, An.pullAllBy = function (n, t, r) { return n && n.length && t && t.length ? er(n, t, ye(r, 2)) : n; }, An.pullAllWith = function (n, t, r) { return n && n.length && t && t.length ? er(n, t, T, r) : n; }, An.pullAt = Io, An.range = Jf, An.rangeRight = Yf, An.rearg = rf, An.reject = function (n, t) { return (ff(n) ? i : jt)(n, au(ye(t, 3))); }, An.remove = function (n, t) {
            var r = [];
            if (!n || !n.length)
                return r;
            var e = -1, u = [], i = n.length;
            for (t = ye(t, 3); ++e < i;) {
                var o = n[e];
                t(o, e, n) && (r.push(o),
                    u.push(e));
            }
            return ur(n, u), r;
        }, An.rest = function (n, t) { if (typeof n != "function")
            throw new ti("Expected a function"); return t = t === T ? t : ku(t), fr(n, t); }, An.reverse = Ge, An.sampleSize = function (n, t, r) { return t = (r ? Oe(n, t, r) : t === T) ? 1 : ku(t), (ff(n) ? et : ar)(n, t); }, An.set = function (n, t, r) { return null == n ? n : lr(n, t, r); }, An.setWith = function (n, t, r, e) { return e = typeof e == "function" ? e : T, null == n ? n : lr(n, t, r, e); }, An.shuffle = function (n) { return (ff(n) ? ut : sr)(n); }, An.slice = function (n, t, r) {
            var e = null == n ? 0 : n.length;
            return e ? (r && typeof r != "number" && Oe(n, t, r) ? (t = 0,
                r = e) : (t = null == t ? 0 : ku(t), r = r === T ? e : ku(r)), hr(n, t, r)) : [];
        }, An.sortBy = Ko, An.sortedUniq = function (n) { return n && n.length ? gr(n) : []; }, An.sortedUniqBy = function (n, t) { return n && n.length ? gr(n, ye(t, 2)) : []; }, An.split = function (n, t, r) { return r && typeof r != "number" && Oe(n, t, r) && (t = r = T), r = r === T ? 4294967295 : r >>> 0, r ? (n = Iu(n)) && (typeof t == "string" || null != t && !hf(t)) && (t = yr(t), !t && Rn.test(n)) ? Or(M(n), 0, r) : n.split(t, r) : []; }, An.spread = function (t, r) {
            if (typeof t != "function")
                throw new ti("Expected a function");
            return r = null == r ? 0 : Li(ku(r), 0),
                fr(function (e) { var u = e[r]; return e = Or(e, 0, r), u && a(e, u), n(t, this, e); });
        }, An.tail = function (n) { var t = null == n ? 0 : n.length; return t ? hr(n, 1, t) : []; }, An.take = function (n, t, r) { return n && n.length ? (t = r || t === T ? 1 : ku(t), hr(n, 0, 0 > t ? 0 : t)) : []; }, An.takeRight = function (n, t, r) { var e = null == n ? 0 : n.length; return e ? (t = r || t === T ? 1 : ku(t), t = e - t, hr(n, 0 > t ? 0 : t, e)) : []; }, An.takeRightWhile = function (n, t) { return n && n.length ? jr(n, ye(t, 3), false, true) : []; }, An.takeWhile = function (n, t) { return n && n.length ? jr(n, ye(t, 3)) : []; }, An.tap = function (n, t) {
            return t(n),
                n;
        }, An.throttle = function (n, t, r) { var e = true, u = true; if (typeof n != "function")
            throw new ti("Expected a function"); return du(r) && (e = "leading" in r ? !!r.leading : e, u = "trailing" in r ? !!r.trailing : u), fu(n, t, { leading: e, maxWait: t, trailing: u }); }, An.thru = Qe, An.toArray = mu, An.toPairs = zf, An.toPairsIn = Wf, An.toPath = function (n) { return ff(n) ? c(n, Me) : wu(n) ? [n] : Lr(jo(Iu(n))); }, An.toPlainObject = Ou, An.transform = function (n, t, e) {
            var u = ff(n), i = u || af(n) || _f(n);
            if (t = ye(t, 4), null == e) {
                var o = n && n.constructor;
                e = i ? u ? new o : [] : du(n) && _u(o) ? eo(di(n)) : {};
            }
            return (i ? r : mt)(n, function (n, r, u) { return t(e, n, r, u); }), e;
        }, An.unary = function (n) { return eu(n, 1); }, An.union = Ro, An.unionBy = zo, An.unionWith = Wo, An.uniq = function (n) { return n && n.length ? br(n) : []; }, An.uniqBy = function (n, t) { return n && n.length ? br(n, ye(t, 2)) : []; }, An.uniqWith = function (n, t) { return t = typeof t == "function" ? t : T, n && n.length ? br(n, T, t) : []; }, An.unset = function (n, t) { return null == n || xr(n, t); }, An.unzip = He, An.unzipWith = Je, An.update = function (n, t, r) { return null != n && (r = Er(r), n = lr(n, t, r(Et(n, t)), void 0)), n; }, An.updateWith = function (n, t, r, e) {
            return e = typeof e == "function" ? e : T, null != n && (r = Er(r), n = lr(n, t, r(Et(n, t)), e)), n;
        }, An.values = Lu, An.valuesIn = function (n) { return null == n ? [] : S(n, Uu(n)); }, An.without = Uo, An.words = Mu, An.wrap = function (n, t) { return nf(Er(t), n); }, An.xor = Bo, An.xorBy = Lo, An.xorWith = Co, An.zip = Do, An.zipObject = function (n, t) { return Ar(n || [], t || [], ot); }, An.zipObjectDeep = function (n, t) { return Ar(n || [], t || [], lr); }, An.zipWith = Mo, An.entries = zf, An.entriesIn = Wf, An.extend = yf, An.extendWith = bf, Nu(An, An), An.add = Qf, An.attempt = Ff, An.camelCase = Uf, An.capitalize = Cu,
            An.ceil = Xf, An.clamp = function (n, t, r) { return r === T && (r = t, t = T), r !== T && (r = Su(r), r = r === r ? r : 0), t !== T && (t = Su(t), t = t === t ? t : 0), pt(Su(n), t, r); }, An.clone = function (n) { return _t(n, 4); }, An.cloneDeep = function (n) { return _t(n, 5); }, An.cloneDeepWith = function (n, t) { return t = typeof t == "function" ? t : T, _t(n, 5, t); }, An.cloneWith = function (n, t) { return t = typeof t == "function" ? t : T, _t(n, 4, t); }, An.conformsTo = function (n, t) { return null == t || gt(n, t, Wu(t)); }, An.deburr = Du, An.defaultTo = function (n, t) { return null == n || n !== n ? t : n; }, An.divide = nc, An.endsWith = function (n, t, r) {
            n = Iu(n), t = yr(t);
            var e = n.length, e = r = r === T ? e : pt(ku(r), 0, e);
            return r -= t.length, 0 <= r && n.slice(r, e) == t;
        }, An.eq = lu, An.escape = function (n) { return (n = Iu(n)) && H.test(n) ? n.replace(K, nt) : n; }, An.escapeRegExp = function (n) { return (n = Iu(n)) && en.test(n) ? n.replace(rn, "\\$&") : n; }, An.every = function (n, t, r) { var e = ff(n) ? u : bt; return r && Oe(n, t, r) && (t = T), e(n, ye(t, 3)); }, An.find = Fo, An.findIndex = Ne, An.findKey = function (n, t) { return p(n, ye(t, 3), mt); }, An.findLast = No, An.findLastIndex = Pe, An.findLastKey = function (n, t) {
            return p(n, ye(t, 3), At);
        }, An.floor = tc, An.forEach = nu, An.forEachRight = tu, An.forIn = function (n, t) { return null == n ? n : oo(n, ye(t, 3), Uu); }, An.forInRight = function (n, t) { return null == n ? n : fo(n, ye(t, 3), Uu); }, An.forOwn = function (n, t) { return n && mt(n, ye(t, 3)); }, An.forOwnRight = function (n, t) { return n && At(n, ye(t, 3)); }, An.get = Ru, An.gt = ef, An.gte = uf, An.has = function (n, t) { return null != n && we(n, t, Rt); }, An.hasIn = zu, An.head = qe, An.identity = $u, An.includes = function (n, t, r, e) {
            return n = su(n) ? n : Lu(n), r = r && !e ? ku(r) : 0, e = n.length, 0 > r && (r = Li(e + r, 0)), ju(n) ? r <= e && -1 < n.indexOf(t, r) : !!e && -1 < v(n, t, r);
        }, An.indexOf = function (n, t, r) { var e = null == n ? 0 : n.length; return e ? (r = null == r ? 0 : ku(r), 0 > r && (r = Li(e + r, 0)), v(n, t, r)) : -1; }, An.inRange = function (n, t, r) { return t = Au(t), r === T ? (r = t, t = 0) : r = Au(r), n = Su(n), n >= Ci(t, r) && n < Li(t, r); }, An.invoke = Ef, An.isArguments = of, An.isArray = ff, An.isArrayBuffer = cf, An.isArrayLike = su, An.isArrayLikeObject = hu, An.isBoolean = function (n) { return true === n || false === n || yu(n) && "[object Boolean]" == Ot(n); }, An.isBuffer = af, An.isDate = lf, An.isElement = function (n) { return yu(n) && 1 === n.nodeType && !xu(n); }, An.isEmpty = function (n) {
            if (null == n)
                return true;
            if (su(n) && (ff(n) || typeof n == "string" || typeof n.splice == "function" || af(n) || _f(n) || of(n)))
                return !n.length;
            var t = vo(n);
            if ("[object Map]" == t || "[object Set]" == t)
                return !n.size;
            if (ze(n))
                return !Vt(n).length;
            for (var r in n)
                if (oi.call(n, r))
                    return false;
            return true;
        }, An.isEqual = function (n, t) { return Mt(n, t); }, An.isEqualWith = function (n, t, r) { var e = (r = typeof r == "function" ? r : T) ? r(n, t) : T; return e === T ? Mt(n, t, T, r) : !!e; }, An.isError = pu, An.isFinite = function (n) { return typeof n == "number" && Wi(n); }, An.isFunction = _u,
            An.isInteger = vu, An.isLength = gu, An.isMap = sf, An.isMatch = function (n, t) { return n === t || $t(n, t, xe(t)); }, An.isMatchWith = function (n, t, r) { return r = typeof r == "function" ? r : T, $t(n, t, xe(t), r); }, An.isNaN = function (n) { return bu(n) && n != +n; }, An.isNative = function (n) { if (go(n))
            throw new Hu("Unsupported core-js use. Try https://npms.io/search?q=ponyfill."); return Ft(n); }, An.isNil = function (n) { return null == n; }, An.isNull = function (n) { return null === n; }, An.isNumber = bu, An.isObject = du, An.isObjectLike = yu, An.isPlainObject = xu, An.isRegExp = hf,
            An.isSafeInteger = function (n) { return vu(n) && -9007199254740991 <= n && 9007199254740991 >= n; }, An.isSet = pf, An.isString = ju, An.isSymbol = wu, An.isTypedArray = _f, An.isUndefined = function (n) { return n === T; }, An.isWeakMap = function (n) { return yu(n) && "[object WeakMap]" == vo(n); }, An.isWeakSet = function (n) { return yu(n) && "[object WeakSet]" == Ot(n); }, An.join = function (n, t) { return null == n ? "" : Ui.call(n, t); }, An.kebabCase = Bf, An.last = Ve, An.lastIndexOf = function (n, t, r) {
            var e = null == n ? 0 : n.length;
            if (!e)
                return -1;
            var u = e;
            if (r !== T && (u = ku(r), u = 0 > u ? Li(e + u, 0) : Ci(u, e - 1)),
                t === t)
                n: {
                    for (r = u + 1; r--;)
                        if (n[r] === t) {
                            n = r;
                            break n;
                        }
                    n = r;
                }
            else
                n = _(n, d, u, true);
            return n;
        }, An.lowerCase = Lf, An.lowerFirst = Cf, An.lt = vf, An.lte = gf, An.max = function (n) { return n && n.length ? xt(n, $u, It) : T; }, An.maxBy = function (n, t) { return n && n.length ? xt(n, ye(t, 2), It) : T; }, An.mean = function (n) { return y(n, $u); }, An.meanBy = function (n, t) { return y(n, ye(t, 2)); }, An.min = function (n) { return n && n.length ? xt(n, $u, Kt) : T; }, An.minBy = function (n, t) { return n && n.length ? xt(n, ye(t, 2), Kt) : T; }, An.stubArray = qu, An.stubFalse = Vu, An.stubObject = function () {
            return {};
        }, An.stubString = function () { return ""; }, An.stubTrue = function () { return true; }, An.multiply = rc, An.nth = function (n, t) { return n && n.length ? Qt(n, ku(t)) : T; }, An.noConflict = function () { return $n._ === this && ($n._ = si), this; }, An.noop = Pu, An.now = Go, An.pad = function (n, t, r) { n = Iu(n); var e = (t = ku(t)) ? D(n) : 0; return !t || e >= t ? n : (t = (t - e) / 2, ne(Ii(t), r) + n + ne(Oi(t), r)); }, An.padEnd = function (n, t, r) { n = Iu(n); var e = (t = ku(t)) ? D(n) : 0; return t && e < t ? n + ne(t - e, r) : n; }, An.padStart = function (n, t, r) {
            n = Iu(n);
            var e = (t = ku(t)) ? D(n) : 0;
            return t && e < t ? ne(t - e, r) + n : n;
        }, An.parseInt = function (n, t, r) { return r || null == t ? t = 0 : t && (t = +t), Mi(Iu(n).replace(on, ""), t || 0); }, An.random = function (n, t, r) { if (r && typeof r != "boolean" && Oe(n, t, r) && (t = r = T), r === T && (typeof t == "boolean" ? (r = t, t = T) : typeof n == "boolean" && (r = n, n = T)), n === T && t === T ? (n = 0, t = 1) : (n = Au(n), t === T ? (t = n, n = 0) : t = Au(t)), n > t) {
            var e = n;
            n = t, t = e;
        } return r || n % 1 || t % 1 ? (r = Ti(), Ci(n + r * (t - n + Cn("1e-" + ((r + "").length - 1))), t)) : ir(n, t); }, An.reduce = function (n, t, r) { var e = ff(n) ? l : j, u = 3 > arguments.length; return e(n, ye(t, 4), r, u, uo); }, An.reduceRight = function (n, t, r) {
            var e = ff(n) ? s : j, u = 3 > arguments.length;
            return e(n, ye(t, 4), r, u, io);
        }, An.repeat = function (n, t, r) { return t = (r ? Oe(n, t, r) : t === T) ? 1 : ku(t), or(Iu(n), t); }, An.replace = function () { var n = arguments, t = Iu(n[0]); return 3 > n.length ? t : t.replace(n[1], n[2]); }, An.result = function (n, t, r) { t = Sr(t, n); var e = -1, u = t.length; for (u || (u = 1, n = T); ++e < u;) {
            var i = null == n ? T : n[Me(t[e])];
            i === T && (e = u, i = r), n = _u(i) ? i.call(n) : i;
        } return n; }, An.round = ec, An.runInContext = x, An.sample = function (n) { return (ff(n) ? Qn : cr)(n); }, An.size = function (n) {
            if (null == n)
                return 0;
            if (su(n))
                return ju(n) ? D(n) : n.length;
            var t = vo(n);
            return "[object Map]" == t || "[object Set]" == t ? n.size : Vt(n).length;
        }, An.snakeCase = Df, An.some = function (n, t, r) { var e = ff(n) ? h : pr; return r && Oe(n, t, r) && (t = T), e(n, ye(t, 3)); }, An.sortedIndex = function (n, t) { return _r(n, t); }, An.sortedIndexBy = function (n, t, r) { return vr(n, t, ye(r, 2)); }, An.sortedIndexOf = function (n, t) { var r = null == n ? 0 : n.length; if (r) {
            var e = _r(n, t);
            if (e < r && lu(n[e], t))
                return e;
        } return -1; }, An.sortedLastIndex = function (n, t) { return _r(n, t, true); }, An.sortedLastIndexBy = function (n, t, r) {
            return vr(n, t, ye(r, 2), true);
        }, An.sortedLastIndexOf = function (n, t) { if (null == n ? 0 : n.length) {
            var r = _r(n, t, true) - 1;
            if (lu(n[r], t))
                return r;
        } return -1; }, An.startCase = Mf, An.startsWith = function (n, t, r) { return n = Iu(n), r = null == r ? 0 : pt(ku(r), 0, n.length), t = yr(t), n.slice(r, r + t.length) == t; }, An.subtract = uc, An.sum = function (n) { return n && n.length ? m(n, $u) : 0; }, An.sumBy = function (n, t) { return n && n.length ? m(n, ye(t, 2)) : 0; }, An.template = function (n, t, r) {
            var e = An.templateSettings;
            r && Oe(n, t, r) && (t = T), n = Iu(n), t = bf({}, t, e, ce), r = bf({}, t.imports, e.imports, ce);
            var u, i, o = Wu(r), f = S(r, o), c = 0;
            r = t.interpolate || jn;
            var a = "__p+='";
            r = Xu((t.escape || jn).source + "|" + r.source + "|" + (r === Q ? pn : jn).source + "|" + (t.evaluate || jn).source + "|$", "g");
            var l = "sourceURL" in t ? "//# sourceURL=" + t.sourceURL + "\n" : "";
            if (n.replace(r, function (t, r, e, o, f, l) { return e || (e = o), a += n.slice(c, l).replace(wn, z), r && (u = true, a += "'+__e(" + r + ")+'"), f && (i = true, a += "';" + f + ";\n__p+='"), e && (a += "'+((__t=(" + e + "))==null?'':__t)+'"), c = l + t.length, t; }), a += "';", (t = t.variable) || (a = "with(obj){" + a + "}"), a = (i ? a.replace(P, "") : a).replace(Z, "$1").replace(q, "$1;"),
                a = "function(" + (t || "obj") + "){" + (t ? "" : "obj||(obj={});") + "var __t,__p=''" + (u ? ",__e=_.escape" : "") + (i ? ",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}" : ";") + a + "return __p}", t = Ff(function () { return Ju(o, l + "return " + a).apply(T, f); }), t.source = a, pu(t))
                throw t;
            return t;
        }, An.times = function (n, t) { if (n = ku(n), 1 > n || 9007199254740991 < n)
            return []; var r = 4294967295, e = Ci(n, 4294967295); for (t = ye(t), n -= 4294967295, e = A(e, t); ++r < n;)
            t(r); return e; }, An.toFinite = Au, An.toInteger = ku, An.toLength = Eu, An.toLower = function (n) {
            return Iu(n).toLowerCase();
        }, An.toNumber = Su, An.toSafeInteger = function (n) { return n ? pt(ku(n), -9007199254740991, 9007199254740991) : 0 === n ? n : 0; }, An.toString = Iu, An.toUpper = function (n) { return Iu(n).toUpperCase(); }, An.trim = function (n, t, r) { return (n = Iu(n)) && (r || t === T) ? n.replace(un, "") : n && (t = yr(t)) ? (n = M(n), r = M(t), t = I(n, r), r = R(n, r) + 1, Or(n, t, r).join("")) : n; }, An.trimEnd = function (n, t, r) { return (n = Iu(n)) && (r || t === T) ? n.replace(fn, "") : n && (t = yr(t)) ? (n = M(n), t = R(n, M(t)) + 1, Or(n, 0, t).join("")) : n; }, An.trimStart = function (n, t, r) {
            return (n = Iu(n)) && (r || t === T) ? n.replace(on, "") : n && (t = yr(t)) ? (n = M(n), t = I(n, M(t)), Or(n, t).join("")) : n;
        }, An.truncate = function (n, t) {
            var r = 30, e = "...";
            if (du(t))
                var u = "separator" in t ? t.separator : u, r = "length" in t ? ku(t.length) : r, e = "omission" in t ? yr(t.omission) : e;
            n = Iu(n);
            var i = n.length;
            if (Rn.test(n))
                var o = M(n), i = o.length;
            if (r >= i)
                return n;
            if (i = r - D(e), 1 > i)
                return e;
            if (r = o ? Or(o, 0, i).join("") : n.slice(0, i), u === T)
                return r + e;
            if (o && (i += r.length - i), hf(u)) {
                if (n.slice(i).search(u)) {
                    var f = r;
                    for (u.global || (u = Xu(u.source, Iu(_n.exec(u)) + "g")),
                        u.lastIndex = 0; o = u.exec(f);)
                        var c = o.index;
                    r = r.slice(0, c === T ? i : c);
                }
            }
            else
                n.indexOf(yr(u), i) != i && (u = r.lastIndexOf(u), -1 < u && (r = r.slice(0, u)));
            return r + e;
        }, An.unescape = function (n) { return (n = Iu(n)) && G.test(n) ? n.replace(V, tt) : n; }, An.uniqueId = function (n) { var t = ++fi; return Iu(n) + t; }, An.upperCase = Tf, An.upperFirst = $f, An.each = nu, An.eachRight = tu, An.first = qe, Nu(An, function () { var n = {}; return mt(An, function (t, r) { oi.call(An.prototype, r) || (n[r] = t); }), n; }(), { chain: false }), An.VERSION = "4.17.11", r("bind bindKey curry curryRight partial partialRight".split(" "), function (n) {
            An[n].placeholder = An;
        }), r(["drop", "take"], function (n, t) { Ln.prototype[n] = function (r) { r = r === T ? 1 : Li(ku(r), 0); var e = this.__filtered__ && !t ? new Ln(this) : this.clone(); return e.__filtered__ ? e.__takeCount__ = Ci(r, e.__takeCount__) : e.__views__.push({ size: Ci(r, 4294967295), type: n + (0 > e.__dir__ ? "Right" : "") }), e; }, Ln.prototype[n + "Right"] = function (t) { return this.reverse()[n](t).reverse(); }; }), r(["filter", "map", "takeWhile"], function (n, t) {
            var r = t + 1, e = 1 == r || 3 == r;
            Ln.prototype[n] = function (n) {
                var t = this.clone();
                return t.__iteratees__.push({
                    iteratee: ye(n, 3), type: r
                }), t.__filtered__ = t.__filtered__ || e, t;
            };
        }), r(["head", "last"], function (n, t) { var r = "take" + (t ? "Right" : ""); Ln.prototype[n] = function () { return this[r](1).value()[0]; }; }), r(["initial", "tail"], function (n, t) { var r = "drop" + (t ? "" : "Right"); Ln.prototype[n] = function () { return this.__filtered__ ? new Ln(this) : this[r](1); }; }), Ln.prototype.compact = function () { return this.filter($u); }, Ln.prototype.find = function (n) { return this.filter(n).head(); }, Ln.prototype.findLast = function (n) {
            return this.reverse().find(n);
        }, Ln.prototype.invokeMap = fr(function (n, t) { return typeof n == "function" ? new Ln(this) : this.map(function (r) { return Bt(r, n, t); }); }), Ln.prototype.reject = function (n) { return this.filter(au(ye(n))); }, Ln.prototype.slice = function (n, t) { n = ku(n); var r = this; return r.__filtered__ && (0 < n || 0 > t) ? new Ln(r) : (0 > n ? r = r.takeRight(-n) : n && (r = r.drop(n)), t !== T && (t = ku(t), r = 0 > t ? r.dropRight(-t) : r.take(t - n)), r); }, Ln.prototype.takeRightWhile = function (n) { return this.reverse().takeWhile(n).reverse(); }, Ln.prototype.toArray = function () {
            return this.take(4294967295);
        }, mt(Ln.prototype, function (n, t) {
            var r = /^(?:filter|find|map|reject)|While$/.test(t), e = /^(?:head|last)$/.test(t), u = An[e ? "take" + ("last" == t ? "Right" : "") : t], i = e || /^find/.test(t);
            u && (An.prototype[t] = function () {
                var t = this.__wrapped__, o = e ? [1] : arguments, f = t instanceof Ln, c = o[0], l = f || ff(t), s = function (n) { return n = u.apply(An, a([n], o)), e && h ? n[0] : n; };
                l && r && typeof c == "function" && 1 != c.length && (f = l = false);
                var h = this.__chain__, p = !!this.__actions__.length, c = i && !h, f = f && !p;
                return !i && l ? (t = f ? t : new Ln(this), t = n.apply(t, o), t.__actions__.push({
                    func: Qe, args: [s], thisArg: T
                }), new On(t, h)) : c && f ? n.apply(this, o) : (t = this.thru(s), c ? e ? t.value()[0] : t.value() : t);
            });
        }), r("pop push shift sort splice unshift".split(" "), function (n) { var t = ri[n], r = /^(?:push|sort|unshift)$/.test(n) ? "tap" : "thru", e = /^(?:pop|shift)$/.test(n); An.prototype[n] = function () { var n = arguments; if (e && !this.__chain__) {
            var u = this.value();
            return t.apply(ff(u) ? u : [], n);
        } return this[r](function (r) { return t.apply(ff(r) ? r : [], n); }); }; }), mt(Ln.prototype, function (n, t) {
            var r = An[t];
            if (r) {
                var e = r.name + "";
                (Gi[e] || (Gi[e] = [])).push({ name: t, func: r });
            }
        }), Gi[Jr(T, 2).name] = [{ name: "wrapper", func: T }], Ln.prototype.clone = function () { var n = new Ln(this.__wrapped__); return n.__actions__ = Lr(this.__actions__), n.__dir__ = this.__dir__, n.__filtered__ = this.__filtered__, n.__iteratees__ = Lr(this.__iteratees__), n.__takeCount__ = this.__takeCount__, n.__views__ = Lr(this.__views__), n; }, Ln.prototype.reverse = function () {
            if (this.__filtered__) {
                var n = new Ln(this);
                n.__dir__ = -1, n.__filtered__ = true;
            }
            else
                n = this.clone(), n.__dir__ *= -1;
            return n;
        }, Ln.prototype.value = function () {
            var n, t = this.__wrapped__.value(), r = this.__dir__, e = ff(t), u = 0 > r, i = e ? t.length : 0;
            n = 0;
            for (var o = i, f = this.__views__, c = -1, a = f.length; ++c < a;) {
                var l = f[c], s = l.size;
                switch (l.type) {
                    case "drop":
                        n += s;
                        break;
                    case "dropRight":
                        o -= s;
                        break;
                    case "take":
                        o = Ci(o, n + s);
                        break;
                    case "takeRight": n = Li(n, o - s);
                }
            }
            if (n = { start: n, end: o }, o = n.start, f = n.end, n = f - o, o = u ? f : o - 1, f = this.__iteratees__, c = f.length, a = 0, l = Ci(n, this.__takeCount__), !e || !u && i == n && l == n)
                return wr(t, this.__actions__);
            e = [];
            n: for (; n-- && a < l;) {
                for (o += r,
                    u = -1, i = t[o]; ++u < c;) {
                    var h = f[u], s = h.type, h = (0, h.iteratee)(i);
                    if (2 == s)
                        i = h;
                    else if (!h) {
                        if (1 == s)
                            continue n;
                        break n;
                    }
                }
                e[a++] = i;
            }
            return e;
        }, An.prototype.at = To, An.prototype.chain = function () { return Ye(this); }, An.prototype.commit = function () { return new On(this.value(), this.__chain__); }, An.prototype.next = function () { this.__values__ === T && (this.__values__ = mu(this.value())); var n = this.__index__ >= this.__values__.length; return { done: n, value: n ? T : this.__values__[this.__index__++] }; }, An.prototype.plant = function (n) {
            for (var t, r = this; r instanceof kn;) {
                var e = Fe(r);
                e.__index__ = 0, e.__values__ = T, t ? u.__wrapped__ = e : t = e;
                var u = e, r = r.__wrapped__;
            }
            return u.__wrapped__ = n, t;
        }, An.prototype.reverse = function () { var n = this.__wrapped__; return n instanceof Ln ? (this.__actions__.length && (n = new Ln(this)), n = n.reverse(), n.__actions__.push({ func: Qe, args: [Ge], thisArg: T }), new On(n, this.__chain__)) : this.thru(Ge); }, An.prototype.toJSON = An.prototype.valueOf = An.prototype.value = function () { return wr(this.__wrapped__, this.__actions__); }, An.prototype.first = An.prototype.head, wi && (An.prototype[wi] = Xe),
            An;
    }();
    typeof define == "function" && typeof define.amd == "object" && define.amd ? ($n._ = rt, define(function () { return rt; })) : Nn ? ((Nn.exports = rt)._ = rt, Fn._ = rt) : $n._ = rt;
}).call(this);
/*! selectize.js - v0.12.6 | https://github.com/selectize/selectize.js | Apache License (v2) */
!function (a, b) { "function" == typeof define && define.amd ? define("sifter", b) : "object" == typeof exports ? module.exports = b() : a.Sifter = b(); }(this, function () { var a = function (a, b) { this.items = a, this.settings = b || { diacritics: !0 }; }; a.prototype.tokenize = function (a) { if (!(a = e(String(a || "").toLowerCase())) || !a.length)
    return []; var b, c, d, g, i = [], j = a.split(/ +/); for (b = 0, c = j.length; b < c; b++) {
    if (d = f(j[b]), this.settings.diacritics)
        for (g in h)
            h.hasOwnProperty(g) && (d = d.replace(new RegExp(g, "g"), h[g]));
    i.push({ string: j[b], regex: new RegExp(d, "i") });
} return i; }, a.prototype.iterator = function (a, b) { var c; c = g(a) ? Array.prototype.forEach || function (a) { for (var b = 0, c = this.length; b < c; b++)
    a(this[b], b, this); } : function (a) { for (var b in this)
    this.hasOwnProperty(b) && a(this[b], b, this); }, c.apply(a, [b]); }, a.prototype.getScoreFunction = function (a, b) { var c, e, f, g, h; c = this, a = c.prepareSearch(a, b), f = a.tokens, e = a.options.fields, g = f.length, h = a.options.nesting; var i = function (a, b) { var c, d; return a ? (a = String(a || ""), -1 === (d = a.search(b.regex)) ? 0 : (c = b.string.length / a.length, 0 === d && (c += .5), c)) : 0; }, j = function () { var a = e.length; return a ? 1 === a ? function (a, b) { return i(d(b, e[0], h), a); } : function (b, c) { for (var f = 0, g = 0; f < a; f++)
    g += i(d(c, e[f], h), b); return g / a; } : function () { return 0; }; }(); return g ? 1 === g ? function (a) { return j(f[0], a); } : "and" === a.options.conjunction ? function (a) { for (var b, c = 0, d = 0; c < g; c++) {
    if ((b = j(f[c], a)) <= 0)
        return 0;
    d += b;
} return d / g; } : function (a) { for (var b = 0, c = 0; b < g; b++)
    c += j(f[b], a); return c / g; } : function () { return 0; }; }, a.prototype.getSortFunction = function (a, c) { var e, f, g, h, i, j, k, l, m, n, o; if (g = this, a = g.prepareSearch(a, c), o = !a.query && c.sort_empty || c.sort, m = function (a, b) { return "$score" === a ? b.score : d(g.items[b.id], a, c.nesting); }, i = [], o)
    for (e = 0, f = o.length; e < f; e++)
        (a.query || "$score" !== o[e].field) && i.push(o[e]); if (a.query) {
    for (n = !0, e = 0, f = i.length; e < f; e++)
        if ("$score" === i[e].field) {
            n = !1;
            break;
        }
    n && i.unshift({ field: "$score", direction: "desc" });
}
else
    for (e = 0, f = i.length; e < f; e++)
        if ("$score" === i[e].field) {
            i.splice(e, 1);
            break;
        } for (l = [], e = 0, f = i.length; e < f; e++)
    l.push("desc" === i[e].direction ? -1 : 1); return j = i.length, j ? 1 === j ? (h = i[0].field, k = l[0], function (a, c) { return k * b(m(h, a), m(h, c)); }) : function (a, c) { var d, e, f; for (d = 0; d < j; d++)
    if (f = i[d].field, e = l[d] * b(m(f, a), m(f, c)))
        return e; return 0; } : null; }, a.prototype.prepareSearch = function (a, b) { if ("object" == typeof a)
    return a; b = c({}, b); var d = b.fields, e = b.sort, f = b.sort_empty; return d && !g(d) && (b.fields = [d]), e && !g(e) && (b.sort = [e]), f && !g(f) && (b.sort_empty = [f]), { options: b, query: String(a || "").toLowerCase(), tokens: this.tokenize(a), total: 0, items: [] }; }, a.prototype.search = function (a, b) { var c, d, e, f, g = this; return d = this.prepareSearch(a, b), b = d.options, a = d.query, f = b.score || g.getScoreFunction(d), a.length ? g.iterator(g.items, function (a, e) { c = f(a), (!1 === b.filter || c > 0) && d.items.push({ score: c, id: e }); }) : g.iterator(g.items, function (a, b) { d.items.push({ score: 1, id: b }); }), e = g.getSortFunction(d, b), e && d.items.sort(e), d.total = d.items.length, "number" == typeof b.limit && (d.items = d.items.slice(0, b.limit)), d; }; var b = function (a, b) { return "number" == typeof a && "number" == typeof b ? a > b ? 1 : a < b ? -1 : 0 : (a = i(String(a || "")), b = i(String(b || "")), a > b ? 1 : b > a ? -1 : 0); }, c = function (a, b) { var c, d, e, f; for (c = 1, d = arguments.length; c < d; c++)
    if (f = arguments[c])
        for (e in f)
            f.hasOwnProperty(e) && (a[e] = f[e]); return a; }, d = function (a, b, c) { if (a && b) {
    if (!c)
        return a[b];
    for (var d = b.split("."); d.length && (a = a[d.shift()]);)
        ;
    return a;
} }, e = function (a) { return (a + "").replace(/^\s+|\s+$|/g, ""); }, f = function (a) { return (a + "").replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1"); }, g = Array.isArray || "undefined" != typeof $ && $.isArray || function (a) { return "[object Array]" === Object.prototype.toString.call(a); }, h = { a: "[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]", b: "[b␢βΒB฿𐌁ᛒ]", c: "[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]", d: "[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]", e: "[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]", f: "[fƑƒḞḟ]", g: "[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]", h: "[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]", i: "[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]", j: "[jȷĴĵɈɉʝɟʲ]", k: "[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]", l: "[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]", n: "[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]", o: "[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]", p: "[pṔṕṖṗⱣᵽƤƥᵱ]", q: "[qꝖꝗʠɊɋꝘꝙq̃]", r: "[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]", s: "[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]", t: "[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]", u: "[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]", v: "[vṼṽṾṿƲʋꝞꝟⱱʋ]", w: "[wẂẃẀẁŴŵẄẅẆẇẈẉ]", x: "[xẌẍẊẋχ]", y: "[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]", z: "[zŹźẐẑŽžŻżẒẓẔẕƵƶ]" }, i = function () { var a, b, c, d, e = "", f = {}; for (c in h)
    if (h.hasOwnProperty(c))
        for (d = h[c].substring(2, h[c].length - 1), e += d, a = 0, b = d.length; a < b; a++)
            f[d.charAt(a)] = c; var g = new RegExp("[" + e + "]", "g"); return function (a) { return a.replace(g, function (a) { return f[a]; }).toLowerCase(); }; }(); return a; }), function (a, b) { "function" == typeof define && define.amd ? define("microplugin", b) : "object" == typeof exports ? module.exports = b() : a.MicroPlugin = b(); }(this, function () { var a = {}; a.mixin = function (a) { a.plugins = {}, a.prototype.initializePlugins = function (a) { var c, d, e, f = this, g = []; if (f.plugins = { names: [], settings: {}, requested: {}, loaded: {} }, b.isArray(a))
    for (c = 0, d = a.length; c < d; c++)
        "string" == typeof a[c] ? g.push(a[c]) : (f.plugins.settings[a[c].name] = a[c].options, g.push(a[c].name));
else if (a)
    for (e in a)
        a.hasOwnProperty(e) && (f.plugins.settings[e] = a[e], g.push(e)); for (; g.length;)
    f.require(g.shift()); }, a.prototype.loadPlugin = function (b) { var c = this, d = c.plugins, e = a.plugins[b]; if (!a.plugins.hasOwnProperty(b))
    throw new Error('Unable to find "' + b + '" plugin'); d.requested[b] = !0, d.loaded[b] = e.fn.apply(c, [c.plugins.settings[b] || {}]), d.names.push(b); }, a.prototype.require = function (a) { var b = this, c = b.plugins; if (!b.plugins.loaded.hasOwnProperty(a)) {
    if (c.requested[a])
        throw new Error('Plugin has circular dependency ("' + a + '")');
    b.loadPlugin(a);
} return c.loaded[a]; }, a.define = function (b, c) { a.plugins[b] = { name: b, fn: c }; }; }; var b = { isArray: Array.isArray || function (a) { return "[object Array]" === Object.prototype.toString.call(a); } }; return a; }), function (a, b) { "function" == typeof define && define.amd ? define("selectize", ["jquery", "sifter", "microplugin"], b) : "object" == typeof exports ? module.exports = b(require("jquery"), require("sifter"), require("microplugin")) : a.Selectize = b(a.jQuery, a.Sifter, a.MicroPlugin); }(this, function (a, b, c) {
    "use strict";
    var d = function (a, b) { if ("string" != typeof b || b.length) {
        var c = "string" == typeof b ? new RegExp(b, "i") : b, d = function (a) { var b = 0; if (3 === a.nodeType) {
            var e = a.data.search(c);
            if (e >= 0 && a.data.length > 0) {
                var f = a.data.match(c), g = document.createElement("span");
                g.className = "highlight";
                var h = a.splitText(e), i = (h.splitText(f[0].length), h.cloneNode(!0));
                g.appendChild(i), h.parentNode.replaceChild(g, h), b = 1;
            }
        }
        else if (1 === a.nodeType && a.childNodes && !/(script|style)/i.test(a.tagName) && ("highlight" !== a.className || "SPAN" !== a.tagName))
            for (var j = 0; j < a.childNodes.length; ++j)
                j += d(a.childNodes[j]); return b; };
        return a.each(function () { d(this); });
    } };
    a.fn.removeHighlight = function () { return this.find("span.highlight").each(function () { this.parentNode.firstChild.nodeName; var a = this.parentNode; a.replaceChild(this.firstChild, this), a.normalize(); }).end(); };
    var e = function () { };
    e.prototype = { on: function (a, b) { this._events = this._events || {}, this._events[a] = this._events[a] || [], this._events[a].push(b); }, off: function (a, b) { var c = arguments.length; return 0 === c ? delete this._events : 1 === c ? delete this._events[a] : (this._events = this._events || {}, void (a in this._events != !1 && this._events[a].splice(this._events[a].indexOf(b), 1))); }, trigger: function (a) { if (this._events = this._events || {}, a in this._events != !1)
            for (var b = 0; b < this._events[a].length; b++)
                this._events[a][b].apply(this, Array.prototype.slice.call(arguments, 1)); } }, e.mixin = function (a) { for (var b = ["on", "off", "trigger"], c = 0; c < b.length; c++)
        a.prototype[b[c]] = e.prototype[b[c]]; };
    var f = /Mac/.test(navigator.userAgent), g = f ? 91 : 17, h = f ? 18 : 17, i = !/android/i.test(window.navigator.userAgent) && !!document.createElement("input").validity, j = function (a) { return void 0 !== a; }, k = function (a) { return void 0 === a || null === a ? null : "boolean" == typeof a ? a ? "1" : "0" : a + ""; }, l = function (a) { return (a + "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;"); }, m = {};
    m.before = function (a, b, c) { var d = a[b]; a[b] = function () { return c.apply(a, arguments), d.apply(a, arguments); }; }, m.after = function (a, b, c) { var d = a[b]; a[b] = function () { var b = d.apply(a, arguments); return c.apply(a, arguments), b; }; };
    var n = function (a) { var b = !1; return function () { b || (b = !0, a.apply(this, arguments)); }; }, o = function (a, b) { var c; return function () { var d = this, e = arguments; window.clearTimeout(c), c = window.setTimeout(function () { a.apply(d, e); }, b); }; }, p = function (a, b, c) { var d, e = a.trigger, f = {}; a.trigger = function () { var c = arguments[0]; if (-1 === b.indexOf(c))
        return e.apply(a, arguments); f[c] = arguments; }, c.apply(a, []), a.trigger = e; for (d in f)
        f.hasOwnProperty(d) && e.apply(a, f[d]); }, q = function (a, b, c, d) { a.on(b, c, function (b) { for (var c = b.target; c && c.parentNode !== a[0];)
        c = c.parentNode; return b.currentTarget = c, d.apply(this, [b]); }); }, r = function (a) { var b = {}; if ("selectionStart" in a)
        b.start = a.selectionStart, b.length = a.selectionEnd - b.start;
    else if (document.selection) {
        a.focus();
        var c = document.selection.createRange(), d = document.selection.createRange().text.length;
        c.moveStart("character", -a.value.length), b.start = c.text.length - d, b.length = d;
    } return b; }, s = function (a, b, c) { var d, e, f = {}; if (c)
        for (d = 0, e = c.length; d < e; d++)
            f[c[d]] = a.css(c[d]);
    else
        f = a.css(); b.css(f); }, t = function (b, c) { return b ? (w.$testInput || (w.$testInput = a("<span />").css({ position: "absolute", top: -99999, left: -99999, width: "auto", padding: 0, whiteSpace: "pre" }).appendTo("body")), w.$testInput.text(b), s(c, w.$testInput, ["letterSpacing", "fontSize", "fontFamily", "fontWeight", "textTransform"]), w.$testInput.width()) : 0; }, u = function (a) { var b = null, c = function (c, d) { var e, f, g, h, i, j, k, l; c = c || window.event || {}, d = d || {}, c.metaKey || c.altKey || (d.force || !1 !== a.data("grow")) && (e = a.val(), c.type && "keydown" === c.type.toLowerCase() && (f = c.keyCode, g = f >= 48 && f <= 57 || f >= 65 && f <= 90 || f >= 96 && f <= 111 || f >= 186 && f <= 222 || 32 === f, 46 === f || 8 === f ? (l = r(a[0]), l.length ? e = e.substring(0, l.start) + e.substring(l.start + l.length) : 8 === f && l.start ? e = e.substring(0, l.start - 1) + e.substring(l.start + 1) : 46 === f && void 0 !== l.start && (e = e.substring(0, l.start) + e.substring(l.start + 1))) : g && (j = c.shiftKey, k = String.fromCharCode(c.keyCode), k = j ? k.toUpperCase() : k.toLowerCase(), e += k)), h = a.attr("placeholder"), !e && h && (e = h), (i = t(e, a) + 4) !== b && (b = i, a.width(i), a.triggerHandler("resize"))); }; a.on("keydown keyup update blur", c), c(); }, v = function (a) { var b = document.createElement("div"); return b.appendChild(a.cloneNode(!0)), b.innerHTML; }, w = function (c, d) { var e, f, g, h, i = this; h = c[0], h.selectize = i; var j = window.getComputedStyle && window.getComputedStyle(h, null); if (g = j ? j.getPropertyValue("direction") : h.currentStyle && h.currentStyle.direction, g = g || c.parents("[dir]:first").attr("dir") || "", a.extend(i, { order: 0, settings: d, $input: c, tabIndex: c.attr("tabindex") || "", tagType: "select" === h.tagName.toLowerCase() ? 1 : 2, rtl: /rtl/i.test(g), eventNS: ".selectize" + ++w.count, highlightedValue: null, isBlurring: !1, isOpen: !1, isDisabled: !1, isRequired: c.is("[required]"), isInvalid: !1, isLocked: !1, isFocused: !1, isInputHidden: !1, isSetup: !1, isShiftDown: !1, isCmdDown: !1, isCtrlDown: !1, ignoreFocus: !1, ignoreBlur: !1, ignoreHover: !1, hasOptions: !1, currentResults: null, lastValue: "", caretPos: 0, loading: 0, loadedSearches: {}, $activeOption: null, $activeItems: [], optgroups: {}, options: {}, userOptions: {}, items: [], renderCache: {}, onSearchChange: null === d.loadThrottle ? i.onSearchChange : o(i.onSearchChange, d.loadThrottle) }), i.sifter = new b(this.options, { diacritics: d.diacritics }), i.settings.options) {
        for (e = 0, f = i.settings.options.length; e < f; e++)
            i.registerOption(i.settings.options[e]);
        delete i.settings.options;
    } if (i.settings.optgroups) {
        for (e = 0, f = i.settings.optgroups.length; e < f; e++)
            i.registerOptionGroup(i.settings.optgroups[e]);
        delete i.settings.optgroups;
    } i.settings.mode = i.settings.mode || (1 === i.settings.maxItems ? "single" : "multi"), "boolean" != typeof i.settings.hideSelected && (i.settings.hideSelected = "multi" === i.settings.mode), i.initializePlugins(i.settings.plugins), i.setupCallbacks(), i.setupTemplates(), i.setup(); };
    return e.mixin(w), void 0 !== c ? c.mixin(w) : function (a, b) { b || (b = {}); console.error("Selectize: " + a), b.explanation && (console.group && console.group(), console.error(b.explanation), console.group && console.groupEnd()); }("Dependency MicroPlugin is missing", { explanation: 'Make sure you either: (1) are using the "standalone" version of Selectize, or (2) require MicroPlugin before you load Selectize.' }), a.extend(w.prototype, { setup: function () { var b, c, d, e, j, k, l, m, n, o, p = this, r = p.settings, s = p.eventNS, t = a(window), v = a(document), w = p.$input; if (l = p.settings.mode, m = w.attr("class") || "", b = a("<div>").addClass(r.wrapperClass).addClass(m).addClass(l), c = a("<div>").addClass(r.inputClass).addClass("items").appendTo(b), d = a('<input type="text" autocomplete="off" />').appendTo(c).attr("tabindex", w.is(":disabled") ? "-1" : p.tabIndex), k = a(r.dropdownParent || b), e = a("<div>").addClass(r.dropdownClass).addClass(l).hide().appendTo(k), j = a("<div>").addClass(r.dropdownContentClass).appendTo(e), (o = w.attr("id")) && (d.attr("id", o + "-selectized"), a("label[for='" + o + "']").attr("for", o + "-selectized")), p.settings.copyClassesToDropdown && e.addClass(m), b.css({ width: w[0].style.width }), p.plugins.names.length && (n = "plugin-" + p.plugins.names.join(" plugin-"), b.addClass(n), e.addClass(n)), (null === r.maxItems || r.maxItems > 1) && 1 === p.tagType && w.attr("multiple", "multiple"), p.settings.placeholder && d.attr("placeholder", r.placeholder), !p.settings.splitOn && p.settings.delimiter) {
            var x = p.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&");
            p.settings.splitOn = new RegExp("\\s*" + x + "+\\s*");
        } w.attr("autocorrect") && d.attr("autocorrect", w.attr("autocorrect")), w.attr("autocapitalize") && d.attr("autocapitalize", w.attr("autocapitalize")), d[0].type = w[0].type, p.$wrapper = b, p.$control = c, p.$control_input = d, p.$dropdown = e, p.$dropdown_content = j, e.on("mouseenter mousedown click", "[data-disabled]>[data-selectable]", function (a) { a.stopImmediatePropagation(); }), e.on("mouseenter", "[data-selectable]", function () { return p.onOptionHover.apply(p, arguments); }), e.on("mousedown click", "[data-selectable]", function () { return p.onOptionSelect.apply(p, arguments); }), q(c, "mousedown", "*:not(input)", function () { return p.onItemSelect.apply(p, arguments); }), u(d), c.on({ mousedown: function () { return p.onMouseDown.apply(p, arguments); }, click: function () { return p.onClick.apply(p, arguments); } }), d.on({ mousedown: function (a) { a.stopPropagation(); }, keydown: function () { return p.onKeyDown.apply(p, arguments); }, keyup: function () { return p.onKeyUp.apply(p, arguments); }, keypress: function () { return p.onKeyPress.apply(p, arguments); }, resize: function () { p.positionDropdown.apply(p, []); }, blur: function () { return p.onBlur.apply(p, arguments); }, focus: function () { return p.ignoreBlur = !1, p.onFocus.apply(p, arguments); }, paste: function () { return p.onPaste.apply(p, arguments); } }), v.on("keydown" + s, function (a) { p.isCmdDown = a[f ? "metaKey" : "ctrlKey"], p.isCtrlDown = a[f ? "altKey" : "ctrlKey"], p.isShiftDown = a.shiftKey; }), v.on("keyup" + s, function (a) { a.keyCode === h && (p.isCtrlDown = !1), 16 === a.keyCode && (p.isShiftDown = !1), a.keyCode === g && (p.isCmdDown = !1); }), v.on("mousedown" + s, function (a) { if (p.isFocused) {
            if (a.target === p.$dropdown[0] || a.target.parentNode === p.$dropdown[0])
                return !1;
            p.$control.has(a.target).length || a.target === p.$control[0] || p.blur(a.target);
        } }), t.on(["scroll" + s, "resize" + s].join(" "), function () { p.isOpen && p.positionDropdown.apply(p, arguments); }), t.on("mousemove" + s, function () { p.ignoreHover = !1; }), this.revertSettings = { $children: w.children().detach(), tabindex: w.attr("tabindex") }, w.attr("tabindex", -1).hide().after(p.$wrapper), a.isArray(r.items) && (p.setValue(r.items), delete r.items), i && w.on("invalid" + s, function (a) { a.preventDefault(), p.isInvalid = !0, p.refreshState(); }), p.updateOriginalInput(), p.refreshItems(), p.refreshState(), p.updatePlaceholder(), p.isSetup = !0, w.is(":disabled") && p.disable(), p.on("change", this.onChange), w.data("selectize", p), w.addClass("selectized"), p.trigger("initialize"), !0 === r.preload && p.onSearchChange(""); }, setupTemplates: function () { var b = this, c = b.settings.labelField, d = b.settings.optgroupLabelField, e = { optgroup: function (a) { return '<div class="optgroup">' + a.html + "</div>"; }, optgroup_header: function (a, b) { return '<div class="optgroup-header">' + b(a[d]) + "</div>"; }, option: function (a, b) { return '<div class="option">' + b(a[c]) + "</div>"; }, item: function (a, b) { return '<div class="item">' + b(a[c]) + "</div>"; }, option_create: function (a, b) { return '<div class="create">Add <strong>' + b(a.input) + "</strong>&hellip;</div>"; } }; b.settings.render = a.extend({}, e, b.settings.render); }, setupCallbacks: function () { var a, b, c = { initialize: "onInitialize", change: "onChange", item_add: "onItemAdd", item_remove: "onItemRemove", clear: "onClear", option_add: "onOptionAdd", option_remove: "onOptionRemove", option_clear: "onOptionClear", optgroup_add: "onOptionGroupAdd", optgroup_remove: "onOptionGroupRemove", optgroup_clear: "onOptionGroupClear", dropdown_open: "onDropdownOpen", dropdown_close: "onDropdownClose", type: "onType", load: "onLoad", focus: "onFocus", blur: "onBlur" }; for (a in c)
            c.hasOwnProperty(a) && (b = this.settings[c[a]]) && this.on(a, b); }, onClick: function (a) { var b = this; b.isFocused && b.isOpen || (b.focus(), a.preventDefault()); }, onMouseDown: function (b) { var c = this, d = b.isDefaultPrevented(); a(b.target); if (c.isFocused) {
            if (b.target !== c.$control_input[0])
                return "single" === c.settings.mode ? c.isOpen ? c.close() : c.open() : d || c.setActiveItem(null), !1;
        }
        else
            d || window.setTimeout(function () { c.focus(); }, 0); }, onChange: function () { this.$input.trigger("change"); }, onPaste: function (b) { var c = this; if (c.isFull() || c.isInputHidden || c.isLocked)
            return void b.preventDefault(); c.settings.splitOn && setTimeout(function () { var b = c.$control_input.val(); if (b.match(c.settings.splitOn))
            for (var d = a.trim(b).split(c.settings.splitOn), e = 0, f = d.length; e < f; e++)
                c.createItem(d[e]); }, 0); }, onKeyPress: function (a) { if (this.isLocked)
            return a && a.preventDefault(); var b = String.fromCharCode(a.keyCode || a.which); return this.settings.create && "multi" === this.settings.mode && b === this.settings.delimiter ? (this.createItem(), a.preventDefault(), !1) : void 0; }, onKeyDown: function (a) { var b = (a.target, this.$control_input[0], this); if (b.isLocked)
            return void (9 !== a.keyCode && a.preventDefault()); switch (a.keyCode) {
            case 65:
                if (b.isCmdDown)
                    return void b.selectAll();
                break;
            case 27: return void (b.isOpen && (a.preventDefault(), a.stopPropagation(), b.close()));
            case 78: if (!a.ctrlKey || a.altKey)
                break;
            case 40:
                if (!b.isOpen && b.hasOptions)
                    b.open();
                else if (b.$activeOption) {
                    b.ignoreHover = !0;
                    var c = b.getAdjacentOption(b.$activeOption, 1);
                    c.length && b.setActiveOption(c, !0, !0);
                }
                return void a.preventDefault();
            case 80: if (!a.ctrlKey || a.altKey)
                break;
            case 38:
                if (b.$activeOption) {
                    b.ignoreHover = !0;
                    var d = b.getAdjacentOption(b.$activeOption, -1);
                    d.length && b.setActiveOption(d, !0, !0);
                }
                return void a.preventDefault();
            case 13: return void (b.isOpen && b.$activeOption && (b.onOptionSelect({ currentTarget: b.$activeOption }), a.preventDefault()));
            case 37: return void b.advanceSelection(-1, a);
            case 39: return void b.advanceSelection(1, a);
            case 9: return b.settings.selectOnTab && b.isOpen && b.$activeOption && (b.onOptionSelect({ currentTarget: b.$activeOption }), b.isFull() || a.preventDefault()), void (b.settings.create && b.createItem() && a.preventDefault());
            case 8:
            case 46: return void b.deleteSelection(a);
        } return !b.isFull() && !b.isInputHidden || (f ? a.metaKey : a.ctrlKey) ? void 0 : void a.preventDefault(); }, onKeyUp: function (a) { var b = this; if (b.isLocked)
            return a && a.preventDefault(); var c = b.$control_input.val() || ""; b.lastValue !== c && (b.lastValue = c, b.onSearchChange(c), b.refreshOptions(), b.trigger("type", c)); }, onSearchChange: function (a) { var b = this, c = b.settings.load; c && (b.loadedSearches.hasOwnProperty(a) || (b.loadedSearches[a] = !0, b.load(function (d) { c.apply(b, [a, d]); }))); }, onFocus: function (a) { var b = this, c = b.isFocused; if (b.isDisabled)
            return b.blur(), a && a.preventDefault(), !1; b.ignoreFocus || (b.isFocused = !0, "focus" === b.settings.preload && b.onSearchChange(""), c || b.trigger("focus"), b.$activeItems.length || (b.showInput(), b.setActiveItem(null), b.refreshOptions(!!b.settings.openOnFocus)), b.refreshState()); }, onBlur: function (a, b) { var c = this; if (c.isFocused && (c.isFocused = !1, !c.ignoreFocus)) {
            if (!c.ignoreBlur && document.activeElement === c.$dropdown_content[0])
                return c.ignoreBlur = !0, void c.onFocus(a);
            var d = function () { c.close(), c.setTextboxValue(""), c.setActiveItem(null), c.setActiveOption(null), c.setCaret(c.items.length), c.refreshState(), b && b.focus && b.focus(), c.isBlurring = !1, c.ignoreFocus = !1, c.trigger("blur"); };
            c.isBlurring = !0, c.ignoreFocus = !0, c.settings.create && c.settings.createOnBlur ? c.createItem(null, !1, d) : d();
        } }, onOptionHover: function (a) { this.ignoreHover || this.setActiveOption(a.currentTarget, !1); }, onOptionSelect: function (b) { var c, d, e = this; b.preventDefault && (b.preventDefault(), b.stopPropagation()), d = a(b.currentTarget), d.hasClass("create") ? e.createItem(null, function () { e.settings.closeAfterSelect && e.close(); }) : void 0 !== (c = d.attr("data-value")) && (e.lastQuery = null, e.setTextboxValue(""), e.addItem(c), e.settings.closeAfterSelect ? e.close() : !e.settings.hideSelected && b.type && /mouse/.test(b.type) && e.setActiveOption(e.getOption(c))); }, onItemSelect: function (a) { var b = this; b.isLocked || "multi" === b.settings.mode && (a.preventDefault(), b.setActiveItem(a.currentTarget, a)); }, load: function (a) { var b = this, c = b.$wrapper.addClass(b.settings.loadingClass); b.loading++, a.apply(b, [function (a) { b.loading = Math.max(b.loading - 1, 0), a && a.length && (b.addOption(a), b.refreshOptions(b.isFocused && !b.isInputHidden)), b.loading || c.removeClass(b.settings.loadingClass), b.trigger("load", a); }]); }, setTextboxValue: function (a) { var b = this.$control_input; b.val() !== a && (b.val(a).triggerHandler("update"), this.lastValue = a); }, getValue: function () { return 1 === this.tagType && this.$input.attr("multiple") ? this.items : this.items.join(this.settings.delimiter); }, setValue: function (a, b) { p(this, b ? [] : ["change"], function () { this.clear(b), this.addItems(a, b); }); }, setActiveItem: function (b, c) { var d, e, f, g, h, i, j, k, l = this; if ("single" !== l.settings.mode) {
            if (b = a(b), !b.length)
                return a(l.$activeItems).removeClass("active"), l.$activeItems = [], void (l.isFocused && l.showInput());
            if ("mousedown" === (d = c && c.type.toLowerCase()) && l.isShiftDown && l.$activeItems.length) {
                for (k = l.$control.children(".active:last"), g = Array.prototype.indexOf.apply(l.$control[0].childNodes, [k[0]]), h = Array.prototype.indexOf.apply(l.$control[0].childNodes, [b[0]]), g > h && (j = g, g = h, h = j), e = g; e <= h; e++)
                    i = l.$control[0].childNodes[e], -1 === l.$activeItems.indexOf(i) && (a(i).addClass("active"), l.$activeItems.push(i));
                c.preventDefault();
            }
            else
                "mousedown" === d && l.isCtrlDown || "keydown" === d && this.isShiftDown ? b.hasClass("active") ? (f = l.$activeItems.indexOf(b[0]), l.$activeItems.splice(f, 1), b.removeClass("active")) : l.$activeItems.push(b.addClass("active")[0]) : (a(l.$activeItems).removeClass("active"), l.$activeItems = [b.addClass("active")[0]]);
            l.hideInput(), this.isFocused || l.focus();
        } }, setActiveOption: function (b, c, d) { var e, f, g, h, i, k = this; k.$activeOption && k.$activeOption.removeClass("active"), k.$activeOption = null, b = a(b), b.length && (k.$activeOption = b.addClass("active"), !c && j(c) || (e = k.$dropdown_content.height(), f = k.$activeOption.outerHeight(!0), c = k.$dropdown_content.scrollTop() || 0, g = k.$activeOption.offset().top - k.$dropdown_content.offset().top + c, h = g, i = g - e + f, g + f > e + c ? k.$dropdown_content.stop().animate({ scrollTop: i }, d ? k.settings.scrollDuration : 0) : g < c && k.$dropdown_content.stop().animate({ scrollTop: h }, d ? k.settings.scrollDuration : 0))); }, selectAll: function () { var a = this; "single" !== a.settings.mode && (a.$activeItems = Array.prototype.slice.apply(a.$control.children(":not(input)").addClass("active")), a.$activeItems.length && (a.hideInput(), a.close()), a.focus()); }, hideInput: function () { var a = this; a.setTextboxValue(""), a.$control_input.css({ opacity: 0, position: "absolute", left: a.rtl ? 1e4 : -1e4 }), a.isInputHidden = !0; }, showInput: function () { this.$control_input.css({ opacity: 1, position: "relative", left: 0 }), this.isInputHidden = !1; }, focus: function () { var a = this; a.isDisabled || (a.ignoreFocus = !0, a.$control_input[0].focus(), window.setTimeout(function () { a.ignoreFocus = !1, a.onFocus(); }, 0)); }, blur: function (a) { this.$control_input[0].blur(), this.onBlur(null, a); }, getScoreFunction: function (a) { return this.sifter.getScoreFunction(a, this.getSearchOptions()); }, getSearchOptions: function () { var a = this.settings, b = a.sortField; return "string" == typeof b && (b = [{ field: b }]), { fields: a.searchField, conjunction: a.searchConjunction, sort: b, nesting: a.nesting }; }, search: function (b) { var c, d, e, f = this, g = f.settings, h = this.getSearchOptions(); if (g.score && "function" != typeof (e = f.settings.score.apply(this, [b])))
            throw new Error('Selectize "score" setting must be a function that returns a function'); if (b !== f.lastQuery ? (f.lastQuery = b, d = f.sifter.search(b, a.extend(h, { score: e })), f.currentResults = d) : d = a.extend(!0, {}, f.currentResults), g.hideSelected)
            for (c = d.items.length - 1; c >= 0; c--)
                -1 !== f.items.indexOf(k(d.items[c].id)) && d.items.splice(c, 1); return d; }, refreshOptions: function (b) { var c, e, f, g, h, i, j, l, m, n, o, p, q, r, s, t; void 0 === b && (b = !0); var u = this, w = a.trim(u.$control_input.val()), x = u.search(w), y = u.$dropdown_content, z = u.$activeOption && k(u.$activeOption.attr("data-value")); for (g = x.items.length, "number" == typeof u.settings.maxOptions && (g = Math.min(g, u.settings.maxOptions)), h = {}, i = [], c = 0; c < g; c++)
            for (j = u.options[x.items[c].id], l = u.render("option", j), m = j[u.settings.optgroupField] || "", n = a.isArray(m) ? m : [m], e = 0, f = n && n.length; e < f; e++)
                m = n[e], u.optgroups.hasOwnProperty(m) || (m = ""), h.hasOwnProperty(m) || (h[m] = document.createDocumentFragment(), i.push(m)), h[m].appendChild(l); for (this.settings.lockOptgroupOrder && i.sort(function (a, b) { return (u.optgroups[a].$order || 0) - (u.optgroups[b].$order || 0); }), o = document.createDocumentFragment(), c = 0, g = i.length; c < g; c++)
            m = i[c], u.optgroups.hasOwnProperty(m) && h[m].childNodes.length ? (p = document.createDocumentFragment(), p.appendChild(u.render("optgroup_header", u.optgroups[m])), p.appendChild(h[m]), o.appendChild(u.render("optgroup", a.extend({}, u.optgroups[m], { html: v(p), dom: p })))) : o.appendChild(h[m]); if (y.html(o), u.settings.highlight && (y.removeHighlight(), x.query.length && x.tokens.length))
            for (c = 0, g = x.tokens.length; c < g; c++)
                d(y, x.tokens[c].regex); if (!u.settings.hideSelected)
            for (c = 0, g = u.items.length; c < g; c++)
                u.getOption(u.items[c]).addClass("selected"); q = u.canCreate(w), q && (y.prepend(u.render("option_create", { input: w })), t = a(y[0].childNodes[0])), u.hasOptions = x.items.length > 0 || q, u.hasOptions ? (x.items.length > 0 ? (s = z && u.getOption(z), s && s.length ? r = s : "single" === u.settings.mode && u.items.length && (r = u.getOption(u.items[0])), r && r.length || (r = t && !u.settings.addPrecedence ? u.getAdjacentOption(t, 1) : y.find("[data-selectable]:first"))) : r = t, u.setActiveOption(r), b && !u.isOpen && u.open()) : (u.setActiveOption(null), b && u.isOpen && u.close()); }, addOption: function (b) { var c, d, e, f = this; if (a.isArray(b))
            for (c = 0, d = b.length; c < d; c++)
                f.addOption(b[c]);
        else
            (e = f.registerOption(b)) && (f.userOptions[e] = !0, f.lastQuery = null, f.trigger("option_add", e, b)); }, registerOption: function (a) { var b = k(a[this.settings.valueField]); return void 0 !== b && null !== b && !this.options.hasOwnProperty(b) && (a.$order = a.$order || ++this.order, this.options[b] = a, b); }, registerOptionGroup: function (a) { var b = k(a[this.settings.optgroupValueField]); return !!b && (a.$order = a.$order || ++this.order, this.optgroups[b] = a, b); }, addOptionGroup: function (a, b) { b[this.settings.optgroupValueField] = a, (a = this.registerOptionGroup(b)) && this.trigger("optgroup_add", a, b); }, removeOptionGroup: function (a) { this.optgroups.hasOwnProperty(a) && (delete this.optgroups[a], this.renderCache = {}, this.trigger("optgroup_remove", a)); }, clearOptionGroups: function () { this.optgroups = {}, this.renderCache = {}, this.trigger("optgroup_clear"); }, updateOption: function (b, c) { var d, e, f, g, h, i, j, l = this; if (b = k(b), f = k(c[l.settings.valueField]), null !== b && l.options.hasOwnProperty(b)) {
            if ("string" != typeof f)
                throw new Error("Value must be set in option data");
            j = l.options[b].$order, f !== b && (delete l.options[b], -1 !== (g = l.items.indexOf(b)) && l.items.splice(g, 1, f)), c.$order = c.$order || j, l.options[f] = c, h = l.renderCache.item, i = l.renderCache.option, h && (delete h[b], delete h[f]), i && (delete i[b], delete i[f]), -1 !== l.items.indexOf(f) && (d = l.getItem(b), e = a(l.render("item", c)), d.hasClass("active") && e.addClass("active"), d.replaceWith(e)), l.lastQuery = null, l.isOpen && l.refreshOptions(!1);
        } }, removeOption: function (a, b) { var c = this; a = k(a); var d = c.renderCache.item, e = c.renderCache.option; d && delete d[a], e && delete e[a], delete c.userOptions[a], delete c.options[a], c.lastQuery = null, c.trigger("option_remove", a), c.removeItem(a, b); }, clearOptions: function () { var b = this; b.loadedSearches = {}, b.userOptions = {}, b.renderCache = {}; var c = b.options; a.each(b.options, function (a, d) { -1 == b.items.indexOf(a) && delete c[a]; }), b.options = b.sifter.items = c, b.lastQuery = null, b.trigger("option_clear"); }, getOption: function (a) { return this.getElementWithValue(a, this.$dropdown_content.find("[data-selectable]")); }, getAdjacentOption: function (b, c) { var d = this.$dropdown.find("[data-selectable]"), e = d.index(b) + c; return e >= 0 && e < d.length ? d.eq(e) : a(); }, getElementWithValue: function (b, c) { if (void 0 !== (b = k(b)) && null !== b)
            for (var d = 0, e = c.length; d < e; d++)
                if (c[d].getAttribute("data-value") === b)
                    return a(c[d]); return a(); }, getItem: function (a) { return this.getElementWithValue(a, this.$control.children()); }, addItems: function (b, c) { this.buffer = document.createDocumentFragment(); for (var d = this.$control[0].childNodes, e = 0; e < d.length; e++)
            this.buffer.appendChild(d[e]); for (var f = a.isArray(b) ? b : [b], e = 0, g = f.length; e < g; e++)
            this.isPending = e < g - 1, this.addItem(f[e], c); var h = this.$control[0]; h.insertBefore(this.buffer, h.firstChild), this.buffer = null; }, addItem: function (b, c) { p(this, c ? [] : ["change"], function () { var d, e, f, g, h, i = this, j = i.settings.mode; if (b = k(b), -1 !== i.items.indexOf(b))
            return void ("single" === j && i.close()); i.options.hasOwnProperty(b) && ("single" === j && i.clear(c), "multi" === j && i.isFull() || (d = a(i.render("item", i.options[b])), h = i.isFull(), i.items.splice(i.caretPos, 0, b), i.insertAtCaret(d), (!i.isPending || !h && i.isFull()) && i.refreshState(), i.isSetup && (f = i.$dropdown_content.find("[data-selectable]"), i.isPending || (e = i.getOption(b), g = i.getAdjacentOption(e, 1).attr("data-value"), i.refreshOptions(i.isFocused && "single" !== j), g && i.setActiveOption(i.getOption(g))), !f.length || i.isFull() ? i.close() : i.isPending || i.positionDropdown(), i.updatePlaceholder(), i.trigger("item_add", b, d), i.isPending || i.updateOriginalInput({ silent: c })))); }); }, removeItem: function (b, c) { var d, e, f, g = this; d = b instanceof a ? b : g.getItem(b), b = k(d.attr("data-value")), -1 !== (e = g.items.indexOf(b)) && (d.remove(), d.hasClass("active") && (f = g.$activeItems.indexOf(d[0]), g.$activeItems.splice(f, 1)), g.items.splice(e, 1), g.lastQuery = null, !g.settings.persist && g.userOptions.hasOwnProperty(b) && g.removeOption(b, c), e < g.caretPos && g.setCaret(g.caretPos - 1), g.refreshState(), g.updatePlaceholder(), g.updateOriginalInput({ silent: c }), g.positionDropdown(), g.trigger("item_remove", b, d)); }, createItem: function (b, c) { var d = this, e = d.caretPos; b = b || a.trim(d.$control_input.val() || ""); var f = arguments[arguments.length - 1]; if ("function" != typeof f && (f = function () { }), "boolean" != typeof c && (c = !0), !d.canCreate(b))
            return f(), !1; d.lock(); var g = "function" == typeof d.settings.create ? this.settings.create : function (a) { var b = {}; return b[d.settings.labelField] = a, b[d.settings.valueField] = a, b; }, h = n(function (a) { if (d.unlock(), !a || "object" != typeof a)
            return f(); var b = k(a[d.settings.valueField]); if ("string" != typeof b)
            return f(); d.setTextboxValue(""), d.addOption(a), d.setCaret(e), d.addItem(b), d.refreshOptions(c && "single" !== d.settings.mode), f(a); }), i = g.apply(this, [b, h]); return void 0 !== i && h(i), !0; }, refreshItems: function () { this.lastQuery = null, this.isSetup && this.addItem(this.items), this.refreshState(), this.updateOriginalInput(); }, refreshState: function () { this.refreshValidityState(), this.refreshClasses(); }, refreshValidityState: function () { if (!this.isRequired)
            return !1; var a = !this.items.length; this.isInvalid = a, this.$control_input.prop("required", a), this.$input.prop("required", !a); }, refreshClasses: function () { var b = this, c = b.isFull(), d = b.isLocked; b.$wrapper.toggleClass("rtl", b.rtl), b.$control.toggleClass("focus", b.isFocused).toggleClass("disabled", b.isDisabled).toggleClass("required", b.isRequired).toggleClass("invalid", b.isInvalid).toggleClass("locked", d).toggleClass("full", c).toggleClass("not-full", !c).toggleClass("input-active", b.isFocused && !b.isInputHidden).toggleClass("dropdown-active", b.isOpen).toggleClass("has-options", !a.isEmptyObject(b.options)).toggleClass("has-items", b.items.length > 0), b.$control_input.data("grow", !c && !d); }, isFull: function () {
            return null !== this.settings.maxItems && this.items.length >= this.settings.maxItems;
        }, updateOriginalInput: function (a) { var b, c, d, e, f = this; if (a = a || {}, 1 === f.tagType) {
            for (d = [], b = 0, c = f.items.length; b < c; b++)
                e = f.options[f.items[b]][f.settings.labelField] || "", d.push('<option value="' + l(f.items[b]) + '" selected="selected">' + l(e) + "</option>");
            d.length || this.$input.attr("multiple") || d.push('<option value="" selected="selected"></option>'), f.$input.html(d.join(""));
        }
        else
            f.$input.val(f.getValue()), f.$input.attr("value", f.$input.val()); f.isSetup && (a.silent || f.trigger("change", f.$input.val())); }, updatePlaceholder: function () { if (this.settings.placeholder) {
            var a = this.$control_input;
            this.items.length ? a.removeAttr("placeholder") : a.attr("placeholder", this.settings.placeholder), a.triggerHandler("update", { force: !0 });
        } }, open: function () { var a = this; a.isLocked || a.isOpen || "multi" === a.settings.mode && a.isFull() || (a.focus(), a.isOpen = !0, a.refreshState(), a.$dropdown.css({ visibility: "hidden", display: "block" }), a.positionDropdown(), a.$dropdown.css({ visibility: "visible" }), a.trigger("dropdown_open", a.$dropdown)); }, close: function () { var a = this, b = a.isOpen; "single" === a.settings.mode && a.items.length && (a.hideInput(), a.isBlurring || a.$control_input.blur()), a.isOpen = !1, a.$dropdown.hide(), a.setActiveOption(null), a.refreshState(), b && a.trigger("dropdown_close", a.$dropdown); }, positionDropdown: function () { var a = this.$control, b = "body" === this.settings.dropdownParent ? a.offset() : a.position(); b.top += a.outerHeight(!0), this.$dropdown.css({ width: a[0].getBoundingClientRect().width, top: b.top, left: b.left }); }, clear: function (a) { var b = this; b.items.length && (b.$control.children(":not(input)").remove(), b.items = [], b.lastQuery = null, b.setCaret(0), b.setActiveItem(null), b.updatePlaceholder(), b.updateOriginalInput({ silent: a }), b.refreshState(), b.showInput(), b.trigger("clear")); }, insertAtCaret: function (a) { var b = Math.min(this.caretPos, this.items.length), c = a[0], d = this.buffer || this.$control[0]; 0 === b ? d.insertBefore(c, d.firstChild) : d.insertBefore(c, d.childNodes[b]), this.setCaret(b + 1); }, deleteSelection: function (b) { var c, d, e, f, g, h, i, j, k, l = this; if (e = b && 8 === b.keyCode ? -1 : 1, f = r(l.$control_input[0]), l.$activeOption && !l.settings.hideSelected && (i = l.getAdjacentOption(l.$activeOption, -1).attr("data-value")), g = [], l.$activeItems.length) {
            for (k = l.$control.children(".active:" + (e > 0 ? "last" : "first")), h = l.$control.children(":not(input)").index(k), e > 0 && h++, c = 0, d = l.$activeItems.length; c < d; c++)
                g.push(a(l.$activeItems[c]).attr("data-value"));
            b && (b.preventDefault(), b.stopPropagation());
        }
        else
            (l.isFocused || "single" === l.settings.mode) && l.items.length && (e < 0 && 0 === f.start && 0 === f.length ? g.push(l.items[l.caretPos - 1]) : e > 0 && f.start === l.$control_input.val().length && g.push(l.items[l.caretPos])); if (!g.length || "function" == typeof l.settings.onDelete && !1 === l.settings.onDelete.apply(l, [g]))
            return !1; for (void 0 !== h && l.setCaret(h); g.length;)
            l.removeItem(g.pop()); return l.showInput(), l.positionDropdown(), l.refreshOptions(!0), i && (j = l.getOption(i), j.length && l.setActiveOption(j)), !0; }, advanceSelection: function (a, b) { var c, d, e, f, g, h = this; 0 !== a && (h.rtl && (a *= -1), c = a > 0 ? "last" : "first", d = r(h.$control_input[0]), h.isFocused && !h.isInputHidden ? (f = h.$control_input.val().length, (a < 0 ? 0 === d.start && 0 === d.length : d.start === f) && !f && h.advanceCaret(a, b)) : (g = h.$control.children(".active:" + c), g.length && (e = h.$control.children(":not(input)").index(g), h.setActiveItem(null), h.setCaret(a > 0 ? e + 1 : e)))); }, advanceCaret: function (a, b) { var c, d, e = this; 0 !== a && (c = a > 0 ? "next" : "prev", e.isShiftDown ? (d = e.$control_input[c](), d.length && (e.hideInput(), e.setActiveItem(d), b && b.preventDefault())) : e.setCaret(e.caretPos + a)); }, setCaret: function (b) { var c = this; if (b = "single" === c.settings.mode ? c.items.length : Math.max(0, Math.min(c.items.length, b)), !c.isPending) {
            var d, e, f, g;
            for (f = c.$control.children(":not(input)"), d = 0, e = f.length; d < e; d++)
                g = a(f[d]).detach(), d < b ? c.$control_input.before(g) : c.$control.append(g);
        } c.caretPos = b; }, lock: function () { this.close(), this.isLocked = !0, this.refreshState(); }, unlock: function () { this.isLocked = !1, this.refreshState(); }, disable: function () { var a = this; a.$input.prop("disabled", !0), a.$control_input.prop("disabled", !0).prop("tabindex", -1), a.isDisabled = !0, a.lock(); }, enable: function () { var a = this; a.$input.prop("disabled", !1), a.$control_input.prop("disabled", !1).prop("tabindex", a.tabIndex), a.isDisabled = !1, a.unlock(); }, destroy: function () { var b = this, c = b.eventNS, d = b.revertSettings; b.trigger("destroy"), b.off(), b.$wrapper.remove(), b.$dropdown.remove(), b.$input.html("").append(d.$children).removeAttr("tabindex").removeClass("selectized").attr({ tabindex: d.tabindex }).show(), b.$control_input.removeData("grow"), b.$input.removeData("selectize"), 0 == --w.count && w.$testInput && (w.$testInput.remove(), w.$testInput = void 0), a(window).off(c), a(document).off(c), a(document.body).off(c), delete b.$input[0].selectize; }, render: function (b, c) { var d, e, f = "", g = !1, h = this; return "option" !== b && "item" !== b || (d = k(c[h.settings.valueField]), g = !!d), g && (j(h.renderCache[b]) || (h.renderCache[b] = {}), h.renderCache[b].hasOwnProperty(d)) ? h.renderCache[b][d] : (f = a(h.settings.render[b].apply(this, [c, l])), "option" === b || "option_create" === b ? c[h.settings.disabledField] || f.attr("data-selectable", "") : "optgroup" === b && (e = c[h.settings.optgroupValueField] || "", f.attr("data-group", e), c[h.settings.disabledField] && f.attr("data-disabled", "")), "option" !== b && "item" !== b || f.attr("data-value", d || ""), g && (h.renderCache[b][d] = f[0]), f[0]); }, clearCache: function (a) { var b = this; void 0 === a ? b.renderCache = {} : delete b.renderCache[a]; }, canCreate: function (a) { var b = this; if (!b.settings.create)
            return !1; var c = b.settings.createFilter; return a.length && ("function" != typeof c || c.apply(b, [a])) && ("string" != typeof c || new RegExp(c).test(a)) && (!(c instanceof RegExp) || c.test(a)); } }), w.count = 0, w.defaults = { options: [], optgroups: [], plugins: [], delimiter: ",", splitOn: null, persist: !0, diacritics: !0, create: !1, createOnBlur: !1, createFilter: null, highlight: !0, openOnFocus: !0, maxOptions: 1e3, maxItems: null, hideSelected: null, addPrecedence: !1, selectOnTab: !1, preload: !1, allowEmptyOption: !1, closeAfterSelect: !1, scrollDuration: 60, loadThrottle: 300, loadingClass: "loading", dataAttr: "data-data", optgroupField: "optgroup", valueField: "value", labelField: "text", disabledField: "disabled", optgroupLabelField: "label", optgroupValueField: "value", lockOptgroupOrder: !1, sortField: "$order", searchField: ["text"], searchConjunction: "and", mode: null, wrapperClass: "selectize-control", inputClass: "selectize-input", dropdownClass: "selectize-dropdown", dropdownContentClass: "selectize-dropdown-content", dropdownParent: null, copyClassesToDropdown: !0, render: {} }, a.fn.selectize = function (b) { var c = a.fn.selectize.defaults, d = a.extend({}, c, b), e = d.dataAttr, f = d.labelField, g = d.valueField, h = d.disabledField, i = d.optgroupField, j = d.optgroupLabelField, l = d.optgroupValueField, m = function (b, c) { var h, i, j, k, l = b.attr(e); if (l)
        for (c.options = JSON.parse(l), h = 0, i = c.options.length; h < i; h++)
            c.items.push(c.options[h][g]);
    else {
        var m = a.trim(b.val() || "");
        if (!d.allowEmptyOption && !m.length)
            return;
        for (j = m.split(d.delimiter), h = 0, i = j.length; h < i; h++)
            k = {}, k[f] = j[h], k[g] = j[h], c.options.push(k);
        c.items = j;
    } }, n = function (b, c) { var m, n, o, p, q = c.options, r = {}, s = function (a) { var b = e && a.attr(e); return "string" == typeof b && b.length ? JSON.parse(b) : null; }, t = function (b, e) { b = a(b); var j = k(b.val()); if (j || d.allowEmptyOption)
        if (r.hasOwnProperty(j)) {
            if (e) {
                var l = r[j][i];
                l ? a.isArray(l) ? l.push(e) : r[j][i] = [l, e] : r[j][i] = e;
            }
        }
        else {
            var m = s(b) || {};
            m[f] = m[f] || b.text(), m[g] = m[g] || j, m[h] = m[h] || b.prop("disabled"), m[i] = m[i] || e, r[j] = m, q.push(m), b.is(":selected") && c.items.push(j);
        } }; for (c.maxItems = b.attr("multiple") ? null : 1, p = b.children(), m = 0, n = p.length; m < n; m++)
        o = p[m].tagName.toLowerCase(), "optgroup" === o ? function (b) { var d, e, f, g, i; for (b = a(b), f = b.attr("label"), f && (g = s(b) || {}, g[j] = f, g[l] = f, g[h] = b.prop("disabled"), c.optgroups.push(g)), i = a("option", b), d = 0, e = i.length; d < e; d++)
            t(i[d], f); }(p[m]) : "option" === o && t(p[m]); }; return this.each(function () { if (!this.selectize) {
        var e = a(this), f = this.tagName.toLowerCase(), g = e.attr("placeholder") || e.attr("data-placeholder");
        g || d.allowEmptyOption || (g = e.children('option[value=""]').text());
        var h = { placeholder: g, options: [], optgroups: [], items: [] };
        "select" === f ? n(e, h) : m(e, h), new w(e, a.extend(!0, {}, c, h, b));
    } }); }, a.fn.selectize.defaults = w.defaults, a.fn.selectize.support = { validity: i }, w.define("drag_drop", function (b) { if (!a.fn.sortable)
        throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".'); if ("multi" === this.settings.mode) {
        var c = this;
        c.lock = function () { var a = c.lock; return function () { var b = c.$control.data("sortable"); return b && b.disable(), a.apply(c, arguments); }; }(), c.unlock = function () { var a = c.unlock; return function () { var b = c.$control.data("sortable"); return b && b.enable(), a.apply(c, arguments); }; }(), c.setup = function () { var b = c.setup; return function () { b.apply(this, arguments); var d = c.$control.sortable({ items: "[data-value]", forcePlaceholderSize: !0, disabled: c.isLocked, start: function (a, b) { b.placeholder.css("width", b.helper.css("width")), d.css({ overflow: "visible" }); }, stop: function () { d.css({ overflow: "hidden" }); var b = c.$activeItems ? c.$activeItems.slice() : null, e = []; d.children("[data-value]").each(function () { e.push(a(this).attr("data-value")); }), c.setValue(e), c.setActiveItem(b); } }); }; }();
    } }), w.define("dropdown_header", function (b) { var c = this; b = a.extend({ title: "Untitled", headerClass: "selectize-dropdown-header", titleRowClass: "selectize-dropdown-header-title", labelClass: "selectize-dropdown-header-label", closeClass: "selectize-dropdown-header-close", html: function (a) { return '<div class="' + a.headerClass + '"><div class="' + a.titleRowClass + '"><span class="' + a.labelClass + '">' + a.title + '</span><a href="javascript:void(0)" class="' + a.closeClass + '">&times;</a></div></div>'; } }, b), c.setup = function () { var d = c.setup; return function () { d.apply(c, arguments), c.$dropdown_header = a(b.html(b)), c.$dropdown.prepend(c.$dropdown_header); }; }(); }), w.define("optgroup_columns", function (b) { var c = this; b = a.extend({ equalizeWidth: !0, equalizeHeight: !0 }, b), this.getAdjacentOption = function (b, c) { var d = b.closest("[data-group]").find("[data-selectable]"), e = d.index(b) + c; return e >= 0 && e < d.length ? d.eq(e) : a(); }, this.onKeyDown = function () { var a = c.onKeyDown; return function (b) { var d, e, f, g; return !this.isOpen || 37 !== b.keyCode && 39 !== b.keyCode ? a.apply(this, arguments) : (c.ignoreHover = !0, g = this.$activeOption.closest("[data-group]"), d = g.find("[data-selectable]").index(this.$activeOption), g = 37 === b.keyCode ? g.prev("[data-group]") : g.next("[data-group]"), f = g.find("[data-selectable]"), e = f.eq(Math.min(f.length - 1, d)), void (e.length && this.setActiveOption(e))); }; }(); var d = function () { var a, b = d.width, c = document; return void 0 === b && (a = c.createElement("div"), a.innerHTML = '<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>', a = a.firstChild, c.body.appendChild(a), b = d.width = a.offsetWidth - a.clientWidth, c.body.removeChild(a)), b; }, e = function () { var e, f, g, h, i, j, k; if (k = a("[data-group]", c.$dropdown_content), (f = k.length) && c.$dropdown_content.width()) {
        if (b.equalizeHeight) {
            for (g = 0, e = 0; e < f; e++)
                g = Math.max(g, k.eq(e).height());
            k.css({ height: g });
        }
        b.equalizeWidth && (j = c.$dropdown_content.innerWidth() - d(), h = Math.round(j / f), k.css({ width: h }), f > 1 && (i = j - h * (f - 1), k.eq(f - 1).css({ width: i })));
    } }; (b.equalizeHeight || b.equalizeWidth) && (m.after(this, "positionDropdown", e), m.after(this, "refreshOptions", e)); }), w.define("remove_button", function (b) { b = a.extend({ label: "&times;", title: "Remove", className: "remove", append: !0 }, b); if ("single" === this.settings.mode)
        return void function (b, c) { c.className = "remove-single"; var d = b, e = '<a href="javascript:void(0)" class="' + c.className + '" tabindex="-1" title="' + l(c.title) + '">' + c.label + "</a>", f = function (b, c) { return a("<span>").append(b).append(c); }; b.setup = function () { var g = d.setup; return function () { if (c.append) {
            var h = a(d.$input.context).attr("id"), i = (a("#" + h), d.settings.render.item);
            d.settings.render.item = function (a) { return f(i.apply(b, arguments), e); };
        } g.apply(b, arguments), b.$control.on("click", "." + c.className, function (a) { a.preventDefault(), d.isLocked || d.clear(); }); }; }(); }(this, b); !function (b, c) { var d = b, e = '<a href="javascript:void(0)" class="' + c.className + '" tabindex="-1" title="' + l(c.title) + '">' + c.label + "</a>", f = function (a, b) { var c = a.search(/(<\/[^>]+>\s*)$/); return a.substring(0, c) + b + a.substring(c); }; b.setup = function () { var g = d.setup; return function () { if (c.append) {
        var h = d.settings.render.item;
        d.settings.render.item = function (a) { return f(h.apply(b, arguments), e); };
    } g.apply(b, arguments), b.$control.on("click", "." + c.className, function (b) { if (b.preventDefault(), !d.isLocked) {
        var c = a(b.currentTarget).parent();
        d.setActiveItem(c), d.deleteSelection() && d.setCaret(d.items.length);
    } }); }; }(); }(this, b); }), w.define("restore_on_backspace", function (a) { var b = this; a.text = a.text || function (a) { return a[this.settings.labelField]; }, this.onKeyDown = function () { var c = b.onKeyDown; return function (b) { var d, e; return 8 === b.keyCode && "" === this.$control_input.val() && !this.$activeItems.length && (d = this.caretPos - 1) >= 0 && d < this.items.length ? (e = this.options[this.items[d]], this.deleteSelection(b) && (this.setTextboxValue(a.text.apply(this, [e])), this.refreshOptions(!0)), void b.preventDefault()) : c.apply(this, arguments); }; }(); }), w;
});
$(document).ready(function () {
    Selectize.define('no_results', function (options) {
        var self = this;
        options = $.extend({
            message: 'No match found',
            html: function (data) {
                return ('<div class="selectize-dropdown ' + data.classNames + '">' +
                    '<div class="selectize-dropdown-content">' +
                    '<div class="no-results">' + data.message + '</div>' +
                    '</div>' +
                    '</div>');
            }
        }, options);
        self.displayEmptyResultsMessage = function () {
            this.$empty_results_container.css('top', this.$control.outerHeight());
            this.$empty_results_container.css('width', this.$control.outerWidth());
            this.$empty_results_container.show();
            this.$control.addClass("dropdown-active");
            this.$dropdown.attr('data-no-match-found', 'true');
        };
        self.refreshOptions = (function () {
            var original = self.refreshOptions;
            return function () {
                original.apply(self, arguments);
                if (this.hasOptions || !this.lastQuery) {
                    this.$empty_results_container.hide();
                    self.$dropdown.removeAttr('data-no-match-found');
                }
                else {
                    this.displayEmptyResultsMessage();
                }
            };
        })();
        self.onKeyDown = (function () {
            var original = self.onKeyDown;
            return function (e) {
                original.apply(self, arguments);
                if (e.keyCode === 27) {
                    this.$empty_results_container.hide();
                }
            };
        })();
        self.onBlur = (function () {
            var original = self.onBlur;
            return function () {
                original.apply(self, arguments);
                this.$empty_results_container.hide();
                this.$control.removeClass("dropdown-active");
            };
        })();
        self.setup = (function () {
            var original = self.setup;
            return function () {
                original.apply(self, arguments);
                self.$empty_results_container = $(options.html($.extend({
                    classNames: self.$input.attr('class')
                }, options)));
                self.$empty_results_container.insertBefore(self.$dropdown);
                self.$empty_results_container.hide();
            };
        })();
    });
    Selectize.define("start_typing", function (options) {
        var self = this;
        var KEY_BACKSPACE = 8;
        this.onKeyDown = (function (e) {
            var original = self.onKeyDown;
            return function (e) {
                if ((self.settings.maxItems === null || self.settings.maxItems === 1) && (self.isFull() || self.isInputHidden)) {
                    var oldargs = arguments, keycode = e.keyCode, valid = (keycode > 47 && keycode < 58) ||
                        (keycode === 32) ||
                        (keycode > 64 && keycode < 91) ||
                        (keycode > 95 && keycode < 112) ||
                        (keycode > 185 && keycode < 193) ||
                        (keycode > 218 && keycode < 223);
                    if (valid) {
                        e.keyCode = KEY_BACKSPACE;
                        self.deleteSelection(e);
                    }
                }
                return original.apply(self, arguments);
            };
        })();
    });
    Selectize.define('dropdown_direction', function (options) {
        var self = this;
        self.on('dropdown_open', function () {
            setTimeout(function () {
                self.calculatePositionDropdown();
            });
        });
        self.calculatePositionDropdown = (function () {
            return function () {
                var $control = self.$control, $dropdown = self.$dropdown, p = getPositions(), direction = getDropdownDirection(p);
                if (direction === 'up') {
                    $dropdown.addClass('direction-up').removeClass('direction-down');
                }
                else {
                    $dropdown.addClass('direction-down').removeClass('direction-up');
                }
                $control.attr('data-dropdown-direction', direction);
                var isParentBody = self.settings.dropdownParent === 'body', offset = isParentBody ? $control.offset() : $control.position(), fittedHeight;
                switch (direction) {
                    case 'up':
                        offset.top -= p.dropdown.height + 10;
                        if (p.dropdown.height > p.control.above) {
                            fittedHeight = p.control.above - 15;
                        }
                        break;
                    case 'down':
                        offset.top += p.control.height;
                        if (p.dropdown.height > p.control.below) {
                            fittedHeight = p.control.below - 15;
                        }
                        break;
                }
                if (fittedHeight) {
                    self.$dropdown_content.css({ 'max-height': fittedHeight });
                }
                if (offset.top) {
                    self.$dropdown.css({ top: offset.top });
                }
                if (offset.left) {
                    self.$dropdown.css({ left: offset.left });
                }
                self.$dropdown.css({ width: $control.outerWidth() });
                self.$wrapper.removeClass('dropdown-direction-plugin');
            };
        })();
        function getDropdownDirection(positions) {
            var direction = self.settings.dropdownDirection;
            if (typeof direction === 'undefined') {
                direction = 'auto';
            }
            if (direction === 'auto') {
                if (positions.control.below > positions.dropdown.height) {
                    direction = 'down';
                }
                else {
                    direction = (positions.control.above > positions.control.below) ? 'up' : 'down';
                }
            }
            return direction;
        }
        function getPositions() {
            var $control = self.$control, $window = $(window), control_height = $control.outerHeight(false), control_above = $control.offset().top - $window.scrollTop(), control_below = $window.height() - control_above - control_height, dropdown_height = self.$dropdown.outerHeight(false);
            return {
                control: {
                    height: control_height,
                    above: control_above,
                    below: control_below
                },
                dropdown: {
                    height: dropdown_height
                }
            };
        }
    });
    Selectize.define("scroll_dropdown_view_on_selected_item_top", function (options) {
        var self = this;
        self.on('dropdown_open', function () {
            setTimeout(function () {
                scrollDropdownViewToItemTop(self);
            });
        });
        function scrollDropdownViewToItemTop(select) {
            var option_select;
            if (select.$activeOption && !select.settings.hideSelected) {
                option_select = select.getAdjacentOption(select.$activeOption, 0).attr('data-value');
            }
            if (option_select) {
                var height_menu, height_item, y;
                var scroll_top, scroll_bottom;
                height_menu = select.$dropdown_content.height();
                height_item = select.$activeOption.outerHeight(true);
                scroll = select.$dropdown_content.scrollTop() || 0;
                y = select.$activeOption.offset().top - select.$dropdown_content.offset().top + scroll;
                scroll_top = y;
                scroll_bottom = y - height_menu + height_item;
                select.$dropdown_content.stop().animate({ scrollTop: scroll_top }, 0);
            }
        }
    });
});
var ContextMenu = (function () {
    function ContextMenu(config, jq, id) {
        this.items = [];
        this.selectedOptionIndex = null;
        this.id = id;
        this.config = config || [];
        this.modal = document.createElement('div');
        this.rootElement = document.createElement('div');
        this.modal.appendChild(this.rootElement);
        this.modal.className = 'ui-context-menu';
        this.rootElement.className = 'context-menu';
        this.rootElement.id = id;
        this.jq = jq;
        this.modal.tabIndex = 0;
        this.initializeItems();
        this.initializeEvents();
        if (!ContextMenu.isBodyEventAdded) {
            this.jq(document.body).on('mousewheel', '.ui-context-menu', function (e) {
                if (this === (e.target || e.srcElement)) {
                    ContextMenu.closeAll();
                }
            });
            ContextMenu.isBodyEventAdded = true;
        }
    }
    ContextMenu.prototype.initializeItems = function () {
        for (var i = 0, len = this.config.length; i < len; i++) {
            if (typeof this.items[i] === 'undefined') {
                this.items.push((function (config) {
                    var option = document.createElement('div');
                    if (config === null) {
                        option.className = 'separator';
                    }
                    else {
                        var icon = document.createElement('span'), label = document.createTextNode(config.label);
                        option.className = 'option';
                        option.setAttribute('data-role', config.action);
                        icon.className = config.icon;
                        option.appendChild(icon);
                        option.appendChild(label);
                        if (config.disabled) {
                            option.classList.add('disabled');
                        }
                    }
                    return option;
                })(this.config[i]));
            }
            if (this.config[i] !== null) {
                if (!this.config[i].visible) {
                    this.items[i].style.display = 'none';
                }
                else {
                    this.items[i].style.display = 'block';
                }
            }
            this.items[i].setAttribute('option-index', String(i));
            this.rootElement.appendChild(this.items[i]);
        }
    };
    ContextMenu.prototype.initializeEvents = function () {
        (function (self) {
            self.jq(self.rootElement).on('mouseenter', '.option', function (e) {
                var optionIndex = ~~self.jq(this).attr('option-index');
                self.setSelectedOption(optionIndex);
            });
            self.jq(self.rootElement).on('click', '.option', function (e) {
                var optionIndex = ~~self.jq(this).attr('option-index');
                self.fireItemByIndex(optionIndex);
            });
            self.jq(self.modal).on('mouseup', function (ev) {
                var target = ev.target || ev.srcElement;
                if (target === self.modal) {
                    self.close();
                    ev.preventDefault();
                    ev.stopPropagation();
                }
            });
            self.modal.addEventListener('keydown', function (ev) {
                var code = ev.keyCode || ev.charCode;
                switch (code) {
                    case 13:
                        self.fireCurrentItemIfPossible();
                        break;
                    case 27:
                        self.close();
                        break;
                    case 40:
                        self.focusNext();
                        break;
                    case 38:
                        self.focusPrev();
                        break;
                    case 39:
                        break;
                    case 37:
                        break;
                    default:
                        console.log(code);
                        break;
                }
                ev.preventDefault();
                ev.stopPropagation();
            }, true);
        })(this);
    };
    ContextMenu.prototype.getNextFocusableOptionIndex = function (relativeTo, direction) {
        var startIndex = -1, stopIndex = 0;
        if (relativeTo === null) {
            switch (direction) {
                case -1:
                    startIndex = this.config.length - 1;
                    stopIndex = 0;
                    break;
                case 1:
                    startIndex = 0;
                    stopIndex = this.config.length - 1;
                    break;
            }
        }
        else {
            startIndex = relativeTo + direction;
            stopIndex = relativeTo;
        }
        while (startIndex !== stopIndex) {
            if (startIndex < 0) {
                startIndex = this.config.length - 1;
            }
            else {
                if (startIndex >= this.config.length) {
                    startIndex = 0;
                }
            }
            if (this.isSelectable(startIndex)) {
                return startIndex;
            }
            startIndex += direction;
        }
        return null;
    };
    ContextMenu.prototype.focusPrev = function () {
        var opt = this.getNextFocusableOptionIndex(this.selectedOptionIndex, -1);
        if (opt !== null) {
            this.setSelectedOption(opt);
        }
    };
    ContextMenu.prototype.focusNext = function () {
        var opt = this.getNextFocusableOptionIndex(this.selectedOptionIndex, 1);
        if (opt !== null) {
            this.setSelectedOption(opt);
        }
    };
    ContextMenu.prototype.withConfig = function (config) {
        this.config = config;
        this.initializeItems();
        return this;
    };
    ContextMenu.prototype.resetCSSPosition = function () {
        this.rootElement.style.left = this.rootElement.style.right = this.rootElement.style.bottom = this.rootElement.style.top = '';
    };
    ContextMenu.prototype.anchorToElement = function (element) {
        if (!element) {
            return;
        }
        var elementWindow = element.getBoundingClientRect(), menuWindow = this.rootElement.getBoundingClientRect(), windowRect = this.modal.getBoundingClientRect(), elementWindowHorizontal = {
            "left": elementWindow.left,
            "top": elementWindow.top - ContextMenu.anchorDistance,
            "right": elementWindow.right,
            "bottom": elementWindow.bottom + ContextMenu.anchorDistance,
            "width": elementWindow.width,
            "height": elementWindow.height + 2 * ContextMenu.anchorDistance
        }, elementWindowVertical = {
            "left": elementWindow.left - ContextMenu.anchorDistance,
            "top": elementWindow.top,
            "right": elementWindow.right + ContextMenu.anchorDistance,
            "bottom": elementWindow.bottom,
            "width": elementWindow.width + 2 * ContextMenu.anchorDistance,
            "height": elementWindow.height
        };
        if (elementWindowHorizontal.left + menuWindow.width < windowRect.width && elementWindowHorizontal.bottom + menuWindow.height < windowRect.height) {
            this.rootElement.style.left = elementWindowHorizontal.left + "px";
            this.rootElement.style.top = elementWindowHorizontal.bottom + "px";
            return;
        }
        if (elementWindowVertical.left + menuWindow.width < windowRect.width && elementWindowVertical.top - menuWindow.height > 0) {
            this.rootElement.style.left = elementWindowHorizontal.left + "px";
            this.rootElement.style.top = elementWindowHorizontal.top - menuWindow.height + "px";
            return;
        }
        if (elementWindowHorizontal.right - menuWindow.width > 0 && elementWindowHorizontal.bottom + menuWindow.height < windowRect.height) {
            this.rootElement.style.left = elementWindowHorizontal.right - menuWindow.width + "px";
            this.rootElement.style.top = elementWindowHorizontal.bottom + "px";
            return;
        }
        if (elementWindowHorizontal.right - menuWindow.width > 0 && elementWindowHorizontal.top - menuWindow.height > 0) {
            this.rootElement.style.left = elementWindowHorizontal.right - menuWindow.width + "px";
            this.rootElement.style.top = elementWindowHorizontal.top - menuWindow.height + "px";
            return;
        }
        var x = ~~(windowRect.width / 2 - menuWindow.width / 2), y = ~~(windowRect.height / 2 - menuWindow.height / 2);
        if (x < 0) {
            x = 0;
        }
        if (y < 0) {
            y = 0;
        }
        if (elementWindowVertical.right + menuWindow.width < windowRect.width) {
            x = elementWindowVertical.right;
        }
        else if (elementWindowVertical.left - menuWindow.width > 0) {
            x = elementWindowVertical.left - menuWindow.width;
        }
        this.rootElement.style.left = x + "px";
        this.rootElement.style.top = y + "px";
    };
    ContextMenu.prototype.openAt = function (element) {
        this.anchorElement = element;
        this.resetCSSPosition();
        this.jq(this.anchorElement).addClass('pressed');
        this.selectedOptionIndex = null;
        this.setSelectedOption(null);
        this.jq(document.body).addClass('has-context-menu').addClass(this.id);
        document.body.appendChild(this.modal);
        this.anchorToElement(element);
        (function (self) {
            setTimeout(function () {
                self.modal.focus();
            }, 10);
        })(this);
        return this;
    };
    ContextMenu.prototype.isSelectable = function (itemIndex) {
        return this.config[itemIndex] && this.config[itemIndex].visible && !this.config[itemIndex].disabled;
    };
    ContextMenu.prototype.setSelectedOption = function (index) {
        for (var i = 0, len = this.items.length; i < len; i++) {
            if (i !== index) {
                this.jq(this.items[i]).removeClass('selected');
            }
        }
        if (this.isSelectable(index)) {
            this.jq(this.items[index]).addClass('selected');
            this.selectedOptionIndex = index;
        }
    };
    ContextMenu.prototype.fireCurrentItemIfPossible = function () {
        this.fireItemByIndex(this.selectedOptionIndex);
    };
    ContextMenu.prototype.fireItemByIndex = function (itemIndex) {
        if (this.isSelectable(itemIndex)) {
            if (this.config[itemIndex].callback) {
                this.config[itemIndex].callback(this.config[itemIndex].action);
            }
            this.close();
        }
    };
    ContextMenu.prototype.close = function () {
        if (this.modal.parentNode) {
            this.modal.parentNode.removeChild(this.modal);
        }
        if (this.anchorElement) {
            this.jq(this.anchorElement).removeClass('pressed');
        }
        this.jq(document.body).removeClass('has-context-menu').removeClass(this.id);
        return this;
    };
    ContextMenu.withJQuery = function (jq) {
        ContextMenu.JQuery = jq;
        return ContextMenu;
    };
    ContextMenu.createAt = function (element, contextMenuId, contextMenuConfig) {
        if (ContextMenu.instances[contextMenuId]) {
            return ContextMenu.instances[contextMenuId].withConfig(contextMenuConfig).openAt(element);
        }
        else {
            return ContextMenu.instances[contextMenuId] = new ContextMenu(contextMenuConfig, ContextMenu.JQuery, contextMenuId).openAt(element);
        }
    };
    ContextMenu.closeAll = function () {
        for (var k in ContextMenu.instances) {
            if (ContextMenu.instances.hasOwnProperty(k)) {
                ContextMenu.instances[k].close();
            }
        }
    };
    ContextMenu.anchorDistance = 4;
    ContextMenu.instances = {};
    ContextMenu.JQuery = null;
    ContextMenu.isBodyEventAdded = false;
    return ContextMenu;
}());
window.addEventListener('resize', function (e) {
    ContextMenu.closeAll();
});
var EDialogButtonType;
(function (EDialogButtonType) {
    EDialogButtonType[EDialogButtonType["OK"] = 0] = "OK";
    EDialogButtonType[EDialogButtonType["CANCEL"] = 1] = "CANCEL";
    EDialogButtonType[EDialogButtonType["YES"] = 2] = "YES";
    EDialogButtonType[EDialogButtonType["NO"] = 3] = "NO";
    EDialogButtonType[EDialogButtonType["ABORT"] = 4] = "ABORT";
    EDialogButtonType[EDialogButtonType["RETRY"] = 5] = "RETRY";
    EDialogButtonType[EDialogButtonType["IGNORE"] = 6] = "IGNORE";
    EDialogButtonType[EDialogButtonType["SAVE"] = 7] = "SAVE";
    EDialogButtonType[EDialogButtonType["CHANGE"] = 8] = "CHANGE";
    EDialogButtonType[EDialogButtonType["DELETE"] = 9] = "DELETE";
    EDialogButtonType[EDialogButtonType["DOWNLOAD"] = 10] = "DOWNLOAD";
    EDialogButtonType[EDialogButtonType["CLOSE"] = 11] = "CLOSE";
    EDialogButtonType[EDialogButtonType["ENABLE_COMPLIANCE"] = 12] = "ENABLE_COMPLIANCE";
    EDialogButtonType[EDialogButtonType["DISABLE_COMPLIANCE"] = 13] = "DISABLE_COMPLIANCE";
    EDialogButtonType[EDialogButtonType["CREATE"] = 14] = "CREATE";
    EDialogButtonType[EDialogButtonType["DONE"] = 15] = "DONE";
    EDialogButtonType[EDialogButtonType["TRY_FORM"] = 16] = "TRY_FORM";
    EDialogButtonType[EDialogButtonType["NO_THANKS"] = 17] = "NO_THANKS";
    EDialogButtonType[EDialogButtonType["MAYBE_LATER"] = 18] = "MAYBE_LATER";
    EDialogButtonType[EDialogButtonType["UPDATE"] = 19] = "UPDATE";
    EDialogButtonType[EDialogButtonType["UPGRADE_NOW"] = 20] = "UPGRADE_NOW";
    EDialogButtonType[EDialogButtonType["UPGRADE_NOW_PAYWALL"] = 21] = "UPGRADE_NOW_PAYWALL";
    EDialogButtonType[EDialogButtonType["CONTINUE"] = 22] = "CONTINUE";
    EDialogButtonType[EDialogButtonType["KEEP_EDITING_FORM"] = 23] = "KEEP_EDITING_FORM";
    EDialogButtonType[EDialogButtonType["CLOSE_EDITOR"] = 24] = "CLOSE_EDITOR";
    EDialogButtonType[EDialogButtonType["IMPORT"] = 25] = "IMPORT";
    EDialogButtonType[EDialogButtonType["ADD_DOMAIN"] = 26] = "ADD_DOMAIN";
    EDialogButtonType[EDialogButtonType["VALIDATE"] = 27] = "VALIDATE";
    EDialogButtonType[EDialogButtonType["FORM_MIGRATE"] = 28] = "FORM_MIGRATE";
    EDialogButtonType[EDialogButtonType["UPGRADE_TO_ENTERPRISE"] = 29] = "UPGRADE_TO_ENTERPRISE";
})(EDialogButtonType || (EDialogButtonType = {}));
var ENotificationStyle;
(function (ENotificationStyle) {
    ENotificationStyle[ENotificationStyle["DEFAULT"] = 0] = "DEFAULT";
    ENotificationStyle[ENotificationStyle["SUCCESS"] = 1] = "SUCCESS";
    ENotificationStyle[ENotificationStyle["ERROR"] = 2] = "ERROR";
})(ENotificationStyle || (ENotificationStyle = {}));
var EFileClass;
(function (EFileClass) {
    EFileClass[EFileClass["VIDEO"] = 0] = "VIDEO";
    EFileClass[EFileClass["AUDIO"] = 1] = "AUDIO";
    EFileClass[EFileClass["DOCUMENT"] = 2] = "DOCUMENT";
    EFileClass[EFileClass["PICTURE"] = 3] = "PICTURE";
    EFileClass[EFileClass["OTHER"] = 4] = "OTHER";
})(EFileClass || (EFileClass = {}));
var EDataGridColumnType;
(function (EDataGridColumnType) {
    EDataGridColumnType[EDataGridColumnType["STRING"] = 0] = "STRING";
    EDataGridColumnType[EDataGridColumnType["NUMBER"] = 1] = "NUMBER";
    EDataGridColumnType[EDataGridColumnType["BOOLEAN"] = 2] = "BOOLEAN";
    EDataGridColumnType[EDataGridColumnType["UNKNOWN"] = 3] = "UNKNOWN";
})(EDataGridColumnType || (EDataGridColumnType = {}));
var ENotificationTooltipPlacement;
(function (ENotificationTooltipPlacement) {
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["TOP_LEFT"] = 0] = "TOP_LEFT";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["TOP_CENTER"] = 1] = "TOP_CENTER";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["TOP_RIGHT"] = 2] = "TOP_RIGHT";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["LEFT"] = 3] = "LEFT";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["CENTER"] = 4] = "CENTER";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["RIGHT"] = 5] = "RIGHT";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["BOTTOM_LEFT"] = 6] = "BOTTOM_LEFT";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["BOTTOM_CENTER"] = 7] = "BOTTOM_CENTER";
    ENotificationTooltipPlacement[ENotificationTooltipPlacement["BOTTOM_RIGHT"] = 8] = "BOTTOM_RIGHT";
})(ENotificationTooltipPlacement || (ENotificationTooltipPlacement = {}));
var ENotificationTooltipType;
(function (ENotificationTooltipType) {
    ENotificationTooltipType[ENotificationTooltipType["DEFAULT"] = 0] = "DEFAULT";
    ENotificationTooltipType[ENotificationTooltipType["WARNING"] = 1] = "WARNING";
    ENotificationTooltipType[ENotificationTooltipType["ERROR"] = 2] = "ERROR";
})(ENotificationTooltipType || (ENotificationTooltipType = {}));
var EHTTPCodes;
(function (EHTTPCodes) {
    EHTTPCodes[EHTTPCodes["PAYMENT_REQUIRED"] = 402] = "PAYMENT_REQUIRED";
})(EHTTPCodes || (EHTTPCodes = {}));
var EI18nLanguageSubset;
(function (EI18nLanguageSubset) {
    EI18nLanguageSubset[EI18nLanguageSubset["ALL"] = 0] = "ALL";
    EI18nLanguageSubset[EI18nLanguageSubset["JS_STRINGS_ONLY"] = 1] = "JS_STRINGS_ONLY";
    EI18nLanguageSubset[EI18nLanguageSubset["VIEW_FORM_SUBSET"] = 2] = "VIEW_FORM_SUBSET";
})(EI18nLanguageSubset || (EI18nLanguageSubset = {}));
var ERecentActivityIntervalKeys;
(function (ERecentActivityIntervalKeys) {
    ERecentActivityIntervalKeys["TODAY"] = "today";
    ERecentActivityIntervalKeys["YESTERDAY"] = "yesterday";
    ERecentActivityIntervalKeys["THE_DAY_BEFORE_YESTERDAY"] = "the_day_before_yesterday";
    ERecentActivityIntervalKeys["THIS_WEEK"] = "this_week";
    ERecentActivityIntervalKeys["PREVIOUS_WEEK"] = "previous_week";
    ERecentActivityIntervalKeys["TWO_WEEKS_AGO"] = "two_weeks_ago";
    ERecentActivityIntervalKeys["THIS_MONTH"] = "this_month";
    ERecentActivityIntervalKeys["PREVIOUS_MONTH"] = "previous_month";
    ERecentActivityIntervalKeys["TWO_MONTHS_AGO"] = "two_months_ago";
})(ERecentActivityIntervalKeys || (ERecentActivityIntervalKeys = {}));
var EBuilderPublishTabs;
(function (EBuilderPublishTabs) {
    EBuilderPublishTabs["PUBLISH_EMBED"] = "page_view_publish_embed";
    EBuilderPublishTabs["JAVASCRIPT"] = "javascript-publish-method";
    EBuilderPublishTabs["SHOPIFY_PLATFORM"] = "PublishPlatformsOnShopify";
    EBuilderPublishTabs["SHOPIFY_PUBLISH"] = "shopify-publish-method";
    EBuilderPublishTabs["BIG_COMMERCE_PLATFORM"] = "PublishPlatformsOnBigCommerce";
    EBuilderPublishTabs["BIG_COMMERCE_PUBLISH"] = "bigcommerce-publish-method";
    EBuilderPublishTabs["FACEBOOK_PLATFORM"] = "PublishFacebook";
    EBuilderPublishTabs["FACEBOOK_PUBLISH"] = "facebook-publish-method";
    EBuilderPublishTabs["BLOGGER"] = "blogger-publish-method";
    EBuilderPublishTabs["WORDPRESS"] = "wordpress-publish-method";
    EBuilderPublishTabs["JOOMLA"] = "joomla-publish-method";
    EBuilderPublishTabs["SALESFORCE"] = "salesforce-publish-method";
    EBuilderPublishTabs["SALESFORCE_COMMUNITY"] = "salesforce-community-publish-method";
    EBuilderPublishTabs["UNBOUNCE"] = "unbounce-publish-method";
    EBuilderPublishTabs["GOOGLE"] = "google-sites-publish-method";
    EBuilderPublishTabs["TWITTER"] = "twitter-publish-method";
})(EBuilderPublishTabs || (EBuilderPublishTabs = {}));
var ECookieSameSite;
(function (ECookieSameSite) {
    ECookieSameSite["COOKIE_SAME_SITE_STRICT"] = "Strict";
    ECookieSameSite["COOKIE_SAME_SITE_LAX"] = "Lax";
    ECookieSameSite["COOKIE_SAME_SITE_NONE"] = "None";
})(ECookieSameSite || (ECookieSameSite = {}));
var EErrorPriority;
(function (EErrorPriority) {
    EErrorPriority["DEBUG"] = "debug";
    EErrorPriority["INFO"] = "info";
    EErrorPriority["NOTICE"] = "notice";
    EErrorPriority["WARNING"] = "warning";
    EErrorPriority["ERROR"] = "error";
    EErrorPriority["CRITICAL"] = "critical";
    EErrorPriority["ALERT"] = "alert";
    EErrorPriority["EMERGENCY"] = "emergency";
})(EErrorPriority || (EErrorPriority = {}));
var Tooltip = (function () {
    function Tooltip(element) {
        this.element = element;
        this.tooltip = document.createElement('div');
        this.tooltip.textContent = Tooltip.jq(this.element).attr('ui-title') || '';
        this.tooltip.className = 'ui-tooltip';
        document.body.appendChild(this.tooltip);
        this.anchorTooltip();
    }
    Tooltip.prototype.destroy = function () {
        if (this.tooltip && this.tooltip.parentNode) {
            this.tooltip.parentNode.removeChild(this.tooltip);
        }
    };
    Tooltip.prototype.anchorTooltip = function () {
        var elementWindow = this.element.getBoundingClientRect(), tooltipWindow = this.tooltip.getBoundingClientRect(), position = ElementPosition.getAnchorPosition(elementWindow, tooltipWindow, Tooltip.distance, [
            'center-top',
            'center-bottom',
            'center-right',
            'center-left'
        ]);
        this.tooltip.style.left = position.left + "px";
        this.tooltip.style.top = position.top + "px";
        this.tooltip.setAttribute('ui-anchor-mode', position.mode);
    };
    Tooltip.init = function (jQuery) {
        Tooltip.jq = jQuery;
        (function ($) {
            var body = $('body');
            body.on('mouseenter', '[ui-title]', function (e) {
                if (Tooltip.instance) {
                    Tooltip.instance.destroy();
                }
                Tooltip.instance = new Tooltip(this);
            });
            body.on('mouseleave', '[ui-title]', function (e) {
                if (Tooltip.instance) {
                    Tooltip.instance.destroy();
                    Tooltip.instance = null;
                }
            });
            setInterval(function () {
                if (Tooltip.instance) {
                    try {
                        Tooltip.instance.anchorTooltip();
                    }
                    catch (e) { }
                }
            }, 10);
        })(Tooltip.jq);
    };
    Tooltip.distance = 14;
    return Tooltip;
}());
var EventEmitter = (function () {
    function EventEmitter() {
    }
    EventEmitter.prototype.isEventTriggeringEnabled = function () {
        return !!!this.disableEventTriggering;
    };
    EventEmitter.prototype.on = function (eventName, callback) {
        if (this.events === undefined) {
            this.events = {};
        }
        if (this.events[eventName] === undefined) {
            this.events[eventName] = [];
        }
        this.events[eventName].push(callback);
        return this;
    };
    EventEmitter.prototype.off = function (eventName, callback) {
        if (this.events === undefined) {
            return this;
        }
        if (this.events[eventName] === undefined) {
            return this;
        }
        if (callback === undefined) {
            delete this.events[eventName];
        }
        else {
            for (var i = 0, len = this.events[eventName].length; i < len; i++) {
                if (this.events[eventName][i] === callback) {
                    this.events[eventName].splice(i, 1);
                    break;
                }
            }
            if (this.events[eventName].length === 0) {
                delete this.events[eventName];
            }
        }
        return this;
    };
    EventEmitter.prototype.disableEvents = function () {
        this.disableEventTriggering = true;
        return this;
    };
    EventEmitter.prototype.enableEvents = function () {
        this.disableEventTriggering = undefined;
        return this;
    };
    EventEmitter.prototype.enableSyncMode = function () {
        this.syncMode = true;
        return this;
    };
    EventEmitter.prototype.disableSyncMode = function () {
        this.syncMode = undefined;
        return this;
    };
    EventEmitter.prototype.trigger = function (eventName) {
        var eventArgs = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            eventArgs[_i - 1] = arguments[_i];
        }
        if (!this.disableEventTriggering && this.events !== undefined) {
            if (this.events[eventName] !== undefined) {
                (function (self) {
                    for (var i = 0, len = self.events[eventName].length; i < len; i++) {
                        if (self.syncMode) {
                            self.events[eventName][i].apply(self, eventArgs);
                        }
                        else {
                            (function (callback) {
                                setTimeout(function () {
                                    callback.apply(self, eventArgs);
                                });
                            })(self.events[eventName][i]);
                        }
                    }
                })(this);
            }
        }
        return this;
    };
    return EventEmitter;
}());
var Throttle = (function () {
    function Throttle() {
    }
    Throttle.create = function (callback, interval) {
        var timer = null;
        return function () {
            clearTimeout(timer);
            timer = setTimeout(function () {
                callback();
            }, interval);
        };
    };
    return Throttle;
}());
var Debounce = (function () {
    function Debounce() {
    }
    Debounce.create = function (func, wait, immediate) {
        var _this = this;
        if (immediate === void 0) { immediate = false; }
        var timeoutId;
        return function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            var doLater = function () {
                timeoutId = undefined;
                if (!immediate) {
                    func.apply(_this, args);
                }
            };
            var shouldCallNow = immediate && timeoutId === undefined;
            if (timeoutId !== undefined) {
                clearTimeout(timeoutId);
            }
            timeoutId = setTimeout(doLater.bind(_this), wait);
            if (shouldCallNow) {
                func.apply(_this, args);
            }
        };
    };
    return Debounce;
}());
var UUID = (function () {
    function UUID() {
    }
    UUID.init = function () {
        var counter = 0, lastNumber = 0, lastString = '';
        Object.defineProperty(UUID, 'nextNumber', {
            get: function () {
                counter++;
                return lastNumber = counter;
            },
            configurable: false,
        });
        Object.defineProperty(UUID, 'nextString', {
            get: function () {
                counter++;
                return lastString = String(counter);
            },
            configurable: false,
        });
        Object.defineProperty(UUID, 'lastNumber', {
            get: function () {
                return lastNumber;
            }
        });
        Object.defineProperty(UUID, 'lastString', {
            get: function () {
                return lastString;
            }
        });
    };
    return UUID;
}());
UUID.init();
var Hash = (function () {
    function Hash() {
    }
    Hash.MD5 = function (string) {
        function RotateLeft(lValue, iShiftBits) {
            return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));
        }
        function AddUnsigned(lX, lY) {
            var lX4, lY4, lX8, lY8, lResult;
            lX8 = (lX & 0x80000000);
            lY8 = (lY & 0x80000000);
            lX4 = (lX & 0x40000000);
            lY4 = (lY & 0x40000000);
            lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
            if (lX4 & lY4) {
                return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
            }
            if (lX4 | lY4) {
                if (lResult & 0x40000000) {
                    return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
                }
                else {
                    return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
                }
            }
            else {
                return (lResult ^ lX8 ^ lY8);
            }
        }
        function F(x, y, z) {
            return (x & y) | ((~x) & z);
        }
        function G(x, y, z) {
            return (x & z) | (y & (~z));
        }
        function H(x, y, z) {
            return (x ^ y ^ z);
        }
        function I(x, y, z) {
            return (y ^ (x | (~z)));
        }
        function FF(a, b, c, d, x, s, ac) {
            a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
            return AddUnsigned(RotateLeft(a, s), b);
        }
        ;
        function GG(a, b, c, d, x, s, ac) {
            a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
            return AddUnsigned(RotateLeft(a, s), b);
        }
        ;
        function HH(a, b, c, d, x, s, ac) {
            a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
            return AddUnsigned(RotateLeft(a, s), b);
        }
        ;
        function II(a, b, c, d, x, s, ac) {
            a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
            return AddUnsigned(RotateLeft(a, s), b);
        }
        ;
        function ConvertToWordArray(string) {
            var lWordCount;
            var lMessageLength = string.length;
            var lNumberOfWords_temp1 = lMessageLength + 8;
            var lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
            var lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
            var lWordArray = Array(lNumberOfWords - 1);
            var lBytePosition = 0;
            var lByteCount = 0;
            while (lByteCount < lMessageLength) {
                lWordCount = (lByteCount - (lByteCount % 4)) / 4;
                lBytePosition = (lByteCount % 4) * 8;
                lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount) << lBytePosition));
                lByteCount++;
            }
            lWordCount = (lByteCount - (lByteCount % 4)) / 4;
            lBytePosition = (lByteCount % 4) * 8;
            lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
            lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
            lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
            return lWordArray;
        }
        ;
        function WordToHex(lValue) {
            var WordToHexValue = "", WordToHexValue_temp = "", lByte, lCount;
            for (lCount = 0; lCount <= 3; lCount++) {
                lByte = (lValue >>> (lCount * 8)) & 255;
                WordToHexValue_temp = "0" + lByte.toString(16);
                WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length - 2, 2);
            }
            return WordToHexValue;
        }
        ;
        var x = Array();
        var k, AA, BB, CC, DD, a, b, c, d;
        var S11 = 7, S12 = 12, S13 = 17, S14 = 22;
        var S21 = 5, S22 = 9, S23 = 14, S24 = 20;
        var S31 = 4, S32 = 11, S33 = 16, S34 = 23;
        var S41 = 6, S42 = 10, S43 = 15, S44 = 21;
        string = this.utf8Encode(string);
        x = ConvertToWordArray(string);
        a = 0x67452301;
        b = 0xEFCDAB89;
        c = 0x98BADCFE;
        d = 0x10325476;
        for (k = 0; k < x.length; k += 16) {
            AA = a;
            BB = b;
            CC = c;
            DD = d;
            a = FF(a, b, c, d, x[k + 0], S11, 0xD76AA478);
            d = FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
            c = FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
            b = FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
            a = FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
            d = FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
            c = FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
            b = FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
            a = FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
            d = FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
            c = FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
            b = FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
            a = FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
            d = FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
            c = FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
            b = FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
            a = GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
            d = GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
            c = GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
            b = GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
            a = GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
            d = GG(d, a, b, c, x[k + 10], S22, 0x2441453);
            c = GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
            b = GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
            a = GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
            d = GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
            c = GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
            b = GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
            a = GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
            d = GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
            c = GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
            b = GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
            a = HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
            d = HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
            c = HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
            b = HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
            a = HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
            d = HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
            c = HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
            b = HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
            a = HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
            d = HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA);
            c = HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
            b = HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
            a = HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
            d = HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
            c = HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
            b = HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
            a = II(a, b, c, d, x[k + 0], S41, 0xF4292244);
            d = II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
            c = II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
            b = II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
            a = II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
            d = II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
            c = II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
            b = II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
            a = II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
            d = II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
            c = II(c, d, a, b, x[k + 6], S43, 0xA3014314);
            b = II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
            a = II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
            d = II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
            c = II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
            b = II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
            a = AddUnsigned(a, AA);
            b = AddUnsigned(b, BB);
            c = AddUnsigned(c, CC);
            d = AddUnsigned(d, DD);
        }
        var temp = WordToHex(a) + WordToHex(b) + WordToHex(c) + WordToHex(d);
        return temp.toLowerCase();
    };
    Hash.hexEncode = function (str) {
        var bytes = [], chars;
        for (var i = 0, len = str.length; i < len; i++) {
            chars = str.charCodeAt(i).toString(16);
            bytes.push(chars.length === 2 ? chars : '0' + chars);
        }
        return bytes.join('');
    };
    Hash.utf8Encode = function (str) {
        str = str.replace(/\r\n/g, '\n');
        var utftext = '';
        for (var n = 0; n < str.length; n++) {
            var c = str.charCodeAt(n);
            if (c < 128) {
                utftext += String.fromCharCode(c);
            }
            else if ((c > 127) && (c < 2048)) {
                utftext += String.fromCharCode((c >> 6) | 192);
                utftext += String.fromCharCode((c & 63) | 128);
            }
            else {
                utftext += String.fromCharCode((c >> 12) | 224);
                utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                utftext += String.fromCharCode((c & 63) | 128);
            }
        }
        return utftext;
    };
    return Hash;
}());
var UrlUtils = (function () {
    function UrlUtils() {
    }
    UrlUtils.parse = function (url) {
        UrlUtils.parser.href = String(url || '');
        return {
            protocol: UrlUtils.parser.protocol,
            hostname: UrlUtils.parser.hostname,
            port: UrlUtils.parser.port,
            pathname: UrlUtils.parser.pathname,
            search: UrlUtils.parser.search,
            hash: UrlUtils.parser.hash,
            host: UrlUtils.parser.host,
        };
    };
    UrlUtils.stringify = function (info) {
        if (info.pathname.charAt(0) !== '/') {
            info.pathname = '/' + info.pathname;
        }
        return (info.protocol || '')
            + '//'
            + (info.hostname)
            + (info.port ? ':' + info.port : '')
            + (info.pathname || '/')
            + (info.search || '')
            + (info.hash || '');
    };
    UrlUtils.parseQueryString = function (queryString) {
        var result = {}, segments = String(queryString || '').split('&'), param, value, equalSignIndex;
        for (var i = 0, len = segments.length; i < len; i++) {
            if (segments[i] !== '') {
                equalSignIndex = segments[i].indexOf('=');
                if (-1 === equalSignIndex) {
                    param = segments[i];
                    value = '';
                }
                else {
                    param = segments[i].substr(0, equalSignIndex);
                    value = segments[i].substr(equalSignIndex + 1);
                }
                if (param !== '') {
                    result[param] = value;
                }
            }
        }
        return result;
    };
    UrlUtils.getCurrentPageIdentifier = function (pageParams) {
        if (pageParams === void 0) { pageParams = ['p']; }
        var pathName = window.location.pathname, queryString = (window.location.search || '?').substr(1), returnValue = pathName;
        if (queryString && pageParams) {
            var result = [], querySegments = queryString.split('&'), parsedQueryString = {}, name_1, value = void 0, equalCharacterIndex = void 0;
            for (var i = 0, len = querySegments.length; i < len; i++) {
                if ((equalCharacterIndex = querySegments[i].indexOf('=')) > -1) {
                    name_1 = querySegments[i].substr(0, equalCharacterIndex);
                    value = querySegments[i].substr(equalCharacterIndex + 1);
                }
                else {
                    name_1 = querySegments[i];
                    value = '';
                }
                parsedQueryString[name_1] = value;
            }
            for (var i = 0, len = pageParams.length; i < len; i++) {
                if (undefined !== parsedQueryString[pageParams[i]]) {
                    result.push(pageParams[i] + '=' + parsedQueryString[pageParams[i]]);
                }
            }
            if (result.length) {
                returnValue = pathName + '?' + result.join('&');
            }
        }
        return Hash.MD5(returnValue);
    };
    UrlUtils.removeProtocolFromUrl = function (data) {
        var regexToReplaceProtocol = /^(https?):\/\//;
        if (regexToReplaceProtocol.test(data))
            data = data.replace(regexToReplaceProtocol, '//');
        return data;
    };
    UrlUtils.parser = document.createElement('a');
    return UrlUtils;
}());
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var Api = (function () {
    function Api(jq, apiRootAddress) {
        this.handledErrorCodes = [EHTTPCodes.PAYMENT_REQUIRED];
        this.jwt = null;
        this.lastAPIErrors = null;
        this.jq = jq;
        this.apiRootAddress = apiRootAddress;
    }
    Api.prototype.logIn = function () {
        return (function (self) {
            if (self.jwt === null) {
                return self.jq.post('/ajax-my-forms.php', {
                    "do": "auth"
                }).then(function (jwt) {
                    self.jwt = jwt;
                }).fail(function (e) {
                    if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                        self.throwError(new Error('Failed to authenticate in API'));
                    }
                });
            }
            else {
                return self.jq.Deferred(function (defer) {
                    defer.resolve(self.jwt);
                }).promise();
            }
        })(this);
    };
    Api.prototype.checkJWTExpired = function (loginPromiseResult) {
        return (function (self) {
            return loginPromiseResult.then(function () {
                var JWT = {}, parts = self.jwt.split('.'), data;
                for (var i = 0, len = parts.length; i < len; i++) {
                    try {
                        data = JSON.parse(atob(parts[i]));
                        if (data) {
                            for (var k in data) {
                                if (data.hasOwnProperty(k)) {
                                    JWT[k] = data[k];
                                }
                            }
                        }
                    }
                    catch (e) { }
                }
                return self.jq.Deferred(function (defer) {
                    var isExpired = false, age, now;
                    if (JWT.exp) {
                        now = ~~((+new Date) / 1000) + ((new Date()).getTimezoneOffset() * 60);
                        age = now - JWT.exp;
                        if (age > -(6 * 3600)) {
                            isExpired = true;
                        }
                    }
                    if (!isExpired) {
                        defer.resolve(self.jwt);
                    }
                    else {
                        return self.jq.post('/ajax-my-forms.php', {
                            "do": "auth-regen"
                        }).then(function (jwt) {
                            self.jwt = jwt;
                        }).fail(function (e) {
                            if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                                self.throwError(new Error('Failed to check if JWT is expired!'));
                            }
                        });
                    }
                });
            }).promise();
        })(this);
    };
    Api.prototype.decorateRequestArguments = function (requestArguments) {
        requestArguments['JWT'] = this.jwt;
        return requestArguments;
    };
    Api.prototype.decorateURLWithArguments = function (url) {
        var parts = UrlUtils.parse(url);
        if (!parts.search) {
            parts.search = '?JWT=' + encodeURIComponent(this.jwt);
        }
        else {
            parts.search += '&JWT=' + encodeURIComponent(this.jwt);
        }
        return UrlUtils.stringify(parts);
    };
    Api.prototype.GET = function (path, args) {
        if (args === void 0) { args = null; }
        var timestampStart = +new Date;
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                self.checkJWTExpired(self.logIn()).then(function () {
                    self.jq
                        .ajax({
                        "url": self.apiRootAddress + path,
                        "data": self.decorateRequestArguments(args || {}),
                        "type": "GET",
                        "crossDomain": true
                    })
                        .then(function (result, eventName, xhr) {
                        var duration = +new Date - timestampStart;
                        self.notifyCFTrackerFromAjax(xhr, {
                            'method': 'get',
                            'endpoint': path
                        }, 'timing', duration);
                        defer.resolve(result);
                    }).fail(function (result) {
                        if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                            self.throwError(new Error('Failed to GET: ' + path + ', args: ' + JSON.stringify(args)));
                        }
                        self.notifyCFTrackerFromAjax(result, {
                            'method': 'get',
                            'endpoint': path
                        }, 'error');
                        try {
                            self.initializeLastErrorFromAPIResponse(result);
                        }
                        catch (err) {
                            defer.reject(new Error(err));
                        }
                        defer.reject(new Error('Failed to GET: ' + path));
                    });
                }).fail(function () {
                    defer.reject(new Error('Failed to login with JWT!'));
                });
            }).promise();
        })(this);
    };
    Api.prototype.mergeObjects = function (a, b) {
        var result = {};
        a = a || {};
        b = b || {};
        for (var key in a) {
            if (a.hasOwnProperty(key)) {
                result[key] = a[key];
            }
        }
        for (var key in b) {
            if (b.hasOwnProperty(key)) {
                result[key] = b[key];
            }
        }
        return result;
    };
    Api.prototype.DRAIN = function (path, args) {
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                var totalPages = null, nextPageIndex = 1, currentResult = {
                    data: [],
                    meta: {
                        pagination: {
                            current_page: 0,
                            count: 0,
                            per_page: Api.FETCH_NUMBER_OF_ITEMS_PER_PAGE,
                            total: 0,
                            total_pages: 0,
                        }
                    },
                    status_code: 200
                };
                function appendResults(source, destination) {
                    for (var i = 0, len = source.data.length; i < len; i++) {
                        destination.data.push(source.data[i]);
                    }
                }
                function ensureResponseIsAStandardPaginatedAPIResponse(response) {
                    if (!response) {
                        throw new Error('Response is not a object!');
                    }
                    if (response.data === undefined) {
                        throw new Error('Missing "data" property from API response!');
                    }
                    if (!(response.data instanceof Array)) {
                        throw new Error('The "data" property of API response is not of type Array!');
                    }
                    if (response.meta === undefined) {
                        throw new Error('Missing "meta" property from API response!');
                    }
                    if (response.status_code === undefined) {
                        throw new Error('Missing "status_code" property from API response!');
                    }
                    if (response.meta.pagination === undefined) {
                        throw new Error('Missing "meta.pagination" property from API response!');
                    }
                }
                function getNextPage() {
                    if (totalPages === null) {
                        self.GET(path, self.mergeObjects(args, { per_page: Api.FETCH_NUMBER_OF_ITEMS_PER_PAGE, page: nextPageIndex }))
                            .then(function (response) {
                            try {
                                ensureResponseIsAStandardPaginatedAPIResponse(response);
                                currentResult.meta.pagination.total_pages = response.meta.pagination.total_pages;
                                currentResult.meta.pagination.current_page = response.meta.pagination.current_page;
                                currentResult.meta.pagination.count = response.meta.pagination.count;
                                currentResult.meta.pagination.per_page = response.meta.pagination.per_page;
                                currentResult.meta.pagination.total = response.meta.pagination.total;
                                totalPages = currentResult.meta.pagination.total_pages;
                                appendResults(response, currentResult);
                                nextPageIndex++;
                                getNextPage();
                            }
                            catch (error) {
                                defer.reject(error);
                            }
                        }).fail(function (err) {
                            defer.reject(err);
                        });
                    }
                    else {
                        if (nextPageIndex > totalPages) {
                            defer.resolve(currentResult);
                            return;
                        }
                        self.GET(path, self.mergeObjects(args, { per_page: Api.FETCH_NUMBER_OF_ITEMS_PER_PAGE, page: nextPageIndex }))
                            .then(function (response) {
                            try {
                                ensureResponseIsAStandardPaginatedAPIResponse(response);
                                appendResults(response, currentResult);
                                currentResult.meta.pagination.total_pages = response.meta.pagination.total_pages;
                                totalPages = currentResult.meta.pagination.total_pages;
                                nextPageIndex++;
                                getNextPage();
                            }
                            catch (err) {
                                defer.reject(err);
                            }
                        }).fail(function (err) {
                            defer.reject(err);
                        });
                    }
                }
                getNextPage();
            }).promise();
        })(this);
    };
    Api.prototype.POST = function (path, args) {
        if (args === void 0) { args = null; }
        var timestampStart = +new Date;
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                self.checkJWTExpired(self.logIn()).then(function () {
                    self.jq.ajax({
                        "type": "POST",
                        "url": self.apiRootAddress + path,
                        "data": self.decorateRequestArguments(args || {}),
                        "crossDomain": true
                    }).then(function (result, eventName, xhr) {
                        var duration = +new Date - timestampStart;
                        self.notifyCFTrackerFromAjax(xhr, {
                            'method': 'post',
                            'endpoint': path
                        }, 'timing', duration);
                        defer.resolve(result);
                    }).fail(function (result) {
                        if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                            self.throwError(new Error('Failed to POST: ' + path + ', args: ' + JSON.stringify(args)));
                        }
                        self.notifyCFTrackerFromAjax(result, {
                            'method': 'post',
                            'endpoint': path
                        }, 'error');
                        try {
                            self.initializeLastErrorFromAPIResponse(result);
                        }
                        catch (err) {
                            defer.reject(new Error(err));
                        }
                        defer.reject(new Error('Failed to POST: ' + path));
                    });
                }).fail(function () {
                    defer.reject(new Error('Failed to login with JWT!'));
                });
            }).promise();
        })(this);
    };
    Api.prototype.PUT = function (path, args) {
        if (args === void 0) { args = null; }
        var timestampStart = +new Date;
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                self.checkJWTExpired(self.logIn()).then(function () {
                    self.jq.ajax({
                        "url": self.apiRootAddress + path,
                        "data": self.decorateRequestArguments(args || {}),
                        "type": "PUT",
                        "crossDomain": true
                    }).then(function (result, eventName, xhr) {
                        var duration = +new Date - timestampStart;
                        self.notifyCFTrackerFromAjax(xhr, {
                            'method': 'put',
                            'endpoint': path
                        }, 'timing', duration);
                        defer.resolve(result);
                    }).fail(function (result) {
                        if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                            self.throwError(new Error('Failed to PUT: ' + path + ', args: ' + JSON.stringify(args)));
                        }
                        self.notifyCFTrackerFromAjax(result, {
                            'method': 'put',
                            'endpoint': path
                        }, 'error');
                        try {
                            self.initializeLastErrorFromAPIResponse(result);
                        }
                        catch (err) {
                            defer.reject(new Error(err));
                        }
                        defer.reject(new Error('Failed to PUT: ' + path));
                    });
                }).fail(function () {
                    defer.reject(new Error('Failed to login with JWT!'));
                });
            }).promise();
        })(this);
    };
    Api.prototype.PUT_JSON = function (path, data) {
        if (data === void 0) { data = null; }
        var timestampStart = +new Date;
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                self.checkJWTExpired(self.logIn()).then(function () {
                    self.jq.ajax({
                        "url": self.decorateURLWithArguments(self.apiRootAddress + path),
                        "data": JSON.stringify(data),
                        "type": "PUT",
                        "crossDomain": true,
                        "contentType": "application/json"
                    }).then(function (result, eventName, xhr) {
                        var duration = +new Date - timestampStart;
                        self.notifyCFTrackerFromAjax(xhr, {
                            'method': 'put',
                            'endpoint': path
                        }, 'timing', duration);
                        defer.resolve(result);
                    }).fail(function (result) {
                        if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                            self.throwError(new Error('Failed to PUT_JSON: ' + path + ', args: ' + JSON.stringify(data)));
                        }
                        if (self.isHandledError(result)) {
                            defer.reject(result);
                            return;
                        }
                        self.notifyCFTrackerFromAjax(result, {
                            'method': 'put',
                            'endpoint': path
                        }, 'error');
                        try {
                            self.initializeLastErrorFromAPIResponse(result);
                        }
                        catch (err) {
                            defer.reject(new Error(err));
                        }
                        defer.reject(new Error('Failed to PUT_JSON: ' + path), result);
                    });
                }).fail(function () {
                    defer.reject(new Error('Failed to login with JWT!'));
                });
            }).promise();
        })(this);
    };
    Api.prototype.POST_JSON = function (path, data) {
        if (data === void 0) { data = null; }
        var timestampStart = +new Date;
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                self.checkJWTExpired(self.logIn()).then(function () {
                    self.jq.ajax({
                        "url": self.decorateURLWithArguments(self.apiRootAddress + path),
                        "data": JSON.stringify(data),
                        "type": "POST",
                        "crossDomain": true,
                        "contentType": "application/json"
                    }).then(function (result, eventName, xhr) {
                        var duration = +new Date - timestampStart;
                        self.notifyCFTrackerFromAjax(xhr, {
                            'method': 'put',
                            'endpoint': path
                        }, 'timing', duration);
                        defer.resolve(result);
                    }).fail(function (result) {
                        if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                            self.throwError(new Error('Failed to PUT_JSON: ' + path + ', args: ' + JSON.stringify(data)));
                        }
                        if (self.isHandledError(result)) {
                            defer.reject(result);
                            return;
                        }
                        self.notifyCFTrackerFromAjax(result, {
                            'method': 'put',
                            'endpoint': path
                        }, 'error');
                        try {
                            self.initializeLastErrorFromAPIResponse(result);
                        }
                        catch (err) {
                            defer.reject(new Error(err));
                        }
                        defer.reject(new Error('Failed to PUT_JSON: ' + path));
                    });
                }).fail(function () {
                    defer.reject(new Error('Failed to login with JWT!'));
                });
            }).promise();
        })(this);
    };
    Api.prototype.POST_CUSTOM = function (path, data, options) {
        if (data === void 0) { data = null; }
        if (options === void 0) { options = null; }
        var timestampStart = +new Date;
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                self.checkJWTExpired(self.logIn()).then(function () {
                    self.jq.ajax(__assign({ "url": self.decorateURLWithArguments(self.apiRootAddress + path), "data": data, "type": "POST", "crossDomain": true }, options)).then(function (result, eventName, xhr) {
                        var duration = +new Date - timestampStart;
                        self.notifyCFTrackerFromAjax(xhr, {
                            'method': 'post_custom',
                            'endpoint': path
                        }, 'timing', duration);
                        defer.resolve(result);
                    }).fail(function (result) {
                        if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                            self.throwError(new Error('Failed to POST_CUSTOM: ' + path + ', args: ' + JSON.stringify(data)));
                        }
                        self.notifyCFTrackerFromAjax(result, {
                            'method': 'post_custom',
                            'endpoint': path
                        }, 'error');
                        try {
                            self.initializeLastErrorFromAPIResponse(result);
                        }
                        catch (err) {
                            defer.reject(new Error(err));
                        }
                        defer.reject(new Error('Failed to POST_CUSTOM: ' + path));
                    });
                }).fail(function () {
                    defer.reject(new Error('Failed to login with JWT!'));
                });
            }).promise();
        })(this);
    };
    Api.prototype.DELETE = function (path, args) {
        if (args === void 0) { args = null; }
        var timestampStart = +new Date;
        return (function (self) {
            return self.jq.Deferred(function (defer) {
                self.checkJWTExpired(self.logIn()).then(function () {
                    self.jq.ajax({
                        "url": self.apiRootAddress + path,
                        "data": self.decorateRequestArguments(args || {}),
                        "type": "DELETE",
                        "crossDomain": true
                    }).then(function (result, eventName, xhr) {
                        var duration = (+new Date) - timestampStart;
                        self.notifyCFTrackerFromAjax(xhr, {
                            'method': 'delete',
                            'endpoint': path
                        }, 'timing', duration);
                        defer.resolve(result);
                    }).fail(function (result) {
                        if (Api.THROW_REQUEST_ERRORS_IN_CONSOLE) {
                            self.throwError(new Error('Failed to DELETE: ' + path + ', args: ' + JSON.stringify(args)));
                        }
                        self.notifyCFTrackerFromAjax(result, {
                            'method': 'delete',
                            'endpoint': path
                        }, 'error');
                        try {
                            self.initializeLastErrorFromAPIResponse(result);
                        }
                        catch (err) {
                            defer.reject(new Error(err));
                        }
                        defer.reject(new Error('Failed to DELETE: ' + path));
                    });
                }).fail(function () {
                    defer.reject(new Error('Failed to login with JWT!'));
                });
            }).promise();
        })(this);
    };
    Api.prototype.initializeLastErrorFromAPIResponse = function (apiResponse) {
        try {
            var jsonResult = JSON.parse(apiResponse.responseText);
            if (jsonResult && jsonResult.errorCodes) {
                this.lastAPIErrors = jsonResult.errorCodes;
            }
            else {
                this.lastAPIErrors = null;
            }
        }
        catch (error) {
            throw new Error(error);
        }
    };
    Api.prototype.getLastAPIErrors = function () {
        var result = this.lastAPIErrors;
        this.lastAPIErrors = null;
        return result;
    };
    Api.prototype.sendCFTrackerEvent = function (eventName, eventArgs) {
        if (window['CFTracker']) {
            CFTracker.event(eventName, eventArgs);
        }
    };
    Api.prototype.sendCFTrackerTiming = function (eventName, eventDuration, eventArgs) {
        if (window['CFTracker']) {
            CFTracker.timing(eventName, eventDuration, eventArgs);
        }
    };
    Api.prototype.notifyCFTrackerFromAjax = function (result, args, trackerType, timing) {
        var errorCode = result.status;
        var method = args.method;
        var endPoint = this.getApiEndPointFromGivenPath(args.endpoint);
        switch (trackerType) {
            case 'error':
                this.sendCFTrackerEvent('api_ajax_error', {
                    'method': method,
                    'endpoint': endPoint,
                    'http_status': errorCode
                });
                break;
            case 'timing':
                this.sendCFTrackerTiming('api_ajax_duration', Math.ceil(timing), {
                    'method': method,
                    'endpoint': endPoint,
                    'http_status': errorCode
                });
                break;
            default:
                throw new Error('Invalid argument trackerType: "error"|"timing" expected!');
        }
    };
    Api.prototype.getApiEndPointFromGivenPath = function (path) {
        var matches;
        if (matches = /^((http(s)?\:\/\/)?[^\/]+\/(api\/v2\/)?|\/)?([^\/\?\#]+)/.exec(path)) {
            return String(matches[5] || 'unknown');
        }
        else {
            return 'unknown';
        }
    };
    Api.prototype.getApiRootAddress = function () {
        return this.apiRootAddress;
    };
    Api.prototype.throwError = function (e) {
        if (e instanceof Error) {
            setTimeout(function () {
                throw e;
            }, 0);
        }
        else {
            var msg_1 = String(e || '').substr(0, 2048);
            setTimeout(function () {
                throw new Error(msg_1);
            });
        }
    };
    Api.prototype.isHandledError = function (response) {
        return response.status && this.handledErrorCodes.indexOf(response.status) !== -1;
    };
    Api.THROW_REQUEST_ERRORS_IN_CONSOLE = false;
    Api.FETCH_NUMBER_OF_ITEMS_PER_PAGE = 100;
    return Api;
}());
var Cookie = (function () {
    function Cookie() {
    }
    Cookie.prototype.setCookie = function (cookieName, cookieValue, extraDays, extraMinutes, sameSite) {
        if (extraMinutes === void 0) { extraMinutes = 0; }
        if (sameSite === void 0) { sameSite = ECookieSameSite.COOKIE_SAME_SITE_LAX; }
        var date = new Date();
        var time = (extraMinutes * 60 * 1000) + (extraDays * 24 * 60 * 60 * 1000);
        var sameSiteDirective = sameSite === ECookieSameSite.COOKIE_SAME_SITE_NONE ? ECookieSameSite.COOKIE_SAME_SITE_NONE + ";Secure" : sameSite;
        date.setTime(date.getTime() + time);
        document.cookie = cookieName + "=" + cookieValue + ";expires=" + date.toUTCString() + ";SameSite=" + sameSiteDirective + ";path=/";
    };
    Cookie.prototype.deleteCookie = function (cookieName) {
        document.cookie = cookieName + "=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/";
    };
    Cookie.prototype.getCookie = function (cookieName) {
        var name = cookieName + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    };
    Cookie.prototype.checkCookie = function (cookieName) {
        var isCookie = this.getCookie(cookieName);
        if (isCookie != "") {
            return true;
        }
        else {
            return false;
        }
    };
    return Cookie;
}());
var FileUtils = (function () {
    function FileUtils(i18n) {
        this.i18n = i18n;
    }
    FileUtils.prototype.convertFileSizeToString = function (sizeInBytes) {
        var value, suffix, result;
        switch (true) {
            case (sizeInBytes / FileUtils.KILOBYTE) < 1:
                value = sizeInBytes;
                suffix = null;
                break;
            case (sizeInBytes / FileUtils.MEGABYTE) < 1:
                suffix = 'KB';
                value = sizeInBytes / FileUtils.KILOBYTE;
                break;
            case (sizeInBytes / FileUtils.GIGABYTE) < 1:
                suffix = 'MB';
                value = sizeInBytes / FileUtils.MEGABYTE;
                break;
            case (sizeInBytes / FileUtils.TERABYTE) < 1:
                suffix = 'GB';
                value = sizeInBytes / FileUtils.GIGABYTE;
                break;
            default:
                suffix = 'TB';
                value = sizeInBytes / FileUtils.TERABYTE;
                break;
        }
        result = Number(value).toFixed(1).replace(/\.0$/g, '')
            + (suffix === null ? '' : ' ' + suffix);
        return result;
    };
    FileUtils.download = function (data, strFileName, strMimeType) {
        var self = window, defaultMime = "application/octet-stream", mimeType = strMimeType || defaultMime, payload = data, url = !strFileName && !strMimeType && payload, anchor = document.createElement("a"), toString = function (a) { return String(a); }, myBlob = (self['Blob'] || self['MozBlob'] || self['WebKitBlob'] || toString), fileName = strFileName || "download", blob, reader;
        myBlob = myBlob.call
            ? myBlob.bind(self)
            : Blob;
        var saver = function (url, winMode) {
            if ('download' in anchor) {
                anchor.href = url;
                anchor.setAttribute("download", fileName);
                anchor.className = "download-js-link";
                anchor.innerHTML = "downloading...";
                anchor.style.display = "none";
                document.body.appendChild(anchor);
                setTimeout(function () {
                    anchor.click();
                    document.body.removeChild(anchor);
                    if (winMode === true) {
                        setTimeout(function () {
                            self.URL.revokeObjectURL(anchor.href);
                        }, 250);
                    }
                }, 66);
                return true;
            }
            if (/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)) {
                if (/^data:/.test(url))
                    url = "data:" + url.replace(/^data:([\w\/\-+]+)/, defaultMime);
                if (!window.open(url)) {
                    if (confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")) {
                        location.href = url;
                    }
                }
                return true;
            }
            var f = document.createElement("iframe");
            document.body.appendChild(f);
            if (!winMode && /^data:/.test(url)) {
                url = "data:" + url.replace(/^data:([\w\/\-+]+)/, defaultMime);
            }
            f.src = url;
            setTimeout(function () {
                document.body.removeChild(f);
            }, 333);
        };
        var dataUrlToBlob = function (strUrl) {
            var parts = strUrl.split(/[:;,]/), type = parts[1], decoder = parts[2] == "base64" ? atob : decodeURIComponent, binData = decoder(parts.pop()), mx = binData.length, i = 0, uiArr = new Uint8Array(mx);
            for (i; i < mx; ++i)
                uiArr[i] = binData.charCodeAt(i);
            return new myBlob([uiArr], { type: type });
        };
        if (String(this) === "true") {
            payload = [payload, mimeType];
            mimeType = payload[0];
            payload = payload[1];
        }
        if (url && url.length < 2048) {
            fileName = url.split("/").pop().split("?")[0];
            anchor.href = url;
            if (anchor.href.indexOf(url) !== -1) {
                var ajax_1 = new XMLHttpRequest();
                ajax_1.open("GET", url, true);
                ajax_1.responseType = 'blob';
                ajax_1.onload = function (e) {
                    FileUtils.download(e.target['response'], fileName, defaultMime);
                };
                setTimeout(function () {
                    ajax_1.send();
                }, 0);
                return ajax_1;
            }
        }
        if (/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(payload)) {
            if (payload.length > (1024 * 1024 * 1.999) && myBlob !== toString) {
                payload = dataUrlToBlob(payload);
                mimeType = payload.type || defaultMime;
            }
            else {
                return navigator['msSaveBlob'] ?
                    navigator['msSaveBlob'](dataUrlToBlob(payload), fileName) :
                    saver(payload);
            }
        }
        else {
            if (/([\x80-\xff])/.test(payload)) {
                var i = 0, tempUiArr = new Uint8Array(payload.length), mx = tempUiArr.length;
                for (i; i < mx; ++i)
                    tempUiArr[i] = payload.charCodeAt(i);
                payload = new myBlob([tempUiArr], { type: mimeType });
            }
        }
        blob = payload instanceof myBlob
            ? payload
            : new myBlob([payload], { type: mimeType });
        if (navigator.msSaveBlob) {
            return navigator.msSaveBlob(blob, fileName);
        }
        if (self.URL) {
            saver(self.URL.createObjectURL(blob), true);
        }
        else {
            if (typeof blob === "string" || blob.constructor === toString) {
                try {
                    return saver("data:" + mimeType + ";base64," + self.btoa(blob));
                }
                catch (y) {
                    return saver("data:" + mimeType + "," + encodeURIComponent(blob));
                }
            }
            reader = new FileReader();
            reader.onload = function () {
                saver(this.result);
            };
            reader.readAsDataURL(blob);
        }
        return true;
    };
    FileUtils.KILOBYTE = 1024;
    FileUtils.MEGABYTE = 1024 * 1024;
    FileUtils.GIGABYTE = 1024 * 1024 * 1024;
    FileUtils.TERABYTE = 1024 * 1024 * 1024 * 1024;
    return FileUtils;
}());
var E_SALVAGE_BLOCK_TYPE;
(function (E_SALVAGE_BLOCK_TYPE) {
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_VAR"] = 0] = "TOKEN_VAR";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_IF"] = 1] = "TOKEN_IF";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_ELSE"] = 2] = "TOKEN_ELSE";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_UNLESS"] = 3] = "TOKEN_UNLESS";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_EACH"] = 4] = "TOKEN_EACH";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_END"] = 5] = "TOKEN_END";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_TEXT"] = 6] = "TOKEN_TEXT";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_WITH"] = 7] = "TOKEN_WITH";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_COMMENT"] = 8] = "TOKEN_COMMENT";
    E_SALVAGE_BLOCK_TYPE[E_SALVAGE_BLOCK_TYPE["TOKEN_EQUALS"] = 9] = "TOKEN_EQUALS";
})(E_SALVAGE_BLOCK_TYPE || (E_SALVAGE_BLOCK_TYPE = {}));
var Salvage = (function () {
    function Salvage(template) {
        this.helpers = [];
        this.instructions = Salvage.tokenize(template);
        for (var i = 0, len = Salvage.GLOBAL_HELPERS.length; i < len; i++) {
            this.helpers.push(Salvage.GLOBAL_HELPERS[i]);
        }
    }
    Salvage.createEmptyBlockText = function () {
        return {
            token: E_SALVAGE_BLOCK_TYPE.TOKEN_TEXT,
            params: null,
            settings: null,
            text: '',
        };
    };
    Salvage.tokenize = function (template) {
        var charIndex = 0, numChars = template.length, leftChars = numChars - charIndex, block = null, ch, readResult, blockTextLength, blocks = [], instructions = [];
        while (charIndex < numChars) {
            ch = template.charAt(charIndex);
            if ('{' === ch) {
                readResult = this.readToken(charIndex, numChars, template);
            }
            else {
                readResult = null;
            }
            if (!readResult) {
                block = block || Salvage.createEmptyBlockText();
                block.text += ch;
                charIndex++;
                leftChars--;
            }
            else {
                if (block) {
                    blocks.push(block);
                }
                block = {
                    text: readResult.text,
                    token: readResult.token,
                    params: readResult.params,
                    settings: readResult.settings,
                };
                blocks.push(block);
                blockTextLength = block.text.length;
                charIndex += blockTextLength;
                leftChars -= blockTextLength;
                block = null;
            }
        }
        if (block) {
            blocks.push(block);
        }
        if (!blocks.length) {
            return [];
        }
        var currentInstruction, currentBlock;
        for (var i = 0, len = blocks.length; i < len; i++) {
            if (blocks[i].token === E_SALVAGE_BLOCK_TYPE.TOKEN_END) {
                if (currentBlock) {
                    currentBlock = currentBlock.getParent();
                }
                else {
                    throw new Error('Unexpected TOKEN END!');
                }
            }
            else {
                currentInstruction = this.createInstructionFromBlock(blocks[i]);
                if (currentBlock) {
                    currentBlock.append(currentInstruction);
                    currentInstruction.withParent(currentBlock);
                }
                else {
                    instructions.push(currentInstruction);
                    currentInstruction.withParent(null);
                }
                if (currentInstruction.allowChildren()) {
                    currentBlock = currentInstruction;
                }
            }
        }
        return instructions;
    };
    Salvage.prototype.parse = function (model) {
        var result = [], context = new SALVAGE_CONTEXT(model, null, this.helpers);
        for (var i = 0, len = this.instructions.length; i < len; i++) {
            result.push(this.instructions[i].parse(context));
        }
        return result.join('');
    };
    Salvage.readToken = function (startIndex, numChars, buffer) {
        if (buffer.charAt(startIndex) === '{' && buffer.charAt(startIndex + 1) === '{') {
            var isEsc = true, readStart = startIndex + 2, parsedArguments = [], endOfBlock = false, argument = void 0, fullMatch = '', readLength = void 0, numParsedArguments = 0, isFirstArgumentVariableName = false;
            if (buffer.charAt(startIndex + 2) === '{') {
                isEsc = false;
                readStart++;
                fullMatch = '{{{';
            }
            else {
                fullMatch = '{{';
            }
            while (!endOfBlock) {
                if (numParsedArguments >= 1 && isFirstArgumentVariableName) {
                    fullMatch += (this.repeat(' ', readLength = this.readPipeAndSpaces(buffer, readStart)));
                }
                else {
                    fullMatch += (this.repeat(' ', readLength = this.readSpaces(buffer, readStart)));
                }
                readStart += readLength;
                argument = this.readArgument(buffer, readStart);
                readLength = argument.length;
                if (readLength) {
                    fullMatch += argument;
                    readStart += readLength;
                    readStart += (readLength = this.readSpaces(buffer, readStart));
                    fullMatch += this.repeat(' ', readLength);
                    parsedArguments.push(argument);
                    numParsedArguments++;
                    if (numParsedArguments === 1) {
                        isFirstArgumentVariableName = !this.isReservedKeyword(argument);
                    }
                }
                else {
                    endOfBlock = true;
                }
            }
            startIndex = readStart;
            if (buffer.charAt(startIndex) === '}' && buffer.charAt(startIndex + 1) === '}') {
                fullMatch += '}}';
                if (!isEsc) {
                    if (buffer.charAt(startIndex + 2) === '}' && parsedArguments.length) {
                        fullMatch += '}';
                        return this.convertArgsToToken(parsedArguments, isEsc, fullMatch);
                    }
                    else {
                        return null;
                    }
                }
                else {
                    if (parsedArguments.length > 0) {
                        return this.convertArgsToToken(parsedArguments, isEsc, fullMatch);
                    }
                    else {
                        return null;
                    }
                }
            }
        }
        else {
            return null;
        }
    };
    Salvage.readPipeAndSpaces = function (buffer, readStart) {
        var count = 0, ch, readPipes = 0;
        while (ch = buffer.charAt(readStart)) {
            if (ch === ' ' || ch === '\n' || ch === '\r' || ch === '\t' || ch === '|') {
                count++;
                if (ch === '|') {
                    readPipes++;
                }
                readStart++;
            }
            else {
                break;
            }
        }
        if (readPipes === 1) {
            return count;
        }
        else {
            return 0;
        }
    };
    Salvage.readSpaces = function (buffer, readStart) {
        var count = 0, ch;
        while (ch = buffer.charAt(readStart)) {
            if (ch === ' ' || ch === '\n' || ch === '\r' || ch === '\t') {
                count++;
                readStart++;
            }
            else {
                break;
            }
        }
        return count;
    };
    Salvage.readArgument = function (buffer, readStart) {
        var result = '', ch;
        while (ch = buffer.charAt(readStart)) {
            if (Salvage.ARGUMENT_VALID_CHARS.indexOf(ch) > -1) {
                result += ch;
                readStart++;
            }
            else {
                break;
            }
        }
        return result;
    };
    Salvage.convertArgsToToken = function (args, isEsc, fullMatch) {
        var argsLength = args.length;
        if (0 === argsLength) {
            return null;
        }
        else {
            if (argsLength === 1) {
                if (!this.isReservedKeyword(args[0])) {
                    return {
                        text: fullMatch,
                        params: args,
                        token: E_SALVAGE_BLOCK_TYPE.TOKEN_VAR,
                        settings: {
                            escaped: isEsc,
                        }
                    };
                }
                if (args[0] === '#end' || args[0] === '#else') {
                    return {
                        text: fullMatch,
                        params: null,
                        token: args[0] === '#end'
                            ? E_SALVAGE_BLOCK_TYPE.TOKEN_END
                            : E_SALVAGE_BLOCK_TYPE.TOKEN_ELSE,
                        settings: null,
                    };
                }
                return null;
            }
            else {
                if (!this.isReservedKeyword(args[0])) {
                    return {
                        text: fullMatch,
                        params: args,
                        token: E_SALVAGE_BLOCK_TYPE.TOKEN_VAR,
                        settings: {
                            escaped: isEsc
                        }
                    };
                }
                if (!isEsc) {
                    return null;
                }
                switch (args[0]) {
                    case '#if':
                    case '#unless':
                        if (argsLength === 2 && this.isValidContextPath(args[1])) {
                            return {
                                token: args[0] === '#if'
                                    ? E_SALVAGE_BLOCK_TYPE.TOKEN_IF
                                    : E_SALVAGE_BLOCK_TYPE.TOKEN_UNLESS,
                                params: [args[1]],
                                text: fullMatch,
                                settings: {
                                    negated: args[0] === '#unless',
                                },
                            };
                        }
                        return null;
                    case '#equals':
                        if (argsLength === 3 && this.isValidContextPath(args[1]) && this.isValidContextPath(args[2])) {
                            return {
                                token: E_SALVAGE_BLOCK_TYPE.TOKEN_EQUALS,
                                params: [args[1], args[2]],
                                text: fullMatch,
                                settings: null
                            };
                        }
                        return null;
                    case '#each':
                        if (argsLength === 2 && this.isValidContextPath(args[1])) {
                            return {
                                token: E_SALVAGE_BLOCK_TYPE.TOKEN_EACH,
                                params: [args[1]],
                                text: fullMatch,
                                settings: null,
                            };
                        }
                        else {
                            if (argsLength === 4 && args[2] === 'in' && this.isValidContextPath(args[1]) && this.isValidVariableName(args[3])) {
                                return {
                                    token: E_SALVAGE_BLOCK_TYPE.TOKEN_EACH,
                                    params: [args[1], args[3]],
                                    text: fullMatch,
                                    settings: null,
                                };
                            }
                        }
                        return null;
                    case '#with':
                        if (argsLength === 2) {
                            if (this.isValidContextPath(args[1])) {
                                return {
                                    token: E_SALVAGE_BLOCK_TYPE.TOKEN_WITH,
                                    params: [args[1]],
                                    text: fullMatch,
                                    settings: null,
                                };
                            }
                        }
                        return null;
                    default:
                        throw new Error('Invalid keyword: ' + args[0]);
                }
            }
        }
    };
    Salvage.isReservedKeyword = function (string) {
        return string === '#if' || string === '#each' || string === '#unless' || string === '#else' || string === '#end' || string === '#with' || string === '#equals';
    };
    Salvage.isValidContextPath = function (string) {
        if (!string) {
            return false;
        }
        var segments = string.split('/');
        for (var i = 0, len = segments.length; i < len; i++) {
            if (!(segments[i] === '.' || segments[i] === '..' || this.isValidVariableName(segments[i]))) {
                return false;
            }
        }
        return true;
    };
    Salvage.isValidVariableName = function (string) {
        if (!string) {
            return false;
        }
        else {
            var segments = string.split('.');
            for (var i = 0, len = segments.length; i < len; i++) {
                if (Salvage.VAR_START_CHAR.indexOf(segments[i].charAt(0)) > -1) {
                    for (var j = 1, n = segments[i].length; j < n; j++) {
                        if (Salvage.VAR_OTHER_CHARS.indexOf(segments[i].charAt(j)) === -1) {
                            return false;
                        }
                    }
                }
                else {
                    return false;
                }
            }
            return true;
        }
    };
    Salvage.repeat = function (ch, len) {
        var result = '';
        for (var i = 0; i < len; i++) {
            result = result + ch;
        }
        return result;
    };
    Salvage.createInstructionFromBlock = function (block) {
        switch (block.token) {
            case E_SALVAGE_BLOCK_TYPE.TOKEN_IF:
                return new SALVAGE_INSTRUCTION_IF(block.params);
            case E_SALVAGE_BLOCK_TYPE.TOKEN_UNLESS:
                return new SALVAGE_UNLESS(block.params);
            case E_SALVAGE_BLOCK_TYPE.TOKEN_END:
                return new SALVAGE_INSTRUCTION_END();
            case E_SALVAGE_BLOCK_TYPE.TOKEN_TEXT:
                return new SALVAGE_TEXT(block.text);
            case E_SALVAGE_BLOCK_TYPE.TOKEN_VAR:
                return new SALVAGE_BLOCK_VAR(block.params, block.settings.escaped);
            case E_SALVAGE_BLOCK_TYPE.TOKEN_EACH:
                return new SALVAGE_INSTRUCTION_EACH(block.params);
            case E_SALVAGE_BLOCK_TYPE.TOKEN_WITH:
                return new SALVAGE_BLOCK_WITH(block.params);
            case E_SALVAGE_BLOCK_TYPE.TOKEN_ELSE:
                return new SALVAGE_INSTRUCTION_ELSE();
            case E_SALVAGE_BLOCK_TYPE.TOKEN_EQUALS:
                return new SALVAGE_INSTRUCTION_EQUALS(block.params);
            default:
                throw new Error('Unknown block type: ' + JSON.stringify(block));
        }
    };
    Salvage.normalizePath = function (path) {
        if (!path) {
            return path;
        }
        else {
            var segments = path.split('/'), result = [], resultLength = 0, subSegments = void 0;
            for (var i = 0, len = segments.length; i < len; i++) {
                if ('.' !== segments[i] && '' !== segments[i]) {
                    if ('..' === segments[i]) {
                        if (resultLength > 0 && result[resultLength - 1] !== '..') {
                            resultLength--;
                            result.pop();
                        }
                        else {
                            resultLength++;
                            result.push('..');
                        }
                    }
                    else {
                        subSegments = segments[i].split('.');
                        for (var j = 0, n = subSegments.length; j < n; j++) {
                            if ('' === subSegments[j]) {
                                return null;
                            }
                            else {
                                result.push(subSegments[j]);
                                resultLength++;
                            }
                        }
                    }
                }
            }
            for (var i = resultLength - 1; i > -1; i--) {
                if (result[i] === 'this' && i > 1) {
                    result.splice(i, 1);
                    resultLength--;
                }
            }
            return resultLength
                ? result.join('/')
                : null;
        }
    };
    Salvage.addHelper = function (helper) {
        if (!helper) {
            throw new Error('Invalid argument!');
        }
        for (var i = 0, len = this.GLOBAL_HELPERS.length; i < len; i++) {
            if (this.GLOBAL_HELPERS[i].name === helper.name) {
                throw new Error('Helper "' + helper.name + '" already added!');
            }
        }
        this.GLOBAL_HELPERS.push(helper);
    };
    Salvage.prototype.withHelper = function (helper) {
        if (!helper) {
            throw new Error('Invalid argument!');
        }
        for (var i = 0, len = this.helpers.length; i < len; i++) {
            if (this.helpers[i].name === helper.name) {
                throw new Error('Helper "' + helper.name + '" already added!');
            }
        }
        this.helpers.push(helper);
        return this;
    };
    Salvage.GLOBAL_HELPERS = [
        {
            name: 'upper',
            func: function (s) {
                return String(s).toUpperCase();
            }
        },
        {
            name: 'lower',
            func: function (s) {
                return String(s).toLowerCase();
            }
        }
    ];
    Salvage.ARGUMENT_VALID_CHARS = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789./_$#';
    Salvage.VAR_START_CHAR = '$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_';
    Salvage.VAR_OTHER_CHARS = '$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789';
    return Salvage;
}());
var SALVAGE_CONTEXT = (function () {
    function SALVAGE_CONTEXT(model, parent, helpers) {
        this.parent = null;
        this.model = model;
        this.parent = parent || null;
        this.helpers = helpers || [];
    }
    SALVAGE_CONTEXT.prototype.getModel = function () {
        return this.model;
    };
    SALVAGE_CONTEXT.prototype.get = function (variable) {
        if ('this' === variable) {
            return this.model;
        }
        var segments = variable.split('/'), numSegments = segments.length, result;
        if (numSegments > 1) {
            result = this.cd(segments.slice(0, numSegments - 1).join('/')).get(segments[numSegments - 1]);
        }
        else {
            if (segments[0] == '..') {
                result = this.getParent().getModel();
            }
            else {
                result = this.model[segments[0]];
            }
        }
        if (null === result || undefined === result) {
            return '';
        }
        else {
            return result;
        }
    };
    SALVAGE_CONTEXT.prototype.getHelper = function (name) {
        for (var i = 0, len = this.helpers.length; i < len; i++) {
            if (this.helpers[i].name === name) {
                return this.helpers[i];
            }
        }
        throw new Error('HELPER "' + name + '" not found!');
    };
    SALVAGE_CONTEXT.prototype.isNotEmpty = function (variable) {
        var result = this.get(variable);
        if (!result) {
            return false;
        }
        else {
            if (result instanceof Array && result.length === 0) {
                return false;
            }
            return true;
        }
    };
    SALVAGE_CONTEXT.prototype.equals = function (variable1, variable2) {
        var result1 = this.get(variable1);
        var result2 = this.get(variable2);
        return result1 === result2;
    };
    SALVAGE_CONTEXT.prototype.cd = function (path) {
        var segments = path.split('/'), cursor = this, i = 0, len = segments.length;
        while (path[i] == '..') {
            if (!cursor.getParent()) {
                throw new Error("Illegal path: " + segments.join('/'));
            }
            cursor = cursor.getParent();
            i++;
        }
        while (i < len) {
            if (segments[i] == '..') {
                if (!cursor.getParent()) {
                    throw new Error("Illegal path: " + segments.join('/'));
                }
                cursor = cursor.getParent();
            }
            else if (segments[i] == 'this' && i == 0) {
            }
            else {
                if (!(cursor.getModel() instanceof Object) || cursor.getModel()[segments[i]] == undefined) {
                    throw new Error("Illegal path: " + segments.join('/'));
                }
                cursor = new SALVAGE_CONTEXT(cursor.getModel()[segments[i]], this, this.helpers);
            }
            i++;
        }
        return cursor;
    };
    SALVAGE_CONTEXT.prototype.each = function (variable, callback) {
        var result = this.get(variable) || [];
        if (result && result instanceof Array) {
            for (var i = 0, len = result.length; i < len; i++) {
                callback(new SALVAGE_CONTEXT(result[i], this, this.helpers));
            }
        }
    };
    SALVAGE_CONTEXT.prototype.getParent = function () {
        if (this.parent) {
            return this.parent;
        }
        else {
            throw new Error('Failed to get context parent!');
        }
    };
    return SALVAGE_CONTEXT;
}());
var SALVAGE_ABSTRACT_INSTRUCTION = (function () {
    function SALVAGE_ABSTRACT_INSTRUCTION(type, params) {
        this.parent = null;
        this.type = type;
        this.params = params;
    }
    SALVAGE_ABSTRACT_INSTRUCTION.prototype.withParent = function (parent) {
        this.parent = parent;
        return this;
    };
    SALVAGE_ABSTRACT_INSTRUCTION.prototype.getParent = function () {
        return this.parent;
    };
    SALVAGE_ABSTRACT_INSTRUCTION.prototype.getBlockType = function () {
        return this.type;
    };
    SALVAGE_ABSTRACT_INSTRUCTION.prototype.getParam = function (index) {
        return this.params
            ? this.params[index] || null
            : null;
    };
    SALVAGE_ABSTRACT_INSTRUCTION.prototype.setParam = function (index, value) {
        this.params[index] = value;
    };
    return SALVAGE_ABSTRACT_INSTRUCTION;
}());
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var SALVAGE_INSTRUCTION_IF = (function (_super) {
    __extends(SALVAGE_INSTRUCTION_IF, _super);
    function SALVAGE_INSTRUCTION_IF(params) {
        var _this = _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_IF, []) || this;
        _this.elseAppended = false;
        _this.trueBranchChildren = [];
        _this.falseBranchChildren = [];
        _this.params[0] = Salvage.normalizePath(params[0]);
        if (null === _this.params[0]) {
            throw new Error('Illegal IF variable: ' + params[0]);
        }
        return _this;
    }
    SALVAGE_INSTRUCTION_IF.prototype.append = function (instruction) {
        if (instruction.getBlockType() === E_SALVAGE_BLOCK_TYPE.TOKEN_ELSE) {
            if (this.elseAppended) {
                throw new Error('Else appended!');
            }
            this.elseAppended = true;
            return instruction;
        }
        if (this.elseAppended) {
            this.falseBranchChildren.push(instruction);
        }
        else {
            this.trueBranchChildren.push(instruction);
        }
        return instruction.withParent(this);
    };
    SALVAGE_INSTRUCTION_IF.prototype.allowChildren = function () {
        return true;
    };
    SALVAGE_INSTRUCTION_IF.prototype.parse = function (context) {
        var result = '';
        if (context.isNotEmpty(this.getParam(0))) {
            for (var i = 0, len = this.trueBranchChildren.length; i < len; i++) {
                result = result.concat(this.trueBranchChildren[i].parse(context));
            }
        }
        else {
            for (var i = 0, len = this.falseBranchChildren.length; i < len; i++) {
                result = result.concat(this.falseBranchChildren[i].parse(context));
            }
        }
        return result;
    };
    return SALVAGE_INSTRUCTION_IF;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_INSTRUCTION_END = (function (_super) {
    __extends(SALVAGE_INSTRUCTION_END, _super);
    function SALVAGE_INSTRUCTION_END() {
        return _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_END, null) || this;
    }
    SALVAGE_INSTRUCTION_END.prototype.allowChildren = function () {
        return false;
    };
    SALVAGE_INSTRUCTION_END.prototype.parse = function (context) {
        return '';
    };
    SALVAGE_INSTRUCTION_END.prototype.append = function (instruction) {
        throw new Error('Cannot append something into a END block!');
    };
    return SALVAGE_INSTRUCTION_END;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_UNLESS = (function (_super) {
    __extends(SALVAGE_UNLESS, _super);
    function SALVAGE_UNLESS(params) {
        var _this = _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_UNLESS, []) || this;
        _this.elseAppended = false;
        _this.trueBranchChildren = [];
        _this.falseBranchChildren = [];
        _this.params[0] = Salvage.normalizePath(params[0]);
        if (null === _this.params[0]) {
            throw new Error('Illegal UNLESS variable: ' + params[0]);
        }
        return _this;
    }
    SALVAGE_UNLESS.prototype.append = function (instruction) {
        if (instruction.getBlockType() === E_SALVAGE_BLOCK_TYPE.TOKEN_ELSE) {
            if (this.elseAppended) {
                throw new Error('Else appended!');
            }
            this.elseAppended = true;
        }
        else {
            if (this.elseAppended) {
                this.falseBranchChildren.push(instruction);
            }
            else {
                this.trueBranchChildren.push(instruction);
            }
        }
        return instruction.withParent(this);
    };
    SALVAGE_UNLESS.prototype.allowChildren = function () {
        return true;
    };
    SALVAGE_UNLESS.prototype.parse = function (context) {
        var result = '';
        if (!context.isNotEmpty(this.getParam(0))) {
            for (var i = 0, len = this.trueBranchChildren.length; i < len; i++) {
                result = result.concat(this.trueBranchChildren[i].parse(context));
            }
        }
        else {
            for (var i = 0, len = this.falseBranchChildren.length; i < len; i++) {
                result = result.concat(this.falseBranchChildren[i].parse(context));
            }
        }
        return result;
    };
    return SALVAGE_UNLESS;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_TEXT = (function (_super) {
    __extends(SALVAGE_TEXT, _super);
    function SALVAGE_TEXT(text) {
        var _this = _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_TEXT, null) || this;
        _this.text = text;
        return _this;
    }
    SALVAGE_TEXT.prototype.allowChildren = function () {
        return false;
    };
    SALVAGE_TEXT.prototype.parse = function (context) {
        return this.text;
    };
    SALVAGE_TEXT.prototype.append = function (instruction) {
        throw new Error("Method not allowed.");
    };
    return SALVAGE_TEXT;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_BLOCK_VAR = (function (_super) {
    __extends(SALVAGE_BLOCK_VAR, _super);
    function SALVAGE_BLOCK_VAR(params, isEscaped) {
        var _this = _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_VAR, []) || this;
        _this.params.push(Salvage.normalizePath(params[0]));
        if (_this.params[0] === null) {
            throw new Error('Illegal variable: ' + params[0]);
        }
        for (var i = 1, len = params.length; i < len; i++) {
            _this.params.push(params[i]);
        }
        _this.isEscaped = isEscaped;
        return _this;
    }
    SALVAGE_BLOCK_VAR.prototype.allowChildren = function () {
        return false;
    };
    SALVAGE_BLOCK_VAR.prototype.parse = function (context) {
        var result = String(context.get(this.getParam(0)));
        for (var i = 1, len = this.params.length; i < len; i++) {
            result = context.getHelper(this.params[i]).func(result);
        }
        if (!this.isEscaped) {
            return result;
        }
        else {
            return result.replace(/"/g, '&quot;').replace(/>/g, '&gt;').replace(/</g, '&lt;');
        }
    };
    SALVAGE_BLOCK_VAR.prototype.append = function (instruction) {
        throw new Error('A VAR block does not allow insertion');
    };
    return SALVAGE_BLOCK_VAR;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_INSTRUCTION_EACH = (function (_super) {
    __extends(SALVAGE_INSTRUCTION_EACH, _super);
    function SALVAGE_INSTRUCTION_EACH(params) {
        var _this = _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_EACH, []) || this;
        _this.children = [];
        _this.params.push(Salvage.normalizePath(params[0]));
        if (null === _this.params[0]) {
            throw new Error('Illegal each argument!');
        }
        return _this;
    }
    SALVAGE_INSTRUCTION_EACH.prototype.allowChildren = function () {
        return true;
    };
    SALVAGE_INSTRUCTION_EACH.prototype.parse = function (context) {
        var result = '';
        (function (self) {
            context.each(self.getParam(0), function (item) {
                for (var i = 0, len = self.children.length; i < len; i++) {
                    result = result.concat(self.children[i].parse(item));
                }
            });
        })(this);
        return result;
    };
    SALVAGE_INSTRUCTION_EACH.prototype.append = function (instruction) {
        this.children.push(instruction.withParent(this));
        return instruction;
    };
    return SALVAGE_INSTRUCTION_EACH;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_INSTRUCTION_ELSE = (function (_super) {
    __extends(SALVAGE_INSTRUCTION_ELSE, _super);
    function SALVAGE_INSTRUCTION_ELSE() {
        return _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_ELSE, null) || this;
    }
    SALVAGE_INSTRUCTION_ELSE.prototype.allowChildren = function () {
        return false;
    };
    SALVAGE_INSTRUCTION_ELSE.prototype.parse = function (context) {
        throw new Error("Should never be parsed");
    };
    SALVAGE_INSTRUCTION_ELSE.prototype.append = function (instruction) {
        throw new Error("Cannot have children");
    };
    SALVAGE_INSTRUCTION_ELSE.prototype.withParent = function (parent) {
        if (!parent || (parent.getBlockType() !== E_SALVAGE_BLOCK_TYPE.TOKEN_IF && parent.getBlockType() !== E_SALVAGE_BLOCK_TYPE.TOKEN_UNLESS)) {
            throw new Error('Invalid ELSE block parent: Expected IF or UNLESS!');
        }
        return this;
    };
    return SALVAGE_INSTRUCTION_ELSE;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_BLOCK_WITH = (function (_super) {
    __extends(SALVAGE_BLOCK_WITH, _super);
    function SALVAGE_BLOCK_WITH(params) {
        var _this = _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_WITH, []) || this;
        _this.children = [];
        _this.params.push(Salvage.normalizePath(params[0]));
        if (null === _this.params[0]) {
            throw new Error('Illegal WITH argument');
        }
        return _this;
    }
    SALVAGE_BLOCK_WITH.prototype.allowChildren = function () {
        return true;
    };
    SALVAGE_BLOCK_WITH.prototype.parse = function (context) {
        var ctx = context.cd(this.getParam(0)), result = '';
        for (var i = 0, len = this.children.length; i < len; i++) {
            result = result.concat(this.children[i].parse(ctx));
        }
        return result;
    };
    SALVAGE_BLOCK_WITH.prototype.append = function (instruction) {
        this.children.push(instruction.withParent(this));
        return instruction;
    };
    return SALVAGE_BLOCK_WITH;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var SALVAGE_INSTRUCTION_EQUALS = (function (_super) {
    __extends(SALVAGE_INSTRUCTION_EQUALS, _super);
    function SALVAGE_INSTRUCTION_EQUALS(params) {
        var _this = _super.call(this, E_SALVAGE_BLOCK_TYPE.TOKEN_EQUALS, []) || this;
        _this.children = [];
        _this.params[0] = Salvage.normalizePath(params[0]);
        _this.params[1] = Salvage.normalizePath(params[1]);
        if (null === _this.params[0]) {
            throw new Error("Illegal EQUALS variable: " + params[0]);
        }
        if (null === _this.params[1]) {
            throw new Error("Illegal EQUALS variable: " + params[1]);
        }
        return _this;
    }
    SALVAGE_INSTRUCTION_EQUALS.prototype.append = function (instruction) {
        this.children.push(instruction);
        return instruction.withParent(this);
    };
    SALVAGE_INSTRUCTION_EQUALS.prototype.allowChildren = function () {
        return true;
    };
    SALVAGE_INSTRUCTION_EQUALS.prototype.parse = function (context) {
        var result = '';
        if (context.equals(this.getParam(0), this.getParam(1))) {
            for (var i = 0, len = this.children.length; i < len; i++) {
                result = result.concat(this.children[i].parse(context));
            }
        }
        return result;
    };
    return SALVAGE_INSTRUCTION_EQUALS;
}(SALVAGE_ABSTRACT_INSTRUCTION));
var Utils = (function () {
    function Utils() {
    }
    Utils.isArray = function (variable) {
        return variable && (variable instanceof Array);
    };
    Utils.isComplex = function (variable) {
        return variable && (typeof variable === 'object');
    };
    Utils.hasProperty = function (variable, propertyName) {
        return Utils.isComplex(variable) && variable.hasOwnProperty(propertyName);
    };
    Utils.getProperty = function (variable, propertyName) {
        if (Utils.hasProperty(variable, propertyName)) {
            return variable[propertyName];
        }
        else {
            return null;
        }
    };
    Utils.getKeys = function (variable) {
        if (!Utils.isComplex(variable)) {
            return [];
        }
        else {
            var result = [];
            if (Utils.isArray(variable)) {
                for (var i = 0, len = variable.length; i < len; i++) {
                    result.push(String(i));
                }
            }
            else {
                for (var key in variable) {
                    if (variable.hasOwnProperty(key)) {
                        result.push(key);
                    }
                }
            }
            return result;
        }
    };
    Utils.isString = function (variable) {
        return typeof variable === 'string';
    };
    Utils.isSet = function (variable) {
        return undefined !== variable;
    };
    Utils.isInt = function (variable) {
        return typeof variable === 'number' && isFinite(variable) && !isNaN(variable) && Math.round(variable) === variable;
    };
    Utils.arrayKeyExists = function (key, variable) {
        return Utils.isComplex(variable) && variable.hasOwnProperty(key);
    };
    Utils.arrayMerge = function (a, b) {
        var result = [];
        for (var i = 0, len = a.length; i < len; i++) {
            result.push(a[i]);
        }
        for (var i = 0, len = b.length; i < len; i++) {
            result.push(b[i]);
        }
        return result;
    };
    Utils.arrayValues = function (variable) {
        return Utils.isArray(variable)
            ? variable.slice(0)
            : [];
    };
    Utils.arrayUnique = function (variable) {
        if (!Utils.isArray(variable)) {
            return [];
        }
        var result = [], seen, j, i, len;
        for (i = 0, len = variable.length; i < len; i++) {
            seen = false;
            for (j = 0; j < i; j++) {
                if (variable[i] === variable[j]) {
                    seen = true;
                    break;
                }
            }
            if (!seen) {
                result.push(variable[i]);
            }
        }
        return result;
    };
    Utils.isFloat = function (mixed) {
        return typeof mixed === 'number' && isFinite(mixed) && !isNaN(mixed) && Math.round(mixed) !== mixed;
    };
    Utils.reverseString = function (str) {
        var result = '';
        for (var i = str.length - 1; i > -1; i--) {
            result = result + str.charAt(i);
        }
        return result;
    };
    return Utils;
}());
var StringParser = (function () {
    function StringParser(buffer) {
        this.parsed = '';
        this.remain = '';
        this.lineNum = 1;
        this.fileName = '<UNKNOWN>';
        this.remain = buffer;
    }
    StringParser.prototype.consume = function (numberOfBytes) {
        if (numberOfBytes < 0) {
            throw new Error('Invalid argument');
        }
        var chunk = this.remain.substr(0, numberOfBytes);
        var bytes = chunk.length;
        if (bytes === 0) {
            return;
        }
        for (var i = 0; i < bytes; i++) {
            if (chunk.charAt(i) === "\r") {
                if ((i + 1 < bytes) && (chunk.charAt(i + 1) == "\n")) {
                    i++;
                }
                this.lineNum++;
            }
            else if (chunk.charAt(i) == "\n") {
                this.lineNum++;
            }
        }
        this.parsed += chunk;
        this.remain = this.remain.substr(bytes);
    };
    StringParser.prototype.tell = function () {
        return this.parsed.length;
    };
    StringParser.prototype.available = function () {
        return this.remain.length;
    };
    StringParser.prototype.eof = function () {
        return this.remain === '';
    };
    StringParser.prototype.line = function () {
        return this.lineNum;
    };
    StringParser.prototype.file = function () {
        return this.fileName;
    };
    StringParser.prototype.setFileName = function (name) {
        if (name === void 0) { name = null; }
        this.fileName = name || '<UNKNOWN>';
    };
    StringParser.prototype.canReadString = function (str) {
        if (typeof str === "string") {
            return this.remain.substr(0, str.length) === str;
        }
        else {
            return false;
        }
    };
    StringParser.prototype.canReadExpression = function (str) {
        return str
            ? str.exec(this.remain)
            : null;
    };
    StringParser.prototype.toString = function () {
        return this.remain;
    };
    StringParser.prototype.nextToken = function () {
        if (this.eof()) {
            return 'END_OF_FILE';
        }
        else {
            var matches = void 0;
            if (matches = /^([\s]+)?([^\s]+)/.exec(this.remain)) {
                return matches[0];
            }
            else {
                return '';
            }
        }
    };
    return StringParser;
}());
var Runtime = (function () {
    function Runtime() {
        this.types = null;
        this.validators = null;
        this.types = {
            'int': new IntegerType(this, 'int'),
            'sint': new SIntType(this, 'sint'),
            'float': new DecimalType(this, 'float'),
            'sfloat': new SFloatType(this, 'sfloat'),
            'number': new NumberType(this, 'number'),
            'snumber': new SNumberType(this, 'snumber'),
            'boolean': new BooleanType(this, 'boolean'),
            'string': new VarcharType(this, 'string'),
            'any': new AnyType(this, 'any')
        };
        this.validators = {};
    }
    Runtime.prototype.addType = function (typeName, extendsType) {
        if (extendsType === void 0) { extendsType = null; }
        if (!this.isTypeName(typeName)) {
            throw new Error('Invalid type name `' + JSON.stringify(typeName) + '`. The type name must be a string');
        }
        if (this.isTypeRegistered(typeName)) {
            return this.types[typeName];
        }
        else {
            return this.types[typeName] = new Type(this, typeName, extendsType);
        }
    };
    Runtime.prototype.addValidator = function (validatorName, extendsValidator) {
        if (extendsValidator === void 0) { extendsValidator = null; }
        if (!this.isValidatorName(validatorName)) {
            throw new Error('Invalid validator name');
        }
        if (this.isValidatorRegistered(validatorName)) {
            return this.validators[validatorName];
        }
        else {
            return this.validators[validatorName] = new Validator(this, validatorName, extendsValidator);
        }
    };
    Runtime.prototype.isTypeName = function (typeName) {
        return Utils.isString(typeName) && typeName !== '' && /^[a-zA-Z_]([a-zA-Z0-9_]+)?(\[\])?$/.test(typeName)
            ? true
            : false;
    };
    Runtime.prototype.isValidatorName = function (validatorName) {
        return Utils.isString(validatorName) && validatorName !== '' && /^[a-zA-Z_]([a-zA-Z0-9_]+)?$/.test(validatorName)
            ? true
            : false;
    };
    Runtime.prototype.isTypeRegistered = function (typeName) {
        return Utils.isString(typeName) && Utils.arrayKeyExists(typeName, this.types);
    };
    Runtime.prototype.isValidatorRegistered = function (validatorName) {
        return Utils.isString(validatorName) && Utils.arrayKeyExists(validatorName, this.validators);
    };
    Runtime.prototype.isTypeOf = function (mixed, typeName, errors) {
        if (errors === void 0) { errors = null; }
        if (null !== errors) {
            errors.splice(0, errors.length);
        }
        if (this.isTypeName(typeName)) {
            var isArray = Utils.reverseString(typeName).substr(0, 2) == '][', result = void 0;
            if (isArray) {
                typeName = typeName.substr(0, typeName.length - 2);
            }
            if (this.isTypeRegistered(typeName)) {
                if (isArray) {
                    result = this.types[typeName].testArray(mixed, errors);
                    if (Utils.isArray(errors) && errors.length === 0) {
                        errors = null;
                    }
                    return result;
                }
                else {
                    result = this.types[typeName].test(mixed, errors);
                    if (Utils.isArray(errors) && errors.length === 0) {
                        errors = null;
                    }
                    return result;
                }
            }
            else {
                throw new Error('Type "' + typeName + '" is not declared');
            }
        }
        else {
            throw new Error('Argument typeName must be a valid type string name');
        }
    };
    Runtime.prototype.isValidatableBy = function (mixed, validatorName, errors) {
        if (errors === void 0) { errors = null; }
        if (null !== errors) {
            errors.splice(0, errors.length);
        }
        if (this.isValidatorName(validatorName)) {
            var result = void 0;
            if (this.isValidatorRegistered(validatorName)) {
                result = this.validators[validatorName].test(mixed, errors);
                if (Utils.isArray(errors) && errors.length === 0) {
                    errors = null;
                }
                return result;
            }
            else {
                throw new Error('Validator "' + validatorName + '" is not declared');
            }
        }
        else {
            throw new Error('Argument validatorName must be a valid validator string name');
        }
    };
    Runtime.prototype.typeToString = function (type) {
        if (Utils.isString(type)) {
            return type;
        }
        else if (Utils.isComplex(type)) {
            if (Utils.isString(type.type)) {
                return type.type;
            }
        }
        throw new Error('Invalid argument: string|IPropertyDefinition expected');
    };
    Runtime.prototype.toString = function () {
        var out = [];
        for (var name_2 in this.types) {
            if (this.types.hasOwnProperty(name_2)) {
                if (['string', 'int', 'float', 'boolean', 'number', 'any'].indexOf(name_2) === -1) {
                    out.push(name_2.toString());
                }
            }
        }
        for (var name_3 in this.validators) {
            if (this.validators.hasOwnProperty(name_3)) {
                out.push(name_3.toString());
            }
        }
        return out.join("\n\n");
    };
    Runtime.prototype.getType = function (typeName) {
        if (Utils.isString(typeName) && Utils.isSet(this.types[typeName])) {
            return this.types[typeName];
        }
        else {
            return null;
        }
    };
    Runtime.prototype.getValidator = function (validatorName) {
        if (Utils.isString(validatorName) && Utils.isSet(this.validators[validatorName])) {
            return this.validators[validatorName];
        }
        else {
            return null;
        }
    };
    Runtime.prototype.load = function (definitionFileBufferContents) {
        if (!Utils.isString(definitionFileBufferContents)) {
            throw new Error('Invalid argument definitionFileBufferContents. Must be string!');
        }
        if (definitionFileBufferContents === '') {
            throw new Error('Invalid argument definitionFileBufferContents. Must be non-empty!');
        }
        new RuntimeStringParser(definitionFileBufferContents, '<Buffer>', this);
        return this;
    };
    Runtime.createFromString = function (buffer) {
        var result = new Runtime();
        if (Utils.isString(buffer)) {
            result.load(buffer);
        }
        else {
            throw new Error('Failed to load definitions from string: ' + JSON.stringify(buffer));
        }
        return result;
    };
    Runtime.prototype.hasType = function (typeName) {
        return !!(Utils.isString(typeName) && this.types.hasOwnProperty(typeName));
    };
    Runtime.prototype.describeType = function (typeName) {
        if (!this.hasType(typeName)) {
            return 'void';
        }
        else {
            switch (typeName) {
                case 'int':
                case 'sint':
                case 'float':
                case 'sfloat':
                case 'number':
                case 'snumber':
                case 'boolean':
                case 'string':
                case 'any':
                    return 'native';
                default:
                    return 'user defined';
            }
        }
    };
    Runtime.prototype.getTypeDescriptor = function (forTypeName) {
        return this.hasType(forTypeName)
            ? this.types[forTypeName].getTypeDescriptor()
            : null;
    };
    return Runtime;
}());
var RuntimeStringParser = (function (_super) {
    __extends(RuntimeStringParser, _super);
    function RuntimeStringParser(buffer, fileName, runtime) {
        var _this = _super.call(this, buffer) || this;
        _this.runtime = null;
        _this.setFileName(fileName);
        _this.runtime = runtime;
        _this.parse();
        return _this;
    }
    RuntimeStringParser.read = function (tokenName, reader) {
        if (!Utils.isString(tokenName)) {
            throw new Error('Invalid argument tokenName: expected string');
        }
        if (Utils.arrayKeyExists(tokenName, RuntimeStringParser.tokens)) {
            var consume = null;
            switch (tokenName) {
                case 'TOK_TYPE':
                    consume = 4;
                    break;
                case 'TOK_VALIDATOR':
                    consume = 9;
                    break;
                case 'TOK_EXTENDS':
                    consume = 7;
                default:
                    break;
            }
            var matches = reader.canReadExpression(RuntimeStringParser.tokens[tokenName]);
            if (matches) {
                reader.consume(consume === null ? matches[0].length : consume);
                return true;
            }
            else {
                return false;
            }
        }
        else {
            throw new Error('Unknown parser token name: ' + tokenName);
        }
    };
    RuntimeStringParser.readString = function (tokenName, reader) {
        if (!Utils.isString(tokenName)) {
            throw new Error('Invalid argument tokenName: expected string');
        }
        if (Utils.arrayKeyExists(tokenName, RuntimeStringParser.tokens)) {
            var matches = reader.canReadExpression(RuntimeStringParser.tokens[tokenName]);
            if (matches) {
                reader.consume(matches[0].length);
                return matches[0];
            }
            else {
                return false;
            }
        }
        else {
            throw new Error('Unknown parser token name: ' + tokenName);
        }
    };
    RuntimeStringParser.readWhiteSpaceOrComment = function (reader) {
        if (reader.eof()) {
            return false;
        }
        var matches = 0, result = false;
        do {
            result = false;
            if (RuntimeStringParser.read('WHITESPACE', reader)) {
                result = true;
                matches++;
                continue;
            }
            if (RuntimeStringParser.read('COMMENT', reader)) {
                result = true;
                matches++;
                continue;
            }
            if (reader.eof()) {
                result = true;
            }
        } while (result === true);
        return matches > 0;
    };
    RuntimeStringParser.readTypeProperty = function (reader, type, readSemiColon) {
        if (readSemiColon === void 0) { readSemiColon = true; }
        RuntimeStringParser.readWhiteSpaceOrComment(reader);
        var returnValue = {
            'isIndex': false,
            'indexType': false,
            'name': false,
            'optional': false,
            'type': false
        };
        if (RuntimeStringParser.read('TOK_SQBRACKET_BEGIN', reader)) {
            returnValue.indexType = RuntimeStringParser.readTypeProperty(reader, type, false);
            if (returnValue.optional) {
                throw new Error('Indexes cannot be optional, at line ' + reader.line() + ' in file ' + reader.file());
            }
            returnValue.isIndex = true;
            RuntimeStringParser.readWhiteSpaceOrComment(reader);
            if (!RuntimeStringParser.read('TOK_SQBRACKET_END', reader)) {
                throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected "]", at line ' + reader.line() + ' in file ' + reader.file());
            }
        }
        else {
            returnValue.name = RuntimeStringParser.readString('TOK_VARIABLE_NAME', reader);
            if (returnValue.name === false) {
                throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected key name, at line ' + reader.line() + ' in file ' + reader.file());
            }
            returnValue['optional'] = RuntimeStringParser.read('TOK_QUESTION', reader);
            RuntimeStringParser.readWhiteSpaceOrComment(reader);
        }
        if (!RuntimeStringParser.read('TOK_DOUBLEDOT', reader)) {
            throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected ":", at line ' + reader.line() + ' in file ' + reader.file());
        }
        RuntimeStringParser.readWhiteSpaceOrComment(reader);
        if (returnValue.type = RuntimeStringParser.readString('TOK_VARIABLE_NAME', reader)) {
            if (RuntimeStringParser.read('TOK_SQBRACKET_BEGIN', reader)) {
                if (!RuntimeStringParser.read('TOK_SQBRACKET_END', reader)) {
                    throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected "]", at line ' + reader.line() + ' in file ' + reader.file());
                }
                returnValue.type = returnValue.type + '[]';
            }
        }
        else {
            throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected TYPE_DEF, at line ' + reader.line() + ' in file ' + reader.file());
        }
        RuntimeStringParser.readWhiteSpaceOrComment(reader);
        if (readSemiColon) {
            if (!RuntimeStringParser.read('TOK_SEMICOLON', reader)) {
                throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected ";", at line ' + reader.line() + ' in file ' + reader.file());
            }
        }
        return returnValue;
    };
    RuntimeStringParser.prototype.parseType = function () {
        if (!RuntimeStringParser.readWhiteSpaceOrComment(this)) {
            throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ' at line: ' + this.line() + ' in file ' + this.file());
        }
        var typeName = RuntimeStringParser.readString('TOK_VARIABLE_NAME', this);
        if (typeName === false) {
            throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ', expected type name, at line: ' + this.line() + ' in file ' + this.file());
        }
        var typeExtends = null;
        RuntimeStringParser.readWhiteSpaceOrComment(this);
        if (RuntimeStringParser.read('TOK_EXTENDS', this)) {
            RuntimeStringParser.readWhiteSpaceOrComment(this);
            typeExtends = RuntimeStringParser.readString('TOK_VARIABLE_NAME', this);
            if (typeExtends === false) {
                throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ', expected extended type name, at line: ' + this.line() + ' in file ' + this.file());
            }
        }
        var returnValue = this.runtime.addType(typeName, typeExtends);
        RuntimeStringParser.readWhiteSpaceOrComment(this);
        if (!RuntimeStringParser.read('TOK_BLOCK_BEGIN', this)) {
            throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ', expected "{", at line: ' + this.line() + ' in file ' + this.file());
        }
        var property;
        do {
            RuntimeStringParser.readWhiteSpaceOrComment(this);
            if (this.canReadExpression(RuntimeStringParser.tokens['TOK_BLOCK_END'])) {
                break;
            }
            property = RuntimeStringParser.readTypeProperty(this, returnValue);
            if (property.isIndex) {
                returnValue.addIndex(property.indexType.type, {
                    'type': property.type,
                    'optional': property.optional
                });
            }
            else {
                returnValue.addProperty(property.name, {
                    'type': property.type,
                    'optional': property.optional
                });
            }
        } while (property);
        if (!RuntimeStringParser.read('TOK_BLOCK_END', this)) {
            throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ', expected "}", at line: ' + this.line() + ' in file ' + this.file() + ', buffer: ' + JSON.stringify(this.toString()));
        }
        return returnValue;
    };
    RuntimeStringParser.readInlineValue = function (reader) {
        var value = RuntimeStringParser.readString('TOK_NUMBER', reader), result;
        if (Utils.isString(value)) {
            return parseFloat(String(value));
        }
        value = RuntimeStringParser.readString('TOK_STRING', reader);
        if (Utils.isString(value)) {
            value = value.substr(1, value.length - 2);
            result = '';
            for (var i = 0, len = value.length; i < len; i++) {
                if (value[i] == '\\') {
                    if (i < len - 1) {
                        switch (value.charAt(i + 1)) {
                            case 'n':
                                result += "\n";
                                break;
                            case 'r':
                                result += "\r";
                                break;
                            case '\t':
                                result += "\t";
                                break;
                            default:
                                result += value.charAt(i + 1);
                                break;
                        }
                        i++;
                    }
                    else {
                        result += value.charAt(i);
                    }
                }
                else {
                    result += value.charAt(i);
                }
            }
            return result;
        }
        value = RuntimeStringParser.readString('TOK_BOOLEAN', reader);
        if (value !== false) {
            return value === 'true';
        }
        return null;
    };
    RuntimeStringParser.readEnumValues = function (reader, readAnyInsteadOfVar) {
        if (readAnyInsteadOfVar === void 0) { readAnyInsteadOfVar = false; }
        RuntimeStringParser.readWhiteSpaceOrComment(reader);
        if (!RuntimeStringParser.read('TOK_RBRACKET_BEGIN', reader)) {
            throw new Error('Unexpected token ' + reader.nextToken() + ', expected "(", at line ' + reader.line() + ' in file ' + reader.file());
        }
        var result = [], next, item;
        do {
            next = false;
            RuntimeStringParser.readWhiteSpaceOrComment(reader);
            if (readAnyInsteadOfVar) {
                item = RuntimeStringParser.readInlineValue(reader);
            }
            else {
                item = RuntimeStringParser.readString('TOK_VARIABLE_NAME', reader);
            }
            if (item) {
                result.push(item);
                RuntimeStringParser.readWhiteSpaceOrComment(reader);
                if (RuntimeStringParser.read('TOK_COMMA', reader)) {
                    next = true;
                }
            }
        } while (next);
        RuntimeStringParser.readWhiteSpaceOrComment(reader);
        if (!RuntimeStringParser.read('TOK_RBRACKET_END', reader)) {
            throw new Error('Unexpected token ' + reader.nextToken() + ', expected ")", at line ' + reader.line() + ' in file ' + reader.file());
        }
        return result;
    };
    RuntimeStringParser.getValidatorPropertyRules = function (reader, endOfEnumerationToken) {
        if (endOfEnumerationToken === void 0) { endOfEnumerationToken = 'TOK_SEMICOLON'; }
        var rules = [], operator, value, error, readNext;
        do {
            operator = RuntimeStringParser.readString('TOK_VALIDATOR_PROPERTY', reader);
            if (operator === false) {
                throw new Error('Unexpected token ' + reader.nextToken() + ', expected validator operator, on line ' + reader.line() + ' in file ' + reader.file());
            }
            operator = operator.substr(1);
            RuntimeStringParser.readWhiteSpaceOrComment(reader);
            switch (operator) {
                case 'index':
                    value = null;
                    if (!RuntimeStringParser.read('TOK_SQBRACKET_BEGIN', reader)) {
                        throw new Error('Unexpected token ' + reader.nextToken() + ', expected "[", on line ' + reader.line() + ' in file ' + reader.file());
                    }
                    RuntimeStringParser.readWhiteSpaceOrComment(reader);
                    value = RuntimeStringParser.getValidatorPropertyRules(reader, 'TOK_SQBRACKET_END');
                    break;
                case 'instanceof':
                    value = RuntimeStringParser.readString('TOK_VARIABLE_NAME', reader);
                    break;
                case 'oneof':
                    value = RuntimeStringParser.readEnumValues(reader);
                    break;
                case 'require':
                    if (reader.canReadString('(')) {
                        value = RuntimeStringParser.readEnumValues(reader);
                    }
                    else {
                        value = RuntimeStringParser.readString('TOK_VARIABLE_NAME', reader);
                        if (null === value) {
                            throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected validator name or list of validators, on line ' + reader.line() + ' in file ' + reader.file());
                        }
                    }
                    break;
                case 'in':
                case 'nin':
                    if (reader.canReadString('(')) {
                        value = RuntimeStringParser.readEnumValues(reader, true);
                    }
                    else {
                        throw new Error('Unexpected token ' + JSON.stringify(reader.nextToken()) + ', expected "(", on line ' + reader.line() + ' in file ' + reader.file());
                    }
                    break;
                default:
                    value = RuntimeStringParser.readInlineValue(reader);
                    break;
            }
            if (value === null) {
                throw new Error('Unexpected token ' + reader.nextToken() + ', expected <value>, at line ' + reader.line() + ' in file ' + reader.file());
            }
            RuntimeStringParser.readWhiteSpaceOrComment(reader);
            if (RuntimeStringParser.read('TOK_VALIDATOR_PTR', reader)) {
                RuntimeStringParser.readWhiteSpaceOrComment(reader);
                error = RuntimeStringParser.readInlineValue(reader);
                if (error !== null) {
                    RuntimeStringParser.readWhiteSpaceOrComment(reader);
                }
            }
            else {
                error = null;
            }
            readNext = RuntimeStringParser.read('TOK_COMMA', reader);
            if (false === readNext) {
                if (false === RuntimeStringParser.read(endOfEnumerationToken, reader)) {
                    throw new Error('Unexpected token ' + reader.nextToken() + ', expected <' + endOfEnumerationToken + '> or ",", at line ' + reader.line() + ' in file ' + reader.file());
                }
                else {
                    RuntimeStringParser.readWhiteSpaceOrComment(reader);
                }
            }
            if (reader.eof()) {
                throw new Error('Unexpected end of buffer, @ line ' + reader.line() + ' in file ' + reader.file());
            }
            rules.push({
                'operator': operator,
                'value': value,
                'error': error
            });
            if (readNext) {
                RuntimeStringParser.readWhiteSpaceOrComment(reader);
            }
        } while (readNext);
        return rules;
    };
    RuntimeStringParser.readValidatorProperty = function (reader, validator) {
        var rules, rule, propertyName;
        RuntimeStringParser.readWhiteSpaceOrComment(reader);
        if (reader.canReadString('@')) {
            rules = RuntimeStringParser.getValidatorPropertyRules(reader);
            try {
                for (var ruleName in rules) {
                    if (!rules.hasOwnProperty(rule)) {
                        continue;
                    }
                    rule = rules[ruleName];
                    validator.addRootCondition(rule.operator, rule.value, rule.error);
                }
            }
            catch (e) {
                throw new Error('Parser error, at line ' + reader.line() + ' in file ' + reader.file() + ': ' + e.getMessage());
            }
        }
        else {
            propertyName = RuntimeStringParser.readString('TOK_VARIABLE_NAME', reader);
            if (propertyName === false) {
                throw new Error('Unexpected token ' + reader.nextToken() + ', expected <operator> or <property>, at line ' + reader.line() + ' in file ' + reader.file());
            }
            RuntimeStringParser.readWhiteSpaceOrComment(reader);
            if (!RuntimeStringParser.read('TOK_DOUBLEDOT', reader)) {
                throw new Error('Unexpected token ' + reader.nextToken() + ', expected ":", at line ' + reader.line() + ' in file ' + reader.file());
            }
            RuntimeStringParser.readWhiteSpaceOrComment(reader);
            rules = RuntimeStringParser.getValidatorPropertyRules(reader);
            try {
                for (var ruleName in rules) {
                    if (!rules.hasOwnProperty(rule)) {
                        continue;
                    }
                    rule = rules[ruleName];
                    validator.addPropertyCondition(propertyName, rule.operator, rule.value, rule.error);
                }
            }
            catch (e) {
                throw new Error('Parser error, at line ' + reader.line() + ' in file ' + reader.file() + ': ' + e.getMessage());
            }
        }
        return validator;
    };
    RuntimeStringParser.prototype.parseValidator = function () {
        if (!RuntimeStringParser.readWhiteSpaceOrComment(this)) {
            throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ' at line: ' + this.line() + ' in file ' + this.file());
        }
        var validatorName, validatorExtends, returnValue, rule;
        validatorName = RuntimeStringParser.readString('TOK_VARIABLE_NAME', this);
        validatorExtends = null;
        RuntimeStringParser.readWhiteSpaceOrComment(this);
        if (RuntimeStringParser.read('TOK_EXTENDS', this)) {
            RuntimeStringParser.readWhiteSpaceOrComment(this);
            validatorExtends = RuntimeStringParser.readString('TOK_VARIABLE_NAME', this);
            if (validatorExtends === false) {
                throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ', expected extended validator name, at line: ' + this.line() + ' in file ' + this.file());
            }
        }
        returnValue = this.runtime.addValidator(validatorName, validatorExtends);
        RuntimeStringParser.readWhiteSpaceOrComment(this);
        if (!RuntimeStringParser.read('TOK_BLOCK_BEGIN', this)) {
            throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ', expected "{", at line: ' + this.line() + ' in file ' + this.file());
        }
        do {
            RuntimeStringParser.readWhiteSpaceOrComment(this);
            if (this.canReadExpression(RuntimeStringParser.tokens['TOK_BLOCK_END'])) {
                break;
            }
            rule = RuntimeStringParser.readValidatorProperty(this, returnValue);
        } while (rule);
        if (!RuntimeStringParser.read('TOK_BLOCK_END', this)) {
            throw new Error('Unexpected token ' + JSON.stringify(this.nextToken()) + ', expected "}", at line: ' + this.line() + ' in file ' + this.file() + ', buffer: ' + JSON.stringify(this.toString()));
        }
        return returnValue;
    };
    RuntimeStringParser.prototype.parse = function () {
        var $result;
        while (!this.eof()) {
            switch (true) {
                case RuntimeStringParser.read('WHITESPACE', this):
                case RuntimeStringParser.read('COMMENT', this):
                    break;
                case RuntimeStringParser.read('TOK_TYPE', this):
                    $result = this.parseType();
                    break;
                case RuntimeStringParser.read('TOK_VALIDATOR', this):
                    $result = this.parseValidator();
                    break;
                default:
                    throw new Error("Unknown token " + JSON.stringify(this.nextToken()) + ' at line: ' + this.line() + ' in file ' + this.file());
            }
        }
    };
    RuntimeStringParser.tokens = {
        'WHITESPACE': /^([\s]+)/,
        'COMMENT': /^(\/\/[^\n\r]+|\/\*[\s\S\r\n]+?\*\/)/,
        'TOK_TYPE': /^type(\s|\/)/,
        'TOK_VALIDATOR': /^validator(\s|\/)/,
        'TOK_EXTENDS': /^extends(\s|\/)/,
        'TOK_VARIABLE_NAME': /^[a-zA-Z_]([a-zA-Z0-9_]+)?/,
        'TOK_BLOCK_BEGIN': /^\{/,
        'TOK_BLOCK_END': /^\}/,
        'TOK_SQBRACKET_BEGIN': /^\[/,
        'TOK_SQBRACKET_END': /^\]/,
        'TOK_RBRACKET_BEGIN': /^\(/,
        'TOK_RBRACKET_END': /^\)/,
        'TOK_QUESTION': /^\?/,
        'TOK_DOUBLEDOT': /^\:/,
        'TOK_SEMICOLON': /^;/,
        'TOK_VALIDATOR_PROPERTY': /^@[a-zA-Z_]([a-zA-Z0-9_]+)?/,
        'TOK_VALIDATOR_PTR': /^=>/,
        'TOK_NUMBER': /^(\-)?[\d]+(\.[\d]+)?/,
        'TOK_STRING': /^("(?:[^"\\\\]|\\\\.)*"|\'(?:[^\'\\\\]|\\\\.)*\')/,
        'TOK_BOOLEAN': /^(true|false)/,
        'TOK_NULL': /^null/,
        'TOK_COMMA': /^,/,
    };
    return RuntimeStringParser;
}(StringParser));
var Type = (function () {
    function Type(runtime, typeName, extendsType) {
        if (extendsType === void 0) { extendsType = null; }
        this._extends = null;
        this.properties = null;
        this.index = null;
        this.runtime = runtime;
        this.name = typeName;
        if (extendsType !== null) {
            if (typeof extendsType !== "string") {
                throw new Error('extendsType argument must be string|null');
            }
            this._extends = extendsType;
        }
    }
    Type.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        var includeErrors = Utils.isArray(errors);
        if (!Utils.isComplex(mixed)) {
            if (includeErrors) {
                errors.push('array | object expected');
            }
            return false;
        }
        var props = this.getRequiredProperties(), needsImplementation, k, v, type;
        for (var i = 0, len = props.length; i < len; i++) {
            needsImplementation = props[i];
            if (!Utils.hasProperty(mixed, needsImplementation)) {
                if (includeErrors) {
                    errors.push('object ' + JSON.stringify(mixed) + ' does not implement a property called ' + JSON.stringify(needsImplementation));
                }
                return false;
            }
        }
        for (var i = 0, keys = Utils.getKeys(mixed), len = keys.length; i < len; i++) {
            k = keys[i];
            v = Utils.getProperty(mixed, k);
            if (!(type = this.getPropertyType(k))) {
                if (includeErrors) {
                    errors.push('property ' + JSON.stringify(k) + ' is not implemented in type "' + this.name + '"');
                }
                return false;
            }
            else {
                if (null === v) {
                    if (!this.isOptionalProperty(k)) {
                        if (includeErrors) {
                            errors.push('property ' + JSON.stringify(k) + ' cannot be null');
                        }
                        return false;
                    }
                }
                else {
                    if (!this.runtime.isTypeOf(v, type)) {
                        if (includeErrors) {
                            errors.push('property ' + JSON.stringify(k) + ' must be of type ' + JSON.stringify(type));
                        }
                        return false;
                    }
                }
            }
        }
        return true;
    };
    Type.prototype.isOptionalProperty = function (propertyName) {
        if (undefined !== this.properties[propertyName]) {
            return this.properties[propertyName].optional;
        }
        else {
            return true;
        }
    };
    Type.prototype.testArray = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        var includeErrors = Utils.isArray(errors);
        if (!Utils.isComplex(mixed)) {
            if (includeErrors) {
                errors.push('array | object expected');
            }
            return false;
        }
        var keys;
        for (var i = 0, len = (keys = Utils.getKeys(mixed)).length; i < len; i++) {
            if (keys.indexOf(String(i)) === -1) {
                if (includeErrors) {
                    errors.push('array | complex type expected');
                }
                return false;
            }
            if (!this.test(Utils.getProperty(mixed, String(i)), errors)) {
                if (includeErrors) {
                    errors.push('index #' + String(i) + ' is not a ' + this.name);
                }
                return false;
            }
        }
        return true;
    };
    Type.prototype.addProperty = function (propertyName, propertyType) {
        if (null === this.properties) {
            this.properties = {};
        }
        if (!Utils.isString(propertyName) || propertyName === '') {
            throw new Error('Invalid argument: propertyName must be of type string!');
        }
        if (!Utils.isComplex(propertyType)) {
            throw new Error('Invalid argument: propertyType must be of type object!');
        }
        if (Utils.isSet(this.properties[propertyName])) {
            throw new Error('Duplicate property "' + propertyName + '" in interface "' + this.name + '"');
        }
        this.properties[propertyName] = propertyType;
    };
    Type.prototype.addIndex = function (indexNameType, indexValueType) {
        if (null !== this.index) {
            throw new Error('Interface "' + this.name + '" already has a assigned index');
        }
        if (!Utils.isString(indexNameType) || indexNameType === '') {
            throw new Error('Invalid argument ( indexNameType )');
        }
        if (indexNameType != 'int' && indexNameType != 'number' && indexNameType != 'string') {
            throw new Error('Invalid index name type. Index names can be of type int|number|string');
        }
        if (!Utils.isArray(indexValueType)) {
            throw new Error('Invalid argument: indexValueType must be of type array!');
        }
        this.index = {
            'keyType': indexNameType,
            'valueType': indexValueType
        };
    };
    Type.prototype.toString = function () {
        if (null === this.index && null === this.properties) {
            return this.name;
        }
        else {
            var result = 'interface ' + this.name + (null === this._extends ? '' : ' extends ' + this._extends) + ' {', out = [], propertyType = void 0;
            if (this.index !== null) {
                out.push('    [ index: ' + this.index['keyType'] + ' ]: ' + this.runtime.typeToString(this.index['valueType']));
            }
            if (this.properties !== null) {
                for (var propertyName in this.properties) {
                    if (this.properties.hasOwnProperty(propertyName)) {
                        propertyType = this.properties[propertyName];
                        out.push('    ' + propertyName + (propertyType['optional'] ? '?' : '') + ': ' + this.runtime.typeToString(propertyType));
                    }
                }
            }
            if (out.length) {
                result = result + "\n" + out.join(";\n") + ";\n";
            }
            result = result + '}';
            return result;
        }
    };
    Type.prototype.validPropertyKey = function (propertyName) {
        if (null === this.properties && null === this.index) {
            return false;
        }
        if (!Utils.isString(propertyName) && !Utils.isInt(propertyName)) {
            return false;
        }
        if (Utils.isString(propertyName) && propertyName === '') {
            return false;
        }
        if (this.properties !== null) {
            if (Utils.arrayKeyExists(propertyName, this.properties)) {
                return true;
            }
        }
        if (this.index !== null) {
            if (this.runtime.isTypeOf(propertyName, this.index.keyType)) {
                return true;
            }
        }
        if (this._extends !== null) {
            var _extendsType = this.runtime.getType(this._extends);
            if (_extendsType) {
                return _extendsType.validPropertyKey(propertyName);
            }
        }
        return false;
    };
    Type.prototype.getPropertyType = function (propertyName) {
        if (null === this.properties && null === this.index) {
            return false;
        }
        if (!Utils.isString(propertyName) && !Utils.isInt(propertyName)) {
            return false;
        }
        if (Utils.isString(propertyName) && '' === propertyName) {
            return false;
        }
        if (this.properties !== null) {
            if (Utils.arrayKeyExists(propertyName, this.properties)) {
                return this.properties[propertyName].type;
            }
        }
        if (null !== this.index) {
            if (this.runtime.isTypeOf(propertyName, this.index.keyType)) {
                return this.index.valueType.type;
            }
        }
        if (this._extends !== null) {
            var _extends = this.runtime.getType(this._extends);
            if (_extends) {
                return _extends.getPropertyType(propertyName);
            }
        }
        return false;
    };
    Type.prototype.getRequiredProperties = function () {
        var result = [];
        if (this.properties !== null) {
            for (var propertyName in this.properties) {
                if (this.properties.propertyIsEnumerable(propertyName)) {
                    if (this.properties[propertyName].optional === false) {
                        result.push(propertyName);
                    }
                }
            }
        }
        else {
            result = [];
        }
        if (null !== this._extends) {
            var _extends = this.runtime.getType(this._extends);
            if (_extends) {
                result = Utils.arrayMerge(result, _extends.getRequiredProperties());
            }
        }
        return Utils.arrayValues(Utils.arrayUnique(result));
    };
    Type.prototype.getTypeDescriptor = function () {
        return {
            "properties": this.properties,
            "extendsType": this._extends,
            "name": this.name
        };
    };
    return Type;
}());
var Validator = (function () {
    function Validator(runtime, validatorName, extendsValidator) {
        if (extendsValidator === void 0) { extendsValidator = null; }
        this.runtime = null;
        this.name = null;
        this._extends = null;
        this.extended = false;
        this.rootRules = null;
        this.propertyRules = null;
        this.lastTestedValue = null;
        this.runtime = runtime;
        this.name = validatorName;
        if (null === extendsValidator || Utils.isString(extendsValidator)) {
            this._extends = extendsValidator;
        }
        else {
            throw new Error('Invalid argument: extendsValidator: null|string expected!');
        }
    }
    Validator.prototype.addRootCondition = function (operator, value, error) {
        if (error === void 0) { error = null; }
        throw new Error('Validator::addRootCondition (and some more methods) are not ported to javascript version!');
    };
    Validator.prototype.addPropertyCondition = function (propertyName, operator, value, error) {
        if (error === void 0) { error = null; }
        throw new Error('Validator::addPropertyCondition (and some more methods) are not ported to javascript version!');
    };
    Validator.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        throw new Error('Validator::test (and some more methods) are not ported to javascript version');
    };
    return Validator;
}());
var IntegerType = (function (_super) {
    __extends(IntegerType, _super);
    function IntegerType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    IntegerType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        return Utils.isInt(mixed);
    };
    return IntegerType;
}(Type));
var AnyType = (function (_super) {
    __extends(AnyType, _super);
    function AnyType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AnyType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        return undefined !== mixed;
    };
    return AnyType;
}(Type));
var SIntType = (function (_super) {
    __extends(SIntType, _super);
    function SIntType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SIntType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        if (Utils.isString(mixed)) {
            return /^(0|(\-)?[1-9]([0-9]+)?)$/.test(mixed);
        }
        else {
            return false;
        }
    };
    return SIntType;
}(Type));
var DecimalType = (function (_super) {
    __extends(DecimalType, _super);
    function DecimalType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DecimalType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        return Utils.isFloat(mixed);
    };
    return DecimalType;
}(Type));
var SFloatType = (function (_super) {
    __extends(SFloatType, _super);
    function SFloatType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SFloatType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        if (typeof mixed === 'string') {
            return /^(0|(\-)?[1-9]([0-9]+)?)\.[0-9]+$/.test(mixed);
        }
        else {
            return false;
        }
    };
    return SFloatType;
}(Type));
var NumberType = (function (_super) {
    __extends(NumberType, _super);
    function NumberType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    NumberType.prototype.test = function (mixed, errors) {
        return typeof mixed === 'number' && isFinite(mixed);
    };
    return NumberType;
}(Type));
var SNumberType = (function (_super) {
    __extends(SNumberType, _super);
    function SNumberType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SNumberType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        if (typeof mixed === 'string') {
            return /^(0|(\-)?[1-9]([0-9]+)?)(\.[0-9]+)?$/.test(mixed);
        }
        else {
            return false;
        }
    };
    return SNumberType;
}(Type));
var BooleanType = (function (_super) {
    __extends(BooleanType, _super);
    function BooleanType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    BooleanType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        return true === mixed || false === mixed;
    };
    return BooleanType;
}(Type));
var VarcharType = (function (_super) {
    __extends(VarcharType, _super);
    function VarcharType() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    VarcharType.prototype.test = function (mixed, errors) {
        if (errors === void 0) { errors = null; }
        return typeof mixed === 'string';
    };
    return VarcharType;
}(Type));
var SanitizeHTML = (function () {
    function SanitizeHTML() {
    }
    SanitizeHTML.sanitizeHTML = function (htmlText) {
        return sanitizeHtml(htmlText, {
            allowedTags: this.HTML_TAGS,
            allowedAttributes: this.ALLOWED_ATTRIBUTES
        });
    };
    SanitizeHTML.sanitizeHTMLUsingUserRights = function (htmlText) {
        return sanitizeHtml(htmlText, {
            allowedTags: this.HTML_TAGS.concat(this.USER_HTML_TAGS),
            allowedAttributes: this.ALLOWED_ATTRIBUTES
        });
    };
    SanitizeHTML.HTML_TAGS = [
        'a',
        'abbr',
        'acronym',
        'address',
        'area',
        'article',
        'aside',
        'b',
        'bdi',
        'bdo',
        'big',
        'blockquote',
        'br',
        'button',
        'canvas',
        'caption',
        'center',
        'cite',
        'code',
        'col',
        'colgroup',
        'datalist',
        'dd',
        'del',
        'details',
        'dfn',
        'dir',
        'div',
        'dl',
        'dt',
        'em',
        'fieldset',
        'figcaption',
        'font',
        'footer',
        'h1',
        'h2',
        'h3',
        'h4',
        'h5',
        'h6',
        'header',
        'hgroup',
        'hr',
        'i',
        'img',
        'input',
        'ins',
        'kbd',
        'legend',
        'li',
        'nav',
        'ol',
        'p',
        'pre',
        'q',
        'rp',
        'rt',
        's',
        'samp',
        'small',
        'span',
        'strike',
        'strong',
        'sub',
        'summary',
        'sup',
        'table',
        'tbody',
        'td',
        'textarea',
        'tfoot',
        'th',
        'thead',
        'time',
        'tr',
        'tt',
        'u',
        'ul',
        'wbr',
    ];
    SanitizeHTML.ALLOWED_ATTRIBUTES = {
        a: ['href', 'name', 'target', 'rel', 'type'],
        iframe: ['src', 'width', 'height', 'sandbox', 'allow', 'allowfullscreen', 'frameborder'],
        img: ['src', 'width', 'height', 'alt'],
        font: ['font-size'],
        p: ['align'],
        table: ['bgcolor', 'width', 'border', 'align', 'cellpadding', 'summary'],
        td: ['align', 'valign', 'bgcolor', 'char', 'charoff', 'colspan', 'rowspan', 'width', 'height', 'nowrap'],
        tr: ['align', 'valign', 'bgcolor', 'char', 'charoff'],
        ul: ['compact', 'type'],
        '*': ['style', 'id', 'class', 'tabindex', 'title'],
    };
    SanitizeHTML.USER_HTML_TAGS = [];
    return SanitizeHTML;
}());
var GenericUserInterface = (function () {
    function GenericUserInterface(app, jq, notificationsAreaContainer, mainApplicationNode) {
        this.app = app;
        this.jq = jq;
        this.notificationsAreaContainer = notificationsAreaContainer;
        this.mainApplicationNode = mainApplicationNode;
    }
    GenericUserInterface.prototype.alert = function (title, message, doneCallback, settings) {
        var result = this.createDialog(String(title || this.app.getI18n().translateText('myforms_UI_dlg_title_ALERT')), [
            {
                type: EDialogButtonType.OK,
                callback: function (buttonType, result) {
                    if (doneCallback && doneCallback instanceof Function) {
                        doneCallback();
                    }
                    result.close();
                }
            }
        ], {
            width: settings && settings.width
                ? settings.width
                : '500px',
            height: settings && settings.height
                ? settings.height
                : undefined,
        });
        result.body.textContent = String(message || '') || this.app.getI18n().translateText('myforms_UI_dlg_title_ALERT');
        result.body.setAttribute('data-dialog-role', 'system-dialog');
    };
    GenericUserInterface.prototype.prompt = function (title, message, yesCallback, noCallback) {
        var result = this.createDialog(String(title || this.app.getI18n().translateText('myforms_UI_dlg_title_QUESTION')), [
            {
                type: EDialogButtonType.YES,
                callback: function (buttonType, result) {
                    if (yesCallback && yesCallback instanceof Function) {
                        yesCallback();
                    }
                    result.close();
                }
            },
            {
                type: EDialogButtonType.NO,
                callback: function (buttonType, result) {
                    if (noCallback && noCallback instanceof Function) {
                        noCallback();
                        EDialogButtonType.DOWNLOAD;
                    }
                    result.close();
                }
            }
        ], {
            "width": "600px"
        });
        result.body.textContent = String(message || '') || this.app.getI18n().translateText('myforms_UI_dlg_title_QUESTION');
        result.body.setAttribute('data-dialog-role', 'system-dialog');
    };
    GenericUserInterface.getDialogButtonClass = function (buttonType) {
        switch (buttonType) {
            case EDialogButtonType.OK:
            case EDialogButtonType.YES:
            case EDialogButtonType.SAVE:
            case EDialogButtonType.CHANGE:
            case EDialogButtonType.DOWNLOAD:
            case EDialogButtonType.ENABLE_COMPLIANCE:
            case EDialogButtonType.CREATE:
            case EDialogButtonType.DONE:
            case EDialogButtonType.TRY_FORM:
            case EDialogButtonType.UPDATE:
            case EDialogButtonType.UPGRADE_NOW:
            case EDialogButtonType.UPGRADE_NOW_PAYWALL:
            case EDialogButtonType.CONTINUE:
            case EDialogButtonType.KEEP_EDITING_FORM:
            case EDialogButtonType.IMPORT:
            case EDialogButtonType.ADD_DOMAIN:
            case EDialogButtonType.VALIDATE:
            case EDialogButtonType.FORM_MIGRATE:
            case EDialogButtonType.UPGRADE_TO_ENTERPRISE:
                return 'btn-secondary-cta';
            case EDialogButtonType.DELETE:
                return 'btn-secondary-red';
            case EDialogButtonType.DISABLE_COMPLIANCE:
                return 'btn-secondary-red';
            default:
                return 'btn-outline';
        }
    };
    GenericUserInterface.prototype.markNotificationTooltipAsClosed = function (tooltipId) {
        var tooltips = JSON.parse(localStorage.getItem('closed_notification_tooltips') || '{}');
        tooltips[tooltipId] = 1;
        localStorage.setItem('closed_notification_tooltips', JSON.stringify(tooltips));
    };
    GenericUserInterface.prototype.isNotificationTooltipMarkedAsClosed = function (tooltipId) {
        var tooltips = JSON.parse(localStorage.getItem('closed_notification_tooltips') || '{}');
        return !!tooltips[tooltipId];
    };
    GenericUserInterface.prototype.createNotificationTooltip = function (tooltipButtons, settings) {
        return (function (self) {
            var modal = document.createElement('div'), dialog = document.createElement('div'), body = document.createElement('div'), tooltip = document.createElement('div'), buttons = document.createElement('div');
            modal.tabIndex = 0;
            modal.setAttribute('data-ui-tooltip-modal', '1');
            dialog.setAttribute('data-ui-tooltip-dialog', '1');
            dialog.setAttribute('data-placement', GenericUserInterface.getNotificationTooltipPlacementAttribute(settings.placement));
            dialog.setAttribute(GenericUserInterface.getNotificationTooltipStylingAttribute(settings.tooltipType), '1');
            body.setAttribute('data-ui-body', '1');
            buttons.setAttribute('data-ui-buttons', '1');
            if (tooltipButtons.length === 1) {
                buttons.setAttribute('data-single-button-tooltip', '1');
            }
            if (tooltipButtons.length === 2) {
                buttons.setAttribute('data-two-buttons-tooltip', '1');
            }
            modal.appendChild(dialog);
            dialog.appendChild(body);
            body.appendChild(tooltip);
            var isClosed = false;
            var result = {
                close: function () {
                    if (!isClosed) {
                        if (modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                        isClosed = true;
                        if (settings && settings.onCloseCallback) {
                            settings.onCloseCallback(result);
                        }
                    }
                },
                show: function () {
                    dialog.removeAttribute('data-hide-tooltip');
                },
                hide: function () {
                    dialog.setAttribute('data-hide-tooltip', '');
                },
                persistentClose: function () {
                    if (!isClosed) {
                        if (modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                        isClosed = true;
                        if (window['CFTracker']) {
                            window['CFTracker'].event('tooltip_dismissed_' + settings.tooltipId);
                        }
                        if (settings && settings.tooltipId) {
                            self.markNotificationTooltipAsClosed(settings.tooltipId);
                        }
                        if (settings && settings.onCloseCallback) {
                            settings.onCloseCallback(result);
                        }
                    }
                },
                tooltip: tooltip,
                body: body,
                tooltipId: settings.tooltipId || null,
            };
            for (var i = 0, len = tooltipButtons.length; i < len; i++) {
                (function (tooltipButton) {
                    var button = document.createElement('button');
                    button.innerHTML = tooltipButton.html
                        ||
                            ((tooltipButton.i18nKey
                                && this.app.getI18n().translateText(tooltipButton.i18nKey) !== tooltipButton.i18nKey)
                                ? this.app.getI18n().translateText(tooltipButton.i18nKey)
                                : tooltipButton.text);
                    button.setAttribute(GenericUserInterface.getNotificationTooltipStylingAttribute(settings.tooltipType), '1');
                    button.onclick = function () {
                        tooltipButton.callback(result);
                    };
                    buttons.appendChild(button);
                })(tooltipButtons[i]);
            }
            dialog.appendChild(buttons);
            if (settings) {
                if (settings.width) {
                    dialog.style.width = settings.width;
                }
                if (settings.height) {
                    dialog.style.height = settings.height;
                }
            }
            if (settings && settings.tooltipId && self.isNotificationTooltipMarkedAsClosed(settings.tooltipId)) {
                setTimeout(function () {
                    result.close();
                }, 500);
            }
            else {
                document.body.appendChild(modal);
            }
            modal.focus();
            return result;
        })(this);
    };
    GenericUserInterface.getNotificationTooltipStylingAttribute = function (buttonType) {
        switch (buttonType) {
            case ENotificationTooltipType.WARNING:
                return 'data-styling-warning';
            case ENotificationTooltipType.ERROR:
                return 'data-styling-error';
            case ENotificationTooltipType.DEFAULT:
            default:
                return 'data-styling-regular';
        }
    };
    GenericUserInterface.getNotificationTooltipPlacementAttribute = function (notificationTooltipPlacement) {
        switch (notificationTooltipPlacement) {
            case ENotificationTooltipPlacement.TOP_LEFT:
                return 'top-left';
            case ENotificationTooltipPlacement.TOP_CENTER:
                return 'top-center';
            case ENotificationTooltipPlacement.TOP_RIGHT:
                return 'top-right';
            case ENotificationTooltipPlacement.LEFT:
                return 'left';
            case ENotificationTooltipPlacement.CENTER:
                return 'center';
            case ENotificationTooltipPlacement.RIGHT:
                return 'right';
            case ENotificationTooltipPlacement.BOTTOM_LEFT:
                return 'bottom-left';
            case ENotificationTooltipPlacement.BOTTOM_CENTER:
                return 'bottom-center';
            case ENotificationTooltipPlacement.BOTTOM_RIGHT:
            default:
                return 'bottom-right';
        }
    };
    GenericUserInterface.prototype.createDialog = function (dialogTitle, dialogButtons, settings) {
        return (function (self, $) {
            var modal = document.createElement('div'), dialog = document.createElement('div'), titlebar = document.createElement('div'), titlebody = document.createElement('div'), closeButton = document.createElement('div'), body = document.createElement('div'), buttons = document.createElement('div');
            modal.tabIndex = 0;
            modal.className = 'ui-modal';
            dialog.className = 'ui-dialog';
            titlebar.className = 'ui-titlebar';
            titlebar.textContent = dialogTitle;
            titlebody.className = 'ui-titlebody';
            body.className = 'ui-body';
            buttons.className = 'ui-buttons bootstrap-iso';
            closeButton.className = 'ui-close i123-close';
            modal.appendChild(dialog);
            titlebar.appendChild(titlebody);
            titlebar.appendChild(closeButton);
            dialog.appendChild(titlebar);
            dialog.appendChild(body);
            var isClosed = false;
            function triggerDefaultButton() {
                var button;
                $(buttons).find('> button').each(function () {
                    var role = parseInt($(this).attr('data-role').replace(/^button-type-/, ''));
                    switch (role) {
                        case EDialogButtonType.OK:
                        case EDialogButtonType.YES:
                        case EDialogButtonType.SAVE:
                        case EDialogButtonType.FORM_MIGRATE:
                            if (!button) {
                                button = this;
                            }
                            break;
                    }
                });
                if (button) {
                    $(button).click();
                }
            }
            function upgradeBodyFormsHTML(ev) {
                ev.preventDefault();
                ev.stopPropagation();
                triggerDefaultButton();
            }
            var result = {
                "close": function () {
                    if (!isClosed) {
                        $(body).find('form').off('submit', upgradeBodyFormsHTML);
                        modal.parentNode.removeChild(modal);
                        isClosed = true;
                    }
                },
                "body": body,
                "titlebody": titlebody,
                "dialog": dialog,
                "setHTML": function (str) {
                    body.innerHTML = str;
                    $(body).find('form').on('submit', upgradeBodyFormsHTML);
                },
                "clearInlineErrors": function () {
                    $(body).find('label.error').text('');
                },
                "hide": function () {
                    $(modal).addClass('hidden');
                },
                "show": function () {
                    $(modal).removeClass('hidden');
                },
                "isClosed": function () {
                    return isClosed;
                }
            };
            closeButton.onclick = function () {
                if (settings && settings.onCloseButtonClick) {
                    try {
                        settings.onCloseButtonClick();
                    }
                    catch (e) { }
                }
                result.close();
            };
            modal.addEventListener('keyup', function (ev) {
                var code = ev.keyCode || ev.charCode;
                if (code == 27) {
                    result.close();
                    if (settings && settings.onCloseButtonClick) {
                        settings.onCloseButtonClick();
                    }
                }
            }, false);
            for (var i = 0, len = dialogButtons.length; i < len; i++) {
                (function (button) {
                    var btn = document.createElement('button');
                    btn.textContent = self.getDialogButtonLabel(button.type);
                    buttons.appendChild(btn);
                    btn.setAttribute('data-role', 'button-type-' + button.type);
                    btn.className = 'btn ' + GenericUserInterface.getDialogButtonClass(button.type);
                    btn.onclick = function () {
                        button.callback(button.type, result);
                    };
                })(dialogButtons[i]);
            }
            dialog.appendChild(buttons);
            if (settings) {
                if (settings.width) {
                    dialog.style.width = settings.width;
                }
                if (settings.height) {
                    dialog.style.height = settings.height;
                }
            }
            document.body.appendChild(modal);
            modal.focus();
            modal.addEventListener('keydown', function (e) {
                var target = (e.target || e.srcElement);
                if (target && ['input', 'select', 'textarea'].indexOf(target.nodeName.toLowerCase()) === -1) {
                    if (!target.hasAttribute('data-allow-keyboard')) {
                        e.stopPropagation();
                    }
                }
            }, true);
            modal.addEventListener('keypress', function (e) {
                var target = (e.target || e.srcElement);
                if (target && ['input', 'select', 'textarea'].indexOf(target.nodeName.toLowerCase()) === -1) {
                    e.stopPropagation();
                }
            }, true);
            modal.addEventListener('keyup', function (e) {
                var target = (e.target || e.srcElement);
                if (target && ['input', 'select', 'textarea'].indexOf(target.nodeName.toLowerCase()) === -1) {
                    e.stopPropagation();
                }
            }, true);
            return result;
        })(this, this.jq);
    };
    GenericUserInterface.prototype.getDialogButtonLabel = function (buttonType) {
        switch (buttonType) {
            case EDialogButtonType.OK:
                return this.app.getI18n().translateText('myforms_UI_btn_OK');
            case EDialogButtonType.YES:
                return this.app.getI18n().translateText('myforms_UI_btn_YES');
            case EDialogButtonType.ABORT:
                return this.app.getI18n().translateText('myforms_UI_btn_ABORT');
            case EDialogButtonType.RETRY:
                return this.app.getI18n().translateText('myforms_UI_btn_RETRY');
            case EDialogButtonType.CANCEL:
                return this.app.getI18n().translateText('myforms_UI_btn_CANCEL');
            case EDialogButtonType.IGNORE:
                return this.app.getI18n().translateText('myforms_UI_btn_IGNORE');
            case EDialogButtonType.NO:
                return this.app.getI18n().translateText('myforms_UI_btn_NO');
            case EDialogButtonType.SAVE:
                return this.app.getI18n().translateText('myforms_UI_btn_SAVE');
            case EDialogButtonType.CHANGE:
                return this.app.getI18n().translateText('myforms_UI_btn_CHANGE');
            case EDialogButtonType.DELETE:
                return this.app.getI18n().translateText('myforms_UI_btn_DELETE');
            case EDialogButtonType.DOWNLOAD:
                return this.app.getI18n().translateText('myforms_UI_btn_DOWNLOAD');
            case EDialogButtonType.CLOSE:
                return this.app.getI18n().translateText('myforms_UI_btn_CLOSE');
            case EDialogButtonType.ENABLE_COMPLIANCE:
                return this.app.getI18n().translateText('myformsHipaaChangeStatusTitle0');
            case EDialogButtonType.DISABLE_COMPLIANCE:
                return this.app.getI18n().translateText('myformsHipaaChangeStatusTitle1');
            case EDialogButtonType.CREATE:
                return this.app.getI18n().translateText('applications_UI_btn_CREATE');
            case EDialogButtonType.DONE:
                return this.app.getI18n().translateText('applications_UI_btn_DONE');
            case EDialogButtonType.TRY_FORM:
                return this.app.getI18n().translateText('oldEditor_TryFormBtn');
            case EDialogButtonType.NO_THANKS:
                return this.app.getI18n().translateText('editForm_noThanksButton');
            case EDialogButtonType.UPDATE:
                return this.app.getI18n().translateText('Update');
            case EDialogButtonType.MAYBE_LATER:
                return this.app.getI18n().translateText('wix_popupMaybeLater');
            case EDialogButtonType.UPGRADE_NOW:
                return this.app.getI18n().translateText('LinkUpdateNowTitle');
            case EDialogButtonType.UPGRADE_NOW_PAYWALL:
                return this.app.getI18n().translateText('paywall_upgrade_button_1');
            case EDialogButtonType.CONTINUE:
                return this.app.getI18n().translateText('userServeyPopup_continue');
            case EDialogButtonType.KEEP_EDITING_FORM:
                return this.app.getI18n().translateText('edt_UI_btn_keep_editing_form');
            case EDialogButtonType.CLOSE_EDITOR:
                return this.app.getI18n().translateText('edt_UI_btn_close_editor');
            case EDialogButtonType.IMPORT:
                return this.app.getI18n().translateText('edt_UI_btn_import');
            case EDialogButtonType.ADD_DOMAIN:
                return this.app.getI18n().translateText('js_iep_domainalias05');
            case EDialogButtonType.VALIDATE:
                return this.app.getI18n().translateText('edt_UI_btn_validate_smtp');
            case EDialogButtonType.FORM_MIGRATE:
                return 'Migrate';
            case EDialogButtonType.UPGRADE_TO_ENTERPRISE:
                return this.app.getI18n().translateText('paywall_upgrade_button_2');
            default:
                throw new Error('Invalid button type: ' + JSON.stringify(buttonType) + '. Please use one of EDialogButtonType types');
        }
    };
    GenericUserInterface.escapeHTML = function (str) {
        GenericUserInterface.HTMLEscaper.textContent = str;
        var result = GenericUserInterface.HTMLEscaper.innerHTML;
        GenericUserInterface.HTMLEscaper.textContent = '';
        return result;
    };
    GenericUserInterface.prototype.getCurrentNotification = function () {
        return this.notificationsAreaContainer.firstElementChild;
    };
    GenericUserInterface.prototype.createNotification = function (notificationText, escapeText, notificationStyle, allowCloseNotificationButton) {
        if (escapeText === void 0) { escapeText = true; }
        if (notificationStyle === void 0) { notificationStyle = ENotificationStyle.DEFAULT; }
        var d = document.createElement('div');
        d.className = 'notification';
        d.innerHTML = escapeText ? GenericUserInterface.escapeHTML(notificationText) : notificationText;
        if (allowCloseNotificationButton || undefined === allowCloseNotificationButton) {
            var closeButton = document.createElement('div');
            closeButton.className = 'close';
            d.appendChild(closeButton);
        }
        this.notificationsAreaContainer.innerHTML = '';
        switch (notificationStyle) {
            case ENotificationStyle.DEFAULT:
                break;
            case ENotificationStyle.ERROR:
                this.jq(d).prepend('<span class="i123-warning"></span>');
                this.jq(d).addClass('ERROR');
                break;
            case ENotificationStyle.SUCCESS:
                this.jq(d).prepend('<span class="i123-check"></span>');
                this.jq(d).addClass('SUCCESS');
                break;
        }
        this.notificationsAreaContainer.appendChild(d);
        this.jq(this.mainApplicationNode).addClass('with-notification');
        return d;
    };
    GenericUserInterface.prototype.createResponsiveNotification = function (notificationText, escapeText, notificationStyle, allowCloseNotificationButton) {
        if (escapeText === void 0) { escapeText = true; }
        if (notificationStyle === void 0) { notificationStyle = ENotificationStyle.DEFAULT; }
        var d = document.createElement('div');
        var contentOfNotification = escapeText ? GenericUserInterface.escapeHTML(notificationText) : notificationText;
        d.className = 'notification';
        d.innerHTML = '<span class="notification-content">' + contentOfNotification + '</span>';
        if (allowCloseNotificationButton || undefined === allowCloseNotificationButton) {
            var closeButton = document.createElement('div');
            closeButton.className = 'close';
            d.appendChild(closeButton);
        }
        this.notificationsAreaContainer.innerHTML = '';
        switch (notificationStyle) {
            case ENotificationStyle.DEFAULT:
                break;
            case ENotificationStyle.ERROR:
                this.jq(d).prepend('<span class="i123-warning"></span>');
                this.jq(d).addClass('ERROR');
                break;
            case ENotificationStyle.SUCCESS:
                this.jq(d).prepend('<span class="i123-check"></span>');
                this.jq(d).addClass('SUCCESS');
                break;
        }
        this.notificationsAreaContainer.appendChild(d);
        this.jq(this.mainApplicationNode).addClass('with-notification');
        return d;
    };
    GenericUserInterface.prototype.closeAllNotifications = function () {
        this.jq(this.mainApplicationNode).removeClass('with-notification');
        this.notificationsAreaContainer.innerHTML = '';
    };
    GenericUserInterface.prototype.getRootNode = function () {
        return this.mainApplicationNode;
    };
    GenericUserInterface.HTMLEscaper = document.createElement('div');
    return GenericUserInterface;
}());
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
var I18nService = (function () {
    function I18nService() {
        this.translations = {};
        this.intlWarnings = {};
        this.htmlDOMNode = document.createElement('span');
    }
    I18nService.prototype.escapeHTML = function (str) {
        this.htmlDOMNode.textContent = String(str || '');
        var result = this.htmlDOMNode.innerHTML;
        this.htmlDOMNode.textContent = '';
        return result;
    };
    I18nService.prototype.translateText = function (str) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        if (str) {
            var result = typeof this.translations[str = String(str) || ''] !== 'undefined'
                ? this.translations[str]
                : (function (self) {
                    if (typeof self.intlWarnings[str] == 'undefined') {
                        console.warn('I18n: key ' + JSON.stringify(str) + ' is not defined!');
                        self.intlWarnings[str] = true;
                    }
                    return str;
                })(this);
            return result.replace(/\$([\s]+)?\{([\d]+)\}/g, function () {
                var matches = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    matches[_i] = arguments[_i];
                }
                var matchNo = ~~matches[2];
                return String(args[matchNo] || '${' + matchNo + '}');
            });
        }
        else {
            return str;
        }
    };
    I18nService.prototype.translateHTMLText = function (htmlString, withReplaceComments) {
        if (withReplaceComments === void 0) { withReplaceComments = true; }
        var additionalTranslateArguments = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            additionalTranslateArguments[_i - 2] = arguments[_i];
        }
        var result = String(htmlString || '');
        var translatedString = (function (self) {
            return result.replace(/\[\[([a-zA-Z0-9_\$\-]+)(\!)?\]\]/g, function () {
                var matches = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    matches[_i] = arguments[_i];
                }
                return matches[2] ? self.translateText(matches[1]) : self.escapeHTML(self.translateText(matches[1]));
            });
        })(this);
        if (withReplaceComments) {
            translatedString = translatedString.replace(/<!--[^\-]+-->/g, '');
        }
        for (var x = 0, y = additionalTranslateArguments.length; x < y; x++) {
            translatedString = translatedString.replace('%s', additionalTranslateArguments[x]);
        }
        return translatedString;
    };
    I18nService.prototype.setTranslations = function (translations) {
        this.translations = translations || {};
    };
    I18nService.prototype.translateDOMNode = function (domNode) {
        (function ($, self) {
            $(domNode).find('[data-i18n-text]').each(function () {
                var translationText = self.translateText(this.getAttribute('data-i18n-text'));
                if (translationText) {
                    this.textContent = translationText;
                }
            });
            $(domNode).find('[data-i18n-placeholder]').each(function () {
                var attribute = this.getAttribute('data-i18n-placeholder'), translationText = self.translateText(attribute);
                if (translationText && translationText !== attribute) {
                    this.placeholder = translationText;
                }
            });
        })(window['jQuery'], this);
    };
    I18nService.prototype.translateTextDefault = function (i18nKey, defaultText) {
        var i18nVars = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            i18nVars[_i - 2] = arguments[_i];
        }
        var textToTranslate = this.translateText.apply(this, __spreadArrays([i18nKey], i18nVars));
        return i18nKey && textToTranslate && textToTranslate !== i18nKey
            ? textToTranslate
            : defaultText;
    };
    return I18nService;
}());
var GeolocationService = (function () {
    function GeolocationService(i18nService, userCountryCode) {
        this.i18nService = i18nService;
        this.userCountryCode = userCountryCode;
    }
    GeolocationService.prototype.getLanguagesList = function () {
        if (undefined === this.languageCache) {
            this.languageCache = [];
            var seenLanguages = [];
            for (var countryCode in GeolocationService.ALL) {
                if (GeolocationService.ALL.hasOwnProperty(countryCode) && GeolocationService.ALL.propertyIsEnumerable(countryCode)) {
                    for (var i = 0, len = GeolocationService.ALL[countryCode].languages.length; i < len; i++) {
                        if (-1 === seenLanguages.indexOf(GeolocationService.ALL[countryCode].languages[i].code)) {
                            if (null !== GeolocationService.ALL[countryCode].languages[i].code) {
                                this.languageCache.push(GeolocationService.ALL[countryCode].languages[i]);
                            }
                            seenLanguages.push(GeolocationService.ALL[countryCode].languages[i].code);
                        }
                    }
                }
            }
            this.languageCache.sort(function (a, b) {
                var aLower = a.name.toLowerCase(), bLower = b.name.toLowerCase();
                if (aLower === bLower) {
                    return 0;
                }
                else {
                    return aLower < bLower
                        ? -1
                        : 1;
                }
            });
        }
        return this.languageCache;
    };
    GeolocationService.prototype.getCountriesList = function () {
        if (undefined === this.countryCache) {
            this.countryCache = [];
            for (var k in GeolocationService.ALL) {
                if (GeolocationService.ALL.hasOwnProperty(k) && GeolocationService.ALL.propertyIsEnumerable(k)) {
                    this.countryCache.push(GeolocationService.ALL[k]);
                }
            }
        }
        return this.countryCache;
    };
    GeolocationService.prototype.getCountryByISOCode = function (countryISOCode) {
        return GeolocationService.ALL[String(countryISOCode || '').toUpperCase()] || null;
    };
    GeolocationService.prototype.getCountryIdByISOCode = function (countryISOCode) {
        countryISOCode = String(countryISOCode || '').toUpperCase();
        if (undefined !== GeolocationService.ALL[countryISOCode]) {
            return GeolocationService.ALL[countryISOCode].id;
        }
        else {
            return null;
        }
    };
    GeolocationService.prototype.getCountryNameByISOCode = function (countryISOCode) {
        countryISOCode = String(countryISOCode || '').toUpperCase();
        if (undefined !== GeolocationService.ALL[countryISOCode]) {
            return GeolocationService.ALL[countryISOCode].name;
        }
        else {
            return null;
        }
    };
    GeolocationService.prototype.getCountryI18nNameByISOCode = function (countryISOCode) {
        countryISOCode = String(countryISOCode || '').toUpperCase();
        if (undefined !== GeolocationService.ALL[countryISOCode]) {
            return GeolocationService.ALL[countryISOCode].i18n;
        }
        else {
            return null;
        }
    };
    GeolocationService.prototype.getCountryISOCodeByCountryName = function (countryName) {
        countryName = String(countryName || '').toLowerCase();
        for (var k in GeolocationService.ALL) {
            if (GeolocationService.ALL.hasOwnProperty(k) && GeolocationService.ALL.propertyIsEnumerable(k)) {
                if (GeolocationService.ALL[k].name.toLowerCase() === countryName || GeolocationService.ALL[k].nativeName.toLowerCase() === countryName) {
                    return k;
                }
            }
        }
        return null;
    };
    GeolocationService.prototype.getCorrectedCountryName = function (countryName) {
        if (countryName === 'Republic of the Congo') {
            return 'Congo (Republic)';
        }
        if (countryName === 'Democratic Republic of the Congo') {
            return 'Congo (Democratic Republic)';
        }
        return countryName;
    };
    GeolocationService.prototype.getCountryCodeRegExp = function () {
        if (undefined !== this.countryCodeRegexp) {
            return this.countryCodeRegexp;
        }
        var allCountryCodes = [];
        for (var countryISOCode in GeolocationService.ALL) {
            if (GeolocationService.ALL.propertyIsEnumerable(countryISOCode) && GeolocationService.ALL.hasOwnProperty(countryISOCode) && GeolocationService.ALL[countryISOCode].callingCodes) {
                for (var i = 0, len = GeolocationService.ALL[countryISOCode].callingCodes.length; i < len; i++) {
                    if (GeolocationService.ALL[countryISOCode].callingCodes[i]) {
                        var isUnique = true;
                        for (var j = 0, n = allCountryCodes.length; j < n; j++) {
                            if (allCountryCodes[j] === GeolocationService.ALL[countryISOCode].callingCodes[i]) {
                                isUnique = false;
                                break;
                            }
                        }
                        if (isUnique) {
                            allCountryCodes.push(GeolocationService.ALL[countryISOCode].callingCodes[i]);
                        }
                    }
                }
            }
        }
        allCountryCodes.sort(function (codeA, codeB) {
            var codeALength, codeBLength;
            if ((codeALength = codeA.length) === (codeBLength = codeB.length)) {
                if (codeA === codeB) {
                    return 0;
                }
                else {
                    return codeB > codeA
                        ? 1
                        : -1;
                }
            }
            else {
                return codeBLength - codeALength;
            }
        });
        this.countryCodeRegexp = new RegExp('^(\\+|00)(' + allCountryCodes.join('|') + ')');
        return this.countryCodeRegexp;
    };
    GeolocationService.prototype.getCountryCodesByCallingArea = function (callingArea) {
        var result = [];
        callingArea = String(callingArea || '').replace(/^(\+|00)/g, '');
        for (var countryISOCode in GeolocationService.ALL) {
            if (GeolocationService.ALL.propertyIsEnumerable(countryISOCode) && GeolocationService.ALL.hasOwnProperty(countryISOCode) && GeolocationService.ALL[countryISOCode].callingCodes) {
                for (var j = 0, n = GeolocationService.ALL[countryISOCode].callingCodes.length; j < n; j++) {
                    if (GeolocationService.ALL[countryISOCode].callingCodes[j] === callingArea) {
                        result.push(countryISOCode);
                        break;
                    }
                }
            }
        }
        return result.length
            ? result
            : null;
    };
    GeolocationService.prototype.getUserCountryCode = function () {
        return this.userCountryCode;
    };
    GeolocationService.ALL = {
        AF: {
            name: "Afghanistan",
            i18n: 'country_afg',
            nativeName: "افغانستان",
            callingCodes: [
                "93"
            ],
            timeZones: [
                "UTC+04:30"
            ],
            id: 1,
            index: 0,
            code: "AF",
            languages: [
                { code: "ps", name: "Pashto", nativeName: "پښتو" },
                { code: "uz", name: "Uzbek", nativeName: "Oʻzbek" },
                { code: "tk", name: "Turkmen", nativeName: "Türkmen" }
            ]
        },
        AX: {
            name: "Aland Islands",
            i18n: 'country_ax',
            nativeName: "Åland",
            callingCodes: [
                "358"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 2,
            index: 1,
            code: "AX",
            languages: [
                { code: "sv", name: "Swedish", nativeName: "Svenska" }
            ]
        },
        AL: {
            name: "Albania",
            i18n: 'country_alb',
            nativeName: "Shqipëria",
            callingCodes: [
                "355"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 3,
            index: 2,
            code: "AL",
            languages: [
                { code: "sq", name: "Albanian", nativeName: "Shqip" }
            ]
        },
        DZ: {
            name: "Algeria",
            i18n: 'country_alg',
            nativeName: "الجزائر",
            callingCodes: [
                "213"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 4,
            index: 3,
            code: "DZ",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ]
        },
        AS: {
            name: "American Samoa",
            i18n: 'country_as',
            nativeName: "American Samoa",
            callingCodes: [
                "1684"
            ],
            timeZones: [
                "UTC-11:00"
            ],
            id: 5,
            index: 4,
            code: "AS",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "sm", name: "Samoan", nativeName: "gagana fa'a Samoa" }
            ]
        },
        AD: {
            name: "Andorra",
            i18n: 'country_and',
            nativeName: "Andorra",
            callingCodes: [
                "376"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 6,
            index: 5,
            code: "AD",
            languages: [
                { code: "ca", name: "Catalan", nativeName: "català" }
            ]
        },
        AO: {
            name: "Angola",
            i18n: 'country_ang',
            nativeName: "Angola",
            callingCodes: [
                "244"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 7,
            index: 6,
            code: "AO",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        AI: {
            name: "Anguilla",
            i18n: 'country_ai',
            nativeName: "Anguilla",
            callingCodes: [
                "1264"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 8,
            index: 7,
            code: "AI",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        AQ: {
            name: "Antarctica",
            i18n: 'country_aq',
            nativeName: "Antarctica",
            callingCodes: null,
            timeZones: [
                "UTC-03:00",
                "UTC+03:00",
                "UTC+05:00",
                "UTC+06:00",
                "UTC+07:00",
                "UTC+08:00",
                "UTC+10:00",
                "UTC+12:00"
            ],
            id: 9,
            index: 8,
            code: "AQ",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        AG: {
            name: "Antigua and Barbuda",
            i18n: 'country_ant',
            nativeName: "Antigua and Barbuda",
            callingCodes: [
                "1268"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 10,
            index: 9,
            code: "AG",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        AR: {
            name: "Argentina",
            i18n: 'country_arg',
            nativeName: "Argentina",
            callingCodes: [
                "54"
            ],
            timeZones: [
                "UTC-03:00"
            ],
            id: 11,
            index: 10,
            code: "AR",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" },
                { code: "gn", name: "Guaraní", nativeName: "Avañe'ẽ" }
            ],
        },
        AM: {
            name: "Armenia",
            i18n: 'country_arm',
            nativeName: "Հայաստան",
            callingCodes: [
                "374"
            ],
            timeZones: [
                "UTC+04:00"
            ],
            id: 12,
            index: 11,
            code: "AM",
            languages: [
                { code: "hy", name: "Armenian", nativeName: "Հայերեն" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        AW: {
            name: "Aruba",
            i18n: 'country_aru',
            nativeName: "Aruba",
            callingCodes: [
                "297"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 13,
            index: 12,
            code: "AW",
            languages: [
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" },
                { code: "pa", name: "Punjabi (Eastern)", nativeName: "ਪੰਜਾਬੀ" }
            ],
        },
        AU: {
            name: "Australia",
            i18n: 'country_austra',
            nativeName: "Australia",
            callingCodes: [
                "61"
            ],
            timeZones: [
                "UTC+05:00",
                "UTC+06:30",
                "UTC+07:00",
                "UTC+08:00",
                "UTC+09:30",
                "UTC+10:00",
                "UTC+10:30",
                "UTC+11:30"
            ],
            id: 14,
            index: 13,
            code: "AU",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
            regions: [
                "Australian Capital Territory",
                "New South Wales",
                "Northern Territory",
                "Queensland",
                "South Australia",
                "Tasmania",
                "Victoria",
                "Western Australia"
            ],
        },
        AT: {
            name: "Austria",
            i18n: 'country_austri',
            nativeName: "Österreich",
            callingCodes: [
                "43"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 15,
            index: 14,
            code: "AT",
            languages: [
                { code: "de", name: "German", nativeName: "Deutsch" }
            ],
        },
        AZ: {
            name: "Azerbaijan",
            i18n: 'country_aze',
            nativeName: "Azərbaycan",
            callingCodes: [
                "994"
            ],
            timeZones: [
                "UTC+04:00"
            ],
            id: 16,
            index: 15,
            code: "AZ",
            languages: [
                { code: "az", name: "Azerbaijani", nativeName: "azərbaycan dili" }
            ],
        },
        BS: {
            name: "Bahamas",
            i18n: 'country_baha',
            nativeName: "Bahamas",
            callingCodes: [
                "1242"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 17,
            index: 16,
            code: "BS",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        BH: {
            name: "Bahrain",
            i18n: 'country_bahr',
            nativeName: "‏البحرين",
            callingCodes: [
                "973"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 18,
            index: 17,
            code: "BH",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        BD: {
            name: "Bangladesh",
            i18n: 'country_ban',
            nativeName: "Bangladesh",
            callingCodes: [
                "880"
            ],
            timeZones: [
                "UTC+06:00"
            ],
            id: 19,
            index: 18,
            code: "BD",
            languages: [
                { code: "bn", name: "Bengali", nativeName: "বাংলা" }
            ],
        },
        BB: {
            name: "Barbados",
            i18n: 'country_bar',
            nativeName: "Barbados",
            callingCodes: [
                "1246"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 20,
            index: 19,
            code: "BB",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        BY: {
            name: "Belarus",
            i18n: 'country_bela',
            nativeName: "Белару́сь",
            callingCodes: [
                "375"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 21,
            index: 20,
            code: "BY",
            languages: [
                { code: "be", name: "Belarusian", nativeName: "беларуская мова" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        BE: {
            name: "Belgium",
            i18n: 'country_belg',
            nativeName: "België",
            callingCodes: [
                "32"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 22,
            index: 21,
            code: "BE",
            languages: [
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" },
                { code: "fr", name: "French", nativeName: "français" },
                { code: "de", name: "German", nativeName: "Deutsch" }
            ],
        },
        BZ: {
            name: "Belize",
            i18n: 'country_beli',
            nativeName: "Belize",
            callingCodes: [
                "501"
            ],
            timeZones: [
                "UTC-06:00"
            ],
            id: 23,
            index: 22,
            code: "BZ",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        BJ: {
            name: "Benin",
            i18n: 'country_ben',
            nativeName: "Bénin",
            callingCodes: [
                "229"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 24,
            index: 23,
            code: "BJ",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        BM: {
            name: "Bermuda",
            i18n: 'country_ber',
            nativeName: "Bermuda",
            callingCodes: [
                "1441"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 25,
            index: 24,
            code: "BM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        BT: {
            name: "Bhutan",
            i18n: 'country_bhu',
            nativeName: "ʼbrug-yul",
            callingCodes: [
                "975"
            ],
            timeZones: [
                "UTC+06:00"
            ],
            id: 26,
            index: 25,
            code: "BT",
            languages: [
                { code: "dz", name: "Dzongkha", nativeName: "རྫོང་ཁ" }
            ],
        },
        BO: {
            name: "Bolivia",
            i18n: 'country_bol',
            nativeName: "Bolivia",
            callingCodes: [
                "591"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 27,
            index: 26,
            code: "BO",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" },
                { code: "ay", name: "Aymara", nativeName: "aymar aru" },
                { code: "qu", name: "Quechua", nativeName: "Runa Simi" }
            ],
        },
        BQ: {
            name: "Bonaire, Sint Eustatius and Saba",
            i18n: 'country_bq',
            nativeName: "Bonaire",
            callingCodes: [
                "5997"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 28,
            index: 27,
            code: "BQ",
            languages: [
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" }
            ],
        },
        BA: {
            name: "Bosnia and Herzegowina",
            i18n: 'country_bos',
            nativeName: "Bosna i Hercegovina",
            callingCodes: [
                "387"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 29,
            index: 28,
            code: "BA",
            languages: [
                { code: "bs", name: "Bosnian", nativeName: "bosanski jezik" },
                { code: "hr", name: "Croatian", nativeName: "hrvatski jezik" },
                { code: "sr", name: "Serbian", nativeName: "српски језик" }
            ],
        },
        BW: {
            name: "Botswana",
            i18n: 'country_bot',
            nativeName: "Botswana",
            callingCodes: [
                "267"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 30,
            index: 29,
            code: "BW",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "tn", name: "Tswana", nativeName: "Setswana" }
            ],
        },
        BV: {
            name: "Bouvet Island",
            i18n: 'country_bv',
            nativeName: "Bouvetøya",
            callingCodes: [
                ""
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 31,
            index: 30,
            code: "BV",
            languages: [
                { code: "no", name: "Norwegian", nativeName: "Norsk" },
                { code: "nb", name: "Norwegian Bokmål", nativeName: "Norsk bokmål" },
                { code: "nn", name: "Norwegian Nynorsk", nativeName: "Norsk nynorsk" }
            ],
        },
        BR: {
            name: "Brazil",
            i18n: 'country_bra',
            nativeName: "Brasil",
            callingCodes: [
                "55"
            ],
            timeZones: [
                "UTC-05:00",
                "UTC-04:00",
                "UTC-03:00",
                "UTC-02:00"
            ],
            id: 32,
            index: 31,
            code: "BR",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        IO: {
            name: "British Indian Ocean Territory",
            i18n: 'country_io',
            nativeName: "British Indian Ocean Territory",
            callingCodes: [
                "246"
            ],
            timeZones: [
                "UTC+06:00"
            ],
            id: 33,
            index: 32,
            code: "IO",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        UM: {
            name: "United States Minor Outlying Islands",
            i18n: 'country_um',
            nativeName: "United States Minor Outlying Islands",
            callingCodes: [
                ""
            ],
            timeZones: [
                "UTC-11:00",
                "UTC-10:00",
                "UTC+12:00"
            ],
            id: 237,
            index: 33,
            code: "UM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        VG: {
            name: "Virgin Islands (British)",
            i18n: 'country_bvi',
            nativeName: "British Virgin Islands",
            callingCodes: [
                "1284"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 243,
            index: 34,
            code: "VG",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        VI: {
            name: "Virgin Islands (U.S.)",
            i18n: 'country_vi',
            nativeName: "Virgin Islands of the United States",
            callingCodes: [
                "1340"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 244,
            index: 35,
            code: "VI",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        BN: {
            name: "Brunei Darussalam",
            i18n: 'country_bru',
            nativeName: "Negara Brunei Darussalam",
            callingCodes: [
                "673"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 34,
            index: 36,
            code: "BN",
            languages: [
                { code: "ms", name: "Malay", nativeName: "bahasa Melayu" }
            ],
        },
        BG: {
            name: "Bulgaria",
            i18n: 'country_bul',
            nativeName: "България",
            callingCodes: [
                "359"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 35,
            index: 37,
            code: "BG",
            languages: [
                { code: "bg", name: "Bulgarian", nativeName: "български език" }
            ],
        },
        BF: {
            name: "Burkina Faso",
            i18n: 'country_burk',
            nativeName: "Burkina Faso",
            callingCodes: [
                "226"
            ],
            timeZones: [
                "UTC"
            ],
            id: 36,
            index: 38,
            code: "BF",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "ff", name: "Fula", nativeName: "Fulfulde" }
            ],
        },
        BI: {
            name: "Burundi",
            i18n: 'country_buru',
            nativeName: "Burundi",
            callingCodes: [
                "257"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 37,
            index: 39,
            code: "BI",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "rn", name: "Kirundi", nativeName: "Ikirundi" }
            ],
        },
        KH: {
            name: "Cambodia",
            i18n: 'country_camb',
            nativeName: "Kâmpŭchéa",
            callingCodes: [
                "855"
            ],
            timeZones: [
                "UTC+07:00"
            ],
            id: 38,
            index: 40,
            code: "KH",
            languages: [
                { code: "km", name: "Khmer", nativeName: "ខ្មែរ" }
            ],
        },
        CM: {
            name: "Cameroon",
            i18n: 'country_came',
            nativeName: "Cameroon",
            callingCodes: [
                "237"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 39,
            index: 41,
            code: "CM",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        CA: {
            name: "Canada",
            i18n: 'country_can',
            nativeName: "Canada",
            callingCodes: [
                "1"
            ],
            timeZones: [
                "UTC-08:00",
                "UTC-07:00",
                "UTC-06:00",
                "UTC-05:00",
                "UTC-04:00",
                "UTC-03:30"
            ],
            id: 40,
            index: 42,
            code: "CA",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
            regions: [
                "Alberta",
                "British Columbia",
                "Manitoba",
                "New Brunswick",
                "Newfoundland and Labrador",
                "Northwest Territories",
                "Nova Scotia",
                "Nunavut",
                "Ontario",
                "Prince Edward Island",
                "Quebec",
                "Saskatchewan",
                "Yukon"
            ],
        },
        CV: {
            name: "Cabo Verde",
            i18n: 'country_cap',
            nativeName: "Cabo Verde",
            callingCodes: [
                "238"
            ],
            timeZones: [
                "UTC-01:00"
            ],
            id: 41,
            index: 43,
            code: "CV",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        KY: {
            name: "Cayman Islands",
            i18n: 'country_cym',
            nativeName: "Cayman Islands",
            callingCodes: [
                "1345"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 42,
            index: 44,
            code: "KY",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        CF: {
            name: "Central African Republic",
            i18n: 'country_cen',
            nativeName: "Ködörösêse tî Bêafrîka",
            callingCodes: [
                "236"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 43,
            index: 45,
            code: "CF",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "sg", name: "Sango", nativeName: "yângâ tî sängö" }
            ],
        },
        TD: {
            name: "Chad",
            i18n: 'country_cha',
            nativeName: "Tchad",
            callingCodes: [
                "235"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 44,
            index: 46,
            code: "TD",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        CL: {
            name: "Chile",
            i18n: 'country_chil',
            nativeName: "Chile",
            callingCodes: [
                "56"
            ],
            timeZones: [
                "UTC-06:00",
                "UTC-04:00"
            ],
            id: 45,
            index: 47,
            code: "CL",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        CN: {
            name: "China",
            i18n: 'country_chin',
            nativeName: "中国",
            callingCodes: [
                "86"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 46,
            index: 48,
            code: "CN",
            languages: [
                { code: "yue", name: "Yue", nativeName: "Yue", manuallyAdded: true },
                { code: "wu", name: "Wu", nativeName: "Wu", manuallyAdded: true },
                { code: "zh", name: "Chinese", nativeName: "中文 (Zhōngwén)" }
            ],
        },
        CX: {
            name: "Christmas Island",
            i18n: 'country_cx',
            nativeName: "Christmas Island",
            callingCodes: [
                "61"
            ],
            timeZones: [
                "UTC+07:00"
            ],
            id: 47,
            index: 49,
            code: "CX",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        CC: {
            name: "Cocos (Keeling) Islands",
            i18n: 'country_cc',
            nativeName: "Cocos (Keeling) Islands",
            callingCodes: [
                "61"
            ],
            timeZones: [
                "UTC+06:30"
            ],
            id: 48,
            index: 50,
            code: "CC",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        CO: {
            name: "Colombia",
            i18n: 'country_col',
            nativeName: "Colombia",
            callingCodes: [
                "57"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 49,
            index: 51,
            code: "CO",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        KM: {
            name: "Comoros",
            i18n: 'country_com',
            nativeName: "Komori",
            callingCodes: [
                "269"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 50,
            index: 52,
            code: "KM",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        CG: {
            name: "Congo (Republic)",
            i18n: 'country_con',
            nativeName: "République du Congo",
            callingCodes: [
                "242"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 51,
            index: 53,
            code: "CG",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "ln", name: "Lingala", nativeName: "Lingála" }
            ],
        },
        CD: {
            name: "Congo (Democratic Republic)",
            i18n: 'country_con',
            nativeName: "République démocratique du Congo",
            callingCodes: [
                "243"
            ],
            timeZones: [
                "UTC+01:00",
                "UTC+02:00"
            ],
            id: 52,
            index: 54,
            code: "CD",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "ln", name: "Lingala", nativeName: "Lingála" },
                { code: "kg", name: "Kongo", nativeName: "Kikongo" },
                { code: "sw", name: "Swahili", nativeName: "Kiswahili" },
                { code: "lu", name: "Luba-Katanga", nativeName: "Tshiluba" }
            ],
        },
        CK: {
            name: "Cook Islands",
            i18n: 'country_ck',
            nativeName: "Cook Islands",
            callingCodes: [
                "682"
            ],
            timeZones: [
                "UTC-10:00"
            ],
            id: 53,
            index: 55,
            code: "CK",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        CR: {
            name: "Costa Rica",
            i18n: 'country_cos',
            nativeName: "Costa Rica",
            callingCodes: [
                "506"
            ],
            timeZones: [
                "UTC-06:00"
            ],
            id: 54,
            index: 56,
            code: "CR",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        HR: {
            name: "Croatia (Hrvatska)",
            i18n: 'country_cro',
            nativeName: "Hrvatska",
            callingCodes: [
                "385"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 56,
            index: 57,
            code: "HR",
            languages: [
                { code: "sh", name: "Serbo-Croatian", nativeName: "Serbo-Croatian" },
                { code: "hr", name: "Croatian", nativeName: "hrvatski jezik" }
            ],
        },
        CU: {
            name: "Cuba",
            i18n: 'country_cub',
            nativeName: "Cuba",
            callingCodes: [
                "53"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 57,
            index: 58,
            code: "CU",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        CW: {
            name: "Curaçao",
            i18n: 'country_cura',
            nativeName: "Curaçao",
            callingCodes: [
                "599"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 58,
            index: 59,
            code: "CW",
            languages: [
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" },
                { code: "pa", name: "Punjabi (Eastern)", nativeName: "ਪੰਜਾਬੀ" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        CY: {
            name: "Cyprus",
            i18n: 'country_cyp',
            nativeName: "Κύπρος",
            callingCodes: [
                "357"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 59,
            index: 60,
            code: "CY",
            languages: [
                { code: "el", name: "Greek (modern)", nativeName: "ελληνικά" },
                { code: "tr", name: "Turkish", nativeName: "Türkçe" },
                { code: "hy", name: "Armenian", nativeName: "Հայերեն" }
            ],
        },
        CZ: {
            name: "Czech Republic",
            i18n: 'country_cze',
            nativeName: "Česká republika",
            callingCodes: [
                "420"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 60,
            index: 61,
            code: "CZ",
            languages: [
                { code: "cs", name: "Czech", nativeName: "čeština" },
                { code: "sk", name: "Slovak", nativeName: "slovenčina" }
            ],
        },
        DK: {
            name: "Denmark",
            i18n: 'country_den',
            nativeName: "Danmark",
            callingCodes: [
                "45"
            ],
            timeZones: [
                "UTC-04:00",
                "UTC-03:00",
                "UTC-01:00",
                "UTC",
                "UTC+01:00"
            ],
            id: 61,
            index: 62,
            code: "DK",
            languages: [
                { code: "da", name: "Danish", nativeName: "dansk" }
            ],
        },
        DJ: {
            name: "Djibouti",
            i18n: 'country_dji',
            nativeName: "Djibouti",
            callingCodes: [
                "253"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 62,
            index: 63,
            code: "DJ",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        DM: {
            name: "Dominica",
            i18n: 'country_dom',
            nativeName: "Dominica",
            callingCodes: [
                "1767"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 63,
            index: 64,
            code: "DM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        DO: {
            name: "Dominican Republic",
            i18n: 'country_domr',
            nativeName: "República Dominicana",
            callingCodes: [
                "1809",
                "1829",
                "1849"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 64,
            index: 65,
            code: "DO",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        EC: {
            name: "Ecuador",
            i18n: 'country_ecu',
            nativeName: "Ecuador",
            callingCodes: [
                "593"
            ],
            timeZones: [
                "UTC-06:00",
                "UTC-05:00"
            ],
            id: 65,
            index: 66,
            code: "EC",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        EG: {
            name: "Egypt",
            i18n: 'country_egy',
            nativeName: "مصر‎",
            callingCodes: [
                "20"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 66,
            index: 67,
            code: "EG",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        SV: {
            name: "El Salvador",
            i18n: 'country_els',
            nativeName: "El Salvador",
            callingCodes: [
                "503"
            ],
            timeZones: [
                "UTC-06:00"
            ],
            id: 67,
            index: 68,
            code: "SV",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        GQ: {
            name: "Equatorial Guinea",
            i18n: 'country_equ',
            nativeName: "Guinea Ecuatorial",
            callingCodes: [
                "240"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 68,
            index: 69,
            code: "GQ",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        ER: {
            name: "Eritrea",
            i18n: 'country_eri',
            nativeName: "ኤርትራ",
            callingCodes: [
                "291"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 69,
            index: 70,
            code: "ER",
            languages: [
                { code: "ti", name: "Tigrinya", nativeName: "ትግርኛ" },
                { code: "ar", name: "Arabic", nativeName: "العربية" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        EE: {
            name: "Estonia",
            i18n: 'country_est',
            nativeName: "Eesti",
            callingCodes: [
                "372"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 70,
            index: 71,
            code: "EE",
            languages: [
                { code: "et", name: "Estonian", nativeName: "eesti" }
            ],
        },
        ET: {
            name: "Ethiopia",
            i18n: 'country_eth',
            nativeName: "ኢትዮጵያ",
            callingCodes: [
                "251"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 71,
            index: 72,
            code: "ET",
            languages: [
                { code: "am", name: "Amharic", nativeName: "አማርኛ" }
            ],
        },
        FK: {
            name: "Falkland Islands (Malvinas)",
            i18n: 'country_fk',
            nativeName: "Falkland Islands",
            callingCodes: [
                "500"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 72,
            index: 73,
            code: "FK",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        FO: {
            name: "Faroe Islands",
            i18n: 'country_fa',
            nativeName: "Føroyar",
            callingCodes: [
                "298"
            ],
            timeZones: [
                "UTC+00:00"
            ],
            id: 73,
            index: 74,
            code: "FO",
            languages: [
                { code: "fo", name: "Faroese", nativeName: "føroyskt" }
            ],
        },
        FJ: {
            name: "Fiji",
            i18n: 'country_fij',
            nativeName: "Fiji",
            callingCodes: [
                "679"
            ],
            timeZones: [
                "UTC+12:00"
            ],
            id: 74,
            index: 75,
            code: "FJ",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "fj", name: "Fijian", nativeName: "vosa Vakaviti" },
                { code: "hi", name: "Hindi", nativeName: "हिन्दी" },
                { code: "ur", name: "Urdu", nativeName: "اردو" }
            ],
        },
        FI: {
            name: "Finland",
            i18n: 'country_fin',
            nativeName: "Suomi",
            callingCodes: [
                "358"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 75,
            index: 76,
            code: "FI",
            languages: [
                { code: "fi", name: "Finnish", nativeName: "suomi" },
                { code: "sv", name: "Swedish", nativeName: "svenska" }
            ],
        },
        FR: {
            name: "France",
            i18n: 'country_fra',
            nativeName: "France",
            callingCodes: [
                "33"
            ],
            timeZones: [
                "UTC-10:00",
                "UTC-09:30",
                "UTC-09:00",
                "UTC-08:00",
                "UTC-04:00",
                "UTC-03:00",
                "UTC+01:00",
                "UTC+03:00",
                "UTC+04:00",
                "UTC+05:00",
                "UTC+11:00",
                "UTC+12:00"
            ],
            id: 76,
            index: 77,
            code: "FR",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        GF: {
            name: "French Guiana",
            i18n: 'country_gf',
            nativeName: "Guyane française",
            callingCodes: [
                "594"
            ],
            timeZones: [
                "UTC-03:00"
            ],
            id: 77,
            index: 78,
            code: "GF",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        PF: {
            name: "French Polynesia",
            i18n: 'country_pf',
            nativeName: "Polynésie française",
            callingCodes: [
                "689"
            ],
            timeZones: [
                "UTC-10:00",
                "UTC-09:30",
                "UTC-09:00"
            ],
            id: 78,
            index: 79,
            code: "PF",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        TF: {
            name: "French Southern Territories",
            i18n: 'country_tf',
            nativeName: "Territoire des Terres australes et antarctiques françaises",
            callingCodes: [
                ""
            ],
            timeZones: [
                "UTC+05:00"
            ],
            id: 79,
            index: 80,
            code: "TF",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        GA: {
            name: "Gabon",
            i18n: 'country_gab',
            nativeName: "Gabon",
            callingCodes: [
                "241"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 80,
            index: 81,
            code: "GA",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        GM: {
            name: "Gambia",
            i18n: 'country_gam',
            nativeName: "Gambia",
            callingCodes: [
                "220"
            ],
            timeZones: [
                "UTC+00:00"
            ],
            id: 81,
            index: 82,
            code: "GM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        GE: {
            name: "Georgia",
            i18n: 'country_geo',
            nativeName: "საქართველო",
            callingCodes: [
                "995"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 82,
            index: 83,
            code: "GE",
            languages: [
                { code: "ka", name: "Georgian", nativeName: "ქართული" }
            ],
        },
        DE: {
            name: "Germany",
            i18n: 'country_ger',
            nativeName: "Deutschland",
            callingCodes: [
                "49"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 83,
            index: 84,
            code: "DE",
            languages: [
                { code: "de", name: "German", nativeName: "Deutsch" }
            ],
        },
        GH: {
            name: "Ghana",
            i18n: 'country_gha',
            nativeName: "Ghana",
            callingCodes: [
                "233"
            ],
            timeZones: [
                "UTC"
            ],
            id: 84,
            index: 85,
            code: "GH",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        GI: {
            name: "Gibraltar",
            i18n: 'country_gi',
            nativeName: "Gibraltar",
            callingCodes: [
                "350"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 85,
            index: 86,
            code: "GI",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        GR: {
            name: "Greece",
            i18n: 'country_gree',
            nativeName: "Ελλάδα",
            callingCodes: [
                "30"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 86,
            index: 87,
            code: "GR",
            languages: [
                { code: "el", name: "Greek (modern)", nativeName: "ελληνικά" }
            ],
        },
        GL: {
            name: "Greenland",
            i18n: 'country_gl',
            nativeName: "Kalaallit Nunaat",
            callingCodes: [
                "299"
            ],
            timeZones: [
                "UTC-04:00",
                "UTC-03:00",
                "UTC-01:00",
                "UTC+00:00"
            ],
            id: 87,
            index: 88,
            code: "GL",
            languages: [
                { code: "kl", name: "Kalaallisut", nativeName: "kalaallisut" }
            ],
        },
        GD: {
            name: "Grenada",
            i18n: 'country_gren',
            nativeName: "Grenada",
            callingCodes: [
                "1473"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 88,
            index: 89,
            code: "GD",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        GP: {
            name: "Guadeloupe",
            i18n: 'country_gp',
            nativeName: "Guadeloupe",
            callingCodes: [
                "590"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 89,
            index: 90,
            code: "GP",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        GU: {
            name: "Guam",
            i18n: 'country_gu',
            nativeName: "Guam",
            callingCodes: [
                "1671"
            ],
            timeZones: [
                "UTC+10:00"
            ],
            id: 90,
            index: 91,
            code: "GU",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "ch", name: "Chamorro", nativeName: "Chamoru" },
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        GT: {
            name: "Guatemala",
            i18n: 'country_gua',
            nativeName: "Guatemala",
            callingCodes: [
                "502"
            ],
            timeZones: [
                "UTC-06:00"
            ],
            id: 91,
            index: 92,
            code: "GT",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        GG: {
            name: "Guernsey",
            i18n: 'country_gg',
            nativeName: "Guernsey",
            callingCodes: [
                "44"
            ],
            timeZones: [
                "UTC+00:00"
            ],
            id: 92,
            index: 93,
            code: "GG",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        GN: {
            name: "Guinea",
            i18n: 'country_gui',
            nativeName: "Guinée",
            callingCodes: [
                "224"
            ],
            timeZones: [
                "UTC"
            ],
            id: 93,
            index: 94,
            code: "GN",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "ff", name: "Fula", nativeName: "Fulfulde" }
            ],
        },
        GW: {
            name: "Guinea-bissau",
            i18n: 'country_guib',
            nativeName: "Guiné-Bissau",
            callingCodes: [
                "245"
            ],
            timeZones: [
                "UTC"
            ],
            id: 94,
            index: 95,
            code: "GW",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        GY: {
            name: "Guyana",
            i18n: 'country_guy',
            nativeName: "Guyana",
            callingCodes: [
                "592"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 95,
            index: 96,
            code: "GY",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        HT: {
            name: "Haiti",
            i18n: 'country_hai',
            nativeName: "Haïti",
            callingCodes: [
                "509"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 96,
            index: 97,
            code: "HT",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "ht", name: "Haitian", nativeName: "Kreyòl ayisyen" }
            ],
        },
        HM: {
            name: "Heard Island and McDonald Islands",
            i18n: 'country_hm',
            nativeName: "Heard Island and McDonald Islands",
            callingCodes: [
                ""
            ],
            timeZones: [
                "UTC+05:00"
            ],
            id: 97,
            index: 98,
            code: "HM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        VA: {
            name: "Holy See (Vatican City State)",
            i18n: 'country_va',
            nativeName: "Sancta Sedes",
            callingCodes: [
                "379"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 98,
            index: 99,
            code: "VA",
            languages: [
                { code: "la", name: "Latin", nativeName: "latine" },
                { code: "it", name: "Italian", nativeName: "Italiano" },
                { code: "fr", name: "French", nativeName: "français" },
                { code: "de", name: "German", nativeName: "Deutsch" }
            ],
        },
        HN: {
            name: "Honduras",
            i18n: 'country_hon',
            nativeName: "Honduras",
            callingCodes: [
                "504"
            ],
            timeZones: [
                "UTC-06:00"
            ],
            id: 99,
            index: 100,
            code: "HN",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        HK: {
            name: "Hong Kong",
            i18n: 'country_hong',
            nativeName: "香港",
            callingCodes: [
                "852"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 100,
            index: 101,
            code: "HK",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "zh", name: "Chinese", nativeName: "中文 (Zhōngwén)" }
            ],
        },
        HU: {
            name: "Hungary",
            i18n: 'country_hun',
            nativeName: "Magyarország",
            callingCodes: [
                "36"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 101,
            index: 102,
            code: "HU",
            languages: [
                { code: "hu", name: "Hungarian", nativeName: "magyar" }
            ],
        },
        IS: {
            name: "Iceland",
            i18n: 'country_ice',
            nativeName: "Ísland",
            callingCodes: [
                "354"
            ],
            timeZones: [
                "UTC"
            ],
            id: 102,
            index: 103,
            code: "IS",
            languages: [
                { code: "is", name: "Icelandic", nativeName: "Íslenska" }
            ],
        },
        IN: {
            name: "India",
            i18n: 'country_indi',
            nativeName: "भारत",
            callingCodes: [
                "91"
            ],
            timeZones: [
                "UTC+05:30"
            ],
            id: 103,
            index: 104,
            code: "IN",
            languages: [
                { code: "te", name: "Telugu", nativeName: "Telugu" },
                { code: "mr", name: "Marathi", nativeName: "Marathi" },
                { code: "hi", name: "Hindi", nativeName: "हिन्दी" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        id: {
            name: "Indonesia",
            i18n: 'country_indo',
            nativeName: "Indonesia",
            callingCodes: [
                "62"
            ],
            timeZones: [
                "UTC+07:00",
                "UTC+08:00",
                "UTC+09:00"
            ],
            id: 104,
            index: 105,
            code: "ID",
            languages: [
                { code: "jv", name: "Javanese", nativeName: "Bahasa Indonesia" }
            ],
        },
        CI: {
            name: "Cote D'ivoire",
            i18n: 'country_ci',
            nativeName: "Côte d'Ivoire",
            callingCodes: [
                "225"
            ],
            timeZones: [
                "UTC"
            ],
            id: 55,
            index: 106,
            code: "CI",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        IR: {
            name: "Iran",
            i18n: 'country_iran',
            nativeName: "ایران",
            callingCodes: [
                "98"
            ],
            timeZones: [
                "UTC+03:30"
            ],
            id: 105,
            index: 107,
            code: "IR",
            languages: [
                { code: "fa", name: "Persian (Farsi)", nativeName: "فارسی" }
            ],
        },
        IQ: {
            name: "Iraq",
            i18n: 'country_iraq',
            nativeName: "العراق",
            callingCodes: [
                "964"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 106,
            index: 108,
            code: "IQ",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" },
                { code: "ku", name: "Kurdish", nativeName: "Kurdî" }
            ],
        },
        IE: {
            name: "Ireland",
            i18n: 'country_ire',
            nativeName: "Éire",
            callingCodes: [
                "353"
            ],
            timeZones: [
                "UTC"
            ],
            id: 107,
            index: 109,
            code: "IE",
            languages: [
                { code: "ga", name: "Irish", nativeName: "Gaeilge" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        IM: {
            name: "Isle of Man",
            i18n: 'country_im',
            nativeName: "Isle of Man",
            callingCodes: [
                "44"
            ],
            timeZones: [
                "UTC+00:00"
            ],
            id: 108,
            index: 110,
            code: "IM",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "gv", name: "Manx", nativeName: "Gaelg" }
            ],
        },
        IL: {
            name: "Israel",
            i18n: 'country_isr',
            nativeName: "יִשְׂרָאֵל",
            callingCodes: [
                "972"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 109,
            index: 111,
            code: "IL",
            languages: [
                { code: "he", name: "Hebrew (modern)", nativeName: "עברית" },
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        IT: {
            name: "Italy",
            i18n: 'country_ita',
            nativeName: "Italia",
            callingCodes: [
                "39"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 110,
            index: 112,
            code: "IT",
            languages: [
                { code: "it", name: "Italian", nativeName: "Italiano" }
            ],
        },
        JM: {
            name: "Jamaica",
            i18n: 'country_jam',
            nativeName: "Jamaica",
            callingCodes: [
                "1876"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 111,
            index: 113,
            code: "JM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        JP: {
            name: "Japan",
            i18n: 'country_jap',
            nativeName: "日本",
            callingCodes: [
                "81"
            ],
            timeZones: [
                "UTC+09:00"
            ],
            id: 112,
            index: 114,
            code: "JP",
            languages: [
                { code: "ja", name: "Japanese", nativeName: "日本語 (にほんご)" }
            ],
        },
        JE: {
            name: "Jersey",
            i18n: 'country_je',
            nativeName: "Jersey",
            callingCodes: [
                "44"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 113,
            index: 115,
            code: "JE",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        JO: {
            name: "Jordan",
            i18n: 'country_jor',
            nativeName: "الأردن",
            callingCodes: [
                "962"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 114,
            index: 116,
            code: "JO",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        KZ: {
            name: "Kazakhstan",
            i18n: 'country_kaz',
            nativeName: "Қазақстан",
            callingCodes: [
                "76",
                "77"
            ],
            timeZones: [
                "UTC+05:00",
                "UTC+06:00"
            ],
            id: 115,
            index: 117,
            code: "KZ",
            languages: [
                { code: "kk", name: "Kazakh", nativeName: "қазақ тілі" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        KE: {
            name: "Kenya",
            i18n: 'country_ken',
            nativeName: "Kenya",
            callingCodes: [
                "254"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 116,
            index: 118,
            code: "KE",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "sw", name: "Swahili", nativeName: "Kiswahili" }
            ],
        },
        KI: {
            name: "Kiribati",
            i18n: 'country_kir',
            nativeName: "Kiribati",
            callingCodes: [
                "686"
            ],
            timeZones: [
                "UTC+12:00",
                "UTC+13:00",
                "UTC+14:00"
            ],
            id: 117,
            index: 119,
            code: "KI",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        KW: {
            name: "Kuwait",
            i18n: 'country_kuw',
            nativeName: "الكويت",
            callingCodes: [
                "965"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 120,
            index: 120,
            code: "KW",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        KG: {
            name: "Kyrgyzstan",
            i18n: 'country_kyr',
            nativeName: "Кыргызстан",
            callingCodes: [
                "996"
            ],
            timeZones: [
                "UTC+06:00"
            ],
            id: 121,
            index: 121,
            code: "KG",
            languages: [
                { code: "ky", name: "Kyrgyz", nativeName: "Кыргызча" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        LA: {
            name: "Lao People's Democratic Republic",
            i18n: 'country_la',
            nativeName: "ສປປລາວ",
            callingCodes: [
                "856"
            ],
            timeZones: [
                "UTC+07:00"
            ],
            id: 122,
            index: 122,
            code: "LA",
            languages: [
                { code: "lo", name: "Lao", nativeName: "ພາສາລາວ" }
            ],
        },
        LV: {
            name: "Latvia",
            i18n: 'country_lat',
            nativeName: "Latvija",
            callingCodes: [
                "371"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 123,
            index: 123,
            code: "LV",
            languages: [
                { code: "lv", name: "Latvian", nativeName: "latviešu valoda" }
            ],
        },
        LB: {
            name: "Lebanon",
            i18n: 'country_leb',
            nativeName: "لبنان",
            callingCodes: [
                "961"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 124,
            index: 124,
            code: "LB",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        LS: {
            name: "Lesotho",
            i18n: 'country_les',
            nativeName: "Lesotho",
            callingCodes: [
                "266"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 125,
            index: 125,
            code: "LS",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "st", name: "Southern Sotho", nativeName: "Sesotho" }
            ],
        },
        LR: {
            name: "Liberia",
            i18n: 'country_libe',
            nativeName: "Liberia",
            callingCodes: [
                "231"
            ],
            timeZones: [
                "UTC"
            ],
            id: 126,
            index: 126,
            code: "LR",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        LY: {
            name: "Libyan Arab Jamahiriya",
            i18n: 'country_liby',
            nativeName: "‏ليبيا",
            callingCodes: [
                "218"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 127,
            index: 127,
            code: "LY",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        LI: {
            name: "Liechtenstein",
            i18n: 'country_lie',
            nativeName: "Liechtenstein",
            callingCodes: [
                "423"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 128,
            index: 128,
            code: "LI",
            languages: [
                { code: "de", name: "German", nativeName: "Deutsch" }
            ],
        },
        LT: {
            name: "Lithuania",
            i18n: 'country_lit',
            nativeName: "Lietuva",
            callingCodes: [
                "370"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 129,
            index: 129,
            code: "LT",
            languages: [
                { code: "lt", name: "Lithuanian", nativeName: "lietuvių kalba" }
            ],
        },
        LU: {
            name: "Luxembourg",
            i18n: 'country_lux',
            nativeName: "Luxembourg",
            callingCodes: [
                "352"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 130,
            index: 130,
            code: "LU",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "de", name: "German", nativeName: "Deutsch" },
                { code: "lb", name: "Luxembourgish", nativeName: "Lëtzebuergesch" }
            ],
        },
        MO: {
            name: "Macau",
            i18n: 'country_mo',
            nativeName: "澳門",
            callingCodes: [
                "853"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 131,
            index: 131,
            code: "MO",
            languages: [
                { code: "zh", name: "Chinese", nativeName: "中文 (Zhōngwén)" },
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        MK: {
            name: "Macedonia",
            i18n: 'country_mac',
            nativeName: "Македонија",
            callingCodes: [
                "389"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 132,
            index: 132,
            code: "MK",
            languages: [
                { code: "mk", name: "Macedonian", nativeName: "македонски јазик" }
            ],
        },
        MG: {
            name: "Madagascar",
            i18n: 'country_mad',
            nativeName: "Madagasikara",
            callingCodes: [
                "261"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 133,
            index: 133,
            code: "MG",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "mg", name: "Malagasy", nativeName: "fiteny malagasy" }
            ],
        },
        MW: {
            name: "Malawi",
            i18n: 'country_malaw',
            nativeName: "Malawi",
            callingCodes: [
                "265"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 134,
            index: 134,
            code: "MW",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "ny", name: "Chichewa", nativeName: "chiCheŵa" }
            ],
        },
        MY: {
            name: "Malaysia",
            i18n: 'country_malay',
            nativeName: "Malaysia",
            callingCodes: [
                "60"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 135,
            index: 135,
            code: "MY",
            languages: [
                { code: "my", name: "Malaysian", nativeName: "بهاس مليسيا" },
            ],
        },
        MV: {
            name: "Maldives",
            i18n: 'country_mald',
            nativeName: "Maldives",
            callingCodes: [
                "960"
            ],
            timeZones: [
                "UTC+05:00"
            ],
            id: 136,
            index: 136,
            code: "MV",
            languages: [
                { code: "dv", name: "Divehi", nativeName: "ދިވެހި" }
            ],
        },
        ML: {
            name: "Mali",
            i18n: 'country_mali',
            nativeName: "Mali",
            callingCodes: [
                "223"
            ],
            timeZones: [
                "UTC"
            ],
            id: 137,
            index: 137,
            code: "ML",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        MT: {
            name: "Malta",
            i18n: 'country_malt',
            nativeName: "Malta",
            callingCodes: [
                "356"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 138,
            index: 138,
            code: "MT",
            languages: [
                { code: "mt", name: "Maltese", nativeName: "Malti" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        MH: {
            name: "Marshall Islands",
            i18n: 'country_mar',
            nativeName: "M̧ajeļ",
            callingCodes: [
                "692"
            ],
            timeZones: [
                "UTC+12:00"
            ],
            id: 139,
            index: 139,
            code: "MH",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "mh", name: "Marshallese", nativeName: "Kajin M̧ajeļ" }
            ],
        },
        MQ: {
            name: "Martinique",
            i18n: 'country_mart',
            nativeName: "Martinique",
            callingCodes: [
                "596"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 140,
            index: 140,
            code: "MQ",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        MR: {
            name: "Mauritania",
            i18n: 'country_mauritn',
            nativeName: "موريتانيا",
            callingCodes: [
                "222"
            ],
            timeZones: [
                "UTC"
            ],
            id: 141,
            index: 141,
            code: "MR",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        MU: {
            name: "Mauritius",
            i18n: 'country_maurits',
            nativeName: "Maurice",
            callingCodes: [
                "230"
            ],
            timeZones: [
                "UTC+04:00"
            ],
            id: 142,
            index: 142,
            code: "MU",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        YT: {
            name: "Mayotte",
            i18n: 'country_yt',
            nativeName: "Mayotte",
            callingCodes: [
                "262"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 143,
            index: 143,
            code: "YT",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        MX: {
            name: "Mexico",
            i18n: 'country_mex',
            nativeName: "México",
            callingCodes: [
                "52"
            ],
            timeZones: [
                "UTC-08:00",
                "UTC-07:00",
                "UTC-06:00"
            ],
            id: 144,
            index: 144,
            code: "MX",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        FM: {
            name: "Micronesia (Federated States)",
            i18n: 'country_mic',
            nativeName: "Micronesia",
            callingCodes: [
                "691"
            ],
            timeZones: [
                "UTC+10:00",
                "UTC+11"
            ],
            id: 145,
            index: 145,
            code: "FM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        MD: {
            name: "Moldova",
            i18n: 'country_mol',
            nativeName: "Moldova",
            callingCodes: [
                "373"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 146,
            index: 146,
            code: "MD",
            languages: [
                { code: "ro", name: "Romanian", nativeName: "Română" }
            ],
        },
        MC: {
            name: "Monaco",
            i18n: 'country_mona',
            nativeName: "Monaco",
            callingCodes: [
                "377"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 147,
            index: 147,
            code: "MC",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        MN: {
            name: "Mongolia",
            i18n: 'country_mong',
            nativeName: "Монгол улс",
            callingCodes: [
                "976"
            ],
            timeZones: [
                "UTC+07:00",
                "UTC+08:00"
            ],
            id: 148,
            index: 148,
            code: "MN",
            languages: [
                { code: "mn", name: "Mongolian", nativeName: "Монгол хэл" }
            ],
        },
        ME: {
            name: "Montenegro",
            i18n: 'country_mont',
            nativeName: "Црна Гора",
            callingCodes: [
                "382"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 149,
            index: 149,
            code: "ME",
            languages: [
                { code: "me", name: "Montenegrin", nativeName: "Montenegrin", manuallyAdded: true, },
                { code: "sr", name: "Serbian", nativeName: "српски језик" },
                { code: "bs", name: "Bosnian", nativeName: "bosanski jezik" },
                { code: "sq", name: "Albanian", nativeName: "Shqip" },
                { code: "hr", name: "Croatian", nativeName: "hrvatski jezik" }
            ],
        },
        MS: {
            name: "Montserrat",
            i18n: 'country_ms',
            nativeName: "Montserrat",
            callingCodes: [
                "1664"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 150,
            index: 150,
            code: "MS",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        MA: {
            name: "Morocco",
            i18n: 'country_mor',
            nativeName: "المغرب",
            callingCodes: [
                "212"
            ],
            timeZones: [
                "UTC"
            ],
            id: 151,
            index: 151,
            code: "MA",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        MZ: {
            name: "Mozambique",
            i18n: 'country_moz',
            nativeName: "Moçambique",
            callingCodes: [
                "258"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 152,
            index: 152,
            code: "MZ",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        MM: {
            name: "Myanmar",
            i18n: 'country_mya',
            nativeName: "Myanma",
            callingCodes: [
                "95"
            ],
            timeZones: [
                "UTC+06:30"
            ],
            id: 153,
            index: 153,
            code: "MM",
            languages: [
                { code: "my", name: "Burmese", nativeName: "ဗမာစာ" }
            ],
        },
        NA: {
            name: "Namibia",
            i18n: 'country_nam',
            nativeName: "Namibia",
            callingCodes: [
                "264"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 154,
            index: 154,
            code: "NA",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "af", name: "Afrikaans", nativeName: "Afrikaans" }
            ],
        },
        NR: {
            name: "Nauru",
            i18n: 'country_nau',
            nativeName: "Nauru",
            callingCodes: [
                "674"
            ],
            timeZones: [
                "UTC+12:00"
            ],
            id: 155,
            index: 155,
            code: "NR",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "na", name: "Nauruan", nativeName: "Dorerin Naoero" }
            ],
        },
        NP: {
            name: "Nepal",
            i18n: 'country_nep',
            nativeName: "नेपाल",
            callingCodes: [
                "977"
            ],
            timeZones: [
                "UTC+05:45"
            ],
            id: 156,
            index: 156,
            code: "NP",
            languages: [
                { code: "ne", name: "Nepali", nativeName: "नेपाली" },
            ],
        },
        NL: {
            name: "Netherlands",
            i18n: 'country_net',
            nativeName: "Nederland",
            callingCodes: [
                "31"
            ],
            timeZones: [
                "UTC-04:00",
                "UTC+01:00"
            ],
            id: 157,
            index: 157,
            code: "NL",
            languages: [
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" }
            ],
        },
        NC: {
            name: "New Caledonia",
            i18n: 'country_nc',
            nativeName: "Nouvelle-Calédonie",
            callingCodes: [
                "687"
            ],
            timeZones: [
                "UTC+11:00"
            ],
            id: 158,
            index: 158,
            code: "NC",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        NZ: {
            name: "New Zealand",
            i18n: 'country_new',
            nativeName: "New Zealand",
            callingCodes: [
                "64"
            ],
            timeZones: [
                "UTC-11:00",
                "UTC-10:00",
                "UTC+12:00",
                "UTC+12:45",
                "UTC+13:00"
            ],
            id: 159,
            index: 159,
            code: "NZ",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "mi", name: "Māori", nativeName: "te reo Māori" }
            ],
        },
        NI: {
            name: "Nicaragua",
            i18n: 'country_nic',
            nativeName: "Nicaragua",
            callingCodes: [
                "505"
            ],
            timeZones: [
                "UTC-06:00"
            ],
            id: 160,
            index: 160,
            code: "NI",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        NE: {
            name: "Niger",
            i18n: 'country_nig',
            nativeName: "Niger",
            callingCodes: [
                "227"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 161,
            index: 161,
            code: "NE",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        NG: {
            name: "Nigeria",
            i18n: 'country_niga',
            nativeName: "Nigeria",
            callingCodes: [
                "234"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 162,
            index: 162,
            code: "NG",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        NU: {
            name: "Niue",
            i18n: 'country_nu',
            nativeName: "Niuē",
            callingCodes: [
                "683"
            ],
            timeZones: [
                "UTC-11:00"
            ],
            id: 163,
            index: 163,
            code: "NU",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        NF: {
            name: "Norfolk Island",
            i18n: 'country_nf',
            nativeName: "Norfolk Island",
            callingCodes: [
                "672"
            ],
            timeZones: [
                "UTC+11:30"
            ],
            id: 164,
            index: 164,
            code: "NF",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        KP: {
            name: "Korea (Democratic People's Republic of)",
            i18n: 'country_kp',
            nativeName: "북한",
            callingCodes: [
                "850"
            ],
            timeZones: [
                "UTC+09:00"
            ],
            id: 118,
            index: 165,
            code: "KP",
            languages: [
                { code: "ko", name: "Korean", nativeName: "한국어" }
            ],
        },
        MP: {
            name: "Northern Mariana Islands",
            i18n: 'country_mp',
            nativeName: "Northern Mariana Islands",
            callingCodes: [
                "1670"
            ],
            timeZones: [
                "UTC+10:00"
            ],
            id: 165,
            index: 166,
            code: "MP",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "ch", name: "Chamorro", nativeName: "Chamoru" }
            ],
        },
        NO: {
            name: "Norway",
            i18n: 'country_nor',
            nativeName: "Norge",
            callingCodes: [
                "47"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 166,
            index: 167,
            code: "NO",
            languages: [
                { code: "no", name: "Norwegian", nativeName: "Norsk" },
                { code: "nb", name: "Norwegian Bokmål", nativeName: "Norsk bokmål" },
                { code: "nn", name: "Norwegian Nynorsk", nativeName: "Norsk nynorsk" }
            ],
        },
        OM: {
            name: "Oman",
            i18n: 'country_oma',
            nativeName: "عمان",
            callingCodes: [
                "968"
            ],
            timeZones: [
                "UTC+04:00"
            ],
            id: 167,
            index: 168,
            code: "OM",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        PK: {
            name: "Pakistan",
            i18n: 'country_pak',
            nativeName: "Pakistan",
            callingCodes: [
                "92"
            ],
            timeZones: [
                "UTC+05:00"
            ],
            id: 168,
            index: 169,
            code: "PK",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "ur", name: "Urdu", nativeName: "اردو" }
            ],
        },
        PW: {
            name: "Palau",
            i18n: 'country_pal',
            nativeName: "Palau",
            callingCodes: [
                "680"
            ],
            timeZones: [
                "UTC+09:00"
            ],
            id: 169,
            index: 170,
            code: "PW",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        PS: {
            name: "Palestinian Occupied Territories",
            i18n: 'country_pse',
            nativeName: "فلسطين",
            callingCodes: [
                "970"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 170,
            index: 171,
            code: "PS",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        PA: {
            name: "Panama",
            i18n: 'country_pan',
            nativeName: "Panamá",
            callingCodes: [
                "507"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 171,
            index: 172,
            code: "PA",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        PG: {
            name: "Papua New Guinea",
            i18n: 'country_pap',
            nativeName: "Papua Niugini",
            callingCodes: [
                "675"
            ],
            timeZones: [
                "UTC+10:00"
            ],
            id: 172,
            index: 173,
            code: "PG",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        PY: {
            name: "Paraguay",
            i18n: 'country_par',
            nativeName: "Paraguay",
            callingCodes: [
                "595"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 173,
            index: 174,
            code: "PY",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" },
                { code: "gn", name: "Guaraní", nativeName: "Avañe'ẽ" }
            ],
        },
        PE: {
            name: "Peru",
            i18n: 'country_per',
            nativeName: "Perú",
            callingCodes: [
                "51"
            ],
            timeZones: [
                "UTC-05:00"
            ],
            id: 174,
            index: 175,
            code: "PE",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        PH: {
            name: "Philippines",
            i18n: 'country_phi',
            nativeName: "Pilipinas",
            callingCodes: [
                "63"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 175,
            index: 176,
            code: "PH",
            languages: [
                { code: "ph", name: "Filipino", nativeName: "Filipino", manuallyAdded: true, },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        PN: {
            name: "Pitcairn",
            i18n: 'country_pn',
            nativeName: "Pitcairn Islands",
            callingCodes: [
                "64"
            ],
            timeZones: [
                "UTC-08:00"
            ],
            id: 176,
            index: 177,
            code: "PN",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        PL: {
            name: "Poland",
            i18n: 'country_pol',
            nativeName: "Polska",
            callingCodes: [
                "48"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 177,
            index: 178,
            code: "PL",
            languages: [
                { code: "pl", name: "Polish", nativeName: "język polski" }
            ],
        },
        PT: {
            name: "Portugal",
            i18n: 'country_por',
            nativeName: "Portugal",
            callingCodes: [
                "351"
            ],
            timeZones: [
                "UTC-01:00",
                "UTC"
            ],
            id: 178,
            index: 179,
            code: "PT",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        PR: {
            name: "Puerto Rico",
            i18n: 'country_pri',
            nativeName: "Puerto Rico",
            callingCodes: [
                "1787",
                "1939"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 179,
            index: 180,
            code: "PR",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        QA: {
            name: "Qatar",
            i18n: 'country_qat',
            nativeName: "قطر",
            callingCodes: [
                "974"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 180,
            index: 181,
            code: "QA",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        XK: {
            name: "Kosovo, Republic of",
            i18n: 'country_kos',
            nativeName: "Republika e Kosovës",
            callingCodes: [
                "383"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 250,
            index: 182,
            code: "XK",
            languages: [
                { code: "sq", name: "Albanian", nativeName: "Shqip" },
                { code: "sr", name: "Serbian", nativeName: "српски језик" }
            ],
        },
        RE: {
            name: "Reunion",
            i18n: 'country_re',
            nativeName: "La Réunion",
            callingCodes: [
                "262"
            ],
            timeZones: [
                "UTC+04:00"
            ],
            id: 181,
            index: 183,
            code: "RE",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        RO: {
            name: "Romania",
            i18n: 'country_rom',
            nativeName: "România",
            callingCodes: [
                "40"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 182,
            index: 184,
            code: "RO",
            languages: [
                { code: "ro", name: "Romanian", nativeName: "Română" }
            ],
        },
        RU: {
            name: "Russian Federation",
            i18n: 'country_rus',
            nativeName: "Россия",
            callingCodes: [
                "7"
            ],
            timeZones: [
                "UTC+03:00",
                "UTC+04:00",
                "UTC+06:00",
                "UTC+07:00",
                "UTC+08:00",
                "UTC+09:00",
                "UTC+10:00",
                "UTC+11:00",
                "UTC+12:00"
            ],
            id: 183,
            index: 185,
            code: "RU",
            languages: [
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        RW: {
            name: "Rwanda",
            i18n: 'country_rwa',
            nativeName: "Rwanda",
            callingCodes: [
                "250"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 184,
            index: 186,
            code: "RW",
            languages: [
                { code: "rw", name: "Kinyarwanda", nativeName: "Ikinyarwanda" },
                { code: "en", name: "English", nativeName: "English" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        BL: {
            name: "Saint Barthélemy",
            i18n: 'country_bl',
            nativeName: "Saint-Barthélemy",
            callingCodes: [
                "590"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 185,
            index: 187,
            code: "BL",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        SH: {
            name: "Saint Helena, Ascension and Tristan da Cunha",
            i18n: 'country_sh',
            nativeName: "Saint Helena",
            callingCodes: [
                "290"
            ],
            timeZones: [
                "UTC+00:00"
            ],
            id: 186,
            index: 188,
            code: "SH",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        KN: {
            name: "Saint Kitts and Nevis",
            i18n: 'country_stk',
            nativeName: "Saint Kitts and Nevis",
            callingCodes: [
                "1869"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 187,
            index: 189,
            code: "KN",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        LC: {
            name: "Saint Lucia",
            i18n: 'country_stl',
            nativeName: "Saint Lucia",
            callingCodes: [
                "1758"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 188,
            index: 190,
            code: "LC",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        MF: {
            name: "Saint Martin",
            i18n: 'country_mf',
            nativeName: "Saint-Martin",
            callingCodes: [
                "590"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 189,
            index: 191,
            code: "MF",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "fr", name: "French", nativeName: "français" },
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" }
            ],
        },
        PM: {
            name: "Saint Pierre and Miquelon",
            i18n: 'country_pm',
            nativeName: "Saint-Pierre-et-Miquelon",
            callingCodes: [
                "508"
            ],
            timeZones: [
                "UTC-03:00"
            ],
            id: 190,
            index: 192,
            code: "PM",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        VC: {
            name: "Saint Vincent and The Grenadines",
            i18n: 'country_sai',
            nativeName: "Saint Vincent and the Grenadines",
            callingCodes: [
                "1784"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 191,
            index: 193,
            code: "VC",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        WS: {
            name: "Samoa",
            i18n: 'country_sam',
            nativeName: "Samoa",
            callingCodes: [
                "685"
            ],
            timeZones: [
                "UTC+13:00"
            ],
            id: 192,
            index: 194,
            code: "WS",
            languages: [
                { code: "sm", name: "Samoan", nativeName: "gagana fa'a Samoa" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        SM: {
            name: "San Marino",
            i18n: 'country_san',
            nativeName: "San Marino",
            callingCodes: [
                "378"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 193,
            index: 195,
            code: "SM",
            languages: [
                { code: "it", name: "Italian", nativeName: "Italiano" }
            ],
        },
        ST: {
            name: "Sao Tome and Principe",
            i18n: 'country_sao',
            nativeName: "São Tomé e Príncipe",
            callingCodes: [
                "239"
            ],
            timeZones: [
                "UTC"
            ],
            id: 194,
            index: 196,
            code: "ST",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        SA: {
            name: "Saudi Arabia",
            i18n: 'country_sau',
            nativeName: "العربية السعودية",
            callingCodes: [
                "966"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 195,
            index: 197,
            code: "SA",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        SN: {
            name: "Senegal",
            i18n: 'country_sen',
            nativeName: "Sénégal",
            callingCodes: [
                "221"
            ],
            timeZones: [
                "UTC"
            ],
            id: 196,
            index: 198,
            code: "SN",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        RS: {
            name: "Serbia",
            i18n: 'country_ser',
            nativeName: "Србија",
            callingCodes: [
                "381"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 197,
            index: 199,
            code: "RS",
            languages: [
                { code: "sr", name: "Serbian", nativeName: "српски језик" }
            ],
        },
        SC: {
            name: "Seychelles",
            i18n: 'country_sey',
            nativeName: "Seychelles",
            callingCodes: [
                "248"
            ],
            timeZones: [
                "UTC+04:00"
            ],
            id: 198,
            index: 200,
            code: "SC",
            languages: [
                { code: "fr", name: "French", nativeName: "français" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        SL: {
            name: "Sierra Leone",
            i18n: 'country_sie',
            nativeName: "Sierra Leone",
            callingCodes: [
                "232"
            ],
            timeZones: [
                "UTC"
            ],
            id: 199,
            index: 201,
            code: "SL",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        SG: {
            name: "Singapore",
            i18n: 'country_sin',
            nativeName: "Singapore",
            callingCodes: [
                "65"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 200,
            index: 202,
            code: "SG",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "ms", name: "Malay", nativeName: "bahasa Melayu" },
                { code: "ta", name: "Tamil", nativeName: "தமிழ்" },
                { code: "zh", name: "Chinese", nativeName: "中文 (Zhōngwén)" }
            ],
        },
        SX: {
            name: "Sint Maarten (Dutch part)",
            i18n: 'country_sx',
            nativeName: "Sint Maarten",
            callingCodes: [
                "1721"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 201,
            index: 203,
            code: "SX",
            languages: [
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        SK: {
            name: "Slovakia (Slovak Republic)",
            i18n: 'country_slok',
            nativeName: "Slovensko",
            callingCodes: [
                "421"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 202,
            index: 204,
            code: "SK",
            languages: [
                { code: "sk", name: "Slovak", nativeName: "slovenčina" }
            ],
        },
        SI: {
            name: "Slovenia",
            i18n: 'country_slon',
            nativeName: "Slovenija",
            callingCodes: [
                "386"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 203,
            index: 205,
            code: "SI",
            languages: [
                { code: "sl", name: "Slovene", nativeName: "slovenski jezik" }
            ],
        },
        SB: {
            name: "Solomon Islands",
            i18n: 'country_sol',
            nativeName: "Solomon Islands",
            callingCodes: [
                "677"
            ],
            timeZones: [
                "UTC+11:00"
            ],
            id: 204,
            index: 206,
            code: "SB",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        SO: {
            name: "Somalia",
            i18n: 'country_som',
            nativeName: "Soomaaliya",
            callingCodes: [
                "252"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 205,
            index: 207,
            code: "SO",
            languages: [
                { code: "so", name: "Somali", nativeName: "Soomaaliga" },
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        ZA: {
            name: "South Africa",
            i18n: 'country_sou',
            nativeName: "South Africa",
            callingCodes: [
                "27"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 206,
            index: 208,
            code: "ZA",
            languages: [
                { code: "af", name: "Afrikaans", nativeName: "Afrikaans" },
                { code: "en", name: "English", nativeName: "English" },
                { code: "nr", name: "Southern Ndebele", nativeName: "isiNdebele" },
                { code: "st", name: "Southern Sotho", nativeName: "Sesotho" },
                { code: "ss", name: "Swati", nativeName: "SiSwati" },
                { code: "tn", name: "Tswana", nativeName: "Setswana" },
                { code: "ts", name: "Tsonga", nativeName: "Xitsonga" },
                { code: "ve", name: "Venda", nativeName: "Tshivenḓa" },
                { code: "xh", name: "Xhosa", nativeName: "isiXhosa" },
                { code: "zu", name: "Zulu", nativeName: "isiZulu" }
            ],
        },
        GS: {
            name: "South Georgia and the South Sandwich Islands",
            i18n: 'country_gs',
            nativeName: "South Georgia",
            callingCodes: [
                "500"
            ],
            timeZones: [
                "UTC-02:00"
            ],
            id: 207,
            index: 209,
            code: "GS",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        KR: {
            name: "Korea (Republic of)",
            i18n: 'country_kr',
            nativeName: "대한민국",
            callingCodes: [
                "82"
            ],
            timeZones: [
                "UTC+09:00"
            ],
            id: 119,
            index: 210,
            code: "KR",
            languages: [
                { code: "ko", name: "Korean", nativeName: "한국어" }
            ],
        },
        SS: {
            name: "South Sudan",
            i18n: 'country_ssd',
            nativeName: "South Sudan",
            callingCodes: [
                "211"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 208,
            index: 211,
            code: "SS",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        ES: {
            name: "Spain",
            i18n: 'country_spa',
            nativeName: "España",
            callingCodes: [
                "34"
            ],
            timeZones: [
                "UTC",
                "UTC+01:00"
            ],
            id: 209,
            index: 212,
            code: "ES",
            languages: [
                { code: "val", name: "Valencian", nativeName: "Valencià", manuallyAdded: true },
                { code: "ca", name: "Catalan", nativeName: "català" },
                { code: "cas", name: "Castellano", nativeName: "Castellano", manuallyAdded: true },
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        LK: {
            name: "Sri Lanka",
            i18n: 'country_sri',
            nativeName: "śrī laṃkāva",
            callingCodes: [
                "94"
            ],
            timeZones: [
                "UTC+05:30"
            ],
            id: 210,
            index: 213,
            code: "LK",
            languages: [
                { code: "si", name: "Sinhalese", nativeName: "සිංහල" },
                { code: "ta", name: "Tamil", nativeName: "தமிழ்" }
            ],
        },
        SD: {
            name: "Sudan",
            i18n: 'country_sud',
            nativeName: "السودان",
            callingCodes: [
                "249"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 211,
            index: 214,
            code: "SD",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        SR: {
            name: "Suriname",
            i18n: 'country_sur',
            nativeName: "Suriname",
            callingCodes: [
                "597"
            ],
            timeZones: [
                "UTC-03:00"
            ],
            id: 212,
            index: 215,
            code: "SR",
            languages: [
                { code: "nl", name: "Dutch; flemish", nativeName: "Dutch; flemish" }
            ],
        },
        SJ: {
            name: "Svalbard and Jan Mayen",
            i18n: 'country_sj',
            nativeName: "Svalbard og Jan Mayen",
            callingCodes: [
                "4779"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 213,
            index: 216,
            code: "SJ",
            languages: [
                { code: "no", name: "Norwegian", nativeName: "Norsk" }
            ],
        },
        SZ: {
            name: "Swaziland",
            i18n: 'country_swa',
            nativeName: "Swaziland",
            callingCodes: [
                "268"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 214,
            index: 217,
            code: "SZ",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "ss", name: "Swati", nativeName: "SiSwati" }
            ],
        },
        SE: {
            name: "Sweden",
            i18n: 'country_swe',
            nativeName: "Sverige",
            callingCodes: [
                "46"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 215,
            index: 218,
            code: "SE",
            languages: [
                { code: "sv", name: "Swedish", nativeName: "svenska" },
            ],
        },
        CH: {
            name: "Switzerland",
            i18n: 'country_swi',
            nativeName: "Schweiz",
            callingCodes: [
                "41"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 216,
            index: 219,
            code: "CH",
            languages: [
                { code: "de", name: "German", nativeName: "Deutsch" },
                { code: "fr", name: "French", nativeName: "français" },
                { code: "it", name: "Italian", nativeName: "Italiano" }
            ],
        },
        SY: {
            name: "Syrian Arab Republic",
            i18n: 'country_syr',
            nativeName: "سوريا",
            callingCodes: [
                "963"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 217,
            index: 220,
            code: "SY",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        TW: {
            name: "Taiwan; Republic of China (ROC)",
            i18n: 'country_tai',
            nativeName: "臺灣",
            callingCodes: [
                "886"
            ],
            timeZones: [
                "UTC+08:00"
            ],
            id: 218,
            index: 221,
            code: "TW",
            languages: [
                { code: "zh", name: "Chinese", nativeName: "中文 (Zhōngwén)" }
            ],
        },
        TJ: {
            name: "Tajikistan",
            i18n: 'country_taj',
            nativeName: "Тоҷикистон",
            callingCodes: [
                "992"
            ],
            timeZones: [
                "UTC+05:00"
            ],
            id: 219,
            index: 222,
            code: "TJ",
            languages: [
                { code: "tg", name: "Tajik", nativeName: "тоҷикӣ" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        TZ: {
            name: "Tanzania",
            i18n: 'country_tan',
            nativeName: "Tanzania",
            callingCodes: [
                "255"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 220,
            index: 223,
            code: "TZ",
            languages: [
                { code: "sw", name: "Swahili", nativeName: "Kiswahili" },
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        TH: {
            name: "Thailand",
            i18n: 'country_tha',
            nativeName: "ประเทศไทย",
            callingCodes: [
                "66"
            ],
            timeZones: [
                "UTC+07:00"
            ],
            id: 221,
            index: 224,
            code: "TH",
            languages: [
                { code: "th", name: "Thai", nativeName: "ไทย" },
            ],
        },
        TL: {
            name: "Timor-Leste",
            i18n: 'country_eas',
            nativeName: "Timor-Leste",
            callingCodes: [
                "670"
            ],
            timeZones: [
                "UTC+09:00"
            ],
            id: 222,
            index: 225,
            code: "TL",
            languages: [
                { code: "pt", name: "Portuguese", nativeName: "Português" }
            ],
        },
        TG: {
            name: "Togo",
            i18n: 'country_tog',
            nativeName: "Togo",
            callingCodes: [
                "228"
            ],
            timeZones: [
                "UTC"
            ],
            id: 223,
            index: 226,
            code: "TG",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        TK: {
            name: "Tokelau",
            i18n: 'country_tk',
            nativeName: "Tokelau",
            callingCodes: [
                "690"
            ],
            timeZones: [
                "UTC+13:00"
            ],
            id: 224,
            index: 227,
            code: "TK",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        TO: {
            name: "Tonga",
            i18n: 'country_ton',
            nativeName: "Tonga",
            callingCodes: [
                "676"
            ],
            timeZones: [
                "UTC+13:00"
            ],
            id: 225,
            index: 228,
            code: "TO",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "to", name: "Tonga (Tonga Islands)", nativeName: "faka Tonga" }
            ],
        },
        TT: {
            name: "Trinidad and Tobago",
            i18n: 'country_tri',
            nativeName: "Trinidad and Tobago",
            callingCodes: [
                "1868"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 226,
            index: 229,
            code: "TT",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        TN: {
            name: "Tunisia",
            i18n: 'country_tun',
            nativeName: "تونس",
            callingCodes: [
                "216"
            ],
            timeZones: [
                "UTC+01:00"
            ],
            id: 227,
            index: 230,
            code: "TN",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        TR: {
            name: "Turkey",
            i18n: 'country_turke',
            nativeName: "Türkiye",
            callingCodes: [
                "90"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 228,
            index: 231,
            code: "TR",
            languages: [
                { code: "tr", name: "Turkish", nativeName: "Türkçe" }
            ],
        },
        TM: {
            name: "Turkmenistan",
            i18n: 'country_turkm',
            nativeName: "Türkmenistan",
            callingCodes: [
                "993"
            ],
            timeZones: [
                "UTC+05:00"
            ],
            id: 229,
            index: 232,
            code: "TM",
            languages: [
                { code: "tk", name: "Turkmen", nativeName: "Türkmen" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        TC: {
            name: "Turks and Caicos Islands",
            i18n: 'country_tc',
            nativeName: "Turks and Caicos Islands",
            callingCodes: [
                "1649"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 230,
            index: 233,
            code: "TC",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        TV: {
            name: "Tuvalu",
            i18n: 'country_tuv',
            nativeName: "Tuvalu",
            callingCodes: [
                "688"
            ],
            timeZones: [
                "UTC+12:00"
            ],
            id: 231,
            index: 234,
            code: "TV",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        UG: {
            name: "Uganda",
            i18n: 'country_uga',
            nativeName: "Uganda",
            callingCodes: [
                "256"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 232,
            index: 235,
            code: "UG",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "sw", name: "Swahili", nativeName: "Kiswahili" }
            ],
        },
        UA: {
            name: "Ukraine",
            i18n: 'country_ukr',
            nativeName: "Україна",
            callingCodes: [
                "380"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 233,
            index: 236,
            code: "UA",
            languages: [
                { code: "uk", name: "Ukrainian", nativeName: "Українська" }
            ],
        },
        AE: {
            name: "United Arab Emirates",
            i18n: 'country_uae',
            nativeName: "دولة الإمارات العربية المتحدة",
            callingCodes: [
                "971"
            ],
            timeZones: [
                "UTC+04"
            ],
            id: 234,
            index: 237,
            code: "AE",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        GB: {
            name: "United Kingdom",
            i18n: 'country_uki',
            nativeName: "United Kingdom",
            callingCodes: [
                "441481",
                "441624",
                "441534",
                "44",
            ],
            timeZones: [
                "UTC-08:00",
                "UTC-05:00",
                "UTC-04:00",
                "UTC-03:00",
                "UTC-02:00",
                "UTC",
                "UTC+01:00",
                "UTC+02:00",
                "UTC+06:00"
            ],
            id: 235,
            index: 238,
            code: "GB",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
            ],
            regions: [
                "England",
                "Scotland",
                "Wales",
                "Northern Ireland"
            ]
        },
        US: {
            name: "United States",
            i18n: 'country_ust',
            nativeName: "United States",
            callingCodes: [
                "1"
            ],
            timeZones: [
                "UTC-12:00",
                "UTC-11:00",
                "UTC-10:00",
                "UTC-09:00",
                "UTC-08:00",
                "UTC-07:00",
                "UTC-06:00",
                "UTC-05:00",
                "UTC-04:00",
                "UTC+10:00",
                "UTC+12:00"
            ],
            id: 236,
            index: 239,
            code: "US",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
            regions: [
                "Alabama",
                "Alaska",
                "Arizona",
                "Arkansas",
                "California",
                "Colorado",
                "Connecticut",
                "Delaware",
                "Florida",
                "Georgia",
                "Hawaii",
                "Idaho",
                "Illinois",
                "Indiana",
                "Iowa",
                "Kansas",
                "Kentucky",
                "Louisiana",
                "Maine",
                "Maryland",
                "Massachusetts",
                "Michigan",
                "Minnesota",
                "Mississippi",
                "Missouri",
                "Montana",
                "Nebraska",
                "Nevada",
                "New Hampshire",
                "New Jersey",
                "New Mexico",
                "New York",
                "North Carolina",
                "North Dakota",
                "Ohio",
                "Oklahoma",
                "Oregon",
                "Pennsylvania",
                "Rhode Island",
                "South Carolina",
                "South Dakota",
                "Tennessee",
                "Texas",
                "Utah",
                "Vermont",
                "Virginia",
                "Washington",
                "Washington D.C.",
                "West Virginia",
                "Wisconsin",
                "Wyoming"
            ],
        },
        UY: {
            name: "Uruguay",
            i18n: 'country_uru',
            nativeName: "Uruguay",
            callingCodes: [
                "598"
            ],
            timeZones: [
                "UTC-03:00"
            ],
            id: 238,
            index: 240,
            code: "UY",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        UZ: {
            name: "Uzbekistan",
            i18n: 'country_uzb',
            nativeName: "O‘zbekiston",
            callingCodes: [
                "998"
            ],
            timeZones: [
                "UTC+05:00"
            ],
            id: 239,
            index: 241,
            code: "UZ",
            languages: [
                { code: "uz", name: "Uzbek", nativeName: "Oʻzbek" },
                { code: "ru", name: "Russian", nativeName: "Русский" }
            ],
        },
        VU: {
            name: "Vanuatu",
            i18n: 'country_van',
            nativeName: "Vanuatu",
            callingCodes: [
                "678"
            ],
            timeZones: [
                "UTC+11:00"
            ],
            id: 240,
            index: 242,
            code: "VU",
            languages: [
                { code: "bi", name: "Bislama", nativeName: "Bislama" },
                { code: "en", name: "English", nativeName: "English" },
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        VE: {
            name: "Venezuela",
            i18n: 'country_ven',
            nativeName: "Venezuela",
            callingCodes: [
                "58"
            ],
            timeZones: [
                "UTC-04:00"
            ],
            id: 241,
            index: 243,
            code: "VE",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        VN: {
            name: "Vietnam",
            i18n: 'country_vie',
            nativeName: "Việt Nam",
            callingCodes: [
                "84"
            ],
            timeZones: [
                "UTC+07:00"
            ],
            id: 242,
            index: 244,
            code: "VN",
            languages: [
                { code: "vi", name: "Vietnamese", nativeName: "Tiếng Việt" },
            ],
        },
        WF: {
            name: "Wallis and Futuna Islands",
            i18n: 'country_wf',
            nativeName: "Wallis et Futuna",
            callingCodes: [
                "681"
            ],
            timeZones: [
                "UTC+12:00"
            ],
            id: 245,
            index: 245,
            code: "WF",
            languages: [
                { code: "fr", name: "French", nativeName: "français" }
            ],
        },
        EH: {
            name: "Western Sahara",
            i18n: 'country_eh',
            nativeName: "الصحراء الغربية",
            callingCodes: [
                "212"
            ],
            timeZones: [
                "UTC+00:00"
            ],
            id: 246,
            index: 246,
            code: "EH",
            languages: [
                { code: "es", name: "Spanish", nativeName: "Español" }
            ],
        },
        YE: {
            name: "Yemen",
            i18n: 'country_yem',
            nativeName: "اليَمَن",
            callingCodes: [
                "967"
            ],
            timeZones: [
                "UTC+03:00"
            ],
            id: 247,
            index: 247,
            code: "YE",
            languages: [
                { code: "ar", name: "Arabic", nativeName: "العربية" }
            ],
        },
        ZM: {
            name: "Zambia",
            i18n: 'country_zam',
            nativeName: "Zambia",
            callingCodes: [
                "260"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 248,
            index: 248,
            code: "ZM",
            languages: [
                { code: "en", name: "English", nativeName: "English" }
            ],
        },
        ZW: {
            name: "Zimbabwe",
            i18n: 'country_zim',
            nativeName: "Zimbabwe",
            callingCodes: [
                "263"
            ],
            timeZones: [
                "UTC+02:00"
            ],
            id: 249,
            index: 249,
            code: "ZW",
            languages: [
                { code: "en", name: "English", nativeName: "English" },
                { code: "sn", name: "Shona", nativeName: "chiShona" },
                { code: "nd", name: "Northern Ndebele", nativeName: "isiNdebele" }
            ],
        }
    };
    return GeolocationService;
}());
var PhoneUtils = (function () {
    function PhoneUtils(geolocation) {
        this.geolocation = geolocation;
    }
    PhoneUtils.prototype.parsePhoneNumber = function (phoneNumber) {
        var result = {
            areaCode: null,
            countryISOCodes: null,
            localPhoneNumber: null,
        }, matches;
        phoneNumber = String(phoneNumber || '').replace(/[ \-\.]/g, '');
        if (!phoneNumber) {
            return null;
        }
        matches = this.geolocation.getCountryCodeRegExp().exec(phoneNumber);
        if (matches) {
            result.areaCode = matches[0];
            phoneNumber = phoneNumber.slice(matches[0].length);
            result.countryISOCodes = this.geolocation.getCountryCodesByCallingArea(result.areaCode);
        }
        result.localPhoneNumber = phoneNumber;
        return result.localPhoneNumber
            ? result
            : null;
    };
    return PhoneUtils;
}());
var KeyboardUtils = (function () {
    function KeyboardUtils() {
    }
    KeyboardUtils.KEY_0 = 48;
    KeyboardUtils.KEY_1 = 49;
    KeyboardUtils.KEY_2 = 50;
    KeyboardUtils.KEY_3 = 51;
    KeyboardUtils.KEY_4 = 52;
    KeyboardUtils.KEY_5 = 53;
    KeyboardUtils.KEY_6 = 54;
    KeyboardUtils.KEY_7 = 55;
    KeyboardUtils.KEY_8 = 56;
    KeyboardUtils.KEY_9 = 57;
    KeyboardUtils.KEY_PAD_0 = 96;
    KeyboardUtils.KEY_PAD_1 = 97;
    KeyboardUtils.KEY_PAD_2 = 98;
    KeyboardUtils.KEY_PAD_3 = 99;
    KeyboardUtils.KEY_PAD_4 = 100;
    KeyboardUtils.KEY_PAD_5 = 101;
    KeyboardUtils.KEY_PAD_6 = 102;
    KeyboardUtils.KEY_PAD_7 = 103;
    KeyboardUtils.KEY_PAD_8 = 104;
    KeyboardUtils.KEY_PAD_9 = 105;
    KeyboardUtils.KEY_DOT = 190;
    KeyboardUtils.KEY_PAD_DOT = 110;
    KeyboardUtils.KEY_BACKSPACE = 8;
    KeyboardUtils.KEY_DELETE = 46;
    KeyboardUtils.KEY_LEFT = 37;
    KeyboardUtils.KEY_RIGHT = 39;
    KeyboardUtils.KEY_UP = 38;
    KeyboardUtils.KEY_DOWN = 40;
    KeyboardUtils.KEY_SPACE = 32;
    KeyboardUtils.KEY_HOME = 36;
    KeyboardUtils.KEY_END = 35;
    KeyboardUtils.KEY_TAB = 9;
    KeyboardUtils.KEY_ENTER = 13;
    KeyboardUtils.KEY_ESC = 27;
    return KeyboardUtils;
}());
var StringUtils = (function () {
    function StringUtils() {
    }
    StringUtils.init = function () {
        if (null === this.diacriticsMap) {
            this.diacriticsMap = {};
            for (var i = 0; i < this.replacementList.length; i += 1) {
                var chars = this.replacementList[i].chars;
                for (var j = 0; j < chars.length; j += 1) {
                    this.diacriticsMap[chars[j]] = this.replacementList[i].base;
                }
            }
        }
    };
    StringUtils.removeDiacritics = function (str) {
        var _this = this;
        this.init();
        return str.replace(/[^\u0000-\u007e]/g, function (c) {
            return _this.diacriticsMap[c] || c;
        });
    };
    StringUtils.getDOMWidth = function (str) {
        try {
            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');
            context.font = '14px Open sans';
            return Math.round(context.measureText(str).width);
        }
        catch (e) {
        }
    };
    StringUtils.diacriticsMap = null;
    StringUtils.replacementList = [
        {
            base: ' ',
            chars: "\u00A0",
        }, {
            base: '0',
            chars: "\u07C0",
        }, {
            base: 'A',
            chars: "\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F",
        }, {
            base: 'AA',
            chars: "\uA732",
        }, {
            base: 'AE',
            chars: "\u00C6\u01FC\u01E2",
        }, {
            base: 'AO',
            chars: "\uA734",
        }, {
            base: 'AU',
            chars: "\uA736",
        }, {
            base: 'AV',
            chars: "\uA738\uA73A",
        }, {
            base: 'AY',
            chars: "\uA73C",
        }, {
            base: 'B',
            chars: "\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0181",
        }, {
            base: 'C',
            chars: "\u24b8\uff23\uA73E\u1E08\u0106\u0043\u0108\u010A\u010C\u00C7\u0187\u023B",
        }, {
            base: 'D',
            chars: "\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018A\u0189\u1D05\uA779",
        }, {
            base: 'Dh',
            chars: "\u00D0",
        }, {
            base: 'DZ',
            chars: "\u01F1\u01C4",
        }, {
            base: 'Dz',
            chars: "\u01F2\u01C5",
        }, {
            base: 'E',
            chars: "\u025B\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E\u1D07",
        }, {
            base: 'F',
            chars: "\uA77C\u24BB\uFF26\u1E1E\u0191\uA77B",
        }, {
            base: 'G',
            chars: "\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E\u0262",
        }, {
            base: 'H',
            chars: "\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D",
        }, {
            base: 'I',
            chars: "\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197",
        }, {
            base: 'J',
            chars: "\u24BF\uFF2A\u0134\u0248\u0237",
        }, {
            base: 'K',
            chars: "\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2",
        }, {
            base: 'L',
            chars: "\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780",
        }, {
            base: 'LJ',
            chars: "\u01C7",
        }, {
            base: 'Lj',
            chars: "\u01C8",
        }, {
            base: 'M',
            chars: "\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C\u03FB",
        }, {
            base: 'N',
            chars: "\uA7A4\u0220\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u019D\uA790\u1D0E",
        }, {
            base: 'NJ',
            chars: "\u01CA",
        }, {
            base: 'Nj',
            chars: "\u01CB",
        }, {
            base: 'O',
            chars: "\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C",
        }, {
            base: 'OE',
            chars: "\u0152",
        }, {
            base: 'OI',
            chars: "\u01A2",
        }, {
            base: 'OO',
            chars: "\uA74E",
        }, {
            base: 'OU',
            chars: "\u0222",
        }, {
            base: 'P',
            chars: "\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754",
        }, {
            base: 'Q',
            chars: "\u24C6\uFF31\uA756\uA758\u024A",
        }, {
            base: 'R',
            chars: "\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782",
        }, {
            base: 'S',
            chars: "\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784",
        }, {
            base: 'T',
            chars: "\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786",
        }, {
            base: 'Th',
            chars: "\u00DE",
        }, {
            base: 'TZ',
            chars: "\uA728",
        }, {
            base: 'U',
            chars: "\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244",
        }, {
            base: 'V',
            chars: "\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245",
        }, {
            base: 'VY',
            chars: "\uA760",
        }, {
            base: 'W',
            chars: "\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72",
        }, {
            base: 'X',
            chars: "\u24CD\uFF38\u1E8A\u1E8C",
        }, {
            base: 'Y',
            chars: "\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE",
        }, {
            base: 'Z',
            chars: "\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762",
        }, {
            base: 'a',
            chars: "\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250\u0251",
        }, {
            base: 'aa',
            chars: "\uA733",
        }, {
            base: 'ae',
            chars: "\u00E6\u01FD\u01E3",
        }, {
            base: 'ao',
            chars: "\uA735",
        }, {
            base: 'au',
            chars: "\uA737",
        }, {
            base: 'av',
            chars: "\uA739\uA73B",
        }, {
            base: 'ay',
            chars: "\uA73D",
        }, {
            base: 'b',
            chars: "\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253\u0182",
        }, {
            base: 'c',
            chars: "\uFF43\u24D2\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184",
        }, {
            base: 'd',
            chars: "\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\u018B\u13E7\u0501\uA7AA",
        }, {
            base: 'dh',
            chars: "\u00F0",
        }, {
            base: 'dz',
            chars: "\u01F3\u01C6",
        }, {
            base: 'e',
            chars: "\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u01DD",
        }, {
            base: 'f',
            chars: "\u24D5\uFF46\u1E1F\u0192",
        }, {
            base: 'ff',
            chars: "\uFB00",
        }, {
            base: 'fi',
            chars: "\uFB01",
        }, {
            base: 'fl',
            chars: "\uFB02",
        }, {
            base: 'ffi',
            chars: "\uFB03",
        }, {
            base: 'ffl',
            chars: "\uFB04",
        }, {
            base: 'g',
            chars: "\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\uA77F\u1D79",
        }, {
            base: 'h',
            chars: "\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265",
        }, {
            base: 'hv',
            chars: "\u0195",
        }, {
            base: 'i',
            chars: "\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131",
        }, {
            base: 'j',
            chars: "\u24D9\uFF4A\u0135\u01F0\u0249",
        }, {
            base: 'k',
            chars: "\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3",
        }, {
            base: 'l',
            chars: "\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747\u026D",
        }, {
            base: 'lj',
            chars: "\u01C9",
        }, {
            base: 'm',
            chars: "\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F",
        }, {
            base: 'n',
            chars: "\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u043B\u0509",
        }, {
            base: 'nj',
            chars: "\u01CC",
        }, {
            base: 'o',
            chars: "\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\uA74B\uA74D\u0275\u0254\u1D11",
        }, {
            base: 'oe',
            chars: "\u0153",
        }, {
            base: 'oi',
            chars: "\u01A3",
        }, {
            base: 'oo',
            chars: "\uA74F",
        }, {
            base: 'ou',
            chars: "\u0223",
        }, {
            base: 'p',
            chars: "\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755\u03C1",
        }, {
            base: 'q',
            chars: "\u24E0\uFF51\u024B\uA757\uA759",
        }, {
            base: 'r',
            chars: "\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783",
        }, {
            base: 's',
            chars: "\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u0282",
        }, {
            base: 'ss',
            chars: "\xDF",
        }, {
            base: 't',
            chars: "\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787",
        }, {
            base: 'th',
            chars: "\u00FE",
        }, {
            base: 'tz',
            chars: "\uA729",
        }, {
            base: 'u',
            chars: "\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289",
        }, {
            base: 'v',
            chars: "\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C",
        }, {
            base: 'vy',
            chars: "\uA761",
        }, {
            base: 'w',
            chars: "\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73",
        }, {
            base: 'x',
            chars: "\u24E7\uFF58\u1E8B\u1E8D",
        }, {
            base: 'y',
            chars: "\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF",
        }, {
            base: 'z',
            chars: "\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763",
        }
    ];
    return StringUtils;
}());
var ElementPosition = (function () {
    function ElementPosition() {
    }
    ElementPosition.canAnchorElementToTargetBottomRight = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect();
        return (target.right + atDistance + element.width <= winRect.width) && (target.top + element.height <= window.innerHeight);
    };
    ElementPosition.canAnchorElementToTargetTopRight = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect();
        return (target.right + atDistance + element.width <= winRect.width) && (target.top - element.height >= 0);
    };
    ElementPosition.canAnchorElementToTargetTopLeft = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect();
        return (target.left - atDistance + element.width >= 0) && (target.bottom - element.height >= 0);
    };
    ElementPosition.canAnchorElementToTargetBottomLeft = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect();
        return (target.left - atDistance + element.width >= 0) && (target.top + element.height <= window.innerHeight);
    };
    ElementPosition.canAnchorElementToTargetCenterTop = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect();
        return (target.left + (target.width / 2) - (element.width / 2) >= 0) && (target.top - atDistance - element.height >= 0);
    };
    ElementPosition.canAnchorElementToTargetCenterBottom = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect(), scrollTop = window.scrollY || 0;
        return (target.left + (target.width / 2) - (element.width / 2) >= 0) && (target.bottom + atDistance + scrollTop + element.height <= window.innerHeight);
    };
    ElementPosition.canAnchorElementToTargetCenterLeft = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect();
        return (target.left - atDistance - element.width >= 0) && (target.top + (target.height / 2) - element.height >= 0);
    };
    ElementPosition.canAnchorElementToTargetCenterRight = function (target, element, atDistance) {
        if (atDistance === void 0) { atDistance = 0; }
        var winRect = document.body.getBoundingClientRect();
        return (target.right + atDistance + element.width <= winRect.width) && (target.top + (target.height / 2) - element.height >= 0);
    };
    ElementPosition.getAnchorPosition = function (target, element, atDistance, modes) {
        if (atDistance === void 0) { atDistance = 0; }
        for (var i = 0, len = modes.length; i < len; i++) {
            switch (modes[i]) {
                case 'center-top':
                    if (ElementPosition.canAnchorElementToTargetCenterTop(target, element, atDistance)) {
                        return {
                            left: target.left + (target.width / 2) - (element.width / 2),
                            top: target.top - element.height - atDistance,
                            mode: 'center-top'
                        };
                    }
                    break;
                case 'center-bottom':
                    if (ElementPosition.canAnchorElementToTargetCenterBottom(target, element, atDistance)) {
                        return {
                            left: target.left + (target.width / 2) - (element.width / 2),
                            top: target.bottom + atDistance,
                            mode: 'center-bottom'
                        };
                    }
                    break;
                case 'center-right':
                    if (ElementPosition.canAnchorElementToTargetCenterRight(target, element, atDistance)) {
                        return {
                            left: target.right + atDistance,
                            top: target.top + (target.height / 2) - (element.height / 2),
                            mode: 'center-right'
                        };
                    }
                    break;
                case 'center-left':
                    if (ElementPosition.canAnchorElementToTargetCenterLeft(target, element, atDistance)) {
                        return {
                            left: target.left - atDistance - element.width,
                            top: target.top + (target.height / 2) - (element.height / 2),
                            mode: 'center-left'
                        };
                    }
                    break;
                default:
                    throw new Error('Positioning mode ' + JSON.stringify(modes[i]) + ' is not implemented');
            }
        }
        switch (modes[0]) {
            case 'center-top':
                return {
                    left: target.left + (target.width / 2) - (element.width / 2),
                    top: target.top - element.height - atDistance,
                    mode: 'center-top'
                };
            case 'center-bottom':
                return {
                    left: target.left + (target.width / 2) - (element.width / 2),
                    top: target.bottom + atDistance,
                    mode: 'center-bottom'
                };
            case 'center-right':
                return {
                    left: target.right + atDistance,
                    top: target.top + (target.height / 2) - (element.height / 2),
                    mode: 'center-right'
                };
            case 'center-left':
                return {
                    left: target.left - atDistance - element.width,
                    top: target.top + (target.height / 2) - (element.height / 2),
                    mode: 'center-left'
                };
            default:
                throw new Error('Positioning mode ' + JSON.stringify(modes[i]) + ' is not implemented');
        }
    };
    return ElementPosition;
}());
var CurrencyService = (function () {
    function CurrencyService(i18n) {
        this.i18n = i18n;
    }
    CurrencyService.share = function (i18n) {
        if (undefined !== CurrencyService.instance) {
            return CurrencyService.instance;
        }
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_USD] = CurrencyService.CURRENCY_USD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_EUR] = CurrencyService.CURRENCY_EUR;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_GBP] = CurrencyService.CURRENCY_GBP;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_AUD] = CurrencyService.CURRENCY_AUD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_JPY] = CurrencyService.CURRENCY_JPY;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_CAD] = CurrencyService.CURRENCY_CAD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_NZD] = CurrencyService.CURRENCY_NZD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_HKD] = CurrencyService.CURRENCY_HKD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_SGD] = CurrencyService.CURRENCY_SGD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_MXN] = CurrencyService.CURRENCY_MXN;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_DKK] = CurrencyService.CURRENCY_DKK;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_NOK] = CurrencyService.CURRENCY_NOK;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_MYR] = CurrencyService.CURRENCY_MYR;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_TWD] = CurrencyService.CURRENCY_TWD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_THB] = CurrencyService.CURRENCY_THB;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_ILS] = CurrencyService.CURRENCY_ILS;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_CHF] = CurrencyService.CURRENCY_CHF;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_BRL] = CurrencyService.CURRENCY_BRL;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_RON] = CurrencyService.CURRENCY_RON;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_PGK] = CurrencyService.CURRENCY_PGK;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_INR] = CurrencyService.CURRENCY_INR;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_MUR] = CurrencyService.CURRENCY_MUR;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_CZK] = CurrencyService.CURRENCY_CZK;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_DOP] = CurrencyService.CURRENCY_DOP;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_ZAR] = CurrencyService.CURRENCY_ZAR;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_TRY] = CurrencyService.CURRENCY_TRY;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_SEK] = CurrencyService.CURRENCY_SEK;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_PLN] = CurrencyService.CURRENCY_PLN;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_PHP] = CurrencyService.CURRENCY_PHP;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_AED] = CurrencyService.CURRENCY_AED;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_ARS] = CurrencyService.CURRENCY_ARS;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_RUB] = CurrencyService.CURRENCY_RUB;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_XCD] = CurrencyService.CURRENCY_XCD;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_BGN] = CurrencyService.CURRENCY_BGN;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_HUF] = CurrencyService.CURRENCY_HUF;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_COP] = CurrencyService.CURRENCY_COP;
        CurrencyService.$ISO_CODE_TO_ID[CurrencyService.CURRENCY_CODE_CNY] = CurrencyService.CURRENCY_CNY;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_USD] = CurrencyService.CURRENCY_FULL_NAME_USD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_EUR] = CurrencyService.CURRENCY_FULL_NAME_EUR;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_GBP] = CurrencyService.CURRENCY_FULL_NAME_GBP;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_AUD] = CurrencyService.CURRENCY_FULL_NAME_AUD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_JPY] = CurrencyService.CURRENCY_FULL_NAME_JPY;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_CAD] = CurrencyService.CURRENCY_FULL_NAME_CAD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_NZD] = CurrencyService.CURRENCY_FULL_NAME_NZD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_HKD] = CurrencyService.CURRENCY_FULL_NAME_HKD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_SGD] = CurrencyService.CURRENCY_FULL_NAME_SGD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_MXN] = CurrencyService.CURRENCY_FULL_NAME_MXN;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_DKK] = CurrencyService.CURRENCY_FULL_NAME_DKK;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_NOK] = CurrencyService.CURRENCY_FULL_NAME_NOK;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_MYR] = CurrencyService.CURRENCY_FULL_NAME_MYR;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_TWD] = CurrencyService.CURRENCY_FULL_NAME_TWD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_THB] = CurrencyService.CURRENCY_FULL_NAME_THB;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_ILS] = CurrencyService.CURRENCY_FULL_NAME_ILS;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_CHF] = CurrencyService.CURRENCY_FULL_NAME_CHF;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_BRL] = CurrencyService.CURRENCY_FULL_NAME_BRL;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_RON] = CurrencyService.CURRENCY_FULL_NAME_RON;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_PGK] = CurrencyService.CURRENCY_FULL_NAME_PGK;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_INR] = CurrencyService.CURRENCY_FULL_NAME_INR;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_MUR] = CurrencyService.CURRENCY_FULL_NAME_MUR;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_CZK] = CurrencyService.CURRENCY_FULL_NAME_CZK;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_DOP] = CurrencyService.CURRENCY_FULL_NAME_DOP;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_ZAR] = CurrencyService.CURRENCY_FULL_NAME_ZAR;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_TRY] = CurrencyService.CURRENCY_FULL_NAME_TRY;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_SEK] = CurrencyService.CURRENCY_FULL_NAME_SEK;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_PLN] = CurrencyService.CURRENCY_FULL_NAME_PLN;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_PHP] = CurrencyService.CURRENCY_FULL_NAME_PHP;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_AED] = CurrencyService.CURRENCY_FULL_NAME_AED;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_ARS] = CurrencyService.CURRENCY_FULL_NAME_ARS;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_RUB] = CurrencyService.CURRENCY_FULL_NAME_RUB;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_XCD] = CurrencyService.CURRENCY_FULL_NAME_XCD;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_BGN] = CurrencyService.CURRENCY_FULL_NAME_BGN;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_HUF] = CurrencyService.CURRENCY_FULL_NAME_HUF;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_COP] = CurrencyService.CURRENCY_FULL_NAME_COP;
        CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.CURRENCY_CODE_CNY] = CurrencyService.CURRENCY_FULL_NAME_CNY;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_USD] = CurrencyService.CURRENCY_CODE_USD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_EUR] = CurrencyService.CURRENCY_CODE_EUR;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_GBP] = CurrencyService.CURRENCY_CODE_GBP;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_AUD] = CurrencyService.CURRENCY_CODE_AUD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_JPY] = CurrencyService.CURRENCY_CODE_JPY;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_CAD] = CurrencyService.CURRENCY_CODE_CAD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_NZD] = CurrencyService.CURRENCY_CODE_NZD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_HKD] = CurrencyService.CURRENCY_CODE_HKD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_SGD] = CurrencyService.CURRENCY_CODE_SGD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_MXN] = CurrencyService.CURRENCY_CODE_MXN;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_DKK] = CurrencyService.CURRENCY_CODE_DKK;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_NOK] = CurrencyService.CURRENCY_CODE_NOK;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_MYR] = CurrencyService.CURRENCY_CODE_MYR;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_TWD] = CurrencyService.CURRENCY_CODE_TWD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_THB] = CurrencyService.CURRENCY_CODE_THB;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_ILS] = CurrencyService.CURRENCY_CODE_ILS;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_CHF] = CurrencyService.CURRENCY_CODE_CHF;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_BRL] = CurrencyService.CURRENCY_CODE_BRL;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_RON] = CurrencyService.CURRENCY_CODE_RON;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_PGK] = CurrencyService.CURRENCY_CODE_PGK;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_INR] = CurrencyService.CURRENCY_CODE_INR;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_MUR] = CurrencyService.CURRENCY_CODE_MUR;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_CZK] = CurrencyService.CURRENCY_CODE_CZK;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_DOP] = CurrencyService.CURRENCY_CODE_DOP;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_ZAR] = CurrencyService.CURRENCY_CODE_ZAR;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_TRY] = CurrencyService.CURRENCY_CODE_TRY;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_SEK] = CurrencyService.CURRENCY_CODE_SEK;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_PLN] = CurrencyService.CURRENCY_CODE_PLN;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_PHP] = CurrencyService.CURRENCY_CODE_PHP;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_AED] = CurrencyService.CURRENCY_CODE_AED;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_ARS] = CurrencyService.CURRENCY_CODE_ARS;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_RUB] = CurrencyService.CURRENCY_CODE_RUB;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_XCD] = CurrencyService.CURRENCY_CODE_XCD;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_BGN] = CurrencyService.CURRENCY_CODE_BGN;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_HUF] = CurrencyService.CURRENCY_CODE_HUF;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_COP] = CurrencyService.CURRENCY_CODE_COP;
        CurrencyService.$ID_TO_ISO_CODE[CurrencyService.CURRENCY_CNY] = CurrencyService.CURRENCY_CODE_CNY;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_USD] = CurrencyService.CURRENCY_NAME_I18N_USD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_EUR] = CurrencyService.CURRENCY_NAME_I18N_EUR;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_GBP] = CurrencyService.CURRENCY_NAME_I18N_GBP;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_AUD] = CurrencyService.CURRENCY_NAME_I18N_AUD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_JPY] = CurrencyService.CURRENCY_NAME_I18N_JPY;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_CAD] = CurrencyService.CURRENCY_NAME_I18N_CAD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_NZD] = CurrencyService.CURRENCY_NAME_I18N_NZD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_HKD] = CurrencyService.CURRENCY_NAME_I18N_HKD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_SGD] = CurrencyService.CURRENCY_NAME_I18N_SGD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_MXN] = CurrencyService.CURRENCY_NAME_I18N_MXN;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_DKK] = CurrencyService.CURRENCY_NAME_I18N_DKK;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_NOK] = CurrencyService.CURRENCY_NAME_I18N_NOK;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_MYR] = CurrencyService.CURRENCY_NAME_I18N_MYR;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_TWD] = CurrencyService.CURRENCY_NAME_I18N_TWD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_THB] = CurrencyService.CURRENCY_NAME_I18N_THB;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_ILS] = CurrencyService.CURRENCY_NAME_I18N_ILS;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_CHF] = CurrencyService.CURRENCY_NAME_I18N_CHF;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_BRL] = CurrencyService.CURRENCY_NAME_I18N_BRL;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_RON] = CurrencyService.CURRENCY_NAME_I18N_RON;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_PGK] = CurrencyService.CURRENCY_NAME_I18N_PGK;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_INR] = CurrencyService.CURRENCY_NAME_I18N_INR;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_MUR] = CurrencyService.CURRENCY_NAME_I18N_MUR;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_CZK] = CurrencyService.CURRENCY_NAME_I18N_CZK;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_DOP] = CurrencyService.CURRENCY_NAME_I18N_DOP;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_ZAR] = CurrencyService.CURRENCY_NAME_I18N_ZAR;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_TRY] = CurrencyService.CURRENCY_NAME_I18N_TRY;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_SEK] = CurrencyService.CURRENCY_NAME_I18N_SEK;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_PLN] = CurrencyService.CURRENCY_NAME_I18N_PLN;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_PHP] = CurrencyService.CURRENCY_NAME_I18N_PHP;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_AED] = CurrencyService.CURRENCY_NAME_I18N_AED;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_ARS] = CurrencyService.CURRENCY_NAME_I18N_ARS;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_RUB] = CurrencyService.CURRENCY_NAME_I18N_RUB;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_XCD] = CurrencyService.CURRENCY_NAME_I18N_XCD;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_BGN] = CurrencyService.CURRENCY_NAME_I18N_BGN;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_HUF] = CurrencyService.CURRENCY_NAME_I18N_HUF;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_COP] = CurrencyService.CURRENCY_NAME_I18N_COP;
        CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.CURRENCY_CODE_CNY] = CurrencyService.CURRENCY_NAME_I18N_CNY;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_USD] = CurrencyService.CURRENCY_SYMBOL_USD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_EUR] = CurrencyService.CURRENCY_SYMBOL_EUR;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_GBP] = CurrencyService.CURRENCY_SYMBOL_GBP;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_AUD] = CurrencyService.CURRENCY_SYMBOL_AUD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_JPY] = CurrencyService.CURRENCY_SYMBOL_JPY;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_CAD] = CurrencyService.CURRENCY_SYMBOL_CAD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_NZD] = CurrencyService.CURRENCY_SYMBOL_NZD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_HKD] = CurrencyService.CURRENCY_SYMBOL_HKD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_SGD] = CurrencyService.CURRENCY_SYMBOL_SGD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_MXN] = CurrencyService.CURRENCY_SYMBOL_MXN;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_DKK] = CurrencyService.CURRENCY_SYMBOL_DKK;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_NOK] = CurrencyService.CURRENCY_SYMBOL_NOK;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_MYR] = CurrencyService.CURRENCY_SYMBOL_MYR;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_TWD] = CurrencyService.CURRENCY_SYMBOL_TWD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_THB] = CurrencyService.CURRENCY_SYMBOL_THB;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_ILS] = CurrencyService.CURRENCY_SYMBOL_ILS;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_CHF] = CurrencyService.CURRENCY_SYMBOL_CHF;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_BRL] = CurrencyService.CURRENCY_SYMBOL_BRL;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_RON] = CurrencyService.CURRENCY_SYMBOL_RON;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_PGK] = CurrencyService.CURRENCY_SYMBOL_PGK;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_INR] = CurrencyService.CURRENCY_SYMBOL_INR;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_MUR] = CurrencyService.CURRENCY_SYMBOL_MUR;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_CZK] = CurrencyService.CURRENCY_SYMBOL_CZK;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_DOP] = CurrencyService.CURRENCY_SYMBOL_DOP;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_ZAR] = CurrencyService.CURRENCY_SYMBOL_ZAR;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_TRY] = CurrencyService.CURRENCY_SYMBOL_TRY;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_SEK] = CurrencyService.CURRENCY_SYMBOL_SEK;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_PLN] = CurrencyService.CURRENCY_SYMBOL_PLN;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_PHP] = CurrencyService.CURRENCY_SYMBOL_PHP;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_AED] = CurrencyService.CURRENCY_SYMBOL_AED;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_ARS] = CurrencyService.CURRENCY_SYMBOL_ARS;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_RUB] = CurrencyService.CURRENCY_SYMBOL_RUB;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_XCD] = CurrencyService.CURRENCY_SYMBOL_XCD;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_BGN] = CurrencyService.CURRENCY_SYMBOL_BGN;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_HUF] = CurrencyService.CURRENCY_SYMBOL_HUF;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_COP] = CurrencyService.CURRENCY_SYMBOL_COP;
        CurrencyService.$ID_TO_SYMBOL[CurrencyService.CURRENCY_CNY] = CurrencyService.CURRENCY_SYMBOL_CNY;
        CurrencyService.instance = new CurrencyService(i18n);
        return CurrencyService.instance;
    };
    CurrencyService.prototype.getCurrencyById = function (id) {
        if (CurrencyService.$ID_TO_ISO_CODE[id]) {
            if (CurrencyService.$SUPPORTED_CURRENCIES.indexOf(CurrencyService.$ID_TO_ISO_CODE[id]) === -1) {
                return null;
            }
            return {
                id: id,
                isoCode: CurrencyService.$ID_TO_ISO_CODE[id],
                name: CurrencyService.$ISO_CODE_TO_FULL_NAME[CurrencyService.$ID_TO_ISO_CODE[id]],
                isOther: false,
                i18n: CurrencyService.$ISO_CODE_TO_NAME_I18N[CurrencyService.$ID_TO_ISO_CODE[id]],
                symbol: CurrencyService.$ID_TO_SYMBOL[id]
            };
        }
        return null;
    };
    CurrencyService.prototype.getCurrencyByCode = function (isoCode) {
        var isoCodeUpper = String(isoCode || '').toUpperCase();
        if (CurrencyService.$SUPPORTED_CURRENCIES.indexOf(isoCodeUpper) > -1) {
            var id = null;
            for (var k in CurrencyService.$ID_TO_ISO_CODE) {
                if (CurrencyService.$ID_TO_ISO_CODE.hasOwnProperty(k) && CurrencyService.$ID_TO_ISO_CODE[k] === isoCodeUpper) {
                    id = parseInt(k);
                    break;
                }
            }
            if (null === id) {
                return null;
            }
            return {
                id: id,
                isoCode: isoCodeUpper,
                name: CurrencyService.$ISO_CODE_TO_FULL_NAME[isoCodeUpper],
                isOther: false,
                i18n: CurrencyService.$ISO_CODE_TO_NAME_I18N[isoCodeUpper],
                symbol: CurrencyService.$ID_TO_SYMBOL[id]
            };
        }
        return null;
    };
    CurrencyService.prototype.enumerateCurrencies = function () {
        if (undefined !== this.cache) {
            return JSON.parse(JSON.stringify(this.cache));
        }
        this.cache = [];
        for (var i = 0, len = CurrencyService.$SUPPORTED_CURRENCIES.length; i < len; i++) {
            this.cache.push(this.getCurrencyByCode(CurrencyService.$SUPPORTED_CURRENCIES[i]));
        }
        return JSON.parse(JSON.stringify(this.cache));
    };
    CurrencyService.prototype.getCurrencySymbolById = function (id) {
        var currency = this.getCurrencyById(id);
        if (!currency) {
            return '';
        }
        return currency.symbol;
    };
    CurrencyService.CURRENCY_CODE_USD = "USD";
    CurrencyService.CURRENCY_CODE_EUR = "EUR";
    CurrencyService.CURRENCY_CODE_GBP = "GBP";
    CurrencyService.CURRENCY_CODE_AUD = "AUD";
    CurrencyService.CURRENCY_CODE_JPY = "JPY";
    CurrencyService.CURRENCY_CODE_CAD = "CAD";
    CurrencyService.CURRENCY_CODE_NZD = "NZD";
    CurrencyService.CURRENCY_CODE_HKD = "HKD";
    CurrencyService.CURRENCY_CODE_SGD = "SGD";
    CurrencyService.CURRENCY_CODE_MXN = "MXN";
    CurrencyService.CURRENCY_CODE_DKK = "DKK";
    CurrencyService.CURRENCY_CODE_NOK = "NOK";
    CurrencyService.CURRENCY_CODE_MYR = "MYR";
    CurrencyService.CURRENCY_CODE_TWD = "TWD";
    CurrencyService.CURRENCY_CODE_THB = "THB";
    CurrencyService.CURRENCY_CODE_ILS = "ILS";
    CurrencyService.CURRENCY_CODE_CHF = "CHF";
    CurrencyService.CURRENCY_CODE_BRL = "BRL";
    CurrencyService.CURRENCY_CODE_RON = "RON";
    CurrencyService.CURRENCY_CODE_PGK = "PGK";
    CurrencyService.CURRENCY_CODE_INR = "INR";
    CurrencyService.CURRENCY_CODE_MUR = "MUR";
    CurrencyService.CURRENCY_CODE_CZK = "CZK";
    CurrencyService.CURRENCY_CODE_DOP = "DOP";
    CurrencyService.CURRENCY_CODE_ZAR = "ZAR";
    CurrencyService.CURRENCY_CODE_SEK = "SEK";
    CurrencyService.CURRENCY_CODE_PLN = "PLN";
    CurrencyService.CURRENCY_CODE_PHP = "PHP";
    CurrencyService.CURRENCY_CODE_TRY = "TRY";
    CurrencyService.CURRENCY_CODE_AED = "AED";
    CurrencyService.CURRENCY_CODE_ARS = "ARS";
    CurrencyService.CURRENCY_CODE_RUB = "RUB";
    CurrencyService.CURRENCY_CODE_XCD = "XCD";
    CurrencyService.CURRENCY_CODE_BGN = "BGN";
    CurrencyService.CURRENCY_CODE_HUF = "HUF";
    CurrencyService.CURRENCY_CODE_CNY = "CNY";
    CurrencyService.CURRENCY_CODE_COP = "COP";
    CurrencyService.CURRENCY_FULL_NAME_USD = 'United States Dollar';
    CurrencyService.CURRENCY_FULL_NAME_EUR = 'Euro';
    CurrencyService.CURRENCY_FULL_NAME_GBP = 'United Kingdom Pound';
    CurrencyService.CURRENCY_FULL_NAME_AUD = 'Australia Dollar';
    CurrencyService.CURRENCY_FULL_NAME_JPY = 'Japan Yen';
    CurrencyService.CURRENCY_FULL_NAME_CAD = 'Canada Dollar';
    CurrencyService.CURRENCY_FULL_NAME_NZD = 'New Zealand Dollar';
    CurrencyService.CURRENCY_FULL_NAME_HKD = 'Hong Kong Dollar';
    CurrencyService.CURRENCY_FULL_NAME_SGD = 'Singapore Dollar';
    CurrencyService.CURRENCY_FULL_NAME_MXN = 'Mexico Peso';
    CurrencyService.CURRENCY_FULL_NAME_DKK = 'Denmark Krone';
    CurrencyService.CURRENCY_FULL_NAME_NOK = 'Norway Krone';
    CurrencyService.CURRENCY_FULL_NAME_MYR = 'Malaysia Ringgit';
    CurrencyService.CURRENCY_FULL_NAME_TWD = 'Taiwan New Dollar';
    CurrencyService.CURRENCY_FULL_NAME_THB = 'Thailand Baht';
    CurrencyService.CURRENCY_FULL_NAME_ILS = 'Israel Shekel';
    CurrencyService.CURRENCY_FULL_NAME_CHF = 'Switzerland Franc';
    CurrencyService.CURRENCY_FULL_NAME_BRL = 'Brazil Real';
    CurrencyService.CURRENCY_FULL_NAME_RON = 'Romania Leu';
    CurrencyService.CURRENCY_FULL_NAME_PGK = 'Papua New Guinea Kina';
    CurrencyService.CURRENCY_FULL_NAME_INR = 'Indian Rupee';
    CurrencyService.CURRENCY_FULL_NAME_MUR = 'Mauritian Rupee';
    CurrencyService.CURRENCY_FULL_NAME_CZK = 'Czech Republic Koruna';
    CurrencyService.CURRENCY_FULL_NAME_DOP = 'Dominican Republic Peso';
    CurrencyService.CURRENCY_FULL_NAME_ZAR = 'South Africa Rand';
    CurrencyService.CURRENCY_FULL_NAME_TRY = 'Turkey Lira';
    CurrencyService.CURRENCY_FULL_NAME_SEK = 'Sweden Krona';
    CurrencyService.CURRENCY_FULL_NAME_PLN = 'Poland Zloty';
    CurrencyService.CURRENCY_FULL_NAME_PHP = 'Philippines Peso';
    CurrencyService.CURRENCY_FULL_NAME_AED = 'United Arab Emirates Dirham';
    CurrencyService.CURRENCY_FULL_NAME_ARS = 'Argentina Peso';
    CurrencyService.CURRENCY_FULL_NAME_RUB = 'Russia Ruble';
    CurrencyService.CURRENCY_FULL_NAME_XCD = 'East Caribbean Dollar';
    CurrencyService.CURRENCY_FULL_NAME_BGN = 'Bulgaria Lev';
    CurrencyService.CURRENCY_FULL_NAME_HUF = 'Hungary Forint';
    CurrencyService.CURRENCY_FULL_NAME_CNY = 'Chinese Yuan';
    CurrencyService.CURRENCY_FULL_NAME_COP = 'Colombian Pesos';
    CurrencyService.CURRENCY_NAME_I18N_USD = 'payments_currency01';
    CurrencyService.CURRENCY_NAME_I18N_EUR = 'payments_currency02';
    CurrencyService.CURRENCY_NAME_I18N_GBP = 'payments_currency03';
    CurrencyService.CURRENCY_NAME_I18N_AUD = 'payments_currency04';
    CurrencyService.CURRENCY_NAME_I18N_JPY = 'payments_currency05';
    CurrencyService.CURRENCY_NAME_I18N_CAD = 'payments_currency06';
    CurrencyService.CURRENCY_NAME_I18N_NZD = 'payments_currency07';
    CurrencyService.CURRENCY_NAME_I18N_HKD = 'payments_currency08';
    CurrencyService.CURRENCY_NAME_I18N_SGD = 'payments_currency09';
    CurrencyService.CURRENCY_NAME_I18N_MXN = 'payments_currency10';
    CurrencyService.CURRENCY_NAME_I18N_DKK = 'payments_currency11';
    CurrencyService.CURRENCY_NAME_I18N_NOK = 'payments_currency13';
    CurrencyService.CURRENCY_NAME_I18N_MYR = 'payments_currency14';
    CurrencyService.CURRENCY_NAME_I18N_TWD = 'payments_currency15';
    CurrencyService.CURRENCY_NAME_I18N_THB = 'payments_currency16';
    CurrencyService.CURRENCY_NAME_I18N_ILS = 'payments_currency17';
    CurrencyService.CURRENCY_NAME_I18N_CHF = 'payments_currency18';
    CurrencyService.CURRENCY_NAME_I18N_BRL = 'payments_currency19';
    CurrencyService.CURRENCY_NAME_I18N_RON = 'payments_currency37';
    CurrencyService.CURRENCY_NAME_I18N_PGK = 'payments_currency22';
    CurrencyService.CURRENCY_NAME_I18N_INR = 'payments_currency23';
    CurrencyService.CURRENCY_NAME_I18N_MUR = 'payments_currency24';
    CurrencyService.CURRENCY_NAME_I18N_CZK = 'payments_currency25';
    CurrencyService.CURRENCY_NAME_I18N_DOP = 'payments_currency26';
    CurrencyService.CURRENCY_NAME_I18N_ZAR = 'payments_currency27';
    CurrencyService.CURRENCY_NAME_I18N_TRY = 'payments_currency28';
    CurrencyService.CURRENCY_NAME_I18N_SEK = 'payments_currency29';
    CurrencyService.CURRENCY_NAME_I18N_PLN = 'payments_currency30';
    CurrencyService.CURRENCY_NAME_I18N_PHP = 'payments_currency38';
    CurrencyService.CURRENCY_NAME_I18N_AED = 'payments_currency32';
    CurrencyService.CURRENCY_NAME_I18N_ARS = 'payments_currency33';
    CurrencyService.CURRENCY_NAME_I18N_RUB = 'payments_currency34';
    CurrencyService.CURRENCY_NAME_I18N_XCD = 'payments_currency36';
    CurrencyService.CURRENCY_NAME_I18N_BGN = 'payments_currency39';
    CurrencyService.CURRENCY_NAME_I18N_HUF = 'payments_currency40';
    CurrencyService.CURRENCY_NAME_I18N_CNY = 'payments_currency41';
    CurrencyService.CURRENCY_NAME_I18N_COP = 'payments_currency42';
    CurrencyService.CURRENCY_SYMBOL_USD = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_EUR = "\u20ac";
    CurrencyService.CURRENCY_SYMBOL_GBP = "\u00a3";
    CurrencyService.CURRENCY_SYMBOL_AUD = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_JPY = "\u00a5";
    CurrencyService.CURRENCY_SYMBOL_CAD = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_NZD = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_HKD = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_SGD = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_MXN = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_DKK = "Kr.";
    CurrencyService.CURRENCY_SYMBOL_NOK = "kr";
    CurrencyService.CURRENCY_SYMBOL_MYR = "RM";
    CurrencyService.CURRENCY_SYMBOL_TWD = "NT\u0024";
    CurrencyService.CURRENCY_SYMBOL_THB = "\u0e3f";
    CurrencyService.CURRENCY_SYMBOL_ILS = "\u20aa";
    CurrencyService.CURRENCY_SYMBOL_CHF = "SFr.";
    CurrencyService.CURRENCY_SYMBOL_BRL = "R\u0024";
    CurrencyService.CURRENCY_SYMBOL_RON = "lei";
    CurrencyService.CURRENCY_SYMBOL_PGK = "K";
    CurrencyService.CURRENCY_SYMBOL_INR = "\u20b9";
    CurrencyService.CURRENCY_SYMBOL_MUR = "\u20a8";
    CurrencyService.CURRENCY_SYMBOL_CZK = "K\u010d";
    CurrencyService.CURRENCY_SYMBOL_DOP = "RD\u0024";
    CurrencyService.CURRENCY_SYMBOL_ZAR = "R";
    CurrencyService.CURRENCY_SYMBOL_SEK = "kr";
    CurrencyService.CURRENCY_SYMBOL_PLN = "z\u0142";
    CurrencyService.CURRENCY_SYMBOL_PHP = "\u20b1";
    CurrencyService.CURRENCY_SYMBOL_TRY = "\u20ba";
    CurrencyService.CURRENCY_SYMBOL_AED = "\u062f\u002e\u0625";
    CurrencyService.CURRENCY_SYMBOL_ARS = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_RUB = "\u20bd";
    CurrencyService.CURRENCY_SYMBOL_XCD = "\u0024";
    CurrencyService.CURRENCY_SYMBOL_BGN = "\u043b\u0432";
    CurrencyService.CURRENCY_SYMBOL_HUF = "Ft";
    CurrencyService.CURRENCY_SYMBOL_CNY = "￥";
    CurrencyService.CURRENCY_SYMBOL_COP = "COP";
    CurrencyService.$SUPPORTED_CURRENCIES = [
        CurrencyService.CURRENCY_CODE_ARS,
        CurrencyService.CURRENCY_CODE_AUD,
        CurrencyService.CURRENCY_CODE_BRL,
        CurrencyService.CURRENCY_CODE_BGN,
        CurrencyService.CURRENCY_CODE_CAD,
        CurrencyService.CURRENCY_CODE_CNY,
        CurrencyService.CURRENCY_CODE_COP,
        CurrencyService.CURRENCY_CODE_CZK,
        CurrencyService.CURRENCY_CODE_DKK,
        CurrencyService.CURRENCY_CODE_DOP,
        CurrencyService.CURRENCY_CODE_XCD,
        CurrencyService.CURRENCY_CODE_EUR,
        CurrencyService.CURRENCY_CODE_HKD,
        CurrencyService.CURRENCY_CODE_HUF,
        CurrencyService.CURRENCY_CODE_INR,
        CurrencyService.CURRENCY_CODE_ILS,
        CurrencyService.CURRENCY_CODE_JPY,
        CurrencyService.CURRENCY_CODE_PGK,
        CurrencyService.CURRENCY_CODE_MYR,
        CurrencyService.CURRENCY_CODE_MUR,
        CurrencyService.CURRENCY_CODE_MXN,
        CurrencyService.CURRENCY_CODE_NZD,
        CurrencyService.CURRENCY_CODE_NOK,
        CurrencyService.CURRENCY_CODE_PHP,
        CurrencyService.CURRENCY_CODE_PLN,
        CurrencyService.CURRENCY_CODE_GBP,
        CurrencyService.CURRENCY_CODE_RON,
        CurrencyService.CURRENCY_CODE_RUB,
        CurrencyService.CURRENCY_CODE_SGD,
        CurrencyService.CURRENCY_CODE_ZAR,
        CurrencyService.CURRENCY_CODE_CHF,
        CurrencyService.CURRENCY_CODE_SEK,
        CurrencyService.CURRENCY_CODE_TWD,
        CurrencyService.CURRENCY_CODE_THB,
        CurrencyService.CURRENCY_CODE_TRY,
        CurrencyService.CURRENCY_CODE_AED,
        CurrencyService.CURRENCY_CODE_USD,
    ];
    CurrencyService.CURRENCY_USD = 1;
    CurrencyService.CURRENCY_EUR = 2;
    CurrencyService.CURRENCY_GBP = 3;
    CurrencyService.CURRENCY_AUD = 4;
    CurrencyService.CURRENCY_JPY = 5;
    CurrencyService.CURRENCY_CAD = 6;
    CurrencyService.CURRENCY_NZD = 7;
    CurrencyService.CURRENCY_HKD = 8;
    CurrencyService.CURRENCY_SGD = 9;
    CurrencyService.CURRENCY_MXN = 10;
    CurrencyService.CURRENCY_DKK = 11;
    CurrencyService.CURRENCY_NOK = 13;
    CurrencyService.CURRENCY_MYR = 14;
    CurrencyService.CURRENCY_TWD = 15;
    CurrencyService.CURRENCY_THB = 16;
    CurrencyService.CURRENCY_ILS = 17;
    CurrencyService.CURRENCY_CHF = 18;
    CurrencyService.CURRENCY_BRL = 19;
    CurrencyService.CURRENCY_RON = 20;
    CurrencyService.CURRENCY_PGK = 22;
    CurrencyService.CURRENCY_INR = 23;
    CurrencyService.CURRENCY_MUR = 24;
    CurrencyService.CURRENCY_CZK = 25;
    CurrencyService.CURRENCY_DOP = 26;
    CurrencyService.CURRENCY_ZAR = 27;
    CurrencyService.CURRENCY_TRY = 28;
    CurrencyService.CURRENCY_SEK = 29;
    CurrencyService.CURRENCY_PLN = 30;
    CurrencyService.CURRENCY_PHP = 31;
    CurrencyService.CURRENCY_AED = 32;
    CurrencyService.CURRENCY_ARS = 33;
    CurrencyService.CURRENCY_RUB = 34;
    CurrencyService.CURRENCY_XCD = 36;
    CurrencyService.CURRENCY_BGN = 37;
    CurrencyService.CURRENCY_HUF = 38;
    CurrencyService.CURRENCY_CNY = 39;
    CurrencyService.CURRENCY_COP = 40;
    CurrencyService.$ID_TO_ISO_CODE = {};
    CurrencyService.$ID_TO_SYMBOL = {};
    CurrencyService.$ISO_CODE_TO_ID = {};
    CurrencyService.$ISO_CODE_TO_FULL_NAME = {};
    CurrencyService.$ISO_CODE_TO_NAME_I18N = {};
    return CurrencyService;
}());
var DataValidator = (function () {
    function DataValidator(i18n, capabilities, phoneUtils) {
        this.i18n = i18n;
        this.capabilities = capabilities;
        this.phoneUtils = phoneUtils;
        if (!window['userService']) {
            throw new Error('Dependency not found: userService');
        }
        this.userService = window['userService'].getInstance();
    }
    DataValidator.prototype.enumerateValidators = function () {
        if (undefined === this.config) {
            this.config = [
                {
                    name: 'none',
                    id: '',
                    isSupported: true,
                    i18n: 'edt_UI_validator_type_none',
                },
                {
                    name: 'email',
                    id: DataValidator.VALIDATOR_TYPE_EMAIL,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_EMAIL),
                    i18n: 'edt_UI_validator_type_email',
                },
                {
                    name: 'password',
                    id: DataValidator.VALIDATOR_TYPE_PASSWORD,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PASSWORD),
                    i18n: 'edt_UI_validator_type_password',
                },
                {
                    name: 'integer',
                    id: DataValidator.VALIDATOR_TYPE_UNSIGNED_INTEGER,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_UNSIGNED_INTEGER),
                    i18n: 'edt_UI_validator_type_unsigned_integer',
                },
                {
                    name: 'alpha',
                    id: DataValidator.VALIDATOR_TYPE_ALPHA,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_ALPHA),
                    i18n: 'edt_UI_validator_type_alpha',
                },
                {
                    name: 'alpha numeric',
                    id: DataValidator.VALIDATOR_TYPE_ALPHANUMERIC,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_ALPHANUMERIC),
                    i18n: 'edt_UI_validator_type_alphanumeric',
                },
                {
                    name: 'alpha space',
                    id: DataValidator.VALIDATOR_TYPE_ALPHASPACE,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_ALPHASPACE),
                    i18n: 'edt_UI_validator_type_alphaspace',
                },
                {
                    name: 'alpha numeric space',
                    id: DataValidator.VALIDATOR_TYPE_ALPHANUMERICSPACE,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_ALPHANUMERICSPACE),
                    i18n: 'edt_UI_validator_type_alphanumericspace',
                },
                {
                    name: 'numeric',
                    id: DataValidator.VALIDATOR_TYPE_NUMERIC,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_NUMERIC),
                    i18n: 'edt_UI_validator_type_numeric',
                },
                {
                    name: 'numeric plus',
                    id: DataValidator.VALIDATOR_TYPE_NUMERICPLUS,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_NUMERICPLUS),
                    i18n: 'edt_UI_validator_type_numericplus',
                },
                {
                    name: 'Url Web Page',
                    id: DataValidator.VALIDATOR_TYPE_URL_WEB_PAGE,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_URL_WEB_PAGE),
                    i18n: 'edt_UI_validator_type_web_page',
                },
                {
                    name: 'Url Image',
                    id: DataValidator.VALIDATOR_TYPE_URL_IMAGE,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_URL_IMAGE),
                    i18n: 'edt_UI_validator_type_url_image',
                },
                {
                    name: 'yy/mm/dd',
                    id: DataValidator.VALIDATOR_TYPE_DATE_YYYYMMDD,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_DATE_YYYYMMDD),
                    i18n: 'edt_UI_validator_type_date_yyyymmdd',
                },
                {
                    name: 'dd/mm/yyyy',
                    id: DataValidator.VALIDATOR_TYPE_DATE_DDMMYYYY,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_DATE_DDMMYYYY),
                    i18n: 'edt_UI_validator_type_date_ddmmyyyy',
                },
                {
                    name: 'mm/dd/yyyy',
                    id: DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY),
                    i18n: 'edt_UI_validator_type_date_mmddyyyy',
                },
                {
                    name: 'mm/yyyy',
                    id: DataValidator.VALIDATOR_TYPE_DATE_MMYYYY,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_DATE_MMYYYY),
                    i18n: 'edt_UI_validator_type_date_mmyyyy',
                },
                {
                    name: 'Time',
                    id: DataValidator.VALIDATOR_TYPE_TIME,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_TIME),
                    i18n: 'edt_UI_validator_type_time',
                },
                {
                    name: 'Time AM/PM',
                    id: DataValidator.VALIDATOR_TYPE_TIME_AMPM,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_TIME_AMPM),
                    i18n: 'edt_UI_validator_type_time_ampm',
                },
                {
                    name: 'full name',
                    id: DataValidator.VALIDATOR_TYPE_FULL_NAME,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_FULL_NAME),
                    i18n: 'edt_UI_validator_type_full_name',
                },
                {
                    name: 'regular expression',
                    id: DataValidator.VALIDATOR_TYPE_REGEX,
                    isSupported: this.userService.canUseValidator(DataValidator.VALIDATOR_TYPE_REGEX),
                    i18n: 'edt_UI_validator_type_regex',
                },
                {
                    name: 'custom',
                    id: DataValidator.VALIDATOR_TYPE_CUSTOM,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_CUSTOM),
                    i18n: 'edt_UI_validator_type_custom',
                },
                {
                    name: 'blank',
                    id: DataValidator.VALIDATOR_TYPE_PASSWORD_ANY_COMPLEXITY_INCLUDING_BLANK_PASSWORDS,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PASSWORD_ANY_COMPLEXITY_INCLUDING_BLANK_PASSWORDS),
                    i18n: 'edt_UI_validator_type_password_any_complexity_including_blank',
                },
                {
                    name: 'any',
                    id: DataValidator.VALIDATOR_TYPE_PASSWORD_ANY_COMPLEXITY,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PASSWORD_ANY_COMPLEXITY),
                    i18n: 'edt_UI_validator_type_password_any_complexity',
                },
                {
                    name: 'minimal',
                    id: DataValidator.VALIDATOR_TYPE_PASSWORD_MIN_COMPLEXITY,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PASSWORD_MIN_COMPLEXITY),
                    i18n: 'edt_UI_validator_type_password_min_complexity',
                },
                {
                    name: 'medium',
                    id: DataValidator.VALIDATOR_TYPE_PASSWORD_MED_COMPLEXITY,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PASSWORD_MED_COMPLEXITY),
                    i18n: 'edt_UI_validator_type_password_med_complexity',
                },
                {
                    name: 'corporate',
                    id: DataValidator.VALIDATOR_TYPE_PASSWORD_CORPORATE_COMPLEXITY,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PASSWORD_CORPORATE_COMPLEXITY),
                    i18n: 'edt_UI_validator_type_password_corporate_complexity',
                },
                {
                    name: 'extra-low',
                    id: DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_EXTRA_LOW,
                    isSupported: this.isValidatorSupported(String(DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_EXTRA_LOW)),
                    i18n: 'edt_UI_validator_type_signature_complexity_extra_low',
                }, {
                    name: 'low',
                    id: DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_LOW,
                    isSupported: this.isValidatorSupported(String(DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_LOW)),
                    i18n: 'edt_UI_validator_type_signature_complexity_low',
                },
                {
                    name: 'medium',
                    id: DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_AVERAGE,
                    isSupported: this.isValidatorSupported(String(DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_AVERAGE)),
                    i18n: 'edt_UI_validator_type_signature_complexity_average',
                },
                {
                    name: 'high',
                    id: DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_HIGH,
                    isSupported: this.isValidatorSupported(String(DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_HIGH)),
                    i18n: 'edt_UI_validator_type_signature_complexity_high',
                },
                {
                    name: '2-2-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_2_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_2_4),
                    i18n: '',
                },
                {
                    name: '2-3-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_4),
                    i18n: '',
                },
                {
                    name: '2-3-8',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_8,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_8),
                    i18n: '',
                },
                {
                    name: '2-4-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_4_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_4_4),
                    i18n: '',
                },
                {
                    name: '2-5-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_5_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_5_4),
                    i18n: '',
                },
                {
                    name: '3-3-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_4),
                    i18n: '',
                },
                {
                    name: '3-3-3',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_3,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_3),
                    i18n: '',
                },
                {
                    name: '3-3-7',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_7,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_7),
                    i18n: '',
                },
                {
                    name: '3-4-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_4_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_4_4),
                    i18n: '',
                },
                {
                    name: '3-2-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_4),
                    i18n: '',
                },
                {
                    name: '3-2-6',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_6,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_6),
                    i18n: '',
                },
                {
                    name: '3-2-7',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_7,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_7),
                    i18n: '',
                },
                {
                    name: '3-5-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_5_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_5_4),
                    i18n: '',
                },
                {
                    name: '4-3-3',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_3,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_3),
                    i18n: '',
                },
                {
                    name: '4-3-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_4),
                    i18n: '',
                },
                {
                    name: '4-3-6',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_6,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_6),
                    i18n: '',
                },
                {
                    name: '4-3-7',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_7,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_7),
                    i18n: '',
                },
                {
                    name: '4-2-8',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_2_8,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_2_8),
                    i18n: '',
                },
                {
                    name: '4-4-6',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_4_6,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_4_6),
                    i18n: '',
                },
                {
                    name: '5-3-3',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_3_3,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_3_3),
                    i18n: '',
                },
                {
                    name: '5-4-4',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_4_4,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_4_4),
                    i18n: '',
                },
                {
                    name: '5-6',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_6,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_6),
                    i18n: '',
                },
                {
                    name: 'phone-any-format',
                    id: DataValidator.VALIDATOR_TYPE_PHONE_ANY_FORMAT,
                    isSupported: this.isValidatorSupported(DataValidator.VALIDATOR_TYPE_PHONE_ANY_FORMAT),
                    i18n: '',
                }
            ];
            this.config.sort(function (a, b) {
                var valAName = a.name.toLowerCase(), valBName = b.name.toLowerCase();
                return valAName === valBName
                    ? 0
                    : valAName < valBName
                        ? -1
                        : 1;
            });
        }
        return this.config.slice(0);
    };
    DataValidator.prototype.isValidatorSupported = function (validatorName) {
        var validatorNameToString = String(validatorName);
        for (var i = 0, len = this.capabilities.factory.supportedValidationTypes.length; i < len; i++) {
            if (String(this.capabilities.factory.supportedValidationTypes[i]) === validatorNameToString) {
                return true;
            }
        }
        return false;
    };
    DataValidator.prototype.getValidatorById = function (id) {
        if (undefined === this.config) {
            this.enumerateValidators();
        }
        for (var i = 0, len = this.config.length; i < len; i++) {
            if (this.config[i].id === id || (null === id && this.config[i].id === '')) {
                return this.config[i];
            }
        }
        return null;
    };
    DataValidator.prototype.validate = function (data, againstValidator) {
        if (!!!againstValidator) {
            return true;
        }
        switch (againstValidator) {
            case DataValidator.VALIDATOR_TYPE_EMAIL:
                return this.validateEmailAddress(data);
            case DataValidator.VALIDATOR_TYPE_URL_WEB_PAGE:
                return this.validateWebAddress(data);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_2_4:
                return this.validatePhoneNumberFormat(data, [2, 2, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_4:
                return this.validatePhoneNumberFormat(data, [2, 3, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_8:
                return this.validatePhoneNumberFormat(data, [2, 3, 8]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_4_4:
                return this.validatePhoneNumberFormat(data, [2, 4, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_5_4:
                return this.validatePhoneNumberFormat(data, [2, 5, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_4:
                return this.validatePhoneNumberFormat(data, [3, 3, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_3:
                return this.validatePhoneNumberFormat(data, [3, 3, 3]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_7:
                return this.validatePhoneNumberFormat(data, [3, 3, 7]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_4_4:
                return this.validatePhoneNumberFormat(data, [3, 4, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_4:
                return this.validatePhoneNumberFormat(data, [3, 2, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_6:
                return this.validatePhoneNumberFormat(data, [3, 2, 6]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_7:
                return this.validatePhoneNumberFormat(data, [3, 2, 7]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_5_4:
                return this.validatePhoneNumberFormat(data, [3, 5, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_3:
                return this.validatePhoneNumberFormat(data, [4, 3, 3]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_4:
                return this.validatePhoneNumberFormat(data, [4, 3, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_6:
                return this.validatePhoneNumberFormat(data, [4, 3, 6]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_7:
                return this.validatePhoneNumberFormat(data, [4, 3, 7]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_2_8:
                return this.validatePhoneNumberFormat(data, [4, 2, 8]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_4_6:
                return this.validatePhoneNumberFormat(data, [4, 4, 6]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_3_3:
                return this.validatePhoneNumberFormat(data, [5, 3, 3]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_4_4:
                return this.validatePhoneNumberFormat(data, [5, 4, 4]);
            case DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_6:
                return this.validatePhoneNumberFormat(data, [5, 6]);
            case DataValidator.VALIDATOR_TYPE_PHONE_ANY_FORMAT:
                return this.validatePhoneNumberWithAnyFormat(data);
            case DataValidator.VALIDATOR_TYPE_YOUTUBE_URL:
                return !!this.validateYoutubeVideoURL(data);
            case DataValidator.VALIDATOR_TYPE_VIMEO_URL:
                return !!this.validateVimeoVideoURL(data);
            case DataValidator.VALIDATOR_TYPE_WORDPRESS_TV_URL:
                return !!this.validateWordpressTVVideoUrl(data);
            case DataValidator.VALIDATOR_TYPE_TED_TALKS_URL:
                return !!this.validateTedTalksVideoURL(data);
            case DataValidator.VALIDATOR_TYPE_DAILYMOTION_URL:
                return !!this.validateDailyMotionVideoURL(data);
            case DataValidator.VALIDATOR_TYPE_MIXCLOUD_URL:
                return !!this.validateMixCloudAudioURL(data);
            case DataValidator.VALIDATOR_TYPE_SOUNDCLOUD_URL:
                return !!this.validateSoundCloudAudioURL(data);
            case DataValidator.VALIDATOR_TYPE_NFB_URL:
                return !!this.validateNFBVideoURL(data);
            case DataValidator.VALIDATOR_TYPE_KICKSTARTER_URL:
                return !!this.validateKickstarterVideoURL(data);
            case DataValidator.VALIDATOR_TYPE_TWITCH_URL:
                return !!this.validateTwitchVideoURL(data);
            case DataValidator.VALIDATOR_TYPE_PDF_URL:
                return !!this.validatePDFFileUrl(data);
            case DataValidator.FACEBOOK_POST_URL:
                return !!this.validateFacebookPostURL(data);
            case DataValidator.FACEBOOK_PAGE_URL:
                return !!this.validateFacebookPageURL(data);
            case DataValidator.VALIDATOR_TYPE_EMBEDDABLE_URL:
                return !!this.validateEmbeddableURL(data);
            case DataValidator.VALIDATOR_TYPE_EMBEDDABLE_FACEBOOK_URL:
                return !!this.validateEmbeddableFacebookURL(data);
            case DataValidator.VALIDATOR_TYPE_EMBEDDABLE_PDF_URL:
                return !!this.validateEmbeddablePdfURL(data);
            case DataValidator.VALIDATOR_TYPE_EMBEDDABLE_VIDEO_URL:
                return !!this.validateEmbeddableVideoURL(data);
            default:
                return false;
        }
    };
    DataValidator.prototype.validateEmailAddress = function (emailAddress) {
        if ('string' !== typeof emailAddress) {
            return false;
        }
        if ('' === emailAddress) {
            return false;
        }
        return /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(emailAddress);
    };
    DataValidator.prototype.validatePhoneNumberWithAnyFormat = function (phoneNumber) {
        var onlyNumericCharacters;
        if ('' === phoneNumber) {
            return false;
        }
        onlyNumericCharacters = phoneNumber.toString().replace(/\D+/g, "");
        if (onlyNumericCharacters.length < 4) {
            return false;
        }
        return /^\+?([0-9. \- \( \)]+)$/.test(phoneNumber);
    };
    DataValidator.prototype.validatePhoneNumberFormat = function (phoneNumber, phoneFormat) {
        if ('string' !== typeof phoneNumber) {
            return false;
        }
        if ('' === phoneNumber) {
            return false;
        }
        var parsedPhone = this.phoneUtils.parsePhoneNumber(phoneNumber);
        if (null == parsedPhone) {
            return true;
        }
        if (null == parsedPhone.localPhoneNumber) {
            return true;
        }
        var regExpPhonePattern = '';
        if (phoneFormat[2] !== undefined) {
            regExpPhonePattern = '^[0-9]{' + (phoneFormat[0] + phoneFormat[1] + phoneFormat[2]) + '}$';
        }
        else {
            regExpPhonePattern = '^[0-9]{' + (phoneFormat[0] + phoneFormat[1]) + '}$';
        }
        var regExpPhone = new RegExp(regExpPhonePattern);
        return regExpPhone.test(parsedPhone.localPhoneNumber);
    };
    DataValidator.prototype.getSupportedUserPlanValidators = function (validators) {
        var result = [];
        for (var i = 0, v = validators || [], len = v.length; i < len; i++) {
            if (v[i].isSupported) {
                result.push(v[i]);
            }
        }
        return result.length
            ? result
            : null;
    };
    DataValidator.prototype.validateWebAddress = function (webAddress) {
        if ('string' !== typeof webAddress)
            return false;
        if ('' === webAddress)
            return false;
        return /^(?:http(s)?:\/\/)[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/i.test(webAddress);
    };
    DataValidator.prototype.validateYoutubeVideoURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:y2u\.be\/|youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|v=)?)((\w|-){11})(?:\S+)?$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.YOUTUBE_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateVimeoVideoURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:player\.)?(?:vimeo\.com\/(?:video\/)?)((\w|-){9})(?:\S+)?$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.VIMEO_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateWordpressTVVideoUrl = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:videopress\.com)(?:\/embed)?\/((\w|-){8,})(?:\S+)?$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.WORDPRESS_TV_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateTedTalksVideoURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:embed\.)?(?:ted\.com\/talks\/)(.+)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.TED_TALKS_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateDailyMotionVideoURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:dailymotion\.com)\/(?:embed\/)?(?:video\/)(.+)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.DAILYMOTION_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateMixCloudAudioURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:mixcloud\.com)\/(?:widget\/iframe\/)?(?:\?feed=)(?:https?:\/\/)?(?:www\.)?(?:mixcloud\.com)\/(.+)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.MIXCLOUD_AUDIO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateSoundCloudAudioURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:api\.)(?:soundcloud\.com)\/(?:tracks\/)(.+)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.SOUNDCLOUD_AUDIO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateNFBVideoURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:nfb\.ca\/film\/)(.+)(?:\/embed\/player\/)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.NFB_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateKickstarterVideoURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:kickstarter\.com\/)(?:projects\/)?(.+)(?:\/widget\/video\.html)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.KICKSTARTER_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateTwitchVideoURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:player\.)?(?:twitch\.tv\/)(?:\?video=|videos\/)(.+)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.TWITCH_VIDEO,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validatePDFFileUrl = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(.*)(?:\.pdf)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.PDF_FILE,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateFacebookPostURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:facebook\.com\/)(.*\/posts\/.*)$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.FACEBOOK_POST,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateFacebookPageURL = function (data) {
        var result = null;
        if ('string' !== typeof data)
            return null;
        if ('' === data)
            return null;
        var regexToMatchWith = /^(?:https?:\/\/)?(?:(?:[a-z]{2})-(?:[a-z]{2})\.|(?:www)\.)?(?:facebook\.com\/)(.+)(?:\/)?$/;
        if (data.match(regexToMatchWith)) {
            result = ({
                type: EURLType.FACEBOOK_PAGE,
                identifier: RegExp.$1,
                url: data,
            });
        }
        return result;
    };
    DataValidator.prototype.validateEmbeddableURL = function (data, urlType) {
        if (urlType === void 0) { urlType = EURLCategory.ANY; }
        var parsedDetails;
        if (urlType === EURLCategory.VIDEO_OR_AUDIO) {
            if (parsedDetails = this.validateYoutubeVideoURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateVimeoVideoURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateWordpressTVVideoUrl(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateTedTalksVideoURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateDailyMotionVideoURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateMixCloudAudioURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateSoundCloudAudioURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateNFBVideoURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateKickstarterVideoURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateTwitchVideoURL(data)) {
                return parsedDetails;
            }
        }
        if (urlType === EURLCategory.PDF) {
            if (parsedDetails = this.validatePDFFileUrl(data)) {
                return parsedDetails;
            }
        }
        if (urlType === EURLCategory.FACEBOOK) {
            if (parsedDetails = this.validateFacebookPostURL(data)) {
                return parsedDetails;
            }
            if (parsedDetails = this.validateFacebookPageURL(data)) {
                return parsedDetails;
            }
        }
        return null;
    };
    DataValidator.prototype.validateEmbeddableVideoURL = function (data) {
        return this.validateEmbeddableURL(data, EURLCategory.VIDEO_OR_AUDIO);
    };
    DataValidator.prototype.validateEmbeddableFacebookURL = function (data) {
        return this.validateEmbeddableURL(data, EURLCategory.FACEBOOK);
    };
    DataValidator.prototype.validateEmbeddablePdfURL = function (data) {
        return this.validateEmbeddableURL(data, EURLCategory.PDF);
    };
    DataValidator.VALIDATOR_TYPE_NONE = null;
    DataValidator.VALIDATOR_TYPE_EMAIL = 'email';
    DataValidator.VALIDATOR_TYPE_PASSWORD = 'password';
    DataValidator.VALIDATOR_TYPE_UNSIGNED_INTEGER = 'integer';
    DataValidator.VALIDATOR_TYPE_ALPHA = 'alpha';
    DataValidator.VALIDATOR_TYPE_ALPHANUMERIC = 'alphanumeric';
    DataValidator.VALIDATOR_TYPE_ALPHASPACE = 'alphaspace';
    DataValidator.VALIDATOR_TYPE_ALPHANUMERICSPACE = 'alphanumericspace';
    DataValidator.VALIDATOR_TYPE_NUMERIC = 'numeric';
    DataValidator.VALIDATOR_TYPE_NUMERICPLUS = 'numericplus';
    DataValidator.VALIDATOR_TYPE_URL_WEB_PAGE = 'url';
    DataValidator.VALIDATOR_TYPE_URL_IMAGE = 'url-image';
    DataValidator.VALIDATOR_TYPE_DATE_YYYYMMDD = 'dateyyyymmdd';
    DataValidator.VALIDATOR_TYPE_DATE_DDMMYYYY = 'dateddmmyyyy';
    DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY = 'datemmddyyyy';
    DataValidator.VALIDATOR_TYPE_DATE_MMYYYY = 'datemmyyyy';
    DataValidator.VALIDATOR_TYPE_TIME = 'time';
    DataValidator.VALIDATOR_TYPE_TIME_AMPM = 'time_ampm';
    DataValidator.VALIDATOR_TYPE_FULL_NAME = 'full_name';
    DataValidator.VALIDATOR_TYPE_REGEX = 'regex';
    DataValidator.VALIDATOR_TYPE_CUSTOM = 'custom';
    DataValidator.VALIDATOR_TYPE_PASSWORD_ANY_COMPLEXITY_INCLUDING_BLANK_PASSWORDS = 'password-complexity-any-inluding-blank-passwords';
    DataValidator.VALIDATOR_TYPE_PASSWORD_ANY_COMPLEXITY = 'password-complexity-any';
    DataValidator.VALIDATOR_TYPE_PASSWORD_MIN_COMPLEXITY = 'password-complexity-minimum';
    DataValidator.VALIDATOR_TYPE_PASSWORD_MED_COMPLEXITY = 'password-complexity-medium';
    DataValidator.VALIDATOR_TYPE_PASSWORD_CORPORATE_COMPLEXITY = 'password-complexity-master';
    DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_EXTRA_LOW = 0;
    DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_LOW = 1;
    DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_AVERAGE = 2;
    DataValidator.VALIDATOR_TYPE_SIGNATURE_COMPLEXITY_HIGH = 3;
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_2_4 = '2-2-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_4 = '2-3-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_3_8 = '2-3-8';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_4_4 = '2-4-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_2_5_4 = '2-5-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_4 = '3-3-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_3 = '3-3-3';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_3_7 = '3-3-7';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_4_4 = '3-4-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_4 = '3-2-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_6 = '3-2-6';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_2_7 = '3-2-7';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_3_5_4 = '3-5-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_3 = '4-3-3';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_4 = '4-3-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_6 = '4-3-6';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_3_7 = '4-3-7';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_2_8 = '4-2-8';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_4_4_6 = '4-4-6';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_3_3 = '5-3-3';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_4_4 = '5-4-4';
    DataValidator.VALIDATOR_TYPE_PHONE_FORMAT_5_6 = '5-6';
    DataValidator.VALIDATOR_TYPE_PHONE_ANY_FORMAT = 'phone-any-format';
    DataValidator.VALIDATOR_TYPE_YOUTUBE_URL = 'youtube-url';
    DataValidator.VALIDATOR_TYPE_VIMEO_URL = 'vimeo-url';
    DataValidator.VALIDATOR_TYPE_WORDPRESS_TV_URL = 'wordpress-tv-url';
    DataValidator.VALIDATOR_TYPE_TED_TALKS_URL = 'ted-talks-url';
    DataValidator.VALIDATOR_TYPE_DAILYMOTION_URL = 'dailymotion-url';
    DataValidator.VALIDATOR_TYPE_MIXCLOUD_URL = 'mixcloud-url';
    DataValidator.VALIDATOR_TYPE_SOUNDCLOUD_URL = 'soundcloud-url';
    DataValidator.VALIDATOR_TYPE_NFB_URL = 'nfb-url';
    DataValidator.VALIDATOR_TYPE_KICKSTARTER_URL = 'kickstarter-url';
    DataValidator.VALIDATOR_TYPE_TWITCH_URL = 'twitch-url';
    DataValidator.VALIDATOR_TYPE_PDF_URL = 'pdf-url';
    DataValidator.FACEBOOK_POST_URL = 'facebook-post-url';
    DataValidator.FACEBOOK_PAGE_URL = 'facebook-page-url';
    DataValidator.VALIDATOR_TYPE_EMBEDDABLE_URL = 'embeddable-url';
    DataValidator.VALIDATOR_TYPE_EMBEDDABLE_VIDEO_URL = 'embeddable-video-url';
    DataValidator.VALIDATOR_TYPE_EMBEDDABLE_PDF_URL = 'embeddable-pdf-url';
    DataValidator.VALIDATOR_TYPE_EMBEDDABLE_FACEBOOK_URL = 'embeddable-facebook-url';
    return DataValidator;
}());
var E_OS_TYPE;
(function (E_OS_TYPE) {
    E_OS_TYPE[E_OS_TYPE["ANDROID"] = 0] = "ANDROID";
    E_OS_TYPE[E_OS_TYPE["IOS"] = 1] = "IOS";
    E_OS_TYPE[E_OS_TYPE["MAC"] = 2] = "MAC";
    E_OS_TYPE[E_OS_TYPE["WINDOWS_MOBILE"] = 3] = "WINDOWS_MOBILE";
    E_OS_TYPE[E_OS_TYPE["WINDOWS"] = 4] = "WINDOWS";
    E_OS_TYPE[E_OS_TYPE["LINUX"] = 5] = "LINUX";
    E_OS_TYPE[E_OS_TYPE["UNIX"] = 6] = "UNIX";
    E_OS_TYPE[E_OS_TYPE["OTHER"] = 7] = "OTHER";
})(E_OS_TYPE || (E_OS_TYPE = {}));
var E_OS_VERSION;
(function (E_OS_VERSION) {
    E_OS_VERSION[E_OS_VERSION["WIN_95"] = 0] = "WIN_95";
    E_OS_VERSION[E_OS_VERSION["WIN_98"] = 1] = "WIN_98";
    E_OS_VERSION[E_OS_VERSION["WIN_2000"] = 2] = "WIN_2000";
    E_OS_VERSION[E_OS_VERSION["WIN_NT"] = 3] = "WIN_NT";
    E_OS_VERSION[E_OS_VERSION["WIN_ME"] = 4] = "WIN_ME";
    E_OS_VERSION[E_OS_VERSION["WIN_XP"] = 5] = "WIN_XP";
    E_OS_VERSION[E_OS_VERSION["WIN_SERVER_2003"] = 6] = "WIN_SERVER_2003";
    E_OS_VERSION[E_OS_VERSION["WIN_VISTA"] = 7] = "WIN_VISTA";
    E_OS_VERSION[E_OS_VERSION["WIN_7"] = 8] = "WIN_7";
    E_OS_VERSION[E_OS_VERSION["WIN_8"] = 9] = "WIN_8";
    E_OS_VERSION[E_OS_VERSION["WIN_10"] = 10] = "WIN_10";
    E_OS_VERSION[E_OS_VERSION["WIN_OTHER"] = 11] = "WIN_OTHER";
    E_OS_VERSION[E_OS_VERSION["UNKNOWN"] = 12] = "UNKNOWN";
})(E_OS_VERSION || (E_OS_VERSION = {}));
var E_BROWSER_TYPE;
(function (E_BROWSER_TYPE) {
    E_BROWSER_TYPE[E_BROWSER_TYPE["CHROME"] = 0] = "CHROME";
    E_BROWSER_TYPE[E_BROWSER_TYPE["FIREFOX"] = 1] = "FIREFOX";
    E_BROWSER_TYPE[E_BROWSER_TYPE["MSIE"] = 2] = "MSIE";
    E_BROWSER_TYPE[E_BROWSER_TYPE["EDGE"] = 3] = "EDGE";
    E_BROWSER_TYPE[E_BROWSER_TYPE["SAFARI"] = 4] = "SAFARI";
    E_BROWSER_TYPE[E_BROWSER_TYPE["OPERA"] = 5] = "OPERA";
    E_BROWSER_TYPE[E_BROWSER_TYPE["UNKNOWN"] = 6] = "UNKNOWN";
})(E_BROWSER_TYPE || (E_BROWSER_TYPE = {}));
var E_DEVICE_TYPE;
(function (E_DEVICE_TYPE) {
    E_DEVICE_TYPE[E_DEVICE_TYPE["DESKTOP"] = 0] = "DESKTOP";
    E_DEVICE_TYPE[E_DEVICE_TYPE["MOBILE"] = 1] = "MOBILE";
    E_DEVICE_TYPE[E_DEVICE_TYPE["SMART_TV"] = 2] = "SMART_TV";
})(E_DEVICE_TYPE || (E_DEVICE_TYPE = {}));
var E_DETECTION_ERROR;
(function (E_DETECTION_ERROR) {
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_NONE"] = 0] = "E_NONE";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_SYNTAX_ERROR"] = 1] = "E_SYNTAX_ERROR";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_BAD_OS"] = 2] = "E_BAD_OS";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_MOBILE_APP"] = 3] = "E_MOBILE_APP";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_DESKTOP_APP"] = 4] = "E_DESKTOP_APP";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_BAD_CPU_CLASS"] = 5] = "E_BAD_CPU_CLASS";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_BROWSER_VERSION"] = 6] = "E_BROWSER_VERSION";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_BROWSER_TYPE"] = 7] = "E_BROWSER_TYPE";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_API_MISSING"] = 8] = "E_API_MISSING";
    E_DETECTION_ERROR[E_DETECTION_ERROR["E_UNKNOWN_ERROR"] = 9] = "E_UNKNOWN_ERROR";
})(E_DETECTION_ERROR || (E_DETECTION_ERROR = {}));
var BrowserDetector = (function () {
    function BrowserDetector() {
    }
    BrowserDetector.winVersionCompare = function (ver1, ver2) {
        var var1I = BrowserDetector.WIN_VERSIONS_RELEASE_ORDER.indexOf(ver1), var2I = BrowserDetector.WIN_VERSIONS_RELEASE_ORDER.indexOf(ver2);
        return var2I - var1I;
    };
    Object.defineProperty(BrowserDetector, "isIPad", {
        get: function () {
            return !!navigator.userAgent.match(/iPad/i);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "isIPod", {
        get: function () {
            return !!navigator.userAgent.match(/iPod/i);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "isIPhone", {
        get: function () {
            return !!navigator.userAgent.match(/iPhone/i);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "isAndroid", {
        get: function () {
            return !!navigator.userAgent.match(/Android/i);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "isFirefox", {
        get: function () {
            return navigator.userAgent.match(/Firefox/i)
                && !navigator.userAgent.match(/Seamonkey/i);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "isWindowsPhone", {
        get: function () {
            return !!navigator.userAgent.match(/(Windows (Phone )?8.1|Windows NT 6.3|Windows Phone [\d\.]+)/i) &&
                navigator.userAgent.toLowerCase().indexOf('mobile') > -1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "isChrome", {
        get: function () {
            return !!window['chrome'] && /google/i.test(navigator.vendor);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "isInternetExplorer", {
        get: function () {
            if (navigator.appName == 'Microsoft Internet Explorer') {
                return !!/MSIE([0-9]{1,}[\.0-9]{0,})/.test(navigator.userAgent);
            }
            else {
                return false;
            }
        },
        enumerable: true,
        configurable: true
    });
    BrowserDetector.isTouchDevice = function () {
        return true;
        var prefixes = ' -webkit- -moz- -o- -ms- '.split(' ');
        var mq = function (query) {
            return window.matchMedia(query).matches;
        };
        if ('ontouchstart' in window || window['DocumentTouch'] && document instanceof DocumentTouch) {
            return true;
        }
        var query = ['(', prefixes.join('touch-enabled),('), 'heartz', ')'].join('');
        return mq(query);
    };
    Object.defineProperty(BrowserDetector, "cpuClass", {
        get: function () {
            var agent = navigator.userAgent, i = 0, len = BrowserDetector.CPU_64_CLASSES.length;
            for (i = 0; i < len; i++) {
                if (agent.indexOf(BrowserDetector.CPU_64_CLASSES[i]) > -1) {
                    return 64;
                }
            }
            return 32;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "operatingSystem", {
        get: function () {
            if (BrowserDetector.isWindowsPhone) {
                return E_OS_TYPE.WINDOWS_MOBILE;
            }
            else if (BrowserDetector.isAndroid) {
                return E_OS_TYPE.ANDROID;
            }
            else if (BrowserDetector.isIPad || BrowserDetector.isIPhone || BrowserDetector.isIPod) {
                return E_OS_TYPE.IOS;
            }
            else if (navigator.userAgent.indexOf('Mac') > -1) {
                return E_OS_TYPE.MAC;
            }
            else if (navigator.userAgent.indexOf('Linux') > -1) {
                return E_OS_TYPE.LINUX;
            }
            else if (navigator.userAgent.indexOf('Windows')) {
                return E_OS_TYPE.WINDOWS;
            }
            else if (navigator.userAgent.indexOf('X11') > -1) {
                return E_OS_TYPE.UNIX;
            }
            else
                return E_OS_TYPE.OTHER;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "operatingSystemVersion", {
        get: function () {
            if (BrowserDetector.operatingSystem != E_OS_TYPE.WINDOWS) {
                return E_OS_VERSION.UNKNOWN;
            }
            else {
                switch (true) {
                    case /(Windows 10\.0|Windows NT 10\.0)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_10;
                    case /(Windows 8|Windows NT 6\.(2|3))/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_8;
                    case /(Windows 7|Windows NT 6\.1)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_7;
                    case /Windows NT 6\.0/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_VISTA;
                    case /Windows NT 5\.2/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_SERVER_2003;
                    case /(Windows NT 5\.1|Windows XP)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_XP;
                    case /(Windows NT 5\.0|Windows 2000)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_2000;
                    case /(Win 9x 4\.90|Windows ME)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_ME;
                    case /(Windows 98|Win98)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_98;
                    case /(Windows 95|Win95|Windows_95)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_95;
                    case /(Windows NT 4\.0|WinNT4\.0|WinNT|Windows NT)/.test(navigator.userAgent):
                        return E_OS_VERSION.WIN_NT;
                    default:
                        return E_OS_VERSION.WIN_OTHER;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "browserType", {
        get: function () {
            switch (true) {
                case !!navigator.userAgent.match(new RegExp('[\\s]+Edge\\/[\\d]+', 'i')):
                    return E_BROWSER_TYPE.EDGE;
                case navigator.userAgent.indexOf('Opera') > -1:
                case navigator.userAgent.indexOf('OPR') > -1:
                    return E_BROWSER_TYPE.OPERA;
                case navigator.userAgent.indexOf('MSIE') > -1:
                    return E_BROWSER_TYPE.MSIE;
                case navigator.userAgent.indexOf('Chrome') > -1:
                    return E_BROWSER_TYPE.CHROME;
                case navigator.userAgent.indexOf('Safari') > -1:
                    return E_BROWSER_TYPE.SAFARI;
                case navigator.userAgent.indexOf('Firefox') > -1:
                    return E_BROWSER_TYPE.FIREFOX;
                case navigator.userAgent.indexOf('Trident/') > -1:
                    return E_BROWSER_TYPE.MSIE;
                default:
                    return E_BROWSER_TYPE.UNKNOWN;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "browserVersion", {
        get: function () {
            var nVer = navigator.appVersion, nAgt = navigator.userAgent, version = '' + parseFloat(navigator.appVersion), verOffset, nameOffset, ix, majorVersion;
            if ((verOffset = nAgt.indexOf('Edge\/')) > -1) {
                version = nAgt.substr(verOffset + 5);
            }
            else if ((verOffset = nAgt.indexOf('Opera')) > -1) {
                version = nAgt.substring(verOffset + 6);
                if ((verOffset = nAgt.indexOf('Version')) != -1) {
                    version = nAgt.substring(verOffset + 8);
                }
            }
            else if ((verOffset = nAgt.indexOf('OPR')) != -1) {
                version = nAgt.substring(verOffset + 4);
            }
            else if ((verOffset = nAgt.indexOf('MSIE')) != -1) {
                version = nAgt.substring(verOffset + 5);
            }
            else if ((verOffset = nAgt.indexOf('Chrome')) != -1) {
                version = nAgt.substring(verOffset + 7);
            }
            else if ((verOffset = nAgt.indexOf('Safari')) != -1) {
                version = nAgt.substring(verOffset + 7);
                if ((verOffset = nAgt.indexOf('Version')) != -1) {
                    version = nAgt.substring(verOffset + 8);
                }
            }
            else if ((verOffset = nAgt.indexOf('Firefox')) != -1) {
                version = nAgt.substring(verOffset + 8);
            }
            else if (nAgt.indexOf('Trident/') != -1) {
                version = nAgt.substring(nAgt.indexOf('rv:') + 3);
            }
            else if ((nameOffset = nAgt.lastIndexOf(' ') + 1) < (verOffset = nAgt.lastIndexOf('/'))) {
                version = nAgt.substring(verOffset + 1);
            }
            if ((ix = version.indexOf(';')) != -1)
                version = version.substring(0, ix);
            if ((ix = version.indexOf(' ')) != -1)
                version = version.substring(0, ix);
            if ((ix = version.indexOf(')')) != -1)
                version = version.substring(0, ix);
            majorVersion = parseInt('' + version, 10);
            if (isNaN(majorVersion)) {
                version = '' + parseFloat(navigator.appVersion);
            }
            return parseFloat(version);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "browserTechnologies", {
        get: function () {
            var technologies = [], i = 0, len = BrowserDetector.APIS_LIST.length;
            for (i = 0; i < len; i++) {
                try {
                    if (window[BrowserDetector.APIS_LIST[i]]
                        || window['moz' + BrowserDetector.APIS_LIST[i]]
                        || window['webkit' + BrowserDetector.APIS_LIST[i]]
                        || window['ms' + BrowserDetector.APIS_LIST[i]]
                        || window['o' + BrowserDetector.APIS_LIST[i]]) {
                        technologies.push(BrowserDetector.APIS_LIST[i].toLowerCase());
                    }
                }
                catch (error) {
                }
            }
            var plugins = navigator.plugins || [], isFlash = false, isNagra = false, j = 0, n = 0;
            for (i = 0, len = plugins.length; i < len; i++) {
                if (plugins[i].description.toString().toLowerCase().indexOf('flash') > -1) {
                    isFlash = true;
                }
                else if (typeof plugins[i]['application/x-nmpcbrowserplugin'] != 'undefined') {
                    technologies.push('nagra');
                }
                else if (plugins[i].length) {
                    for (j = 0, n = plugins[i].length; j < n; j++) {
                        if (plugins[i][j].type == 'application/vnd.rcsrds.secureplayer.pepper.plugin') {
                            technologies.push('nagrapepper');
                            break;
                        }
                    }
                }
            }
            if (isFlash) {
                technologies.push('flash');
            }
            return technologies.join(',');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BrowserDetector, "toString", {
        get: function () {
            if (BrowserDetector.CACHED_VERSION !== undefined) {
                return BrowserDetector.CACHED_VERSION;
            }
            var result = '';
            switch (BrowserDetector.operatingSystemVersion) {
                case E_OS_VERSION.WIN_95:
                    result += 'win95';
                    break;
                case E_OS_VERSION.WIN_98:
                    result += 'win98';
                    break;
                case E_OS_VERSION.WIN_2000:
                    result += 'win2k';
                    break;
                case E_OS_VERSION.WIN_NT:
                    result += 'winnt4';
                    break;
                case E_OS_VERSION.WIN_ME:
                    result += 'winme';
                    break;
                case E_OS_VERSION.WIN_XP:
                    result += 'winxp';
                    break;
                case E_OS_VERSION.WIN_SERVER_2003:
                    result += 'win2k3';
                    break;
                case E_OS_VERSION.WIN_VISTA:
                    result += 'winvista';
                    break;
                case E_OS_VERSION.WIN_7:
                    result += 'win7';
                    break;
                case E_OS_VERSION.WIN_8:
                    result += 'win8';
                    break;
                case E_OS_VERSION.WIN_10:
                    result += 'win10';
                    break;
                case E_OS_VERSION.WIN_OTHER:
                    result += 'winother';
                    break;
                case E_OS_VERSION.UNKNOWN:
                    switch (BrowserDetector.operatingSystem) {
                        case E_OS_TYPE.ANDROID:
                            result += 'android';
                            break;
                        case E_OS_TYPE.IOS:
                            result += 'ios';
                            break;
                        case E_OS_TYPE.MAC:
                            result += 'mac';
                            break;
                        case E_OS_TYPE.WINDOWS_MOBILE:
                            result += 'winmobile';
                            break;
                        case E_OS_TYPE.WINDOWS:
                            result += 'winother';
                            break;
                        case E_OS_TYPE.LINUX:
                            result += 'linux';
                            break;
                        case E_OS_TYPE.UNIX:
                            result += 'unix';
                            break;
                        case E_OS_TYPE.OTHER:
                            result += 'other';
                            break;
                        default:
                            result += 'unknown';
                            break;
                    }
                    break;
                default:
                    result += 'unknown';
                    break;
            }
            switch (BrowserDetector.cpuClass) {
                case 32:
                    result += ' 32';
                    break;
                case 64:
                    result += ' 64';
                    break;
            }
            if (/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion)) {
                result += ' mobile';
            }
            else {
                result += ' desktop';
            }
            switch (BrowserDetector.browserType) {
                case E_BROWSER_TYPE.CHROME:
                    result += ' chrome';
                    break;
                case E_BROWSER_TYPE.FIREFOX:
                    result += ' firefox';
                    break;
                case E_BROWSER_TYPE.MSIE:
                    result += ' msie';
                    break;
                case E_BROWSER_TYPE.EDGE:
                    result += ' edge';
                    break;
                case E_BROWSER_TYPE.SAFARI:
                    result += ' safari';
                    break;
                case E_BROWSER_TYPE.OPERA:
                    result += ' opera';
                    break;
                case E_BROWSER_TYPE.UNKNOWN:
                    result += ' other';
                    break;
                default:
                    result += ' other';
            }
            return BrowserDetector.CACHED_VERSION = (result + ' ' + BrowserDetector.browserVersion.toFixed(2).replace(/[0]+$/g, '').replace(/\.$/, '')) + ' apis=' + BrowserDetector.browserTechnologies;
        },
        enumerable: true,
        configurable: true
    });
    BrowserDetector.explainMissingApis = function (apisList) {
        if (!apisList || !apisList.length) {
            return 'An error occured while detecting your browser capabilities';
        }
        var result = [], i = 0, len = apisList.length;
        for (i = 0; i < len; i++) {
            if (BrowserDetector.API_NAMES[apisList[i]]) {
                result.push('"' + apisList[i].toUpperCase() + '" (' + BrowserDetector.API_NAMES[apisList[i]] + ')');
            }
            else {
                result.push('"' + apisList[i].toUpperCase() + '"');
            }
        }
        return result.join(' or ');
    };
    BrowserDetector.meetsRequirements = function (requirements) {
        var matches = /^(\*|win((95|98|2k|nt4|me|xp|2k3|vista|7|8|10|other)(\+)?)?|android|ios|mac|winmobile|linux|unix|other|\*) (32|64|\*) (desktop|mobile|\*) (chrome|firefox|msie|edge|opera|safari|other|\*) ([\d\.]+(\+)?|\*)( apis\=([a-z\_\,\|\d]+))?$/i
            .exec(String(requirements || ''));
        if (!matches)
            return 'E_SYNTAX_ERROR: Invalid requirement: ' + JSON.stringify(requirements);
        var targetOS = matches[1], targetCPUClass = ~~matches[5], targetDeviceType = matches[6], targetBrowser = matches[7], targetBrowserVersion = parseFloat(matches[8]) || -1, targetWinCompare = !!matches[4], targetMinWinVersion = targetWinCompare
            ? targetOS.substr(0, targetOS.length - 1)
            : null, targetBrowserComparision = matches[8] && matches[8].match(/\+$/)
            ? 'gte'
            : 'eq', targetApis = matches[11]
            ? String(matches[11]).split(',')
            : [];
        matches = /^(win((95|98|2k|nt4|me|xp|2k3|vista|7|8|10|other)(\+)?)?|android|ios|mac|winmobile|linux|unix|other) (32|64|\*) (desktop|mobile) (chrome|firefox|msie|edge|opera|safari|other) (.+) apis\=([a-z\_\,\d]+)$/i
            .exec(BrowserDetector.toString);
        if (!matches)
            return 'E_SYNTAX_ERROR: Invalid browser information: ' + JSON.stringify(BrowserDetector.toString);
        var compareOS = matches[1], compareCPUClass = ~~matches[5], compareDeviceType = matches[6], compareBrowser = matches[7], compareBrowserVersion = parseFloat(matches[8]), isWinOS = /^win/.test(compareOS) && compareDeviceType != 'mobile', compareApis = matches[9]
            ? String(matches[9]).split(',')
            : null, i, j, len, n;
        if (targetOS != '*') {
            if (targetWinCompare && !isWinOS) {
                return "E_BAD_OS: Sorry, you need Windows in order to enjoy this application";
            }
            else if (targetWinCompare) {
                targetOS = targetOS.substr(0, targetOS.length - 1);
                var vc = BrowserDetector.winVersionCompare(targetOS, compareOS);
                if (vc < 0) {
                    return "E_BAD_OS:" + targetOS + ": Sorry, you need at least " + (BrowserDetector.WIN_VERSIONS_NAMES[targetOS] || 'an Unknown Windows (' + targetOS + ') version') + ", but you have " + (BrowserDetector.WIN_VERSIONS_NAMES[compareOS] || 'an Unknown Windows (' + compareOS + ') version') + ' installed on your PC';
                }
            }
            else if (targetOS != compareOS) {
                switch (targetOS) {
                    case 'win95':
                    case 'win98':
                    case 'win2k':
                    case 'winnt4':
                    case 'winme':
                    case 'winxp':
                    case 'win2k3':
                    case 'winvista':
                    case 'win7':
                    case 'win8':
                    case 'win10':
                    case 'winother':
                        return "E_BAD_OS: This application requires the '" + BrowserDetector.WIN_VERSIONS_NAMES[compareOS] + "' operating system in order to run properly.";
                    case 'android':
                        return "E_BAD_OS: This applicatoin requires the Android operating system in order to run properly.";
                    case 'mac':
                        return "E_BAD_OS: This application requires the Mac OS operating system in order to run properly.";
                    case 'ios':
                        return "E_BAD_OS: This application requires the IOS operating system in order to run properly.";
                    case 'winmobile':
                        return "E_BAD_OS: This application requires the Windows Mobile operating system in order to run properly.";
                    case 'linux':
                        return "E_BAD_OS: This application requires the Linux operating system in order to run properly";
                    case 'unix':
                        return "E_BAD_OS: This application requires a Unix operating system in order to run properly";
                    case 'other':
                    default:
                        return "E_BAD_OS: Your operating system is not compatible with this application";
                }
            }
        }
        if (targetCPUClass != 0 && compareCPUClass != targetCPUClass) {
            return 'E_BAD_CPU_CLASS: This application requires a ' + String(targetCPUClass) + 'bit CPU in order to run properly, and we detected that you have a ' + String(compareCPUClass) + 'bit CPU';
        }
        if (targetBrowser != '*' && compareBrowser != targetBrowser) {
            return 'E_BAD_BROWSER: Sorry, you need a ' + (BrowserDetector.BROWSER_NAMES[targetBrowser] || 'Special') + ' web browser in order to run this application, but we detected that you have ' + (BrowserDetector.BROWSER_NAMES[compareBrowser] || 'Special') + ' web browser';
        }
        if (targetDeviceType != '*' && compareDeviceType != targetDeviceType) {
            switch (targetDeviceType) {
                case 'mobile':
                    return 'E_MOBILE_APP: This application is not intended to be used on desktop computers. Please try using a mobile device';
                case 'desktop':
                    return 'E_DESKTOP_APP: This application is not intended to be used on mobile devices. Please try using a desktop computer or a laptop';
            }
        }
        if (targetBrowserVersion > -1 && compareBrowserVersion < targetBrowserVersion && targetBrowserComparision == 'gte') {
            return 'E_BROWSER_VERSION: You need at least ' + (BrowserDetector.BROWSER_NAMES[compareBrowser] || 'Special') + ' web browser version ' + targetBrowserVersion.toFixed(2) + ' in order to run this application, but we detected that you have a lower version (' + compareBrowserVersion.toFixed(2) + ')';
        }
        else if (targetBrowserVersion > -1 && ~~compareBrowserVersion != ~~targetBrowserVersion && targetBrowserComparision == 'eq') {
            return 'E_BROWSER_VERSION: You need the ' + (BrowserDetector.BROWSER_NAMES[compareBrowser] || 'Special') + ' web browser version ' + ~~targetBrowserVersion + ' in order to run this application, but we detected that you have a different version (' + ~~compareBrowserVersion + '), which is ' + (compareBrowserVersion > targetBrowserVersion ? 'greater' : 'lower') + ' that the designed browser version of this application';
        }
        var apiOr, apiFound;
        if (targetApis && targetApis.length) {
            for (i = 0, len = targetApis.length; i < len; i++) {
                apiOr = targetApis[i].split('|');
                if (n = apiOr.length) {
                    apiFound = false;
                    for (j = 0; j < n; j++) {
                        if (compareApis.indexOf(apiOr[j]) > -1) {
                            apiFound = true;
                            break;
                        }
                    }
                    if (!apiFound) {
                        return 'E_API_MISSING: Some plugins, browser capabilities or extensions, were not detected: ' + BrowserDetector.explainMissingApis(apiOr);
                    }
                }
            }
        }
        return '';
    };
    BrowserDetector.getRequirementErrorCode = function (requirementErrorMessage) {
        if (requirementErrorMessage == '') {
            return E_DETECTION_ERROR.E_NONE;
        }
        else {
            var matches = /^([A-Z\d\_]+)\:/.exec(requirementErrorMessage);
            if (!matches) {
                return E_DETECTION_ERROR.E_NONE;
            }
            else {
                switch (matches[1]) {
                    case 'E_SYNTAX_ERROR':
                        return E_DETECTION_ERROR.E_SYNTAX_ERROR;
                    case 'E_BAD_OS':
                        return E_DETECTION_ERROR.E_BAD_OS;
                    case 'E_MOBILE_APP':
                        return E_DETECTION_ERROR.E_MOBILE_APP;
                    case 'E_DESKTOP_APP':
                        return E_DETECTION_ERROR.E_DESKTOP_APP;
                    case 'E_BAD_CPU_CLASS':
                        return E_DETECTION_ERROR.E_BAD_CPU_CLASS;
                    case 'E_BROWSER_VERSION':
                        return E_DETECTION_ERROR.E_BROWSER_VERSION;
                    case 'E_BROWSER_TYPE':
                        return E_DETECTION_ERROR.E_BROWSER_TYPE;
                    case 'E_API_MISSING':
                        return E_DETECTION_ERROR.E_API_MISSING;
                    default:
                        return E_DETECTION_ERROR.E_UNKNOWN_ERROR;
                }
            }
        }
    };
    BrowserDetector.isMobileDefaultBrowser = function () {
        return BrowserDetector.meetsRequirements('android * mobile chrome 42+') == ''
            ? false
            : BrowserDetector.meetsRequirements('android * mobile chrome *') == ''
                ? true
                : false;
    };
    BrowserDetector.CPU_64_CLASSES = [
        'x86_64', 'x86-64', 'Win64', 'x64;', 'amd64',
        'amd64', 'AMD64', 'WOW64', 'x64_64',
        'ia64', 'sparc64', 'ppc64', 'IRIX64'
    ];
    BrowserDetector.WIN_VERSIONS_NAMES = {
        "win95": "Windows 95",
        "win98": "Windows 98",
        "win2k": "Windows 2000",
        "winnt4": "Windows NT 4.0",
        "winme": "Windows Millenium",
        "winxp": "Windows XP",
        "win2k3": "Windows 2003 Server",
        "winvista": "Windows Vista",
        "win7": "Windows 7",
        "win8": "Windows 8",
        "win10": "Windows 10",
        "winother": "Windows > 10",
        "win": "Windows"
    };
    BrowserDetector.WIN_VERSIONS_RELEASE_ORDER = [
        "win",
        "win95",
        "win98",
        "winnt4",
        "winme",
        "win2k",
        "winxp",
        "win2k3",
        "winvista",
        "win7",
        "win8",
        "win10",
        "winother"
    ];
    BrowserDetector.BROWSER_NAMES = {
        "chrome": "Google Chrome",
        "firefox": "Mozilla Firefox",
        "msie": "Microsoft Internet Explorer",
        "edge": "Microsoft Edge",
        "opera": "Opera",
        "safari": "Safari",
        "other": "Non Standard"
    };
    BrowserDetector.APIS_LIST = [
        'ArrayBuffer',
        'Audio',
        'localStorage',
        'sessionStorage',
        'DataView',
        'Crypto',
        'CryptoKey',
        'File',
        'FileReader',
        'Blob',
        'Int16Array',
        'Int32Array',
        'Int8Array',
        'HTMLCanvasElement',
        'HTMLVideoElement',
        'HTMLAudioElement',
        'HTMLShadowElement',
        'CanvasRenderingContext2D',
        'URL',
        'MediaSource',
        'MediaStream',
        'AudioBuffer',
        'Promise',
        "Worker",
        "postMessage",
        "XMLHttpRequest"
    ];
    BrowserDetector.API_NAMES = {
        "arraybuffer": "HTML5 ArrayBuffer API ( fixed length, raw binary data buffer )",
        "audio": "HTML5 Audio element API ( support for playing audio )",
        "localStorage": "HTML5 Local Storage API ( support for storing data on your browser )",
        "sessionStorage": "HTML5 Session Storage API ( support for storing data on your browser )",
        "dataview": "HTML5 DataView API ( low-level interface for reading data from and writing it to an ArrayBuffer )",
        "crypto": "HTML5 Crpytography functions",
        "cryptokey": "HTML5 Cryptography functions",
        "file": "HTML5 File API ( provides information about files and allows to access their contents )",
        "filereader": "HTML5 FileReader API ( lets web applications asynchronously read the contents of files / raw data buffers stored on your device or computer, using File or Blob objects to specify the file or data to read )",
        "blob": "HTML5 Blob API ( a file-like object of immutable, raw data )",
        "int16array": "HTML5 Int16Array API ( an array of twos-complement 16-bit signed integers in the platform byte order )",
        "int8array": "HTML5 Int8Array API ( an array of twos-complement 8-bit signed integers )",
        "int32array": "HTML5 Int32Array API ( an array of twos-complement 32-bit signed integers )",
        "htmlcanvaselement": "HTML5 Canvas API ( allows application to draw 2D or 3D graphics using accelerated techniques / and your video card's hardware )",
        "htmlvideoelement": "HTML5 Video Element API ( allows playing videos on your web browser, without the need of using external plugins )",
        "htmlaudioelement": "HTML5 Audio Element API ( allows playing sounds on your web browser, without the need of using external plugins )",
        "htmlshadowelement": "HTML5 Shadow DOM API ( provides encapsulation for the JavaScript, CSS and HTML support for web developers, in order to create high speed web pages )",
        "canvasrenderingcontext2d": "HTML5 Canvas element 2D drawing routines API",
        "url": "HTML5 URL API ( allows functions related with URL's and in-memory URL's for your web browser, including Video Streaming and Audio Streaming related ones )",
        "mediasource": "HTLM5 MediaSource API ( technology that provides video and audio streaming for your web browser )",
        "audiobuffer": "HTML5 AudioBuffer API ( technology that provides audio streaming and buffer for your web browser )",
        "flash": "Adobe Flash plugin",
        "nagra": "Encrypted video streaming support Player",
        "nagrapepper": "Encrypted video streaming support Player Google Chrome browser extension",
        "promise": "Asynchronous data types, which make your browser run smoothly",
        "worker": "HTML5 Web Worker API",
        "postmessage": "A technology used for inter-frame communication",
        "xmlhttprequest": "HTML async transport inside browser (AJAX)"
    };
    return BrowserDetector;
}());
var LZString = (function () {
    function LZString() {
    }
    LZString.getBaseValue = function (alphabet, character) {
        if (!this.baseReverseDic[alphabet]) {
            this.baseReverseDic[alphabet] = {};
            for (var i = 0; i < alphabet.length; i++) {
                this.baseReverseDic[alphabet][alphabet.charAt(i)] = i;
            }
        }
        return this.baseReverseDic[alphabet][character];
    };
    LZString.atob = function (input) {
        var _this = this;
        if (null === input)
            return "";
        var res = this._compress(input, 6, function (a) { return _this.keyStrBase64.charAt(a); });
        switch (res.length % 4) {
            default:
            case 0:
                return res;
            case 1:
                return res + "===";
            case 2:
                return res + "==";
            case 3:
                return res + "=";
        }
    };
    LZString.btoa = function (input) {
        var _this = this;
        if (null === input)
            return "";
        if ("" === input)
            return null;
        return this._decompress(input.length, 32, function (index) { return _this.getBaseValue(_this.keyStrBase64, input.charAt(index)); });
    };
    LZString.compressToUTF16 = function (input) {
        if (null === input)
            return "";
        return this._compress(input, 15, function (a) { return String.fromCharCode(a + 32); }) + " ";
    };
    LZString.decompressFromUTF16 = function (compressed) {
        if (null === compressed)
            return "";
        if ("" === compressed)
            return null;
        return this._decompress(compressed.length, 16384, function (index) { return compressed.charCodeAt(index) - 32; });
    };
    LZString.compressToUint8Array = function (uncompressed) {
        var compressed = this.compress(uncompressed), buf = new Uint8Array(compressed.length * 2), current_value;
        for (var i = 0, TotalLen = compressed.length; i < TotalLen; i++) {
            current_value = compressed.charCodeAt(i);
            buf[i * 2] = current_value >>> 8;
            buf[i * 2 + 1] = current_value % 256;
        }
        return buf;
    };
    LZString.decompressFromUint8Array = function (compressed) {
        if (null === compressed || undefined === compressed) {
            return this.decompress(compressed);
        }
        else {
            var buf = new Array(compressed.length / 2);
            for (var i = 0, TotalLen = buf.length; i < TotalLen; i++) {
                buf[i] = compressed[i * 2] * 256 + compressed[i * 2 + 1];
            }
            var result_1 = [];
            buf.forEach(function (c) {
                result_1.push(String.fromCharCode(c));
            });
            return this.decompress(result_1.join(''));
        }
    };
    LZString.compressToEncodedURIComponent = function (input) {
        var _this = this;
        if (null === input)
            return "";
        return this._compress(input, 6, function (a) { return _this.keyStrUriSafe.charAt(a); });
    };
    LZString.decompressFromEncodedURIComponent = function (input) {
        var _this = this;
        if (null === input)
            return "";
        if ("" === input)
            return null;
        input = input.replace(/ /g, "+");
        return this._decompress(input.length, 32, function (index) { return _this.getBaseValue(_this.keyStrUriSafe, input.charAt(index)); });
    };
    LZString.compress = function (uncompressed) {
        return this._compress(uncompressed, 16, function (a) { return String.fromCharCode(a); });
    };
    LZString._compress = function (uncompressed, bitsPerChar, getCharFromInt) {
        if (null === uncompressed)
            return "";
        var i, value, context_dictionary = {}, context_dictionaryToCreate = {}, context_c = "", context_wc = "", context_w = "", context_enlargeIn = 2, context_dictSize = 3, context_numBits = 2, context_data = [], context_data_val = 0, context_data_position = 0, ii;
        for (ii = 0; ii < uncompressed.length; ii += 1) {
            context_c = uncompressed.charAt(ii);
            if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {
                context_dictionary[context_c] = context_dictSize++;
                context_dictionaryToCreate[context_c] = true;
            }
            context_wc = context_w + context_c;
            if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {
                context_w = context_wc;
            }
            else {
                if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {
                    if (context_w.charCodeAt(0) < 256) {
                        for (i = 0; i < context_numBits; i++) {
                            context_data_val = (context_data_val << 1);
                            if (context_data_position == bitsPerChar - 1) {
                                context_data_position = 0;
                                context_data.push(getCharFromInt(context_data_val));
                                context_data_val = 0;
                            }
                            else {
                                context_data_position++;
                            }
                        }
                        value = context_w.charCodeAt(0);
                        for (i = 0; i < 8; i++) {
                            context_data_val = (context_data_val << 1) | (value & 1);
                            if (context_data_position == bitsPerChar - 1) {
                                context_data_position = 0;
                                context_data.push(getCharFromInt(context_data_val));
                                context_data_val = 0;
                            }
                            else {
                                context_data_position++;
                            }
                            value = value >> 1;
                        }
                    }
                    else {
                        value = 1;
                        for (i = 0; i < context_numBits; i++) {
                            context_data_val = (context_data_val << 1) | value;
                            if (context_data_position == bitsPerChar - 1) {
                                context_data_position = 0;
                                context_data.push(getCharFromInt(context_data_val));
                                context_data_val = 0;
                            }
                            else {
                                context_data_position++;
                            }
                            value = 0;
                        }
                        value = context_w.charCodeAt(0);
                        for (i = 0; i < 16; i++) {
                            context_data_val = (context_data_val << 1) | (value & 1);
                            if (context_data_position == bitsPerChar - 1) {
                                context_data_position = 0;
                                context_data.push(getCharFromInt(context_data_val));
                                context_data_val = 0;
                            }
                            else {
                                context_data_position++;
                            }
                            value = value >> 1;
                        }
                    }
                    context_enlargeIn--;
                    if (context_enlargeIn == 0) {
                        context_enlargeIn = Math.pow(2, context_numBits);
                        context_numBits++;
                    }
                    delete context_dictionaryToCreate[context_w];
                }
                else {
                    value = context_dictionary[context_w];
                    for (i = 0; i < context_numBits; i++) {
                        context_data_val = (context_data_val << 1) | (value & 1);
                        if (context_data_position == bitsPerChar - 1) {
                            context_data_position = 0;
                            context_data.push(getCharFromInt(context_data_val));
                            context_data_val = 0;
                        }
                        else {
                            context_data_position++;
                        }
                        value = value >> 1;
                    }
                }
                context_enlargeIn--;
                if (context_enlargeIn == 0) {
                    context_enlargeIn = Math.pow(2, context_numBits);
                    context_numBits++;
                }
                context_dictionary[context_wc] = context_dictSize++;
                context_w = String(context_c);
            }
        }
        if (context_w !== "") {
            if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {
                if (context_w.charCodeAt(0) < 256) {
                    for (i = 0; i < context_numBits; i++) {
                        context_data_val = (context_data_val << 1);
                        if (context_data_position == bitsPerChar - 1) {
                            context_data_position = 0;
                            context_data.push(getCharFromInt(context_data_val));
                            context_data_val = 0;
                        }
                        else {
                            context_data_position++;
                        }
                    }
                    value = context_w.charCodeAt(0);
                    for (i = 0; i < 8; i++) {
                        context_data_val = (context_data_val << 1) | (value & 1);
                        if (context_data_position == bitsPerChar - 1) {
                            context_data_position = 0;
                            context_data.push(getCharFromInt(context_data_val));
                            context_data_val = 0;
                        }
                        else {
                            context_data_position++;
                        }
                        value = value >> 1;
                    }
                }
                else {
                    value = 1;
                    for (i = 0; i < context_numBits; i++) {
                        context_data_val = (context_data_val << 1) | value;
                        if (context_data_position == bitsPerChar - 1) {
                            context_data_position = 0;
                            context_data.push(getCharFromInt(context_data_val));
                            context_data_val = 0;
                        }
                        else {
                            context_data_position++;
                        }
                        value = 0;
                    }
                    value = context_w.charCodeAt(0);
                    for (i = 0; i < 16; i++) {
                        context_data_val = (context_data_val << 1) | (value & 1);
                        if (context_data_position == bitsPerChar - 1) {
                            context_data_position = 0;
                            context_data.push(getCharFromInt(context_data_val));
                            context_data_val = 0;
                        }
                        else {
                            context_data_position++;
                        }
                        value = value >> 1;
                    }
                }
                context_enlargeIn--;
                if (context_enlargeIn == 0) {
                    context_enlargeIn = Math.pow(2, context_numBits);
                    context_numBits++;
                }
                delete context_dictionaryToCreate[context_w];
            }
            else {
                value = context_dictionary[context_w];
                for (i = 0; i < context_numBits; i++) {
                    context_data_val = (context_data_val << 1) | (value & 1);
                    if (context_data_position == bitsPerChar - 1) {
                        context_data_position = 0;
                        context_data.push(getCharFromInt(context_data_val));
                        context_data_val = 0;
                    }
                    else {
                        context_data_position++;
                    }
                    value = value >> 1;
                }
            }
            context_enlargeIn--;
            if (context_enlargeIn == 0) {
                context_enlargeIn = Math.pow(2, context_numBits);
                context_numBits++;
            }
        }
        value = 2;
        for (i = 0; i < context_numBits; i++) {
            context_data_val = (context_data_val << 1) | (value & 1);
            if (context_data_position == bitsPerChar - 1) {
                context_data_position = 0;
                context_data.push(getCharFromInt(context_data_val));
                context_data_val = 0;
            }
            else {
                context_data_position++;
            }
            value = value >> 1;
        }
        while (true) {
            context_data_val = (context_data_val << 1);
            if (context_data_position == bitsPerChar - 1) {
                context_data.push(getCharFromInt(context_data_val));
                break;
            }
            else
                context_data_position++;
        }
        return context_data.join('');
    };
    LZString.decompress = function (compressed) {
        if (null == compressed)
            return "";
        if ("" == compressed)
            return null;
        return this._decompress(compressed.length, 32768, function (index) { return compressed.charCodeAt(index); });
    };
    LZString._decompress = function (length, resetValue, getNextValue) {
        var dictionary = [], next, enlargeIn = 4, dictSize = 4, numBits = 3, entry = "", result = [], i, w, bits, resb, maxpower, power, c, data = { val: getNextValue(0), position: resetValue, index: 1 };
        for (i = 0; i < 3; i++) {
            dictionary[i] = i;
        }
        bits = 0;
        maxpower = Math.pow(2, 2);
        power = 1;
        while (power != maxpower) {
            resb = data.val & data.position;
            data.position >>= 1;
            if (data.position == 0) {
                data.position = resetValue;
                data.val = getNextValue(data.index++);
            }
            bits |= (resb > 0 ? 1 : 0) * power;
            power <<= 1;
        }
        switch (next = bits) {
            case 0:
                bits = 0;
                maxpower = Math.pow(2, 8);
                power = 1;
                while (power != maxpower) {
                    resb = data.val & data.position;
                    data.position >>= 1;
                    if (data.position == 0) {
                        data.position = resetValue;
                        data.val = getNextValue(data.index++);
                    }
                    bits |= (resb > 0 ? 1 : 0) * power;
                    power <<= 1;
                }
                c = String.fromCharCode(bits);
                break;
            case 1:
                bits = 0;
                maxpower = Math.pow(2, 16);
                power = 1;
                while (power != maxpower) {
                    resb = data.val & data.position;
                    data.position >>= 1;
                    if (data.position == 0) {
                        data.position = resetValue;
                        data.val = getNextValue(data.index++);
                    }
                    bits |= (resb > 0 ? 1 : 0) * power;
                    power <<= 1;
                }
                c = String.fromCharCode(bits);
                break;
            case 2:
                return "";
        }
        dictionary[3] = c;
        w = c;
        result.push(c);
        while (true) {
            if (data.index > length) {
                return "";
            }
            bits = 0;
            maxpower = Math.pow(2, numBits);
            power = 1;
            while (power != maxpower) {
                resb = data.val & data.position;
                data.position >>= 1;
                if (data.position == 0) {
                    data.position = resetValue;
                    data.val = getNextValue(data.index++);
                }
                bits |= (resb > 0 ? 1 : 0) * power;
                power <<= 1;
            }
            switch (c = bits) {
                case 0:
                    bits = 0;
                    maxpower = Math.pow(2, 8);
                    power = 1;
                    while (power != maxpower) {
                        resb = data.val & data.position;
                        data.position >>= 1;
                        if (data.position == 0) {
                            data.position = resetValue;
                            data.val = getNextValue(data.index++);
                        }
                        bits |= (resb > 0 ? 1 : 0) * power;
                        power <<= 1;
                    }
                    dictionary[dictSize++] = String.fromCharCode(bits);
                    c = dictSize - 1;
                    enlargeIn--;
                    break;
                case 1:
                    bits = 0;
                    maxpower = Math.pow(2, 16);
                    power = 1;
                    while (power != maxpower) {
                        resb = data.val & data.position;
                        data.position >>= 1;
                        if (data.position == 0) {
                            data.position = resetValue;
                            data.val = getNextValue(data.index++);
                        }
                        bits |= (resb > 0 ? 1 : 0) * power;
                        power <<= 1;
                    }
                    dictionary[dictSize++] = String.fromCharCode(bits);
                    c = dictSize - 1;
                    enlargeIn--;
                    break;
                case 2:
                    return result.join('');
            }
            if (enlargeIn == 0) {
                enlargeIn = Math.pow(2, numBits);
                numBits++;
            }
            if (dictionary[c]) {
                entry = dictionary[c];
            }
            else {
                if (c === dictSize) {
                    entry = w + w.charAt(0);
                }
                else {
                    return null;
                }
            }
            result.push(entry);
            dictionary[dictSize++] = w + entry.charAt(0);
            enlargeIn--;
            w = entry;
            if (enlargeIn == 0) {
                enlargeIn = Math.pow(2, numBits);
                numBits++;
            }
        }
    };
    LZString.keyStrBase64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
    LZString.keyStrUriSafe = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";
    LZString.baseReverseDic = {};
    return LZString;
}());
var MimeTypeService = (function () {
    function MimeTypeService(i18n) {
        this.defaultMimeType = 'application/octet-stream';
        this.mimeTypes = {
            "3dm": "x-world/x-3dmf",
            "3dmf": "x-world/x-3dmf",
            "a": "application/octet-stream",
            "aab": "application/x-authorware-bin",
            "aam": "application/x-authorware-map",
            "aas": "application/x-authorware-seg",
            "abc": "text/vnd.abc",
            "acgi": "text/html",
            "afl": "video/animaflex",
            "ai": "application/postscript",
            "aif": "audio/x-aiff",
            "aifc": "audio/x-aiff",
            "aiff": "audio/x-aiff",
            "aim": "application/x-aim",
            "aip": "text/x-audiosoft-intra",
            "ani": "application/x-navi-animation",
            "aos": "application/x-nokia-9000-communicator-add-on-software",
            "aps": "application/mime",
            "arc": "application/octet-stream",
            "arj": "application/octet-stream",
            "art": "image/x-jg",
            "asf": "video/x-ms-asf",
            "asm": "text/x-asm",
            "asp": "text/asp",
            "asx": "video/x-ms-asf-plugin",
            "au": "audio/x-au",
            "avi": "video/x-msvideo",
            "avs": "video/avs-video",
            "bcpio": "application/x-bcpio",
            "bin": "application/x-macbinary",
            "bm": "image/bmp",
            "bmp": "image/x-windows-bmp",
            "boo": "application/book",
            "book": "application/book",
            "boz": "application/x-bzip2",
            "bsh": "application/x-bsh",
            "bz": "application/x-bzip",
            "bz2": "application/x-bzip2",
            "c": "text/x-c",
            "c++": "text/plain",
            "cat": "application/vnd.ms-pki.seccat",
            "cc": "text/x-c",
            "ccad": "application/clariscad",
            "cco": "application/x-cocoa",
            "cdf": "application/x-netcdf",
            "cer": "application/x-x509-ca-cert",
            "cha": "application/x-chat",
            "chat": "application/x-chat",
            "class": "application/x-java-class",
            "com": "text/plain",
            "conf": "text/plain",
            "cpio": "application/x-cpio",
            "cpp": "text/x-c",
            "cpt": "application/x-cpt",
            "crl": "application/pkix-crl",
            "crt": "application/x-x509-user-cert",
            "csh": "text/x-script.csh",
            "css": "text/css",
            "cxx": "text/plain",
            "dcr": "application/x-director",
            "deepv": "application/x-deepv",
            "def": "text/plain",
            "der": "application/x-x509-ca-cert",
            "dif": "video/x-dv",
            "dir": "application/x-director",
            "dl": "video/x-dl",
            "doc": "application/msword",
            "dot": "application/msword",
            "dp": "application/commonground",
            "drw": "application/drafting",
            "dump": "application/octet-stream",
            "dv": "video/x-dv",
            "dvi": "application/x-dvi",
            "dwf": "model/vnd.dwf",
            "dwg": "image/x-dwg",
            "dxf": "image/x-dwg",
            "dxr": "application/x-director",
            "el": "text/x-script.elisp",
            "elc": "application/x-elc",
            "env": "application/x-envoy",
            "eps": "application/postscript",
            "es": "application/x-esrehber",
            "etx": "text/x-setext",
            "evy": "application/x-envoy",
            "exe": "application/octet-stream",
            "f": "text/x-fortran",
            "f77": "text/x-fortran",
            "f90": "text/x-fortran",
            "fdf": "application/vnd.fdf",
            "fif": "image/fif",
            "fli": "video/x-fli",
            "flo": "image/florian",
            "flx": "text/vnd.fmi.flexstor",
            "fmf": "video/x-atomic3d-feature",
            "for": "text/x-fortran",
            "fpx": "image/vnd.net-fpx",
            "frl": "application/freeloader",
            "funk": "audio/make",
            "g": "text/plain",
            "g3": "image/g3fax",
            "gif": "image/gif",
            "gl": "video/x-gl",
            "gsd": "audio/x-gsm",
            "gsm": "audio/x-gsm",
            "gsp": "application/x-gsp",
            "gss": "application/x-gss",
            "gtar": "application/x-gtar",
            "gz": "application/x-gzip",
            "gzip": "multipart/x-gzip",
            "h": "text/x-h",
            "hdf": "application/x-hdf",
            "help": "application/x-helpfile",
            "hgl": "application/vnd.hp-hpgl",
            "hh": "text/x-h",
            "hlb": "text/x-script",
            "hlp": "application/x-winhelp",
            "hpg": "application/vnd.hp-hpgl",
            "hpgl": "application/vnd.hp-hpgl",
            "hqx": "application/x-mac-binhex40",
            "hta": "application/hta",
            "htc": "text/x-component",
            "htm": "text/html",
            "html": "text/html",
            "htmls": "text/html",
            "htt": "text/webviewhtml",
            "htx": "text/html",
            "ice": "x-conference/x-cooltalk",
            "ico": "image/x-icon",
            "idc": "text/plain",
            "ief": "image/ief",
            "iefs": "image/ief",
            "iges": "model/iges",
            "igs": "model/iges",
            "ima": "application/x-ima",
            "imap": "application/x-httpd-imap",
            "inf": "application/inf",
            "ins": "application/x-internett-signup",
            "ip": "application/x-ip2",
            "isu": "video/x-isvideo",
            "it": "audio/it",
            "iv": "application/x-inventor",
            "ivr": "i-world/i-vrml",
            "ivy": "application/x-livescreen",
            "jam": "audio/x-jam",
            "jav": "text/x-java-source",
            "java": "text/x-java-source",
            "jcm": "application/x-java-commerce",
            "jfif": "image/pjpeg",
            "jfif-tbnl": "image/jpeg",
            "jpe": "image/pjpeg",
            "jpeg": "image/pjpeg",
            "jpg": "image/jpeg",
            "jps": "image/x-jps",
            "js": "text/ecmascript",
            "jut": "image/jutvision",
            "kar": "music/x-karaoke",
            "ksh": "text/x-script.ksh",
            "la": "audio/x-nspaudio",
            "lam": "audio/x-liveaudio",
            "latex": "application/x-latex",
            "lha": "application/x-lha",
            "lhx": "application/octet-stream",
            "list": "text/plain",
            "lma": "audio/x-nspaudio",
            "log": "text/plain",
            "lsp": "text/x-script.lisp",
            "lst": "text/plain",
            "lsx": "text/x-la-asf",
            "ltx": "application/x-latex",
            "lzh": "application/x-lzh",
            "lzx": "application/x-lzx",
            "m": "text/x-m",
            "m1v": "video/mpeg",
            "m2a": "audio/mpeg",
            "m2v": "video/mpeg",
            "m3u": "audio/x-mpequrl",
            "man": "application/x-troff-man",
            "map": "application/x-navimap",
            "mar": "text/plain",
            "mbd": "application/mbedlet",
            "mc$": "application/x-magic-cap-package-1.0",
            "mcd": "application/x-mathcad",
            "mcf": "text/mcf",
            "mcp": "application/netmc",
            "me": "application/x-troff-me",
            "mht": "message/rfc822",
            "mhtml": "message/rfc822",
            "mid": "x-music/x-midi",
            "midi": "x-music/x-midi",
            "mif": "application/x-mif",
            "mime": "www/mime",
            "mjf": "audio/x-vnd.audioexplosion.mjuicemediafile",
            "mjpg": "video/x-motion-jpeg",
            "mm": "application/x-meme",
            "mme": "application/base64",
            "mod": "audio/x-mod",
            "moov": "video/quicktime",
            "mov": "video/quicktime",
            "movie": "video/x-sgi-movie",
            "mp2": "video/x-mpeq2a",
            "mp3": "video/x-mpeg",
            "mpa": "video/mpeg",
            "mpc": "application/x-project",
            "mpe": "video/mpeg",
            "mpeg": "video/mpeg",
            "mpg": "video/mpeg",
            "mpga": "audio/mpeg",
            "mpp": "application/vnd.ms-project",
            "mpt": "application/x-project",
            "mpv": "application/x-project",
            "mpx": "application/x-project",
            "mrc": "application/marc",
            "ms": "application/x-troff-ms",
            "mv": "video/x-sgi-movie",
            "my": "audio/make",
            "mzz": "application/x-vnd.audioexplosion.mzz",
            "nap": "image/naplps",
            "naplps": "image/naplps",
            "nc": "application/x-netcdf",
            "ncm": "application/vnd.nokia.configuration-message",
            "nif": "image/x-niff",
            "niff": "image/x-niff",
            "nix": "application/x-mix-transfer",
            "nsc": "application/x-conference",
            "nvd": "application/x-navidoc",
            "o": "application/octet-stream",
            "oda": "application/oda",
            "omc": "application/x-omc",
            "omcd": "application/x-omcdatamaker",
            "omcr": "application/x-omcregerator",
            "p": "text/x-pascal",
            "p10": "application/x-pkcs10",
            "p12": "application/x-pkcs12",
            "p7a": "application/x-pkcs7-signature",
            "p7c": "application/x-pkcs7-mime",
            "p7m": "application/x-pkcs7-mime",
            "p7r": "application/x-pkcs7-certreqresp",
            "p7s": "application/pkcs7-signature",
            "part": "application/pro_eng",
            "pas": "text/pascal",
            "pbm": "image/x-portable-bitmap",
            "pcl": "application/x-pcl",
            "pct": "image/x-pict",
            "pcx": "image/x-pcx",
            "pdb": "chemical/x-pdb",
            "pdf": "application/pdf",
            "pfunk": "audio/make.my.funk",
            "pgm": "image/x-portable-greymap",
            "pic": "image/pict",
            "pict": "image/pict",
            "pkg": "application/x-newton-compatible-pkg",
            "pko": "application/vnd.ms-pki.pko",
            "pl": "text/x-script.perl",
            "plx": "application/x-pixclscript",
            "pm": "text/x-script.perl-module",
            "pm4": "application/x-pagemaker",
            "pm5": "application/x-pagemaker",
            "png": "image/png",
            "pnm": "image/x-portable-anymap",
            "pot": "application/vnd.ms-powerpoint",
            "pov": "model/x-pov",
            "ppa": "application/vnd.ms-powerpoint",
            "ppm": "image/x-portable-pixmap",
            "pps": "application/vnd.ms-powerpoint",
            "ppt": "application/x-mspowerpoint",
            "ppz": "application/mspowerpoint",
            "pre": "application/x-freelance",
            "prt": "application/pro_eng",
            "ps": "application/postscript",
            "psd": "application/octet-stream",
            "pvu": "paleovu/x-pv",
            "pwz": "application/vnd.ms-powerpoint",
            "py": "text/x-script.phyton",
            "pyc": "application/x-bytecode.python",
            "qcp": "audio/vnd.qcelp",
            "qd3": "x-world/x-3dmf",
            "qd3d": "x-world/x-3dmf",
            "qif": "image/x-quicktime",
            "qt": "video/quicktime",
            "qtc": "video/x-qtc",
            "qti": "image/x-quicktime",
            "qtif": "image/x-quicktime",
            "ra": "audio/x-realaudio",
            "ram": "audio/x-pn-realaudio",
            "ras": "image/x-cmu-raster",
            "rast": "image/cmu-raster",
            "rexx": "text/x-script.rexx",
            "rf": "image/vnd.rn-realflash",
            "rgb": "image/x-rgb",
            "rm": "audio/x-pn-realaudio",
            "rmi": "audio/mid",
            "rmm": "audio/x-pn-realaudio",
            "rmp": "audio/x-pn-realaudio-plugin",
            "rng": "application/vnd.nokia.ringing-tone",
            "rnx": "application/vnd.rn-realplayer",
            "roff": "application/x-troff",
            "rp": "image/vnd.rn-realpix",
            "rpm": "audio/x-pn-realaudio-plugin",
            "rt": "text/vnd.rn-realtext",
            "rtf": "text/richtext",
            "rtx": "text/richtext",
            "rv": "video/vnd.rn-realvideo",
            "s": "text/x-asm",
            "s3m": "audio/s3m",
            "saveme": "application/octet-stream",
            "sbk": "application/x-tbook",
            "scm": "video/x-scm",
            "sdml": "text/plain",
            "sdp": "application/x-sdp",
            "sdr": "application/sounder",
            "sea": "application/x-sea",
            "set": "application/set",
            "sgm": "text/x-sgml",
            "sgml": "text/x-sgml",
            "sh": "text/x-script.sh",
            "shar": "application/x-shar",
            "shtml": "text/x-server-parsed-html",
            "sid": "audio/x-psid",
            "sit": "application/x-stuffit",
            "skd": "application/x-koan",
            "skm": "application/x-koan",
            "skp": "application/x-koan",
            "skt": "application/x-koan",
            "sl": "application/x-seelogo",
            "smi": "application/smil",
            "smil": "application/smil",
            "snd": "audio/x-adpcm",
            "sol": "application/solids",
            "spc": "text/x-speech",
            "spl": "application/futuresplash",
            "spr": "application/x-sprite",
            "sprite": "application/x-sprite",
            "src": "application/x-wais-source",
            "ssi": "text/x-server-parsed-html",
            "ssm": "application/streamingmedia",
            "sst": "application/vnd.ms-pki.certstore",
            "step": "application/step",
            "stl": "application/x-navistyle",
            "stp": "application/step",
            "sv4cpio": "application/x-sv4cpio",
            "sv4crc": "application/x-sv4crc",
            "svf": "image/x-dwg",
            "svr": "x-world/x-svr",
            "swf": "application/x-shockwave-flash",
            "t": "application/x-troff",
            "talk": "text/x-speech",
            "tar": "application/x-tar",
            "tbk": "application/x-tbook",
            "tcl": "text/x-script.tcl",
            "tcsh": "text/x-script.tcsh",
            "tex": "application/x-tex",
            "texi": "application/x-texinfo",
            "texinfo": "application/x-texinfo",
            "text": "text/plain",
            "tgz": "application/x-compressed",
            "tif": "image/x-tiff",
            "tiff": "image/x-tiff",
            "tr": "application/x-troff",
            "tsi": "audio/tsp-audio",
            "tsp": "audio/tsplayer",
            "tsv": "text/tab-separated-values",
            "turbot": "image/florian",
            "txt": "text/plain",
            "uil": "text/x-uil",
            "uni": "text/uri-list",
            "unis": "text/uri-list",
            "unv": "application/i-deas",
            "uri": "text/uri-list",
            "uris": "text/uri-list",
            "ustar": "multipart/x-ustar",
            "uu": "text/x-uuencode",
            "uue": "text/x-uuencode",
            "vcd": "application/x-cdlink",
            "vcs": "text/x-vcalendar",
            "vda": "application/vda",
            "vdo": "video/vdo",
            "vew": "application/groupwise",
            "viv": "video/vnd.vivo",
            "vivo": "video/vnd.vivo",
            "vmd": "application/vocaltec-media-desc",
            "vmf": "application/vocaltec-media-file",
            "voc": "audio/x-voc",
            "vos": "video/vosaic",
            "vox": "audio/voxware",
            "vqe": "audio/x-twinvq-plugin",
            "vqf": "audio/x-twinvq",
            "vql": "audio/x-twinvq-plugin",
            "vrml": "x-world/x-vrml",
            "vrt": "x-world/x-vrt",
            "vsd": "application/x-visio",
            "vst": "application/x-visio",
            "vsw": "application/x-visio",
            "w60": "application/wordperfect6.0",
            "w61": "application/wordperfect6.1",
            "w6w": "application/msword",
            "wav": "audio/x-wav",
            "wb1": "application/x-qpro",
            "wbmp": "image/vnd.wap.wbmp",
            "web": "application/vnd.xara",
            "wiz": "application/msword",
            "wk1": "application/x-123",
            "wmf": "windows/metafile",
            "wml": "text/vnd.wap.wml",
            "wmlc": "application/vnd.wap.wmlc",
            "wmls": "text/vnd.wap.wmlscript",
            "wmlsc": "application/vnd.wap.wmlscriptc",
            "word": "application/msword",
            "wp": "application/wordperfect",
            "wp5": "application/wordperfect",
            "wp6": "application/wordperfect",
            "wpd": "application/wordperfect",
            "wq1": "application/x-lotus",
            "wri": "application/mswrite",
            "wrl": "application/x-world",
            "wrz": "model/vrml",
            "wsc": "text/scriplet",
            "wsrc": "application/x-wais-source",
            "wtk": "application/x-wintalk",
            "xbm": "image/x-xbitmap",
            "xdr": "video/x-amt-demorun",
            "xgz": "xgl/drawing",
            "xif": "image/vnd.xiff",
            "xl": "application/excel",
            "xla": "application/x-msexcel",
            "xlb": "application/excel",
            "xlc": "application/x-excel",
            "xld": "application/x-excel",
            "xll": "application/vnd.ms-excel",
            "xlm": "application/vnd.ms-excel",
            "xls": "application/vnd.ms-excel",
            "xlt": "application/excel",
            "xlv": "application/excel",
            "xlw": "application/vnd.ms-excel",
            "xm": "audio/xm",
            "xml": "text/xml",
            "xmz": "xgl/movie",
            "xpix": "application/x-vnd.ls-xpix",
            "xpm": "image/xpm",
            "x-png": "image/png",
            "xsr": "video/x-amt-showrun",
            "xwd": "image/x-xwd",
            "xyz": "chemical/x-pdb",
            "z": "application/x-compressed",
            "zip": "application/zip",
            "zoo": "application/octet-stream",
            "zsh": "text/x-script.zsh"
        };
        this.i18n = i18n;
    }
    MimeTypeService.prototype.getMimeType = function (fileName) {
        var parts = /\.([^.]+)$/.exec(fileName), extension;
        if (!parts) {
            return this.defaultMimeType;
        }
        else {
            extension = parts[1].toLowerCase();
            return this.mimeTypes[extension] || this.defaultMimeType;
        }
    };
    MimeTypeService.prototype.getMimeClass = function (fileName) {
        var mimeType = this.getMimeType(fileName), mimeParts = /^([^\/]+)\/([^$]+)$/.exec(mimeType);
        if (!mimeParts) {
            return EFileClass.OTHER;
        }
        else {
            switch (true) {
                case mimeParts[1] == 'image':
                    return EFileClass.PICTURE;
                case mimeParts[1] === 'video':
                    return EFileClass.VIDEO;
                case mimeParts[1] === 'audio':
                    return EFileClass.AUDIO;
                default:
                    return EFileClass.OTHER;
            }
        }
    };
    MimeTypeService.prototype.getFileThumbnailMarkup = function (fileName) {
        var mimeClass = this.getMimeClass(fileName);
        switch (mimeClass) {
            case EFileClass.PICTURE:
                return '<span class="i123-image i-lg font-icon"></span>';
            case EFileClass.AUDIO:
            case EFileClass.OTHER:
            case EFileClass.VIDEO:
            case EFileClass.DOCUMENT:
                return '<span class="i123-file i-lg font-icon"></span>';
        }
    };
    MimeTypeService.prototype.getFileExtension = function (fileName) {
        var matches = /.([^.]+)$/.exec(fileName);
        return matches
            ? matches[1].toUpperCase()
            : '';
    };
    MimeTypeService.prototype.toSentenceCase = function (s) {
        var out = '', isNextCharUpper = true;
        for (var i = 0, len = s.length; i < len; i++) {
            if (s[i] == ' ') {
                isNextCharUpper = true;
                out = out.concat(' ');
            }
            else {
                out = out.concat(isNextCharUpper ? s[i].toUpperCase() : s[i]);
                isNextCharUpper = false;
            }
        }
        return out;
    };
    MimeTypeService.prototype.guessApplicationNameFromMimeType = function (applicationType) {
        var result = applicationType
            .toLowerCase()
            .replace(/[^a-z0-9A-Z]+/g, ' ')
            .replace(/(^v(endor|nd))/g, '')
            .replace(/^x /g, '')
            .replace(/[\s]+/g, ' ')
            .replace(/(^ | $)/g, '');
        return this.toSentenceCase(result);
    };
    MimeTypeService.prototype.getHumanFriendlyFileDescription = function (fileName) {
        var fileExtension = this.getFileExtension(fileName), fileClass = this.getMimeClass(fileName), mimeType = this.getMimeType(fileName), matches = [];
        switch (true) {
            case fileClass === EFileClass.AUDIO:
                return this.i18n.translateText('uploadsManager_MIMETYPE_AudioLike', fileExtension);
            case fileClass === EFileClass.VIDEO:
                return this.i18n.translateText('uploadsManager_MIMETYPE_VideoLike', fileExtension);
            case fileClass === EFileClass.PICTURE:
                return this.i18n.translateText('uploadsManager_MIMETYPE_ImageLike', fileExtension);
            case ['ZIP', 'RAR', 'GZ', '7Z', 'ARJ'].indexOf(fileExtension) > -1:
                return this.i18n.translateText('uploadsManager_MIMETYPE_ArchiveLike', fileExtension);
            case !!(matches = /^application\/([^$]+)$/.exec(mimeType)):
                return this.i18n.translateText('uploadsManager_MIMETYPE_ApplicationLike', this.guessApplicationNameFromMimeType(matches[1]));
            default:
                return this.i18n.translateText('uploadsManager_MIMETYPE_UnknownLike', fileExtension);
        }
    };
    return MimeTypeService;
}());
var TimeUtils = (function () {
    function TimeUtils(i18n) {
        this._tempDate = new Date();
        this._shortDayNames_us = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
        this._shortMonthNames_us = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        this._longMonthNames_us = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "Octomber", "November", "December"];
        this._friendlyTimeFormatWhenYearIsCurrentYear = '%d %M';
        this._friendlyTimeFormatWhenYearIsDifferentThanCurrentYear = '%d %M, %Y';
        this._i18nTimeFormat = {
            "fewSecondsAgo": 'Few seconds ago',
            "fewMinutesAgo": 'Few minutes ago',
            "xMinutesAgo": '%t% minutes ago',
            "xHoursAgo": '%t% hours ago',
            "yesterday": 'Yesterday'
        };
        this.COMMON_TIME_STRINGS = {
            'yesterday': '-1d',
            'today': 'now',
            'tomorrow': '+1d',
            'overmorrow': '+2d',
        };
        this.i18n = i18n;
        this.setI18nService();
    }
    TimeUtils.prototype.setI18nService = function () {
        this._friendlyTimeFormatWhenYearIsCurrentYear = (this.getTranslatedTextIfExistsOrNullOtherwise(this.i18n, 'LOGS_DateFormatWhenYearIsCurrentYear')
            ||
                '%d %M');
        this._friendlyTimeFormatWhenYearIsDifferentThanCurrentYear = (this.getTranslatedTextIfExistsOrNullOtherwise(this.i18n, 'LOGS_DateFormatWhenYearIsDifferentThanCurrentYear')
            ||
                '%d %M, %Y');
        this._i18nDate = (this.i18n.translateText('LOGS_DateInternationalization')
            ||
                'Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|January|February|March|April|May|June|July|August|September|October|November|December').split('|');
        this._weekDays = this._i18nDate.slice(0, 7);
        this._monthNames = this._i18nDate.slice(7);
        this._i18nTime = (this.i18n.translateText('LOGS_TimeInternationalization')
            || 'Few seconds ago|Few minutes ago|%t% minutes ago|%t% hours ago|Yesterday').split('|');
        this._i18nTimeFormat.fewSecondsAgo = this._i18nTime[0];
        this._i18nTimeFormat.fewMinutesAgo = this._i18nTime[1];
        this._i18nTimeFormat.xMinutesAgo = this._i18nTime[2];
        this._i18nTimeFormat.xHoursAgo = this._i18nTime[3];
        this._i18nTimeFormat.yesterday = this._i18nTime[4];
        return this;
    };
    TimeUtils.prototype._formatI18nTime = function (_i18nTimeKey, substituteValue) {
        if (substituteValue === void 0) { substituteValue = 0; }
        return this._i18nTimeFormat[_i18nTimeKey].replace(/%t%/g, String(substituteValue || ''));
    };
    TimeUtils.prototype._padNumber = function (number, toDigits) {
        var result = String(~~number);
        toDigits = ~~toDigits;
        while (result.length < toDigits) {
            result = '0' + result;
        }
        return result;
    };
    TimeUtils.prototype.formatTimeFriendly = function (timeStamp) {
        timeStamp = ~~timeStamp;
        if (timeStamp === 0) {
            return ' ';
        }
        var currentTime = +new Date() / 1000, timeDiff = currentTime - timeStamp, thisYear = 0;
        this._tempDate.setTime(timeStamp * 1000);
        switch (true) {
            case timeDiff < 60:
                return this._formatI18nTime('fewSecondsAgo', timeDiff);
            case timeDiff < 300:
                return this._formatI18nTime('fewMinutesAgo', ~~(timeDiff / 60));
            case timeDiff < 3600:
                return this._formatI18nTime('xMinutesAgo', ~~(timeDiff / 60));
            case timeDiff < 86400:
                return (this._tempDate.getDay() != (new Date()).getDay())
                    ? this._formatI18nTime('yesterday')
                        + ', '
                        + this._padNumber(this._tempDate.getHours(), 2)
                        + ':'
                        + this._padNumber(this._tempDate.getMinutes(), 2)
                    : this._formatI18nTime('xHoursAgo', Math.round(timeDiff / 3600));
            case timeDiff <= (6 * 86400):
                return this._weekDays[this._tempDate.getDay()];
            default:
                return this._tempDate.getFullYear() === (thisYear = (new Date()).getFullYear())
                    ? this.formatTime(timeStamp, this._friendlyTimeFormatWhenYearIsCurrentYear)
                    : this.formatTime(timeStamp, this._friendlyTimeFormatWhenYearIsDifferentThanCurrentYear);
        }
    };
    TimeUtils.prototype.getKey = function (str, arr) {
        var i = 0, s = str.toLowerCase(), e;
        for (var i_1 = 0; i_1 < arr.length; i_1++) {
            e = arr[i_1].toString().toLowerCase();
            if (s.substr(0, e.length) == e)
                return i_1;
        }
        throw new Error('Date.prototype: Unparsable string: key not found (str=' + str + ', arr=[' + arr.join(',') + ')!');
    };
    TimeUtils.prototype.unpadDigitsFromString = function (paddedWith0DigitString) {
        if (paddedWith0DigitString == '')
            return 0;
        var s = paddedWith0DigitString.toString(), i = 0, result, returnValue;
        while ((i < s.length) && (s.charAt(i) == '0'))
            i++;
        result = parseInt(s.substr(i));
        returnValue = !isNaN(result)
            ? result
            : 0;
        return returnValue;
    };
    TimeUtils.prototype.readNumberFromAString = function (stringBuffer, minDigits, maxDigits, maxValue) {
        var convertedToStringArgument = stringBuffer.toString();
        if (convertedToStringArgument.length < minDigits)
            throw new Error('TimeUtils: cannot parse string: not enough length');
        var out = convertedToStringArgument.substr(0, minDigits), i = minDigits, digits = '0123456789', digit;
        while (i < maxDigits) {
            digit = convertedToStringArgument.charAt(i);
            if (digits.indexOf(digit) === -1)
                break;
            if (parseInt(String(this.unpadDigitsFromString(out.concat(digit)))) <= maxValue)
                out = out.concat(digit);
            else
                break;
            i++;
        }
        if (parseInt(out) > maxValue) {
            throw new Error('TimeUtils: invalid number: max allowed number is ' + maxValue + ', got: ' + out);
        }
        return out;
    };
    TimeUtils.prototype.parseDate = function (dateString, dateStringFormat) {
        var result = new Date();
        result.setHours(0);
        result.setMinutes(0);
        result.setSeconds(0);
        result.setMilliseconds(0);
        if (typeof dateString == 'undefined' || !dateString)
            return result;
        var hourPart = null, hourPartAsString, minutePart = null, minutePartAsString, secondPart = null, secondPartAsString, yearPart = null, yearPartAsString, monthPart = null, monthPartAsString, dayPart = null, dayPartAsString, AMPMPart = null, AMPMPartAsString, remainingBufferToRead = String(dateString || ''), originalDateStringArgument = String(dateStringFormat || ''), previousDateTokenReadNumberOfCharacters = 0, temporaryRegExpMatchResult, isFatalException = false;
        for (var i = 0, stringToBeParsedLength = originalDateStringArgument.length; i < stringToBeParsedLength; i++) {
            try {
                remainingBufferToRead = remainingBufferToRead.substr(previousDateTokenReadNumberOfCharacters);
                if (originalDateStringArgument.charAt(i) == '%') {
                    i++;
                    if (i >= originalDateStringArgument.length) {
                        throw new Error('unterminated date expression at position ' + i + ' in string ' + originalDateStringArgument);
                    }
                    switch (originalDateStringArgument.charAt(i)) {
                        case 'a':
                            previousDateTokenReadNumberOfCharacters += this._shortDayNames_us[this.getKey(remainingBufferToRead, this._shortDayNames_us)].length;
                            break;
                        case 'b':
                            monthPart = this.getKey(remainingBufferToRead, this._shortMonthNames_us);
                            previousDateTokenReadNumberOfCharacters = this._shortMonthNames_us[monthPart].length;
                            break;
                        case 'c':
                            monthPart = ~~(monthPartAsString = this.readNumberFromAString(remainingBufferToRead, 1, 2, 12));
                            previousDateTokenReadNumberOfCharacters = monthPartAsString.length;
                            monthPart = monthPart - 1;
                            break;
                        case 'd':
                            dayPart = ~~(dayPartAsString = this.readNumberFromAString(remainingBufferToRead, 2, 2, 31));
                            previousDateTokenReadNumberOfCharacters = dayPartAsString.length;
                            break;
                        case 'e':
                            dayPart = ~~(dayPartAsString = this.readNumberFromAString(remainingBufferToRead, 1, 2, 31));
                            previousDateTokenReadNumberOfCharacters = dayPartAsString.length;
                            break;
                        case 'H':
                            hourPart = ~~(hourPartAsString = this.readNumberFromAString(remainingBufferToRead, 2, 2, 23));
                            previousDateTokenReadNumberOfCharacters = hourPartAsString.length;
                            break;
                        case 'h':
                        case 'I':
                            hourPart = ~~(hourPartAsString = this.readNumberFromAString(remainingBufferToRead, 2, 2, 12));
                            previousDateTokenReadNumberOfCharacters = hourPartAsString.length;
                            break;
                        case 'i':
                            minutePart = ~~(minutePartAsString = this.readNumberFromAString(remainingBufferToRead, 2, 2, 59));
                            previousDateTokenReadNumberOfCharacters = minutePartAsString.length;
                            break;
                        case 'k':
                            hourPart = ~~(hourPartAsString = this.readNumberFromAString(remainingBufferToRead, 1, 2, 23));
                            previousDateTokenReadNumberOfCharacters = hourPartAsString.length;
                            break;
                        case 'l':
                            hourPart = ~~(hourPartAsString = this.readNumberFromAString(remainingBufferToRead, 1, 2, 12));
                            previousDateTokenReadNumberOfCharacters = hourPartAsString.length;
                            break;
                        case 'M':
                            monthPart = this.getKey(remainingBufferToRead, this._longMonthNames_us);
                            previousDateTokenReadNumberOfCharacters = this._longMonthNames_us[monthPart].length;
                            break;
                        case 'm':
                            monthPart = ~~(monthPartAsString = this.readNumberFromAString(remainingBufferToRead, 2, 2, 12));
                            previousDateTokenReadNumberOfCharacters = monthPartAsString.length;
                            monthPart = this.unpadDigitsFromString(monthPartAsString) - 1;
                            break;
                        case 'p':
                            AMPMPart = this.getKey(remainingBufferToRead, ['AM', 'PM']);
                            previousDateTokenReadNumberOfCharacters = 2;
                            break;
                        case 's':
                        case 'S':
                            secondPart = ~~(secondPartAsString = this.readNumberFromAString(remainingBufferToRead, 2, 2, 59));
                            previousDateTokenReadNumberOfCharacters = secondPartAsString.length;
                            break;
                        case 'Y':
                            yearPart = ~~(yearPartAsString = this.readNumberFromAString(remainingBufferToRead, 4, 4, 2100));
                            previousDateTokenReadNumberOfCharacters = yearPartAsString.length;
                            break;
                        case 'U':
                            temporaryRegExpMatchResult = /^(\-)?([\d]+)/.exec(remainingBufferToRead);
                            if (temporaryRegExpMatchResult === null)
                                throw new Error("Could not parse %U modifier: invalid unix timestamp!");
                            result.setTime(parseInt((temporaryRegExpMatchResult[1] || '').concat(temporaryRegExpMatchResult[2])) * 1000);
                            return result;
                        default:
                            isFatalException = true;
                            throw new Error('Unsupported token "%' + originalDateStringArgument.charAt(i) + '" while parsing date');
                    }
                }
                else {
                    previousDateTokenReadNumberOfCharacters = 1;
                    if (remainingBufferToRead.charAt(0) !== originalDateStringArgument.charAt(i)) {
                        isFatalException = true;
                        throw new Error('Unexpected character: ' + JSON.stringify(remainingBufferToRead.charAt(0)) + ', expected: ' + originalDateStringArgument.charAt(i));
                    }
                }
            }
            catch (e) {
                if (isFatalException) {
                    throw e;
                }
                else {
                    return null;
                }
            }
        }
        dayPart = dayPart === null
            ? null
            : this.unpadDigitsFromString(String(dayPart));
        monthPart = monthPart === null
            ? null
            : this.unpadDigitsFromString(String(monthPart));
        yearPart = yearPart === null
            ? null
            : this.unpadDigitsFromString(String(yearPart));
        hourPart = hourPart === null
            ? null
            : this.unpadDigitsFromString(String(hourPart));
        minutePart = minutePart === null
            ? null
            : this.unpadDigitsFromString(String(minutePart));
        secondPart = secondPart === null
            ? null
            : this.unpadDigitsFromString(String(secondPart));
        if (AMPMPart === 1) {
            if (hourPart !== null) {
                hourPart += 12;
                if (hourPart > 23)
                    throw new Error('Date.prototype: invalid hour : "' + hourPart + '"');
            }
        }
        if (monthPart !== null)
            result.setMonth(monthPart);
        if (dayPart !== null)
            result.setDate(dayPart);
        if (monthPart !== null)
            result.setMonth(monthPart);
        if (yearPart !== null)
            result.setFullYear(yearPart);
        if (hourPart !== null)
            result.setHours(hourPart);
        if (minutePart !== null)
            result.setMinutes(minutePart);
        if (secondPart !== null)
            result.setSeconds(secondPart);
        if (result.getHours() === 12 && AMPMPart === 0) {
            result.setHours(0);
        }
        return result;
    };
    TimeUtils.prototype.intToTime = function (seconds, format) {
        if (format === void 0) { format = '%H:%i:%s'; }
        var result = '', i = 0, character = '', len = format.length, tmp, tempDate = new Date();
        tempDate.setHours(0);
        tempDate.setMinutes(0);
        tempDate.setSeconds(seconds);
        while (i < len) {
            character = format.charAt(i);
            switch (character) {
                case '%': {
                    i++;
                    if (i == len)
                        return result;
                    character = format.charAt(i);
                    switch (character) {
                        case 'H':
                            result = result.concat(this._padNumber(tempDate.getHours(), 2));
                            break;
                        case 'h':
                        case 'I':
                            tmp = tempDate.getHours();
                            result = result.concat(tmp == 0
                                ? '12'
                                : (tmp <= 12
                                    ? this._padNumber(tmp, 2)
                                    : this._padNumber(tmp - 12, 2)));
                            break;
                        case 'i':
                            result = result.concat(this._padNumber(tempDate.getMinutes(), 2));
                            break;
                        case 'k':
                            result = result.concat(String(tempDate.getHours()));
                            break;
                        case 'l':
                            tmp = tempDate.getHours();
                            result = result.concat(tmp == 0 ? '12' : (tmp <= 12 ? tmp : tmp - 12));
                            break;
                        case 'p':
                            tmp = tempDate.getHours();
                            result = result.concat(tmp < 12 ? 'AM' : 'PM');
                            break;
                        case 'r':
                            tmp = tempDate.getHours();
                            result = result.concat(this._padNumber(tmp == 0
                                ? '12'
                                : (tmp < 12
                                    ? tmp
                                    : (tmp - 12)), 2), ':', this._padNumber(tempDate.getMinutes(), 2), ':', this._padNumber(tempDate.getSeconds(), 2), ' ', tempDate.getHours() < 12 ? 'AM' : 'PM');
                            break;
                        case 's':
                        case 'S':
                            result = result.concat(this._padNumber(tempDate.getSeconds(), 2));
                            break;
                        case 'T':
                            result = result.concat(this._padNumber(tempDate.getHours(), 2), ':', this._padNumber(tempDate.getMinutes(), 2), ':', this._padNumber(tempDate.getSeconds(), 2));
                            break;
                        case '%':
                            result = result.concat('%');
                            break;
                        default:
                            throw new Error('The %' + character + ' specifier is not supported!');
                    }
                    break;
                }
                default:
                    result = result.concat(character);
                    break;
            }
            i++;
        }
        return result;
    };
    TimeUtils.prototype.formatTime = function (unixTimestamp, format) {
        if (format === void 0) { format = '%Y-%m-%d %H:%i:%s'; }
        var result = '', i = 0, character = '', len = format.length, tmp, tempDate = new Date();
        tempDate.setTime(unixTimestamp * 1000);
        while (i < len) {
            character = format.charAt(i);
            switch (character) {
                case '%': {
                    i++;
                    if (i == len)
                        return result;
                    character = format.charAt(i);
                    switch (character) {
                        case 'a':
                            result = result.concat(this._weekDays[tempDate.getDay()].substr(0, 3));
                            break;
                        case 'b':
                            result = result.concat(this._monthNames[tempDate.getMonth()].substr(0, 3));
                            break;
                        case 'c':
                            result = result.concat(String(tempDate.getMonth() + 1));
                            break;
                        case 'd':
                            result = result.concat(this._padNumber(tempDate.getDate(), 2));
                            break;
                        case 'e':
                            result = result.concat(String(tempDate.getDate()));
                            break;
                        case 'H':
                            result = result.concat(this._padNumber(tempDate.getHours(), 2));
                            break;
                        case 'h':
                        case 'I':
                            tmp = tempDate.getHours();
                            result = result.concat(tmp == 0
                                ? '12'
                                : (tmp <= 12
                                    ? this._padNumber(tmp, 2)
                                    : this._padNumber(tmp - 12, 2)));
                            break;
                        case 'i':
                            result = result.concat(this._padNumber(tempDate.getMinutes(), 2));
                            break;
                        case 'k':
                            result = result.concat(String(tempDate.getHours()));
                            break;
                        case 'l':
                            tmp = tempDate.getHours();
                            result = result.concat(tmp == 0 ? '12' : (tmp <= 12 ? tmp : tmp - 12));
                            break;
                        case 'M':
                            result = result.concat(this._monthNames[tempDate.getMonth()]);
                            break;
                        case 'm':
                            result = result.concat(this._padNumber(tempDate.getMonth() + 1, 2));
                            break;
                        case 'p':
                            tmp = tempDate.getHours();
                            result = result.concat(tmp < 12 ? 'AM' : 'PM');
                            break;
                        case 'r':
                            tmp = tempDate.getHours();
                            result = result.concat(this._padNumber(tmp == 0
                                ? '12'
                                : (tmp < 12
                                    ? tmp
                                    : (tmp - 12)), 2), ':', this._padNumber(tempDate.getMinutes(), 2), ':', this._padNumber(tempDate.getSeconds(), 2), ' ', tempDate.getHours() < 12 ? 'AM' : 'PM');
                            break;
                        case 's':
                        case 'S':
                            result = result.concat(this._padNumber(tempDate.getSeconds(), 2));
                            break;
                        case 'T':
                            result = result.concat(this._padNumber(tempDate.getHours(), 2), ':', this._padNumber(tempDate.getMinutes(), 2), ':', this._padNumber(tempDate.getSeconds(), 2));
                            break;
                        case 'W':
                            result = result.concat(this._weekDays[tempDate.getDay()]);
                            break;
                        case 'w':
                            result = result.concat(String(tempDate.getDay()));
                            break;
                        case 'Y':
                            result = result.concat(String(tempDate.getFullYear()));
                            break;
                        case 'y':
                            result = result.concat(String(tempDate.getFullYear()).substr(2));
                            break;
                        case 'U':
                            result = result.concat(String(Math.floor(tempDate.getTime() / 1000)));
                            break;
                        case '%':
                            result = result.concat('%');
                            break;
                        default:
                            throw new Error('The %' + character + ' specifier is not supported!');
                    }
                    break;
                }
                default:
                    result = result.concat(character);
                    break;
            }
            i++;
        }
        return result;
    };
    TimeUtils.prototype.getMonthNamesLong = function () {
        return this._monthNames;
    };
    TimeUtils.prototype.getMonthNamesShort = function () {
        var result = [];
        for (var i = 0, len = this._monthNames.length; i < len; i++) {
            result.push(this._monthNames[i].substr(0, 3));
        }
        return result;
    };
    TimeUtils.prototype.getWeekNumber = function (d) {
        if (d === void 0) { d = null; }
        var e = new Date(d ? +d : +new Date());
        e.setHours(0, 0, 0, 0);
        e.setDate(e.getDate() + 4 - (e.getDay() || 7));
        return ~~((((e.getTime() - (new Date(e.getFullYear(), 0, 1)).getTime()) / 8.64e7) + 1) / 7);
    };
    TimeUtils.prototype.getFriendlyIntervalName = function (intervalName) {
        switch (intervalName) {
            case ERecentActivityIntervalKeys.TODAY:
                return this.i18n.translateText('dashboard_activityDateToday') || 'Today';
            case ERecentActivityIntervalKeys.YESTERDAY:
                return this.i18n.translateText('dashboard_activityDateYesterday') || 'Yesterday';
            case ERecentActivityIntervalKeys.THE_DAY_BEFORE_YESTERDAY:
                return this.i18n.translateText('dashboard_activityDateTwoDaysAgo') || 'Two days ago';
            case ERecentActivityIntervalKeys.THIS_WEEK:
                return this.i18n.translateText('dashboard_activityDateThisWeek') || 'This week';
            case ERecentActivityIntervalKeys.PREVIOUS_WEEK:
                return this.i18n.translateText('dashboard_activityDateLastWeek') || 'Last week';
            case ERecentActivityIntervalKeys.TWO_WEEKS_AGO:
                return this.i18n.translateText('dashboard_activityDateTwoWeeksAgo') || 'Two weeks ago';
            case ERecentActivityIntervalKeys.THIS_MONTH:
                return this.i18n.translateText('dashboard_activityDateThisMonth') || 'This month';
            case ERecentActivityIntervalKeys.PREVIOUS_MONTH:
                return this.getMonthName(1) || 'Last month';
            case ERecentActivityIntervalKeys.TWO_MONTHS_AGO:
                return this.getMonthName(2) || 'Two months ago';
            default:
                return;
        }
    };
    TimeUtils.prototype.getMonthName = function (reverseCounter) {
        var d = new Date();
        d.setMonth(d.getMonth() - reverseCounter);
        return this._monthNames[d.getMonth()];
    };
    TimeUtils.createInstanceInNonSingletonModeWithoutInternationalizationSupport = function () {
        var i18nService = new I18nService();
        i18nService.setTranslations({
            'LOGS_DateInternationalization': 'Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|January|February|March|April|May|June|July|August|September|October|November|December',
            'LOGS_TimeInternationalization': 'Few seconds ago|Few minutes ago|%t% minutes ago|%t% hours ago|Yesterday',
            'dashboard_activityDateToday': 'Today',
            'dashboard_activityDateBeforeYesterday': 'The day before yesterday',
            'dashboard_activityDateThisWeek': 'This week',
            'dashboard_activityDateWeekBefore': 'The week before',
            'dashboard_activityDateThisMonth': 'This month',
            'dashboard_activityDateWeekXBefore': 'Week%d'
        });
        return new TimeUtils(i18nService);
    };
    TimeUtils.dateEquals = function (d1, d2) {
        if (d1 === d2) {
            return true;
        }
        if ((!d1 && d2) || (!d2 && d1)) {
            return false;
        }
        return d1.getTime() === d2.getTime();
    };
    TimeUtils.prototype.dateAdd = function (interval, d) {
        interval = String(interval || '');
        if ('' === interval) {
            return null;
        }
        var isSubstract = interval.charAt(0) === '-', isAddition = interval.charAt(0) === '+' || null, addUnit, unitType, matches, numHours = null, numSeconds = null, numMilliseconds = null, numMinutes = null, numDays = null, numMonths = null, numYears = null, numWeeks = null, result = new Date(), multiplier, hasAtLeastOneUnit = false;
        if (isSubstract || isAddition) {
            interval = interval.substr(1);
        }
        if (null === isAddition) {
            isAddition = true;
        }
        if (d && d instanceof Date) {
            result.setTime(d.getTime());
        }
        multiplier = isSubstract
            ? -1
            : 1;
        while ('' !== interval && !!(matches = /^([1-9]([\d]+)?)(HH|MM|SS|MS|D|W|M|Y)/i.exec(interval))) {
            addUnit = ~~matches[1];
            unitType = matches[3].toLowerCase();
            hasAtLeastOneUnit = true;
            switch (unitType) {
                case 'hh':
                    if (null !== numHours) {
                        return null;
                    }
                    numHours = addUnit;
                    break;
                case 'mm':
                    if (null !== numMinutes) {
                        return null;
                    }
                    numMinutes = addUnit;
                    break;
                case 'ss':
                    if (null !== numSeconds) {
                        return null;
                    }
                    numSeconds = addUnit;
                    break;
                case 'ms':
                    if (null !== numMilliseconds) {
                        return null;
                    }
                    numMilliseconds = addUnit;
                    break;
                case 'y':
                    if (null !== numYears) {
                        return null;
                    }
                    numYears = addUnit;
                    break;
                case 'm':
                    if (null !== numMonths) {
                        return null;
                    }
                    numMonths = addUnit;
                    break;
                case 'w':
                    if (null !== numWeeks) {
                        return null;
                    }
                    numWeeks = addUnit;
                    break;
                case 'd':
                    if (null !== numDays) {
                        return null;
                    }
                    numDays = addUnit;
                    break;
                default:
                    return null;
            }
            interval = interval.substr(matches[0].length);
        }
        if (!hasAtLeastOneUnit || '' !== interval) {
            return null;
        }
        if (null !== numYears) {
            result.setFullYear(result.getFullYear() + multiplier * numYears);
        }
        if (null !== numMonths) {
            result.setMonth(result.getMonth() + multiplier * numMonths);
        }
        if (null !== numWeeks) {
            result.setDate(result.getDate() + multiplier * 7 * numWeeks);
        }
        if (null !== numDays) {
            result.setDate(result.getDate() + multiplier * numDays);
        }
        if (null !== numHours) {
            result.setHours(result.getHours() + multiplier * numHours);
        }
        if (null !== numMinutes) {
            result.setMinutes(result.getMinutes() + multiplier * numMinutes);
        }
        if (null !== numSeconds) {
            result.setSeconds(result.getSeconds() + multiplier * numSeconds);
        }
        if (null !== numMilliseconds) {
            result.setMilliseconds(result.getMilliseconds() + multiplier * numMilliseconds);
        }
        return result;
    };
    TimeUtils.prototype.stringToTime = function (date, dateValidatorName) {
        date = String(date || '').toLowerCase();
        if ('' === date || 'now' === date) {
            return new Date();
        }
        date = this.COMMON_TIME_STRINGS[date] || date;
        var result = this.dateAdd(date);
        if (null !== result) {
            return result;
        }
        var parseDateFormats = TimeUtils.DATE_FORMAT_MAPPINGS_FOR_STRING_TO_TIME_FUNCTION[dateValidatorName || "datemmddyyyy"]
            || TimeUtils.DATE_FORMAT_MAPPINGS_FOR_STRING_TO_TIME_FUNCTION["datemmddyyyy"];
        for (var i = 0, len = parseDateFormats.length; i < len; i++) {
            try {
                result = this.parseDate(date, parseDateFormats[i]);
                if (result) {
                    return result;
                }
            }
            catch (e) { }
        }
        try {
            result = this.parseDate(date, '%h:%i:%S %p');
            if (result) {
                return result;
            }
        }
        catch (e) { }
        try {
            result = this.parseDate(date, '%H:%i:%S');
            if (result) {
                return result;
            }
        }
        catch (e) { }
        try {
            result = this.parseDate(date, '%H:%i %p');
            if (result) {
                return result;
            }
        }
        catch (e) { }
        try {
            result = this.parseDate(date, '%H:%i');
            if (result) {
                return result;
            }
        }
        catch (e) { }
        return null;
    };
    TimeUtils.prototype.isHumanDateString = function (dateString) {
        var lowerCasedDateString = String(dateString || '').toLowerCase();
        return 'now' === lowerCasedDateString || undefined !== this.COMMON_TIME_STRINGS[lowerCasedDateString];
    };
    TimeUtils.createDateFromUTCTimestamp = function (utcTimestamp) {
        var result = new Date(), timeOffset = result.getTimezoneOffset() * 60000;
        if (null === utcTimestamp) {
            result.setTime(result.getTime() + timeOffset);
        }
        else {
            result.setTime(utcTimestamp * 1000 + timeOffset);
        }
        return result;
    };
    TimeUtils.getDateTimestampWithAppliedUTCCorrection = function (d) {
        if (!d) {
            return null;
        }
        return Math.round((d.getTime() - d.getTimezoneOffset() * 60000) / 1000);
    };
    TimeUtils.prototype.getTranslatedTextIfExistsOrNullOtherwise = function (i18n, key) {
        var result = i18n.translateText(key);
        if (result === key) {
            return null;
        }
        return result;
    };
    TimeUtils.DATE_FORMAT_MAPPINGS_FOR_STRING_TO_TIME_FUNCTION = {
        "dateyyyymmdd": [
            '%Y/%m/%d', '%Y-%m-%d', '%Y.%m.%d',
        ],
        "dateddmmyyyy": [
            '%d/%m/%Y', '%d-%m-%Y', '%d.%m.%Y',
        ],
        "datemmddyyyy": [
            '%m/%d/%Y', '%m-%d-%Y', '%m.%d.%Y',
        ],
        "datemmyyyy": [
            '%m/%Y', '%m-%Y', '%m.%Y',
        ],
    };
    return TimeUtils;
}());
var MiniMarkdown = (function () {
    function MiniMarkdown(buffer, plugins) {
        this.buffer = buffer;
        this.plugins = plugins;
        this.result = '';
    }
    MiniMarkdown.prototype.parse = function () {
        if (this.buffer.substr(0, 1) === '^') {
            return this.escapeHTML(this.buffer.substr(1));
        }
        var lines = String(this.buffer || '').replace(/(^[ ]{1,}|[ ]{1,}$)/g, ' ').replace(/\r\n/g, "\n").replace(/\r/g, "\n").split("\n");
        for (var i = 0, len = lines.length; i < len; i++) {
            this.result += this.parseLine(lines[i], i < len - 1);
        }
        return this.result;
    };
    MiniMarkdown.prototype.readUntil = function (buffer, charStop, indexStart) {
        for (var i = indexStart, len = buffer.length; i < len; i++) {
            if (buffer[i] === charStop) {
                return {
                    result: buffer.substr(indexStart, i - indexStart),
                    consume: i - indexStart + 1,
                };
            }
        }
        return null;
    };
    MiniMarkdown.prototype.readLink = function (buffer, indexStart) {
        var result = {
            url: '',
            anchor: '',
            consume: 0,
        }, read;
        read = this.readUntil(buffer, ']', indexStart + 1);
        if (read) {
            result.anchor = read.result;
            indexStart = indexStart + 1 + read.consume;
            result.consume += (1 + read.consume);
        }
        else {
            return null;
        }
        if (buffer[indexStart] !== '(') {
            return null;
        }
        indexStart++;
        read = this.readUntil(buffer, ')', indexStart);
        if (read) {
            result.url = read.result;
            result.consume += read.consume;
            return result;
        }
        return null;
    };
    MiniMarkdown.prototype.escapeHTML = function (s) {
        var result = '', ch;
        for (var i = 0, len = s.length; i < len; i++) {
            ch = s[i];
            switch (ch) {
                case '"':
                    result += '&quot;';
                    break;
                case '<':
                    result += '&lt;';
                    break;
                case '>':
                    result += '&gt;';
                    break;
                default:
                    result += ch;
            }
        }
        return result;
    };
    MiniMarkdown.prototype.parseLine = function (line, useBR) {
        var ch, read, link, result = '', allowBold = this.plugins ? (undefined !== this.plugins.bold ? this.plugins.bold : true) : true, allowItalic = this.plugins ? (undefined !== this.plugins.italic ? this.plugins.italic : true) : true, allowUnderline = this.plugins ? (undefined !== this.plugins.underline ? this.plugins.underline : true) : true, allowStrike = this.plugins ? (undefined !== this.plugins.strike ? this.plugins.strike : true) : true, allowLink = this.plugins ? (undefined !== this.plugins.link ? this.plugins.link : true) : true;
        for (var i = 0, len = line.length; i < len; i++) {
            ch = line.charAt(i);
            switch (ch) {
                case '*':
                    if (!allowBold || null === (read = this.readUntil(line, '*', i + 1))) {
                        result += '*';
                    }
                    else {
                        result += '<b>' + this.parseLine(read.result, false) + '</b>';
                        i += read.consume;
                    }
                    break;
                case '_':
                    if (!allowItalic || null === (read = this.readUntil(line, '_', i + 1))) {
                        result += '_';
                    }
                    else {
                        result += '<i>' + this.parseLine(read.result, false) + '</i>';
                        i += read.consume;
                    }
                    break;
                case '+':
                    if (!allowUnderline || null === (read = this.readUntil(line, '+', i + 1))) {
                        result += '+';
                    }
                    else {
                        result += '<u>' + this.parseLine(read.result, false) + '</u>';
                        i += read.consume;
                    }
                    break;
                case '-':
                    if (!allowStrike || null === (read = this.readUntil(line, '-', i + 1))) {
                        result += '-';
                    }
                    else {
                        result += '<strike>' + this.parseLine(read.result, false) + '</strike>';
                        i += read.consume;
                    }
                    break;
                case '[':
                    if (!allowLink || null === (link = this.readLink(line, i))) {
                        result += '[';
                    }
                    else {
                        result += '<a href="' + this.escapeHTML(link.url) + '" target="_blank" rel="nofollow ugc">' + this.parseLine(link.anchor, false) + '</a>';
                        i += link.consume;
                    }
                    break;
                case '"':
                    result += '&quot;';
                    break;
                case '<':
                    result += '&lt;';
                    break;
                case '>':
                    result += '&gt;';
                    break;
                default:
                    result += ch;
            }
        }
        return result + (useBR ? '<br/>' : '');
    };
    MiniMarkdown.parse = function (markdown, plugins) {
        if (plugins === void 0) { plugins = null; }
        return (new MiniMarkdown(markdown, plugins)).parse().replace(/%(ST|UN|PL|MI)%/g, function (a) {
            switch (a) {
                case '%ST%':
                    return '*';
                case '%UN%':
                    return '_';
                case '%PL%':
                    return '+';
                case '%MI%':
                    return '-';
                default:
                    return a;
            }
        });
    };
    MiniMarkdown.toPlainText = function (markdownText) {
        this.unescaper.innerHTML = this.parse(markdownText);
        var result = this.unescaper.textContent;
        this.unescaper.innerHTML = '';
        return result;
    };
    MiniMarkdown.unescaper = document.createElement('span');
    return MiniMarkdown;
}());
var StringBuffer = (function () {
    function StringBuffer(buffer) {
        this.snapshots = [];
        this.buffer = String(buffer || '');
        this.consumedBuffer = '';
        this.consumed = 0;
    }
    StringBuffer.prototype.readEndOfFile = function () {
        return this.buffer === '';
    };
    StringBuffer.prototype.getOffset = function () {
        return this.consumed;
    };
    StringBuffer.prototype.consume = function (length) {
        if (length > 0) {
            this.consumed += ~~length;
            this.consumedBuffer = this.consumedBuffer.concat(this.buffer.slice(0, ~~length));
            this.buffer = this.buffer.slice(~~length);
        }
        return this;
    };
    StringBuffer.prototype.getConsumedBuffer = function () {
        return this.consumedBuffer;
    };
    StringBuffer.prototype.toString = function () {
        return this.buffer;
    };
    StringBuffer.prototype.createSnapshot = function () {
        this.snapshots.push({ read: this.buffer, consumed: this.consumedBuffer, pos: this.consumed });
    };
    StringBuffer.prototype.ignoreLastSnapshot = function () {
        this.commitLasSnapshot();
    };
    StringBuffer.prototype.rollbackLastSnapshot = function () {
        var numSnapshots = this.snapshots.length;
        this.buffer = this.snapshots[numSnapshots - 1].read;
        this.consumedBuffer = this.snapshots[numSnapshots - 1].consumed;
        this.consumed = this.snapshots[numSnapshots - 1].pos;
        this.snapshots.splice(numSnapshots - 1, 1);
    };
    StringBuffer.prototype.commitLasSnapshot = function () {
        var numSnapshots = this.snapshots.length;
        this.snapshots.splice(numSnapshots - 1, 1);
    };
    return StringBuffer;
}());
var Activity = (function () {
    function Activity(jq, retryPeriod, intervalMultiplicator) {
        this.MAX_RETRY_PERIOD = 3 * 60 * 1000;
        this.isStarted = false;
        this.jq = jq;
        this.retryPeriod = this.baseRetryPeriod = retryPeriod;
        this.intervalMultiplicator = intervalMultiplicator;
    }
    Activity.prototype.start = function () {
        if (!this.isStarted) {
            this.isStarted = true;
            this.onStart();
        }
        this.reset();
        this.doWork();
    };
    Activity.prototype.stop = function () {
        this.isStarted = false;
        this.onStop();
    };
    Activity.prototype.onStart = function () {
    };
    Activity.prototype.onStop = function () {
    };
    Activity.prototype.onError = function (ex) {
    };
    Activity.prototype.doWork = function () {
        var _this = this;
        if (this.isStarted) {
            this.jq.when(this.run())
                .fail(function (ex) {
                _this.onError(ex);
            })
                .always(function () {
                _this.timeout = window.setTimeout(function () {
                    _this.doWork();
                }, _this.retryPeriod);
                _this.retryPeriod = _this.retryPeriod >= _this.MAX_RETRY_PERIOD ? _this.MAX_RETRY_PERIOD : _this.retryPeriod * _this.intervalMultiplicator;
            });
        }
    };
    Activity.prototype.reset = function () {
        this.retryPeriod = this.baseRetryPeriod;
        window.clearTimeout(this.timeout);
    };
    return Activity;
}());
var SelectionFBMode;
(function (SelectionFBMode) {
    SelectionFBMode["COVER"] = "cover";
    SelectionFBMode["CENTER"] = "center";
    SelectionFBMode["TOUCH"] = "touch";
})(SelectionFBMode || (SelectionFBMode = {}));
var SelectionFBEventType;
(function (SelectionFBEventType) {
    SelectionFBEventType["ON"] = "on";
    SelectionFBEventType["OFF"] = "off";
})(SelectionFBEventType || (SelectionFBEventType = {}));
var SelectionFBEventNames;
(function (SelectionFBEventNames) {
    SelectionFBEventNames["ON_SELECT"] = "onSelect";
    SelectionFBEventNames["ON_START"] = "onStart";
    SelectionFBEventNames["ON_MOVE"] = "onMove";
    SelectionFBEventNames["ON_STOP"] = "onStop";
})(SelectionFBEventNames || (SelectionFBEventNames = {}));
var SelectionFB = (function () {
    function SelectionFB(customOptions) {
        var _this = this;
        this.enableAtInit = true;
        this.classSelection = 'selection-area';
        this.dataAttributeSelection = ['data-role', 'select-area'];
        this.startThreshold = 10;
        this.disableTouch = true;
        this.mode = SelectionFBMode.TOUCH;
        this.canSingleClick = true;
        this.selectables = [];
        this.boundaries = ['html'];
        this.boundariesExcluded = [];
        this.includeSelectableChildren = false;
        this.canStartSelectionOnSelectable = false;
        this.selectionAreaQuery = 'body';
        this.scrollSpeedDivider = 10;
        this.validateStart = function () { return true; };
        this.selectionFilter = function () { return true; };
        this.preventDefault = function (e) { return e.preventDefault(); };
        this.onTapStart = function (evt) {
            var _a = SelectionFBUtils.simplifyEvent(evt), x = _a.x, y = _a.y, target = _a.target;
            _this.resolveSelectables();
            if (_this.isTargetChildOfSelectable(target)) {
                return;
            }
            var targetBoundingClientRect = target.getBoundingClientRect();
            if (!_this.validateStart(evt)) {
                return;
            }
            var evtpath = SelectionFBUtils.eventPath(evt);
            _this.boundariesElements = SelectionFBUtils.selectAll(_this.boundaries);
            if (!_this.boundariesElements.filter(function (el) { return evtpath.indexOf(el) !== -1; })[0]) {
                return;
            }
            _this.boundariesExcludedElements = SelectionFBUtils.selectAll(_this.boundariesExcluded);
            if (_this.boundariesExcludedElements.filter(function (el) { return evtpath.indexOf(el) !== -1; })[0]) {
                return;
            }
            _this.areaX1 = x;
            _this.areaY1 = y;
            _this.areaX2 = 0;
            _this.areaY2 = 0;
            _this.singleClick = true;
            _this.singleClickStartElement = target;
            _this.targetContainer = _this.boundariesElements.filter(function (el) {
                return SelectionFBUtils.intersects(el.getBoundingClientRect(), targetBoundingClientRect);
            })[0];
            _this.targetBoundary = _this.targetContainer.getBoundingClientRect();
            _this.touchedElements = [];
            _this.changedElements = {
                added: [],
                removed: []
            };
            if (!_this.isTargetOneOfSelectable(target) &&
                (Math.round(_this.targetContainer.scrollHeight) !== Math.round(_this.targetBoundary.height) ||
                    Math.round(_this.targetContainer.scrollWidth) !== Math.round(_this.targetBoundary.width))) {
                _this.scrollAvailable = true;
                SelectionFBUtils.addEventListener([_this.selectionAreaContainer], ['wheel'], _this.manualScroll);
                _this.selectablesElements = _this.selectablesElements.filter(function (s) { return _this.targetContainer.contains(s); });
                SelectionFBUtils.css(_this.clippingElement, {
                    top: _this.targetBoundary.top,
                    left: _this.targetBoundary.left,
                    width: _this.targetBoundary.width,
                    height: _this.targetBoundary.height
                });
                SelectionFBUtils.css(_this.areaElement, {
                    'margin-top': -_this.targetBoundary.top,
                    'margin-left': -_this.targetBoundary.left
                });
            }
            else {
                _this.scrollAvailable = false;
                SelectionFBUtils.css(_this.clippingElement, {
                    top: 0,
                    left: 0,
                    width: '100%',
                    height: '100%'
                });
                SelectionFBUtils.css(_this.areaElement, {
                    'margin-top': 0,
                    'margin-left': 0
                });
            }
            _this.areaElement.classList.add(_this.classSelection);
            _this.areaElement.setAttribute(_this.dataAttributeSelection[0], _this.dataAttributeSelection[1]);
            SelectionFBUtils.addEventListener([document], ['selectstart'], _this.preventDefault);
            SelectionFBUtils.addEventListener([document], ['mousemove'], _this.delayedTapMove);
            if (!_this.disableTouch) {
                SelectionFBUtils.addEventListener([document], ['touchmove'], _this.delayedTapMove, { passive: false });
            }
            SelectionFBUtils.addEventListener([document], ['mouseup'], _this.onTapStop);
            if (!_this.disableTouch) {
                SelectionFBUtils.addEventListener([document], ['touchcancel', 'touchend'], _this.onTapStop);
            }
            evt.preventDefault();
        };
        this.delayedTapMove = function (evt) {
            var _a = SelectionFBUtils.simplifyEvent(evt), x = _a.x, y = _a.y, target = _a.target;
            if (_this.isTargetOneOfSelectable(target)) {
                SelectionFBUtils.removeEventListener([document], ['mousemove'], _this.delayedTapMove);
                if (!_this.disableTouch) {
                    SelectionFBUtils.removeEventListener([document], ['touchmove'], _this.delayedTapMove);
                }
                return;
            }
            if (Math.abs((x + y) - (_this.areaX1 + _this.areaY1)) >= _this.startThreshold) {
                SelectionFBUtils.removeEventListener([document], ['mousemove'], _this.delayedTapMove);
                if (!_this.disableTouch) {
                    SelectionFBUtils.removeEventListener([document], ['touchmove'], _this.delayedTapMove);
                }
                SelectionFBUtils.addEventListener([document], ['mousemove'], _this.onTapMove);
                if (!_this.disableTouch) {
                    SelectionFBUtils.addEventListener([document], ['touchmove'], _this.onTapMove, { passive: false });
                }
                SelectionFBUtils.css(_this.areaElement, 'display', 'block');
                _this.onTapMove(evt);
                _this.dispatchEvent(SelectionFBEventNames.ON_START, evt);
                _this.singleClick = false;
                _this.singleClickStartElement = null;
            }
        };
        this.onTapMove = function (evt) {
            var _a = SelectionFBUtils.simplifyEvent(evt), x = _a.x, y = _a.y;
            _this.areaX2 = x;
            _this.areaY2 = y;
            if (_this.scrollAvailable && (_this.scrollSpeed.y !== null || _this.scrollSpeed.x !== null)) {
                var scroll_1 = function () {
                    if (_this.scrollSpeed.y === null && _this.scrollSpeed.x === null) {
                        return;
                    }
                    var _a = _this.targetContainer, scrollTop = _a.scrollTop, scrollLeft = _a.scrollLeft;
                    if (_this.scrollSpeed.y !== null) {
                        _this.targetContainer.scrollTop += Math.ceil(_this.scrollSpeed.y / _this.scrollSpeedDivider);
                        _this.areaY1 -= _this.targetContainer.scrollTop - scrollTop;
                    }
                    if (_this.scrollSpeed.x !== null) {
                        _this.targetContainer.scrollLeft += Math.ceil(_this.scrollSpeed.x / _this.scrollSpeedDivider);
                        _this.areaX1 -= _this.targetContainer.scrollLeft - scrollLeft;
                    }
                    _this.redrawArea();
                    _this.updatedTouchingElements();
                    _this.dispatchEvent(SelectionFBEventNames.ON_MOVE, evt);
                    requestAnimationFrame(scroll_1);
                };
                requestAnimationFrame(scroll_1);
            }
            else {
                _this.redrawArea();
                _this.updatedTouchingElements();
                _this.dispatchEvent(SelectionFBEventNames.ON_MOVE, evt);
            }
        };
        this.manualScroll = function (evt) {
            _this.scrollSpeed.y += _this.scrollSpeedDivider * (evt.wheelDeltaY * -1);
            _this.scrollSpeed.x += _this.scrollSpeedDivider * (evt.wheelDeltaX * -1);
            _this.onTapMove(evt);
            evt.preventDefault();
        };
        this.onTapStop = function (evt, noevent) {
            SelectionFBUtils.removeEventListener([document], ['mousemove'], _this.delayedTapMove);
            if (!_this.disableTouch) {
                SelectionFBUtils.removeEventListener([document], ['touchmove'], _this.delayedTapMove);
            }
            SelectionFBUtils.removeEventListener([document], ['mousemove'], _this.onTapMove);
            if (!_this.disableTouch) {
                SelectionFBUtils.removeEventListener([document], ['touchmove'], _this.onTapMove);
            }
            SelectionFBUtils.removeEventListener([document], ['mouseup'], _this.onTapStop);
            if (!_this.disableTouch) {
                SelectionFBUtils.removeEventListener([document], ['touchcancel', 'touchend'], _this.onTapStop);
            }
            if (_this.singleClick && _this.canSingleClick && evt.target == _this.singleClickStartElement) {
                _this.onSingleTap(evt);
            }
            else if (!_this.singleClick && !noevent && evt.target == _this.singleClickStartElement) {
                _this.updatedTouchingElements();
                _this.dispatchEvent(SelectionFBEventNames.ON_STOP, evt);
            }
            _this.scrollSpeed = { x: null, y: null };
            SelectionFBUtils.removeEventListener([_this.selectionAreaContainer], ['wheel'], _this.manualScroll);
            SelectionFBUtils.removeEventListener([document], ['selectstart'], _this.preventDefault);
            SelectionFBUtils.css(_this.areaElement, 'display', 'none');
        };
        if (customOptions.enableAtInit !== undefined) {
            this.enableAtInit = customOptions.enableAtInit;
        }
        if (customOptions.class !== undefined) {
            this.classSelection = customOptions.class;
        }
        if (customOptions.dataAttribute !== undefined) {
            this.dataAttributeSelection = customOptions.dataAttribute;
        }
        if (customOptions.startThreshold !== undefined) {
            this.startThreshold = customOptions.startThreshold;
        }
        if (customOptions.disableTouch !== undefined) {
            this.disableTouch = customOptions.disableTouch;
        }
        if (customOptions.mode !== undefined) {
            this.mode = customOptions.mode;
        }
        if (customOptions.canSingleClick !== undefined) {
            this.canSingleClick = customOptions.canSingleClick;
        }
        if (customOptions.selectables !== undefined) {
            this.selectables = customOptions.selectables;
        }
        if (customOptions.boundaries !== undefined) {
            this.boundaries = customOptions.boundaries;
        }
        if (customOptions.boundariesExcluded !== undefined) {
            this.boundariesExcluded = customOptions.boundariesExcluded;
        }
        if (customOptions.includeSelectableChildren !== undefined) {
            this.includeSelectableChildren = customOptions.includeSelectableChildren;
        }
        if (customOptions.canStartSelectionOnSelectable !== undefined) {
            this.canStartSelectionOnSelectable = customOptions.canStartSelectionOnSelectable;
        }
        if (customOptions.selectionAreaContainer !== undefined) {
            this.selectionAreaContainer = customOptions.selectionAreaContainer;
        }
        if (customOptions.selectionAreaQuery !== undefined) {
            this.selectionAreaQuery = customOptions.selectionAreaQuery;
        }
        if (customOptions.scrollSpeedDivider !== undefined) {
            this.scrollSpeedDivider = customOptions.scrollSpeedDivider;
        }
        if (customOptions.validateStart !== undefined) {
            this.validateStart = customOptions.validateStart;
        }
        if (customOptions.onStart !== undefined) {
            this.onStart = customOptions.onStart;
        }
        if (customOptions.onSelect !== undefined) {
            this.onSelect = customOptions.onSelect;
        }
        if (customOptions.onMove !== undefined) {
            this.onMove = customOptions.onMove;
        }
        if (customOptions.onStop !== undefined) {
            this.onStop = customOptions.onStop;
        }
        if (customOptions.selectionFilter !== undefined) {
            this.selectionFilter = customOptions.selectionFilter;
        }
        this.selectedStore = [];
        this.areaElement = document.createElement('div');
        this.clippingElement = document.createElement('div');
        this.scrollAvailable = true;
        this.scrollSpeed = { x: null, y: null };
        if (!this.selectionAreaContainer) {
            this.selectionAreaContainer = document.querySelector(this.selectionAreaQuery);
        }
        this.init();
    }
    SelectionFB.prototype.init = function () {
        this.clippingElement.appendChild(this.areaElement);
        this.selectionAreaContainer.appendChild(this.clippingElement);
        SelectionFBUtils.css(this.areaElement, {
            top: 0,
            left: 0,
            position: 'fixed'
        });
        SelectionFBUtils.css(this.clippingElement, {
            overflow: 'hidden',
            position: 'fixed',
            transform: 'translate3d(0, 0, 0)',
            'pointer-events': 'none',
            'z-index': '3'
        });
        if (this.enableAtInit) {
            this.enable();
        }
    };
    SelectionFB.prototype.bindStartEvents = function (type) {
        SelectionFBUtils.eventListener(type, [document], ['mousedown'], this.onTapStart);
        if (!this.disableTouch) {
            SelectionFBUtils.eventListener(type, [document], ['touchstart'], this.onTapStart, { passive: false });
        }
    };
    SelectionFB.prototype.onSingleTap = function (evt) {
        var target = SelectionFBUtils.simplifyEvent(evt).target;
        while (this.selectablesElements.indexOf(target) === -1) {
            if (target.parentElement) {
                target = target.parentElement;
            }
            else {
                this.dispatchEvent(SelectionFBEventNames.ON_SELECT, evt, null);
                return;
            }
        }
        this.touchedElements.push(target);
        this.dispatchEvent(SelectionFBEventNames.ON_SELECT, evt, target);
    };
    SelectionFB.prototype.redrawArea = function () {
        var _a = this.targetContainer, scrollTop = _a.scrollTop, scrollHeight = _a.scrollHeight, clientHeight = _a.clientHeight, scrollLeft = _a.scrollLeft, scrollWidth = _a.scrollWidth, clientWidth = _a.clientWidth;
        var x = this.areaX2;
        var y = this.areaY2;
        if (x < this.targetBoundary.left) {
            this.scrollSpeed.x = scrollLeft ? -Math.abs(this.targetBoundary.left - x) : null;
            x = this.targetBoundary.left;
        }
        else if (x > this.targetBoundary.left + this.targetBoundary.width) {
            this.scrollSpeed.x = scrollWidth - scrollLeft - clientWidth ?
                Math.abs(this.targetBoundary.left + this.targetBoundary.width - x) : null;
            x = this.targetBoundary.left + this.targetBoundary.width;
        }
        else {
            this.scrollSpeed.x = null;
        }
        if (y < this.targetBoundary.top) {
            this.scrollSpeed.y = scrollTop ? -Math.abs(this.targetBoundary.top - y) : null;
            y = this.targetBoundary.top;
        }
        else if (y > this.targetBoundary.top + this.targetBoundary.height) {
            this.scrollSpeed.y = scrollHeight - scrollTop - clientHeight ?
                Math.abs(this.targetBoundary.top + this.targetBoundary.height - y) : null;
            y = this.targetBoundary.top + this.targetBoundary.height;
        }
        else {
            this.scrollSpeed.y = null;
        }
        var x3 = Math.min(this.areaX1, x);
        var y3 = Math.min(this.areaY1, y);
        var x4 = Math.max(this.areaX1, x);
        var y4 = Math.max(this.areaY1, y);
        SelectionFBUtils.css(this.areaElement, {
            top: y3,
            left: x3,
            width: (x4 - x3),
            height: (y4 - y3)
        });
    };
    SelectionFB.prototype.updatedTouchingElements = function () {
        var touched = [];
        var changed = { added: [], removed: [] };
        var areaRect = this.areaElement.getBoundingClientRect();
        for (var i = 0, n = this.selectablesElements.length; i < n; i++) {
            var node = this.selectablesElements[i];
            if (SelectionFBUtils.intersects(areaRect, node.getBoundingClientRect(), this.mode)) {
                if (this.selectionFilter(node)) {
                    if (this.touchedElements.indexOf(node) === -1) {
                        changed.added.push(node);
                    }
                    touched.push(node);
                }
            }
        }
        for (var i = 0, n = this.touchedElements.length; i < n; i++) {
            if (touched.indexOf(this.touchedElements[i]) === -1) {
                changed.removed.push(this.touchedElements[i]);
            }
        }
        this.touchedElements = touched;
        this.changedElements = changed;
    };
    SelectionFB.prototype.dispatchEvent = function (eventName, originalEvent, selectedElement) {
        var selectionEvent = {
            selection: this,
            areaElement: this.areaElement,
            selectedElements: this.touchedElements.concat(this.selectedStore),
            changedElements: this.changedElements,
            eventName: eventName,
            originalEvent: originalEvent,
            selectedElement: selectedElement
        };
        switch (eventName) {
            case SelectionFBEventNames.ON_SELECT:
                if (this.onSelect) {
                    this.onSelect(selectionEvent);
                }
                break;
            case SelectionFBEventNames.ON_START:
                if (this.onStart) {
                    this.onStart(selectionEvent);
                }
                break;
            case SelectionFBEventNames.ON_MOVE:
                if (this.onMove) {
                    this.onMove(selectionEvent);
                }
                break;
            case SelectionFBEventNames.ON_STOP:
                if (this.onStop) {
                    this.onStop(selectionEvent);
                }
                break;
            default:
                console.warn("eventName: '" + eventName + "' does not exist");
        }
    };
    SelectionFB.prototype.isTargetChildOfSelectable = function (target) {
        if (this.includeSelectableChildren) {
            return false;
        }
        for (var i = 0, n = this.selectablesElements.length; i < n; i++) {
            var element = this.selectablesElements[i];
            if (element.contains(target) && element != target) {
                return true;
            }
        }
        return false;
    };
    SelectionFB.prototype.isTargetOneOfSelectable = function (target) {
        if (this.canStartSelectionOnSelectable) {
            return false;
        }
        for (var i = 0, n = this.selectablesElements.length; i < n; i++) {
            var element = this.selectablesElements[i];
            if (element == target || element.contains(target)) {
                return true;
            }
        }
        return false;
    };
    SelectionFB.prototype.resolveSelectables = function () {
        this.selectablesElements = SelectionFBUtils.selectAll(this.selectables);
    };
    SelectionFB.prototype.keepSelection = function () {
        for (var i = 0, n = this.touchedElements.length; i < n; i++) {
            if (this.selectedStore.indexOf(this.touchedElements[i]) === -1) {
                this.selectedStore.push(this.touchedElements[i]);
            }
        }
    };
    SelectionFB.prototype.clearSelection = function () {
        this.selectedStore = [];
    };
    SelectionFB.prototype.removeFromSelection = function (el) {
        SelectionFBUtils.removeElement(this.selectedStore, el);
        SelectionFBUtils.removeElement(this.touchedElements, el);
    };
    SelectionFB.prototype.getSelection = function () {
        return this.selectedStore;
    };
    SelectionFB.prototype.cancel = function (keepEvent) {
        if (keepEvent === void 0) { keepEvent = false; }
        this.onTapStop(null, !keepEvent);
    };
    SelectionFB.prototype.disable = function () {
        this.bindStartEvents(SelectionFBEventType.OFF);
    };
    SelectionFB.prototype.destroy = function () {
        this.disable();
        if (this.selectionAreaContainer.contains(this.clippingElement)) {
            this.selectionAreaContainer.removeChild(this.clippingElement);
        }
    };
    SelectionFB.prototype.enable = function () {
        this.bindStartEvents(SelectionFBEventType.ON);
    };
    return SelectionFB;
}());
var SelectionFBUtils = (function () {
    function SelectionFBUtils() {
    }
    SelectionFBUtils.addEventListener = function (elements, events, fn, options) {
        if (options === void 0) { options = {}; }
        for (var i = 0, n = elements.length; i < n; i++) {
            for (var j = 0, m = events.length; j < m; j++) {
                elements[i].addEventListener(events[j], fn, __assign({ capture: false }, options));
            }
        }
    };
    SelectionFBUtils.removeEventListener = function (elements, events, fn, options) {
        if (options === void 0) { options = {}; }
        for (var i = 0, n = elements.length; i < n; i++) {
            for (var j = 0, m = events.length; j < m; j++) {
                elements[i].removeEventListener(events[j], fn, __assign({ capture: false }, options));
            }
        }
    };
    SelectionFBUtils.eventListener = function (type, elements, events, fn, options) {
        if (options === void 0) { options = {}; }
        switch (type) {
            case SelectionFBEventType.ON:
                SelectionFBUtils.addEventListener(elements, events, fn, options);
                break;
            case SelectionFBEventType.OFF:
                SelectionFBUtils.removeEventListener(elements, events, fn, options);
                break;
            default:
                console.warn("eventListener type: '" + type + "' does not exist");
        }
    };
    SelectionFBUtils.css = function (el, attr, val) {
        if (val === void 0) { val = null; }
        var style = el && el.style;
        if (!style)
            return;
        if (typeof attr === 'object') {
            for (var prop in attr) {
                style[prop] = this.unitify(attr[prop]);
            }
        }
        else if (val == null) {
            var dw = document.defaultView;
            if (dw && dw.getComputedStyle) {
                val = dw.getComputedStyle(el, null);
            }
            else if (el.currentStyle) {
                val = el.currentStyle;
            }
            return attr == null ? val : val[attr];
        }
        else {
            style[attr] = this.unitify(val);
        }
    };
    SelectionFBUtils.intersects = function (a, b, mode) {
        if (mode === void 0) { mode = SelectionFBMode.TOUCH; }
        if (mode === SelectionFBMode.CENTER) {
            var bxc = b.left + b.width / 2;
            var byc = b.top + b.height / 2;
            return bxc >= a.left
                && bxc <= a.right
                && byc >= a.top
                && byc <= a.bottom;
        }
        else if (mode === SelectionFBMode.COVER) {
            return b.left >= a.left
                && b.top >= a.top
                && b.right <= a.right
                && b.bottom <= a.bottom;
        }
        else if (mode === SelectionFBMode.TOUCH) {
            return a.right >= b.left
                && a.left <= b.right
                && a.bottom >= b.top
                && a.top <= b.bottom;
        }
    };
    SelectionFBUtils.selectAll = function (selector) {
        var nodes = [];
        if (selector) {
            for (var i = 0, n = selector.length; i < n; i++) {
                var sel = selector[i];
                nodes.push.apply(nodes, [].slice.call(document.querySelectorAll(sel)));
            }
        }
        return nodes;
    };
    SelectionFBUtils.eventPath = function (evt) {
        var path = evt.path || (evt.composedPath && evt.composedPath());
        if (path)
            return path;
        var el = evt.target.parentElement;
        path = [evt.target, el];
        while ((el = el.parentElement))
            path.push(el);
        path.push(document, window);
        return path;
    };
    SelectionFBUtils.removeElement = function (arr, el) {
        var index = arr.indexOf(el);
        if (~index)
            arr.splice(index, 1);
    };
    SelectionFBUtils.simplifyEvent = function (evt) {
        var tap = (evt.touches && evt.touches[0] || evt);
        return {
            tap: tap,
            x: tap.clientX,
            y: tap.clientY,
            target: tap.target
        };
    };
    SelectionFBUtils.unitify = function (val, unit) {
        if (unit === void 0) { unit = 'px'; }
        return typeof val === 'number' ? val + unit : '' + val;
    };
    return SelectionFBUtils;
}());
var EStaticVirtualSelectAppend;
(function (EStaticVirtualSelectAppend) {
    EStaticVirtualSelectAppend["TYPE_APPEND"] = "append";
    EStaticVirtualSelectAppend["TYPE_INSERT_BEFORE"] = "insertBefore";
    EStaticVirtualSelectAppend["TYPE_REPLACE"] = "replace";
})(EStaticVirtualSelectAppend || (EStaticVirtualSelectAppend = {}));
var VirtualSelect = (function (_super) {
    __extends(VirtualSelect, _super);
    function VirtualSelect(jq) {
        var _this = _super.call(this) || this;
        _this.selectedOption = null;
        _this.dropdownDirectionPlugin = true;
        _this.jq = jq;
        return _this;
    }
    VirtualSelect.prototype.init = function (node, options, config) {
        var _this = this;
        this.node = node;
        this.options = options;
        this.setConfig(config);
        this.setSelectedOption();
        this.appendSelect();
        setTimeout(function () { return _this.bindEvents(); }, 5);
        return this;
    };
    VirtualSelect.prototype.appendSelect = function () {
        var component = this.render();
        this.jq(this.node).append(component);
        switch (this.config.append) {
            case EStaticVirtualSelectAppend.TYPE_APPEND:
                this.jq(this.node).append(component);
                break;
            case EStaticVirtualSelectAppend.TYPE_INSERT_BEFORE:
                if (this.jq(this.node).children().length > 0) {
                    this.jq(this.node).prepend(component);
                }
                else {
                    this.jq(this.node).append(component);
                }
                break;
            case EStaticVirtualSelectAppend.TYPE_REPLACE:
                this.virtualSelectAppendReplace(component);
                break;
        }
    };
    VirtualSelect.prototype.virtualSelectAppendReplace = function (component) {
        (function (self, $) {
            var nodeAttributes = $(self.node).prop('attributes'), appendedComponent = $(self.node).parent().append(component).children('div:last-child');
            $.each(nodeAttributes, function () {
                if (typeof $(appendedComponent).attr(this.name) === 'undefined') {
                    $(appendedComponent).attr(this.name, this.value);
                }
            });
            $(self.node).remove();
            self.setNode($(appendedComponent).parent());
        })(this, this.jq);
    };
    VirtualSelect.prototype.reRender = function () {
        (function (self, $) {
            $(self.node).empty();
            self.appendSelect();
        })(this, this.jq);
    };
    VirtualSelect.prototype.render = function () {
        var selectedOption = this.getSelectedOption();
        var container = document.createElement('div');
        container.className = 'virtual-select';
        if (this.config.fixedWidth !== null) {
            container.style.width = this.config.fixedWidth;
        }
        if (this.config.light === true && !(window.innerWidth <= 767)) {
            container.setAttribute('data-light', "true");
        }
        else {
            container.setAttribute('data-light', "false");
        }
        container.setAttribute('data-size', "" + this.config.size);
        if (this.config.sizeSm) {
            container.setAttribute('data-sm-size', "" + this.config.sizeSm);
        }
        if (this.config.sizeMd) {
            container.setAttribute('data-md-size', "" + this.config.sizeSm);
        }
        if (this.config.sizeLg) {
            container.setAttribute('data-lg-size', "" + this.config.sizeSm);
        }
        if (selectedOption === null
            || typeof selectedOption.label === 'undefined') {
            container.setAttribute('data-not-selected', "true");
        }
        this.jq(container).append(this.renderPlaceholder());
        return container;
    };
    VirtualSelect.prototype.renderPlaceholder = function () {
        var selectedOption = this.getSelectedOption();
        var container = document.createElement('div'), label = document.createElement('span'), arrow = document.createElement('span');
        container.className = 'virtual-select-placeholder';
        label.className = 'title-placeholder';
        arrow.className = 'arrow-placeholder';
        if (selectedOption !== null
            && typeof selectedOption.label !== 'undefined') {
            label.innerText = "" + this.selectedOption.label;
        }
        else {
            label.innerText = this.placeholderText();
        }
        container.innerHTML = label.outerHTML + arrow.outerHTML;
        return container;
    };
    VirtualSelect.prototype.bindEvents = function () {
        (function (self, $) {
            if (self.options && (typeof self.options === 'object' && self.options.length > 0)) {
                $(self.node)
                    .on('click', '.virtual-select-placeholder', function (event) {
                    event.stopImmediatePropagation();
                    event.preventDefault();
                    if (self.config.changeOptions !== null) {
                        self.config['changeOptions'](self);
                    }
                    $(self.node).find('.virtual-select').append(self.renderSelect()).append(function () {
                        var _this = this;
                        var selectizeConfig = {
                            placeholder: self.placeholderText(),
                            plugins: {
                                'no_results': {
                                    message: 'No match found'
                                },
                                'start_typing': {},
                                'scroll_dropdown_view_on_selected_item_top': {},
                            },
                            onInitialize: function () {
                                var select = this;
                                this.revertSettings.$children.each(function () {
                                    if ($(this).children().length) {
                                        $(this).children().each(function () {
                                            $.extend(select.options[this.value], $(this).data());
                                        });
                                    }
                                    $.extend(select.options[this.value], $(this).data());
                                });
                            },
                            render: {
                                option: function (item, escape) {
                                    var selectedOption = self.getSelectedOption();
                                    var extraClass = '', selected = "";
                                    if (item.hasOwnProperty('extraClass')) {
                                        extraClass += "" + item.extraClass;
                                    }
                                    if (selectedOption !== null && selectedOption.hasOwnProperty('id') && this.value == selectedOption.id) {
                                        selected = 'selected';
                                    }
                                    return "<div class=\"option " + selected + " " + extraClass + "\">" + item.text + " " + selected + "</div>";
                                },
                            },
                            onDropdownClose: function (dropdown) {
                                setTimeout(function () {
                                    var dataDoNotMatch = typeof dropdown.attr('data-no-match-found') !== 'undefined' && dropdown.attr('data-no-match-found') === 'true';
                                    if (!dataDoNotMatch) {
                                        $(_this).find('select').each(function (item, index) {
                                            if (item.selectize) {
                                                item.selectize().destroy();
                                            }
                                        });
                                        $(_this).empty();
                                        $(_this).append(self.renderPlaceholder());
                                    }
                                }, 10);
                            },
                            onDropdownOpen: function () {
                                $('.selectize-dropdown-content').perfectScrollbar({ minScrollbarLength: 10 });
                            }
                        };
                        if (self.dropdownDirectionPlugin) {
                            selectizeConfig.plugins['dropdown_direction'] = {};
                            selectizeConfig['dropdownDirection'] = 'auto';
                        }
                        $(this).find('select').selectize(selectizeConfig);
                        $(this).find('.virtual-select-placeholder').hide();
                        setTimeout(function () {
                            var select = $(_this).find('select')[0];
                            if (typeof select !== 'undefined' && typeof select.selectize !== 'undefined') {
                                select.selectize.open();
                            }
                        }, 250);
                    });
                })
                    .on('change', 'select', function (event) {
                    event.stopImmediatePropagation();
                    event.preventDefault();
                    if (this.value) {
                        if (typeof $(self.node).find('.virtual-select').attr('data-not-selected') !== 'undefined') {
                            $(self.node).find('.virtual-select').removeAttr('data-not-selected');
                        }
                        self.changeSelectedStatusById(this.value);
                        self.trigger('change', self);
                    }
                })
                    .on('click', '.selectize-control', function (event) {
                    event.stopImmediatePropagation();
                    event.preventDefault();
                    $(this).parent().find('select.selectized')[0].selectize.open();
                })
                    .on('mouseover', function (event) {
                    self.trigger('hover', event);
                })
                    .on('mouseenter', function (event) {
                    self.trigger('mouseenter', event);
                })
                    .on('mouseleave', function (event) {
                    self.trigger('mouseleave', event);
                });
            }
            else {
                self.trigger('render-fail', self);
            }
        })(this, this.jq);
    };
    VirtualSelect.prototype.renderSelect = function () {
        var select = document.createElement('select'), configSelected = this.config.selected;
        if (!this.config.isSearchable) {
            select.classList.add('no-search');
        }
        if (this.dropdownDirectionPlugin) {
            select.classList.add('dropdown-direction-plugin');
        }
        select.setAttribute('placeholder', this.placeholderText());
        var placeholderOption = document.createElement('option');
        placeholderOption.value = '';
        placeholderOption.text = this.placeholderText();
        select.appendChild(placeholderOption);
        if (Array.isArray(this.options) && this.options.length > 0) {
            for (var i in this.options) {
                if (this.options.hasOwnProperty(i)) {
                    if (this.options[i].hasOwnProperty('groupLabel')) {
                        var optGroupControls = document.createElement('optgroup');
                        optGroupControls.setAttribute('label', this.options[i].groupLabel);
                        for (var j in this.options[i].options) {
                            if (this.options[i].options.hasOwnProperty(j)) {
                                var option = document.createElement('option');
                                option.value = this.options[i].options[j].id.toString();
                                option.text = this.options[i].options[j].label;
                                if (configSelected !== null && configSelected.toString() === this.options[i].options[j].id.toString()) {
                                    option.setAttribute('selected', 'selected');
                                    option.setAttribute('class', 'option-highlight');
                                }
                                if (typeof this.options[i].options[j].disabled !== 'undefined'
                                    && this.options[i].options[j].disabled) {
                                    option.setAttribute('disabled', 'disabled');
                                }
                                if (typeof this.options[i].options[j].class !== 'undefined') {
                                    option.setAttribute('data-extra-class', this.options[i].options[j].class);
                                }
                                optGroupControls.appendChild(option);
                            }
                        }
                        select.add(optGroupControls, select[select.length]);
                    }
                    else {
                        var optionContainer = document.createElement('option');
                        optionContainer.value = "" + this.options[i].id;
                        optionContainer.text = "" + this.options[i].label;
                        if (configSelected !== null && configSelected.toString() === this.options[i].id.toString()) {
                            optionContainer.setAttribute('selected', 'selected');
                            optionContainer.setAttribute('class', 'option-highlight');
                        }
                        if (typeof this.options[i].disabled !== 'undefined' && this.options[i].disabled) {
                            optionContainer.setAttribute('disabled', 'disabled');
                        }
                        if (typeof this.options[i].class !== 'undefined') {
                            optionContainer.setAttribute('data-extra-class', this.options[i].class);
                        }
                        select.add(optionContainer, select[select.length]);
                    }
                }
            }
            return select;
        }
    };
    VirtualSelect.prototype.setConfig = function (config) {
        var configValues = {
            light: false,
            size: 12,
            sizeSm: null,
            sizeMd: null,
            sizeLg: null,
            fixedWidth: null,
            placeholder: "Please Select",
            append: EStaticVirtualSelectAppend.TYPE_APPEND,
            selected: null,
            isSearchable: true,
            changeOptions: null
        };
        if (typeof config !== 'undefined') {
            for (var key in config) {
                if (config.hasOwnProperty(key)) {
                    configValues[key] = config[key];
                }
            }
        }
        this.config = configValues;
    };
    VirtualSelect.prototype.getConfig = function () {
        return this.config;
    };
    VirtualSelect.prototype.changeSelectedStatusById = function (id) {
        this.config.selected = id;
        this.setSelectedOption();
    };
    VirtualSelect.prototype.placeholderText = function () {
        return this.config.placeholder;
    };
    VirtualSelect.prototype.setSelectedOption = function () {
        if (this.config.selected !== null) {
            var configSelected_1 = this.config.selected;
            if (typeof this.options !== 'undefined') {
                var selectedOption_1;
                if (Array.isArray(this.options)) {
                    this.options.filter(function (option) {
                        if (option.hasOwnProperty('groupLabel')) {
                            option.options.filter(function (opt) {
                                if (opt.id == configSelected_1) {
                                    selectedOption_1 = opt;
                                }
                            });
                        }
                        else if (option.hasOwnProperty('id') && option.id == configSelected_1) {
                            selectedOption_1 = option;
                        }
                    });
                }
                if (typeof selectedOption_1 !== 'undefined') {
                    this.selectedOption = selectedOption_1;
                }
                else {
                    this.selectedOption = null;
                }
            }
            else {
                this.selectedOption = null;
            }
        }
    };
    VirtualSelect.prototype.getSelectedOption = function () {
        if (this.config.selected !== null) {
            var configSelected_2 = this.config.selected;
            var selectedOption_2;
            if (Array.isArray(this.options)) {
                this.options.filter(function (option) {
                    if (option.hasOwnProperty('groupLabel')) {
                        option.options.filter(function (opt) {
                            if (opt.id == configSelected_2) {
                                selectedOption_2 = opt;
                            }
                        });
                    }
                    else if (option.hasOwnProperty('id') && option.id == configSelected_2) {
                        selectedOption_2 = option;
                    }
                });
            }
            if (typeof selectedOption_2 !== 'undefined') {
                return selectedOption_2;
            }
        }
        return null;
    };
    VirtualSelect.prototype.getNode = function () {
        return this.node;
    };
    VirtualSelect.prototype.setNode = function (node) {
        return this.node = node;
    };
    VirtualSelect.prototype.setOptions = function (options) {
        this.options = options;
    };
    return VirtualSelect;
}(EventEmitter));
var ReactiveButton = (function () {
    function ReactiveButton(props) {
        if (props.onClick) {
            this.onclick = props.onClick;
        }
        this.constructElement();
        this.setState(props);
    }
    ReactiveButton.prototype.constructElement = function () {
        this.element = document.createElement('button');
        this.element.setAttribute('type', 'button');
        this.element.onclick = this.clickHandler.bind(this);
    };
    ReactiveButton.prototype.getElement = function () {
        return this.element;
    };
    ReactiveButton.prototype.setState = function (state) {
        if (state.label) {
            this.element.innerHTML = state.label;
        }
        if (state.isDisabled) {
            this.element.setAttribute('disabled', 'disabled');
            this.element.setAttribute('title', state.disabledTitle || '');
        }
        else {
            this.element.removeAttribute('disabled');
            this.element.setAttribute('title', state.title || '');
        }
        if (state.classList) {
            this.element.className = state.classList;
        }
    };
    ReactiveButton.prototype.clickHandler = function (e) {
        if (this.onclick) {
            this.onclick(e);
        }
    };
    return ReactiveButton;
}());
var EElementRendererType;
(function (EElementRendererType) {
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL"] = 0] = "LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD"] = 1] = "LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL"] = 2] = "LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD"] = 3] = "LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL"] = 4] = "LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD"] = 5] = "LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD"] = 6] = "LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD"] = 7] = "LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD"] = 8] = "LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD"] = 9] = "LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD"] = 10] = "LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD";
    EElementRendererType[EElementRendererType["LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD"] = 11] = "LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD";
    EElementRendererType[EElementRendererType["CUSTOM_CONTROL_RENDERER"] = 12] = "CUSTOM_CONTROL_RENDERER";
})(EElementRendererType || (EElementRendererType = {}));
var EElementEdge;
(function (EElementEdge) {
    EElementEdge[EElementEdge["TOP"] = 0] = "TOP";
    EElementEdge[EElementEdge["RIGHT"] = 1] = "RIGHT";
    EElementEdge[EElementEdge["BOTTOM"] = 2] = "BOTTOM";
    EElementEdge[EElementEdge["LEFT"] = 3] = "LEFT";
})(EElementEdge || (EElementEdge = {}));
var EResizingCapability;
(function (EResizingCapability) {
    EResizingCapability[EResizingCapability["NONE"] = 0] = "NONE";
    EResizingCapability[EResizingCapability["TOP_AND_BOTTOM"] = 1] = "TOP_AND_BOTTOM";
    EResizingCapability[EResizingCapability["LEFT_AND_RIGHT"] = 2] = "LEFT_AND_RIGHT";
    EResizingCapability[EResizingCapability["TOP_ONLY"] = 3] = "TOP_ONLY";
    EResizingCapability[EResizingCapability["LEFT_ONLY"] = 4] = "LEFT_ONLY";
    EResizingCapability[EResizingCapability["RIGHT_ONLY"] = 5] = "RIGHT_ONLY";
    EResizingCapability[EResizingCapability["BOTTOM_ONLY"] = 6] = "BOTTOM_ONLY";
    EResizingCapability[EResizingCapability["ALL"] = 7] = "ALL";
})(EResizingCapability || (EResizingCapability = {}));
var EInputWidth;
(function (EInputWidth) {
    EInputWidth[EInputWidth["FULL"] = 0] = "FULL";
    EInputWidth[EInputWidth["THIRD"] = 1] = "THIRD";
    EInputWidth[EInputWidth["HALF"] = 2] = "HALF";
    EInputWidth[EInputWidth["QUARTER"] = 3] = "QUARTER";
    EInputWidth[EInputWidth["FILL"] = 4] = "FILL";
    EInputWidth[EInputWidth["ONE_UNIT"] = 5] = "ONE_UNIT";
    EInputWidth[EInputWidth["TWO_UNITS"] = 6] = "TWO_UNITS";
    EInputWidth[EInputWidth["THREE_UNITS"] = 7] = "THREE_UNITS";
    EInputWidth[EInputWidth["FOUR_UNITS"] = 8] = "FOUR_UNITS";
})(EInputWidth || (EInputWidth = {}));
var ELayoutDirection;
(function (ELayoutDirection) {
    ELayoutDirection[ELayoutDirection["LEFT_TO_RIGHT"] = 0] = "LEFT_TO_RIGHT";
    ELayoutDirection[ELayoutDirection["TOP_TO_BOTTOM"] = 1] = "TOP_TO_BOTTOM";
})(ELayoutDirection || (ELayoutDirection = {}));
var ELoaderDependency;
(function (ELoaderDependency) {
    ELoaderDependency[ELoaderDependency["EDITOR_PLATFORM_DETAILS"] = 0] = "EDITOR_PLATFORM_DETAILS";
    ELoaderDependency[ELoaderDependency["PAYMENT_PROCESSORS_LIST"] = 1] = "PAYMENT_PROCESSORS_LIST";
    ELoaderDependency[ELoaderDependency["SELECTED_PAYMENT_PROCESSOR_TYPE_ID"] = 2] = "SELECTED_PAYMENT_PROCESSOR_TYPE_ID";
    ELoaderDependency[ELoaderDependency["SELECTED_PAYMENT_PROCESSOR_EXTRA_DATA"] = 3] = "SELECTED_PAYMENT_PROCESSOR_EXTRA_DATA";
    ELoaderDependency[ELoaderDependency["INITIAL_QUIZ_TIMER"] = 4] = "INITIAL_QUIZ_TIMER";
    ELoaderDependency[ELoaderDependency["CURRENT_QUIZ_TIMER"] = 5] = "CURRENT_QUIZ_TIMER";
    ELoaderDependency[ELoaderDependency["SESSION_ID"] = 6] = "SESSION_ID";
    ELoaderDependency[ELoaderDependency["I18N"] = 7] = "I18N";
    ELoaderDependency[ELoaderDependency["USER_INTERFACE"] = 8] = "USER_INTERFACE";
    ELoaderDependency[ELoaderDependency["SKIP_CAPTCHA"] = 9] = "SKIP_CAPTCHA";
    ELoaderDependency[ELoaderDependency["TRANSLATIONS_LANGUAGE_CODES"] = 10] = "TRANSLATIONS_LANGUAGE_CODES";
    ELoaderDependency[ELoaderDependency["CURRENT_EDITABLE_ELEMENT"] = 11] = "CURRENT_EDITABLE_ELEMENT";
    ELoaderDependency[ELoaderDependency["DEFAULT_USER_PREFERENCES"] = 12] = "DEFAULT_USER_PREFERENCES";
    ELoaderDependency[ELoaderDependency["VIEW_FORM_CONTEXT"] = 13] = "VIEW_FORM_CONTEXT";
    ELoaderDependency[ELoaderDependency["SUBMISSION_XML_DATETIME_START"] = 14] = "SUBMISSION_XML_DATETIME_START";
    ELoaderDependency[ELoaderDependency["PAYMENTS_COUPON_CODE_CONFIGURATION"] = 15] = "PAYMENTS_COUPON_CODE_CONFIGURATION";
    ELoaderDependency[ELoaderDependency["SUBMISSION_ID"] = 16] = "SUBMISSION_ID";
    ELoaderDependency[ELoaderDependency["FORM_SETTINGS"] = 17] = "FORM_SETTINGS";
    ELoaderDependency[ELoaderDependency["SHOW_REALTIME_CALCULATIONS"] = 18] = "SHOW_REALTIME_CALCULATIONS";
    ELoaderDependency[ELoaderDependency["DETAILED_INVOICE_OPTIONS"] = 19] = "DETAILED_INVOICE_OPTIONS";
    ELoaderDependency[ELoaderDependency["LAST_CALCULATION_HTML_MARKUP"] = 20] = "LAST_CALCULATION_HTML_MARKUP";
    ELoaderDependency[ELoaderDependency["SHOW_DOWNGRADE_NOTIFICATION"] = 21] = "SHOW_DOWNGRADE_NOTIFICATION";
    ELoaderDependency[ELoaderDependency["UNDO_SERVICE"] = 22] = "UNDO_SERVICE";
    ELoaderDependency[ELoaderDependency["FONTS_MANAGER"] = 23] = "FONTS_MANAGER";
    ELoaderDependency[ELoaderDependency["GEOLOCATION_USER_COUNTRY_CODE"] = 24] = "GEOLOCATION_USER_COUNTRY_CODE";
    ELoaderDependency[ELoaderDependency["WIX_AUTHORIZED_REQUEST_DETAILS"] = 25] = "WIX_AUTHORIZED_REQUEST_DETAILS";
    ELoaderDependency[ELoaderDependency["THEME_STRATEGY"] = 26] = "THEME_STRATEGY";
    ELoaderDependency[ELoaderDependency["EXTERNAL_THEME_INITIAL_PROPERTIES"] = 27] = "EXTERNAL_THEME_INITIAL_PROPERTIES";
    ELoaderDependency[ELoaderDependency["EDITOR_SETTINGS_PANEL"] = 28] = "EDITOR_SETTINGS_PANEL";
    ELoaderDependency[ELoaderDependency["IS_HIPAA_FORM"] = 29] = "IS_HIPAA_FORM";
    ELoaderDependency[ELoaderDependency["DIFFERENCE_BETWEEN_CLIENT_AND_SERVER_TIME"] = 30] = "DIFFERENCE_BETWEEN_CLIENT_AND_SERVER_TIME";
    ELoaderDependency[ELoaderDependency["RULES_QUERY_BUILDER"] = 31] = "RULES_QUERY_BUILDER";
    ELoaderDependency[ELoaderDependency["VIEW_FORM_CONTEXT_OPTIONS"] = 32] = "VIEW_FORM_CONTEXT_OPTIONS";
    ELoaderDependency[ELoaderDependency["EDITOR_HEADER"] = 33] = "EDITOR_HEADER";
    ELoaderDependency[ELoaderDependency["IS_WORKFLOWS_VIEW_FORM_EMBED"] = 34] = "IS_WORKFLOWS_VIEW_FORM_EMBED";
    ELoaderDependency[ELoaderDependency["WORKFLOWS_USERS_LIST"] = 35] = "WORKFLOWS_USERS_LIST";
    ELoaderDependency[ELoaderDependency["POPUP_NOTIFICATIONS"] = 36] = "POPUP_NOTIFICATIONS";
    ELoaderDependency[ELoaderDependency["USER_FEATURES"] = 37] = "USER_FEATURES";
    ELoaderDependency[ELoaderDependency["DISABLED_MOBILE_INTERACTION"] = 38] = "DISABLED_MOBILE_INTERACTION";
    ELoaderDependency[ELoaderDependency["USER_PLAN_NAME"] = 39] = "USER_PLAN_NAME";
    ELoaderDependency[ELoaderDependency["DEFAULT_NOTIFICATIONS_PREFERENCES"] = 40] = "DEFAULT_NOTIFICATIONS_PREFERENCES";
    ELoaderDependency[ELoaderDependency["USER_DETAILS"] = 41] = "USER_DETAILS";
    ELoaderDependency[ELoaderDependency["SHOULD_SHOW_PAYMENT_SUMMARY"] = 42] = "SHOULD_SHOW_PAYMENT_SUMMARY";
    ELoaderDependency[ELoaderDependency["HAS_ENABLED_PAYMENT_PROCESSORS"] = 43] = "HAS_ENABLED_PAYMENT_PROCESSORS";
    ELoaderDependency[ELoaderDependency["HAS_CALCULATE_BUTTON"] = 44] = "HAS_CALCULATE_BUTTON";
})(ELoaderDependency || (ELoaderDependency = {}));
var EFormLoaderType;
(function (EFormLoaderType) {
    EFormLoaderType[EFormLoaderType["VIEW"] = 0] = "VIEW";
    EFormLoaderType[EFormLoaderType["EDIT"] = 1] = "EDIT";
})(EFormLoaderType || (EFormLoaderType = {}));
var EFormLabelPlacement;
(function (EFormLabelPlacement) {
    EFormLabelPlacement[EFormLabelPlacement["LEFT_ALIGNED"] = 0] = "LEFT_ALIGNED";
    EFormLabelPlacement[EFormLabelPlacement["TOP_ALIGNED"] = 1] = "TOP_ALIGNED";
    EFormLabelPlacement[EFormLabelPlacement["RIGHT_ALIGNED"] = 2] = "RIGHT_ALIGNED";
})(EFormLabelPlacement || (EFormLabelPlacement = {}));
var ETextAlignment;
(function (ETextAlignment) {
    ETextAlignment[ETextAlignment["LEFT"] = 0] = "LEFT";
    ETextAlignment[ETextAlignment["RIGHT"] = 1] = "RIGHT";
    ETextAlignment[ETextAlignment["CENTER"] = 2] = "CENTER";
    ETextAlignment[ETextAlignment["JUSTIFY"] = 3] = "JUSTIFY";
})(ETextAlignment || (ETextAlignment = {}));
var EFormInstructionsPlacement;
(function (EFormInstructionsPlacement) {
    EFormInstructionsPlacement[EFormInstructionsPlacement["BELOW_LABEL"] = 0] = "BELOW_LABEL";
    EFormInstructionsPlacement[EFormInstructionsPlacement["BELOW_FIELD"] = 1] = "BELOW_FIELD";
})(EFormInstructionsPlacement || (EFormInstructionsPlacement = {}));
var EFormTextDirection;
(function (EFormTextDirection) {
    EFormTextDirection[EFormTextDirection["LEFT_TO_RIGHT"] = 0] = "LEFT_TO_RIGHT";
    EFormTextDirection[EFormTextDirection["RIGHT_TO_LEFT"] = 1] = "RIGHT_TO_LEFT";
})(EFormTextDirection || (EFormTextDirection = {}));
var EElementKind;
(function (EElementKind) {
    EElementKind[EElementKind["CONTROL"] = 0] = "CONTROL";
    EElementKind[EElementKind["CONTAINER"] = 1] = "CONTAINER";
})(EElementKind || (EElementKind = {}));
var EEditorMouseOperationType;
(function (EEditorMouseOperationType) {
    EEditorMouseOperationType[EEditorMouseOperationType["NONE"] = 0] = "NONE";
    EEditorMouseOperationType[EEditorMouseOperationType["ELEMENT_RESIZE"] = 1] = "ELEMENT_RESIZE";
    EEditorMouseOperationType[EEditorMouseOperationType["LABEL_RESIZE"] = 2] = "LABEL_RESIZE";
    EEditorMouseOperationType[EEditorMouseOperationType["DRAG"] = 3] = "DRAG";
    EEditorMouseOperationType[EEditorMouseOperationType["SELECT"] = 4] = "SELECT";
})(EEditorMouseOperationType || (EEditorMouseOperationType = {}));
var EMouseEventType;
(function (EMouseEventType) {
    EMouseEventType[EMouseEventType["MOUSE_MOVE"] = 0] = "MOUSE_MOVE";
    EMouseEventType[EMouseEventType["MOUSE_DOWN"] = 1] = "MOUSE_DOWN";
    EMouseEventType[EMouseEventType["MOUSE_UP"] = 2] = "MOUSE_UP";
})(EMouseEventType || (EMouseEventType = {}));
var EMouseButton;
(function (EMouseButton) {
    EMouseButton[EMouseButton["NONE"] = 0] = "NONE";
    EMouseButton[EMouseButton["LEFT"] = 1] = "LEFT";
    EMouseButton[EMouseButton["RIGHT"] = 2] = "RIGHT";
    EMouseButton[EMouseButton["BOTH"] = 3] = "BOTH";
})(EMouseButton || (EMouseButton = {}));
var EDragAndDropSource;
(function (EDragAndDropSource) {
    EDragAndDropSource[EDragAndDropSource["STARTED_FROM_EDITOR_PANEL"] = 0] = "STARTED_FROM_EDITOR_PANEL";
    EDragAndDropSource[EDragAndDropSource["STARTED_FROM_FORM"] = 1] = "STARTED_FROM_FORM";
})(EDragAndDropSource || (EDragAndDropSource = {}));
var EFormSubmitAction;
(function (EFormSubmitAction) {
    EFormSubmitAction[EFormSubmitAction["SUBMIT"] = 0] = "SUBMIT";
    EFormSubmitAction[EFormSubmitAction["UPDATE"] = 1] = "UPDATE";
    EFormSubmitAction[EFormSubmitAction["SWITCH_PAGE"] = 2] = "SWITCH_PAGE";
    EFormSubmitAction[EFormSubmitAction["SAVE_FOR_LATER"] = 3] = "SAVE_FOR_LATER";
    EFormSubmitAction[EFormSubmitAction["SUBMIT_QUIZ"] = 4] = "SUBMIT_QUIZ";
    EFormSubmitAction[EFormSubmitAction["APPROVE"] = 5] = "APPROVE";
    EFormSubmitAction[EFormSubmitAction["REJECT"] = 6] = "REJECT";
    EFormSubmitAction[EFormSubmitAction["CALCULATE_QUIZ_SCORE"] = 7] = "CALCULATE_QUIZ_SCORE";
})(EFormSubmitAction || (EFormSubmitAction = {}));
var EInvoiceItemType;
(function (EInvoiceItemType) {
    EInvoiceItemType[EInvoiceItemType["UNKNOWN"] = 0] = "UNKNOWN";
    EInvoiceItemType[EInvoiceItemType["FIXED_AMOUNT"] = 1] = "FIXED_AMOUNT";
    EInvoiceItemType[EInvoiceItemType["PRODUCT"] = 2] = "PRODUCT";
    EInvoiceItemType[EInvoiceItemType["PRODUCT_DISCOUNT"] = 3] = "PRODUCT_DISCOUNT";
    EInvoiceItemType[EInvoiceItemType["PRODUCT_TAX"] = 4] = "PRODUCT_TAX";
    EInvoiceItemType[EInvoiceItemType["INVOICE_COUPON"] = 5] = "INVOICE_COUPON";
    EInvoiceItemType[EInvoiceItemType["INVOICE_DISCOUNT"] = 6] = "INVOICE_DISCOUNT";
    EInvoiceItemType[EInvoiceItemType["INVOICE_TAX"] = 7] = "INVOICE_TAX";
    EInvoiceItemType[EInvoiceItemType["SUBTOTAL"] = 8] = "SUBTOTAL";
    EInvoiceItemType[EInvoiceItemType["INVOICE_FEE"] = 9] = "INVOICE_FEE";
    EInvoiceItemType[EInvoiceItemType["PRODUCT_FORMULA"] = 10] = "PRODUCT_FORMULA";
})(EInvoiceItemType || (EInvoiceItemType = {}));
var EInvoiceValueType;
(function (EInvoiceValueType) {
    EInvoiceValueType[EInvoiceValueType["PERCENT"] = 0] = "PERCENT";
    EInvoiceValueType[EInvoiceValueType["FIXED"] = 1] = "FIXED";
})(EInvoiceValueType || (EInvoiceValueType = {}));
var EFormResponseAction;
(function (EFormResponseAction) {
    EFormResponseAction[EFormResponseAction["SHOW_TEXT"] = 0] = "SHOW_TEXT";
    EFormResponseAction[EFormResponseAction["REDIRECT"] = 1] = "REDIRECT";
    EFormResponseAction[EFormResponseAction["TEXT_AND_REDIRECT"] = 2] = "TEXT_AND_REDIRECT";
    EFormResponseAction[EFormResponseAction["SHOW_REPORT"] = 3] = "SHOW_REPORT";
    EFormResponseAction[EFormResponseAction["SHOW_QUIZ_RESULTS"] = 4] = "SHOW_QUIZ_RESULTS";
    EFormResponseAction[EFormResponseAction["SHOW_HTML"] = 5] = "SHOW_HTML";
    EFormResponseAction[EFormResponseAction["VALIDATION_SUCCESSFUL"] = 6] = "VALIDATION_SUCCESSFUL";
})(EFormResponseAction || (EFormResponseAction = {}));
var EColorPickerTargetControl;
(function (EColorPickerTargetControl) {
    EColorPickerTargetControl[EColorPickerTargetControl["NONE"] = 0] = "NONE";
    EColorPickerTargetControl[EColorPickerTargetControl["HUE"] = 1] = "HUE";
    EColorPickerTargetControl[EColorPickerTargetControl["SATURATION"] = 2] = "SATURATION";
    EColorPickerTargetControl[EColorPickerTargetControl["LIGHT"] = 3] = "LIGHT";
    EColorPickerTargetControl[EColorPickerTargetControl["ALPHA"] = 4] = "ALPHA";
})(EColorPickerTargetControl || (EColorPickerTargetControl = {}));
var EColorModel;
(function (EColorModel) {
    EColorModel[EColorModel["RGBA"] = 0] = "RGBA";
    EColorModel[EColorModel["HSLA"] = 1] = "HSLA";
})(EColorModel || (EColorModel = {}));
var EViewFormContext;
(function (EViewFormContext) {
    EViewFormContext[EViewFormContext["VIEW_FORM"] = 0] = "VIEW_FORM";
    EViewFormContext[EViewFormContext["EDIT_FORM"] = 1] = "EDIT_FORM";
    EViewFormContext[EViewFormContext["EDIT_SUBMISSION"] = 2] = "EDIT_SUBMISSION";
    EViewFormContext[EViewFormContext["APPROVAL"] = 3] = "APPROVAL";
    EViewFormContext[EViewFormContext["QUIZ"] = 4] = "QUIZ";
    EViewFormContext[EViewFormContext["SAVE_FOR_LATER"] = 5] = "SAVE_FOR_LATER";
    EViewFormContext[EViewFormContext["PDF_EXPORT"] = 6] = "PDF_EXPORT";
    EViewFormContext[EViewFormContext["EDIT_LATER"] = 7] = "EDIT_LATER";
    EViewFormContext[EViewFormContext["VIEW_FORM_OFFLINE"] = 8] = "VIEW_FORM_OFFLINE";
})(EViewFormContext || (EViewFormContext = {}));
var EViewFormEnvironmentContext;
(function (EViewFormEnvironmentContext) {
    EViewFormEnvironmentContext[EViewFormEnvironmentContext["DEFAULT"] = 0] = "DEFAULT";
    EViewFormEnvironmentContext[EViewFormEnvironmentContext["MOBILE_APP"] = 1] = "MOBILE_APP";
    EViewFormEnvironmentContext[EViewFormEnvironmentContext["MOBILE_APP_OFFLINE"] = 2] = "MOBILE_APP_OFFLINE";
})(EViewFormEnvironmentContext || (EViewFormEnvironmentContext = {}));
var ERuleActionType;
(function (ERuleActionType) {
    ERuleActionType[ERuleActionType["SHOW_CONTROL"] = 0] = "SHOW_CONTROL";
    ERuleActionType[ERuleActionType["HIDE_CONTROL"] = 1] = "HIDE_CONTROL";
    ERuleActionType[ERuleActionType["CALCULATE"] = 2] = "CALCULATE";
})(ERuleActionType || (ERuleActionType = {}));
var EPaymentProcessorDisplayType;
(function (EPaymentProcessorDisplayType) {
    EPaymentProcessorDisplayType[EPaymentProcessorDisplayType["DISPLAY_ONLY_AS_RADIO"] = 0] = "DISPLAY_ONLY_AS_RADIO";
    EPaymentProcessorDisplayType[EPaymentProcessorDisplayType["DISPLAY_BOTH_AS_RADIO_AND_AS_DROPDOWN"] = 1] = "DISPLAY_BOTH_AS_RADIO_AND_AS_DROPDOWN";
    EPaymentProcessorDisplayType[EPaymentProcessorDisplayType["DISPLAY_ONLY_AS_DROPDOWN"] = 2] = "DISPLAY_ONLY_AS_DROPDOWN";
})(EPaymentProcessorDisplayType || (EPaymentProcessorDisplayType = {}));
var EDatePartRole;
(function (EDatePartRole) {
    EDatePartRole[EDatePartRole["DAY"] = 0] = "DAY";
    EDatePartRole[EDatePartRole["MONTH"] = 1] = "MONTH";
    EDatePartRole[EDatePartRole["YEAR"] = 2] = "YEAR";
    EDatePartRole[EDatePartRole["HOUR_24"] = 3] = "HOUR_24";
    EDatePartRole[EDatePartRole["HOUR_12"] = 4] = "HOUR_12";
    EDatePartRole[EDatePartRole["MINUTE"] = 5] = "MINUTE";
    EDatePartRole[EDatePartRole["SECOND"] = 6] = "SECOND";
    EDatePartRole[EDatePartRole["MILLISECOND"] = 7] = "MILLISECOND";
    EDatePartRole[EDatePartRole["AM_PM"] = 8] = "AM_PM";
})(EDatePartRole || (EDatePartRole = {}));
var EDatePickerSelectionPhase;
(function (EDatePickerSelectionPhase) {
    EDatePickerSelectionPhase[EDatePickerSelectionPhase["DAY"] = 0] = "DAY";
    EDatePickerSelectionPhase[EDatePickerSelectionPhase["MONTH"] = 1] = "MONTH";
    EDatePickerSelectionPhase[EDatePickerSelectionPhase["YEAR"] = 2] = "YEAR";
    EDatePickerSelectionPhase[EDatePickerSelectionPhase["TIME"] = 3] = "TIME";
})(EDatePickerSelectionPhase || (EDatePickerSelectionPhase = {}));
var EDateWeekStart;
(function (EDateWeekStart) {
    EDateWeekStart[EDateWeekStart["SUNDAY"] = 0] = "SUNDAY";
    EDateWeekStart[EDateWeekStart["MONDAY"] = 1] = "MONDAY";
})(EDateWeekStart || (EDateWeekStart = {}));
var EUploadState;
(function (EUploadState) {
    EUploadState[EUploadState["NOT_STARTED"] = 0] = "NOT_STARTED";
    EUploadState[EUploadState["PROGRESS"] = 1] = "PROGRESS";
    EUploadState[EUploadState["SUCCESS"] = 2] = "SUCCESS";
    EUploadState[EUploadState["REMOVED"] = 3] = "REMOVED";
    EUploadState[EUploadState["ERROR"] = 4] = "ERROR";
})(EUploadState || (EUploadState = {}));
var ECaptchaType;
(function (ECaptchaType) {
    ECaptchaType[ECaptchaType["ALWAYS"] = 0] = "ALWAYS";
    ECaptchaType[ECaptchaType["RESERVED"] = 1] = "RESERVED";
    ECaptchaType[ECaptchaType["NONE"] = 2] = "NONE";
    ECaptchaType[ECaptchaType["DAILY"] = 3] = "DAILY";
    ECaptchaType[ECaptchaType["SMART"] = 4] = "SMART";
    ECaptchaType[ECaptchaType["RECAPTCHA"] = 5] = "RECAPTCHA";
})(ECaptchaType || (ECaptchaType = {}));
var EStarRatingDisplayMode;
(function (EStarRatingDisplayMode) {
    EStarRatingDisplayMode[EStarRatingDisplayMode["STARS"] = 0] = "STARS";
    EStarRatingDisplayMode[EStarRatingDisplayMode["ADULTS"] = 1] = "ADULTS";
    EStarRatingDisplayMode[EStarRatingDisplayMode["CHILDREN"] = 2] = "CHILDREN";
})(EStarRatingDisplayMode || (EStarRatingDisplayMode = {}));
var EElementVisibilityMode;
(function (EElementVisibilityMode) {
    EElementVisibilityMode[EElementVisibilityMode["SHOWN"] = 0] = "SHOWN";
    EElementVisibilityMode[EElementVisibilityMode["HIDDEN"] = 1] = "HIDDEN";
    EElementVisibilityMode[EElementVisibilityMode["REMOVED"] = 2] = "REMOVED";
    EElementVisibilityMode[EElementVisibilityMode["COMPACT"] = 3] = "COMPACT";
    EElementVisibilityMode[EElementVisibilityMode["OTHER"] = 4] = "OTHER";
})(EElementVisibilityMode || (EElementVisibilityMode = {}));
var EEditorUserAccessMode;
(function (EEditorUserAccessMode) {
    EEditorUserAccessMode[EEditorUserAccessMode["NO_ACCESS"] = 0] = "NO_ACCESS";
    EEditorUserAccessMode[EEditorUserAccessMode["VIEW_ONLY"] = 1] = "VIEW_ONLY";
    EEditorUserAccessMode[EEditorUserAccessMode["FULL_EDIT"] = 2] = "FULL_EDIT";
})(EEditorUserAccessMode || (EEditorUserAccessMode = {}));
var EFormPaginationType;
(function (EFormPaginationType) {
    EFormPaginationType[EFormPaginationType["NONE"] = 0] = "NONE";
    EFormPaginationType[EFormPaginationType["STEPS"] = 1] = "STEPS";
    EFormPaginationType[EFormPaginationType["PERCENTAGE"] = 2] = "PERCENTAGE";
    EFormPaginationType[EFormPaginationType["PAGE_NUMBERS"] = 3] = "PAGE_NUMBERS";
})(EFormPaginationType || (EFormPaginationType = {}));
var EPadType;
(function (EPadType) {
    EPadType[EPadType["LEFT"] = 0] = "LEFT";
    EPadType[EPadType["RIGHT"] = 1] = "RIGHT";
})(EPadType || (EPadType = {}));
var EFormWidthType;
(function (EFormWidthType) {
    EFormWidthType[EFormWidthType["PIXELS"] = 0] = "PIXELS";
    EFormWidthType[EFormWidthType["PERCENTS"] = 1] = "PERCENTS";
})(EFormWidthType || (EFormWidthType = {}));
var EAddressFieldType;
(function (EAddressFieldType) {
    EAddressFieldType[EAddressFieldType["ADDRESS_1"] = 0] = "ADDRESS_1";
    EAddressFieldType[EAddressFieldType["ADDRESS_2"] = 1] = "ADDRESS_2";
    EAddressFieldType[EAddressFieldType["CITY"] = 2] = "CITY";
    EAddressFieldType[EAddressFieldType["ZONE"] = 3] = "ZONE";
    EAddressFieldType[EAddressFieldType["ZIP_CODE"] = 4] = "ZIP_CODE";
    EAddressFieldType[EAddressFieldType["COUNTRY"] = 5] = "COUNTRY";
    EAddressFieldType[EAddressFieldType["ALL"] = 6] = "ALL";
})(EAddressFieldType || (EAddressFieldType = {}));
var ESocialPlatform;
(function (ESocialPlatform) {
    ESocialPlatform[ESocialPlatform["GOOGLE_PLUS"] = 0] = "GOOGLE_PLUS";
    ESocialPlatform[ESocialPlatform["LINKEDIN"] = 1] = "LINKEDIN";
    ESocialPlatform[ESocialPlatform["TWITTER"] = 2] = "TWITTER";
    ESocialPlatform[ESocialPlatform["FACEBOOK_LIKE"] = 3] = "FACEBOOK_LIKE";
    ESocialPlatform[ESocialPlatform["FACEBOOK_SHARE"] = 4] = "FACEBOOK_SHARE";
})(ESocialPlatform || (ESocialPlatform = {}));
var EChoiceDefaultOptionInputType;
(function (EChoiceDefaultOptionInputType) {
    EChoiceDefaultOptionInputType[EChoiceDefaultOptionInputType["CHECKBOX"] = 0] = "CHECKBOX";
    EChoiceDefaultOptionInputType[EChoiceDefaultOptionInputType["RADIO"] = 1] = "RADIO";
    EChoiceDefaultOptionInputType[EChoiceDefaultOptionInputType["DROPDOWN"] = 2] = "DROPDOWN";
    EChoiceDefaultOptionInputType[EChoiceDefaultOptionInputType["SCALE"] = 3] = "SCALE";
})(EChoiceDefaultOptionInputType || (EChoiceDefaultOptionInputType = {}));
var EGroupedAnswersSeparator;
(function (EGroupedAnswersSeparator) {
    EGroupedAnswersSeparator[EGroupedAnswersSeparator["NEW_LINE"] = 0] = "NEW_LINE";
    EGroupedAnswersSeparator[EGroupedAnswersSeparator["SEMICOLON"] = 1] = "SEMICOLON";
    EGroupedAnswersSeparator[EGroupedAnswersSeparator["COMMA"] = 2] = "COMMA";
    EGroupedAnswersSeparator[EGroupedAnswersSeparator["TAB"] = 3] = "TAB";
})(EGroupedAnswersSeparator || (EGroupedAnswersSeparator = {}));
var EFormPropertyOrderPlacement;
(function (EFormPropertyOrderPlacement) {
    EFormPropertyOrderPlacement[EFormPropertyOrderPlacement["BEFORE"] = 0] = "BEFORE";
    EFormPropertyOrderPlacement[EFormPropertyOrderPlacement["AFTER"] = 1] = "AFTER";
})(EFormPropertyOrderPlacement || (EFormPropertyOrderPlacement = {}));
var ENameControlOptionalFields;
(function (ENameControlOptionalFields) {
    ENameControlOptionalFields[ENameControlOptionalFields["INITIALS"] = 0] = "INITIALS";
    ENameControlOptionalFields[ENameControlOptionalFields["MIDDLE_NAME"] = 1] = "MIDDLE_NAME";
    ENameControlOptionalFields[ENameControlOptionalFields["TITLE"] = 2] = "TITLE";
})(ENameControlOptionalFields || (ENameControlOptionalFields = {}));
var EActionBarConfigurableButtons;
(function (EActionBarConfigurableButtons) {
    EActionBarConfigurableButtons[EActionBarConfigurableButtons["APPROVE"] = 0] = "APPROVE";
    EActionBarConfigurableButtons[EActionBarConfigurableButtons["CALCULATE"] = 1] = "CALCULATE";
    EActionBarConfigurableButtons[EActionBarConfigurableButtons["PREVIEW"] = 2] = "PREVIEW";
    EActionBarConfigurableButtons[EActionBarConfigurableButtons["PRINT"] = 3] = "PRINT";
    EActionBarConfigurableButtons[EActionBarConfigurableButtons["RESET"] = 4] = "RESET";
    EActionBarConfigurableButtons[EActionBarConfigurableButtons["SAVE_FOR_LATER"] = 5] = "SAVE_FOR_LATER";
    EActionBarConfigurableButtons[EActionBarConfigurableButtons["PURCHASE"] = 6] = "PURCHASE";
})(EActionBarConfigurableButtons || (EActionBarConfigurableButtons = {}));
var EActionBarButton;
(function (EActionBarButton) {
    EActionBarButton[EActionBarButton["APPROVE"] = 0] = "APPROVE";
    EActionBarButton[EActionBarButton["CALCULATE"] = 1] = "CALCULATE";
    EActionBarButton[EActionBarButton["PREVIEW"] = 2] = "PREVIEW";
    EActionBarButton[EActionBarButton["PRINT"] = 3] = "PRINT";
    EActionBarButton[EActionBarButton["RESET"] = 4] = "RESET";
    EActionBarButton[EActionBarButton["SAVE_FOR_LATER"] = 5] = "SAVE_FOR_LATER";
    EActionBarButton[EActionBarButton["SHOW_SUMMARY"] = 6] = "SHOW_SUMMARY";
    EActionBarButton[EActionBarButton["SUBMIT"] = 7] = "SUBMIT";
    EActionBarButton[EActionBarButton["NEXT_PAGE"] = 8] = "NEXT_PAGE";
    EActionBarButton[EActionBarButton["PREVIOUS_PAGE"] = 9] = "PREVIOUS_PAGE";
})(EActionBarButton || (EActionBarButton = {}));
var EInputErrorState;
(function (EInputErrorState) {
    EInputErrorState[EInputErrorState["UNFILLED"] = 0] = "UNFILLED";
    EInputErrorState[EInputErrorState["ERROR"] = 1] = "ERROR";
    EInputErrorState[EInputErrorState["FILLED"] = 2] = "FILLED";
})(EInputErrorState || (EInputErrorState = {}));
var ETimeAntiPostMeridian;
(function (ETimeAntiPostMeridian) {
    ETimeAntiPostMeridian[ETimeAntiPostMeridian["AM"] = 0] = "AM";
    ETimeAntiPostMeridian[ETimeAntiPostMeridian["PM"] = 1] = "PM";
})(ETimeAntiPostMeridian || (ETimeAntiPostMeridian = {}));
var EFileTransferType;
(function (EFileTransferType) {
    EFileTransferType[EFileTransferType["UPLOAD"] = 0] = "UPLOAD";
    EFileTransferType[EFileTransferType["DOWNLOAD"] = 1] = "DOWNLOAD";
})(EFileTransferType || (EFileTransferType = {}));
var EURLType;
(function (EURLType) {
    EURLType[EURLType["YOUTUBE_VIDEO"] = 0] = "YOUTUBE_VIDEO";
    EURLType[EURLType["VIMEO_VIDEO"] = 1] = "VIMEO_VIDEO";
    EURLType[EURLType["TED_TALKS_VIDEO"] = 2] = "TED_TALKS_VIDEO";
    EURLType[EURLType["NFB_VIDEO"] = 3] = "NFB_VIDEO";
    EURLType[EURLType["KICKSTARTER_VIDEO"] = 4] = "KICKSTARTER_VIDEO";
    EURLType[EURLType["DAILYMOTION_VIDEO"] = 5] = "DAILYMOTION_VIDEO";
    EURLType[EURLType["WORDPRESS_TV_VIDEO"] = 6] = "WORDPRESS_TV_VIDEO";
    EURLType[EURLType["TWITCH_VIDEO"] = 7] = "TWITCH_VIDEO";
    EURLType[EURLType["SOUNDCLOUD_AUDIO"] = 8] = "SOUNDCLOUD_AUDIO";
    EURLType[EURLType["MIXCLOUD_AUDIO"] = 9] = "MIXCLOUD_AUDIO";
    EURLType[EURLType["FACEBOOK_POST"] = 10] = "FACEBOOK_POST";
    EURLType[EURLType["FACEBOOK_PAGE"] = 11] = "FACEBOOK_PAGE";
    EURLType[EURLType["PDF_FILE"] = 12] = "PDF_FILE";
    EURLType[EURLType["MOBILE_EMBED"] = 13] = "MOBILE_EMBED";
})(EURLType || (EURLType = {}));
var EURLCategory;
(function (EURLCategory) {
    EURLCategory[EURLCategory["ANY"] = 0] = "ANY";
    EURLCategory[EURLCategory["VIDEO_OR_AUDIO"] = 1] = "VIDEO_OR_AUDIO";
    EURLCategory[EURLCategory["PDF"] = 2] = "PDF";
    EURLCategory[EURLCategory["FACEBOOK"] = 3] = "FACEBOOK";
})(EURLCategory || (EURLCategory = {}));
var EFieldAccessibilityNodesBitmask;
(function (EFieldAccessibilityNodesBitmask) {
    EFieldAccessibilityNodesBitmask[EFieldAccessibilityNodesBitmask["NONE"] = 0] = "NONE";
    EFieldAccessibilityNodesBitmask[EFieldAccessibilityNodesBitmask["ROOT_NODE"] = 1] = "ROOT_NODE";
    EFieldAccessibilityNodesBitmask[EFieldAccessibilityNodesBitmask["LABEL_NODE"] = 2] = "LABEL_NODE";
    EFieldAccessibilityNodesBitmask[EFieldAccessibilityNodesBitmask["ERROR_NODE"] = 4] = "ERROR_NODE";
    EFieldAccessibilityNodesBitmask[EFieldAccessibilityNodesBitmask["OTHER"] = 8] = "OTHER";
})(EFieldAccessibilityNodesBitmask || (EFieldAccessibilityNodesBitmask = {}));
var EFontSettingPart;
(function (EFontSettingPart) {
    EFontSettingPart[EFontSettingPart["FONT_FAMILY"] = 0] = "FONT_FAMILY";
    EFontSettingPart[EFontSettingPart["FONT_SIZE"] = 1] = "FONT_SIZE";
    EFontSettingPart[EFontSettingPart["FONT_WEIGHT"] = 2] = "FONT_WEIGHT";
    EFontSettingPart[EFontSettingPart["FONT_STYLE"] = 3] = "FONT_STYLE";
    EFontSettingPart[EFontSettingPart["FONT_LINE_HEIGHT"] = 4] = "FONT_LINE_HEIGHT";
})(EFontSettingPart || (EFontSettingPart = {}));
var EThemeStrategy;
(function (EThemeStrategy) {
    EThemeStrategy[EThemeStrategy["INTERNAL"] = 0] = "INTERNAL";
    EThemeStrategy[EThemeStrategy["WIX_THEME"] = 1] = "WIX_THEME";
    EThemeStrategy[EThemeStrategy["WIX_THEME_MANAGED_BY_WIX"] = 2] = "WIX_THEME_MANAGED_BY_WIX";
})(EThemeStrategy || (EThemeStrategy = {}));
var EElementMoveDirection;
(function (EElementMoveDirection) {
    EElementMoveDirection[EElementMoveDirection["UP"] = -1] = "UP";
    EElementMoveDirection[EElementMoveDirection["DOWN"] = 1] = "DOWN";
})(EElementMoveDirection || (EElementMoveDirection = {}));
var SortablePluginPosition;
(function (SortablePluginPosition) {
    SortablePluginPosition[SortablePluginPosition["BEFORE"] = 0] = "BEFORE";
    SortablePluginPosition[SortablePluginPosition["AFTER"] = 1] = "AFTER";
})(SortablePluginPosition || (SortablePluginPosition = {}));
var SortablePluginState;
(function (SortablePluginState) {
    SortablePluginState[SortablePluginState["IDLE"] = 0] = "IDLE";
    SortablePluginState[SortablePluginState["START"] = 1] = "START";
    SortablePluginState[SortablePluginState["RUN"] = 2] = "RUN";
    SortablePluginState[SortablePluginState["DROP"] = 3] = "DROP";
})(SortablePluginState || (SortablePluginState = {}));
var EPublishTabs;
(function (EPublishTabs) {
    EPublishTabs[EPublishTabs["LINK"] = 1] = "LINK";
    EPublishTabs[EPublishTabs["EMBED_JAVASCRIPT"] = 2] = "EMBED_JAVASCRIPT";
    EPublishTabs[EPublishTabs["PUBLISH_PLATFORMS"] = 3] = "PUBLISH_PLATFORMS";
    EPublishTabs[EPublishTabs["PLATFORM_BLOGGER"] = 4] = "PLATFORM_BLOGGER";
    EPublishTabs[EPublishTabs["PLATFORM_FACEBOOK"] = 5] = "PLATFORM_FACEBOOK";
    EPublishTabs[EPublishTabs["PLATFORM_WORDPRESS"] = 6] = "PLATFORM_WORDPRESS";
    EPublishTabs[EPublishTabs["PLATFORM_GOOGLE_SITES"] = 7] = "PLATFORM_GOOGLE_SITES";
    EPublishTabs[EPublishTabs["PLATFORM_TWITTER"] = 8] = "PLATFORM_TWITTER";
    EPublishTabs[EPublishTabs["PLATFORM_JOOMLA"] = 9] = "PLATFORM_JOOMLA";
    EPublishTabs[EPublishTabs["PLATFORM_SALESFORCE"] = 10] = "PLATFORM_SALESFORCE";
    EPublishTabs[EPublishTabs["PLATFORM_UNBOUNCE"] = 11] = "PLATFORM_UNBOUNCE";
    EPublishTabs[EPublishTabs["PLATFORM_SHOPIFY"] = 13] = "PLATFORM_SHOPIFY";
    EPublishTabs[EPublishTabs["PLATFORM_BIG_COMMERCE"] = 14] = "PLATFORM_BIG_COMMERCE";
    EPublishTabs[EPublishTabs["PLATFORM_WEEBLY"] = 15] = "PLATFORM_WEEBLY";
    EPublishTabs[EPublishTabs["PLATFORM_SALESFORCE_COMMUNITY"] = 16] = "PLATFORM_SALESFORCE_COMMUNITY";
})(EPublishTabs || (EPublishTabs = {}));
var EPublishPanelIds;
(function (EPublishPanelIds) {
    EPublishPanelIds["PUBLISH"] = "publish-form";
    EPublishPanelIds["PUBLISH_PLATFORMS"] = "platforms-publish-method";
    EPublishPanelIds["LINK"] = "link-publish-method";
    EPublishPanelIds["EMBED_JAVASCRIPT"] = "embed-publish-method";
    EPublishPanelIds["PLATFORM_SHOPIFY"] = "shopify-publish-method";
    EPublishPanelIds["PLATFORM_BIG_COMMERCE"] = "bigcommerce-publish-method";
    EPublishPanelIds["PLATFORM_FACEBOOK"] = "facebook-publish-method";
    EPublishPanelIds["PLATFORM_BLOGGER"] = "blogger-publish-method";
    EPublishPanelIds["PLATFORM_WORDPRESS"] = "wordpress-publish-method";
    EPublishPanelIds["PLATFORM_JOOMLA"] = "joomla-publish-method";
    EPublishPanelIds["PLATFORM_SALESFORCE"] = "salesforce-publish-method";
    EPublishPanelIds["PLATFORM_SALESFORCE_COMMUNITY"] = "salesforce-community-publish-method";
    EPublishPanelIds["PLATFORM_UNBOUNCE"] = "unbounce-publish-method";
    EPublishPanelIds["PLATFORM_GOOGLE_SITES"] = "google-sites-publish-method";
    EPublishPanelIds["PLATFORM_TWITTER"] = "twitter-publish-method";
    EPublishPanelIds["PLATFORM_WEEBLY"] = "weebly-publish-method";
})(EPublishPanelIds || (EPublishPanelIds = {}));
var EPublishEmbedType;
(function (EPublishEmbedType) {
    EPublishEmbedType[EPublishEmbedType["LINK"] = 0] = "LINK";
    EPublishEmbedType[EPublishEmbedType["JAVASCRIPT"] = 1] = "JAVASCRIPT";
    EPublishEmbedType[EPublishEmbedType["IFRAME"] = 2] = "IFRAME";
    EPublishEmbedType[EPublishEmbedType["EMBED_HTML_TEXT"] = 3] = "EMBED_HTML_TEXT";
    EPublishEmbedType[EPublishEmbedType["EMBED_HTML_IMAGE"] = 4] = "EMBED_HTML_IMAGE";
    EPublishEmbedType[EPublishEmbedType["LIGHTBOX_TEXT_LINK"] = 5] = "LIGHTBOX_TEXT_LINK";
    EPublishEmbedType[EPublishEmbedType["LIGHTBOX_IMAGE_LINK"] = 6] = "LIGHTBOX_IMAGE_LINK";
    EPublishEmbedType[EPublishEmbedType["LIGHTBOX_FLOATING_BUTTON"] = 7] = "LIGHTBOX_FLOATING_BUTTON";
    EPublishEmbedType[EPublishEmbedType["LIGHTBOX_AUTO_POPUP"] = 8] = "LIGHTBOX_AUTO_POPUP";
    EPublishEmbedType[EPublishEmbedType["EMBED_INLINE_HTML"] = 9] = "EMBED_INLINE_HTML";
    EPublishEmbedType[EPublishEmbedType["APP_FACEBOOK"] = 10] = "APP_FACEBOOK";
    EPublishEmbedType[EPublishEmbedType["APP_BLOGGER"] = 11] = "APP_BLOGGER";
    EPublishEmbedType[EPublishEmbedType["APP_WORDPRESS"] = 12] = "APP_WORDPRESS";
    EPublishEmbedType[EPublishEmbedType["APP_JOOMLA"] = 13] = "APP_JOOMLA";
    EPublishEmbedType[EPublishEmbedType["APP_SALESFORCE"] = 14] = "APP_SALESFORCE";
    EPublishEmbedType[EPublishEmbedType["APP_UNBOUNCE"] = 15] = "APP_UNBOUNCE";
    EPublishEmbedType[EPublishEmbedType["APP_GOOGLE"] = 16] = "APP_GOOGLE";
    EPublishEmbedType[EPublishEmbedType["APP_TWITTER"] = 17] = "APP_TWITTER";
    EPublishEmbedType[EPublishEmbedType["APP_BIGCOMMERCE"] = 18] = "APP_BIGCOMMERCE";
    EPublishEmbedType[EPublishEmbedType["APP_SHOPIFY"] = 19] = "APP_SHOPIFY";
})(EPublishEmbedType || (EPublishEmbedType = {}));
var ESMTPServerProtocol;
(function (ESMTPServerProtocol) {
    ESMTPServerProtocol["AUTO"] = "auto";
    ESMTPServerProtocol["NONE"] = "none";
    ESMTPServerProtocol["SSL"] = "ssl";
    ESMTPServerProtocol["TLS"] = "tls";
})(ESMTPServerProtocol || (ESMTPServerProtocol = {}));
var ENotificationTemplateContext;
(function (ENotificationTemplateContext) {
    ENotificationTemplateContext["NEW_TEMPLATE"] = "new-template";
    ENotificationTemplateContext["EDIT_TEMPLATES"] = "edit-templates";
})(ENotificationTemplateContext || (ENotificationTemplateContext = {}));
var ENotificationsSendType;
(function (ENotificationsSendType) {
    ENotificationsSendType["SEND_TO_SELECTED_RECIPIENTS"] = "to_recipients";
    ENotificationsSendType["SEND_ACCORDING_TO_RULES"] = "according_to_rules";
})(ENotificationsSendType || (ENotificationsSendType = {}));
var ENotificationTagType;
(function (ENotificationTagType) {
    ENotificationTagType["EMAIL"] = "email";
    ENotificationTagType["PHONE"] = "phoneNumber";
    ENotificationTagType["CONTROL_ID"] = "controlId";
    ENotificationTagType["CUSTOM"] = "custom";
})(ENotificationTagType || (ENotificationTagType = {}));
var ENotificationsAttachmentType;
(function (ENotificationsAttachmentType) {
    ENotificationsAttachmentType["FILE"] = "file";
    ENotificationsAttachmentType["HTML_TO_PDF"] = "html_to_pdf";
    ENotificationsAttachmentType["FORM_LAYOUT"] = "form_layout";
})(ENotificationsAttachmentType || (ENotificationsAttachmentType = {}));
var ENotificationType;
(function (ENotificationType) {
    ENotificationType["EMAIL"] = "email";
    ENotificationType["SMS"] = "sms";
})(ENotificationType || (ENotificationType = {}));
var ENotificationsCategory;
(function (ENotificationsCategory) {
    ENotificationsCategory["DEFAULT"] = "default";
    ENotificationsCategory["DRAFT"] = "draft";
})(ENotificationsCategory || (ENotificationsCategory = {}));
var ECustomRecipientType;
(function (ECustomRecipientType) {
    ECustomRecipientType["USER_EMAIL"] = "userEmail";
    ECustomRecipientType["USER_PHONE"] = "userPhone";
})(ECustomRecipientType || (ECustomRecipientType = {}));
var EActionTypesForNotificationsLoad;
(function (EActionTypesForNotificationsLoad) {
    EActionTypesForNotificationsLoad["DELETE_NOTIFICATION"] = "delete-notification-from-list";
    EActionTypesForNotificationsLoad["LOAD_ALL_NOTIFICATIONS"] = "load-all-notifications";
    EActionTypesForNotificationsLoad["DUPLICATE_NOTIFICATION"] = "duplicate-notification-from-list";
    EActionTypesForNotificationsLoad["SAVE_EMAIL_NOTIFICATION"] = "notification-email-save-new";
    EActionTypesForNotificationsLoad["UPDATE_EMAIL_NOTIFICATION"] = "notification-email-save-update";
    EActionTypesForNotificationsLoad["NEW_EMAIL"] = "notification-new-email";
    EActionTypesForNotificationsLoad["SAVE_SMS_NOTIFICATION"] = "notification-sms-save-new";
    EActionTypesForNotificationsLoad["UPDATE_SMS_NOTIFICATION"] = "notification-sms-save-update";
})(EActionTypesForNotificationsLoad || (EActionTypesForNotificationsLoad = {}));
var ETypeOfMessages;
(function (ETypeOfMessages) {
    ETypeOfMessages["ERROR"] = "error";
    ETypeOfMessages["SUCCESS"] = "success";
})(ETypeOfMessages || (ETypeOfMessages = {}));
var ENotificationsEmailContentType;
(function (ENotificationsEmailContentType) {
    ENotificationsEmailContentType["HTML"] = "html";
    ENotificationsEmailContentType["PLAIN_TEXT"] = "text";
})(ENotificationsEmailContentType || (ENotificationsEmailContentType = {}));
var ENotificationsEvents;
(function (ENotificationsEvents) {
    ENotificationsEvents["CLOSE_ALL_PANELS"] = "close-all-panels";
})(ENotificationsEvents || (ENotificationsEvents = {}));
var ENotificationsSMSErrors;
(function (ENotificationsSMSErrors) {
    ENotificationsSMSErrors["DRAFT"] = "draft";
    ENotificationsSMSErrors["DRAFT_NO_RECIPIENTS"] = "draft-no-recipients";
    ENotificationsSMSErrors["DRAFT_NO_BODY"] = "draft-no-body";
    ENotificationsSMSErrors["NO_USER_PHONE"] = "user-phone";
    ENotificationsSMSErrors["NOT_ENOUGH_CREDITS"] = "not-enough-credits";
})(ENotificationsSMSErrors || (ENotificationsSMSErrors = {}));
var EMarginType;
(function (EMarginType) {
    EMarginType["LEFT"] = "left";
    EMarginType["TOP"] = "top";
    EMarginType["RIGHT"] = "right";
    EMarginType["BOTTOM"] = "bottom";
})(EMarginType || (EMarginType = {}));
var ENodeName;
(function (ENodeName) {
    ENodeName["SPAN"] = "SPAN";
    ENodeName["BR"] = "BR";
})(ENodeName || (ENodeName = {}));
var EUITagsContainerState;
(function (EUITagsContainerState) {
    EUITagsContainerState["DISABLED"] = "disabled";
    EUITagsContainerState["ENABLED"] = "enabled";
    EUITagsContainerState["FULLY_DISABLED"] = "fully-disabled";
})(EUITagsContainerState || (EUITagsContainerState = {}));
var EVariableIdentifier;
(function (EVariableIdentifier) {
    EVariableIdentifier["ENTRY_ID"] = ":entryId:";
    EVariableIdentifier["IP"] = ":ip:";
    EVariableIdentifier["COUNTRY_CODE"] = ":countryCode:";
    EVariableIdentifier["BROWSER"] = ":browser:";
    EVariableIdentifier["DEVICE_TYPE"] = ":deviceType:";
    EVariableIdentifier["REFERRER"] = ":referer:";
    EVariableIdentifier["FORM_HOST"] = ":formHost:";
    EVariableIdentifier["REFERENCE_ID"] = ":referenceId:";
    EVariableIdentifier["EDIT_SUBMISSION_LINK"] = ":editSubmissionLink:";
    EVariableIdentifier["QUIZ_SCORE"] = ":quizScore:";
    EVariableIdentifier["APPROVAL_LINK"] = ":approvalLink:";
    EVariableIdentifier["APPROVAL_HISTORY"] = ":approvalHistory:";
    EVariableIdentifier["PAYMENT_SUMMARY"] = ":paymentSummary:";
    EVariableIdentifier["PAYMENT_LINK"] = ":paymentLink:";
    EVariableIdentifier["PAYMENT_AMOUNT"] = ":paymentAmount:";
    EVariableIdentifier["PAYMENT_CURRENCY"] = ":paymentCurrency:";
    EVariableIdentifier["PAYMENT_STATUS"] = ":paymentStatus:";
    EVariableIdentifier["PAYMENT_PROCESSOR_NAME"] = ":paymentProcessorName:";
    EVariableIdentifier["PAYMENT_COUPON"] = ":paymentCoupon:";
    EVariableIdentifier["SUBMISSION_STATUS"] = ":submissionStatus:";
    EVariableIdentifier["SUBMISSION_SUMMARY"] = ":submissionSummary:";
    EVariableIdentifier["LANGUAGE"] = ":language:";
    EVariableIdentifier["QUIZ_SUMMARY"] = ":quizSummary:";
    EVariableIdentifier["SUBMISSION_DATE"] = ":submissionDate:";
    EVariableIdentifier["SUBMISSION_DATE_TIME"] = ":submissionDateTime:";
    EVariableIdentifier["SUBMISSION_TIME"] = ":submissionTime:";
    EVariableIdentifier["FORM_NAME"] = ":formName:";
})(EVariableIdentifier || (EVariableIdentifier = {}));
var ERuleExpressionType;
(function (ERuleExpressionType) {
    ERuleExpressionType["EXPRESSION"] = "expression";
    ERuleExpressionType["CONTROL"] = "control";
    ERuleExpressionType["OPERATOR"] = "operator";
    ERuleExpressionType["EXTRA"] = "extra";
    ERuleExpressionType["LOGICAL"] = "logical";
    ERuleExpressionType["VALUE"] = "value";
})(ERuleExpressionType || (ERuleExpressionType = {}));
var ERulesOptionsVisibilityState;
(function (ERulesOptionsVisibilityState) {
    ERulesOptionsVisibilityState["ADD"] = "add";
    ERulesOptionsVisibilityState["REMOVE"] = "remove";
    ERulesOptionsVisibilityState["BOTH"] = "both";
    ERulesOptionsVisibilityState["NONE"] = "none";
})(ERulesOptionsVisibilityState || (ERulesOptionsVisibilityState = {}));
var ESettingColumnName;
(function (ESettingColumnName) {
    ESettingColumnName["INDEX"] = "index";
    ESettingColumnName["DESCRIPTION"] = "description";
    ESettingColumnName["UNIT_PRICE"] = "unitPrice";
    ESettingColumnName["QUANTITY"] = "quantity";
    ESettingColumnName["TOTAL_PRICE"] = "totalPrice";
})(ESettingColumnName || (ESettingColumnName = {}));
var EEventType;
(function (EEventType) {
    EEventType["BLUR"] = "blur";
    EEventType["INPUT"] = "input";
})(EEventType || (EEventType = {}));
var EVisibilityMode;
(function (EVisibilityMode) {
    EVisibilityMode["SHOW"] = "show";
    EVisibilityMode["HIDE"] = "hide";
})(EVisibilityMode || (EVisibilityMode = {}));
var EPaymentSummaryProperties;
(function (EPaymentSummaryProperties) {
    EPaymentSummaryProperties["SHOW_SUMMARY_AFTER_SUBMIT"] = "showSummaryAfterSubmit";
    EPaymentSummaryProperties["SHOW_REALTIME_SUMMARY"] = "showRealTimeSummary";
    EPaymentSummaryProperties["COLUMNS"] = "columns";
})(EPaymentSummaryProperties || (EPaymentSummaryProperties = {}));
var EBuilderRoutes;
(function (EBuilderRoutes) {
    EBuilderRoutes["NOTIFICATIONS"] = "notifications_v2";
    EBuilderRoutes["OLD_NOTIFICATIONS"] = "notifications_v1";
    EBuilderRoutes["TRANSLATIONS"] = "translations";
    EBuilderRoutes["EDITOR"] = "editor";
    EBuilderRoutes["THEMES"] = "options";
    EBuilderRoutes["PUBLISH_GET_LINK"] = "publish_get_link";
    EBuilderRoutes["PAYMENTS"] = "payments";
    EBuilderRoutes["PAYMENTS_V1"] = "payments_v1";
    EBuilderRoutes["PUBLISH"] = "publish-form";
    EBuilderRoutes["PUBLISH_PLATFORMS"] = "PublishPlatforms";
    EBuilderRoutes["PUBLISH_EMBED_CODE"] = "PublishEmbedCode";
    EBuilderRoutes["PUBLISH_FACEBOOK"] = "PublishFacebook";
    EBuilderRoutes["PUBLISH_BLOGGER"] = "PublishBlogger";
    EBuilderRoutes["PUBLISH_WORDPRESS"] = "PublishWordpress";
    EBuilderRoutes["PUBLISH_JOOMLA"] = "PublishJoomla";
    EBuilderRoutes["PUBLISH_SALESFORCE"] = "PublishSalesforce";
    EBuilderRoutes["PUBLISH_SALESFORCE_COMMUNITY"] = "PublishSalesforceCommunity";
    EBuilderRoutes["PUBLISH_SALESFORCE_PLATFORMS"] = "PublishSalesforcePlatforms";
    EBuilderRoutes["PUBLISH_UNBOUNCE"] = "PublishUnbounce";
    EBuilderRoutes["PUBLISH_GOOGLE_SITES"] = "PublishGoogleSites";
    EBuilderRoutes["PUBLISH_TWITTER"] = "PublishTwitter";
    EBuilderRoutes["PUBLISH_PLATFORM_BIG_COMMERCE"] = "PublishPlatformBigCommerce";
    EBuilderRoutes["PUBLISH_PLATFORM_SHOPIFY"] = "PublishPlatformShopify";
    EBuilderRoutes["PUBLISH_PLATFORM_WEEBLY"] = "PublishPlatformWeebly";
    EBuilderRoutes["PUBLISH_WEEBLY"] = "PublishOnWeebly";
    EBuilderRoutes["PUBLISH_WEEBLY_LINK"] = "PublishLinkOnWeebly";
    EBuilderRoutes["PUBLISH_WEEBLY_LIGHTBOX"] = "PublishLightboxOnWeebly";
    EBuilderRoutes["PUBLISH_WEEBLY_PLATFORMS"] = "PublishPlatformsOnWeebly";
    EBuilderRoutes["PUBLISH_SHOPIFY"] = "PublishShopify";
    EBuilderRoutes["PUBLISH_SHOPIFY_LINK"] = "PublishLinkShopify";
    EBuilderRoutes["PUBLISH_SHOPIFY_LIGHTBOX"] = "PublishLightboxShopify";
    EBuilderRoutes["PUBLISH_SHOPIFY_PLATFORMS"] = "PublishPlatformsOnShopify";
    EBuilderRoutes["PUBLISH_BIG_COMMERCE"] = "PublishBigCommerce";
    EBuilderRoutes["PUBLISH_BIG_COMMERCE_LINK"] = "PublishLinkBigCommerce";
    EBuilderRoutes["PUBLISH_BIG_COMMERCE_LIGHTBOX"] = "PublishLightboxBigCommerce";
    EBuilderRoutes["PUBLISH_BIG_COMMERCE_PLATFORMS"] = "PublishPlatformsOnBigCommerce";
    EBuilderRoutes["PUBLISH_V1"] = "Publish_V1";
})(EBuilderRoutes || (EBuilderRoutes = {}));
var EEditorReducerActions;
(function (EEditorReducerActions) {
    EEditorReducerActions["NAVIGATE"] = "navigate";
    EEditorReducerActions["SET_FORM_ID"] = "setFormId";
    EEditorReducerActions["SET_PUBLISH_TAB"] = "setPublishTab";
    EEditorReducerActions["SET_INITIAL_FORM_CONTROLS"] = "setInitialFormControls";
    EEditorReducerActions["UPDATE_CONTROL_PROPERTY"] = "updateControlProperty";
})(EEditorReducerActions || (EEditorReducerActions = {}));
var EUpgradeReason;
(function (EUpgradeReason) {
    EUpgradeReason[EUpgradeReason["GENERIC_UPGRADE_REASON"] = 0] = "GENERIC_UPGRADE_REASON";
    EUpgradeReason[EUpgradeReason["CONTROL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 1] = "CONTROL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["VALIDATOR_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 2] = "VALIDATOR_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["NUMBER_OF_FIELDS_EXCEEDED_IN_CURRENT_USER_PLAN"] = 3] = "NUMBER_OF_FIELDS_EXCEEDED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["CREATE_NEW_FORM_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 4] = "CREATE_NEW_FORM_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["RULES_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 5] = "RULES_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["PAYMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 6] = "PAYMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["SMS_NOTIFICATIONS_ARE_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 7] = "SMS_NOTIFICATIONS_ARE_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["ENCRIPTION_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 8] = "ENCRIPTION_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["HTML_BLOCK_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 9] = "HTML_BLOCK_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["SUBMISSIONS_EXPORT_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 10] = "SUBMISSIONS_EXPORT_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["LIMIT_NUMBER_OF_TIME_OPTIONS_CAN_BE_CHOSEN"] = 11] = "LIMIT_NUMBER_OF_TIME_OPTIONS_CAN_BE_CHOSEN";
    EUpgradeReason[EUpgradeReason["QUIZ_OPTIONS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 12] = "QUIZ_OPTIONS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["GET_MORE_USERS"] = 13] = "GET_MORE_USERS";
    EUpgradeReason[EUpgradeReason["MAXIMUM_NUMBER_OF_TRANSLATIONS_REACHED"] = 14] = "MAXIMUM_NUMBER_OF_TRANSLATIONS_REACHED";
    EUpgradeReason[EUpgradeReason["MAXIMUM_NUMBER_OF_LIKERT_STATEMENTS_IN_CURRENT_USER_PLAN"] = 15] = "MAXIMUM_NUMBER_OF_LIKERT_STATEMENTS_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["SSL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 16] = "SSL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["DOMAIN_ALIAS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 17] = "DOMAIN_ALIAS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["MAXIMUM_NUMBER_OF_SMS_NOTIFICATIONS_REACHED"] = 18] = "MAXIMUM_NUMBER_OF_SMS_NOTIFICATIONS_REACHED";
    EUpgradeReason[EUpgradeReason["MAXIMUM_NUMBER_OF_EMAIL_RECIPIENTS_REACHED"] = 19] = "MAXIMUM_NUMBER_OF_EMAIL_RECIPIENTS_REACHED";
    EUpgradeReason[EUpgradeReason["MAXIMUM_NUMBER_OF_EMAIL_NOTIFICATIONS_REACHED"] = 20] = "MAXIMUM_NUMBER_OF_EMAIL_NOTIFICATIONS_REACHED";
    EUpgradeReason[EUpgradeReason["ATTACHMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 21] = "ATTACHMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["NOTIFICATIONS_ADD_SUBMISSION_PDF_ATTACHMENTS"] = 22] = "NOTIFICATIONS_ADD_SUBMISSION_PDF_ATTACHMENTS";
    EUpgradeReason[EUpgradeReason["NOTIFICATIONS_ADD_FORM_LAYOUT_ATTACHMENTS"] = 23] = "NOTIFICATIONS_ADD_FORM_LAYOUT_ATTACHMENTS";
    EUpgradeReason[EUpgradeReason["EDIT_NOTIFICATION_TEMPLATE_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 24] = "EDIT_NOTIFICATION_TEMPLATE_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["NOTIFICATIONS_ADD_RULES"] = 25] = "NOTIFICATIONS_ADD_RULES";
    EUpgradeReason[EUpgradeReason["SMTP_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 26] = "SMTP_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
    EUpgradeReason[EUpgradeReason["SALESFORCE_COMMUNITY_SHARING_NOT_SUPPORTED_IN_CURRENT_USER_PLAN"] = 27] = "SALESFORCE_COMMUNITY_SHARING_NOT_SUPPORTED_IN_CURRENT_USER_PLAN";
})(EUpgradeReason || (EUpgradeReason = {}));
var EUserPlanNames;
(function (EUserPlanNames) {
    EUserPlanNames["USER_PLAN_FREE"] = "Free";
    EUserPlanNames["USER_PLAN_STARTER"] = "Starter";
    EUserPlanNames["USER_PLAN_SILVER"] = "Silver";
    EUserPlanNames["USER_PLAN_GOLD"] = "Gold";
    EUserPlanNames["USER_PLAN_PLATINUM"] = "Platinum";
    EUserPlanNames["USER_PLAN_PROFESSIONAL"] = "Professional";
    EUserPlanNames["USER_PLAN_CORPORATE"] = "Corporate";
})(EUserPlanNames || (EUserPlanNames = {}));
var EFormFieldsLimit;
(function (EFormFieldsLimit) {
    EFormFieldsLimit[EFormFieldsLimit["USER_FIELDS_PLAN_FREE"] = 10] = "USER_FIELDS_PLAN_FREE";
    EFormFieldsLimit[EFormFieldsLimit["USER_FIELDS_PLAN_STARTER"] = 30] = "USER_FIELDS_PLAN_STARTER";
    EFormFieldsLimit[EFormFieldsLimit["USER_FIELDS_PLAN_SILVER"] = 30] = "USER_FIELDS_PLAN_SILVER";
})(EFormFieldsLimit || (EFormFieldsLimit = {}));
var EUserPlanIds;
(function (EUserPlanIds) {
    EUserPlanIds[EUserPlanIds["BASIC"] = 0] = "BASIC";
    EUserPlanIds[EUserPlanIds["GOLD"] = 1] = "GOLD";
    EUserPlanIds[EUserPlanIds["PLATINUM"] = 2] = "PLATINUM";
    EUserPlanIds[EUserPlanIds["PROFESSIONAL"] = 3] = "PROFESSIONAL";
    EUserPlanIds[EUserPlanIds["CORPORATE"] = 4] = "CORPORATE";
})(EUserPlanIds || (EUserPlanIds = {}));
var EPublishPanelName;
(function (EPublishPanelName) {
    EPublishPanelName["PUBLISH_WEEBLY"] = "weebly-embed-in-page-publish-method";
    EPublishPanelName["PUBLISH_WEEBLY_LINK"] = "weebly-link-to-form-publish-method";
    EPublishPanelName["PUBLISH_WEEBLY_LIGHTBOX"] = "weebly-lightbox-publish-method";
    EPublishPanelName["PUBLISH_BIG_COMMERCE"] = "bigcommerce-embed-in-page-publish-method";
    EPublishPanelName["PUBLISH_BIG_COMMERCE_LINK"] = "bigcommerce-link-to-form-publish-method";
    EPublishPanelName["PUBLISH_BIG_COMMERCE_LIGHTBOX"] = "bigcommerce-lightbox-publish-method";
    EPublishPanelName["PUBLISH_SHOPIFY"] = "shopify-embed-in-page-publish-method";
    EPublishPanelName["PUBLISH_SHOPIFY_LINK"] = "shopify-link-to-form-publish-method";
    EPublishPanelName["PUBLISH_SHOPIFY_LIGHTBOX"] = "shopify-lightbox-publish-method";
    EPublishPanelName["PUBLISH_EMBED_CODE"] = "embed-publish-method";
    EPublishPanelName["PUBLISH_BLOGGER"] = "blogger-publish-method";
    EPublishPanelName["PUBLISH_FACEBOOK"] = "facebook-publish-method";
    EPublishPanelName["PUBLISH_GOOGLE_SITES"] = "google-sites-publish-method";
    EPublishPanelName["PUBLISH_JOOMLA"] = "joomla-publish-method";
    EPublishPanelName["PUBLISH_SALESFORCE"] = "salesforce-publish-method";
    EPublishPanelName["PUBLISH_SALESFORCE_COMMUNITY"] = "salesforce-community-publish-method";
    EPublishPanelName["PUBLISH_TWITTER"] = "twitter-publish-method";
    EPublishPanelName["PUBLISH_UNBOUNCE"] = "unbounce-publish-method";
    EPublishPanelName["PUBLISH_WORDPRESS"] = "wordpress-publish-method";
    EPublishPanelName["PUBLISH_PLATFORMS"] = "platforms-publish-method";
    EPublishPanelName["PUBLISH_PLATFORM_BIG_COMMERCE"] = "bigcommerce-publish-method";
    EPublishPanelName["PUBLISH_PLATFORM_SHOPIFY"] = "shopify-publish-method";
    EPublishPanelName["PUBLISH_PLATFORM_WEEBLY"] = "weebly-publish-method";
    EPublishPanelName["PUBLISH_LINK"] = "link-publish-method";
})(EPublishPanelName || (EPublishPanelName = {}));
var EControlType;
(function (EControlType) {
    EControlType["FILE_UPLOAD"] = "file_upload_control";
    EControlType["REPEATABLE"] = "repeatable_container";
    EControlType["PASSWORD"] = "password_control";
    EControlType["FORMULA"] = "formula_control";
    EControlType["FEE"] = "fee_control";
})(EControlType || (EControlType = {}));
var ETagValueType;
(function (ETagValueType) {
    ETagValueType["TEXT"] = "text";
    ETagValueType["TAG"] = "tag";
})(ETagValueType || (ETagValueType = {}));
var JQLWorkerConnector = (function (_super) {
    __extends(JQLWorkerConnector, _super);
    function JQLWorkerConnector(workerName) {
        var _this = _super.call(this) || this;
        _this.currentMessageId = 0;
        JQLWorkerConnector.instance = _this;
        _this.worker = new Worker(workerName || 'jqlworker.js');
        _this.addWorkerMessageListener();
        return _this;
    }
    JQLWorkerConnector.prototype.addWorkerMessageListener = function () {
        var _this = this;
        this.worker.addEventListener("message", function (event) {
            _this.trigger(event.data["type"], event);
        });
    };
    ;
    JQLWorkerConnector.getInstance = function () {
        if (!JQLWorkerConnector.instance) {
            new JQLWorkerConnector();
        }
        return JQLWorkerConnector.instance;
    };
    JQLWorkerConnector.prototype.postMessage = function (type, action, instanceId, messageId, data) {
        this.worker.postMessage({
            type: type,
            action: action,
            instanceId: instanceId,
            messageId: messageId,
            data: data
        });
    };
    JQLWorkerConnector.prototype.getUniqueMessageId = function () {
        return ++this.currentMessageId;
    };
    return JQLWorkerConnector;
}(EventEmitter));
var JQLWorkerBase = (function (_super) {
    __extends(JQLWorkerBase, _super);
    function JQLWorkerBase(instanceId) {
        var _this = _super.call(this) || this;
        _this.promiseResolves = {};
        _this.promiseRejects = {};
        _this.resolve = function (messageId, data) {
            if (_this.promiseResolves[messageId]) {
                _this.promiseResolves[messageId](data);
                _this.promiseResolves[messageId] = null;
                _this.promiseRejects[messageId] = null;
            }
        };
        _this.reject = function (messageId, reason) {
            if (_this.promiseRejects[messageId]) {
                _this.promiseRejects[messageId](reason);
                _this.promiseResolves[messageId] = null;
                _this.promiseRejects[messageId] = null;
            }
        };
        _this.workerConnector = JQLWorkerConnector.getInstance();
        _this.instanceId = instanceId | JQLWorkerBase.getUniqueId();
        _this.workerConnector.on(_this.getType(), _this.handleWorkerMessage.bind(_this));
        return _this;
    }
    JQLWorkerBase.prototype.handleWorkerMessage = function (event) {
    };
    JQLWorkerBase.prototype.getType = function () {
        return "";
    };
    JQLWorkerBase.prototype.getInstanceId = function () {
        return this.instanceId;
    };
    JQLWorkerBase.prototype.isMessageForThisInstance = function (event) {
        return event.data["targetInstanceId"] === this.getInstanceId();
    };
    JQLWorkerBase.prototype.getMessageIdAndSavePromise = function (resolve, reject) {
        var messageId = this.workerConnector.getUniqueMessageId();
        this.promiseResolves[messageId] = resolve;
        this.promiseRejects[messageId] = reject;
        return messageId;
    };
    JQLWorkerBase.prototype.postRequest = function (action, data) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var messageId = _this.getMessageIdAndSavePromise(resolve, reject);
            _this.workerConnector.postMessage(_this.getType(), action, _this.getInstanceId(), messageId, data);
        });
    };
    JQLWorkerBase.prototype.postResponse = function (action, data) {
        this.workerConnector.postMessage(this.getType(), action, this.getInstanceId(), null, data);
    };
    JQLWorkerBase.getUniqueId = function () {
        return ++JQLWorkerBase.instanceIdCounter;
    };
    JQLWorkerBase.instanceIdCounter = 0;
    return JQLWorkerBase;
}(EventEmitter));
var ViewManager = (function () {
    function ViewManager() {
        this.isNotificationsV2Initialised = false;
        this.isTranslationsInitialised = false;
        this.isThemesInitialised = false;
        this.isPublishInitialised = false;
        this.currentRoute = '';
        this.isSidebarSwitcherMounted = false;
        this.editorPanelConfig = window['EditorPanelConfig'];
        this.URLHandler = window['builderUrlHandler'];
        this.store = window['builderStore'];
        this.store.subscribe(this.handleChange.bind(this));
        this.createSidebarIfNeeded();
    }
    ViewManager.prototype.setPanelGroup = function (panelGroup) {
        this.editorPanelGroup = panelGroup;
    };
    ViewManager.prototype.setLoader = function (loader) {
        this.loader = loader;
    };
    ViewManager.prototype.createSidebarIfNeeded = function () {
        if (window['BOOTSTRAP_DATA'] && window['BOOTSTRAP_DATA']['builderSidebarExperiment']) {
            if (!window['BuilderSidebar']) {
                throw new Error('Dependency not found: BuilderSidebar');
            }
            this.sidebarSwitcher = new window['BuilderSidebar'];
        }
        else {
            this.sidebarSwitcher = {
                render: function (callback) { false; }
            };
        }
    };
    ViewManager.prototype.handleChange = function () {
        var _a;
        var state = this.store.getState();
        var windowWidth = window.innerWidth;
        var isCurrentRouteActive = this.currentRoute === state.navigation.activeState;
        var isInspectorVisible = (_a = this.editorPanelGroup) === null || _a === void 0 ? void 0 : _a.isVisible();
        var isNavigationActionType = state.action.type === EEditorReducerActions.NAVIGATE;
        var isMobileWidth = windowWidth <= 900;
        if (isCurrentRouteActive && isInspectorVisible && isMobileWidth && isNavigationActionType) {
            this.editorPanelGroup.setVisible(false);
            window.localStorage.setItem('noSidebarActiveState', '1');
            return;
        }
        if (!isCurrentRouteActive) {
            this.currentRoute = state.navigation.activeState;
        }
        if (!this.isSidebarSwitcherMounted) {
            this.isSidebarSwitcherMounted = true;
            this.sidebarSwitcher.render(this.canNavigate.bind(this));
        }
        else if (isNavigationActionType) {
            this.updateView();
        }
    };
    ViewManager.prototype.updateView = function () {
        switch (this.currentRoute) {
            case EBuilderRoutes.NOTIFICATIONS:
                this.showLoader();
                this.redirectToNotificationsV2();
                break;
            case EBuilderRoutes.OLD_NOTIFICATIONS:
                this.redirectToNotificationsV1();
                break;
            case EBuilderRoutes.TRANSLATIONS:
                this.redirectToTranslations();
                break;
            case EBuilderRoutes.THEMES:
                this.redirectToThemes();
                break;
            case EBuilderRoutes.EDITOR:
                this.redirectToEditor();
                break;
            case EBuilderRoutes.PUBLISH:
            case EBuilderRoutes.PUBLISH_GET_LINK:
            case EBuilderRoutes.PUBLISH_WEEBLY_LINK:
            case EBuilderRoutes.PUBLISH_WEEBLY_LIGHTBOX:
            case EBuilderRoutes.PUBLISH_WEEBLY_PLATFORMS:
            case EBuilderRoutes.PUBLISH_WEEBLY:
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE_LINK:
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE_LIGHTBOX:
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE_PLATFORMS:
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE:
            case EBuilderRoutes.PUBLISH_SHOPIFY_LINK:
            case EBuilderRoutes.PUBLISH_SHOPIFY_LIGHTBOX:
            case EBuilderRoutes.PUBLISH_SHOPIFY_PLATFORMS:
            case EBuilderRoutes.PUBLISH_SHOPIFY:
            case EBuilderRoutes.PUBLISH_EMBED_CODE:
            case EBuilderRoutes.PUBLISH_BLOGGER:
            case EBuilderRoutes.PUBLISH_FACEBOOK:
            case EBuilderRoutes.PUBLISH_GOOGLE_SITES:
            case EBuilderRoutes.PUBLISH_JOOMLA:
            case EBuilderRoutes.PUBLISH_TWITTER:
            case EBuilderRoutes.PUBLISH_UNBOUNCE:
            case EBuilderRoutes.PUBLISH_WORDPRESS:
            case EBuilderRoutes.PUBLISH_PLATFORMS:
            case EBuilderRoutes.PUBLISH_PLATFORM_SHOPIFY:
            case EBuilderRoutes.PUBLISH_PLATFORM_WEEBLY:
            case EBuilderRoutes.PUBLISH_PLATFORM_BIG_COMMERCE:
            case EBuilderRoutes.PUBLISH_SALESFORCE:
            case EBuilderRoutes.PUBLISH_SALESFORCE_COMMUNITY:
            case EBuilderRoutes.PUBLISH_SALESFORCE_PLATFORMS:
                this.redirectToPublishV2(this.currentRoute);
                break;
            case EBuilderRoutes.PUBLISH_V1:
                this.redirectToPublishV1();
                break;
            case EBuilderRoutes.PAYMENTS:
                this.redirectToPayments();
                break;
            case EBuilderRoutes.PAYMENTS_V1:
                this.redirectToPaymentsV1();
                break;
            default:
                console.error("Route not implemented yet for: " + this.currentRoute);
                break;
        }
    };
    ViewManager.prototype.showLoader = function () {
        console.warn('Showing loader');
    };
    ViewManager.prototype.redirectToNotificationsV2 = function () {
        if (!this.isNotificationsV2Initialised) {
            this.editorPanelConfig.configureNewNotificationsPanel(this.editorPanelGroup, this.loader);
        }
        this.isNotificationsV2Initialised = true;
        this.editorPanelGroup.setVisible(true);
        this.editorPanelGroup.setActivePanel(EPanelTypes.NOTIFICATIONS);
        this.disableUndoService();
        this.URLHandler.setNewUrl(EPanelTypes.NOTIFICATIONS);
    };
    ViewManager.prototype.redirectToNotificationsV1 = function () {
        var model = this.loader.getHeader().getModel();
        var formId = model.settings.formId;
        var pageName = model.settings.pageName;
        var isSample = model.settings.isSampleForm;
        var clickFromSuffix = isSample || pageName ? "&click_from=" + pageName + (isSample ? '_sample' : '') : '';
        window.location.href = "/index.php?p=settings&id=" + formId + "&tab=1" + clickFromSuffix;
    };
    ViewManager.prototype.redirectToTranslations = function () {
        if (!this.isTranslationsInitialised) {
            this.editorPanelConfig.configureTranslations(this.editorPanelGroup, this.loader);
        }
        this.isTranslationsInitialised = true;
        this.editorPanelGroup.setVisible(true);
        this.editorPanelGroup.setActivePanel(EBuilderRoutes.TRANSLATIONS);
        this.disableUndoService();
        this.URLHandler.setNewUrl(EBuilderRoutes.TRANSLATIONS);
    };
    ViewManager.prototype.redirectToThemes = function () {
        if (!this.isThemesInitialised) {
            this.editorPanelConfig.configureThemes(this.editorPanelGroup, this.loader, this.loader.getJQuery());
            this.loader.commands.loadThemePropertiesIntoPanel();
            this.loader.commands.loadAvailableThemes();
        }
        this.isThemesInitialised = true;
        this.editorPanelGroup.setVisible(true);
        this.editorPanelGroup.setActivePanel(EBuilderRoutes.THEMES);
        this.resetUndoService();
        this.URLHandler.setNewUrl(EBuilderRoutes.THEMES);
    };
    ViewManager.prototype.redirectToEditor = function () {
        this.URLHandler.setNewUrl(EBuilderRoutes.EDITOR);
        this.loader.openEditorPanel(EBuilderRoutes.EDITOR);
    };
    ViewManager.prototype.redirectToPublishV2 = function (route) {
        var windowWidth = window.innerWidth;
        if (!this.isPublishInitialised) {
            this.editorPanelConfig.configureEmbedFormPanel(this.editorPanelGroup, this.loader);
            this.isPublishInitialised = true;
        }
        if (!route) {
            route = EBuilderRoutes.PUBLISH_GET_LINK;
        }
        if (windowWidth <= 900) {
            route = EBuilderRoutes.PUBLISH;
        }
        this.editorPanelGroup.setVisible(true);
        this.URLHandler.setNewUrl(route);
        this.loader.execCommand('set-active-panel', 'publish-form');
        this.editorPanelGroup.setActivePanel(route);
        if (window.innerWidth <= 900) {
            return;
        }
        var publishMainPanel = this.editorPanelGroup.getPanelById('publish-form');
        var panelName = ViewManager.getPublishPanelName(route);
        publishMainPanel.openElementById(panelName);
    };
    ViewManager.getPublishPanelName = function (route) {
        switch (route) {
            case EBuilderRoutes.PUBLISH_WEEBLY:
                return EPublishPanelName.PUBLISH_WEEBLY;
            case EBuilderRoutes.PUBLISH_WEEBLY_LINK:
                return EPublishPanelName.PUBLISH_WEEBLY_LINK;
            case EBuilderRoutes.PUBLISH_WEEBLY_LIGHTBOX:
                return EPublishPanelName.PUBLISH_WEEBLY_LIGHTBOX;
            case EBuilderRoutes.PUBLISH_WEEBLY_PLATFORMS:
                return EPublishPanelName.PUBLISH_PLATFORM_SHOPIFY;
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE:
                return EPublishPanelName.PUBLISH_BIG_COMMERCE;
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE_LINK:
                return EPublishPanelName.PUBLISH_BIG_COMMERCE_LINK;
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE_LIGHTBOX:
                return EPublishPanelName.PUBLISH_BIG_COMMERCE_LIGHTBOX;
            case EBuilderRoutes.PUBLISH_BIG_COMMERCE_PLATFORMS:
                return EPublishPanelName.PUBLISH_PLATFORM_SHOPIFY;
            case EBuilderRoutes.PUBLISH_SHOPIFY:
                return EPublishPanelName.PUBLISH_SHOPIFY;
            case EBuilderRoutes.PUBLISH_SHOPIFY_LINK:
                return EPublishPanelName.PUBLISH_SHOPIFY_LINK;
            case EBuilderRoutes.PUBLISH_SHOPIFY_LIGHTBOX:
                return EPublishPanelName.PUBLISH_SHOPIFY_LIGHTBOX;
            case EBuilderRoutes.PUBLISH_SHOPIFY_PLATFORMS:
                return EPublishPanelName.PUBLISH_PLATFORM_BIG_COMMERCE;
            case EBuilderRoutes.PUBLISH_EMBED_CODE:
                return EPublishPanelName.PUBLISH_EMBED_CODE;
            case EBuilderRoutes.PUBLISH_BLOGGER:
                return EPublishPanelName.PUBLISH_BLOGGER;
            case EBuilderRoutes.PUBLISH_FACEBOOK:
                return EPublishPanelName.PUBLISH_FACEBOOK;
            case EBuilderRoutes.PUBLISH_GOOGLE_SITES:
                return EPublishPanelName.PUBLISH_GOOGLE_SITES;
            case EBuilderRoutes.PUBLISH_JOOMLA:
                return EPublishPanelName.PUBLISH_JOOMLA;
            case EBuilderRoutes.PUBLISH_TWITTER:
                return EPublishPanelName.PUBLISH_TWITTER;
            case EBuilderRoutes.PUBLISH_UNBOUNCE:
                return EPublishPanelName.PUBLISH_UNBOUNCE;
            case EBuilderRoutes.PUBLISH_WORDPRESS:
                return EPublishPanelName.PUBLISH_WORDPRESS;
            case EBuilderRoutes.PUBLISH_PLATFORM_BIG_COMMERCE:
                return EPublishPanelName.PUBLISH_PLATFORM_BIG_COMMERCE;
            case EBuilderRoutes.PUBLISH_PLATFORM_SHOPIFY:
                return EPublishPanelName.PUBLISH_PLATFORM_SHOPIFY;
            case EBuilderRoutes.PUBLISH_PLATFORM_WEEBLY:
                return EPublishPanelName.PUBLISH_PLATFORM_WEEBLY;
            case EBuilderRoutes.PUBLISH_SALESFORCE:
                return EPublishPanelName.PUBLISH_SALESFORCE;
            case EBuilderRoutes.PUBLISH_SALESFORCE_COMMUNITY:
                return EPublishPanelName.PUBLISH_SALESFORCE_COMMUNITY;
            case EBuilderRoutes.PUBLISH_SALESFORCE_PLATFORMS:
                return EPublishPanelName.PUBLISH_PLATFORM_SHOPIFY;
            case EBuilderRoutes.PUBLISH_PLATFORMS:
                return EPublishPanelName.PUBLISH_PLATFORMS;
            default:
                return EPublishPanelName.PUBLISH_LINK;
        }
    };
    ViewManager.prototype.redirectToPayments = function () {
        var _this = this;
        if (this.currentRoute != EBuilderRoutes.EDITOR) {
            this.loader.openEditorPanel(EBuilderRoutes.EDITOR);
        }
        setTimeout(function () {
            var _a;
            if (!((_a = _this.editorPanelGroup) === null || _a === void 0 ? void 0 : _a.isVisible())) {
                return;
            }
            _this.loader.commands.scrollToPaymentsInInspector();
            _this.URLHandler.setNewUrl(EBuilderRoutes.PAYMENTS);
        }, 1000);
    };
    ViewManager.prototype.redirectToPaymentsV1 = function () {
        var formId = this.getFormId();
        var url = this.URLHandler.computeStaticUrl(EBuilderRoutes.PAYMENTS_V1, formId, 'edit_fields');
        this.URLHandler.setRawUrl(url);
    };
    ViewManager.prototype.redirectToPublishV1 = function () {
        var formId = this.getFormId();
        var url = this.URLHandler.computeStaticUrl(EBuilderRoutes.PUBLISH_V1, formId, 'edit_fields');
        this.URLHandler.setRawUrl(url);
    };
    ViewManager.prototype.canNavigate = function () {
        if (this.currentRoute === EBuilderRoutes.NOTIFICATIONS) {
            var unsavedChangesInNotificationsPanel = this.editorPanelGroup.getActivePanel().getUserConfirmationForDiscardingUnsavedChanges();
            if (unsavedChangesInNotificationsPanel) {
                return Promise.resolve();
            }
            else {
                return Promise.reject();
            }
        }
        return Promise.resolve();
    };
    ViewManager.prototype.disableUndoService = function () {
        this.updateUndoService(false, false);
    };
    ViewManager.prototype.resetUndoService = function () {
        var canRedo = this.loader.getUndoService().canRedo();
        var canUndo = this.loader.getUndoService().canUndo();
        this.updateUndoService(canUndo, canRedo);
    };
    ViewManager.prototype.updateUndoService = function (isUndoEnabled, isRedoEnabled) {
        if (isUndoEnabled === void 0) { isUndoEnabled = false; }
        if (isRedoEnabled === void 0) { isRedoEnabled = false; }
        this.loader.getHeader().setButtonInteractionState(EInteractionableControlKeys.REDO, isRedoEnabled);
        this.loader.getHeader().setButtonInteractionState(EInteractionableControlKeys.UNDO, isUndoEnabled);
    };
    ViewManager.prototype.getFormId = function () {
        var state = this.store.getState();
        return state.form.id;
    };
    ViewManager.prototype.getPublishPanelByTabId = function (tabId) {
        switch (tabId) {
            case EPublishTabs.LINK:
                return EBuilderRoutes.PUBLISH_GET_LINK;
            case EPublishTabs.EMBED_JAVASCRIPT:
                return EBuilderRoutes.PUBLISH_EMBED_CODE;
            case EPublishTabs.PLATFORM_BIG_COMMERCE:
                if (this.loader.getPlatformDetails().isBigCommerce) {
                    return EBuilderRoutes.PUBLISH_BIG_COMMERCE;
                }
                return EBuilderRoutes.PUBLISH_PLATFORM_BIG_COMMERCE;
            case EPublishTabs.PLATFORM_BLOGGER:
                return EBuilderRoutes.PUBLISH_BLOGGER;
            case EPublishTabs.PLATFORM_FACEBOOK:
                return EBuilderRoutes.PUBLISH_FACEBOOK;
            case EPublishTabs.PLATFORM_GOOGLE_SITES:
                return EBuilderRoutes.PUBLISH_GOOGLE_SITES;
            case EPublishTabs.PLATFORM_JOOMLA:
                return EBuilderRoutes.PUBLISH_JOOMLA;
            case EPublishTabs.PLATFORM_SHOPIFY:
                if (this.loader.getPlatformDetails().isShopify) {
                    return EBuilderRoutes.PUBLISH_SHOPIFY;
                }
                return EBuilderRoutes.PUBLISH_PLATFORM_SHOPIFY;
            case EPublishTabs.PLATFORM_TWITTER:
                return EBuilderRoutes.PUBLISH_TWITTER;
            case EPublishTabs.PLATFORM_UNBOUNCE:
                return EBuilderRoutes.PUBLISH_UNBOUNCE;
            case EPublishTabs.PLATFORM_WORDPRESS:
                return EBuilderRoutes.PUBLISH_WORDPRESS;
            case EPublishTabs.PLATFORM_WEEBLY:
                if (this.loader.getPlatformDetails().isWeebly) {
                    return EBuilderRoutes.PUBLISH_WEEBLY;
                }
                return EBuilderRoutes.PUBLISH_PLATFORM_WEEBLY;
            case EPublishTabs.PUBLISH_PLATFORMS:
                return EBuilderRoutes.PUBLISH_PLATFORMS;
            case EPublishTabs.PLATFORM_SALESFORCE:
                return EBuilderRoutes.PUBLISH_SALESFORCE;
            case EPublishTabs.PLATFORM_SALESFORCE_COMMUNITY:
                return EBuilderRoutes.PUBLISH_SALESFORCE_COMMUNITY;
            default:
                return EBuilderRoutes.PUBLISH_GET_LINK;
        }
    };
    return ViewManager;
}());
var EditorUI;
(function (EditorUI) {
    var Actions;
    (function (Actions) {
        var EEditorReducerActions;
        (function (EEditorReducerActions) {
            EEditorReducerActions["NAVIGATE"] = "navigate";
            EEditorReducerActions["SET_FORM_ID"] = "setFormId";
            EEditorReducerActions["SET_PUBLISH_TAB"] = "setPublishTab";
            EEditorReducerActions["SET_INITIAL_FORM_CONTROLS"] = "setInitialFormControls";
            EEditorReducerActions["UPDATE_CONTROL_PROPERTY"] = "updateControlProperty";
            EEditorReducerActions["SET_FORM_HIPAA"] = "setFormHipaa";
            EEditorReducerActions["APPEND_CONTROL"] = "appendControl";
            EEditorReducerActions["APPEND_UNIQUE_CONTROL"] = "appendUniqueControl";
            EEditorReducerActions["UPDATE_CONTROLS_IDS"] = "updateControlIds";
            EEditorReducerActions["REMOVE_CONTROLS"] = "removeControls";
            EEditorReducerActions["UPDATE_PAYMENT_ACTIVE_STATE"] = "updatePaymentActiveState";
            EEditorReducerActions["UPDATE_APPROVAL_OF_SUBMISSION"] = "updateApprovalOfSubmission";
        })(EEditorReducerActions = Actions.EEditorReducerActions || (Actions.EEditorReducerActions = {}));
        ;
        Actions.navigate = function (destination) {
            return {
                type: EEditorReducerActions.NAVIGATE,
                payload: destination
            };
        };
        Actions.setFormId = function (formId) {
            return {
                type: EEditorReducerActions.SET_FORM_ID,
                payload: formId
            };
        };
        Actions.setPublishTab = function (tabId) {
            return {
                type: EEditorReducerActions.SET_PUBLISH_TAB,
                payload: tabId
            };
        };
        Actions.setInitialFormControls = function (payload) {
            return {
                type: EEditorReducerActions.SET_INITIAL_FORM_CONTROLS,
                payload: payload
            };
        };
        Actions.updateControlProperty = function (controlId, propertyName, propertyValue) {
            return {
                type: EEditorReducerActions.UPDATE_CONTROL_PROPERTY,
                payload: {
                    controlId: controlId,
                    propertyName: propertyName,
                    propertyValue: propertyValue
                }
            };
        };
        Actions.setFormAsHipaa = function (isHipaa) {
            return {
                type: EEditorReducerActions.SET_FORM_HIPAA,
                payload: isHipaa
            };
        };
        Actions.appendControl = function (control) {
            return {
                type: EEditorReducerActions.APPEND_CONTROL,
                payload: control
            };
        };
        Actions.appendUniqueControl = function (control) {
            return {
                type: EEditorReducerActions.APPEND_UNIQUE_CONTROL,
                payload: control
            };
        };
        Actions.updateControlsIds = function (payload) {
            return {
                type: EEditorReducerActions.UPDATE_CONTROLS_IDS,
                payload: payload
            };
        };
        Actions.removeControls = function (payload) {
            return {
                type: EEditorReducerActions.REMOVE_CONTROLS,
                payload: payload
            };
        };
        Actions.updatePaymentActiveState = function (payload) {
            return {
                type: EEditorReducerActions.UPDATE_PAYMENT_ACTIVE_STATE,
                payload: payload
            };
        };
        Actions.updateApprovalOfSubmission = function (payload) {
            return {
                type: EEditorReducerActions.UPDATE_APPROVAL_OF_SUBMISSION,
                payload: payload
            };
        };
    })(Actions = EditorUI.Actions || (EditorUI.Actions = {}));
})(EditorUI || (EditorUI = {}));
var I18n = (function (_super) {
    __extends(I18n, _super);
    function I18n(jq, api, lang, resourceManager) {
        var _this = _super.call(this) || this;
        _this.version = null;
        _this.htmlDOMNode = document.createElement('span');
        _this.intlWarnings = {};
        _this.jq = jq;
        _this.lang = lang;
        _this.api = api;
        _this.resourceManager = resourceManager;
        return _this;
    }
    I18n.prototype.clear = function () {
        this.translations = undefined;
        return this;
    };
    I18n.prototype.get = function (languagePackURL) {
        if (languagePackURL === void 0) { languagePackURL = null; }
        if (undefined !== this.translations) {
            return (function (self, $) {
                return $.Deferred(function (defer) {
                    defer.resolve(self);
                }).promise();
            })(this, this.jq);
        }
        else {
            return (function (self, $, api, lang) {
                return $.Deferred(function (defer) {
                    self.resourceManager.get(null === languagePackURL
                        ? api.getApiRootAddress() + '/v2/language/' + lang
                        : languagePackURL)
                        .then(function (response) {
                        if ('string' === typeof response) {
                            response = JSON.parse(response);
                        }
                        self.lang = response.lang;
                        self.translations = response.data;
                        self.version = response.version;
                        self.trigger('load');
                        defer.resolve(self);
                    })
                        .fail(function (e) {
                        defer.reject("Failed to load intl: " + e);
                    });
                }).promise();
            })(this, this.jq, this.api, this.lang);
        }
    };
    I18n.prototype.getVersion = function () {
        return this.version;
    };
    I18n.prototype.getLanguageCode = function () {
        return this.lang;
    };
    I18n.prototype.translateText = function (str) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        if (str) {
            if (undefined === this.translations) {
                return null;
            }
            var result = typeof this.translations[str = String(str) || ''] !== 'undefined' && this.translations[str] !== null
                ? this.translations[str]
                : (function (self) {
                    if (typeof self.intlWarnings[str] == 'undefined') {
                        console.warn('I18n: key ' + JSON.stringify(str) + ' is not defined!');
                        self.intlWarnings[str] = true;
                    }
                    return str;
                })(this);
            result = result.replace(/\$([\s]+)?\{([\d]+)\}/g, function () {
                var matches = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    matches[_i] = arguments[_i];
                }
                var matchNo = ~~matches[2];
                return String(args[matchNo] || '${' + matchNo + '}');
            });
            var currentArgumentIndex_1 = 0;
            result = result.replace(/%(s|d)/g, function () {
                var matches = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    matches[_i] = arguments[_i];
                }
                var replacement = String(args[currentArgumentIndex_1] || matches[0]);
                currentArgumentIndex_1++;
                return replacement;
            });
            return result;
        }
        else {
            return str;
        }
    };
    I18n.prototype.translateHTMLText = function (htmlString) {
        if (undefined === this.translations) {
            return null;
        }
        var result = String(htmlString || '');
        return (function (self) {
            return result.replace(/\[\[([a-zA-Z0-9_\$\-]+)(\!)?\]\]/g, function () {
                var matches = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    matches[_i] = arguments[_i];
                }
                var translation = matches[2]
                    ? self.translateText(matches[1])
                    : self.escapeHTML(self.translateText(matches[1]));
                return MiniMarkdown.parse(translation);
            }).replace(/<!--[^\-]+-->/g, '');
        })(this);
    };
    I18n.prototype.escapeHTML = function (str) {
        this.htmlDOMNode.textContent = String(str || '');
        var result = this.htmlDOMNode.innerHTML;
        this.htmlDOMNode.textContent = '';
        return result;
    };
    I18n.prototype.translateDOMNode = function (domNode) {
        (function ($, self) {
            $(domNode).find('[data-i18n-text]').each(function () {
                var attribute = this.getAttribute('data-i18n-text'), translationText = self.translateText(attribute);
                if (translationText && translationText !== attribute) {
                    var params_1 = {};
                    if (this.hasAttribute('data-i18n-param')) {
                        params_1 = UrlUtils.parseQueryString(this.getAttribute('data-i18n-param'));
                    }
                    translationText = translationText.replace(/\{\{([a-zA-Z0-9_$]+)\}\}/g, function (substring) {
                        var args = [];
                        for (var _i = 1; _i < arguments.length; _i++) {
                            args[_i - 1] = arguments[_i];
                        }
                        return params_1[args[0]] || substring;
                    });
                    if (!this.hasAttribute('data-skip-markdown')) {
                        this.innerHTML = SanitizeHTML.sanitizeHTML(MiniMarkdown.parse(translationText));
                    }
                    else {
                        this.textContent = translationText;
                    }
                }
            });
            $(domNode).find('[data-i18n-placeholder]').each(function () {
                var attribute = this.getAttribute('data-i18n-placeholder'), translationText = self.translateText(attribute);
                if (translationText && translationText !== attribute) {
                    if (this.hasAttribute('data-i18n-markdown-text')) {
                        this.placeholder = MiniMarkdown.toPlainText(translationText);
                    }
                    else {
                        this.placeholder = translationText;
                    }
                }
            });
            $(domNode).find('[data-i18n-title]').each(function () {
                var attribute = this.getAttribute('data-i18n-title'), translationText = self.translateText(attribute);
                if (translationText && translationText !== attribute) {
                    this.title = translationText;
                }
            });
            $(domNode).find('[data-i18n-html]').each(function () {
                var attribute = this.getAttribute('data-i18n-html'), translationHTML = self.translateText(attribute);
                if (translationHTML && translationHTML !== attribute) {
                    translationHTML = I18nUtils.addNoFollowOnLinks(translationHTML);
                    this.innerHTML = SanitizeHTML.sanitizeHTMLUsingUserRights(translationHTML);
                }
            });
            $(domNode).find('[data-i18n-attribute-name][data-i18n-attribute-value]').each(function () {
                var attributeName = this.getAttribute('data-i18n-attribute-name'), attributeValue = this.getAttribute('data-i18n-attribute-value');
                if (attributeName && attributeValue) {
                    var translationText = self.translateText(attributeValue);
                    if (translationText && translationText !== attributeValue) {
                        this.setAttribute(attributeName, translationText);
                    }
                }
            });
        })(this.jq, this);
    };
    I18n.prototype.translateTextDefault = function (i18nKey, defaultText) {
        var i18nVars = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            i18nVars[_i - 2] = arguments[_i];
        }
        var textToTranslate = this.translateText.apply(this, __spreadArrays([i18nKey], i18nVars));
        return i18nKey && textToTranslate && textToTranslate !== i18nKey
            ? textToTranslate
            : defaultText;
    };
    return I18n;
}(EventEmitter));
var ControlPropertyTranslator = (function () {
    function ControlPropertyTranslator() {
    }
    ControlPropertyTranslator.translatePropertyName = function (propertyName) {
        switch (propertyName) {
            default:
                return null;
        }
    };
    ControlPropertyTranslator.translateAttributeName = function (attributeName) {
        switch (attributeName) {
            case 'options':
                return 'edt_UI_attribute_options';
            case 'instructions':
                return 'edt_UI_attribute_instructions';
            case 'layout':
                return 'edt_UI_attribute_layout';
            case 'label':
                return 'edt_UI_attribute_label';
            case 'choices':
                return 'edt_UI_attribute_choices';
            case 'validation':
                return 'edt_UI_attribute_validation';
            case 'scale':
                return 'edt_UI_attribute_scale';
            case 'statements':
                return 'edt_UI_attribute_statements';
            case 'synchronize':
                return 'edt_UI_attribute_synchronize';
            case 'propagate':
                return 'edt_UI_attribute_propagate';
            case 'configuration':
                return 'edt_UI_attribute_configuration';
            case 'value':
                return 'edt_UI_attribute_value';
            case 'name':
                return 'edt_UI_attribute_name';
            case 'text':
                return 'edt_UI_attribute_text';
            case 'buttons':
                return 'edt_UI_attribute_buttons';
            case 'size':
                return 'edt_UI_attribute_size';
            case 'image':
                return 'edt_UI_attribute_image';
            case 'mapsApiKey':
                return 'edt_UI_attribute_maps_api_key';
            default:
                return null;
        }
    };
    return ControlPropertyTranslator;
}());
var NotificationTooltipManager = (function (_super) {
    __extends(NotificationTooltipManager, _super);
    function NotificationTooltipManager(editorCommandDispatcher, editor) {
        var _this = _super.call(this) || this;
        _this.registeredTooltips = {};
        _this.pendingTooltips = [];
        _this.isChatWindowOpened = false;
        _this.isChatWindowMinimized = false;
        _this.pageIdentifier = UrlUtils.getCurrentPageIdentifier(['p']);
        _this.commands = editorCommandDispatcher;
        _this.editor = editor;
        setInterval(function () {
            _this.monitorForChatDialog();
        }, 1000);
        setTimeout(function () {
            _this.openedLastPersistentTooltipOnCurrentPageIfPossible();
            _this.trigger('ready');
        }, 1000);
        return _this;
    }
    NotificationTooltipManager.prototype.registerNotificationTooltip = function (notificationTooltipId, notificationTooltip) {
        this.registeredTooltips[notificationTooltipId] = notificationTooltip;
    };
    NotificationTooltipManager.prototype.showTooltip = function (notificationTooltipId, saveManagerState) {
        var _this = this;
        if (saveManagerState === void 0) { saveManagerState = true; }
        if (this.isMobileBrowser()) {
            return;
        }
        var triggeredTooltips = JSON.parse(localStorage.getItem('triggered_tooltips') || '{}');
        triggeredTooltips[this.pageIdentifier] = triggeredTooltips[this.pageIdentifier] || {};
        triggeredTooltips[this.pageIdentifier][notificationTooltipId] = 1;
        localStorage.setItem('triggered_tooltips', JSON.stringify(triggeredTooltips));
        if (!this.registeredTooltips[notificationTooltipId]) {
            return;
        }
        this.pendingTooltips.push(this.registeredTooltips[notificationTooltipId]);
        if (saveManagerState) {
            this.saveTooltipManagerState();
        }
        setTimeout(function () {
            _this.attemptToOpenTooltip();
        }, 10);
    };
    NotificationTooltipManager.prototype.isMobileBrowser = function () {
        return BrowserDetector.meetsRequirements('* * mobile * *') === '';
    };
    NotificationTooltipManager.prototype.attemptToOpenTooltip = function () {
        var _this = this;
        if (this.pendingTooltips.length === 0) {
            return;
        }
        if (this.currentOpenedTooltip) {
            return;
        }
        this.currentOpenedTooltip = this.pendingTooltips.shift();
        this.currentOpenedTooltip.open();
        var waitForTooltipToClose = function () {
            if (_this.currentOpenedTooltip.isOpenend()) {
                setTimeout(waitForTooltipToClose, 500);
            }
            else {
                _this.currentOpenedTooltip = null;
                _this.saveTooltipManagerState();
                _this.attemptToOpenTooltip();
            }
        };
        waitForTooltipToClose();
    };
    NotificationTooltipManager.prototype.monitorForChatDialog = function () {
        var snapABugDialog = document.getElementById('SnapABug_WP');
        if (!snapABugDialog) {
            return;
        }
        var isChatOpened = snapABugDialog.offsetWidth > 0 && snapABugDialog.offsetHeight > 100, isChatMinimized = snapABugDialog.offsetWidth > 0 && snapABugDialog.offsetHeight < 100;
        if (isChatOpened === this.isChatWindowOpened && isChatMinimized === this.isChatWindowMinimized) {
            return;
        }
        this.isChatWindowOpened = isChatOpened;
        this.isChatWindowMinimized = isChatMinimized;
        if (isChatOpened) {
            document.body.setAttribute('data-chat-window-is-opened', '');
        }
        else {
            document.body.removeAttribute('data-chat-window-is-opened');
        }
        if (isChatMinimized) {
            document.body.setAttribute('data-chat-window-is-minimized', '');
        }
        else {
            document.body.removeAttribute('data-chat-window-is-minimized');
        }
    };
    NotificationTooltipManager.prototype.openedLastPersistentTooltipOnCurrentPageIfPossible = function () {
        var popupNotifications = this.editor.getLoader().getLoaderDependency(ELoaderDependency.POPUP_NOTIFICATIONS);
        if (popupNotifications && popupNotifications.visible === false) {
            return;
        }
        var openedTooltips = JSON.parse(localStorage.getItem('lastOpenedNotificationTooltips') || '{}'), lastPendingTooltipsIdList = (openedTooltips[this.pageIdentifier] || []);
        if (lastPendingTooltipsIdList && lastPendingTooltipsIdList.length) {
            for (var i = 0, len = lastPendingTooltipsIdList.length; i < len; i++) {
                this.showTooltip(lastPendingTooltipsIdList[i], false);
            }
        }
    };
    NotificationTooltipManager.prototype.saveTooltipManagerState = function () {
        var openedTooltipsForAllSite = JSON.parse(localStorage.getItem('lastOpenedNotificationTooltips') || '{}'), managerStateForCurrentPage = [];
        if (this.currentOpenedTooltip && this.currentOpenedTooltip.isOpenend()) {
            managerStateForCurrentPage.push(this.currentOpenedTooltip.getTooltipId());
        }
        for (var i = 0, len = this.pendingTooltips.length; i < len; i++) {
            managerStateForCurrentPage.push(this.pendingTooltips[i].getTooltipId());
        }
        openedTooltipsForAllSite[this.pageIdentifier] = managerStateForCurrentPage;
        localStorage.setItem('lastOpenedNotificationTooltips', JSON.stringify(openedTooltipsForAllSite));
    };
    NotificationTooltipManager.prototype.wasTooltipTriggered = function (tooltipId) {
        var popupNotifications = this.editor.getLoader().getLoaderDependency(ELoaderDependency.POPUP_NOTIFICATIONS);
        if (popupNotifications && popupNotifications.visible === false) {
            return !popupNotifications.visible;
        }
        var triggeredTooltips = JSON.parse(localStorage.getItem('triggered_tooltips') || '{}');
        return triggeredTooltips[this.pageIdentifier] && triggeredTooltips[this.pageIdentifier][tooltipId];
    };
    return NotificationTooltipManager;
}(EventEmitter));
var NotificationTooltip = (function () {
    function NotificationTooltip(ui, createTooltipCallback, tooltipId, userId) {
        this.ui = ui;
        this.createTooltipCallback = createTooltipCallback;
        this.tooltipId = tooltipId;
        this.userId = userId;
    }
    NotificationTooltip.prototype.isOpenend = function () {
        return this.tooltip !== undefined;
    };
    NotificationTooltip.prototype.open = function () {
        if (this.tooltip !== undefined) {
            return;
        }
        this.tooltip = this.createTooltipCallback(this.ui, this);
        if (!this.wasUniqueTooltipOpenMetricSentForCurrentUser()) {
            this.sendUniqueTooltipOpenMetrictForCurrentUser();
        }
    };
    NotificationTooltip.prototype.close = function () {
        this.tooltip.close();
        this.tooltip = undefined;
    };
    NotificationTooltip.prototype.getTooltipId = function () {
        return this.tooltipId;
    };
    NotificationTooltip.prototype.wasUniqueTooltipOpenMetricSentForCurrentUser = function () {
        var sentMetricForUser = JSON.parse(localStorage.getItem('sentMetricForUser') || '{}');
        return sentMetricForUser[this.userId] && sentMetricForUser[this.userId][this.tooltipId];
    };
    NotificationTooltip.prototype.sendUniqueTooltipOpenMetrictForCurrentUser = function () {
        var sentMetricForUser = JSON.parse(localStorage.getItem('sentMetricForUser') || '{}');
        sentMetricForUser[this.userId] = sentMetricForUser[this.userId] || {};
        sentMetricForUser[this.userId][this.tooltipId] = 1;
        localStorage.setItem('sentMetricForUser', JSON.stringify(sentMetricForUser));
        if (window['CFTracker']) {
            window['CFTracker'].event('unique_opened_' + this.tooltipId);
        }
    };
    return NotificationTooltip;
}());
var Errors = (function () {
    function Errors() {
    }
    Errors.ERR_TOO_FEW_CHOICES_SELECTED = 100;
    Errors.ERR_TOO_MANY_CHOICES_SELECTED = 101;
    Errors.ERR_TOO_MANY_CHARACTERS = 102;
    Errors.ERR_TOO_FEW_CHARACTERS = 103;
    Errors.ERR_TOO_MANY_WORDS = 104;
    Errors.ERR_TOO_FEW_WORDS = 105;
    Errors.ERR_INVALID_EMAIL = 106;
    Errors.ERR_NUMBER_TOO_LONG = 107;
    Errors.ERR_NUMBER_TOO_SHORT = 108;
    Errors.ERR_NUMBER_TOO_BIG = 109;
    Errors.ERR_NUMBER_TOO_SMALL = 110;
    Errors.ERR_PRICE_TOO_MANY_DECIMALS = 111;
    Errors.ERR_INVALID_URL = 113;
    Errors.ERR_DATE_TOO_BIG = 114;
    Errors.ERR_DATE_TOO_SMALL = 115;
    Errors.ERR_TIME_NOT_COMPLETE = 116;
    Errors.ERR_INVALID_PHONE_FORMAT = 117;
    Errors.ERR_INTEGER_VALUE_EXPECTED = 118;
    Errors.ERR_NEGATIVE_PRICE = 119;
    Errors.ERR_NUMBER_EXPECTED = 120;
    Errors.ERR_FILE_UPLOAD = 121;
    Errors.ERR_CONTROL_VALUES_DONT_MATCH = 122;
    Errors.ERR_MAX_ACCEPTED_VALUE_EXCEEDED = 123;
    Errors.ERR_INVALID_DATE = 124;
    Errors.ERR_INVALID_NUMBER = 125;
    Errors.ERR_NOT_NUMERIC = 126;
    return Errors;
}());
var ElementTypes = (function () {
    function ElementTypes() {
    }
    ElementTypes.ELEMENT_NOT_SUPPORTED = -2;
    ElementTypes.ELEMENT_TYPE_FORM = -1;
    ElementTypes.CONTAINER_TYPE_ROW = 0;
    ElementTypes.CONTROL_TYPE_ADDRESS = 1;
    ElementTypes.CONTROL_TYPE_CHECKBOX = 2;
    ElementTypes.CONTROL_TYPE_DATE = 3;
    ElementTypes.CONTROL_TYPE_DROPDOWN = 4;
    ElementTypes.CONTROL_TYPE_EMAIL = 5;
    ElementTypes.CONTROL_TYPE_FILE = 6;
    ElementTypes.CONTROL_TYPE_HEADING = 7;
    ElementTypes.CONTROL_TYPE_HTML_BLOCK = 8;
    ElementTypes.CONTROL_TYPE_IMAGE = 9;
    ElementTypes.CONTROL_TYPE_LIKERT_SCALE = 10;
    ElementTypes.CONTROL_TYPE_MAP = 11;
    ElementTypes.CONTROL_TYPE_NAME = 12;
    ElementTypes.CONTROL_TYPE_NUMBER = 13;
    ElementTypes.CONTROL_TYPE_PAGE_BREAK = 14;
    ElementTypes.CONTROL_TYPE_PASSWORD = 15;
    ElementTypes.CONTROL_TYPE_PHONE = 16;
    ElementTypes.CONTROL_TYPE_PRICE = 17;
    ElementTypes.CONTROL_TYPE_RADIO = 18;
    ElementTypes.CONTROL_TYPE_SIGNATURE = 19;
    ElementTypes.CONTROL_TYPE_SOCIAL = 20;
    ElementTypes.CONTROL_TYPE_STAR_RATING = 21;
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE = 22;
    ElementTypes.CONTROL_TYPE_TEXT = 23;
    ElementTypes.CONTROL_TYPE_TEXTAREA = 24;
    ElementTypes.CONTROL_TYPE_TIME = 25;
    ElementTypes.CONTROL_TYPE_WEBSITE = 26;
    ElementTypes.CONTROL_TYPE_FORM_HEADER = 27;
    ElementTypes.CONTROL_TYPE_CAPTCHA = 28;
    ElementTypes.CONTROL_TYPE_ACTION_BAR = 29;
    ElementTypes.CONTROL_TYPE_WIDGET_VIDEO = 30;
    ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK = 31;
    ElementTypes.CONTROL_TYPE_WIDGET_PDF = 32;
    ElementTypes.CONTROL_TYPE_FORMULA = 33;
    ElementTypes.CONTROL_TYPE_FEE = 34;
    ElementTypes.CONTROL_TYPE_COUPON = 100;
    ElementTypes.CONTROL_TYPE_SEPARATOR = 9999;
    ElementTypes.VIRTUAL_SELECTION_CONTROL = 10000;
    ElementTypes.CONTAINER_TYPE_DIV = 90000;
    ElementTypes.CONTAINER_TYPE_PAGE = 90001;
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER = 90002;
    ElementTypes.CONTAINER_TYPE_REPEATABLE = 90003;
    ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP = 90004;
    ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE = 91001;
    ElementTypes.LAYOUT_TYPE_FIELDSET = null;
    return ElementTypes;
}());
var ElementsFactory = (function () {
    function ElementsFactory() {
    }
    ElementsFactory.createFactory = function (factoryName, editorCapabilities) {
        switch (factoryName) {
            case 'Default':
                return new FullFeaturedFactory(editorCapabilities);
            case 'Basic':
                return new BasicPlanFactory(editorCapabilities);
            case 'Gold':
                return new GoldPlanFactory(editorCapabilities);
            case 'WixStarter':
                return new WixStarterPlanFactory(editorCapabilities);
            case 'WeeblySilver':
                return new WeeblySilverPlanFactory(editorCapabilities);
            default:
                throw new Error('Invalid elements factory name');
        }
    };
    return ElementsFactory;
}());
var FullFeaturedFactory = (function () {
    function FullFeaturedFactory(capabilities) {
        this.capabilities = capabilities;
    }
    FullFeaturedFactory.prototype.getName = function () {
        return 'full';
    };
    FullFeaturedFactory.prototype.getAllElements = function () {
        return [
            TextControl.nodeName,
            TextAreaControl.nodeName,
            DropDownControl.nodeName,
            RadioControl.nodeName,
            CheckBoxControl.nodeName,
            LikertScaleControl.nodeName,
            LikertContainer.nodeName,
            StarRatingControl.nodeName,
            FileControl.nodeName,
            NumberControl.nodeName,
            EmailControl.nodeName,
            NameControl.nodeName,
            AddressControl.nodeName,
            PhoneControl.nodeName,
            DateControl.nodeName,
            TimeControl.nodeName,
            PriceControl.nodeName,
            WebsiteControl.nodeName,
            PasswordControl.nodeName,
            SignatureControl.nodeName,
            TermsOfServiceControl.nodeName,
            HeadingControl.nodeName,
            HTMLBlockControl.nodeName,
            ImageControl.nodeName,
            PageBreakControl.nodeName,
            MapControl.nodeName,
            WidgetVideoControl.nodeName,
            WidgetFacebookControl.nodeName,
            WidgetPDFControl.nodeName,
            SocialControl.nodeName,
            CouponControl.nodeName,
            FormulaControl.nodeName,
            PageContainer.nodeName,
            PaymentSummaryPageContainer.nodeName,
            DivContainer.nodeName,
            RepeatableContainer.nodeName,
            RepeatableGroup.nodeName,
        ];
    };
    FullFeaturedFactory.prototype.getAllEditorSettings = function () {
        return [
            EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_COUPON_CODES_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING,
        ];
    };
    FullFeaturedFactory.prototype.getSupportedElements = function () {
        return [
            TextControl.nodeName,
            TextAreaControl.nodeName,
            DropDownControl.nodeName,
            RadioControl.nodeName,
            CheckBoxControl.nodeName,
            LikertScaleControl.nodeName,
            LikertContainer.nodeName,
            StarRatingControl.nodeName,
            FileControl.nodeName,
            NumberControl.nodeName,
            EmailControl.nodeName,
            NameControl.nodeName,
            AddressControl.nodeName,
            PhoneControl.nodeName,
            DateControl.nodeName,
            TimeControl.nodeName,
            PriceControl.nodeName,
            WebsiteControl.nodeName,
            PasswordControl.nodeName,
            SignatureControl.nodeName,
            TermsOfServiceControl.nodeName,
            HeadingControl.nodeName,
            HTMLBlockControl.nodeName,
            ImageControl.nodeName,
            PageBreakControl.nodeName,
            MapControl.nodeName,
            SocialControl.nodeName,
            WidgetFacebookControl.nodeName,
            WidgetPDFControl.nodeName,
            WidgetVideoControl.nodeName,
            CouponControl.nodeName,
            FormulaControl.nodeName,
            PageContainer.nodeName,
            PaymentSummaryPageContainer.nodeName,
            DivContainer.nodeName,
            RepeatableContainer.nodeName,
            RepeatableGroup.nodeName,
            FeeControl.nodeName
        ];
    };
    FullFeaturedFactory.prototype.getSupportedEditorSettings = function () {
        return [
            EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_COUPON_CODES_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING,
        ];
    };
    FullFeaturedFactory.prototype.getBlockedEditorSettings = function () {
        var _this = this;
        return this.getSupportedEditorSettings().filter(function (editorSetting) { return _this.capabilities.factory.supportedSettingsTypeIds.indexOf(editorSetting) === -1; });
    };
    FullFeaturedFactory.prototype.getUnsupportedElements = function () {
        var all = this.getAllElements(), supported = this.getSupportedElements(), result = [];
        for (var i = 0, len = all.length; i < len; i++) {
            if (supported.indexOf(all[i]) === -1) {
                result.push(all[i]);
            }
        }
        return result;
    };
    FullFeaturedFactory.prototype.getUnsupportedEditorSettings = function () {
        var all = this.getAllEditorSettings(), supported = this.getSupportedEditorSettings(), result = [];
        for (var i = 0, len = all.length; i < len; i++) {
            if (supported.indexOf(all[i]) === -1) {
                result.push(all[i]);
            }
        }
        return result;
    };
    FullFeaturedFactory.prototype.createItemByTypeId = function (itemTypeId, document, elementProperties) {
        switch (itemTypeId) {
            case ElementTypes.ELEMENT_TYPE_FORM:
                throw new Error('Operation is not supported by this factory. Use the FormUnserializer instead to create a new form!');
            case ElementTypes.CONTAINER_TYPE_ROW:
                return new RowContainer(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ADDRESS:
                return new AddressControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
                return new CheckBoxControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DATE:
                return new DateControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                return new DropDownControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_EMAIL:
                return new EmailControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FILE:
                return new FileControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HEADING:
                return new HeadingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HTML_BLOCK:
                return new HTMLBlockControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_IMAGE:
                return new ImageControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_LIKERT_SCALE:
                return new LikertScaleControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_MAP:
                return new MapControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NAME:
                return new NameControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NUMBER:
                return new NumberControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PAGE_BREAK:
                return new PageBreakControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PASSWORD:
                return new PasswordControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PHONE:
                return new PhoneControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PRICE:
                return new PriceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_RADIO:
                return new RadioControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SIGNATURE:
                return new SignatureControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SOCIAL:
                return new SocialControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_STAR_RATING:
                return new StarRatingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE:
                return new TermsOfServiceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXT:
                return new TextControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXTAREA:
                return new TextAreaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TIME:
                return new TimeControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WEBSITE:
                return new WebsiteControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FORM_HEADER:
                return new FormHeaderControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CAPTCHA:
                return new CaptchaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ACTION_BAR:
                return new ActionBarControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK:
                return new WidgetFacebookControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_PDF:
                return new WidgetPDFControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_VIDEO:
                return new WidgetVideoControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SEPARATOR:
                return new SeparatorControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_COUPON:
                return new CouponControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FORMULA:
                return new FormulaControl(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_DIV:
                return new DivContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_PAGE:
                return new PageContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE:
                return new PaymentSummaryPageContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER:
                return new LikertContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE:
                return new RepeatableContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP:
                return new RepeatableGroup(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FEE:
                return new FeeControl(document, elementProperties);
            default:
                throw new Error('FormItemFactory.createItemByTypeId(): Don\'t know how to create a item with type id ' + JSON.stringify(itemTypeId));
        }
    };
    FullFeaturedFactory.prototype.createEditorSettingByTypeId = function (editorSettingTypeId, document, settingProperties) {
        switch (editorSettingTypeId) {
            case EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING:
                return new ProductsEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_COUPON_CODES_EDITOR_SETTING:
                return new CouponCodesEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING:
                return new SummaryEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING:
                return new PaypalEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING:
                return new PaypalCheckoutEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING:
                return new PaypalPayflowEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING:
                return new PaypalProEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING:
                return new BraintreeEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING:
                return new StripeEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING:
                return new StripeCheckoutEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING:
                return new PayUEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING:
                return new SquareEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING:
                return new SisowEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING:
                return new PayfastEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING:
                return new WorldpayEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING:
                return new AuthorizeEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING:
                return new SagepayEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING:
                return new FreshbooksEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            case EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING:
                return new CivicaEditorSetting(settingProperties, document, document.getEngine().getRuntime());
            default:
                throw new Error('Failed to create editor setting ' + JSON.stringify(editorSettingTypeId) + ': Unknown setting type id');
        }
    };
    FullFeaturedFactory.prototype.getItemStaticClassByTypeNameOrTypeId = function (itemTypeNameOrTypeId) {
        switch (itemTypeNameOrTypeId) {
            case Form.nodeName:
            case ElementTypes.ELEMENT_TYPE_FORM:
                return Form;
            case RowContainer.nodeName:
            case ElementTypes.CONTAINER_TYPE_ROW:
                return RowContainer;
            case AddressControl.nodeName:
            case ElementTypes.CONTROL_TYPE_ADDRESS:
                return AddressControl;
            case CheckBoxControl.nodeName:
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
                return CheckBoxControl;
            case DateControl.nodeName:
            case ElementTypes.CONTROL_TYPE_DATE:
                return DateControl;
            case DropDownControl.nodeName:
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                return DropDownControl;
            case EmailControl.nodeName:
            case ElementTypes.CONTROL_TYPE_EMAIL:
                return EmailControl;
            case FileControl.nodeName:
            case ElementTypes.CONTROL_TYPE_FILE:
                return FileControl;
            case HeadingControl.nodeName:
            case ElementTypes.CONTROL_TYPE_HEADING:
                return HeadingControl;
            case HTMLBlockControl.nodeName:
            case ElementTypes.CONTROL_TYPE_HTML_BLOCK:
                return HTMLBlockControl;
            case ImageControl.nodeName:
            case ElementTypes.CONTROL_TYPE_IMAGE:
                return ImageControl;
            case LikertScaleControl.nodeName:
            case ElementTypes.CONTROL_TYPE_LIKERT_SCALE:
                return LikertScaleControl;
            case MapControl.nodeName:
            case ElementTypes.CONTROL_TYPE_MAP:
                return MapControl;
            case NameControl.nodeName:
            case ElementTypes.CONTROL_TYPE_NAME:
                return NameControl;
            case NumberControl.nodeName:
            case ElementTypes.CONTROL_TYPE_NUMBER:
                return NumberControl;
            case PageBreakControl.nodeName:
            case ElementTypes.CONTROL_TYPE_PAGE_BREAK:
                return PageBreakControl;
            case PasswordControl.nodeName:
            case ElementTypes.CONTROL_TYPE_PASSWORD:
                return PasswordControl;
            case PhoneControl.nodeName:
            case ElementTypes.CONTROL_TYPE_PHONE:
                return PhoneControl;
            case PriceControl.nodeName:
            case ElementTypes.CONTROL_TYPE_PRICE:
                return PriceControl;
            case RadioControl.nodeName:
            case ElementTypes.CONTROL_TYPE_RADIO:
                return RadioControl;
            case SignatureControl.nodeName:
            case ElementTypes.CONTROL_TYPE_SIGNATURE:
                return SignatureControl;
            case SocialControl.nodeName:
            case ElementTypes.CONTROL_TYPE_SOCIAL:
                return SocialControl;
            case StarRatingControl.nodeName:
            case ElementTypes.CONTROL_TYPE_STAR_RATING:
                return StarRatingControl;
            case TermsOfServiceControl.nodeName:
            case ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE:
                return TermsOfServiceControl;
            case TextControl.nodeName:
            case ElementTypes.CONTROL_TYPE_TEXT:
                return TextControl;
            case TextAreaControl.nodeName:
            case ElementTypes.CONTROL_TYPE_TEXTAREA:
                return TextAreaControl;
            case TimeControl.nodeName:
            case ElementTypes.CONTROL_TYPE_TIME:
                return TimeControl;
            case WebsiteControl.nodeName:
            case ElementTypes.CONTROL_TYPE_WEBSITE:
                return WebsiteControl;
            case FormHeaderControl.nodeName:
            case ElementTypes.CONTROL_TYPE_FORM_HEADER:
                return FormHeaderControl;
            case CaptchaControl.nodeName:
            case ElementTypes.CONTROL_TYPE_CAPTCHA:
                return CaptchaControl;
            case ActionBarControl.nodeName:
            case ElementTypes.CONTROL_TYPE_ACTION_BAR:
                return ActionBarControl;
            case DivContainer.nodeName:
            case ElementTypes.CONTAINER_TYPE_DIV:
                return DivContainer;
            case PageContainer.nodeName:
            case ElementTypes.CONTAINER_TYPE_PAGE:
                return PageContainer;
            case PaymentSummaryPageContainer.nodeName:
            case ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE:
                return PaymentSummaryPageContainer;
            case LikertContainer.nodeName:
            case ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER:
                return LikertContainer;
            case WidgetVideoControl.nodeName:
            case ElementTypes.CONTROL_TYPE_WIDGET_VIDEO:
                return WidgetVideoControl;
            case WidgetPDFControl.nodeName:
            case ElementTypes.CONTROL_TYPE_WIDGET_PDF:
                return WidgetPDFControl;
            case WidgetFacebookControl.nodeName:
            case ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK:
                return WidgetFacebookControl;
            case CouponControl.nodeName:
            case ElementTypes.CONTROL_TYPE_COUPON:
                return CouponControl;
            case FormulaControl.nodeName:
            case ElementTypes.CONTROL_TYPE_FORMULA:
                return FormulaControl;
            case RepeatableContainer.nodeName:
            case ElementTypes.CONTAINER_TYPE_REPEATABLE:
                return RepeatableContainer;
            case RepeatableGroup.nodeName:
            case ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP:
                return RepeatableGroup;
            case FeeControl.nodeName:
            case ElementTypes.CONTROL_TYPE_FEE:
                return FeeControl;
            default:
                return null;
        }
    };
    FullFeaturedFactory.prototype.getAvailableControlsList = function () {
        var availableControlsListNames = this.getSupportedElements();
        var result = [];
        for (var i = 0, len = availableControlsListNames.length; i < len; i++) {
            result.push(this.getItemStaticClassByTypeNameOrTypeId(availableControlsListNames[i]).getConfiguration());
        }
        return result;
    };
    FullFeaturedFactory.prototype.getAvailableSettingsList = function () {
        var availableSettings = this.getSupportedEditorSettings(), result = [];
        for (var i = 0, len = availableSettings.length; i < len; i++) {
            result.push(EditorSettingTypes.getSettingClassByTypeId(availableSettings[i]).getConfiguration());
        }
        return result;
    };
    FullFeaturedFactory.prototype.getUnavailableControlsList = function () {
        var unsupportedControlsList = this.getUnsupportedElements();
        var result = [];
        for (var i = 0, len = unsupportedControlsList.length; i < len; i++) {
            result.push(this.getItemStaticClassByTypeNameOrTypeId(unsupportedControlsList[i]).getConfiguration());
        }
        return result;
    };
    FullFeaturedFactory.prototype.getUnavailableEditorSettingsList = function () {
        var unsupportedSettingsList = this.getUnsupportedEditorSettings(), result = [];
        for (var i = 0, len = unsupportedSettingsList.length; i < len; i++) {
            result.push(EditorSettingTypes.getSettingClassByTypeId(unsupportedSettingsList[i]).getConfiguration());
        }
        return result;
    };
    FullFeaturedFactory.prototype.addEditorSettingCapabilities = function (runtime, capabilities) {
        for (var i = 0, len = capabilities.factory.supportedSettingsTypeIds.length; i < len; i++) {
            var settingTypeId = capabilities.factory.supportedSettingsTypeIds[i];
            EditorSettingTypes.getSettingClassByTypeId(settingTypeId).defaultProperties = capabilities.settings[settingTypeId].defaultProperties;
        }
    };
    FullFeaturedFactory.prototype.addControlsCapabilities = function (runtime, capabilities) {
        for (var controlTypeId in capabilities.controls) {
            if (capabilities.controls.hasOwnProperty(controlTypeId)) {
                var itemStaticClass = this.getItemStaticClassByTypeNameOrTypeId(capabilities.controls[controlTypeId].nodeName);
                for (var controlAttributeName in capabilities.controls[controlTypeId].nodeAttributes) {
                    if (capabilities.controls[controlTypeId].nodeAttributes.hasOwnProperty(controlAttributeName)) {
                        var runtimeControlAttributeType = capabilities.controls[controlTypeId].nodeAttributes[controlAttributeName], attributeDefaultValues = capabilities.controls[controlTypeId].nodeAttributesDefaultValues[controlAttributeName];
                        this.addControlAttributeToStaticControlClass(itemStaticClass, controlAttributeName, runtimeControlAttributeType, attributeDefaultValues, runtime);
                    }
                }
            }
        }
    };
    FullFeaturedFactory.prototype.runEditorCapabilitiesUnitTests = function (runtime, capabilities) {
        console.time('run_runtime_unit_tests');
        var numberOfTests = 0;
        for (var i = 0, len = capabilities.factory.supportedSettingsTypeIds.length; i < len; i++) {
            var settingTypeId = capabilities.factory.supportedSettingsTypeIds[i];
            if (!capabilities.settings[settingTypeId]) {
                throw new Error('Unit test failed: The cappabilities reported that they support creation' +
                    ' of setting type ' + JSON.stringify(settingTypeId) +
                    ' but the setting type ' + JSON.stringify(settingTypeId) +
                    ' is not defined in "capabilities.settings"');
            }
            numberOfTests++;
            if (typeof capabilities.settings[settingTypeId] !== 'object') {
                throw new Error('Object expected for setting type id ' + settingTypeId);
            }
            if (!capabilities.settings[settingTypeId].interface) {
                throw new Error('Typescript interface expected for setting type id ' + settingTypeId);
            }
            if (!('user defined' === runtime.describeType(capabilities.settings[settingTypeId].interface))) {
                throw new Error('Typescript interface ' + capabilities.settings[settingTypeId].interface + ' for setting type id ' + settingTypeId + ' is not declared');
            }
            if (!capabilities.settings[settingTypeId].defaultProperties) {
                throw new Error('Default setting properties expected for setting type id ' + settingTypeId);
            }
            var capabilityStaticClass = EditorSettingTypes.getSettingClassByTypeId(settingTypeId);
            if (null === capabilityStaticClass) {
                throw new Error('Current factory implementation does not know how to create a editor setting of type'
                    + JSON.stringify(settingTypeId));
            }
            numberOfTests++;
        }
        for (var controlTypeId in capabilities.controls) {
            if (capabilities.controls.hasOwnProperty(controlTypeId)) {
                for (var controlAttributeName in capabilities.controls[controlTypeId].nodeAttributes) {
                    if (typeof capabilities.controls[controlTypeId].nodeAttributesDefaultValues !== 'object') {
                        throw new Error('Unit tests failed: The control capabilities of control '
                            + JSON.stringify(capabilities.controls[controlTypeId].nodeName)
                            + ' does not have a property called "nodeAttributesDefaultValues" of type object');
                    }
                    numberOfTests++;
                    if (capabilities.controls[controlTypeId].nodeAttributes.hasOwnProperty(controlAttributeName)) {
                        var runtimeControlAttributeType = capabilities.controls[controlTypeId].nodeAttributes[controlAttributeName];
                        if (!('user defined' === runtime.describeType(runtimeControlAttributeType))) {
                            throw new Error('Unit tests failed: The control '
                                + JSON.stringify(capabilities.controls[controlTypeId])
                                + ' attribute '
                                + JSON.stringify(controlAttributeName)
                                + ' implements a type called '
                                + JSON.stringify(capabilities.controls[controlTypeId].nodeAttributes[controlAttributeName])
                                + ', but that type is not registered in the BrowserFS/Runtime engine.');
                        }
                        numberOfTests++;
                        if (typeof capabilities.controls[controlTypeId].nodeAttributesDefaultValues[controlAttributeName] !== 'object') {
                            throw new Error('Unit tests failed: The control '
                                + JSON.stringify(capabilities.controls[controlTypeId])
                                + ' attribute '
                                + JSON.stringify(controlAttributeName)
                                + ' does not have it\'s corresponding default attribute values declared in "nodeAttributesDefaultValues" sibling property');
                        }
                        numberOfTests++;
                    }
                }
                var itemStaticClass = this.getItemStaticClassByTypeNameOrTypeId(capabilities.controls[controlTypeId].nodeName);
                if (null === itemStaticClass) {
                    throw new Error('Current factory implementation does not know how to create a control of type'
                        + JSON.stringify(capabilities.controls[controlTypeId].nodeName));
                }
                numberOfTests++;
                if (typeof itemStaticClass.attributes !== 'object') {
                    throw new Error('The class that is implementing the item of type '
                        + JSON.stringify(capabilities.controls[controlTypeId].nodeName)
                        + ' does not implement a static property called "attributes" of type object');
                }
                numberOfTests++;
                if (itemStaticClass.runtime !== null) {
                    throw new Error('The class that is implementing the item of type '
                        + JSON.stringify(capabilities.controls[controlTypeId].nodeName)
                        + ' does not implement a static property called "runtime" with value = null');
                }
                numberOfTests++;
                if ('string' !== typeof itemStaticClass.nodeName) {
                    throw new Error('The class that is implementing the item of type '
                        + JSON.stringify(capabilities.controls[controlTypeId].nodeName)
                        + ' does not implement a static property called "nodeName" of type string');
                }
                numberOfTests++;
            }
        }
        console.timeEnd('run_runtime_unit_tests');
        console.log('editor unit tests completed: ', numberOfTests, ' tests passed');
    };
    FullFeaturedFactory.prototype.addControlAttributeToStaticControlClass = function (itemStaticClass, controlAttributeName, runtimeControlAttributeType, attributeDefaultValues, runtime) {
        var attributeStaticDefinitions = itemStaticClass.attributes || {};
        attributeStaticDefinitions[controlAttributeName] = {
            type: runtimeControlAttributeType,
            properties: {},
        };
        var typeDescriptor = runtime.getTypeDescriptor(runtimeControlAttributeType);
        if (typeDescriptor.properties) {
            for (var propertyName in typeDescriptor.properties) {
                if (typeDescriptor.properties.hasOwnProperty(propertyName)) {
                    attributeStaticDefinitions[controlAttributeName].properties[propertyName] = {
                        type: typeDescriptor.properties[propertyName].type,
                        optional: typeDescriptor.properties[propertyName].optional,
                        defaultValue: attributeDefaultValues[propertyName],
                    };
                }
            }
        }
        itemStaticClass.attributes = attributeStaticDefinitions;
        itemStaticClass.runtime = itemStaticClass.runtime || runtime;
    };
    FullFeaturedFactory.prototype.getMaxNumberOfControls = function (typeId) {
        for (var i = 0, len = this.capabilities.factory.maximumNumberOfControlsPerForm.length; i < len; i++) {
            if (this.capabilities.factory.maximumNumberOfControlsPerForm[i].typeId === typeId) {
                return this.capabilities.factory.maximumNumberOfControlsPerForm[i].maxNumberOfControls;
            }
        }
        return null;
    };
    FullFeaturedFactory.prototype.isElementTypeIdSupported = function (typeId) {
        return this.capabilities.factory.supportedControlTypeIds.indexOf(typeId) > -1;
    };
    FullFeaturedFactory.prototype.isUnsupportedElement = function (typeId) {
        for (var i = 0, elements = this.getUnavailableControlsList(), len = elements.length; i < len; i++) {
            if (elements[i].typeId === typeId) {
                return true;
            }
        }
        return false;
    };
    FullFeaturedFactory.prototype.getUnsupportedProperties = function () {
        return [];
    };
    FullFeaturedFactory.prototype.canAddNewTranslation = function (existingNumberOfTranslations) {
        if (this.capabilities.maxTranslationsCount === null) {
            return true;
        }
        existingNumberOfTranslations = ~~existingNumberOfTranslations;
        return existingNumberOfTranslations + 1 <= this.capabilities.maxTranslationsCount;
    };
    return FullFeaturedFactory;
}());
var BasicPlanFactory = (function (_super) {
    __extends(BasicPlanFactory, _super);
    function BasicPlanFactory() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    BasicPlanFactory.prototype.getName = function () {
        return 'basic';
    };
    BasicPlanFactory.prototype.getSupportedElements = function () {
        return [
            AddressControl.nodeName,
            CheckBoxControl.nodeName,
            DateControl.nodeName,
            DropDownControl.nodeName,
            EmailControl.nodeName,
            HeadingControl.nodeName,
            ImageControl.nodeName,
            LikertScaleControl.nodeName,
            MapControl.nodeName,
            NameControl.nodeName,
            NumberControl.nodeName,
            PageBreakControl.nodeName,
            PhoneControl.nodeName,
            PriceControl.nodeName,
            RadioControl.nodeName,
            SignatureControl.nodeName,
            SocialControl.nodeName,
            StarRatingControl.nodeName,
            TermsOfServiceControl.nodeName,
            TextControl.nodeName,
            TextAreaControl.nodeName,
            TimeControl.nodeName,
            WebsiteControl.nodeName,
            WidgetVideoControl.nodeName,
            WidgetFacebookControl.nodeName,
            WidgetPDFControl.nodeName,
            PageContainer.nodeName,
            DivContainer.nodeName,
            LikertContainer.nodeName,
            FeeControl.nodeName
        ];
    };
    BasicPlanFactory.prototype.createItemByTypeId = function (itemTypeId, document, elementProperties) {
        switch (itemTypeId) {
            case ElementTypes.ELEMENT_TYPE_FORM:
                throw new Error('Operation is not supported by this factory. Use the FormUnserializer instead to create a new form!');
            case ElementTypes.CONTAINER_TYPE_ROW:
                return new RowContainer(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ADDRESS:
                return new AddressControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
                return new CheckBoxControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DATE:
                return new DateControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                return new DropDownControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_EMAIL:
                return new EmailControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FILE:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTROL_TYPE_FILE);
            case ElementTypes.CONTROL_TYPE_HEADING:
                return new HeadingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HTML_BLOCK:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTROL_TYPE_HTML_BLOCK);
            case ElementTypes.CONTROL_TYPE_IMAGE:
                return new ImageControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_LIKERT_SCALE:
                return new LikertScaleControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_MAP:
                return new MapControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NAME:
                return new NameControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NUMBER:
                return new NumberControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PAGE_BREAK:
                return new PageBreakControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PASSWORD:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTROL_TYPE_PASSWORD);
            case ElementTypes.CONTROL_TYPE_PHONE:
                return new PhoneControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PRICE:
                return new PriceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_RADIO:
                return new RadioControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SIGNATURE:
                return new SignatureControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SOCIAL:
                return new SocialControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_STAR_RATING:
                return new StarRatingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE:
                return new TermsOfServiceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXT:
                return new TextControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXTAREA:
                return new TextAreaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TIME:
                return new TimeControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WEBSITE:
                return new WebsiteControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FORM_HEADER:
                return new FormHeaderControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CAPTCHA:
                return new CaptchaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ACTION_BAR:
                return new ActionBarControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SEPARATOR:
                return new SeparatorControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK:
                return new WidgetFacebookControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_PDF:
                return new WidgetPDFControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_VIDEO:
                return new WidgetVideoControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_COUPON:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTROL_TYPE_COUPON);
            case ElementTypes.CONTROL_TYPE_FORMULA:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTROL_TYPE_FORMULA);
            case ElementTypes.CONTAINER_TYPE_DIV:
                return new DivContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_PAGE:
                return new PageContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER:
                return new LikertContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTAINER_TYPE_REPEATABLE);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP);
            case ElementTypes.CONTROL_TYPE_FEE:
                return new FeeControl(document, elementProperties);
            default:
                throw new Error('FormItemFactory.createItemByTypeId(): Don\'t know how to create a item with type id ' + JSON.stringify(itemTypeId));
        }
    };
    BasicPlanFactory.prototype.getUnsupportedProperties = function () {
        return [
            'options-isNumberOfTimesAnOptionCanBeChosen',
            'options-quizOptions',
        ];
    };
    BasicPlanFactory.prototype.getSupportedEditorSettings = function () {
        return [];
    };
    return BasicPlanFactory;
}(FullFeaturedFactory));
var GoldPlanFactory = (function (_super) {
    __extends(GoldPlanFactory, _super);
    function GoldPlanFactory() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    GoldPlanFactory.prototype.getName = function () {
        return 'gold';
    };
    GoldPlanFactory.prototype.getSupportedElements = function () {
        return [
            AddressControl.nodeName,
            CheckBoxControl.nodeName,
            DateControl.nodeName,
            DropDownControl.nodeName,
            EmailControl.nodeName,
            FileControl.nodeName,
            HeadingControl.nodeName,
            HTMLBlockControl.nodeName,
            ImageControl.nodeName,
            LikertScaleControl.nodeName,
            MapControl.nodeName,
            NameControl.nodeName,
            NumberControl.nodeName,
            PageBreakControl.nodeName,
            PasswordControl.nodeName,
            PhoneControl.nodeName,
            PriceControl.nodeName,
            RadioControl.nodeName,
            SignatureControl.nodeName,
            SocialControl.nodeName,
            StarRatingControl.nodeName,
            TermsOfServiceControl.nodeName,
            TextControl.nodeName,
            TextAreaControl.nodeName,
            TimeControl.nodeName,
            WebsiteControl.nodeName,
            WidgetFacebookControl.nodeName,
            WidgetPDFControl.nodeName,
            WidgetVideoControl.nodeName,
            FormulaControl.nodeName,
            PageContainer.nodeName,
            DivContainer.nodeName,
            LikertContainer.nodeName,
            RepeatableContainer.nodeName,
            RepeatableGroup.nodeName,
            FeeControl.nodeName
        ];
    };
    GoldPlanFactory.prototype.createItemByTypeId = function (itemTypeId, document, elementProperties) {
        switch (itemTypeId) {
            case ElementTypes.ELEMENT_TYPE_FORM:
                throw new Error('Operation is not supported by this factory. Use the FormUnserializer instead to create a new form!');
            case ElementTypes.CONTAINER_TYPE_ROW:
                return new RowContainer(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ADDRESS:
                return new AddressControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
                return new CheckBoxControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DATE:
                return new DateControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                return new DropDownControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_EMAIL:
                return new EmailControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FILE:
                return new FileControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HEADING:
                return new HeadingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HTML_BLOCK:
                return new HTMLBlockControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_IMAGE:
                return new ImageControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_LIKERT_SCALE:
                return new LikertScaleControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_MAP:
                return new MapControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NAME:
                return new NameControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NUMBER:
                return new NumberControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PAGE_BREAK:
                return new PageBreakControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PASSWORD:
                return new PasswordControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PHONE:
                return new PhoneControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PRICE:
                return new PriceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_RADIO:
                return new RadioControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SIGNATURE:
                return new SignatureControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SOCIAL:
                return new SocialControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_STAR_RATING:
                return new StarRatingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE:
                return new TermsOfServiceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXT:
                return new TextControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXTAREA:
                return new TextAreaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TIME:
                return new TimeControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WEBSITE:
                return new WebsiteControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FORM_HEADER:
                return new FormHeaderControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CAPTCHA:
                return new CaptchaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ACTION_BAR:
                return new ActionBarControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK:
                return new WidgetFacebookControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_PDF:
                return new WidgetPDFControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_VIDEO:
                return new WidgetVideoControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SEPARATOR:
                return new SeparatorControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_COUPON:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTROL_TYPE_COUPON);
            case ElementTypes.CONTROL_TYPE_FORMULA:
                return new FormulaControl(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_DIV:
                return new DivContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_PAGE:
                return new PageContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER:
                return new LikertContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE:
                return new RepeatableContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP:
                return new RepeatableGroup(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FEE:
                return new FeeControl(document, elementProperties);
            default:
                throw new Error('FormItemFactory.createItemByTypeId(): Don\'t know how to create a item with type id ' + JSON.stringify(itemTypeId));
        }
    };
    GoldPlanFactory.prototype.getSupportedEditorSettings = function () {
        return [];
    };
    return GoldPlanFactory;
}(FullFeaturedFactory));
var WixStarterPlanFactory = (function (_super) {
    __extends(WixStarterPlanFactory, _super);
    function WixStarterPlanFactory() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WixStarterPlanFactory.prototype.getName = function () {
        return 'wixStarter';
    };
    WixStarterPlanFactory.prototype.getSupportedElements = function () {
        return [
            AddressControl.nodeName,
            CheckBoxControl.nodeName,
            DateControl.nodeName,
            DropDownControl.nodeName,
            EmailControl.nodeName,
            FileControl.nodeName,
            HeadingControl.nodeName,
            HTMLBlockControl.nodeName,
            ImageControl.nodeName,
            LikertScaleControl.nodeName,
            MapControl.nodeName,
            NameControl.nodeName,
            NumberControl.nodeName,
            PageBreakControl.nodeName,
            PasswordControl.nodeName,
            PhoneControl.nodeName,
            PriceControl.nodeName,
            RadioControl.nodeName,
            SignatureControl.nodeName,
            SocialControl.nodeName,
            StarRatingControl.nodeName,
            TermsOfServiceControl.nodeName,
            TextControl.nodeName,
            TextAreaControl.nodeName,
            TimeControl.nodeName,
            WebsiteControl.nodeName,
            WidgetFacebookControl.nodeName,
            WidgetPDFControl.nodeName,
            WidgetVideoControl.nodeName,
            PageContainer.nodeName,
            DivContainer.nodeName,
            LikertContainer.nodeName,
            RepeatableContainer.nodeName,
            RepeatableGroup.nodeName,
            FeeControl.nodeName
        ];
    };
    WixStarterPlanFactory.prototype.createItemByTypeId = function (itemTypeId, document, elementProperties) {
        switch (itemTypeId) {
            case ElementTypes.ELEMENT_TYPE_FORM:
                throw new Error('Operation is not supported by this factory. Use the FormUnserializer instead to create a new form!');
            case ElementTypes.CONTAINER_TYPE_ROW:
                return new RowContainer(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ADDRESS:
                return new AddressControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
                return new CheckBoxControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DATE:
                return new DateControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                return new DropDownControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_EMAIL:
                return new EmailControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FILE:
                return new FileControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HEADING:
                return new HeadingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HTML_BLOCK:
                return new HTMLBlockControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_IMAGE:
                return new ImageControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_LIKERT_SCALE:
                return new LikertScaleControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_MAP:
                return new MapControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NAME:
                return new NameControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NUMBER:
                return new NumberControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PAGE_BREAK:
                return new PageBreakControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PASSWORD:
                return new PasswordControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PHONE:
                return new PhoneControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PRICE:
                return new PriceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_RADIO:
                return new RadioControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SIGNATURE:
                return new SignatureControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SOCIAL:
                return new SocialControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_STAR_RATING:
                return new StarRatingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE:
                return new TermsOfServiceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXT:
                return new TextControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXTAREA:
                return new TextAreaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TIME:
                return new TimeControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WEBSITE:
                return new WebsiteControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FORM_HEADER:
                return new FormHeaderControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CAPTCHA:
                return new CaptchaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ACTION_BAR:
                return new ActionBarControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK:
                return new WidgetFacebookControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_PDF:
                return new WidgetPDFControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_VIDEO:
                return new WidgetVideoControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SEPARATOR:
                return new SeparatorControl(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_DIV:
                return new DivContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_PAGE:
                return new PageContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER:
                return new LikertContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTAINER_TYPE_REPEATABLE);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP);
            case ElementTypes.CONTROL_TYPE_FEE:
                return new FeeControl(document, elementProperties);
            default:
                throw new Error('FormItemFactory.createItemByTypeId(): Don\'t know how to create a item with type id ' + JSON.stringify(itemTypeId));
        }
    };
    WixStarterPlanFactory.prototype.getUnsupportedProperties = function () {
        return [
            'options-isNumberOfTimesAnOptionCanBeChosen'
        ];
    };
    WixStarterPlanFactory.prototype.getSupportedEditorSettings = function () {
        return [];
    };
    return WixStarterPlanFactory;
}(FullFeaturedFactory));
var WeeblySilverPlanFactory = (function (_super) {
    __extends(WeeblySilverPlanFactory, _super);
    function WeeblySilverPlanFactory() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WeeblySilverPlanFactory.prototype.getName = function () {
        return 'weeblySilver';
    };
    WeeblySilverPlanFactory.prototype.getSupportedElements = function () {
        return [
            AddressControl.nodeName,
            CheckBoxControl.nodeName,
            DateControl.nodeName,
            DropDownControl.nodeName,
            EmailControl.nodeName,
            FileControl.nodeName,
            HeadingControl.nodeName,
            HTMLBlockControl.nodeName,
            ImageControl.nodeName,
            LikertScaleControl.nodeName,
            MapControl.nodeName,
            NameControl.nodeName,
            NumberControl.nodeName,
            PageBreakControl.nodeName,
            PasswordControl.nodeName,
            PhoneControl.nodeName,
            PriceControl.nodeName,
            RadioControl.nodeName,
            SignatureControl.nodeName,
            SocialControl.nodeName,
            StarRatingControl.nodeName,
            TermsOfServiceControl.nodeName,
            TextControl.nodeName,
            TextAreaControl.nodeName,
            TimeControl.nodeName,
            WebsiteControl.nodeName,
            WidgetFacebookControl.nodeName,
            WidgetPDFControl.nodeName,
            WidgetVideoControl.nodeName,
            PageContainer.nodeName,
            DivContainer.nodeName,
            LikertContainer.nodeName,
            RepeatableContainer.nodeName,
            RepeatableGroup.nodeName,
            FeeControl.nodeName
        ];
    };
    WeeblySilverPlanFactory.prototype.createItemByTypeId = function (itemTypeId, document, elementProperties) {
        switch (itemTypeId) {
            case ElementTypes.ELEMENT_TYPE_FORM:
                throw new Error('Operation is not supported by this factory. Use the FormUnserializer instead to create a new form!');
            case ElementTypes.CONTAINER_TYPE_ROW:
                return new RowContainer(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ADDRESS:
                return new AddressControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
                return new CheckBoxControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DATE:
                return new DateControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                return new DropDownControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_EMAIL:
                return new EmailControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FILE:
                return new FileControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HEADING:
                return new HeadingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_HTML_BLOCK:
                return new HTMLBlockControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_IMAGE:
                return new ImageControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_LIKERT_SCALE:
                return new LikertScaleControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_MAP:
                return new MapControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NAME:
                return new NameControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_NUMBER:
                return new NumberControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PAGE_BREAK:
                return new PageBreakControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PASSWORD:
                return new PasswordControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PHONE:
                return new PhoneControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_PRICE:
                return new PriceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_RADIO:
                return new RadioControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SIGNATURE:
                return new SignatureControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SOCIAL:
                return new SocialControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_STAR_RATING:
                return new StarRatingControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE:
                return new TermsOfServiceControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXT:
                return new TextControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TEXTAREA:
                return new TextAreaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_TIME:
                return new TimeControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WEBSITE:
                return new WebsiteControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_FORM_HEADER:
                return new FormHeaderControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_CAPTCHA:
                return new CaptchaControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_ACTION_BAR:
                return new ActionBarControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK:
                return new WidgetFacebookControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_PDF:
                return new WidgetPDFControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_WIDGET_VIDEO:
                return new WidgetVideoControl(document, elementProperties);
            case ElementTypes.CONTROL_TYPE_SEPARATOR:
                return new SeparatorControl(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_DIV:
                return new DivContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_PAGE:
                return new PageContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER:
                return new LikertContainer(document, elementProperties);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTAINER_TYPE_REPEATABLE);
            case ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP:
                return (new ElementNotSupported(document, elementProperties))
                    .withTypeId(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP);
            case ElementTypes.CONTROL_TYPE_FEE:
                return new FeeControl(document, elementProperties);
            default:
                throw new Error('FormItemFactory.createItemByTypeId(): Don\'t know how to create a item with type id ' + JSON.stringify(itemTypeId));
        }
    };
    WeeblySilverPlanFactory.prototype.getUnsupportedProperties = function () {
        return [
            'options-isNumberOfTimesAnOptionCanBeChosen'
        ];
    };
    WeeblySilverPlanFactory.prototype.getSupportedEditorSettings = function () {
        return [];
    };
    return WeeblySilverPlanFactory;
}(FullFeaturedFactory));
var PersistentStorage = (function (_super) {
    __extends(PersistentStorage, _super);
    function PersistentStorage(engine) {
        var _this = _super.call(this) || this;
        (function (self) {
            self.save = Throttle.create(function () {
                self.saveImmediate();
            }, 1000);
        })(_this);
        _this.engine = engine;
        return _this;
    }
    PersistentStorage.prototype.saveImmediate = function () {
        if (localStorage) {
            localStorage.setItem('viewForm', JSON.stringify(this.engine.getDocument().serialize()));
        }
    };
    PersistentStorage.prototype.load = function () {
        if (localStorage) {
            var item = localStorage.getItem('viewForm');
            if (null !== item) {
                this.engine.loadFromString(item);
                return;
            }
        }
        this.engine.loadFromString('[ "v0.4", -1, null, null, {}, null, [ 90001, null, null, {}, null, [], 20, null ], 20, null, [ 27, null, null, {}, null, null, 20, null ], [ 28, null, null, {}, null, null, 20, null ], [ 29, null, null, {}, null, null, 20, null ], [] ]');
    };
    return PersistentStorage;
}(EventEmitter));
var UnserializerBag = (function () {
    function UnserializerBag(form, engine) {
        this.elements = {};
        this.reinitElements = [];
        this.form = form;
        this.engine = engine;
    }
    UnserializerBag.prototype.add = function (hash, element) {
        this.elements[hash] = element;
    };
    UnserializerBag.prototype.destroy = function () {
        this.elements = null;
        this.form = null;
        this.engine = null;
        this.reinitElements = null;
    };
    UnserializerBag.prototype.createElement = function (nodeTypeId, properties, nodeId, colspan, height, errors, hash) {
        var result;
        if (null !== hash && this.elements[hash] && nodeTypeId === this.elements[hash].getTypeId()) {
            result = this.elements[hash];
            if (result.getElementKind() === EElementKind.CONTAINER) {
                result.removeAllChildren();
            }
            result['properties'] = properties;
            this.reinitElements.push(result);
        }
        else {
            result = this.engine.createElement(nodeTypeId, properties);
        }
        result
            .withId(nodeId)
            .withColspan(colspan)
            .withHeight(height)
            .withErrors(errors)
            .setAttached(true);
        return result;
    };
    UnserializerBag.prototype.reinitReusedElements = function () {
        console.time('reinit_reused_elements');
        var labelPlacement = this.form.getLabelPlacement(), instructionsPlacement = this.form.getInstructionsPlacement(), suggestedRendererType;
        for (var i = 0, len = this.reinitElements.length; i < len; i++) {
            this.reinitElements[i].onCreated();
            this.reinitElements[i].setupI18n();
            if (this.reinitElements[i].getElementKind() === EElementKind.CONTROL) {
                this.reinitElements[i]['rendererType'] = undefined;
                suggestedRendererType = RenderersFactory.getSuggestedRenderer(this.reinitElements[i], labelPlacement, instructionsPlacement);
                this.reinitElements[i].setRendererType(suggestedRendererType);
            }
        }
        console.timeEnd('reinit_reused_elements');
    };
    return UnserializerBag;
}());
var FormUnserializer = (function () {
    function FormUnserializer(editor) {
        this.cache = {};
        this.engine = editor;
    }
    FormUnserializer.prototype.unserialize = function (fromStructure, useUnserializerBag) {
        var serializedVersion = this.getSerializationVersion(fromStructure), unserializer = this.createUnserializer(serializedVersion);
        try {
            unserializer.unserialize(fromStructure, useUnserializerBag);
        }
        catch (e) {
            if (window['CFTracker']) {
                window['CFTracker'].event('form_unserialization_error');
            }
            throw e;
        }
    };
    FormUnserializer.prototype.getSerializationVersion = function (fromStructure) {
        return fromStructure && fromStructure[0] && fromStructure.length
            ? fromStructure[0]
            : null;
    };
    FormUnserializer.prototype.createUnserializer = function (version) {
        if (undefined !== this.cache[version]) {
            return this.cache[version];
        }
        switch (version) {
            case UnserializerV0_4.UNSERIALIZER_VERSION:
                return this.cache[UnserializerV0_4.UNSERIALIZER_VERSION] = new UnserializerV0_4(this.engine);
            case UnserializerV0_5.UNSERIALIZER_VERSION:
                return this.cache[UnserializerV0_5.UNSERIALIZER_VERSION] = new UnserializerV0_5(this.engine);
            case UnserializerV0_6.UNSERIALIZER_VERSION:
                return this.cache[UnserializerV0_6.UNSERIALIZER_VERSION] = new UnserializerV0_6(this.engine);
            default:
                if (window['CFTracker']) {
                    window['CFTracker'].event('form_unserialization_version_mismatch_error');
                }
                throw new Error('Failed to create unserializer for version ' + JSON.stringify(version));
        }
    };
    FormUnserializer.LATEST_VERSION = 'v0.6';
    return FormUnserializer;
}());
var UndoService = (function (_super) {
    __extends(UndoService, _super);
    function UndoService(editor, undoServiceInteractionProvider) {
        var _this = _super.call(this) || this;
        _this.chunks = [];
        _this.paused = true;
        _this.lastActionName = null;
        _this.hasSaveRequests = false;
        _this.undoPointer = -1;
        _this.engine = editor;
        _this.undoServiceInteractionProvider = undoServiceInteractionProvider;
        _this.lastSaveTime = +new Date;
        _this.requestSavedThrottler = Throttle.create(function () {
            _this.requestSaveInImmediateMode();
        }, 1000);
        _this.init();
        _this.undoServiceInteractionProvider.setButtonState(_this.canUndo(), _this.canRedo());
        return _this;
    }
    UndoService.prototype.init = function () {
        var _this = this;
        this.on('user-action', function (actionName) {
            _this.lastActionName = actionName;
            _this.requestSaveInImmediateMode();
        });
        this.on('pause', function () {
            console.log('pause');
            _this.paused = true;
        });
        this.on('resume', function () {
            console.log('resume');
            _this.paused = false;
        });
        this.on('request-save', function () {
            _this.hasSaveRequests = true;
            _this.requestSavedThrottler();
        });
        this.on('save', function () {
            _this.requestSaveInImmediateMode();
        });
        this.undoServiceInteractionProvider.undoTriggered = function () {
            _this.undo();
            return { canUndo: _this.canUndo(),
                canRedo: _this.canRedo()
            };
        };
        this.undoServiceInteractionProvider.redoTriggered = function () {
            _this.redo();
            return { canUndo: _this.canUndo(),
                canRedo: _this.canRedo()
            };
        };
    };
    UndoService.prototype.undo = function () {
        if (!this.canUndo()) {
            return;
        }
        this.undoPointer--;
        var currentData = this.chunks[this.undoPointer].data;
        this.lastActionName = this.chunks[this.undoPointer].description;
        this.paused = true;
        this.engine.loadFromString(currentData, true);
        this.paused = false;
        this.trigger('change');
    };
    UndoService.prototype.redo = function () {
        if (!this.canRedo()) {
            return;
        }
        this.undoPointer++;
        var currentData = this.chunks[this.undoPointer].data;
        this.lastActionName = this.chunks[this.undoPointer].description;
        this.paused = true;
        this.engine.loadFromString(currentData, true);
        this.paused = false;
        this.trigger('change');
    };
    UndoService.prototype.requestSaveInImmediateMode = function () {
        if (this.paused) {
            console.warn('UndoService paused. Cannot record chunk.');
            return;
        }
        console.warn('save ' + this.lastActionName);
        this.hasSaveRequests = false;
        var data = JSON.stringify(this.engine.getDocument().serialize()), createNewChunk = false, currentTime = +new Date;
        if (this.chunks.length && data === this.chunks[this.undoPointer].data) {
            return;
        }
        this.removeChunksAfterUndoPointer();
        if (this.chunks.length === 0 ||
            this.lastActionName !== this.chunks[this.chunks.length - 1].description ||
            currentTime - this.lastSaveTime > UndoService.MAX_CHUNK_SAVE_TIME) {
            createNewChunk = true;
        }
        if (createNewChunk) {
            console.log('create undo chunk');
            var chunk = {
                description: this.lastActionName,
                data: data
            };
            this.chunks.push(chunk);
            this.undoPointer++;
            while (this.chunks.length > UndoService.MAX_UNDO_LEVELS + 1) {
                this.chunks.shift();
                this.undoPointer--;
            }
        }
        else {
            this.chunks[this.undoPointer].data = data;
            console.log('update chunk');
        }
        this.lastSaveTime = currentTime;
        this.undoServiceInteractionProvider.setButtonState(this.canUndo(), this.canRedo());
    };
    UndoService.prototype.canUndo = function () {
        return this.undoPointer > 0;
    };
    UndoService.prototype.canRedo = function () {
        return (this.undoPointer + 1) < this.chunks.length;
    };
    UndoService.prototype.removeChunksAfterUndoPointer = function () {
        this.chunks.splice(this.undoPointer + 1);
    };
    UndoService.MAX_UNDO_LEVELS = 10;
    UndoService.MAX_CHUNK_SAVE_TIME = 5000;
    return UndoService;
}(EventEmitter));
var ButtonUndoServiceInteractionProvider = (function () {
    function ButtonUndoServiceInteractionProvider(undoButtonCSSSelector, redoButtonCSSSelector) {
        var _this = this;
        this.undoButtonDOMNode = document.querySelector(undoButtonCSSSelector) || null;
        this.redoButtonDOMNode = document.querySelector(redoButtonCSSSelector) || null;
        this.undoButtonDOMNode.addEventListener('click', function () {
            var disable = _this.undoTriggered();
            _this.setButtonState(disable.canUndo, disable.canRedo);
        }, false);
        this.redoButtonDOMNode.addEventListener('click', function () {
            var disable = _this.redoTriggered();
            _this.setButtonState(disable.canUndo, disable.canRedo);
        }, false);
    }
    ButtonUndoServiceInteractionProvider.prototype.setButtonState = function (canUndo, canRedo) {
        if (this.undoButtonDOMNode) {
            if (canUndo) {
                this.undoButtonDOMNode.style.opacity = '';
                this.undoButtonDOMNode.style.pointerEvents = 'auto';
            }
            else {
                this.undoButtonDOMNode.style.opacity = '.2';
                this.undoButtonDOMNode.style.pointerEvents = 'none';
            }
        }
        if (this.redoButtonDOMNode) {
            if (canRedo) {
                this.redoButtonDOMNode.style.opacity = '';
                this.redoButtonDOMNode.style.pointerEvents = 'auto';
            }
            else {
                this.redoButtonDOMNode.style.opacity = '.2';
                this.redoButtonDOMNode.style.pointerEvents = 'none';
            }
        }
    };
    return ButtonUndoServiceInteractionProvider;
}());
var HeaderUndoServiceInteractionProvider = (function () {
    function HeaderUndoServiceInteractionProvider(header) {
        var _this = this;
        this.header = header;
        this.header.on(EHeaderConstants.HEADER_EVENT, function (args) {
            if (args.key === 'Undo') {
                var disable = _this.undoTriggered();
                _this.header.setButtonInteractionState(EInteractionableControlKeys.UNDO, disable.canUndo);
                _this.header.setButtonInteractionState(EInteractionableControlKeys.REDO, disable.canRedo);
            }
            if (args.key === 'Redo') {
                var disable = _this.redoTriggered();
                _this.header.setButtonInteractionState(EInteractionableControlKeys.UNDO, disable.canUndo);
                _this.header.setButtonInteractionState(EInteractionableControlKeys.REDO, disable.canRedo);
            }
        });
    }
    HeaderUndoServiceInteractionProvider.prototype.setButtonState = function (canUndo, canRedo) {
        this.header.setButtonInteractionState(EInteractionableControlKeys.UNDO, canUndo);
        this.header.setButtonInteractionState(EInteractionableControlKeys.REDO, canRedo);
    };
    return HeaderUndoServiceInteractionProvider;
}());
var ElementHardcodedPropertyLabel = (function () {
    function ElementHardcodedPropertyLabel() {
    }
    ElementHardcodedPropertyLabel.withI18n = function (i18n) {
        this.i18n = i18n;
        return this;
    };
    ElementHardcodedPropertyLabel.addHardcodedPropertyName = function (elementTypeIdOrElementTypeIdList, propertyFQN, hardcodedPropertyName, hardcodedPropertyNameI18n) {
        if (null !== elementTypeIdOrElementTypeIdList) {
            if ('number' !== typeof elementTypeIdOrElementTypeIdList) {
                if (!elementTypeIdOrElementTypeIdList || !(elementTypeIdOrElementTypeIdList instanceof Array)) {
                    throw new Error('Invalid argument: number|number[] expected!');
                }
                else {
                    for (var i = 0, len = elementTypeIdOrElementTypeIdList.length; i < len; i++) {
                        if ('number' !== typeof elementTypeIdOrElementTypeIdList[i]) {
                            throw new Error('Invalid argument: number|number[] expected!');
                        }
                    }
                }
            }
        }
        if ('string' !== typeof propertyFQN || '' === propertyFQN) {
            throw new Error('Invalid argument: string not empty expected!');
        }
        if ('string' !== typeof hardcodedPropertyName || '' === hardcodedPropertyName) {
            throw new Error('Invalid argument: string not empty expected!');
        }
        this.hardcodings.push({
            hardcodedPropertyName: hardcodedPropertyName,
            propertyFQN: propertyFQN,
            elementTypeIdOrElementTypeIdList: elementTypeIdOrElementTypeIdList,
            hardcodedPropertyNameI18n: hardcodedPropertyNameI18n,
        });
    };
    ElementHardcodedPropertyLabel.getHardcodedPropertyLabel = function (elementTypeId, propertyFQN) {
        for (var i = 0, len = this.hardcodings.length; i < len; i++) {
            if ((null === this.hardcodings[i].elementTypeIdOrElementTypeIdList
                || this.hardcodings[i].elementTypeIdOrElementTypeIdList === elementTypeId
                || (this.hardcodings[i].elementTypeIdOrElementTypeIdList instanceof Array
                    && this.hardcodings[i].elementTypeIdOrElementTypeIdList.indexOf(elementTypeId) > -1))
                && this.hardcodings[i].propertyFQN === propertyFQN) {
                return this.i18n.translateText(this.hardcodings[i].hardcodedPropertyNameI18n)
                    && this.i18n.translateText(this.hardcodings[i].hardcodedPropertyNameI18n) !== this.hardcodings[i].hardcodedPropertyNameI18n
                    ? this.i18n.translateText(this.hardcodings[i].hardcodedPropertyNameI18n)
                    : this.hardcodings[i].hardcodedPropertyName;
            }
        }
        return null;
    };
    ElementHardcodedPropertyLabel.addHardcodedAttributeName = function (attributeFQN, hardcodedAttributeName, hardcodedAttributeNameI18n) {
        if ('string' !== typeof attributeFQN || !attributeFQN) {
            throw new Error('Invalid argument: string not empty expected!');
        }
        if ('string' !== typeof hardcodedAttributeName || !hardcodedAttributeName) {
            throw new Error('Invalid argument: string not empty expected!');
        }
        this.attributeHardcodings.push({
            hardcodedAttributeName: hardcodedAttributeName,
            attributeFQN: attributeFQN,
            hardcodedAttributeNameI18n: hardcodedAttributeNameI18n,
        });
    };
    ElementHardcodedPropertyLabel.getHardcodedAttributeLabel = function (attributeFQN) {
        for (var i = 0, len = this.attributeHardcodings.length; i < len; i++) {
            if (this.attributeHardcodings[i].attributeFQN === attributeFQN) {
                return this.i18n.translateText(this.attributeHardcodings[i].hardcodedAttributeNameI18n)
                    && this.i18n.translateText(this.attributeHardcodings[i].hardcodedAttributeNameI18n) !== this.attributeHardcodings[i].hardcodedAttributeNameI18n
                    ? this.i18n.translateText(this.attributeHardcodings[i].hardcodedAttributeNameI18n)
                    : this.attributeHardcodings[i].hardcodedAttributeName;
            }
        }
        return null;
    };
    ElementHardcodedPropertyLabel.hardcodings = [];
    ElementHardcodedPropertyLabel.attributeHardcodings = [];
    return ElementHardcodedPropertyLabel;
}());
var InspectorHiddenProperties = (function () {
    function InspectorHiddenProperties() {
    }
    InspectorHiddenProperties.makePropertyHiddenInInspectorPanel = function (propertyFQN, propertyType, elementsTypeIDsList) {
        switch (true) {
            case null === propertyFQN:
                break;
            case 'string' === typeof propertyFQN:
                if ('' === propertyFQN) {
                    throw new Error('Invalid argument: propertyFQN! Empty strings not allowed!');
                }
                break;
            case propertyFQN instanceof RegExp:
                break;
            default:
                throw new Error('Invalid argument: propertyFQN: string|RegExp expected!');
        }
        switch (true) {
            case null === propertyType:
                break;
            case 'string' === typeof propertyType:
                if ('' === propertyType) {
                    throw new Error('Invalid argument: propertyType! Empty strings not allowed!');
                }
                break;
            case propertyType instanceof RegExp:
                break;
            default:
                throw new Error('Invalid argument: propertyFQN: string|RegExp expected!');
        }
        switch (true) {
            case null === elementsTypeIDsList:
                break;
            case 'number' === typeof elementsTypeIDsList:
                break;
            case elementsTypeIDsList instanceof Array:
                if (!elementsTypeIDsList.length) {
                    throw new Error('Invalid argument: int[] expected!');
                }
                break;
            default:
                throw new Error('Invalid argument: int|int[]|null expected!');
        }
        this.hiddenProperties.push({
            propertyName: propertyFQN,
            propertyType: propertyType,
            elementList: elementsTypeIDsList
        });
    };
    InspectorHiddenProperties.isPropertyEditable = function (property, ofElement) {
        var isEditable = true, elementTypeId = ofElement.getTypeId(), propertyName, propertyType, elementsList, propNameMatched, propTypeMatched;
        for (var i = 0, len = this.hiddenProperties.length; i < len; i++) {
            elementsList = this.hiddenProperties[i].elementList;
            if (null !== elementsList) {
                if ('number' === typeof elementsList && elementsList !== elementTypeId) {
                    continue;
                }
                if (elementsList instanceof Array && -1 === elementsList.indexOf(elementTypeId)) {
                    continue;
                }
            }
            propNameMatched = false;
            propTypeMatched = false;
            propertyName = this.hiddenProperties[i].propertyName;
            if (null !== propertyName) {
                if ('string' === typeof propertyName) {
                    propNameMatched = propertyName === property.name;
                }
                else if (propertyName instanceof RegExp) {
                    propNameMatched = propertyName.test(property.name);
                }
            }
            else {
                propNameMatched = true;
            }
            propertyType = this.hiddenProperties[i].propertyType;
            if (null !== propertyType) {
                if ('string' === typeof propertyType) {
                    propTypeMatched = propertyType === property.type;
                }
                else if (propertyType instanceof RegExp) {
                    propTypeMatched = propertyType.test(property.type);
                }
            }
            else {
                propTypeMatched = true;
            }
            if (propNameMatched && propTypeMatched) {
                return false;
            }
        }
        return true;
    };
    InspectorHiddenProperties.hiddenProperties = [];
    return InspectorHiddenProperties;
}());
var FormTranslationsService = (function (_super) {
    __extends(FormTranslationsService, _super);
    function FormTranslationsService(document) {
        var _this = _super.call(this) || this;
        _this.document = document;
        return _this;
    }
    FormTranslationsService.prototype.getLanguages = function () {
        return this.languages;
    };
    FormTranslationsService.prototype.setSupportedFormLanguages = function (formLanguages) {
        this.platformSupportedLanguages = [];
        for (var i = 0, len = (formLanguages || []).length; i < len; i++) {
            this.platformSupportedLanguages.push(formLanguages[i]);
        }
        return this;
    };
    FormTranslationsService.prototype.setAvailableFormLanguages = function (availableFormLanguages) {
        this.languages = [];
        for (var i = 0, len = (availableFormLanguages || []).length; i < len; i++) {
            var language = new FormLanguage(this, availableFormLanguages[i].code3, availableFormLanguages[i].code2, availableFormLanguages[i].default);
            this.languages.push(language);
        }
        this.trigger('translations-list-changed');
        return this;
    };
    FormTranslationsService.prototype.enumeratePlatformSupportedLanguages = function () {
        return this.platformSupportedLanguages || [];
    };
    FormTranslationsService.prototype.enumerateAvailableFormLanguages = function () {
        return (this.languages || []).filter(function (lng) {
            return !!(lng.getNativeName() || lng.getName());
        });
    };
    FormTranslationsService.prototype.addLanguage = function (language) {
        this.languages.push(language);
        this.trigger('translations-list-changed');
        return this;
    };
    FormTranslationsService.prototype.getLanguageByCode = function (languageCode) {
        if (!languageCode) {
            return null;
        }
        for (var i = 0, len = this.languages.length; i < len; i++) {
            if (this.languages[i].getCode3() === languageCode || this.languages[i].getCode2() === languageCode) {
                return this.languages[i];
            }
        }
        return null;
    };
    FormTranslationsService.prototype.removeLanguage = function (language) {
        if (!language) {
            throw new Error('Invalid argument!');
        }
        for (var i = 0, len = this.languages.length; i < len; i++) {
            if (this.languages[i] === language) {
                this.languages.splice(i, 1);
                this.trigger('translations-list-changed');
                return;
            }
        }
        throw new Error('Language ' + language.getName() + ' not found!');
    };
    return FormTranslationsService;
}(EventEmitter));
var FormLanguage = (function (_super) {
    __extends(FormLanguage, _super);
    function FormLanguage(translationsService, code3, code2, isDefault) {
        var _this = _super.call(this) || this;
        _this.translationsService = translationsService;
        _this.code3 = code3;
        _this.code2 = code2 || null;
        _this.default = isDefault;
        _this.init();
        return _this;
    }
    FormLanguage.prototype.getCode3 = function () {
        return this.code3;
    };
    FormLanguage.prototype.getCode2 = function () {
        return this.code2;
    };
    FormLanguage.prototype.getName = function () {
        return this.name;
    };
    FormLanguage.prototype.getNativeName = function () {
        return this.nativeName;
    };
    FormLanguage.prototype.isDefault = function () {
        return this.default;
    };
    FormLanguage.prototype.setDefault = function (defaultState) {
        this.default = !!defaultState;
        return this;
    };
    FormLanguage.prototype.init = function () {
        for (var i = 0, langs = this.translationsService.enumeratePlatformSupportedLanguages(), len = langs.length; i < len; i++) {
            if (langs[i].code3 === this.code3) {
                this.name = langs[i].name;
                this.nativeName = langs[i].native_name;
                break;
            }
        }
    };
    return FormLanguage;
}(EventEmitter));
var ETranslationType;
(function (ETranslationType) {
    ETranslationType["FORM_FIELD"] = "field";
    ETranslationType["FORM_FIELD_INSTRUCTION"] = "instruction";
    ETranslationType["EMAIL_NOTIFICATION"] = "email_notification";
    ETranslationType["SYSTEM_MESSAGE"] = "system_message";
    ETranslationType["PAYMENT_MESSAGE"] = "payment_message";
})(ETranslationType || (ETranslationType = {}));
var TranslationsEditor = (function () {
    function TranslationsEditor(btnAddTranslationDOMNode, languagesContainerDOMNode, formTranslationsService, jq, ui, resourceManager, api, loader) {
        this.btnAddTranslationDOMNode = btnAddTranslationDOMNode;
        this.languagesContainerDOMNode = languagesContainerDOMNode;
        this.formTranslationsService = formTranslationsService;
        this.jq = jq;
        this.ui = ui;
        this.resourceManager = resourceManager;
        this.api = api;
        this.loader = loader;
        this.init();
    }
    TranslationsEditor.prototype.updateLanguagesList = function () {
        if (!this.languagesContainerDOMNode) {
            return;
        }
        while (this.languagesContainerDOMNode.firstChild) {
            this.languagesContainerDOMNode.removeChild(this.languagesContainerDOMNode.firstChild);
        }
        var languages = this.formTranslationsService.enumerateAvailableFormLanguages().slice(0), numberOfLanguages = languages.length;
        languages.filter(function (lng) {
            return !!(lng.getNativeName() || lng.getName());
        }).sort(function (a, b) {
            var aNameLower = (a.getNativeName() || a.getName()).toLowerCase(), bNameLower = (b.getNativeName() || a.getName()).toLowerCase();
            if (aNameLower === bNameLower) {
                return 0;
            }
            else {
                if (aNameLower < bNameLower) {
                    return -1;
                }
                else {
                    return 1;
                }
            }
        });
        for (var i = 0; i < numberOfLanguages; i++) {
            this.languagesContainerDOMNode.appendChild(this.createLanguageButton(languages[i], numberOfLanguages));
        }
    };
    TranslationsEditor.prototype.createLanguageButton = function (formLanguage, numberOfLanguages) {
        var result = document.createElement('div'), caption = document.createElement('span');
        var addButtonSetDefault = numberOfLanguages > 1, addButtonDeleteLanguage = addButtonSetDefault
            ? !formLanguage.isDefault()
            : true;
        result.setAttribute('data-role', 'language');
        result.setAttribute('data-code-3', formLanguage.getCode3());
        result.setAttribute('data-code-2', String(formLanguage.getCode2() || ''));
        caption.setAttribute('data-role', 'language-name');
        caption.textContent = formLanguage.getNativeName();
        result.appendChild(caption);
        var commandContainer = document.createElement('div');
        commandContainer.setAttribute('data-role', 'container');
        var commandPlaceholder;
        if (addButtonSetDefault) {
            commandPlaceholder = document.createElement('div');
            commandPlaceholder.setAttribute('data-role', 'command');
            commandPlaceholder.setAttribute('data-command', 'set-default');
            var radio = document.createElement('input');
            radio.setAttribute('type', 'radio');
            radio.setAttribute('name', 'default-language-lkjkashd');
            var label = document.createElement('label');
            if (formLanguage.isDefault()) {
                radio.checked = true;
                result.setAttribute('data-is-default', '');
                commandPlaceholder.title = 'Default language';
            }
            else {
                commandPlaceholder.title = 'Make default';
            }
            label.appendChild(radio);
            label.appendChild(document.createElement('i'));
            commandPlaceholder.appendChild(label);
            commandContainer.appendChild(commandPlaceholder);
            result.setAttribute('data-has-default', '');
        }
        commandPlaceholder = document.createElement('div');
        commandPlaceholder.setAttribute('data-role', 'command');
        commandPlaceholder.setAttribute('data-command', 'edit');
        commandPlaceholder.innerHTML = '<span class="i123-editicon"></span>';
        commandPlaceholder.title = 'Customize';
        commandContainer.appendChild(commandPlaceholder);
        result.setAttribute('data-has-edit', '');
        if (addButtonDeleteLanguage) {
            commandPlaceholder = document.createElement('div');
            commandPlaceholder.setAttribute('data-role', 'command');
            commandPlaceholder.setAttribute('data-command', 'delete');
            commandPlaceholder.innerHTML = '<span class="i123-close"></span>';
            commandPlaceholder.title = 'Remove';
            commandContainer.appendChild(commandPlaceholder);
            result.setAttribute('data-has-delete', '');
        }
        result.appendChild(commandContainer);
        return result;
    };
    TranslationsEditor.prototype.init = function () {
        var _this = this;
        this.updateLanguagesList();
        (function ($, api, self) {
            $(_this.btnAddTranslationDOMNode).on('click', function (e) {
                if (!_this.loader.getEngine().getFactory().canAddNewTranslation(_this.formTranslationsService.enumerateAvailableFormLanguages().length)) {
                    _this.loader.getCommandDispatcher().triggerPaywall(EUpgradeReason.MAXIMUM_NUMBER_OF_TRANSLATIONS_REACHED);
                    return;
                }
                var formHasOneLanguage = (_this.formTranslationsService.enumerateAvailableFormLanguages().length == 1);
                _this.addNewFormTranslation().then(function (languagePack) {
                    api.POST('/v2/language/' + languagePack.code3 + '/' + _this.loader.getFormId()).then(function () {
                        var language = new FormLanguage(_this.formTranslationsService, languagePack.code3, languagePack.code2, false);
                        _this.formTranslationsService.addLanguage(language);
                        _this.updateLanguagesList();
                        if (formHasOneLanguage) {
                            CFTracker && CFTracker.event('translations_multi_language_enabled');
                            console.log('track :: translations_multi_language_enabled');
                        }
                    }).fail(function () {
                        _this.ui.alert('Failed to add translation', 'Our backend encountered an error while trying to add your new language pack. Please try again later. If problem persist, contact our support team!');
                    });
                });
            });
            $(_this.languagesContainerDOMNode)
                .on('click', 'input[type=radio]', function (e) {
                var languageCode = $(this).closest('[data-role=language]').attr('data-code-3');
                for (var i = 0, langs = self.formTranslationsService.enumerateAvailableFormLanguages(), len = langs.length; i < len; i++) {
                    langs[i].setDefault(langs[i].getCode3() === languageCode);
                }
                self.updateLanguagesList();
                api.POST('/v2/language/' + languageCode + '/' + self.loader.getFormId() + '/default')
                    .fail(function (e) {
                    self.ui.alert('Failed to set form default language!', 'There was an error encountered while trying to save your default form language. ' +
                        'Please retry. ' +
                        'If the problem persist, please contact our support team!');
                });
            })
                .on('click', '[data-role=command][data-command=delete]', function (e) {
                var languageCode = $(this).closest('[data-role=language]').attr('data-code-3'), language = self.formTranslationsService.getLanguageByCode(languageCode);
                if (!language) {
                    return;
                }
                var languageNativeName = language.getName() === language.getNativeName()
                    ? ''
                    : ' (' + language.getNativeName() + ')';
                self.ui.prompt('Delete form translation', 'Are you sure you want to delete the ' + language.getName() + languageNativeName + ' translations from form? Operation cannot be reverted!', function () {
                    self.api.DELETE('/v2/language/' + language.getCode3() + '/' + self.loader.getFormId())
                        .then(function () {
                        self.formTranslationsService.removeLanguage(language);
                        self.updateLanguagesList();
                        CFTracker && CFTracker.event('translations_language_deleted');
                        console.log('tracker :: translations_language_deleted');
                    })
                        .fail(function () {
                        self.ui.alert('Error removing translation!', 'There was an error while deleting the form translation from form. Please retry. If the problem persist, please contact our support team');
                    });
                });
            })
                .on('click', '[data-role=command][data-command=edit]', function (e) {
                var languageCode = $(this).closest('[data-role=language]').attr('data-code-3'), languagePack = self.formTranslationsService.getLanguageByCode(languageCode);
                if (!languagePack) {
                    return;
                }
                CFTracker && CFTracker.event('translations_language_customized');
                console.log('tracker :: translations_language_customized');
                self.editFormLanguagePack(languagePack);
            });
        })(this.jq, this.api, this);
    };
    TranslationsEditor.prototype.addNewFormTranslation = function () {
        var _this = this;
        return (function ($) {
            return $.Deferred(function (defer) {
                var config = _this.formTranslationsService.enumeratePlatformSupportedLanguages().slice(0), existingLanguages = _this.formTranslationsService.enumerateAvailableFormLanguages();
                for (var i = 0, len = existingLanguages.length; i < len; i++) {
                    for (var j = 0, n = config.length; j < n; j++) {
                        if (config[j].code3 === existingLanguages[i].getCode3()) {
                            config.splice(j, 1);
                            break;
                        }
                    }
                }
                config.sort(function (a, b) {
                    var aNameLower = a.name.toLowerCase(), bNameLower = b.name.toLowerCase();
                    return aNameLower === bNameLower
                        ? 0
                        : (aNameLower < bNameLower ? -1 : 1);
                });
                _this.resourceManager.get('/modules/Typescript/Form/resources/translations-add-language-dialog.html')
                    .then(function (dialogTemplateMarkup) {
                    var tpl = new Salvage(dialogTemplateMarkup), model = {
                        "languages": config
                    }, code3Language = null;
                    var dialogResult = _this.ui.createDialog('Add new language', [
                        {
                            type: EDialogButtonType.OK,
                            callback: function () {
                                if (null === code3Language) {
                                    return;
                                }
                                for (var i = 0, len = config.length; i < len; i++) {
                                    if (config[i].code3 === code3Language) {
                                        dialogResult.close();
                                        defer.resolve(FormUtils.clone(config[i]));
                                        return;
                                    }
                                }
                            },
                        },
                        {
                            type: EDialogButtonType.CANCEL,
                            callback: function () {
                                dialogResult.close();
                                defer.reject(new Error('User canceled operation'));
                            },
                        }
                    ], {
                        onCloseButtonClick: function () {
                            dialogResult.close();
                            defer.reject(new Error('User canceled operation'));
                        },
                        height: "450px",
                        width: "468px",
                    });
                    dialogResult.dialog.setAttribute('data-dialog-role', 'add-form-translation');
                    dialogResult.body.innerHTML = tpl.parse(model);
                    _this.loader.getCommandDispatcher().addPerfectScrollbar($(dialogResult.body).find('[data-role=placeholder]').get(0));
                    $(dialogResult.body)
                        .on('input', '[data-role=filter-languages]', function () {
                        var filterText = this.value.replace(/(^[\s]+|[\s]+$)/g, '').toLowerCase(), $languageRows = $(dialogResult.body).find('table > tbody > tr');
                        $languageRows.each(function () {
                            if ('' === filterText || this.textContent.toLowerCase().indexOf(filterText) > -1 || $(this).hasClass('selected')) {
                                this.style.display = '';
                            }
                            else {
                                this.style.display = 'none';
                            }
                        });
                        $(dialogResult.body).find('[data-role=placeholder]').each(function () {
                            this.scrollTop = 0;
                        });
                    })
                        .on('click', 'table tbody > tr', function () {
                        code3Language = this.getAttribute('data-code-3');
                        for (var siblings = this.parentNode.rows, i = 0, len = siblings.length; i < len; i++) {
                            if (siblings[i] !== this) {
                                $(siblings[i]).removeClass('selected');
                            }
                        }
                        $(this).addClass('selected');
                        $(dialogResult.dialog).addClass('ok-enabled');
                    });
                })
                    .fail(function (e) {
                    _this.ui.alert('Failed to load resource', 'Failed to load add translations language dialog. Please retry. If the problem persist, contact our support team', function () {
                        defer.reject(new Error('System error'));
                    });
                });
            }).promise();
        })(this.jq);
    };
    TranslationsEditor.prototype.getTranslationKeyType = function (translationKey) {
        var matches;
        switch (true) {
            case /^page_[\d]+_label$/.test(translationKey):
            case /^control_label_[\d]+$/.test(translationKey):
            case /^control_label_[\d]+_choice_[\d]+$/.test(translationKey):
            case /^likert_headline_[\d]+$/.test(translationKey):
            case /^(Headline|SendButton)$/.test(translationKey):
            case /^textdef_(201|136)$/.test(translationKey):
                return ETranslationType.FORM_FIELD;
            case /^(control|likert)_instructions_[\d]+$/.test(translationKey):
                return ETranslationType.FORM_FIELD_INSTRUCTION;
            case /^terms_of_service_option_label_[\d]+$/.test(translationKey):
                return ETranslationType.FORM_FIELD;
            case /^terms_of_service_html_markup_[\d]+$/.test(translationKey):
                return ETranslationType.FORM_FIELD;
            case !!(matches = /^textdef_([\d]+)$/.exec(translationKey)):
                var textDefId = parseInt(matches[1]);
                switch (true) {
                    case TranslationsEditor.PAYMENT_TEXTDEF_IDS.indexOf(textDefId) > -1:
                        return ETranslationType.PAYMENT_MESSAGE;
                    case TranslationsEditor.EMAIL_NOTIFICATION_TEXTDEF_IDS.indexOf(textDefId) > -1:
                        return ETranslationType.EMAIL_NOTIFICATION;
                    case TranslationsEditor.SYSTEM_MESSAGES_TEXTDEF_IDS.indexOf(textDefId) > -1:
                    default:
                        return ETranslationType.SYSTEM_MESSAGE;
                }
            default:
                return null;
        }
    };
    TranslationsEditor.prototype.isIndentedTranslationKey = function (translationKey) {
        return /^control_label_[\d]+_choice_[\d]+$/.test(translationKey);
    };
    TranslationsEditor.prototype.createEditorTranslationsModel = function (formTranslationPack, wholeTranslationPack) {
        var result = {}, seenTranslationKeys = {}, enumeratedTranslations = this.loader.getEngine().getDocument().enumerateTranslations()
            .concat(this.loader.enumeratePaymentSummaryTranslations());
        for (var i = 0, len = enumeratedTranslations.length; i < len; i++) {
            if (!enumeratedTranslations[i].hidden) {
                var translationKeyType = this.getTranslationKeyType(enumeratedTranslations[i].key);
                if (null === translationKeyType) {
                    continue;
                }
                result[translationKeyType] = result[translationKeyType] || [];
                result[translationKeyType].push({
                    key: enumeratedTranslations[i].key,
                    original: enumeratedTranslations[i].sourceText,
                    translated: enumeratedTranslations[i].sourceText !== (formTranslationPack[enumeratedTranslations[i].key] || "")
                        ? this.encodeNewLine(formTranslationPack[enumeratedTranslations[i].key]) || ""
                        : '',
                    indent: this.isIndentedTranslationKey(enumeratedTranslations[i].key),
                });
                seenTranslationKeys[enumeratedTranslations[i].key] = true;
            }
        }
        for (var k in formTranslationPack) {
            if (!formTranslationPack.hasOwnProperty(k)) {
                continue;
            }
            if (true === seenTranslationKeys[k]) {
                continue;
            }
            var translationKeyType = this.getTranslationKeyType(k);
            if (null === translationKeyType) {
                continue;
            }
            result[translationKeyType] = result[translationKeyType] || [];
            var originalText = wholeTranslationPack[k] || '';
            if ('' === originalText) {
                continue;
            }
            result[translationKeyType].push({
                key: k,
                original: originalText,
                translated: formTranslationPack[k] !== originalText
                    ? formTranslationPack[k]
                    : '',
                indent: false,
            });
        }
        var model = {
            "groups": []
        };
        if (result[ETranslationType.FORM_FIELD]) {
            model.groups.push({
                name: "Form Fields",
                translations: result[ETranslationType.FORM_FIELD]
            });
        }
        if (result[ETranslationType.FORM_FIELD_INSTRUCTION]) {
            model.groups.push({
                name: "Form fields instructions",
                translations: result[ETranslationType.FORM_FIELD_INSTRUCTION]
            });
        }
        if (result[ETranslationType.EMAIL_NOTIFICATION]) {
            model.groups.push({
                name: "Email notification",
                translations: result[ETranslationType.EMAIL_NOTIFICATION]
            });
        }
        if (result[ETranslationType.PAYMENT_MESSAGE]) {
            model.groups.push({
                name: "Payment messages",
                translations: result[ETranslationType.PAYMENT_MESSAGE]
            });
        }
        if (result[ETranslationType.SYSTEM_MESSAGE]) {
            model.groups.push({
                name: "System messages",
                translations: result[ETranslationType.SYSTEM_MESSAGE]
            });
        }
        return model;
    };
    TranslationsEditor.prototype.encodeNewLine = function (text) {
        if (text) {
            return text.replace(/[\n]+/g, '%NEW_LINE%');
        }
        return '';
    };
    TranslationsEditor.prototype.decodeNewLine = function (text) {
        if (text) {
            return text.replace(/%NEW_LINE%/g, '\n');
        }
        return '';
    };
    TranslationsEditor.prototype.editFormLanguagePack = function (languagePack) {
        var _this = this;
        var translationsReader, model, dialog = this.ui.createDialog(languagePack.getNativeName(), [
            {
                type: EDialogButtonType.SAVE,
                callback: function () {
                    _this.api.PUT_JSON('/v2/language/' + languagePack.getCode3() + '/' + _this.loader.getFormId(), _this.collectUserEditedTranslations(dialog.body, model))
                        .then(function () {
                        dialog.close();
                        CFTracker && CFTracker.event('translations_language_customized_save');
                        console.log('tracker :: translations_language_customized_save');
                    })
                        .fail(function () {
                        _this.ui.alert('Error saving language pack', 'There was an error while saving your translations. Please retry. If the problem persist, please contact our support team');
                    });
                },
            },
            {
                type: EDialogButtonType.CANCEL,
                callback: function () {
                    dialog.close();
                },
            }
        ], {
            width: "584px",
            height: "500px",
        });
        dialog.dialog.setAttribute('data-dialog-role', 'translations-editor');
        dialog.body.innerHTML = "<div data-role=\"loader\">\n                                    <div data-role=\"loading-bar\"></div>\n                                    <div data-role=\"loading-bar\"></div>\n                                    <div data-role=\"loading-bar\"></div>\n                                </div>";
        (function ($, self, resourceManager, api, ui) {
            $.when(resourceManager.get('/modules/Typescript/Form/resources/translations-edit-language.html')
                .fail(function (e) {
                ui.alert('Error loading module', 'Failed to load translations dialog markup from server. Please retry. If the problem persist, please contact our support team');
            }), api.GET('/v2/language/' + languagePack.getCode3() + '/' + self.loader.getFormId(), {
                format: "2",
            }).fail(function (e) {
                ui.alert('Error loading language pack', 'Failed to load form language pack from server. Please retry. If the problem persist, please contact our support team');
            }), api.GET('/v2/language/' + languagePack.getCode3())
                .fail(function (e) {
                ui.alert('Error loading translations', 'Failed to load platform translations from server. Please retry. If the problem persist, please contact our support team');
            })).then(function (dialogTemplateHTML, languagePackData, wholeTranslationPack) {
                if (!dialog || !dialog.dialog || !dialog.dialog.parentNode) {
                    return;
                }
                var tpl = new Salvage(dialogTemplateHTML);
                model = self.createEditorTranslationsModel(languagePackData.data, wholeTranslationPack.data);
                translationsReader = new CSVTranslationsReader(ui);
                translationsReader.setCaptionText('Import from CSV');
                $(dialog.dialog).find('.ui-titlebar').append(translationsReader.getRootDOMNode());
                dialog.body.innerHTML = tpl.parse(model);
                dialog.dialog.setAttribute('data-dialog-loaded', '');
                self.loader.getCommandDispatcher().addPerfectScrollbar(dialog.body.querySelector('[data-role=scrollable-content]'));
                self.fixTextInputHeights(dialog.body);
                translationsReader.on('load', function () {
                    window['CFTracker'] && window['CFTracker'].event('translations_import_from_csv');
                    if (!translationsReader.isParsed()) {
                        return;
                    }
                    if (translationsReader.getLanguageColumnIndex(languagePack.getName()) === null) {
                        ui.alert('Error applying translations', 'The provided CSV translations file does not contain the language "' + languagePack.getName() + '". ' +
                            'Please use another file. ' +
                            'Note that you should not alter the column names of the exported CSV file!');
                        return;
                    }
                    var translations = translationsReader.getLanguagePack(languagePack.getName());
                    if (null === translations) {
                        ui.alert('Error applying translations', 'There was an error loading "' + languagePack.getName() + '" from CSV file');
                        return;
                    }
                    var numberOfImportedFields = 0;
                    $(dialog.body).find('[data-role=scrollable-content] textarea[name]').each(function () {
                        var inputName = this.getAttribute('name');
                        if (translations[inputName]) {
                            this.value = translations[inputName];
                            numberOfImportedFields++;
                        }
                    });
                    ui.alert('Import successful', numberOfImportedFields + ' translations were successfully imported from CSV file');
                });
                var currentFilter = '', performThrottledFiltering = Throttle.create(function () {
                    var filterToLower = String(currentFilter || '')
                        .toLowerCase()
                        .replace(/(^[\s]+|[\s]+$)/g, '')
                        .replace(/[\s]+/g, ' ');
                    $(dialog.body).find('[data-role=scrollable-content] table')
                        .each(function () {
                        var filterTable = this, isFullyFiltered = true;
                        $(filterTable).find('tbody > tr').each(function () {
                            if (!filterToLower) {
                                isFullyFiltered = false;
                                this.style.display = '';
                            }
                            else {
                                var text = '', textParts = [];
                                for (var i = 0, len = this.cells.length; i < len; i++) {
                                    textParts.push(i < len - 1
                                        ? this.cells[i].textContent.toLowerCase()
                                        : $(this.cells[i]).find('input, textarea').val().toLowerCase());
                                }
                                text = textParts.join(' ')
                                    .replace(/(^[\s]+|[\s]+$)/g, '')
                                    .replace(/[\s]+/g, ' ');
                                if (text.indexOf(filterToLower) > -1) {
                                    isFullyFiltered = false;
                                    this.style.display = '';
                                }
                                else {
                                    this.style.display = 'none';
                                }
                            }
                        });
                        if (isFullyFiltered) {
                            filterTable.style.display = 'none';
                            $(filterTable).prev('h2').css({ 'display': 'none' });
                        }
                        else {
                            $(filterTable).prev('h2').css({ 'display': '' });
                            filterTable.style.display = '';
                        }
                    });
                    $(dialog.body).find('[data-role=scrollable-content]').each(function () {
                        this.scrollTop = 0;
                    });
                }, 300), setFilter = function (filter) {
                    currentFilter = filter;
                    $(dialog.body).find('[data-role=fixed-content] [name=filter]')
                        .attr('empty', !currentFilter ? '' : null);
                    performThrottledFiltering();
                };
                $(dialog.body)
                    .on('input, input.clear', '[data-role=fixed-content] input[name=filter]', function () {
                    setFilter(this.value);
                })
                    .on('click', '[data-role=fixed-content] [data-role=clear]', function () {
                    $(dialog.body).find('[data-role=fixed-content] [name=filter]').val('').trigger('input.clear');
                });
            });
        })(this.jq, this, this.resourceManager, this.api, this.ui);
    };
    TranslationsEditor.prototype.collectUserEditedTranslations = function (dialogBody, model) {
        var result = {};
        (function ($) {
            $(dialogBody).find('[data-role=scrollable-content] textarea[name]').each(function () {
                var translationKey = this.name, translationText = this.value;
                if (!translationKey || !translationText) {
                    return;
                }
                result[translationKey] = translationText;
            });
        })(this.jq);
        for (var i = 0, len = model.groups.length; i < len; i++) {
            for (var j = 0, n = model.groups[i].translations.length; j < n; j++) {
                var key = model.groups[i].translations[j].key, original = model.groups[i].translations[j].original;
                if (result[key] === original) {
                    delete result[key];
                }
            }
        }
        var enumeratedTranslations = this.loader.getEngine().getDocument().enumerateTranslations();
        for (var i = 0, len = enumeratedTranslations.length; i < len; i++) {
            if (enumeratedTranslations[i].syncWith) {
                if (result[enumeratedTranslations[i].syncWith]) {
                    result[enumeratedTranslations[i].key] = result[enumeratedTranslations[i].syncWith];
                }
            }
        }
        return result;
    };
    TranslationsEditor.prototype.fixTextInputHeights = function (body) {
        var self = this;
        (function ($) {
            $(body).find('table > tbody > tr').each(function () {
                var firstCellHeight = this.cells[0].offsetHeight;
                $(this).find('td:last-child > input').each(function (index, element) {
                    var name = $(element).attr('name'), value = self.decodeNewLine(($(element).val())), height = (firstCellHeight - 20) + "px";
                    $(element).replaceWith('<textarea class="translation-area" name="' + name + '" style="height:' + height + ';">' + value + '</textarea>');
                });
            });
        })(this.jq);
    };
    TranslationsEditor.prototype.exportTranslationsToCSVFile = function () {
        var _this = this;
        if (this.formTranslationsService.enumerateAvailableFormLanguages().length === 0) {
            this.ui.alert('Export failed', 'In order to export translations to a CSV file, please add at least one language!');
            return;
        }
        (function (ui, api) {
            api.GET('/v2/language/' + _this.loader.getFormId() + '/csv/' + _this.loader.getI18n().getLanguageCode())
                .then(function (csvFileContents) {
                FileUtils.download(String.fromCharCode(0xEF) + String.fromCharCode(0xBB) + String.fromCharCode(0xBF)
                    + window['unescape'](encodeURIComponent(csvFileContents)), 'form-' + _this.loader.getFormId() + '-translations.csv', 'application/octet-stream');
                CFTracker && CFTracker.event('translations_export_to_csv');
                console.log('tracker :: translations_export_to_csv');
            })
                .fail(function (e) {
                ui.alert('Export failed', 'Failed to export translations because of a server error. Please retry. If the problem persist, please contact our support team!');
            });
        })(this.ui, this.api);
    };
    TranslationsEditor.prototype.dispatchButtonClick = function (buttonRole) {
        switch (buttonRole) {
            case 'export-translations-to-csv':
                this.exportTranslationsToCSVFile();
                break;
            case 'copy-translations-from-form':
                this.importTranslationsFromAnotherForm();
                break;
            default:
                throw new Error('Failed to dispatch translations panel button click (command=' + JSON.stringify(buttonRole) + ')');
        }
    };
    TranslationsEditor.prototype.importTranslationsStart = function (selectFormDialog, selectedFormId) {
        var _this = this;
        selectFormDialog.hide();
        this.ui.prompt('Confirm Operation', 'Are you sure you want to override existing form translations with selected form translations?', function () {
            _this.api.POST('/v2/language/import/from-' + selectedFormId + '/to-' + _this.loader.getFormId())
                .then(function () {
                _this.ui.alert('Success', 'Translations were successfully imported', function () {
                    selectFormDialog.close();
                    _this.refreshFormLanguages();
                });
            })
                .fail(function () {
                _this.ui.alert('Error importing translations', 'There was a technical error importing form translations. Please retry. If the problem persist, contact our support team', function () {
                    selectFormDialog.show();
                });
            });
        }, function () {
            selectFormDialog.show();
        });
    };
    TranslationsEditor.prototype.importTranslationsFromAnotherForm = function () {
        var _this = this;
        this.resourceManager.get('/modules/Typescript/Form/resources/import-form-translations-dialog.html')
            .then(function (importFormTranslationsDialogMarkup) {
            var $ = _this.jq, dialog = _this.ui.createDialog('Import from another form', [
                {
                    type: EDialogButtonType.IMPORT,
                    callback: function () {
                        var formId = null;
                        $(dialog.body).find('table > tbody > tr[data-form-id].selected:visible').each(function () {
                            formId = ~~this.getAttribute('data-form-id');
                        });
                        if (null === formId) {
                            return;
                        }
                        _this.importTranslationsStart(dialog, formId);
                    },
                },
                {
                    type: EDialogButtonType.CANCEL,
                    callback: function () {
                        dialog.close();
                    },
                }
            ], {
                width: "464px",
                height: "500px",
            });
            dialog.dialog.setAttribute('data-dialog-role', 'import-form-translations');
            dialog.body.innerHTML = '<div data-role="loader">' +
                '<div data-role="loading-bar"></div>' +
                '<div data-role="loading-bar"></div>' +
                '<div data-role="loading-bar"></div>' +
                '</div>';
            _this.api.GET('/v2/language/translatedForms')
                .then(function (translatedForms) {
                var currentFormId = _this.loader.getFormId();
                var model = {
                    'forms': translatedForms.data.filter(function (translatedData) {
                        return translatedData && translatedData.formId !== currentFormId;
                    }),
                }, tpl = new Salvage(importFormTranslationsDialogMarkup);
                dialog.body.innerHTML = tpl.parse(model);
                _this.loader.getCommandDispatcher().addPerfectScrollbar($(dialog.body).find('[data-role=scrollable-body]').get(0));
            })
                .fail(function () {
                dialog.close();
                _this.ui.alert('Error loading data', 'Failed to fetch translated forms list from server');
            });
            var currentFilter = '', performFilteringThrottled = Throttle.create(function () {
                var filterText = String(currentFilter || '')
                    .toLowerCase()
                    .replace(/(^[\s]+|[\s]+$)/g, '')
                    .replace(/[\s]+/g, ' ');
                $(dialog.body).find('table > tbody > tr').each(function () {
                    if (!filterText) {
                        this.style.display = '';
                    }
                    else {
                        var rowText = this.cells[0].textContent.toLowerCase();
                        this.style.display = rowText.indexOf(filterText) > -1
                            ? ''
                            : 'none';
                    }
                });
            }, 100), performFiltering = function (text) {
                currentFilter = text;
                performFilteringThrottled();
            };
            $(dialog.body)
                .on('input, input.clear', '[name=filter]', function () {
                if (this.value) {
                    this.removeAttribute('empty');
                }
                else {
                    this.setAttribute('empty', '');
                }
                performFiltering(this.value);
            })
                .on('click', '[data-role=clear]', function () {
                $('[name=filter]').val('').attr('empty', '').focus().trigger('input.clear');
            })
                .on('click', 'tr[data-form-id]', function () {
                $(this).addClass('selected').siblings().removeClass('selected');
            });
        })
            .fail(function () {
            _this.ui.alert('Error loading component', 'Failed to load resource from server');
        });
    };
    TranslationsEditor.prototype.refreshFormLanguages = function () {
        var _this = this;
        this.api.GET('/v2/language/' + this.loader.getFormId()).then(function (availableFormLanguages) {
            _this.formTranslationsService.setAvailableFormLanguages(availableFormLanguages.data);
            _this.updateLanguagesList();
        });
    };
    TranslationsEditor.PAYMENT_TEXTDEF_IDS = [
        177, 178, 106, 7, 12, 13, 36, 37, 38, 39, 42, 60, 75, 79, 82, 84, 88, 95, 109, 110, 114, 115, 116, 117, 118,
        119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 137, 139, 145, 146, 147, 148, 149, 150, 151, 153, 154, 155,
        156, 157, 158, 159, 160, 161, 165, 256
    ];
    TranslationsEditor.SYSTEM_MESSAGES_TEXTDEF_IDS = [
        169, 175, 179, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 213, 214,
        219, 220, 221, 222, 223, 224, 225, 226, 227, 80, 81, 176, 8, 34, 85, 87, 97, 98, 102, 103, 104, 105, 108, 111,
        132, 136, 138, 162, 163, 208, 211, 212, 2, 3, 4, 5, 9, 10, 11, 14, 23, 32, 33, 35, 40, 43, 44, 45, 46, 47, 48,
        49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 67, 68, 70, 71, 72, 73, 76, 77, 83, 86, 89, 92, 93, 94, 96, 130, 131,
        133, 134, 144, 152, 170, 171, 172, 201, 243
    ];
    TranslationsEditor.EMAIL_NOTIFICATION_TEXTDEF_IDS = [
        206, 20, 91, 99, 100, 101, 107, 112, 113, 127, 140, 141, 142, 143, 135
    ];
    return TranslationsEditor;
}());
var CSVTranslationsReader = (function (_super) {
    __extends(CSVTranslationsReader, _super);
    function CSVTranslationsReader(ui) {
        var _this = _super.call(this) || this;
        _this.ui = ui;
        _this.rootNode = document.createElement('div');
        _this.rootNode.setAttribute('data-role', 'csv-translations-reader');
        _this.fileInput = document.createElement('input');
        _this.fileInput.setAttribute('type', 'file');
        _this.rootNode.appendChild(_this.fileInput);
        _this.caption = document.createElement('div');
        _this.caption.setAttribute('data-role', 'caption');
        _this.rootNode.appendChild(_this.caption);
        _this.initEvents();
        return _this;
    }
    CSVTranslationsReader.prototype.initEvents = function () {
        var _this = this;
        this.fileInput.addEventListener('change', function (e) {
            if (!_this.fileInput.files.length) {
                return;
            }
            _this.processFile(_this.fileInput.files[0]);
        }, true);
    };
    CSVTranslationsReader.prototype.getCaption = function () {
        return this.caption;
    };
    CSVTranslationsReader.prototype.setCaptionText = function (captionText) {
        this.caption.textContent = String(captionText || '');
        return this;
    };
    CSVTranslationsReader.prototype.processFile = function (file) {
        var _this = this;
        try {
            if (!file.size) {
                throw new Error('Empty file!');
            }
            if (!file.name) {
                throw new Error('Missing file name!');
            }
            if (!/\.csv$/i.test(file.name)) {
                throw new Error('Wrong file extension!');
            }
            var reader_1 = new FileReader();
            reader_1.onload = function (e) {
                var fileContents = e.target['result'];
                try {
                    _this.parseCSVFileContents(fileContents);
                }
                catch (e) {
                    _this.fileInput.value = null;
                    _this.parsedCSV = undefined;
                    _this.ui.alert('Error reading file', String(e).slice(7));
                }
                reader_1 = null;
                _this.fileInput.value = null;
            };
            reader_1.readAsText(file, 'UTF-8');
        }
        catch (e) {
            this.fileInput.value = null;
            this.parsedCSV = undefined;
            this.ui.alert('Error reading file', String(e).slice(7));
        }
    };
    CSVTranslationsReader.prototype.parseCSVFileContents = function (fileContents) {
        try {
            this.parsedCSV = this.runUnitTestsOnParsedCSVAndReturnParsedResultIfUnitTestsAreFine(CSVTranslationsReader.Papa.parse(fileContents, {
                escapeChar: "\\",
                skipEmptyLines: true,
            }).data);
            this.trigger('load');
        }
        catch (e) {
            this.parsedCSV = undefined;
            this.ui.alert('Error parsing CSV file', e.toString().slice(7));
        }
    };
    CSVTranslationsReader.prototype.isParsed = function () {
        return !!this.parsedCSV;
    };
    CSVTranslationsReader.prototype.runUnitTestsOnParsedCSVAndReturnParsedResultIfUnitTestsAreFine = function (csv) {
        if (!csv || !Array.isArray(csv)) {
            throw new Error('Failed to properly parse CSV file!');
        }
        var firstCSVRow = csv[0];
        if (firstCSVRow.length < 3) {
            throw new Error('Expected header length should be greater or equal with 3 columns');
        }
        if (firstCSVRow[0] !== 'Id') {
            throw new Error('First header column title should be "Id"');
        }
        if (firstCSVRow[1] !== 'Original') {
            throw new Error('Second header column title should be "Original"');
        }
        var headerLength = firstCSVRow.length;
        for (var i = 1, len = csv.length; i < len; i++) {
            if (!Array.isArray(csv[i])) {
                throw new Error('Array expected!');
            }
            if (csv[1].length < headerLength) {
                throw new Error('Bad csv. Expected number of columns to be at least ' + headerLength + ' at row ' + (i + 1));
            }
            for (var j = 0, n = csv[i].length; j < n; j++) {
                csv[i][j] = csv[i][j].replace(/\\([nrt])/g, function (search) {
                    var matches = [];
                    for (var _i = 1; _i < arguments.length; _i++) {
                        matches[_i - 1] = arguments[_i];
                    }
                    switch (matches[0]) {
                        case "n":
                            return "\n";
                        case "r":
                            return "\r";
                        case "t":
                            return "\t";
                        default:
                            return "";
                    }
                });
            }
        }
        return csv;
    };
    CSVTranslationsReader.prototype.getLanguageColumnIndex = function (languageName) {
        if (!this.isParsed()) {
            return null;
        }
        for (var i = 2, len = this.parsedCSV[0].length; i < len; i++) {
            if (this.parsedCSV[0][i] === languageName) {
                return i;
            }
        }
        return null;
    };
    CSVTranslationsReader.prototype.getCSVLanguages = function () {
        if (!this.isParsed()) {
            return null;
        }
        var result = [];
        for (var i = 2, len = this.parsedCSV[0].length; i < len; i++) {
            result.push(this.parsedCSV[0][i]);
        }
        return result.length
            ? result
            : null;
    };
    CSVTranslationsReader.prototype.getLanguagePack = function (languageName) {
        var result = {};
        var languageIndex = this.getLanguageColumnIndex(languageName);
        if (null === languageIndex) {
            return null;
        }
        for (var i = 1, len = this.parsedCSV.length; i < len; i++) {
            var originalText = this.parsedCSV[i][1], textKey = this.parsedCSV[i][0], translatedText = this.parsedCSV[i][languageIndex];
            if (translatedText && translatedText !== originalText) {
                result[textKey] = translatedText;
            }
        }
        return result;
    };
    CSVTranslationsReader.prototype.getTranslatedTextByOriginalText = function (originalSourceText, languageName) {
        var languageIndex = this.getLanguageColumnIndex(languageName);
        if (null === languageIndex) {
            return null;
        }
        for (var i = 1, len = this.parsedCSV.length; i < len; i++) {
            var originalText = this.parsedCSV[i][1], translatedText = this.parsedCSV[i][languageIndex];
            if (originalText === originalSourceText) {
                return translatedText;
            }
        }
        return null;
    };
    CSVTranslationsReader.prototype.getRootDOMNode = function () {
        return this.rootNode;
    };
    return CSVTranslationsReader;
}(EventEmitter));
eval(atob('LyohDQoJUGFwYSBQYXJzZQ0KCXY0LjMuNw0KCWh0dHBzOi8vZ2l0aHViLmNvbS9taG9sdC9QYXBhUGFyc2UNCglMaWNlbnNlOiBNSVQNCiovDQohZnVuY3Rpb24oYSxiKXsiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbXSxiKToib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmInVuZGVmaW5lZCIhPXR5cGVvZiBleHBvcnRzP21vZHVsZS5leHBvcnRzPWIoKTphLlBhcGE9YigpfSh0aGlzLGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGEoYSxiKXtiPWJ8fHt9O3ZhciBjPWIuZHluYW1pY1R5cGluZ3x8ITE7aWYocihjKSYmKGIuZHluYW1pY1R5cGluZ0Z1bmN0aW9uPWMsYz17fSksYi5keW5hbWljVHlwaW5nPWMsYi53b3JrZXImJnouV09SS0VSU19TVVBQT1JURUQpe3ZhciBoPWsoKTtyZXR1cm4gaC51c2VyU3RlcD1iLnN0ZXAsaC51c2VyQ2h1bms9Yi5jaHVuayxoLnVzZXJDb21wbGV0ZT1iLmNvbXBsZXRlLGgudXNlckVycm9yPWIuZXJyb3IsYi5zdGVwPXIoYi5zdGVwKSxiLmNodW5rPXIoYi5jaHVuayksYi5jb21wbGV0ZT1yKGIuY29tcGxldGUpLGIuZXJyb3I9cihiLmVycm9yKSxkZWxldGUgYi53b3JrZXIsdm9pZCBoLnBvc3RNZXNzYWdlKHtpbnB1dDphLGNvbmZpZzpiLHdvcmtlcklkOmguaWR9KX12YXIgaT1udWxsO3JldHVybiJzdHJpbmciPT10eXBlb2YgYT9pPWIuZG93bmxvYWQ/bmV3IGQoYik6bmV3IGYoYik6YS5yZWFkYWJsZT09PSEwJiZyKGEucmVhZCkmJnIoYS5vbik/aT1uZXcgZyhiKToodC5GaWxlJiZhIGluc3RhbmNlb2YgRmlsZXx8YSBpbnN0YW5jZW9mIE9iamVjdCkmJihpPW5ldyBlKGIpKSxpLnN0cmVhbShhKX1mdW5jdGlvbiBiKGEsYil7ZnVuY3Rpb24gYygpeyJvYmplY3QiPT10eXBlb2YgYiYmKCJzdHJpbmciPT10eXBlb2YgYi5kZWxpbWl0ZXImJjE9PT1iLmRlbGltaXRlci5sZW5ndGgmJnouQkFEX0RFTElNSVRFUlMuaW5kZXhPZihiLmRlbGltaXRlcik9PT0tMSYmKGo9Yi5kZWxpbWl0ZXIpLCgiYm9vbGVhbiI9PXR5cGVvZiBiLnF1b3Rlc3x8Yi5xdW90ZXMgaW5zdGFuY2VvZiBBcnJheSkmJihoPWIucXVvdGVzKSwic3RyaW5nIj09dHlwZW9mIGIubmV3bGluZSYmKGs9Yi5uZXdsaW5lKSwic3RyaW5nIj09dHlwZW9mIGIucXVvdGVDaGFyJiYobD1iLnF1b3RlQ2hhciksImJvb2xlYW4iPT10eXBlb2YgYi5oZWFkZXImJihpPWIuaGVhZGVyKSl9ZnVuY3Rpb24gZChhKXtpZigib2JqZWN0IiE9dHlwZW9mIGEpcmV0dXJuW107dmFyIGI9W107Zm9yKHZhciBjIGluIGEpYi5wdXNoKGMpO3JldHVybiBifWZ1bmN0aW9uIGUoYSxiKXt2YXIgYz0iIjsic3RyaW5nIj09dHlwZW9mIGEmJihhPUpTT04ucGFyc2UoYSkpLCJzdHJpbmciPT10eXBlb2YgYiYmKGI9SlNPTi5wYXJzZShiKSk7dmFyIGQ9YSBpbnN0YW5jZW9mIEFycmF5JiZhLmxlbmd0aD4wLGU9IShiWzBdaW5zdGFuY2VvZiBBcnJheSk7aWYoZCYmaSl7Zm9yKHZhciBnPTA7ZzxhLmxlbmd0aDtnKyspZz4wJiYoYys9aiksYys9ZihhW2ddLGcpO2IubGVuZ3RoPjAmJihjKz1rKX1mb3IodmFyIGg9MDtoPGIubGVuZ3RoO2grKyl7Zm9yKHZhciBsPWQ/YS5sZW5ndGg6YltoXS5sZW5ndGgsbT0wO208bDttKyspe20+MCYmKGMrPWopO3ZhciBuPWQmJmU/YVttXTptO2MrPWYoYltoXVtuXSxtKX1oPGIubGVuZ3RoLTEmJihjKz1rKX1yZXR1cm4gY31mdW5jdGlvbiBmKGEsYil7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBhfHxudWxsPT09YSlyZXR1cm4iIjthPWEudG9TdHJpbmcoKS5yZXBsYWNlKG0sbCtsKTt2YXIgYz0iYm9vbGVhbiI9PXR5cGVvZiBoJiZofHxoIGluc3RhbmNlb2YgQXJyYXkmJmhbYl18fGcoYSx6LkJBRF9ERUxJTUlURVJTKXx8YS5pbmRleE9mKGopPi0xfHwiICI9PT1hLmNoYXJBdCgwKXx8IiAiPT09YS5jaGFyQXQoYS5sZW5ndGgtMSk7cmV0dXJuIGM/bCthK2w6YX1mdW5jdGlvbiBnKGEsYil7Zm9yKHZhciBjPTA7YzxiLmxlbmd0aDtjKyspaWYoYS5pbmRleE9mKGJbY10pPi0xKXJldHVybiEwO3JldHVybiExfXZhciBoPSExLGk9ITAsaj0iLCIsaz0iXHJcbiIsbD0nIic7YygpO3ZhciBtPW5ldyBSZWdFeHAobCwiZyIpO2lmKCJzdHJpbmciPT10eXBlb2YgYSYmKGE9SlNPTi5wYXJzZShhKSksYSBpbnN0YW5jZW9mIEFycmF5KXtpZighYS5sZW5ndGh8fGFbMF1pbnN0YW5jZW9mIEFycmF5KXJldHVybiBlKG51bGwsYSk7aWYoIm9iamVjdCI9PXR5cGVvZiBhWzBdKXJldHVybiBlKGQoYVswXSksYSl9ZWxzZSBpZigib2JqZWN0Ij09dHlwZW9mIGEpcmV0dXJuInN0cmluZyI9PXR5cGVvZiBhLmRhdGEmJihhLmRhdGE9SlNPTi5wYXJzZShhLmRhdGEpKSxhLmRhdGEgaW5zdGFuY2VvZiBBcnJheSYmKGEuZmllbGRzfHwoYS5maWVsZHM9YS5tZXRhJiZhLm1ldGEuZmllbGRzKSxhLmZpZWxkc3x8KGEuZmllbGRzPWEuZGF0YVswXWluc3RhbmNlb2YgQXJyYXk/YS5maWVsZHM6ZChhLmRhdGFbMF0pKSxhLmRhdGFbMF1pbnN0YW5jZW9mIEFycmF5fHwib2JqZWN0Ij09dHlwZW9mIGEuZGF0YVswXXx8KGEuZGF0YT1bYS5kYXRhXSkpLGUoYS5maWVsZHN8fFtdLGEuZGF0YXx8W10pO3Rocm93ImV4Y2VwdGlvbjogVW5hYmxlIHRvIHNlcmlhbGl6ZSB1bnJlY29nbml6ZWQgaW5wdXQifWZ1bmN0aW9uIGMoYSl7ZnVuY3Rpb24gYihhKXt2YXIgYj1wKGEpO2IuY2h1bmtTaXplPXBhcnNlSW50KGIuY2h1bmtTaXplKSxhLnN0ZXB8fGEuY2h1bmt8fChiLmNodW5rU2l6ZT1udWxsKSx0aGlzLl9oYW5kbGU9bmV3IGgoYiksdGhpcy5faGFuZGxlLnN0cmVhbWVyPXRoaXMsdGhpcy5fY29uZmlnPWJ9dGhpcy5faGFuZGxlPW51bGwsdGhpcy5fcGF1c2VkPSExLHRoaXMuX2ZpbmlzaGVkPSExLHRoaXMuX2lucHV0PW51bGwsdGhpcy5fYmFzZUluZGV4PTAsdGhpcy5fcGFydGlhbExpbmU9IiIsdGhpcy5fcm93Q291bnQ9MCx0aGlzLl9zdGFydD0wLHRoaXMuX25leHRDaHVuaz1udWxsLHRoaXMuaXNGaXJzdENodW5rPSEwLHRoaXMuX2NvbXBsZXRlUmVzdWx0cz17ZGF0YTpbXSxlcnJvcnM6W10sbWV0YTp7fX0sYi5jYWxsKHRoaXMsYSksdGhpcy5wYXJzZUNodW5rPWZ1bmN0aW9uKGEpe2lmKHRoaXMuaXNGaXJzdENodW5rJiZyKHRoaXMuX2NvbmZpZy5iZWZvcmVGaXJzdENodW5rKSl7dmFyIGI9dGhpcy5fY29uZmlnLmJlZm9yZUZpcnN0Q2h1bmsoYSk7dm9pZCAwIT09YiYmKGE9Yil9dGhpcy5pc0ZpcnN0Q2h1bms9ITE7dmFyIGM9dGhpcy5fcGFydGlhbExpbmUrYTt0aGlzLl9wYXJ0aWFsTGluZT0iIjt2YXIgZD10aGlzLl9oYW5kbGUucGFyc2UoYyx0aGlzLl9iYXNlSW5kZXgsIXRoaXMuX2ZpbmlzaGVkKTtpZighdGhpcy5faGFuZGxlLnBhdXNlZCgpJiYhdGhpcy5faGFuZGxlLmFib3J0ZWQoKSl7dmFyIGU9ZC5tZXRhLmN1cnNvcjt0aGlzLl9maW5pc2hlZHx8KHRoaXMuX3BhcnRpYWxMaW5lPWMuc3Vic3RyaW5nKGUtdGhpcy5fYmFzZUluZGV4KSx0aGlzLl9iYXNlSW5kZXg9ZSksZCYmZC5kYXRhJiYodGhpcy5fcm93Q291bnQrPWQuZGF0YS5sZW5ndGgpO3ZhciBmPXRoaXMuX2ZpbmlzaGVkfHx0aGlzLl9jb25maWcucHJldmlldyYmdGhpcy5fcm93Q291bnQ+PXRoaXMuX2NvbmZpZy5wcmV2aWV3O2lmKHYpdC5wb3N0TWVzc2FnZSh7cmVzdWx0czpkLHdvcmtlcklkOnouV09SS0VSX0lELGZpbmlzaGVkOmZ9KTtlbHNlIGlmKHIodGhpcy5fY29uZmlnLmNodW5rKSl7aWYodGhpcy5fY29uZmlnLmNodW5rKGQsdGhpcy5faGFuZGxlKSx0aGlzLl9wYXVzZWQpcmV0dXJuO2Q9dm9pZCAwLHRoaXMuX2NvbXBsZXRlUmVzdWx0cz12b2lkIDB9cmV0dXJuIHRoaXMuX2NvbmZpZy5zdGVwfHx0aGlzLl9jb25maWcuY2h1bmt8fCh0aGlzLl9jb21wbGV0ZVJlc3VsdHMuZGF0YT10aGlzLl9jb21wbGV0ZVJlc3VsdHMuZGF0YS5jb25jYXQoZC5kYXRhKSx0aGlzLl9jb21wbGV0ZVJlc3VsdHMuZXJyb3JzPXRoaXMuX2NvbXBsZXRlUmVzdWx0cy5lcnJvcnMuY29uY2F0KGQuZXJyb3JzKSx0aGlzLl9jb21wbGV0ZVJlc3VsdHMubWV0YT1kLm1ldGEpLCFmfHwhcih0aGlzLl9jb25maWcuY29tcGxldGUpfHxkJiZkLm1ldGEuYWJvcnRlZHx8dGhpcy5fY29uZmlnLmNvbXBsZXRlKHRoaXMuX2NvbXBsZXRlUmVzdWx0cyx0aGlzLl9pbnB1dCksZnx8ZCYmZC5tZXRhLnBhdXNlZHx8dGhpcy5fbmV4dENodW5rKCksZH19LHRoaXMuX3NlbmRFcnJvcj1mdW5jdGlvbihhKXtyKHRoaXMuX2NvbmZpZy5lcnJvcik/dGhpcy5fY29uZmlnLmVycm9yKGEpOnYmJnRoaXMuX2NvbmZpZy5lcnJvciYmdC5wb3N0TWVzc2FnZSh7d29ya2VySWQ6ei5XT1JLRVJfSUQsZXJyb3I6YSxmaW5pc2hlZDohMX0pfX1mdW5jdGlvbiBkKGEpe2Z1bmN0aW9uIGIoYSl7dmFyIGI9YS5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1SYW5nZSIpO3JldHVybiBudWxsPT09Yj8tMTpwYXJzZUludChiLnN1YnN0cihiLmxhc3RJbmRleE9mKCIvIikrMSkpfWE9YXx8e30sYS5jaHVua1NpemV8fChhLmNodW5rU2l6ZT16LlJlbW90ZUNodW5rU2l6ZSksYy5jYWxsKHRoaXMsYSk7dmFyIGQ7dT90aGlzLl9uZXh0Q2h1bms9ZnVuY3Rpb24oKXt0aGlzLl9yZWFkQ2h1bmsoKSx0aGlzLl9jaHVua0xvYWRlZCgpfTp0aGlzLl9uZXh0Q2h1bms9ZnVuY3Rpb24oKXt0aGlzLl9yZWFkQ2h1bmsoKX0sdGhpcy5zdHJlYW09ZnVuY3Rpb24oYSl7dGhpcy5faW5wdXQ9YSx0aGlzLl9uZXh0Q2h1bmsoKX0sdGhpcy5fcmVhZENodW5rPWZ1bmN0aW9uKCl7aWYodGhpcy5fZmluaXNoZWQpcmV0dXJuIHZvaWQgdGhpcy5fY2h1bmtMb2FkZWQoKTtpZihkPW5ldyBYTUxIdHRwUmVxdWVzdCx0aGlzLl9jb25maWcud2l0aENyZWRlbnRpYWxzJiYoZC53aXRoQ3JlZGVudGlhbHM9dGhpcy5fY29uZmlnLndpdGhDcmVkZW50aWFscyksdXx8KGQub25sb2FkPXEodGhpcy5fY2h1bmtMb2FkZWQsdGhpcyksZC5vbmVycm9yPXEodGhpcy5fY2h1bmtFcnJvcix0aGlzKSksZC5vcGVuKCJHRVQiLHRoaXMuX2lucHV0LCF1KSx0aGlzLl9jb25maWcuZG93bmxvYWRSZXF1ZXN0SGVhZGVycyl7dmFyIGE9dGhpcy5fY29uZmlnLmRvd25sb2FkUmVxdWVzdEhlYWRlcnM7Zm9yKHZhciBiIGluIGEpZC5zZXRSZXF1ZXN0SGVhZGVyKGIsYVtiXSl9aWYodGhpcy5fY29uZmlnLmNodW5rU2l6ZSl7dmFyIGM9dGhpcy5fc3RhcnQrdGhpcy5fY29uZmlnLmNodW5rU2l6ZS0xO2Quc2V0UmVxdWVzdEhlYWRlcigiUmFuZ2UiLCJieXRlcz0iK3RoaXMuX3N0YXJ0KyItIitjKSxkLnNldFJlcXVlc3RIZWFkZXIoIklmLU5vbmUtTWF0Y2giLCJ3ZWJraXQtbm8tY2FjaGUiKX10cnl7ZC5zZW5kKCl9Y2F0Y2goYSl7dGhpcy5fY2h1bmtFcnJvcihhLm1lc3NhZ2UpfXUmJjA9PT1kLnN0YXR1cz90aGlzLl9jaHVua0Vycm9yKCk6dGhpcy5fc3RhcnQrPXRoaXMuX2NvbmZpZy5jaHVua1NpemV9LHRoaXMuX2NodW5rTG9hZGVkPWZ1bmN0aW9uKCl7aWYoND09ZC5yZWFkeVN0YXRlKXtpZihkLnN0YXR1czwyMDB8fGQuc3RhdHVzPj00MDApcmV0dXJuIHZvaWQgdGhpcy5fY2h1bmtFcnJvcigpO3RoaXMuX2ZpbmlzaGVkPSF0aGlzLl9jb25maWcuY2h1bmtTaXplfHx0aGlzLl9zdGFydD5iKGQpLHRoaXMucGFyc2VDaHVuayhkLnJlc3BvbnNlVGV4dCl9fSx0aGlzLl9jaHVua0Vycm9yPWZ1bmN0aW9uKGEpe3ZhciBiPWQuc3RhdHVzVGV4dHx8YTt0aGlzLl9zZW5kRXJyb3IoYil9fWZ1bmN0aW9uIGUoYSl7YT1hfHx7fSxhLmNodW5rU2l6ZXx8KGEuY2h1bmtTaXplPXouTG9jYWxDaHVua1NpemUpLGMuY2FsbCh0aGlzLGEpO3ZhciBiLGQsZT0idW5kZWZpbmVkIiE9dHlwZW9mIEZpbGVSZWFkZXI7dGhpcy5zdHJlYW09ZnVuY3Rpb24oYSl7dGhpcy5faW5wdXQ9YSxkPWEuc2xpY2V8fGEud2Via2l0U2xpY2V8fGEubW96U2xpY2UsZT8oYj1uZXcgRmlsZVJlYWRlcixiLm9ubG9hZD1xKHRoaXMuX2NodW5rTG9hZGVkLHRoaXMpLGIub25lcnJvcj1xKHRoaXMuX2NodW5rRXJyb3IsdGhpcykpOmI9bmV3IEZpbGVSZWFkZXJTeW5jLHRoaXMuX25leHRDaHVuaygpfSx0aGlzLl9uZXh0Q2h1bms9ZnVuY3Rpb24oKXt0aGlzLl9maW5pc2hlZHx8dGhpcy5fY29uZmlnLnByZXZpZXcmJiEodGhpcy5fcm93Q291bnQ8dGhpcy5fY29uZmlnLnByZXZpZXcpfHx0aGlzLl9yZWFkQ2h1bmsoKX0sdGhpcy5fcmVhZENodW5rPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5faW5wdXQ7aWYodGhpcy5fY29uZmlnLmNodW5rU2l6ZSl7dmFyIGM9TWF0aC5taW4odGhpcy5fc3RhcnQrdGhpcy5fY29uZmlnLmNodW5rU2l6ZSx0aGlzLl9pbnB1dC5zaXplKTthPWQuY2FsbChhLHRoaXMuX3N0YXJ0LGMpfXZhciBmPWIucmVhZEFzVGV4dChhLHRoaXMuX2NvbmZpZy5lbmNvZGluZyk7ZXx8dGhpcy5fY2h1bmtMb2FkZWQoe3RhcmdldDp7cmVzdWx0OmZ9fSl9LHRoaXMuX2NodW5rTG9hZGVkPWZ1bmN0aW9uKGEpe3RoaXMuX3N0YXJ0Kz10aGlzLl9jb25maWcuY2h1bmtTaXplLHRoaXMuX2ZpbmlzaGVkPSF0aGlzLl9jb25maWcuY2h1bmtTaXplfHx0aGlzLl9zdGFydD49dGhpcy5faW5wdXQuc2l6ZSx0aGlzLnBhcnNlQ2h1bmsoYS50YXJnZXQucmVzdWx0KX0sdGhpcy5fY2h1bmtFcnJvcj1mdW5jdGlvbigpe3RoaXMuX3NlbmRFcnJvcihiLmVycm9yLm1lc3NhZ2UpfX1mdW5jdGlvbiBmKGEpe2E9YXx8e30sYy5jYWxsKHRoaXMsYSk7dmFyIGIsZDt0aGlzLnN0cmVhbT1mdW5jdGlvbihhKXtyZXR1cm4gYj1hLGQ9YSx0aGlzLl9uZXh0Q2h1bmsoKX0sdGhpcy5fbmV4dENodW5rPWZ1bmN0aW9uKCl7aWYoIXRoaXMuX2ZpbmlzaGVkKXt2YXIgYT10aGlzLl9jb25maWcuY2h1bmtTaXplLGI9YT9kLnN1YnN0cigwLGEpOmQ7cmV0dXJuIGQ9YT9kLnN1YnN0cihhKToiIix0aGlzLl9maW5pc2hlZD0hZCx0aGlzLnBhcnNlQ2h1bmsoYil9fX1mdW5jdGlvbiBnKGEpe2E9YXx8e30sYy5jYWxsKHRoaXMsYSk7dmFyIGI9W10sZD0hMDt0aGlzLnN0cmVhbT1mdW5jdGlvbihhKXt0aGlzLl9pbnB1dD1hLHRoaXMuX2lucHV0Lm9uKCJkYXRhIix0aGlzLl9zdHJlYW1EYXRhKSx0aGlzLl9pbnB1dC5vbigiZW5kIix0aGlzLl9zdHJlYW1FbmQpLHRoaXMuX2lucHV0Lm9uKCJlcnJvciIsdGhpcy5fc3RyZWFtRXJyb3IpfSx0aGlzLl9uZXh0Q2h1bms9ZnVuY3Rpb24oKXtiLmxlbmd0aD90aGlzLnBhcnNlQ2h1bmsoYi5zaGlmdCgpKTpkPSEwfSx0aGlzLl9zdHJlYW1EYXRhPXEoZnVuY3Rpb24oYSl7dHJ5e2IucHVzaCgic3RyaW5nIj09dHlwZW9mIGE/YTphLnRvU3RyaW5nKHRoaXMuX2NvbmZpZy5lbmNvZGluZykpLGQmJihkPSExLHRoaXMucGFyc2VDaHVuayhiLnNoaWZ0KCkpKX1jYXRjaChhKXt0aGlzLl9zdHJlYW1FcnJvcihhKX19LHRoaXMpLHRoaXMuX3N0cmVhbUVycm9yPXEoZnVuY3Rpb24oYSl7dGhpcy5fc3RyZWFtQ2xlYW5VcCgpLHRoaXMuX3NlbmRFcnJvcihhLm1lc3NhZ2UpfSx0aGlzKSx0aGlzLl9zdHJlYW1FbmQ9cShmdW5jdGlvbigpe3RoaXMuX3N0cmVhbUNsZWFuVXAoKSx0aGlzLl9maW5pc2hlZD0hMCx0aGlzLl9zdHJlYW1EYXRhKCIiKX0sdGhpcyksdGhpcy5fc3RyZWFtQ2xlYW5VcD1xKGZ1bmN0aW9uKCl7dGhpcy5faW5wdXQucmVtb3ZlTGlzdGVuZXIoImRhdGEiLHRoaXMuX3N0cmVhbURhdGEpLHRoaXMuX2lucHV0LnJlbW92ZUxpc3RlbmVyKCJlbmQiLHRoaXMuX3N0cmVhbUVuZCksdGhpcy5faW5wdXQucmVtb3ZlTGlzdGVuZXIoImVycm9yIix0aGlzLl9zdHJlYW1FcnJvcil9LHRoaXMpfWZ1bmN0aW9uIGgoYSl7ZnVuY3Rpb24gYigpe2lmKHgmJm8mJihsKCJEZWxpbWl0ZXIiLCJVbmRldGVjdGFibGVEZWxpbWl0ZXIiLCJVbmFibGUgdG8gYXV0by1kZXRlY3QgZGVsaW1pdGluZyBjaGFyYWN0ZXI7IGRlZmF1bHRlZCB0byAnIit6LkRlZmF1bHREZWxpbWl0ZXIrIiciKSxvPSExKSxhLnNraXBFbXB0eUxpbmVzKWZvcih2YXIgYj0wO2I8eC5kYXRhLmxlbmd0aDtiKyspMT09PXguZGF0YVtiXS5sZW5ndGgmJiIiPT09eC5kYXRhW2JdWzBdJiZ4LmRhdGEuc3BsaWNlKGItLSwxKTtyZXR1cm4gYygpJiZkKCksZygpfWZ1bmN0aW9uIGMoKXtyZXR1cm4gYS5oZWFkZXImJjA9PT13Lmxlbmd0aH1mdW5jdGlvbiBkKCl7aWYoeCl7Zm9yKHZhciBhPTA7YygpJiZhPHguZGF0YS5sZW5ndGg7YSsrKWZvcih2YXIgYj0wO2I8eC5kYXRhW2FdLmxlbmd0aDtiKyspdy5wdXNoKHguZGF0YVthXVtiXSk7eC5kYXRhLnNwbGljZSgwLDEpfX1mdW5jdGlvbiBlKGIpe3JldHVybiBhLmR5bmFtaWNUeXBpbmdGdW5jdGlvbiYmdm9pZCAwPT09YS5keW5hbWljVHlwaW5nW2JdJiYoYS5keW5hbWljVHlwaW5nW2JdPWEuZHluYW1pY1R5cGluZ0Z1bmN0aW9uKGIpKSwoYS5keW5hbWljVHlwaW5nW2JdfHxhLmR5bmFtaWNUeXBpbmcpPT09ITB9ZnVuY3Rpb24gZihhLGIpe3JldHVybiBlKGEpPyJ0cnVlIj09PWJ8fCJUUlVFIj09PWJ8fCJmYWxzZSIhPT1iJiYiRkFMU0UiIT09YiYmayhiKTpifWZ1bmN0aW9uIGcoKXtpZigheHx8IWEuaGVhZGVyJiYhYS5keW5hbWljVHlwaW5nKXJldHVybiB4O2Zvcih2YXIgYj0wO2I8eC5kYXRhLmxlbmd0aDtiKyspe2Zvcih2YXIgYz1hLmhlYWRlcj97fTpbXSxkPTA7ZDx4LmRhdGFbYl0ubGVuZ3RoO2QrKyl7dmFyIGU9ZCxnPXguZGF0YVtiXVtkXTthLmhlYWRlciYmKGU9ZD49dy5sZW5ndGg/Il9fcGFyc2VkX2V4dHJhIjp3W2RdKSxnPWYoZSxnKSwiX19wYXJzZWRfZXh0cmEiPT09ZT8oY1tlXT1jW2VdfHxbXSxjW2VdLnB1c2goZykpOmNbZV09Z314LmRhdGFbYl09YyxhLmhlYWRlciYmKGQ+dy5sZW5ndGg/bCgiRmllbGRNaXNtYXRjaCIsIlRvb01hbnlGaWVsZHMiLCJUb28gbWFueSBmaWVsZHM6IGV4cGVjdGVkICIrdy5sZW5ndGgrIiBmaWVsZHMgYnV0IHBhcnNlZCAiK2QsYik6ZDx3Lmxlbmd0aCYmbCgiRmllbGRNaXNtYXRjaCIsIlRvb0Zld0ZpZWxkcyIsIlRvbyBmZXcgZmllbGRzOiBleHBlY3RlZCAiK3cubGVuZ3RoKyIgZmllbGRzIGJ1dCBwYXJzZWQgIitkLGIpKX1yZXR1cm4gYS5oZWFkZXImJngubWV0YSYmKHgubWV0YS5maWVsZHM9dykseH1mdW5jdGlvbiBoKGIsYyxkKXtmb3IodmFyIGUsZixnLGg9WyIsIiwiXHQiLCJ8IiwiOyIsei5SRUNPUkRfU0VQLHouVU5JVF9TRVBdLGo9MDtqPGgubGVuZ3RoO2orKyl7dmFyIGs9aFtqXSxsPTAsbT0wLG49MDtnPXZvaWQgMDtmb3IodmFyIG89bmV3IGkoe2RlbGltaXRlcjprLG5ld2xpbmU6YyxwcmV2aWV3OjEwfSkucGFyc2UoYikscD0wO3A8by5kYXRhLmxlbmd0aDtwKyspaWYoZCYmMT09PW8uZGF0YVtwXS5sZW5ndGgmJjA9PT1vLmRhdGFbcF1bMF0ubGVuZ3RoKW4rKztlbHNle3ZhciBxPW8uZGF0YVtwXS5sZW5ndGg7bSs9cSwidW5kZWZpbmVkIiE9dHlwZW9mIGc/cT4xJiYobCs9TWF0aC5hYnMocS1nKSxnPXEpOmc9cX1vLmRhdGEubGVuZ3RoPjAmJihtLz1vLmRhdGEubGVuZ3RoLW4pLCgidW5kZWZpbmVkIj09dHlwZW9mIGZ8fGw8ZikmJm0+MS45OSYmKGY9bCxlPWspfXJldHVybiBhLmRlbGltaXRlcj1lLHtzdWNjZXNzZnVsOiEhZSxiZXN0RGVsaW1pdGVyOmV9fWZ1bmN0aW9uIGooYSl7YT1hLnN1YnN0cigwLDEwNDg1NzYpO3ZhciBiPWEuc3BsaXQoIlxyIiksYz1hLnNwbGl0KCJcbiIpLGQ9Yy5sZW5ndGg+MSYmY1swXS5sZW5ndGg8YlswXS5sZW5ndGg7aWYoMT09PWIubGVuZ3RofHxkKXJldHVybiJcbiI7Zm9yKHZhciBlPTAsZj0wO2Y8Yi5sZW5ndGg7ZisrKSJcbiI9PT1iW2ZdWzBdJiZlKys7cmV0dXJuIGU+PWIubGVuZ3RoLzI/IlxyXG4iOiJcciJ9ZnVuY3Rpb24gayhhKXt2YXIgYj1xLnRlc3QoYSk7cmV0dXJuIGI/cGFyc2VGbG9hdChhKTphfWZ1bmN0aW9uIGwoYSxiLGMsZCl7eC5lcnJvcnMucHVzaCh7dHlwZTphLGNvZGU6YixtZXNzYWdlOmMscm93OmR9KX12YXIgbSxuLG8scT0vXlxzKi0/KFxkKlwuP1xkK3xcZCtcLj9cZCopKGVbLStdP1xkKyk/XHMqJC9pLHM9dGhpcyx0PTAsdT0hMSx2PSExLHc9W10seD17ZGF0YTpbXSxlcnJvcnM6W10sbWV0YTp7fX07aWYocihhLnN0ZXApKXt2YXIgeT1hLnN0ZXA7YS5zdGVwPWZ1bmN0aW9uKGQpe2lmKHg9ZCxjKCkpYigpO2Vsc2V7aWYoYigpLDA9PT14LmRhdGEubGVuZ3RoKXJldHVybjt0Kz1kLmRhdGEubGVuZ3RoLGEucHJldmlldyYmdD5hLnByZXZpZXc/bi5hYm9ydCgpOnkoeCxzKX19fXRoaXMucGFyc2U9ZnVuY3Rpb24oYyxkLGUpe2lmKGEubmV3bGluZXx8KGEubmV3bGluZT1qKGMpKSxvPSExLGEuZGVsaW1pdGVyKXIoYS5kZWxpbWl0ZXIpJiYoYS5kZWxpbWl0ZXI9YS5kZWxpbWl0ZXIoYykseC5tZXRhLmRlbGltaXRlcj1hLmRlbGltaXRlcik7ZWxzZXt2YXIgZj1oKGMsYS5uZXdsaW5lLGEuc2tpcEVtcHR5TGluZXMpO2Yuc3VjY2Vzc2Z1bD9hLmRlbGltaXRlcj1mLmJlc3REZWxpbWl0ZXI6KG89ITAsYS5kZWxpbWl0ZXI9ei5EZWZhdWx0RGVsaW1pdGVyKSx4Lm1ldGEuZGVsaW1pdGVyPWEuZGVsaW1pdGVyfXZhciBnPXAoYSk7cmV0dXJuIGEucHJldmlldyYmYS5oZWFkZXImJmcucHJldmlldysrLG09YyxuPW5ldyBpKGcpLHg9bi5wYXJzZShtLGQsZSksYigpLHU/e21ldGE6e3BhdXNlZDohMH19Onh8fHttZXRhOntwYXVzZWQ6ITF9fX0sdGhpcy5wYXVzZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gdX0sdGhpcy5wYXVzZT1mdW5jdGlvbigpe3U9ITAsbi5hYm9ydCgpLG09bS5zdWJzdHIobi5nZXRDaGFySW5kZXgoKSl9LHRoaXMucmVzdW1lPWZ1bmN0aW9uKCl7dT0hMSxzLnN0cmVhbWVyLnBhcnNlQ2h1bmsobSl9LHRoaXMuYWJvcnRlZD1mdW5jdGlvbigpe3JldHVybiB2fSx0aGlzLmFib3J0PWZ1bmN0aW9uKCl7dj0hMCxuLmFib3J0KCkseC5tZXRhLmFib3J0ZWQ9ITAscihhLmNvbXBsZXRlKSYmYS5jb21wbGV0ZSh4KSxtPSIifX1mdW5jdGlvbiBpKGEpe2E9YXx8e307dmFyIGI9YS5kZWxpbWl0ZXIsYz1hLm5ld2xpbmUsZD1hLmNvbW1lbnRzLGU9YS5zdGVwLGY9YS5wcmV2aWV3LGc9YS5mYXN0TW9kZTtpZih2b2lkIDA9PT1hLnF1b3RlQ2hhcil2YXIgaD0nIic7ZWxzZSB2YXIgaD1hLnF1b3RlQ2hhcjtpZigoInN0cmluZyIhPXR5cGVvZiBifHx6LkJBRF9ERUxJTUlURVJTLmluZGV4T2YoYik+LTEpJiYoYj0iLCIpLGQ9PT1iKXRocm93IkNvbW1lbnQgY2hhcmFjdGVyIHNhbWUgYXMgZGVsaW1pdGVyIjtkPT09ITA/ZD0iIyI6KCJzdHJpbmciIT10eXBlb2YgZHx8ei5CQURfREVMSU1JVEVSUy5pbmRleE9mKGQpPi0xKSYmKGQ9ITEpLCJcbiIhPWMmJiJcciIhPWMmJiJcclxuIiE9YyYmKGM9IlxuIik7dmFyIGk9MCxqPSExO3RoaXMucGFyc2U9ZnVuY3Rpb24oYSxrLGwpe2Z1bmN0aW9uIG0oYSl7eC5wdXNoKGEpLEE9aX1mdW5jdGlvbiBuKGIpe3JldHVybiBsP3AoKTooInVuZGVmaW5lZCI9PXR5cGVvZiBiJiYoYj1hLnN1YnN0cihpKSksei5wdXNoKGIpLGk9cyxtKHopLHcmJnEoKSxwKCkpfWZ1bmN0aW9uIG8oYil7aT1iLG0oeiksej1bXSxFPWEuaW5kZXhPZihjLGkpfWZ1bmN0aW9uIHAoYSl7cmV0dXJue2RhdGE6eCxlcnJvcnM6eSxtZXRhOntkZWxpbWl0ZXI6YixsaW5lYnJlYWs6YyxhYm9ydGVkOmosdHJ1bmNhdGVkOiEhYSxjdXJzb3I6QSsoa3x8MCl9fX1mdW5jdGlvbiBxKCl7ZShwKCkpLHg9W10seT1bXX1pZigic3RyaW5nIiE9dHlwZW9mIGEpdGhyb3ciSW5wdXQgbXVzdCBiZSBhIHN0cmluZyI7dmFyIHM9YS5sZW5ndGgsdD1iLmxlbmd0aCx1PWMubGVuZ3RoLHY9ZC5sZW5ndGgsdz1yKGUpO2k9MDt2YXIgeD1bXSx5PVtdLHo9W10sQT0wO2lmKCFhKXJldHVybiBwKCk7aWYoZ3x8ZyE9PSExJiZhLmluZGV4T2YoaCk9PT0tMSl7Zm9yKHZhciBCPWEuc3BsaXQoYyksQz0wO0M8Qi5sZW5ndGg7QysrKXt2YXIgej1CW0NdO2lmKGkrPXoubGVuZ3RoLEMhPT1CLmxlbmd0aC0xKWkrPWMubGVuZ3RoO2Vsc2UgaWYobClyZXR1cm4gcCgpO2lmKCFkfHx6LnN1YnN0cigwLHYpIT09ZCl7aWYodyl7aWYoeD1bXSxtKHouc3BsaXQoYikpLHEoKSxqKXJldHVybiBwKCl9ZWxzZSBtKHouc3BsaXQoYikpO2lmKGYmJkM+PWYpcmV0dXJuIHg9eC5zbGljZSgwLGYpLHAoITApfX1yZXR1cm4gcCgpfWZvcih2YXIgRD1hLmluZGV4T2YoYixpKSxFPWEuaW5kZXhPZihjLGkpLEY9bmV3IFJlZ0V4cChoK2gsImciKTs7KWlmKGFbaV0hPT1oKWlmKGQmJjA9PT16Lmxlbmd0aCYmYS5zdWJzdHIoaSx2KT09PWQpe2lmKEU9PT0tMSlyZXR1cm4gcCgpO2k9RSt1LEU9YS5pbmRleE9mKGMsaSksRD1hLmluZGV4T2YoYixpKX1lbHNlIGlmKEQhPT0tMSYmKEQ8RXx8RT09PS0xKSl6LnB1c2goYS5zdWJzdHJpbmcoaSxEKSksaT1EK3QsRD1hLmluZGV4T2YoYixpKTtlbHNle2lmKEU9PT0tMSlicmVhaztpZih6LnB1c2goYS5zdWJzdHJpbmcoaSxFKSksbyhFK3UpLHcmJihxKCksaikpcmV0dXJuIHAoKTtpZihmJiZ4Lmxlbmd0aD49ZilyZXR1cm4gcCghMCl9ZWxzZXt2YXIgRz1pO2ZvcihpKys7Oyl7dmFyIEc9YS5pbmRleE9mKGgsRysxKTtpZihHPT09LTEpcmV0dXJuIGx8fHkucHVzaCh7dHlwZToiUXVvdGVzIixjb2RlOiJNaXNzaW5nUXVvdGVzIixtZXNzYWdlOiJRdW90ZWQgZmllbGQgdW50ZXJtaW5hdGVkIixyb3c6eC5sZW5ndGgsaW5kZXg6aX0pLG4oKTtpZihHPT09cy0xKXt2YXIgSD1hLnN1YnN0cmluZyhpLEcpLnJlcGxhY2UoRixoKTtyZXR1cm4gbihIKX1pZihhW0crMV0hPT1oKXtpZihhW0crMV09PT1iKXt6LnB1c2goYS5zdWJzdHJpbmcoaSxHKS5yZXBsYWNlKEYsaCkpLGk9RysxK3QsRD1hLmluZGV4T2YoYixpKSxFPWEuaW5kZXhPZihjLGkpO2JyZWFrfWlmKGEuc3Vic3RyKEcrMSx1KT09PWMpe2lmKHoucHVzaChhLnN1YnN0cmluZyhpLEcpLnJlcGxhY2UoRixoKSksbyhHKzErdSksRD1hLmluZGV4T2YoYixpKSx3JiYocSgpLGopKXJldHVybiBwKCk7aWYoZiYmeC5sZW5ndGg+PWYpcmV0dXJuIHAoITApO2JyZWFrfXkucHVzaCh7dHlwZToiUXVvdGVzIixjb2RlOiJJbnZhbGlkUXVvdGVzIixtZXNzYWdlOiJUcmFpbGluZyBxdW90ZSBvbiBxdW90ZWQgZmllbGQgaXMgbWFsZm9ybWVkIixyb3c6eC5sZW5ndGgsaW5kZXg6aX0pLEcrK31lbHNlIEcrK319cmV0dXJuIG4oKX0sdGhpcy5hYm9ydD1mdW5jdGlvbigpe2o9ITB9LHRoaXMuZ2V0Q2hhckluZGV4PWZ1bmN0aW9uKCl7cmV0dXJuIGl9fWZ1bmN0aW9uIGooKXt2YXIgYT1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0Iik7cmV0dXJuIGEubGVuZ3RoP2FbYS5sZW5ndGgtMV0uc3JjOiIifWZ1bmN0aW9uIGsoKXtpZighei5XT1JLRVJTX1NVUFBPUlRFRClyZXR1cm4hMTtpZighdyYmbnVsbD09PXouU0NSSVBUX1BBVEgpdGhyb3cgbmV3IEVycm9yKCJTY3JpcHQgcGF0aCBjYW5ub3QgYmUgZGV0ZXJtaW5lZCBhdXRvbWF0aWNhbGx5IHdoZW4gUGFwYSBQYXJzZSBpcyBsb2FkZWQgYXN5bmNocm9ub3VzbHkuIFlvdSBuZWVkIHRvIHNldCBQYXBhLlNDUklQVF9QQVRIIG1hbnVhbGx5LiIpO3ZhciBhPXouU0NSSVBUX1BBVEh8fHM7YSs9KGEuaW5kZXhPZigiPyIpIT09LTE/IiYiOiI/IikrInBhcGF3b3JrZXIiO3ZhciBiPW5ldyB0LldvcmtlcihhKTtyZXR1cm4gYi5vbm1lc3NhZ2U9bCxiLmlkPXkrKyx4W2IuaWRdPWIsYn1mdW5jdGlvbiBsKGEpe3ZhciBiPWEuZGF0YSxjPXhbYi53b3JrZXJJZF0sZD0hMTtpZihiLmVycm9yKWMudXNlckVycm9yKGIuZXJyb3IsYi5maWxlKTtlbHNlIGlmKGIucmVzdWx0cyYmYi5yZXN1bHRzLmRhdGEpe3ZhciBlPWZ1bmN0aW9uKCl7ZD0hMCxtKGIud29ya2VySWQse2RhdGE6W10sZXJyb3JzOltdLG1ldGE6e2Fib3J0ZWQ6ITB9fSl9LGY9e2Fib3J0OmUscGF1c2U6bixyZXN1bWU6bn07aWYocihjLnVzZXJTdGVwKSl7Zm9yKHZhciBnPTA7ZzxiLnJlc3VsdHMuZGF0YS5sZW5ndGgmJihjLnVzZXJTdGVwKHtkYXRhOltiLnJlc3VsdHMuZGF0YVtnXV0sZXJyb3JzOmIucmVzdWx0cy5lcnJvcnMsbWV0YTpiLnJlc3VsdHMubWV0YX0sZiksIWQpO2crKyk7ZGVsZXRlIGIucmVzdWx0c31lbHNlIHIoYy51c2VyQ2h1bmspJiYoYy51c2VyQ2h1bmsoYi5yZXN1bHRzLGYsYi5maWxlKSxkZWxldGUgYi5yZXN1bHRzKX1iLmZpbmlzaGVkJiYhZCYmbShiLndvcmtlcklkLGIucmVzdWx0cyl9ZnVuY3Rpb24gbShhLGIpe3ZhciBjPXhbYV07cihjLnVzZXJDb21wbGV0ZSkmJmMudXNlckNvbXBsZXRlKGIpLGMudGVybWluYXRlKCksZGVsZXRlIHhbYV19ZnVuY3Rpb24gbigpe3Rocm93Ik5vdCBpbXBsZW1lbnRlZC4ifWZ1bmN0aW9uIG8oYSl7dmFyIGI9YS5kYXRhO2lmKCJ1bmRlZmluZWQiPT10eXBlb2Ygei5XT1JLRVJfSUQmJmImJih6LldPUktFUl9JRD1iLndvcmtlcklkKSwic3RyaW5nIj09dHlwZW9mIGIuaW5wdXQpdC5wb3N0TWVzc2FnZSh7d29ya2VySWQ6ei5XT1JLRVJfSUQscmVzdWx0czp6LnBhcnNlKGIuaW5wdXQsYi5jb25maWcpLGZpbmlzaGVkOiEwfSk7ZWxzZSBpZih0LkZpbGUmJmIuaW5wdXQgaW5zdGFuY2VvZiBGaWxlfHxiLmlucHV0IGluc3RhbmNlb2YgT2JqZWN0KXt2YXIgYz16LnBhcnNlKGIuaW5wdXQsYi5jb25maWcpO2MmJnQucG9zdE1lc3NhZ2Uoe3dvcmtlcklkOnouV09SS0VSX0lELHJlc3VsdHM6YyxmaW5pc2hlZDohMH0pfX1mdW5jdGlvbiBwKGEpe2lmKCJvYmplY3QiIT10eXBlb2YgYSlyZXR1cm4gYTt2YXIgYj1hIGluc3RhbmNlb2YgQXJyYXk/W106e307Zm9yKHZhciBjIGluIGEpYltjXT1wKGFbY10pO3JldHVybiBifWZ1bmN0aW9uIHEoYSxiKXtyZXR1cm4gZnVuY3Rpb24oKXthLmFwcGx5KGIsYXJndW1lbnRzKX19ZnVuY3Rpb24gcihhKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgYX12YXIgcyx0PWZ1bmN0aW9uKCl7cmV0dXJuInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgdD90Ont9fSgpLHU9IXQuZG9jdW1lbnQmJiEhdC5wb3N0TWVzc2FnZSx2PXUmJi8oXD98JilwYXBhd29ya2VyKD18JnwkKS8udGVzdCh0LmxvY2F0aW9uLnNlYXJjaCksdz0hMSx4PXt9LHk9MCx6PXt9O2lmKHoucGFyc2U9YSx6LnVucGFyc2U9Yix6LlJFQ09SRF9TRVA9U3RyaW5nLmZyb21DaGFyQ29kZSgzMCksei5VTklUX1NFUD1TdHJpbmcuZnJvbUNoYXJDb2RlKDMxKSx6LkJZVEVfT1JERVJfTUFSSz0iXHVmZWZmIix6LkJBRF9ERUxJTUlURVJTPVsiXHIiLCJcbiIsJyInLHouQllURV9PUkRFUl9NQVJLXSx6LldPUktFUlNfU1VQUE9SVEVEPSF1JiYhIXQuV29ya2VyLHouU0NSSVBUX1BBVEg9bnVsbCx6LkxvY2FsQ2h1bmtTaXplPTEwNDg1NzYwLHouUmVtb3RlQ2h1bmtTaXplPTUyNDI4ODAsei5EZWZhdWx0RGVsaW1pdGVyPSIsIix6LlBhcnNlcj1pLHouUGFyc2VySGFuZGxlPWgsei5OZXR3b3JrU3RyZWFtZXI9ZCx6LkZpbGVTdHJlYW1lcj1lLHouU3RyaW5nU3RyZWFtZXI9Zix6LlJlYWRhYmxlU3RyZWFtU3RyZWFtZXI9Zyx0LmpRdWVyeSl7dmFyIEE9dC5qUXVlcnk7QS5mbi5wYXJzZT1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKCl7aWYoMD09PWYubGVuZ3RoKXJldHVybiB2b2lkKHIoYS5jb21wbGV0ZSkmJmEuY29tcGxldGUoKSk7dmFyIGI9ZlswXTtpZihyKGEuYmVmb3JlKSl7dmFyIGU9YS5iZWZvcmUoYi5maWxlLGIuaW5wdXRFbGVtKTtpZigib2JqZWN0Ij09dHlwZW9mIGUpe2lmKCJhYm9ydCI9PT1lLmFjdGlvbilyZXR1cm4gdm9pZCBjKCJBYm9ydEVycm9yIixiLmZpbGUsYi5pbnB1dEVsZW0sZS5yZWFzb24pO2lmKCJza2lwIj09PWUuYWN0aW9uKXJldHVybiB2b2lkIGQoKTsib2JqZWN0Ij09dHlwZW9mIGUuY29uZmlnJiYoYi5pbnN0YW5jZUNvbmZpZz1BLmV4dGVuZChiLmluc3RhbmNlQ29uZmlnLGUuY29uZmlnKSl9ZWxzZSBpZigic2tpcCI9PT1lKXJldHVybiB2b2lkIGQoKX12YXIgZz1iLmluc3RhbmNlQ29uZmlnLmNvbXBsZXRlO2IuaW5zdGFuY2VDb25maWcuY29tcGxldGU9ZnVuY3Rpb24oYSl7cihnKSYmZyhhLGIuZmlsZSxiLmlucHV0RWxlbSksZCgpfSx6LnBhcnNlKGIuZmlsZSxiLmluc3RhbmNlQ29uZmlnKX1mdW5jdGlvbiBjKGIsYyxkLGUpe3IoYS5lcnJvcikmJmEuZXJyb3Ioe25hbWU6Yn0sYyxkLGUpfWZ1bmN0aW9uIGQoKXtmLnNwbGljZSgwLDEpLGIoKX12YXIgZT1hLmNvbmZpZ3x8e30sZj1bXTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGEpe3ZhciBiPSJJTlBVVCI9PT1BKHRoaXMpLnByb3AoInRhZ05hbWUiKS50b1VwcGVyQ2FzZSgpJiYiZmlsZSI9PT1BKHRoaXMpLmF0dHIoInR5cGUiKS50b0xvd2VyQ2FzZSgpJiZ0LkZpbGVSZWFkZXI7aWYoIWJ8fCF0aGlzLmZpbGVzfHwwPT09dGhpcy5maWxlcy5sZW5ndGgpcmV0dXJuITA7Zm9yKHZhciBjPTA7Yzx0aGlzLmZpbGVzLmxlbmd0aDtjKyspZi5wdXNoKHtmaWxlOnRoaXMuZmlsZXNbY10saW5wdXRFbGVtOnRoaXMsaW5zdGFuY2VDb25maWc6QS5leHRlbmQoe30sZSl9KX0pLGIoKSx0aGlzfX1yZXR1cm4gdj90Lm9ubWVzc2FnZT1vOnouV09SS0VSU19TVVBQT1JURUQmJihzPWooKSxkb2N1bWVudC5ib2R5P2RvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLGZ1bmN0aW9uKCl7dz0hMH0sITApOnc9ITApLGQucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoYy5wcm90b3R5cGUpLGQucHJvdG90eXBlLmNvbnN0cnVjdG9yPWQsZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShjLnByb3RvdHlwZSksZS5wcm90b3R5cGUuY29uc3RydWN0b3I9ZSxmLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGYucHJvdG90eXBlKSxmLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1mLGcucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoYy5wcm90b3R5cGUpLGcucHJvdG90eXBlLmNvbnN0cnVjdG9yPWcsen0pOw=='));
CSVTranslationsReader.Papa = window['Papa'];
delete window['Papa'];
var TranslationsService = (function () {
    function TranslationsService() {
    }
    TranslationsService.getLanguagesList = function () {
        return this.LANGUAGES_LIST;
    };
    TranslationsService.getLanguageObjectByCode = function (code) {
        for (var _i = 0, _a = this.LANGUAGES_LIST; _i < _a.length; _i++) {
            var langObj = _a[_i];
            if (langObj.code2 === code || langObj.code3 === code) {
                return langObj;
            }
        }
        return null;
    };
    TranslationsService.LANGUAGES_LIST = [{
            "code3": "afr",
            "code2": "af",
            "name": "Afrikaans",
            "native_name": "Afrikaans"
        }, { "code3": "alb", "code2": "al", "name": "Albanian", "native_name": "Shqip" }, {
            "code3": "anp",
            "code2": null,
            "name": "Angika",
            "native_name": "Angika"
        }, { "code3": "ara", "code2": "sa", "name": "Arabic", "native_name": "العَرَبِيَّة" }, {
            "code3": "arm",
            "code2": "am",
            "name": "Armenian",
            "native_name": " Հայերեն"
        }, { "code3": "asm", "code2": "as", "name": "Assamese", "native_name": "অসমীয়া" }, {
            "code3": "ast",
            "code2": null,
            "name": "Asturian",
            "native_name": "Asturianu"
        }, { "code3": "ave", "code2": "ae", "name": "Avestan", "native_name": "Avestan" }, {
            "code3": "awa",
            "code2": null,
            "name": "Awadhi",
            "native_name": "अवधी"
        }, { "code3": "aym", "code2": "ay", "name": "Aymara", "native_name": "Aymar aru" }, {
            "code3": "aze",
            "code2": "az",
            "name": "Azerbaijani",
            "native_name": "Azərbaycan dil"
        }, { "code3": "bam", "code2": "bm", "name": "Bambara", "native_name": "Bambara" }, {
            "code3": "bas",
            "code2": null,
            "name": "Basa",
            "native_name": "Mbene; Ɓasaá"
        }, { "code3": "bak", "code2": "ba", "name": "Bashkir", "native_name": "Башҡорт теле" }, {
            "code3": "baq",
            "code2": "eu",
            "name": "Basque",
            "native_name": "euskara"
        }, { "code3": "bel", "code2": "by", "name": "Belarusian", "native_name": "Беларуская мова" }, {
            "code3": "ben",
            "code2": "bn",
            "name": "Bengali",
            "native_name": "বাংলা"
        }, { "code3": "bho", "code2": null, "name": "Bhojpuri", "native_name": "भोजपुरी" }, {
            "code3": "bih",
            "code2": "bh",
            "name": "Bihari languages",
            "native_name": "Bihari languages"
        }, { "code3": "bis", "code2": "bi", "name": "Bislama", "native_name": "Bislama" }, {
            "code3": "bos",
            "code2": "bs",
            "name": "Bosnian",
            "native_name": "босански"
        }, { "code3": "bre", "code2": "br", "name": "Breton", "native_name": "Brezhoneg" }, {
            "code3": "bul",
            "code2": "bg",
            "name": "Bulgarian",
            "native_name": "български език"
        }, { "code3": "bur", "code2": null, "name": "Burmese", "native_name": "Burmese" }, {
            "code3": "cas",
            "code2": null,
            "name": "Castilian",
            "native_name": "Castellano"
        }, { "code3": "cat", "code2": "ca", "name": "Catalan", "native_name": "Català" }, {
            "code3": "khm",
            "code2": "km",
            "name": "Central Khmer",
            "native_name": "ភាសាខ្មែរ"
        }, { "code3": "che", "code2": "ce", "name": "Chechen", "native_name": "Нохчийн мотт" }, {
            "code3": "chi",
            "code2": "cn",
            "name": "Chinese",
            "native_name": "中文"
        }, { "code3": "chv", "code2": "cv", "name": "Chuvash", "native_name": "Чӑвашла" }, {
            "code3": "cor",
            "code2": "kw",
            "name": "Cornish",
            "native_name": "Kernowek"
        }, { "code3": "cos", "code2": "co", "name": "Corsican", "native_name": "Corsu" }, {
            "code3": "cre",
            "code2": "cr",
            "name": "Cree",
            "native_name": "Cree"
        }, { "code3": "cro", "code2": "hr", "name": "Croatian", "native_name": "Croatian" }, {
            "code3": "ces",
            "code2": "cz",
            "name": "Czech",
            "native_name": "čeština"
        }, { "code3": "dan", "code2": "dk", "name": "Danish", "native_name": "Dansk" }, {
            "code3": "dut",
            "code2": "nl",
            "name": "Dutch",
            "native_name": "Nederlands"
        }, { "code3": "dzo", "code2": "dz", "name": "Dzongkha", "native_name": "Dzongkha" }, {
            "code3": "eng",
            "code2": "en",
            "name": "English",
            "native_name": "English"
        }, { "code3": "epo", "code2": "eo", "name": "Esperanto", "native_name": "Esperanto" }, {
            "code3": "est",
            "code2": "ee",
            "name": "Estonian",
            "native_name": "Eesti keel"
        }, { "code3": "ewe", "code2": null, "name": "Ewe", "native_name": "Èʋegbe" }, {
            "code3": "fao",
            "code2": "fo",
            "name": "Faroese",
            "native_name": "føroyskt"
        }, { "code3": "fij", "code2": "fj", "name": "Fijian", "native_name": "Na Vosa Vakaviti" }, {
            "code3": "fil",
            "code2": "ph",
            "name": "Filipino",
            "native_name": "Wikang Filipino"
        }, { "code3": "fin", "code2": "fi", "name": "Finnish", "native_name": "Suomen kieli" }, {
            "code3": "fle",
            "code2": "be",
            "name": "Flemish",
            "native_name": "Flemish"
        }, { "code3": "fra", "code2": "fr", "name": "French", "native_name": "Français" }, {
            "code3": "gla",
            "code2": "gd",
            "name": "Gaelic; Scottish Gaelic",
            "native_name": "Gàidhlig"
        }, { "code3": "glg", "code2": "gl", "name": "Galician", "native_name": "galego" }, {
            "code3": "lug",
            "code2": "lg",
            "name": "Ganda",
            "native_name": "Luganda"
        }, { "code3": "geo", "code2": "ka", "name": "Georgian", "native_name": "ქართული" }, {
            "code3": "deu",
            "code2": "de",
            "name": "German",
            "native_name": "Deutsch"
        }, { "code3": "grc", "code2": "gr", "name": "Greek", "native_name": "Ελληνικά" }, {
            "code3": "grn",
            "code2": "gn",
            "name": "Guarani",
            "native_name": "Avañe'ẽ"
        }, { "code3": "guj", "code2": "gu", "name": "Gujarati", "native_name": "ગુજરાતી" }, {
            "code3": "hat",
            "code2": "ht",
            "name": "Haitian; Haitian Creole",
            "native_name": "Kreyòl ayisyen"
        }, { "code3": "hau", "code2": "ha", "name": "Hausa", "native_name": " هَرْشَن" }, {
            "code3": "heb",
            "code2": "il",
            "name": "Hebrew",
            "native_name": "עברית‎"
        }, { "code3": "her", "code2": "hz", "name": "Herero", "native_name": "Otjiherero" }, {
            "code3": "hil",
            "code2": null,
            "name": "Hiligaynon",
            "native_name": "Ilonggo"
        }, { "code3": "hin", "code2": null, "name": "Hindi-Urdu", "native_name": "हिन्दी" }, {
            "code3": "hmo",
            "code2": "ho",
            "name": "Hiri Motu",
            "native_name": "Hiri Motu"
        }, { "code3": "hun", "code2": "hu", "name": "Hungarian", "native_name": "Magyar" }, {
            "code3": "ice",
            "code2": "is",
            "name": "Icelandic",
            "native_name": "íslenska"
        }, { "code3": "ido", "code2": "io", "name": "Ido", "native_name": "Ido" }, {
            "code3": "ibo",
            "code2": "ig",
            "name": "Igbo",
            "native_name": "Asụsụ Igbo"
        }, { "code3": "ind", "code2": "id", "name": "Indonesian", "native_name": "Bahasa Indonesia" }, {
            "code3": "iku",
            "code2": "iu",
            "name": "Inuktitut",
            "native_name": "Inuktitut"
        }, { "code3": "ipk", "code2": "ik", "name": "Inupiaq", "native_name": "Iñupiaq" }, {
            "code3": "gle",
            "code2": "ie",
            "name": "Irish",
            "native_name": "Gaeilge"
        }, { "code3": "ita", "code2": "it", "name": "Italian", "native_name": "Italiano" }, {
            "code3": "jpn",
            "code2": "jp",
            "name": "Japanese",
            "native_name": "日本語"
        }, { "code3": "jav", "code2": "jv", "name": "Javanese", "native_name": "Javanese" }, {
            "code3": "kan",
            "code2": "kn",
            "name": "Kannada",
            "native_name": "ಕನ್ನಡ"
        }, { "code3": "kau", "code2": null, "name": "Kanuri", "native_name": "Kanuri" }, {
            "code3": "kas",
            "code2": "ks",
            "name": "Kashmiri",
            "native_name": "कॉशुर \/ كأشُر"
        }, { "code3": "kaz", "code2": "kk", "name": "Kazakh", "native_name": "қазақ тілі" }, {
            "code3": "kon",
            "code2": "kg",
            "name": "Kongo",
            "native_name": "Kongo"
        }, { "code3": "kor", "code2": "kr", "name": "Korean", "native_name": "한국어" }, {
            "code3": "kos",
            "code2": null,
            "name": "Kosraean",
            "native_name": "Kosraean"
        }, { "code3": "kua", "code2": "kj", "name": "Kuanyama; Kwanyama", "native_name": "Kuanyama" }, {
            "code3": "kur",
            "code2": "ku",
            "name": "Kurdish",
            "native_name": "Kurdî \/ کوردی‎"
        }, { "code3": "lao", "code2": "lo", "name": "Lao", "native_name": "ພາສາລາວ" }, {
            "code3": "lat",
            "code2": "la",
            "name": "Latin",
            "native_name": "Lingua latīna"
        }, { "code3": "lav", "code2": "lv", "name": "Latvian", "native_name": "Latviešu" }, {
            "code3": "lin",
            "code2": "ln",
            "name": "Lingala",
            "native_name": "Lingala"
        }, { "code3": "lit", "code2": "lt", "name": "Lithuanian", "native_name": "lietuvių kalba" }, {
            "code3": "ltz",
            "code2": "lu",
            "name": "Luxembourgish; Letzeburgesch",
            "native_name": "Lëtzebuergesch"
        }, { "code3": "mac", "code2": "mk", "name": "Macedonian", "native_name": "македонски јазик" }, {
            "code3": "mlg",
            "code2": "mg",
            "name": "Malagasy",
            "native_name": "Malagasy"
        }, { "code3": "may", "code2": "my", "name": "Malay", "native_name": "Bahasa Melayu" }, {
            "code3": "mlt",
            "code2": "mt",
            "name": "Maltese",
            "native_name": "Malti"
        }, { "code3": "glv", "code2": "gv", "name": "Manx", "native_name": "Gaelg; Gailck" }, {
            "code3": "mao",
            "code2": "mi",
            "name": "Maori",
            "native_name": "Te Reo Māori"
        }, { "code3": "mar", "code2": null, "name": "Marathi", "native_name": "मराठी" }, {
            "code3": "mah",
            "code2": "mh",
            "name": "Marshallese",
            "native_name": "Kajin M̧ajeļ"
        }, { "code3": "mon", "code2": "mn", "name": "Mongolian", "native_name": "монгол хэл" }, {
            "code3": "cnr",
            "code2": "me",
            "name": "Montenegrin",
            "native_name": "cцрногорски"
        }, { "code3": "nep", "code2": null, "name": "Nepali", "native_name": "नेपाली भाषा" }, {
            "code3": "nor",
            "code2": "no",
            "name": "Norwegian",
            "native_name": "Norsk"
        }, { "code3": "nob", "code2": "nb", "name": "Norwegian Bokmål", "native_name": "Bokmål" }, {
            "code3": "nno",
            "code2": "nn",
            "name": "Norwegian Nynorsk",
            "native_name": "Nynorsk"
        }, { "code3": "oji", "code2": "oj", "name": "Ojibwa", "native_name": "Ojibwa" }, {
            "code3": "ori",
            "code2": "or",
            "name": "Oriya",
            "native_name": "ଓଡ଼ିଆ"
        }, { "code3": "orm", "code2": "om", "name": "Oromo", "native_name": "Afaan Oromoo" }, {
            "code3": "oss",
            "code2": "os",
            "name": "Ossetian; Ossetic",
            "native_name": "Ирон æвзаг"
        }, { "code3": "pli", "code2": "pi", "name": "Pali", "native_name": "Pāli" }, {
            "code3": "pas",
            "code2": null,
            "name": "Pashto",
            "native_name": "پښتو"
        }, { "code3": "fas", "code2": "fa", "name": "Persian", "native_name": "فارسی" }, {
            "code3": "pol",
            "code2": "pl",
            "name": "Polish",
            "native_name": "Polski"
        }, { "code3": "por", "code2": "pt", "name": "Portuguese", "native_name": "Português" }, {
            "code3": "pun",
            "code2": null,
            "name": "Punjabi",
            "native_name": "ਪੰਜਾਬੀ \/ پنجابی‎"
        }, { "code3": "que", "code2": "qu", "name": "Quechua", "native_name": "kichwa simii" }, {
            "code3": "ron",
            "code2": "ro",
            "name": "Romanian",
            "native_name": "Română"
        }, { "code3": "run", "code2": "rn", "name": "Rundi", "native_name": "Ikirundi" }, {
            "code3": "rus",
            "code2": "ru",
            "name": "Russian",
            "native_name": "Русский"
        }, { "code3": "smo", "code2": "sm", "name": "Samoan", "native_name": "Gagana faʻa Sāmoa" }, {
            "code3": "sag",
            "code2": "sg",
            "name": "Sango",
            "native_name": "Yângâ tî sängö"
        }, { "code3": "san", "code2": null, "name": "Sanskrit", "native_name": "संस्कृतम्" }, {
            "code3": "srd",
            "code2": "sc",
            "name": "Sardinian",
            "native_name": "Sardu"
        }, { "code3": "srp", "code2": "cs", "name": "Serbo\/Croatian", "native_name": "Serbo\/Croatian" }, {
            "code3": "sna",
            "code2": "sn",
            "name": "Shona",
            "native_name": "ChiShona"
        }, { "code3": "iii", "code2": "ii", "name": "Sichuan Yi", "native_name": "Sichuan Yi" }, {
            "code3": "bla",
            "code2": null,
            "name": "Siksika",
            "native_name": "Siksika"
        }, { "code3": "snd", "code2": "sd", "name": "Sindhi", "native_name": "سنڌي \/ सिन्धी \/ ਸਿੰਧੀ" }, {
            "code3": "sin",
            "code2": null,
            "name": "Sinhala; Sinhalese",
            "native_name": "සිංහල"
        }, { "code3": "slo", "code2": "sk", "name": "Slovak", "native_name": "Slovenčina" }, {
            "code3": "slv",
            "code2": "si",
            "name": "Slovenian",
            "native_name": "Slovenski jezik"
        }, { "code3": "som", "code2": "so", "name": "Somali", "native_name": "af Soomaali" }, {
            "code3": "sot",
            "code2": "st",
            "name": "Southern Sotho",
            "native_name": "Sesotho [southern]"
        }, { "code3": "spa", "code2": "es", "name": "Spanish", "native_name": "Español" }, {
            "code3": "sun",
            "code2": "su",
            "name": "Sundanese",
            "native_name": "Basa Sunda"
        }, { "code3": "swa", "code2": "sw", "name": "Swahili", "native_name": "Kiswahili" }, {
            "code3": "ssw",
            "code2": "ss",
            "name": "Swati",
            "native_name": "SiSwati"
        }, { "code3": "swe", "code2": "se", "name": "Swedish", "native_name": "Svenska" }, {
            "code3": "gsw",
            "code2": null,
            "name": "Swiss German",
            "native_name": "Schwiizerdütsch"
        }, { "code3": "tgl", "code2": "tl", "name": "Tagalog", "native_name": "Wikang Tagalog" }, {
            "code3": "tah",
            "code2": "ty",
            "name": "Tahitian",
            "native_name": "Reo Tahiti"
        }, { "code3": "tam", "code2": null, "name": "Tamil", "native_name": "தமிழ்" }, {
            "code3": "tel",
            "code2": null,
            "name": "Telugu",
            "native_name": "తెలుగు"
        }, { "code3": "tha", "code2": "th", "name": "Thai", "native_name": "ภาษาไทย" }, {
            "code3": "bod",
            "code2": "bo",
            "name": "Tibetan",
            "native_name": "Tibetan"
        }, { "code3": "tir", "code2": "ti", "name": "Tigrinya", "native_name": "Tigrinya" }, {
            "code3": "ton",
            "code2": "to",
            "name": "Tonga (Tonga Islands)",
            "native_name": "lea faka-Tonga"
        }, { "code3": "tso", "code2": "ts", "name": "Tsonga", "native_name": "Xitsonga" }, {
            "code3": "tsn",
            "code2": "tn",
            "name": "Tswana",
            "native_name": "Setswana"
        }, { "code3": "tur", "code2": "tr", "name": "Turkish", "native_name": "Türkçe" }, {
            "code3": "tuk",
            "code2": "tk",
            "name": "Turkmen",
            "native_name": "Türkmençe"
        }, { "code3": "twi", "code2": "tw", "name": "Twi", "native_name": "Twi" }, {
            "code3": "uig",
            "code2": "ug",
            "name": "Uighur; Uyghur",
            "native_name": "ئۇيغۇرچە  ; ئۇيغۇر تىلى"
        }, { "code3": "ukr", "code2": "ua", "name": "Ukrainian", "native_name": "українська мова" }, {
            "code3": "urd",
            "code2": "ur",
            "name": "Urdu",
            "native_name": "اُردُو‎"
        }, { "code3": "uzb", "code2": "uz", "name": "Uzbek", "native_name": "ئوبېک " }, {
            "code3": "val",
            "code2": null,
            "name": "Valencian",
            "native_name": "Valencià"
        }, { "code3": "ven", "code2": "ve", "name": "Venda", "native_name": "Tshivenḓa" }, {
            "code3": "vie",
            "code2": "vn",
            "name": "Vietnamese",
            "native_name": "Tiếng Việt"
        }, { "code3": "vol", "code2": "vo", "name": "Volapük", "native_name": "Volapük" }, {
            "code3": "wak",
            "code2": null,
            "name": "Wakashan languages",
            "native_name": "Wakashan languages"
        }, { "code3": "wln", "code2": "wa", "name": "Walloon", "native_name": "Walon" }, {
            "code3": "cym",
            "code2": "cy",
            "name": "Welsh",
            "native_name": "Cymraeg"
        }, { "code3": "wol", "code2": "wo", "name": "Wolof", "native_name": "Wolof" }, {
            "code3": "wuu",
            "code2": "wu",
            "name": "Wu",
            "native_name": "Wu"
        }, { "code3": "xho", "code2": "xh", "name": "Xhosa", "native_name": "isiXhosa" }, {
            "code3": "yor",
            "code2": "yo",
            "name": "Yoruba",
            "native_name": "èdè Yorùbá"
        }, { "code3": "yue", "code2": null, "name": "Yue", "native_name": "Yue" }, {
            "code3": "zha",
            "code2": "za",
            "name": "Zhuang; Chuang",
            "native_name": "Vahcuengh \/ 話僮"
        }];
    return TranslationsService;
}());
var UnserializerV0_4 = (function () {
    function UnserializerV0_4(engine) {
        this.engine = engine;
    }
    UnserializerV0_4.prototype.readFormNode = function (fromStructure, form, theme, engine, bag) {
        var nodeTypeId, nodeId, properties, nodeChildren, nodeErrors, localReadResult, embeddedHeader, embeddedCaptcha, embeddedActionBar, embeddedFormTheme;
        if (!(fromStructure instanceof Array)) {
            throw new Error('Error unserializing structure: Array expected!');
        }
        if (fromStructure[0] !== UnserializerV0_4.UNSERIALIZER_VERSION) {
            throw new Error('Unserializer version mismatch: got ' + JSON.stringify(fromStructure[0]) + ', expected ' + JSON.stringify(FormUnserializer.LATEST_VERSION));
        }
        else {
            fromStructure.splice(0, 1);
        }
        if (fromStructure.length != UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH + UnserializerV0_4.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH) {
            throw new Error('The root structure of a serialized form must have exactly ' + (UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH + UnserializerV0_4.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH) + ' items, but this structure has ' + (fromStructure.length) + ' items');
        }
        nodeTypeId = fromStructure[UnserializerV0_4.POS_NODE_TYPE_ID];
        nodeId = fromStructure[UnserializerV0_4.POS_NODE_ID];
        properties = fromStructure[UnserializerV0_4.POS_NODE_PROPERTIES];
        nodeErrors = fromStructure[UnserializerV0_4.POS_NODE_ERRORS];
        nodeChildren = fromStructure[UnserializerV0_4.POS_NODE_CHILDREN];
        embeddedHeader = fromStructure[UnserializerV0_4.POS_FORM_HEADER];
        embeddedCaptcha = fromStructure[UnserializerV0_4.POS_FORM_CAPTCHA];
        embeddedActionBar = fromStructure[UnserializerV0_4.POS_FORM_ACTIONBAR];
        embeddedFormTheme = fromStructure[UnserializerV0_4.POS_FORM_THEME];
        if (nodeTypeId !== ElementTypes.ELEMENT_TYPE_FORM) {
            throw new Error('The value of element[0] in a serialized form must be exactly ' + JSON.stringify(ElementTypes.ELEMENT_TYPE_FORM));
        }
        form['withProperties'](properties);
        form['id'] = nodeId;
        form.withErrors(nodeErrors);
        if (!(embeddedHeader && embeddedHeader instanceof Array)) {
            throw new Error('Error deserializing form: The embedded header is not a <IFormSerializationData>');
        }
        if (embeddedHeader.length !== UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Header length mismatch: got ' + JSON.stringify(embeddedHeader.length) + ', expected ' + JSON.stringify(UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedHeader[0] !== ElementTypes.CONTROL_TYPE_FORM_HEADER) {
            throw new Error('Error deserializing form: Header element type id mismatch: got ' + JSON.stringify(embeddedHeader[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_FORM_HEADER));
        }
        if (!(embeddedCaptcha && embeddedCaptcha instanceof Array)) {
            throw new Error('Error deserializing form: The embedded captcha is not a <IFormSerializationData>!');
        }
        if (embeddedCaptcha.length !== UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Captcha length mismatch: got ' + JSON.stringify(embeddedCaptcha.length) + ', expected ' + JSON.stringify(UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedCaptcha[0] !== ElementTypes.CONTROL_TYPE_CAPTCHA) {
            throw new Error('Error deserializing form: Captcha element type id mismatch: got ' + JSON.stringify(embeddedCaptcha[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_CAPTCHA));
        }
        if (!(embeddedActionBar && embeddedActionBar instanceof Array)) {
            throw new Error('Error deserializing form: The embedded footer is not a <IFormSerializationData>');
        }
        if (embeddedActionBar.length !== UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Header length mismatch: got ' + JSON.stringify(embeddedActionBar.length) + ', expected ' + JSON.stringify(UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedActionBar[0] !== ElementTypes.CONTROL_TYPE_ACTION_BAR) {
            throw new Error('Error deserializing form: ActionBar element type id mismatch: got ' + JSON.stringify(embeddedActionBar[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_ACTION_BAR));
        }
        form.getHeader()
            .withId(embeddedHeader[UnserializerV0_4.POS_NODE_ID])['withProperties'](embeddedHeader[UnserializerV0_4.POS_NODE_PROPERTIES]);
        form.getCaptcha()
            .withId(embeddedCaptcha[UnserializerV0_4.POS_NODE_ID])['withProperties'](embeddedCaptcha[UnserializerV0_4.POS_NODE_PROPERTIES]);
        form.getActionBar()
            .withId(embeddedActionBar[UnserializerV0_4.POS_NODE_ID])['withProperties'](embeddedActionBar[UnserializerV0_4.POS_NODE_PROPERTIES]);
        if (embeddedFormTheme instanceof Array) {
            for (var i = 0, len = embeddedFormTheme.length; i < len; i++) {
                theme.setProperty(embeddedFormTheme[i].name, embeddedFormTheme[i].value);
            }
        }
        theme.recomputeInImmediateMode();
        if (null !== nodeChildren) {
            localReadResult = {
                node: null,
                nextReadIndex: 0
            };
            do {
                localReadResult = this.readNextNode(nodeChildren, localReadResult.nextReadIndex, engine, bag);
                if (null !== localReadResult) {
                    form.appendChild(localReadResult.node);
                }
            } while (null !== localReadResult);
        }
    };
    UnserializerV0_4.prototype.readNextNode = function (fromStructure, startingIndex, engine, bag) {
        var structureLength = (fromStructure || []).length, nodeTypeId, nodeId, properties, nodeChildren, nodeColspan, nodeHeight, nodeErrors, element, nodeHash, localReadResult;
        if (!(fromStructure instanceof Array)) {
            return null;
        }
        if (!(fromStructure.length)) {
            return null;
        }
        if (startingIndex === structureLength) {
            return null;
        }
        if (startingIndex > structureLength - UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Unserialize failed: Read outside serialized data bounds!');
        }
        nodeTypeId = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_TYPE_ID];
        nodeId = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_ID];
        nodeHash = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_HASH];
        properties = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_PROPERTIES];
        nodeErrors = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_ERRORS];
        nodeChildren = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_CHILDREN];
        nodeColspan = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_COLSPAN];
        nodeHeight = fromStructure[startingIndex + UnserializerV0_4.POS_NODE_HEIGHT];
        element = bag.createElement(nodeTypeId, properties, nodeId, nodeColspan, nodeHeight, nodeErrors, nodeHash);
        if (null !== nodeChildren) {
            localReadResult = {
                node: null,
                nextReadIndex: 0
            };
            do {
                localReadResult = this.readNextNode(nodeChildren, localReadResult.nextReadIndex, engine, bag);
                if (null !== localReadResult) {
                    element.appendChild(localReadResult.node);
                }
            } while (null !== localReadResult);
        }
        return {
            node: element,
            nextReadIndex: startingIndex + UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH,
        };
    };
    UnserializerV0_4.prototype.unserialize = function (fromStructure, useUnserializerBag) {
        console.time('unserialize');
        var form = this.engine.getDocument(), theme = this.engine.getTheme(), engine = this.engine, bag = form.createUnserializerBag(!useUnserializerBag);
        form.clear();
        form.disableEvents();
        theme.disableEvents();
        engine.disableEvents();
        var selection = engine.getLoader().getSelection();
        this.readFormNode(fromStructure, form, theme, engine, bag);
        bag.reinitReusedElements();
        bag.destroy();
        engine.enableEvents();
        theme.enableEvents();
        form.enableEvents();
        form.rebuildHashMap();
        form.trigger('load');
        form.repaginateInImmediateMode();
        theme.recomputeInImmediateMode();
        if (null !== selection) {
            selection.enableEvents();
            selection.synchronize();
        }
        (function (themeProperties) {
            for (var i = 0, len = themeProperties.length; i < len; i++) {
                theme.trigger('property-changed', themeProperties[i].name, themeProperties[i].value);
            }
            theme.trigger('changed');
        })(theme.enumerateProperties());
        form.getHeader().updateHTMLContent();
        form.getActionBar().updateDOMAttributes();
        form.updateInstructionsTextAlignment();
        form.updateLabelTextAlignment();
        form.updateTextDirection();
        form.updateLabelPlacement();
        form.getEngine().getLoader().execCommand('form-name-changed');
        form.getCaptcha().onCreated();
        console.timeEnd('unserialize');
        form.getEngine().getLoader().trigger('unserialize');
    };
    UnserializerV0_4.UNSERIALIZER_VERSION = 'v0.4';
    UnserializerV0_4.SERIALIZED_NODE_CHUNK_LENGTH = 8;
    UnserializerV0_4.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH = 4;
    UnserializerV0_4.POS_NODE_TYPE_ID = 0;
    UnserializerV0_4.POS_NODE_ID = 1;
    UnserializerV0_4.POS_NODE_HASH = 2;
    UnserializerV0_4.POS_NODE_PROPERTIES = 3;
    UnserializerV0_4.POS_NODE_ERRORS = 4;
    UnserializerV0_4.POS_NODE_CHILDREN = 5;
    UnserializerV0_4.POS_NODE_COLSPAN = 6;
    UnserializerV0_4.POS_NODE_HEIGHT = 7;
    UnserializerV0_4.POS_FORM_HEADER = 8;
    UnserializerV0_4.POS_FORM_CAPTCHA = 9;
    UnserializerV0_4.POS_FORM_ACTIONBAR = 10;
    UnserializerV0_4.POS_FORM_THEME = 11;
    return UnserializerV0_4;
}());
var UnserializerV0_5 = (function () {
    function UnserializerV0_5(engine) {
        this.engine = engine;
    }
    UnserializerV0_5.prototype.readFormNode = function (fromStructure, form, theme, engine, bag) {
        var nodeTypeId, nodeId, properties, nodeChildren, nodeErrors, localReadResult, embeddedHeader, embeddedCaptcha, embeddedActionBar, embeddedFormTheme, formConfiguration;
        if (!(fromStructure instanceof Array)) {
            throw new Error('Error unserializing structure: Array expected!');
        }
        if (fromStructure[0] !== UnserializerV0_5.UNSERIALIZER_VERSION) {
            throw new Error('Unserializer version mismatch: got ' + JSON.stringify(fromStructure[0]) + ', expected ' + JSON.stringify(FormUnserializer.LATEST_VERSION));
        }
        else {
            fromStructure.splice(0, 1);
        }
        if (fromStructure.length != UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH + UnserializerV0_5.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH) {
            throw new Error('The root structure of a serialized form must have exactly ' + (UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH + UnserializerV0_5.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH) + ' items, but this structure has ' + (fromStructure.length) + ' items');
        }
        nodeTypeId = fromStructure[UnserializerV0_5.POS_NODE_TYPE_ID];
        nodeId = fromStructure[UnserializerV0_5.POS_NODE_ID];
        properties = fromStructure[UnserializerV0_5.POS_NODE_PROPERTIES];
        nodeErrors = fromStructure[UnserializerV0_5.POS_NODE_ERRORS];
        nodeChildren = fromStructure[UnserializerV0_5.POS_NODE_CHILDREN];
        embeddedHeader = fromStructure[UnserializerV0_5.POS_FORM_HEADER];
        embeddedCaptcha = fromStructure[UnserializerV0_5.POS_FORM_CAPTCHA];
        embeddedActionBar = fromStructure[UnserializerV0_5.POS_FORM_ACTIONBAR];
        embeddedFormTheme = fromStructure[UnserializerV0_5.POS_FORM_THEME];
        formConfiguration = fromStructure[UnserializerV0_5.POS_FORM_CONFIG];
        if (nodeTypeId !== ElementTypes.ELEMENT_TYPE_FORM) {
            throw new Error('The value of element[0] in a serialized form must be exactly ' + JSON.stringify(ElementTypes.ELEMENT_TYPE_FORM));
        }
        form['withProperties'](properties);
        form['id'] = nodeId;
        form.withErrors(nodeErrors);
        if (!(embeddedHeader && embeddedHeader instanceof Array)) {
            throw new Error('Error deserializing form: The embedded header is not a <IFormSerializationData>');
        }
        if (embeddedHeader.length !== UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Header length mismatch: got ' + JSON.stringify(embeddedHeader.length) + ', expected ' + JSON.stringify(UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedHeader[0] !== ElementTypes.CONTROL_TYPE_FORM_HEADER) {
            throw new Error('Error deserializing form: Header element type id mismatch: got ' + JSON.stringify(embeddedHeader[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_FORM_HEADER));
        }
        if (!(embeddedCaptcha && embeddedCaptcha instanceof Array)) {
            throw new Error('Error deserializing form: The embedded captcha is not a <IFormSerializationData>!');
        }
        if (embeddedCaptcha.length !== UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Captcha length mismatch: got ' + JSON.stringify(embeddedCaptcha.length) + ', expected ' + JSON.stringify(UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedCaptcha[0] !== ElementTypes.CONTROL_TYPE_CAPTCHA) {
            throw new Error('Error deserializing form: Captcha element type id mismatch: got ' + JSON.stringify(embeddedCaptcha[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_CAPTCHA));
        }
        if (!(embeddedActionBar && embeddedActionBar instanceof Array)) {
            throw new Error('Error deserializing form: The embedded footer is not a <IFormSerializationData>');
        }
        if (embeddedActionBar.length !== UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Header length mismatch: got ' + JSON.stringify(embeddedActionBar.length) + ', expected ' + JSON.stringify(UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedActionBar[0] !== ElementTypes.CONTROL_TYPE_ACTION_BAR) {
            throw new Error('Error deserializing form: ActionBar element type id mismatch: got ' + JSON.stringify(embeddedActionBar[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_ACTION_BAR));
        }
        if (null !== formConfiguration && !(formConfiguration instanceof Object)) {
            throw new Error('Error deserializing form: Configuration property should be null|object');
        }
        form.getHeader()
            .withId(embeddedHeader[UnserializerV0_5.POS_NODE_ID])['withProperties'](embeddedHeader[UnserializerV0_5.POS_NODE_PROPERTIES]);
        form.getCaptcha()
            .withId(embeddedCaptcha[UnserializerV0_5.POS_NODE_ID])['withProperties'](embeddedCaptcha[UnserializerV0_5.POS_NODE_PROPERTIES]);
        form.getActionBar()
            .withId(embeddedActionBar[UnserializerV0_5.POS_NODE_ID])['withProperties'](embeddedActionBar[UnserializerV0_5.POS_NODE_PROPERTIES]);
        if (embeddedFormTheme instanceof Array) {
            for (var i = 0, len = embeddedFormTheme.length; i < len; i++) {
                theme.setProperty(embeddedFormTheme[i].name, embeddedFormTheme[i].value);
            }
        }
        if (null !== formConfiguration) {
            for (var k in formConfiguration) {
                if (formConfiguration.hasOwnProperty(k)) {
                    form.getConfiguration().withProperty(k, formConfiguration[k]);
                }
            }
        }
        theme.recomputeInImmediateMode();
        if (null !== nodeChildren) {
            localReadResult = {
                node: null,
                nextReadIndex: 0
            };
            do {
                localReadResult = this.readNextNode(nodeChildren, localReadResult.nextReadIndex, engine, bag);
                if (null !== localReadResult) {
                    form.appendChild(localReadResult.node);
                }
            } while (null !== localReadResult);
        }
    };
    UnserializerV0_5.prototype.readNextNode = function (fromStructure, startingIndex, engine, bag) {
        var structureLength = (fromStructure || []).length, nodeTypeId, nodeId, properties, nodeChildren, nodeColspan, nodeHeight, nodeErrors, element, nodeHash, localReadResult;
        if (!(fromStructure instanceof Array)) {
            return null;
        }
        if (!(fromStructure.length)) {
            return null;
        }
        if (startingIndex === structureLength) {
            return null;
        }
        if (startingIndex > structureLength - UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Unserialize failed: Read outside serialized data bounds!');
        }
        nodeTypeId = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_TYPE_ID];
        nodeId = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_ID];
        nodeHash = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_HASH];
        properties = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_PROPERTIES];
        nodeErrors = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_ERRORS];
        nodeChildren = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_CHILDREN];
        nodeColspan = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_COLSPAN];
        nodeHeight = fromStructure[startingIndex + UnserializerV0_5.POS_NODE_HEIGHT];
        element = bag.createElement(nodeTypeId, properties, nodeId, nodeColspan, nodeHeight, nodeErrors, nodeHash);
        if (null !== nodeChildren) {
            localReadResult = {
                node: null,
                nextReadIndex: 0
            };
            do {
                localReadResult = this.readNextNode(nodeChildren, localReadResult.nextReadIndex, engine, bag);
                if (null !== localReadResult) {
                    element.appendChild(localReadResult.node);
                }
            } while (null !== localReadResult);
        }
        return {
            node: element,
            nextReadIndex: startingIndex + UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH,
        };
    };
    UnserializerV0_5.prototype.unserialize = function (fromStructure, useUnserializerBag) {
        console.time('unserialize');
        var form = this.engine.getDocument(), theme = this.engine.getTheme(), engine = this.engine, bag = form.createUnserializerBag(!useUnserializerBag);
        form.clear();
        form.disableEvents();
        form.getConfiguration().disableEvents();
        theme.disableEvents();
        engine.disableEvents();
        var selection = engine.getLoader().getSelection();
        this.readFormNode(fromStructure, form, theme, engine, bag);
        bag.reinitReusedElements();
        bag.destroy();
        engine.enableEvents();
        theme.enableEvents();
        form.enableEvents();
        form.getConfiguration().enableEvents();
        form.rebuildHashMap();
        form.trigger('load');
        form.repaginateInImmediateMode();
        theme.recomputeInImmediateMode();
        if (null !== selection) {
            selection.enableEvents();
            selection.synchronize();
        }
        (function (themeProperties) {
            for (var i = 0, len = themeProperties.length; i < len; i++) {
                theme.trigger('property-changed', themeProperties[i].name, themeProperties[i].value);
            }
            theme.trigger('changed');
        })(theme.enumerateProperties());
        form.getHeader().updateHTMLContent();
        form.getActionBar().updateDOMAttributes();
        form.updateInstructionsTextAlignment();
        form.updateLabelTextAlignment();
        form.updateTextDirection();
        form.updateLabelPlacement();
        form.getEngine().getLoader().execCommand('form-name-changed');
        form.getCaptcha().onCreated();
        form.setupCaptcha();
        form.getEngine().getTheme().updateCustomFormCSSFromUrl();
        form.getEngine().getTheme().updateCustomFormCSSText();
        console.timeEnd('unserialize');
        form.getEngine().getLoader().trigger('unserialize');
    };
    UnserializerV0_5.UNSERIALIZER_VERSION = 'v0.5';
    UnserializerV0_5.SERIALIZED_NODE_CHUNK_LENGTH = 8;
    UnserializerV0_5.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH = 5;
    UnserializerV0_5.POS_NODE_TYPE_ID = 0;
    UnserializerV0_5.POS_NODE_ID = 1;
    UnserializerV0_5.POS_NODE_HASH = 2;
    UnserializerV0_5.POS_NODE_PROPERTIES = 3;
    UnserializerV0_5.POS_NODE_ERRORS = 4;
    UnserializerV0_5.POS_NODE_CHILDREN = 5;
    UnserializerV0_5.POS_NODE_COLSPAN = 6;
    UnserializerV0_5.POS_NODE_HEIGHT = 7;
    UnserializerV0_5.POS_FORM_HEADER = 8;
    UnserializerV0_5.POS_FORM_CAPTCHA = 9;
    UnserializerV0_5.POS_FORM_ACTIONBAR = 10;
    UnserializerV0_5.POS_FORM_THEME = 11;
    UnserializerV0_5.POS_FORM_CONFIG = 12;
    return UnserializerV0_5;
}());
var UnserializerV0_6 = (function () {
    function UnserializerV0_6(engine) {
        this.engine = engine;
    }
    UnserializerV0_6.prototype.readFormNode = function (fromStructure, form, theme, engine, bag) {
        var nodeTypeId, nodeId, properties, nodeChildren, nodeErrors, localReadResult, embeddedHeader, embeddedCaptcha, embeddedActionBar, embeddedFormTheme, formConfiguration, formSettings;
        if (!(fromStructure instanceof Array)) {
            throw new Error('Error unserializing structure: Array expected!');
        }
        if (fromStructure[0] !== UnserializerV0_6.UNSERIALIZER_VERSION) {
            throw new Error('Unserializer version mismatch: got ' + JSON.stringify(fromStructure[0]) + ', expected ' + JSON.stringify(FormUnserializer.LATEST_VERSION));
        }
        else {
            fromStructure.splice(0, 1);
        }
        if (fromStructure.length != UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH + UnserializerV0_6.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH) {
            throw new Error('The root structure of a serialized form must have exactly ' + (UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH + UnserializerV0_6.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH) + ' items, but this structure has ' + (fromStructure.length) + ' items');
        }
        nodeTypeId = fromStructure[UnserializerV0_6.POS_NODE_TYPE_ID];
        nodeId = fromStructure[UnserializerV0_6.POS_NODE_ID];
        properties = fromStructure[UnserializerV0_6.POS_NODE_PROPERTIES];
        nodeErrors = fromStructure[UnserializerV0_6.POS_NODE_ERRORS];
        nodeChildren = fromStructure[UnserializerV0_6.POS_NODE_CHILDREN];
        embeddedHeader = fromStructure[UnserializerV0_6.POS_FORM_HEADER];
        embeddedCaptcha = fromStructure[UnserializerV0_6.POS_FORM_CAPTCHA];
        embeddedActionBar = fromStructure[UnserializerV0_6.POS_FORM_ACTIONBAR];
        embeddedFormTheme = fromStructure[UnserializerV0_6.POS_FORM_THEME];
        formConfiguration = fromStructure[UnserializerV0_6.POS_FORM_CONFIG];
        formSettings = fromStructure[UnserializerV0_6.POS_FORM_SETTINGS];
        if (nodeTypeId !== ElementTypes.ELEMENT_TYPE_FORM) {
            throw new Error('The value of element[0] in a serialized form must be exactly ' + JSON.stringify(ElementTypes.ELEMENT_TYPE_FORM));
        }
        form['withProperties'](properties);
        form['id'] = nodeId;
        form.withErrors(nodeErrors);
        if (!(embeddedHeader && embeddedHeader instanceof Array)) {
            throw new Error('Error deserializing form: The embedded header is not a <IFormSerializationData>');
        }
        if (embeddedHeader.length !== UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Header length mismatch: got ' + JSON.stringify(embeddedHeader.length) + ', expected ' + JSON.stringify(UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedHeader[0] !== ElementTypes.CONTROL_TYPE_FORM_HEADER) {
            throw new Error('Error deserializing form: Header element type id mismatch: got ' + JSON.stringify(embeddedHeader[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_FORM_HEADER));
        }
        if (!(embeddedCaptcha && embeddedCaptcha instanceof Array)) {
            throw new Error('Error deserializing form: The embedded captcha is not a <IFormSerializationData>!');
        }
        if (embeddedCaptcha.length !== UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Captcha length mismatch: got ' + JSON.stringify(embeddedCaptcha.length) + ', expected ' + JSON.stringify(UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedCaptcha[0] !== ElementTypes.CONTROL_TYPE_CAPTCHA) {
            throw new Error('Error deserializing form: Captcha element type id mismatch: got ' + JSON.stringify(embeddedCaptcha[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_CAPTCHA));
        }
        if (!(embeddedActionBar && embeddedActionBar instanceof Array)) {
            throw new Error('Error deserializing form: The embedded footer is not a <IFormSerializationData>');
        }
        if (embeddedActionBar.length !== UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Error deserializing form: Header length mismatch: got ' + JSON.stringify(embeddedActionBar.length) + ', expected ' + JSON.stringify(UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH));
        }
        if (embeddedActionBar[0] !== ElementTypes.CONTROL_TYPE_ACTION_BAR) {
            throw new Error('Error deserializing form: ActionBar element type id mismatch: got ' + JSON.stringify(embeddedActionBar[0]) + ', expected ' + JSON.stringify(ElementTypes.CONTROL_TYPE_ACTION_BAR));
        }
        if (null !== formConfiguration && !(formConfiguration instanceof Object)) {
            throw new Error('Error deserializing form: Configuration property should be null|object');
        }
        if (null !== formSettings && !(Array.isArray(formSettings))) {
            throw new Error('Error deserializing form: Settings property should be array|null');
        }
        form.getHeader()
            .withId(embeddedHeader[UnserializerV0_6.POS_NODE_ID])['withProperties'](embeddedHeader[UnserializerV0_6.POS_NODE_PROPERTIES]);
        form.getCaptcha()
            .withId(embeddedCaptcha[UnserializerV0_6.POS_NODE_ID])['withProperties'](embeddedCaptcha[UnserializerV0_6.POS_NODE_PROPERTIES]);
        form.getActionBar()
            .withId(embeddedActionBar[UnserializerV0_6.POS_NODE_ID])['withProperties'](embeddedActionBar[UnserializerV0_6.POS_NODE_PROPERTIES]);
        if (embeddedFormTheme instanceof Array) {
            for (var i = 0, len = embeddedFormTheme.length; i < len; i++) {
                theme.setProperty(embeddedFormTheme[i].name, embeddedFormTheme[i].value);
            }
        }
        if (null !== formConfiguration) {
            for (var k in formConfiguration) {
                if (formConfiguration.hasOwnProperty(k)) {
                    form.getConfiguration().withProperty(k, formConfiguration[k]);
                }
            }
        }
        if (null !== formSettings) {
            for (var i = 0, len = formSettings.length; i < len; i++) {
                var setting = engine.getFactory().createEditorSettingByTypeId(formSettings[i], form, formSettings[i + 1]);
                if (formSettings[i + 2] && formSettings[i + 2].length) {
                    for (var k = 0, n = formSettings[i + 2].length; k < n; k++) {
                        setting.withError(formSettings[i + 2][k]);
                    }
                }
                form.withEditorSetting(setting);
                i += 2;
            }
        }
        theme.recomputeInImmediateMode();
        if (null !== nodeChildren) {
            localReadResult = {
                node: null,
                nextReadIndex: 0
            };
            do {
                localReadResult = this.readNextNode(nodeChildren, localReadResult.nextReadIndex, engine, bag);
                if (null !== localReadResult) {
                    form.appendChild(localReadResult.node);
                }
            } while (null !== localReadResult);
        }
    };
    UnserializerV0_6.prototype.readNextNode = function (fromStructure, startingIndex, engine, bag) {
        var structureLength = (fromStructure || []).length, nodeTypeId, nodeId, properties, nodeChildren, nodeColspan, nodeHeight, nodeErrors, element, nodeHash, localReadResult;
        if (!(fromStructure instanceof Array)) {
            return null;
        }
        if (!(fromStructure.length)) {
            return null;
        }
        if (startingIndex === structureLength) {
            return null;
        }
        if (startingIndex > structureLength - UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH) {
            throw new Error('Unserialize failed: Read outside serialized data bounds!');
        }
        nodeTypeId = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_TYPE_ID];
        nodeId = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_ID];
        nodeHash = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_HASH];
        properties = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_PROPERTIES];
        nodeErrors = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_ERRORS];
        nodeChildren = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_CHILDREN];
        nodeColspan = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_COLSPAN];
        nodeHeight = fromStructure[startingIndex + UnserializerV0_6.POS_NODE_HEIGHT];
        element = bag.createElement(nodeTypeId, properties, nodeId, nodeColspan, nodeHeight, nodeErrors, nodeHash);
        if (null !== nodeChildren) {
            localReadResult = {
                node: null,
                nextReadIndex: 0
            };
            do {
                localReadResult = this.readNextNode(nodeChildren, localReadResult.nextReadIndex, engine, bag);
                if (null !== localReadResult) {
                    element.appendChild(localReadResult.node);
                }
            } while (null !== localReadResult);
        }
        return {
            node: element,
            nextReadIndex: startingIndex + UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH,
        };
    };
    UnserializerV0_6.prototype.unserialize = function (fromStructure, useUnserializerBag) {
        console.time('unserialize');
        var form = this.engine.getDocument(), theme = this.engine.getTheme(), engine = this.engine, bag = form.createUnserializerBag(!useUnserializerBag);
        form.clear();
        form.disableEvents();
        form.getConfiguration().disableEvents();
        theme.disableEvents();
        engine.disableEvents();
        var selection = engine.getLoader().getSelection();
        this.readFormNode(fromStructure, form, theme, engine, bag);
        bag.reinitReusedElements();
        bag.destroy();
        engine.enableEvents();
        theme.enableEvents();
        form.enableEvents();
        form.getConfiguration().enableEvents();
        form.rebuildHashMap();
        form.trigger('load');
        form.repaginateInImmediateMode();
        theme.recomputeInImmediateMode();
        if (null !== selection) {
            selection.enableEvents();
            selection.synchronize();
        }
        (function (themeProperties) {
            for (var i = 0, len = themeProperties.length; i < len; i++) {
                theme.trigger('property-changed', themeProperties[i].name, themeProperties[i].value);
            }
            theme.trigger('changed');
        })(theme.enumerateProperties());
        form.getHeader().updateHTMLContent();
        form.getActionBar().updateDOMAttributes();
        form.updateInstructionsTextAlignment();
        form.updateLabelTextAlignment();
        form.updateTextDirection();
        form.updateLabelPlacement();
        form.getEngine().getLoader().execCommand('form-name-changed');
        form.getCaptcha().onCreated();
        form.setupCaptcha();
        form.getEngine().getTheme().updateCustomFormCSSFromUrl();
        form.getEngine().getTheme().updateCustomFormCSSText();
        console.timeEnd('unserialize');
        form.getEngine().getLoader().trigger('unserialize');
    };
    UnserializerV0_6.UNSERIALIZER_VERSION = 'v0.6';
    UnserializerV0_6.SERIALIZED_NODE_CHUNK_LENGTH = 8;
    UnserializerV0_6.SERIALIZED_FORM_OVERHEAD_CHUNK_LENGTH = 6;
    UnserializerV0_6.POS_NODE_TYPE_ID = 0;
    UnserializerV0_6.POS_NODE_ID = 1;
    UnserializerV0_6.POS_NODE_HASH = 2;
    UnserializerV0_6.POS_NODE_PROPERTIES = 3;
    UnserializerV0_6.POS_NODE_ERRORS = 4;
    UnserializerV0_6.POS_NODE_CHILDREN = 5;
    UnserializerV0_6.POS_NODE_COLSPAN = 6;
    UnserializerV0_6.POS_NODE_HEIGHT = 7;
    UnserializerV0_6.POS_FORM_HEADER = 8;
    UnserializerV0_6.POS_FORM_CAPTCHA = 9;
    UnserializerV0_6.POS_FORM_ACTIONBAR = 10;
    UnserializerV0_6.POS_FORM_THEME = 11;
    UnserializerV0_6.POS_FORM_CONFIG = 12;
    UnserializerV0_6.POS_FORM_SETTINGS = 13;
    return UnserializerV0_6;
}());
var ElementConfigurationModel = (function (_super) {
    __extends(ElementConfigurationModel, _super);
    function ElementConfigurationModel(engine) {
        var _this = _super.call(this) || this;
        _this.properties = {};
        var self = _this;
        _this.on('change', function (propertyName, oldValue, newValue) {
            if (!self.has('hasProcessorsInjected')) {
                return;
            }
            var commandDispatcher = engine.getLoader().getCommandDispatcher();
            if (propertyName === 'isPaymentSandboxEnabled') {
                commandDispatcher.updateEditorSettingsPanel();
                commandDispatcher.refreshPaymentsAvailabilityStatus();
            }
            if (propertyName === 'isPaymentEnabled') {
                if (oldValue !== newValue && !oldValue) {
                    engine.getLoader().getCommandDispatcher().setPaymentsInActivationProcess(true);
                }
                if (newValue === true && !engine.getDocument().hasEditorSetting(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING)) {
                    commandDispatcher.addSetting(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
                }
                if (newValue === false && engine.getDocument().hasEditorSetting(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING)) {
                    var setting = engine.getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
                    engine.getDocument().removeEditorSetting(setting);
                }
            }
        });
        return _this;
    }
    ElementConfigurationModel.prototype.isPrimitive = function (value) {
        var valueType = typeof value;
        return 'string' === valueType
            || ('number' === valueType && isFinite(value))
            || 'boolean' === valueType
            || null === value;
    };
    ElementConfigurationModel.prototype.withProperty = function (propertyName, propertyValue) {
        if ('string' !== typeof propertyName || '' === propertyName) {
            throw new Error('Illegal argument: propertyName: string not empty expected!');
        }
        var oldValue = propertyName in this.properties ? this.properties[propertyName] : null;
        var newValue = propertyValue === undefined ? null : propertyValue;
        this.properties[propertyName] = newValue;
        this.trigger('change', propertyName, oldValue, newValue);
        return this;
    };
    ElementConfigurationModel.prototype.deleteProperty = function (propertyName) {
        if ('string' !== typeof propertyName || '' === propertyName) {
            throw new Error('Illegal argument: propertyName: string not empty expected!');
        }
        if (undefined !== this.properties[propertyName]) {
            delete this.properties[propertyName];
            this.trigger('change');
        }
        return this;
    };
    ElementConfigurationModel.prototype.getProperty = function (propertyName, defaultValue) {
        if (defaultValue === void 0) { defaultValue = null; }
        if ('string' !== typeof propertyName || '' === propertyName) {
            throw new Error('Illegal argument: propertyName: string not empty expected!');
        }
        if (undefined === this.properties[propertyName]) {
            return defaultValue;
        }
        else {
            return this.properties[propertyName];
        }
    };
    ElementConfigurationModel.prototype.has = function (propertyName) {
        if ('string' !== typeof propertyName || '' === propertyName) {
            return false;
        }
        return undefined !== this.properties[propertyName];
    };
    ElementConfigurationModel.prototype.clear = function () {
        this.properties = {};
    };
    ElementConfigurationModel.prototype.toObject = function () {
        return JSON.parse(JSON.stringify(this.properties));
    };
    return ElementConfigurationModel;
}(EventEmitter));
var WidgetFormControl = (function (_super) {
    __extends(WidgetFormControl, _super);
    function WidgetFormControl(form, elementProperties) {
        var _this = _super.call(this, form, elementProperties) || this;
        _this.isWidgetLoaded = false;
        _this.widgetIframeNode = document.createElement('iframe');
        _this.getRootNode().appendChild(_this.widgetIframeNode);
        _this.widgetIframeNode.setAttribute('data-widget-iframe', '1');
        _this.widgetIframeNode.setAttribute('id', 'widget-iframe-' + _this.getHash());
        _this.widgetIconNode = document.createElement('div');
        _this.widgetIconNode.setAttribute('data-widget-icon-container', '1');
        _this.getRootNode().appendChild(_this.widgetIconNode);
        _this.widgetIframeNode.addEventListener('load', function () {
            if (_this.widgetIframeNode.getAttribute('src')) {
                _this.getRootNode().removeAttribute('data-widget-placeholder');
                _this.isWidgetLoaded = true;
            }
        }, true);
        return _this;
    }
    WidgetFormControl.prototype.getPropertyDescriptorByInputIndex = function (inputIndex) {
        return null;
    };
    WidgetFormControl.prototype.getResizingCapability = function () {
        if (!this.isWidgetLoaded) {
            return EResizingCapability.LEFT_AND_RIGHT;
        }
        else {
            return EResizingCapability.ALL;
        }
    };
    WidgetFormControl.prototype.setRendererType = function (newRendererType) {
    };
    WidgetFormControl.prototype.isRenderingSupported = function () {
        return false;
    };
    WidgetFormControl.prototype.onCreated = function () {
        this.generateProperLinkForIframe();
    };
    WidgetFormControl.prototype.updateIframeOptions = function (iframeSource) {
        if (iframeSource) {
            this.widgetIframeNode.setAttribute('src', iframeSource);
            this.getRootNode().removeAttribute('data-widget-placeholder');
            this.isWidgetLoaded = true;
        }
        else {
            this.getRootNode().setAttribute('data-widget-placeholder', '1');
            this.isWidgetLoaded = false;
        }
        this.widgetIframeNode.setAttribute('frameborder', '0');
    };
    WidgetFormControl.attributes = {};
    WidgetFormControl.runtime = null;
    return WidgetFormControl;
}(FormControl));
var FormContainer = (function (_super) {
    __extends(FormContainer, _super);
    function FormContainer() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.children = [];
        return _this;
    }
    FormContainer.prototype.getDOMInsertionNode = function () {
        return this.rootNode;
    };
    FormContainer.prototype.hasChild = function (element) {
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === element) {
                return true;
            }
        }
        return false;
    };
    FormContainer.prototype.appendChild = function (child) {
        if (!child) {
            throw new Error('Attempted to append a invalid element!');
        }
        var wasInTheSameParentBeforeInsertion = false;
        if (null !== child.getParent() && child.getParent().hasChild(child)) {
            for (var i = 0, len = this.children.length; i < len; i++) {
                if (child === this.children[i]) {
                    this.children.splice(i, 1);
                    wasInTheSameParentBeforeInsertion = true;
                    break;
                }
            }
            if (!wasInTheSameParentBeforeInsertion) {
                child.getParent().removeChild(child);
            }
        }
        this.children.push(child);
        child.withParent(this);
        this.getDOMInsertionNode().appendChild(child.getRootNode());
        if (!wasInTheSameParentBeforeInsertion && this.isAttached()) {
            this.getForm().trigger('node-insertion', child);
        }
        if (!wasInTheSameParentBeforeInsertion) {
            this.getRootNode().setAttribute('data-num-children', String(this.children.length));
        }
        return child;
    };
    FormContainer.prototype.removeChild = function (element) {
        var wasRemoved = false, rootNode;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === element) {
                this.children.splice(i, 1);
                wasRemoved = true;
                break;
            }
        }
        if (!wasRemoved) {
            throw new Error('Attempted to remove a non-existent element!');
        }
        element.withParent(null);
        if ((rootNode = element.getRootNode()).parentNode) {
            rootNode.parentNode.removeChild(rootNode);
        }
        if (this.isAttached()) {
            this.getForm().trigger('node-removal', element);
        }
        this.getRootNode().setAttribute('data-num-children', String(this.children.length));
        return element;
    };
    FormContainer.prototype.getChildren = function () {
        return this.children.slice(0);
    };
    FormContainer.prototype.getLayoutDirection = function () {
        return ELayoutDirection.TOP_TO_BOTTOM;
    };
    FormContainer.prototype.createRootNodeElement = function () {
        this.rootNode = document.createElement('div');
        this.rootNode.setAttribute('data-role', 'container');
        this.rootNode.setAttribute('data-type', this._static().nodeName);
        this.rootNode.setAttribute('data-hash', this.getHash());
        this.rootNode.setAttribute('data-type-id', String(this.getTypeId()));
        this.updateLabelItalicState();
        this.updateLabelBoldState();
        this.updateLabelHiddenState();
    };
    FormContainer.prototype.insertBefore = function (referenceChild, child) {
        if (!child) {
            throw new Error('Invalid argument "child": IFormElement expected!');
        }
        if (referenceChild === child) {
            throw new Error('Invalid argument: reference and child are the same!');
        }
        var wasPreviouslyInserted = false;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === child) {
                this.children.splice(i, 1);
                wasPreviouslyInserted = true;
                break;
            }
        }
        var referenceChildIndex = -1;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === referenceChild) {
                referenceChildIndex = i;
                break;
            }
        }
        if (-1 === referenceChildIndex) {
            throw new Error('Insertion failed: reference child is not contained by it\'s parent');
        }
        this.children.splice(referenceChildIndex, 0, child);
        if (!wasPreviouslyInserted && null !== child.getParent()) {
            child.getParent().removeChild(child);
        }
        child.withParent(this);
        this.getDOMInsertionNode().insertBefore(child.getRootNode(), referenceChild.getRootNode());
        if (!wasPreviouslyInserted && this.isAttached()) {
            this.getForm().trigger('node-insertion', child);
        }
        if (!wasPreviouslyInserted) {
            this.getRootNode().setAttribute('data-num-children', String(this.children.length));
        }
        return child;
    };
    FormContainer.prototype.insertAfter = function (referenceChild, child) {
        if (!child) {
            throw new Error('Invalid argument "child": IFormElement expected!');
        }
        if (referenceChild === child) {
            throw new Error('Invalid argument: reference and child are the same!');
        }
        var wasPreviouslyInserted = false;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === child) {
                this.children.splice(i, 1);
                wasPreviouslyInserted = true;
                break;
            }
        }
        var referenceChildIndex = -1;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === referenceChild) {
                referenceChildIndex = i;
                break;
            }
        }
        if (-1 === referenceChildIndex) {
            throw new Error('Insertion failed: reference child is not contained by it\'s parent');
        }
        this.children.splice(referenceChildIndex + 1, 0, child);
        if (!wasPreviouslyInserted && null !== child.getParent()) {
            child.getParent().removeChild(child);
        }
        child.withParent(this);
        this.getDOMInsertionNode().insertBefore(child.getRootNode(), referenceChild.getRootNode().nextSibling);
        if (!wasPreviouslyInserted && this.isAttached()) {
            this.getForm().trigger('node-insertion', child);
        }
        if (!wasPreviouslyInserted) {
            this.getRootNode().setAttribute('data-num-children', String(this.children.length));
        }
        return child;
    };
    FormContainer.prototype.getFirstChild = function () {
        return this.children[0] || null;
    };
    FormContainer.prototype.getLastChild = function () {
        return this.children[this.children.length - 1] || null;
    };
    FormContainer.prototype.flatten = function () {
        var result = [this];
        for (var i = 0, len = this.children.length; i < len; i++) {
            for (var j = 0, sub = this.children[i].flatten(), n = sub.length; j < n; j++) {
                result.push(sub[j]);
            }
        }
        return result;
    };
    FormContainer.prototype.serialize = function () {
        var children = null;
        if (null !== this.children) {
            children = [];
            for (var i = 0, len = this.children.length; i < len; i++) {
                for (var childSerializeData = this.children[i].serialize(), j = 0, n = childSerializeData.length; j < n; j++) {
                    children.push(childSerializeData[j]);
                }
            }
        }
        return [
            this.getTypeId(),
            this.getId(),
            this.getHash(),
            this.properties || null,
            this.errors || null,
            children,
            this.getColspan(),
            this.getHeight(),
        ];
    };
    FormContainer.prototype.getElementKind = function () {
        return EElementKind.CONTAINER;
    };
    FormContainer.prototype.removeAllChildren = function () {
        this.getDOMInsertionNode().innerHTML = '';
        this.children.splice(0, this.children.length);
    };
    FormContainer.prototype.withColspan = function (colspan) {
        if (null === colspan ||
            this.getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE ||
            this.getTypeId() === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE ||
            this.getTypeId() === ElementTypes.CONTAINER_TYPE_ROW ||
            this.getTypeId() === ElementTypes.ELEMENT_TYPE_FORM) {
            return _super.prototype.withColspan.call(this, colspan);
        }
        var minimumColspanThatICanHave = null, currentMinColspan;
        for (var i = 0, len = this.children.length; i < len; i++) {
            currentMinColspan = this.children[i].getMinColspan();
            if (null === minimumColspanThatICanHave || currentMinColspan > minimumColspanThatICanHave) {
                minimumColspanThatICanHave = currentMinColspan;
            }
        }
        if (minimumColspanThatICanHave > colspan) {
            return this;
        }
        for (var i = 0, len = this.children.length; i < len; i++) {
            this.children[i].withColspan(colspan);
        }
        return _super.prototype.withColspan.call(this, colspan);
    };
    FormContainer.prototype.enumerateDisabledProperties = function () {
        var result = this.getParent()
            ? this.getParent().enumerateDisabledProperties()
            : null;
        return result;
    };
    return FormContainer;
}(FormElement));
var Form = (function (_super) {
    __extends(Form, _super);
    function Form(engine, elementProperties) {
        var _this = _super.call(this, null, elementProperties) || this;
        _this.hashMap = {};
        _this.hashMapKeys = [];
        _this.orphanElementsHashMap = {};
        _this.numberOfPages = 0;
        _this.hasPaymentSummaryPage = false;
        _this.currentPageIndex = null;
        _this.previewOnlyMode = false;
        _this.previewModeListeners = [];
        _this.editorSettings = [];
        _this.engine = engine;
        _this.rootNode = engine.getForm();
        _this.errorsDOMNode = document.createElement('div');
        _this.errorsDOMNode.setAttribute('data-role', 'form-errors');
        _this['form'] = _this;
        _this.configuration = new ElementConfigurationModel(_this.getEngine());
        _this.init();
        _this.updateInstructionsTextAlignment();
        _this.updateLabelTextAlignment();
        _this.updateTextDirection();
        _this.updateLabelPlacement();
        _this.updateErrorsText();
        return _this;
    }
    Form.prototype.getTypeId = function () {
        return ElementTypes.ELEMENT_TYPE_FORM;
    };
    Form.prototype.getElementName = function () {
        return 'Form';
    };
    Form.getConfiguration = function () {
        return null;
    };
    Form.prototype.getControlsList = function () {
        var result = [];
        for (var allElements = this.flatten(), i = 0, len = allElements.length; i < len; i++) {
            if (allElements[i].getElementKind() === EElementKind.CONTROL) {
                result.push(allElements[i]);
            }
        }
        return result;
    };
    Form.prototype.getSelectableControls = function () {
        var elements = this.flatten();
        var result = [];
        _.forEach(elements, function (element) {
            var kind = element.getElementKind();
            var typeId = element.getTypeId();
            var isBasicControl = kind === EElementKind.CONTROL && typeId !== ElementTypes.CONTROL_TYPE_LIKERT_SCALE;
            var isLikertContainer = kind === EElementKind.CONTAINER && typeId === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER;
            var isRepeatableContainer = kind === EElementKind.CONTAINER && typeId === ElementTypes.CONTAINER_TYPE_REPEATABLE;
            if (!isBasicControl && !isLikertContainer && !isRepeatableContainer) {
                return;
            }
            result.push(element);
        });
        return result;
    };
    Form.prototype.getPageWidth = function () {
        var widthInPixels = this.getProperty('options.widthInPixels'), widthInPercents = this.getProperty('options.widthInPercents'), documentSize = this.engine.getDocumentSize(), result;
        if (null === widthInPercents && null === widthInPixels) {
            widthInPercents = 100;
        }
        if (null !== widthInPercents && widthInPercents > 100) {
            widthInPercents = 100;
        }
        if (null !== widthInPixels) {
            result = widthInPixels;
        }
        else if (null !== widthInPercents) {
            result = ~~((documentSize.width / 100) * widthInPercents);
        }
        if (this.engine.getLoader().getLoaderDependency(ELoaderDependency.DISABLED_MOBILE_INTERACTION)) {
            if (Math.min(result, documentSize.width) === 0) {
                return Math.max(result, documentSize.width);
            }
        }
        return Math.min(result, documentSize.width);
    };
    Form.prototype.createRootNodeElement = function () {
    };
    Form.prototype.getRootNode = function () {
        return this.engine.getForm();
    };
    Form.prototype.getForm = function () {
        return this;
    };
    Form.prototype.getParent = function () {
        return null;
    };
    Form.prototype.isAttached = function () {
        return true;
    };
    Form.prototype.init = function () {
        var loaderType = this.getEngine().getLoader().getLoaderType();
        switch (loaderType) {
            case EFormLoaderType.EDIT:
                this.getRootNode().setAttribute('data-loader-type', 'editor');
                break;
            case EFormLoaderType.VIEW:
                this.getRootNode().setAttribute('data-loader-type', 'viewer');
                break;
        }
        this.header = this.engine.createElement(ElementTypes.CONTROL_TYPE_FORM_HEADER, undefined, this);
        this.actionBar = this.engine.createElement(ElementTypes.CONTROL_TYPE_ACTION_BAR, undefined, this);
        this.captcha = this.engine.createElement(ElementTypes.CONTROL_TYPE_CAPTCHA, undefined, this);
        this.setupCaptcha();
        this.header.setAttached(true);
        this.actionBar.setAttached(true);
        this.captcha.setAttached(true);
        (function (self) {
            var languageCodes;
            self.realTimeCalculationsThrottler = Throttle.create(function () {
                self.trigger('calculate', false);
            }, 250);
            Object.defineProperty(window, '$9', {
                "get": function () {
                    return self.activeElement || null;
                },
                "set": function () {
                    throw new Error('Property is read-only!');
                }
            });
            self.repaginate = Throttle.create(function () {
                if (self.isEventTriggeringEnabled()) {
                    self.repaginateInImmediateMode();
                }
            }, 0);
            self.on('node-insertion', function (node) {
                var nodeList = node.flatten();
                for (var i = 0, len = nodeList.length; i < len; i++) {
                    self.hashMap[nodeList[i].getHash()] = nodeList[i];
                    nodeList[i].setAttached(true);
                }
                self.hashMapKeys = Object.keys(self.hashMap);
                self.trigger('node-insertion-trigger', node);
                self.trigger('change');
            });
            self.on('node-removal', function (node) {
                var nodeList = node.flatten();
                for (var i = 0, len = nodeList.length; i < len; i++) {
                    delete self.hashMap[nodeList[i].getHash()];
                    nodeList[i].setAttached(false);
                }
                self.hashMapKeys = Object.keys(self.hashMap);
                self.trigger('change');
            });
            self.on('node-attribute-changed', function (node, attributeName, newAttributeValue) {
                self.trigger('change');
            });
            if ((languageCodes = self.getEngine().getLoader().getLoaderDependency(ELoaderDependency.TRANSLATIONS_LANGUAGE_CODES)) && (languageCodes.length > 1)) {
                self.getRootNode().setAttribute('data-has-language-selector', '');
            }
            self.on('translate', function () {
                self.getHeader().setupI18n();
                self.getCaptcha().setupI18n();
                PaymentsSummaryHelper.getInstance().setupI18n();
                for (var i = 0, controls = self.getControlsList(), len = controls.length; i < len; i++) {
                    controls[i].setupI18n();
                }
            });
            self.configuration.on('change', function () {
                self.trigger('change');
            });
            var formSettings = self.getEngine().getLoader().getLoaderDependency(ELoaderDependency.FORM_SETTINGS);
            if (formSettings) {
                if (formSettings.allowPreviewMode) {
                    self.rootNode.setAttribute('data-allow-preview-mode', '');
                }
            }
        })(this);
    };
    Form.prototype.getEngine = function () {
        return this.engine;
    };
    Form.prototype.appendChild = function (element) {
        if (!element || (element.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE && element.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE)) {
            throw new Error('Element type ' + element.getElementName() + ' is not supported directly in the form root!');
        }
        var result;
        if (element.getTypeId() === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
            this.getDOMInsertionNode().appendChild(element.getPageSeparatorDOMNode());
            result = _super.prototype.appendChild.call(this, element);
        }
        else {
            result = _super.prototype.appendChild.call(this, element);
            this.getDOMInsertionNode().appendChild(element.getPageSeparatorDOMNode());
        }
        var editorSettingsPanel = this.engine.getLoader().getLoaderDependency(ELoaderDependency.EDITOR_SETTINGS_PANEL);
        if (editorSettingsPanel) {
            this.getDOMInsertionNode().appendChild(editorSettingsPanel);
        }
        this.repaginate();
        return result;
    };
    Form.prototype.insertBefore = function (referenceChild, child) {
        if (!child || (child.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE && child.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE)) {
            throw new Error('Element type not supported directly in the form root!');
        }
        if (referenceChild === child) {
            throw new Error('Invalid argument: reference and child are the same!');
        }
        var wasPreviouslyInserted = false;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === child) {
                this.children.splice(i, 1);
                wasPreviouslyInserted = true;
                break;
            }
        }
        var referenceChildIndex = -1;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === referenceChild) {
                referenceChildIndex = i;
                break;
            }
        }
        if (-1 === referenceChildIndex) {
            throw new Error('Insertion failed: reference child is not contained by it\'s parent');
        }
        this.children.splice(referenceChildIndex, 0, child);
        if (!wasPreviouslyInserted && null !== child.getParent()) {
            child.getParent().removeChild(child);
        }
        child.withParent(this);
        this.getDOMInsertionNode().insertBefore(child.getPageSeparatorDOMNode(), referenceChild.getRootNode());
        this.getDOMInsertionNode().insertBefore(child.getRootNode(), referenceChild.getRootNode());
        if (!wasPreviouslyInserted && this.isAttached()) {
            this.getForm().trigger('node-insertion', child);
        }
        if (!wasPreviouslyInserted) {
            this.getRootNode().setAttribute('data-num-children', String(this.children.length));
        }
        this.repaginate();
        return child;
    };
    Form.prototype.insertAfter = function (referenceChild, child) {
        if (!child || (child.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE && child.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE)) {
            throw new Error('Element type not supported directly in the form root!');
        }
        if (referenceChild === child) {
            throw new Error('Invalid argument: reference and child are the same!');
        }
        var wasPreviouslyInserted = false;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === child) {
                this.children.splice(i, 1);
                wasPreviouslyInserted = true;
                break;
            }
        }
        var referenceChildIndex = -1;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === referenceChild) {
                referenceChildIndex = i;
                break;
            }
        }
        if (-1 === referenceChildIndex) {
            throw new Error('Insertion failed: reference child is not contained by it\'s parent');
        }
        this.children.splice(referenceChildIndex + 1, 0, child);
        if (!wasPreviouslyInserted && null !== child.getParent()) {
            child.getParent().removeChild(child);
        }
        child.withParent(this);
        this.getDOMInsertionNode().insertBefore(child.getRootNode(), referenceChild.getRootNode().nextSibling.nextSibling);
        this.getDOMInsertionNode().insertBefore(child.getPageSeparatorDOMNode(), child.getRootNode().nextSibling);
        if (!wasPreviouslyInserted && this.isAttached()) {
            this.getForm().trigger('node-insertion', child);
        }
        if (!wasPreviouslyInserted) {
            this.getRootNode().setAttribute('data-num-children', String(this.children.length));
        }
        this.repaginate();
        return child;
    };
    Form.prototype.serialize = function () {
        var ancestorSerialization = _super.prototype.serialize.call(this);
        ancestorSerialization.splice(0, 0, FormUnserializer.LATEST_VERSION);
        if (!(ancestorSerialization instanceof Array)) {
            return ancestorSerialization;
        }
        ancestorSerialization.push(this.header.serialize());
        ancestorSerialization.push(this.captcha.serialize());
        ancestorSerialization.push(this.actionBar.serialize());
        if (this.engine.getTheme().getExternalTheme().hasExternalStorage()) {
            ancestorSerialization.push(null);
        }
        else {
            ancestorSerialization.push(this.engine.getTheme().enumerateProperties());
        }
        ancestorSerialization.push(this.configuration.toObject());
        if (this.editorSettings && this.editorSettings.length) {
            var settings = [];
            for (var i = 0, len = this.editorSettings.length; i < len; i++) {
                var serializedSetting = this.editorSettings[i].serialize();
                for (var j = 0, n = serializedSetting.length; j < n; j++) {
                    settings.push(serializedSetting[j]);
                }
            }
            ancestorSerialization.push(settings);
        }
        else {
            ancestorSerialization.push(null);
        }
        return ancestorSerialization;
    };
    Form.prototype.removeChild = function (element) {
        var wasRemoved = false;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === element) {
                this.children.splice(i, 1);
                wasRemoved = true;
                break;
            }
        }
        if (!wasRemoved) {
            throw new Error('Attempted to remove a non-existent element!');
        }
        if (element.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE && element.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
            throw new Error('Invalid argument: element. PageContainer type expected!');
        }
        element.withParent(null);
        this.getDOMInsertionNode().removeChild(element.getPageSeparatorDOMNode());
        this.getDOMInsertionNode().removeChild(element.getRootNode());
        if (this.isAttached()) {
            this.getForm().trigger('node-removal', element);
        }
        this.getRootNode().setAttribute('data-num-children', String(this.children.length));
        this.repaginate();
        return element;
    };
    Form.prototype.clear = function () {
        var _this = this;
        this.hashMap = {};
        this.hashMapKeys = [];
        this.children = [];
        this.configuration.clear();
        this.editorSettings = [];
        this.getRootNode().innerHTML = '';
        this.getRootNode().appendChild(this.engine.getTheme().getStyleElement());
        setTimeout(function () {
            if (_this.engine.getLoader().getLoaderType() === EFormLoaderType.VIEW) {
                _this.getRootNode().appendChild(_this.engine.getTheme().getFormCustomCSSFromUrlElement());
                _this.getRootNode().appendChild(_this.engine.getTheme().getFormCustomCSSTextStyleElement());
            }
        }, 50);
    };
    Form.prototype.rebuildHashMap = function () {
        this.hashMap = {};
        var elements = this.flatten();
        for (var i = 0, len = elements.length; i < len; i++) {
            this.hashMap[elements[i].getHash()] = elements[i];
        }
        this.hashMapKeys = Object.keys(this.hashMap);
    };
    Form.prototype.getHeader = function () {
        return this.header;
    };
    Form.prototype.withHeader = function (header) {
        this.header = header || null;
        this.repaginate();
        return this;
    };
    Form.prototype.getCouponCode = function () {
        return this.couponCode || null;
    };
    Form.prototype.withCouponCode = function (couponCode) {
        this.couponCode = couponCode || null;
        return this;
    };
    Form.prototype.getActionBar = function () {
        return this.actionBar;
    };
    Form.prototype.withActionBar = function (actionBar) {
        this.actionBar = actionBar || null;
        this.repaginate();
        return this;
    };
    Form.prototype.getCaptcha = function () {
        return this.captcha;
    };
    Form.prototype.repaginateInImmediateMode = function () {
        var currentPageNumber = 0, lastRepaginatedPage = null;
        this.hasPaymentSummaryPage = false;
        for (var i = 0, len = this.children.length; i < len; i++) {
            var typeId = this.children[i].getTypeId();
            if (typeId === ElementTypes.CONTAINER_TYPE_PAGE || typeId === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
                var page = this.children[i];
                page.withIndex(i);
                page.renderFooter();
                page.withIsLastPage(false);
                if (typeId === ElementTypes.CONTAINER_TYPE_PAGE) {
                    lastRepaginatedPage = page;
                }
                else {
                    this.hasPaymentSummaryPage = true;
                }
                currentPageNumber++;
            }
        }
        if (this.hasPaymentSummaryPage) {
            this.getRootNode().setAttribute('data-has-after-submit-payment-summary', '1');
        }
        else {
            this.getRootNode().removeAttribute('data-has-after-submit-payment-summary');
        }
        if (null !== lastRepaginatedPage) {
            lastRepaginatedPage.withIsLastPage(true);
        }
        this.numberOfPages = currentPageNumber;
        this.renderPageHeadersInImmediateMode();
    };
    Form.prototype.renderPageHeadersInImmediateMode = function () {
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i].getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE || this.children[i].getTypeId() === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
                this.children[i].renderHeader();
            }
        }
    };
    Form.prototype.getPageByIndex = function (pageIndex) {
        for (var i = 0, len = this.children.length; i < len; i++) {
            if ((this.children[i].getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE || this.children[i].getTypeId() === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE)
                && pageIndex === this.children[i].getIndex()) {
                return this.children[i];
            }
        }
        return null;
    };
    Form.prototype.getLastPageContainer = function () {
        for (var i = this.numberOfPages - 1; i >= 0; i--) {
            if (this.children[i].getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE) {
                return this.children[i];
            }
        }
        return null;
    };
    Form.prototype.getNumberOfPages = function () {
        if (this.getHasPaymentSummaryPage()) {
            return this.numberOfPages - 1;
        }
        return this.numberOfPages;
    };
    Form.prototype.getNumberOfPagesIncludingPaymentSummary = function () {
        return this.numberOfPages;
    };
    Form.prototype.getHasPaymentSummaryPage = function () {
        return this.hasPaymentSummaryPage;
    };
    Form.prototype.getElementByHash = function (elementHash) {
        var elementInsideOrphanContainers;
        switch (true) {
            case !!this.hashMap[elementHash]:
                return this.hashMap[elementHash];
            case !!this.orphanElementsHashMap[elementHash]:
                return this.orphanElementsHashMap[elementHash];
            case elementHash === this.getHash():
                return this;
            case elementHash === this.header.getHash():
                return this.header;
            case elementHash === this.captcha.getHash():
                return this.captcha;
            case elementHash === this.actionBar.getHash():
                return this.actionBar;
            case this.couponCode && (elementHash === this.couponCode.getHash()):
                return this.couponCode;
            case this.engine.getLoader().getLoaderType() === EFormLoaderType.EDIT && elementHash === VirtualSelectionControl.STATIC_HASH:
                return this.getEngine().getLoader().getSelection().getVirtualControl();
            case !!(elementInsideOrphanContainers = this.findElementByHashInsideOrphans(elementHash)):
                return elementInsideOrphanContainers;
            default:
                return null;
        }
    };
    Form.prototype.getElementById = function (elementId, repeatedIndex) {
        repeatedIndex = repeatedIndex || 0;
        var foundIndex = -1;
        for (var i = 0, length_1 = this.hashMapKeys.length; i < length_1; i++) {
            if (elementId === this.hashMap[this.hashMapKeys[i]].getId()) {
                foundIndex++;
                if (foundIndex === repeatedIndex) {
                    return this.hashMap[this.hashMapKeys[i]];
                }
            }
        }
        return null;
    };
    Form.prototype.getElementsById = function (elementId) {
        var elements = [];
        for (var i = 0, length_2 = this.hashMapKeys.length; i < length_2; i++) {
            if (elementId === this.hashMap[this.hashMapKeys[i]].getId()) {
                elements.push(this.hashMap[this.hashMapKeys[i]]);
            }
        }
        return elements;
    };
    Form.prototype.getElementByIdAndRepeatedPath = function (elementId, repeatedIndex, repeatedPath) {
        repeatedIndex = repeatedIndex || 0;
        repeatedPath = repeatedPath || '';
        var allElementsWithId = this.getElementsById(elementId);
        var foundIndex = -1;
        for (var i = 0; i < allElementsWithId.length; i++) {
            var element = allElementsWithId[i], parentGroup = element.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP);
            var matcher = new RegExp('^' + repeatedPath);
            if (parentGroup && matcher.test(String(parentGroup.getRepeatableGroupPathAttribute()))) {
                foundIndex++;
                if (foundIndex === repeatedIndex) {
                    return element;
                }
            }
        }
        return null;
    };
    Form.prototype.getActiveElement = function () {
        return this.activeElement || null;
    };
    Form.prototype.setActiveElement = function (element) {
        if (element === this.activeElement) {
            return;
        }
        if (this.activeElement) {
            this.activeElement.getRootNode().removeAttribute('data-is-active');
            this.activeElement.onFocusLeave();
            this.trigger('blur', element);
        }
        this.activeElement = element || null;
        if (this.activeElement) {
            this.activeElement.getRootNode().setAttribute('data-is-active', '1');
            this.activeElement.onFocusEnter();
        }
        FormUtils.refreshFrameHeightOnWix();
        this.trigger('focus', element);
    };
    Form.prototype.getDOMInsertionNode = function () {
        return this.engine.getForm();
    };
    Form.prototype.normalize = function () {
        try {
            (function ($, self) {
                var isDocumentNormalized, antiInfiniteNormalizationSentinel = 0, $cssQueryResult, normalizationError = null, numberOfRemovedElementsFromForm = 0;
                do {
                    isDocumentNormalized = true;
                    var _loop_1 = function (i, len) {
                        $cssQueryResult = $(Form.NORMALIZE_RULES[i].cssSelector);
                        if ($cssQueryResult.length) {
                            (function (rule) {
                                $cssQueryResult.each(function () {
                                    if (null !== normalizationError) {
                                        return;
                                    }
                                    var elementHashToBeRemoved = $(this).attr('data-hash');
                                    if (!elementHashToBeRemoved) {
                                        if (this.parentNode) {
                                            this.parentNode.removeChild(this);
                                        }
                                        normalizationError = new Error('While executing the normalization selector ' + JSON.stringify(Form.NORMALIZE_RULES[i]) + ' we found a element which does not have it\'s hash id set. Normalization failed for this reason!');
                                        return;
                                    }
                                    var elementThatIsGoingToBeClearedFromForm = self.getElementByHash(elementHashToBeRemoved);
                                    if (null === elementThatIsGoingToBeClearedFromForm) {
                                        if (this.parentNode) {
                                            this.parentNode.removeChild(this);
                                        }
                                        normalizationError = new Error('While executing the normalization selector ' + JSON.stringify(Form.NORMALIZE_RULES[i]) + ' we found in the DOM a element that does not exist in the form, with hash ' + elementThatIsGoingToBeClearedFromForm + '! Normalization failed for this reason!');
                                        return;
                                    }
                                    var elementParent = elementThatIsGoingToBeClearedFromForm.getParent();
                                    if (null === elementParent) {
                                        if (this.parentNode) {
                                            this.parentNode.removeChild(this);
                                        }
                                        normalizationError = new Error('While executing the normalization selector ' + JSON.stringify(Form.NORMALIZE_RULES[i]) + ' we found in the DOM a element that is not attached in it\'s parent! Normalization failed for this reason!');
                                        return;
                                    }
                                    if (rule.callback) {
                                        rule.callback(elementThatIsGoingToBeClearedFromForm);
                                    }
                                    else {
                                        elementParent.removeChild(elementThatIsGoingToBeClearedFromForm);
                                    }
                                    numberOfRemovedElementsFromForm++;
                                });
                            })(Form.NORMALIZE_RULES[i]);
                            isDocumentNormalized = false;
                        }
                    };
                    for (var i = 0, len = Form.NORMALIZE_RULES.length; i < len; i++) {
                        _loop_1(i, len);
                    }
                    antiInfiniteNormalizationSentinel++;
                    if (null !== normalizationError) {
                        throw normalizationError;
                    }
                    if (antiInfiniteNormalizationSentinel > 1000) {
                        throw new Error('Infinite loop detected in normalization algorithm! The normalization algorithm has been aborted!');
                    }
                    if (numberOfRemovedElementsFromForm > 0) {
                        console.log('gc: automatically removed ' + numberOfRemovedElementsFromForm + ' elements from from');
                    }
                } while (!isDocumentNormalized);
            })(this.engine.getJQuery(), this);
        }
        catch (e) {
            this.rebuildHashMap();
            throw e;
        }
        this.rebuildHashMap();
    };
    Form.addNormalizationSelector = function (cssSelector, optionalNormalizationCallback) {
        if (optionalNormalizationCallback === void 0) { optionalNormalizationCallback = null; }
        if ('string' !== typeof cssSelector || '' === cssSelector) {
            throw new Error('Invalid argument: expected string not empty!');
        }
        if (null !== optionalNormalizationCallback && 'function' !== typeof optionalNormalizationCallback) {
            throw new Error('Invalid argument: ');
        }
        Form.NORMALIZE_RULES.push({
            cssSelector: cssSelector,
            callback: optionalNormalizationCallback
        });
    };
    Form.prototype.updateInstructionsTextAlignment = function () {
        if (this.hasProperty('options.instructionsTextAlignment')) {
            var textAlignment = this.getProperty('options.instructionsTextAlignment');
            switch (textAlignment) {
                case ETextAlignment.CENTER:
                    this.getRootNode().setAttribute('data-instructions-text-alignment', 'center');
                    break;
                case ETextAlignment.JUSTIFY:
                    this.getRootNode().setAttribute('data-instructions-text-alignment', 'justify');
                    break;
                case ETextAlignment.RIGHT:
                    this.getRootNode().setAttribute('data-instructions-text-alignment', 'right');
                    break;
                default:
                    this.getRootNode().setAttribute('data-instructions-text-alignment', 'left');
                    break;
            }
        }
        else {
            this.getRootNode().removeAttribute('data-instructions-text-alignment');
        }
    };
    Form.prototype.updateLabelPlacement = function () {
        if (this.hasProperty('options.labelPlacement')) {
            var labelPlacement = this.getProperty('options.labelPlacement');
            switch (labelPlacement) {
                case EFormLabelPlacement.RIGHT_ALIGNED:
                    this.getRootNode().setAttribute('data-label-placement', 'right');
                    break;
                case EFormLabelPlacement.TOP_ALIGNED:
                    this.getRootNode().setAttribute('data-label-placement', 'top');
                    break;
                case EFormLabelPlacement.LEFT_ALIGNED:
                default:
                    this.getRootNode().setAttribute('data-label-placement', 'left');
                    break;
            }
        }
    };
    Form.prototype.updateLabelTextAlignment = function () {
        if (this.hasProperty('options.labelTextAlignment')) {
            var textAlignment = this.getProperty('options.labelTextAlignment');
            switch (textAlignment) {
                case ETextAlignment.CENTER:
                    this.getRootNode().setAttribute('data-label-text-alignment', 'center');
                    break;
                case ETextAlignment.JUSTIFY:
                    this.getRootNode().setAttribute('data-label-text-alignment', 'justify');
                    break;
                case ETextAlignment.RIGHT:
                    this.getRootNode().setAttribute('data-label-text-alignment', 'right');
                    break;
                default:
                    this.getRootNode().setAttribute('data-label-text-alignment', 'left');
                    break;
            }
        }
        else {
            this.getRootNode().removeAttribute('data-label-text-alignment');
        }
    };
    Form.prototype.updateTextDirection = function () {
        if (this.hasProperty('options.direction')) {
            var textDirection = this.getProperty('options.direction');
            switch (textDirection) {
                case EFormTextDirection.RIGHT_TO_LEFT:
                    this.getRootNode().setAttribute('data-text-direction', 'rtl');
                    break;
                default:
                    this.getRootNode().setAttribute('data-text-direction', 'ltr');
                    break;
            }
            this.trigger('update-text-direction');
        }
        else {
            this.getRootNode().removeAttribute('data-text-direction');
        }
    };
    Form.prototype.getLabelPlacement = function () {
        if (this.engine.getTheme().isMobileLayout()) {
            return EFormLabelPlacement.TOP_ALIGNED;
        }
        else {
            return this.getProperty('options.labelPlacement');
        }
    };
    Form.prototype.getInstructionsPlacement = function () {
        if (this.engine.getTheme().isMobileLayout()) {
            return EFormInstructionsPlacement.BELOW_LABEL;
        }
        else {
            return this.getProperty('options.instructionsPlacement');
        }
    };
    Form.prototype.createUnserializerBag = function (dummy) {
        var result = new UnserializerBag(this, this.engine), element;
        if (!dummy) {
            for (var i = 0, length_3 = this.hashMapKeys.length; i < length_3; i++) {
                element = this.hashMap[this.hashMapKeys[i]];
                result.add(this.hashMapKeys[i], element);
            }
        }
        return result;
    };
    Form.prototype.getParentPage = function () {
        return null;
    };
    Form.prototype.getMaxColspan = function () {
        return 20;
    };
    Form.prototype.getColspan = function () {
        return 20;
    };
    Form.prototype.getCouponCodeValue = function () {
        if (this.couponCode) {
            return this.couponCode.getValue().value;
        }
        else {
            return null;
        }
    };
    Form.prototype.calculate = function () {
        var request = {
            formId: this.getId(),
            sessionId: this.engine.getLoader().getSessionId(),
            submission: [],
            couponCode: this.getCouponCodeValue(),
            language: this.engine.getI18n().getLanguageCode(),
        }, controlValue;
        var seenIDsSoFar = {};
        for (var i = 0, controls = this.flatten(), len = controls.length; i < len; i++) {
            controls[i].removeAllBackendErrors();
            if (controls[i].getElementKind() === EElementKind.CONTROL) {
                controlValue = controls[i].getValue();
                if (undefined !== controlValue) {
                    if (undefined === seenIDsSoFar[controls[i].getId()]) {
                        request.submission.push({
                            id: controls[i].getId(),
                            value: controlValue,
                            hash: controls[i].getHash(),
                            typeId: controls[i].getTypeId(),
                            visible: controls[i].isVisible(true)
                        });
                        seenIDsSoFar[controls[i].getId()] = request.submission.length - 1;
                    }
                    else {
                        request.submission[seenIDsSoFar[controls[i].getId()]].repeat = request.submission[seenIDsSoFar[controls[i].getId()]].repeat || [];
                        request.submission[seenIDsSoFar[controls[i].getId()]].repeat.push({
                            id: controls[i].getId(),
                            value: controlValue,
                            hash: controls[i].getHash(),
                            typeId: controls[i].getTypeId(),
                            visible: controls[i].isVisible(true)
                        });
                    }
                }
            }
        }
        return (function ($, self) {
            return $.Deferred(function (defer) {
                self.trigger('calculate-start');
                var submitURL = '/sf_calc_actions.php?formId=' + encodeURIComponent(String(request.formId)) +
                    '&PHPSESSID=' + self.getEngine().getLoader().getSessionId();
                $.ajax({
                    url: submitURL,
                    data: JSON.stringify(request),
                    type: 'POST',
                    crossDomain: false,
                    contentType: "application/json",
                    dataType: 'json',
                }).then(function (response) {
                    self.lastCalculationServerResponse = JSON.parse(JSON.stringify(response));
                    self.trigger('calculate-ok', response);
                    defer.resolve(response);
                }).fail(function (e) {
                    self.lastCalculationServerResponse = null;
                    self.trigger('calculate-error', e);
                    defer.reject(e);
                }).always(function () {
                    self.trigger('calculate-complete');
                });
            }).promise();
        })(this.getEngine().getJQuery(), this);
    };
    Form.prototype.getLastCalculationServerResponse = function () {
        return this.lastCalculationServerResponse || null;
    };
    Form.prototype.getQueryParams = function () {
        var urlParams;
        var match, additionalSymbolToSpace = /\+/g, search = /([^&=]+)=?([^&]*)/g, decode = function (givenMatch) {
            var decodedParam;
            decodedParam = givenMatch.replace(additionalSymbolToSpace, ' ').replace('[%ANDCHAR%]', '&');
            try {
                return decodeURIComponent(decodedParam);
            }
            catch (e) {
                decodedParam = decodedParam.replace(/\[%ANDCHAR%\]/g, '&');
                window['MetricsService'].getInstance().track('decode_URI_failure_after_submit');
                return decodeURIComponent(decodedParam);
            }
        }, queryString = window.location.search.substring(1);
        urlParams = {};
        while (match = search.exec(queryString)) {
            urlParams[decode(match[1])] = decode(match[2]);
        }
        return urlParams;
    };
    Form.prototype.submit = function (action, additionalArguments) {
        if (action === void 0) { action = EFormSubmitAction.SUBMIT; }
        additionalArguments = additionalArguments || {};
        if (undefined === additionalArguments.targetPage) {
            additionalArguments.targetPage = null;
        }
        var queryParams = this.getQueryParams();
        var isWixInstance = queryParams.hasOwnProperty('instance') && queryParams['instance'];
        var isMobileApp = !!window['mobileApp'];
        var submissionUserId = null;
        if (isMobileApp && window['mobileApp']['userId']) {
            submissionUserId = parseInt(window['mobileApp']['userId']);
        }
        var request = {
            action: action,
            formId: this.getId(),
            location: isWixInstance && queryParams['refEn'] !== undefined && queryParams['refEn'] !== null
                ? atob(queryParams['refEn'])
                : (typeof queryParams['ref'] !== 'undefined'
                    ? queryParams['ref']
                    : window.location.toString()),
            referrer: isWixInstance && queryParams['_referrerEn_'] !== undefined && queryParams['_referrerEn_'] !== null
                ? atob(queryParams['_referrerEn_'])
                : (typeof queryParams['_referrer_'] !== 'undefined'
                    ? queryParams['_referrer_']
                    : document.referrer.toString()),
            partial: false,
            sessionId: this.engine.getLoader().getSessionId(),
            submission: [],
            sessionKey: this.engine.getUploadsService().getSessionKey(),
            submissionXMLDateTimeStart: this.engine.getLoader().getLoaderDependency(ELoaderDependency.SUBMISSION_XML_DATETIME_START),
            currentPage: this.getCurrentPageIndex(),
            targetPage: additionalArguments.targetPage,
            totalPages: this.getNumberOfPages(),
            couponCode: this.getCouponCodeValue(),
            language: this.engine.getI18n().getLanguageCode(),
            differenceBetweenClientAndServerTime: this.engine.getLoader().getLoaderDependency(ELoaderDependency.DIFFERENCE_BETWEEN_CLIENT_AND_SERVER_TIME),
            wixUserSessionToken: (document.body.getAttribute('data-wix-user-token') != null
                ? document.body.getAttribute('data-wix-user-token')
                : null),
            isMobileApp: isMobileApp,
            submissionUserId: submissionUserId
        }, controlValue;
        var seenIDsSoFar = {};
        for (var j = 0, controls = this.flatten(), len = controls.length; j < len; j++) {
            var control = controls[j];
            if (control.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP) {
                var repeatableGroup = control;
                repeatableGroup.removeRepeatableAttributes(repeatableGroup);
            }
        }
        for (var i = 0, controls = this.flatten(), len = controls.length; i < len; i++) {
            var control = controls[i];
            if (control.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP) {
                var repeatableGroup = control;
                repeatableGroup.resetRepeatableElementAttributes();
            }
        }
        for (var i = 0, controls = this.flatten(), len = controls.length; i < len; i++) {
            var control = controls[i];
            control.removeAllBackendErrors();
            if (control.getElementKind() === EElementKind.CONTROL) {
                controlValue = control.getValue();
                if (undefined !== controlValue) {
                    if (seenIDsSoFar[control.getId()] === undefined) {
                        var repeatableGroup = control.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP), repeatableGroupPath = '';
                        if (repeatableGroup) {
                            repeatableGroupPath = repeatableGroup.getRepeatableGroupPathAttribute();
                        }
                        request.submission.push({
                            id: control.getId(),
                            value: controlValue,
                            hash: control.getHash(),
                            typeId: control.getTypeId(),
                            visible: control.isVisible(true),
                            path: repeatableGroupPath
                        });
                        seenIDsSoFar[control.getId()] = request.submission.length - 1;
                    }
                    else {
                        var repeatableGroup = control.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP), repeatableGroupPath = '';
                        if (repeatableGroup) {
                            repeatableGroupPath = repeatableGroup.getRepeatableGroupPathAttribute();
                        }
                        request.submission[seenIDsSoFar[control.getId()]].repeat = request.submission[seenIDsSoFar[control.getId()]].repeat || [];
                        request.submission[seenIDsSoFar[control.getId()]].repeat.push({
                            id: control.getId(),
                            value: controlValue,
                            hash: control.getHash(),
                            typeId: control.getTypeId(),
                            visible: control.isVisible(true),
                            path: repeatableGroupPath
                        });
                    }
                }
            }
        }
        this.removeAllBackendErrors();
        this.captcha.removeAllBackendErrors();
        request.submission.push({
            id: this.captcha.getId(),
            value: this.captcha.getValue() || null,
            hash: this.captcha.getHash(),
            typeId: this.captcha.getTypeId(),
            visible: this.captcha.isVisible(),
        });
        request.submission.push({
            id: this.getId(),
            value: null,
            hash: this.getHash(),
            typeId: this.getTypeId(),
            visible: true,
        });
        return (function ($, self) {
            if (EngineToggles.ENABLE_SUBMISSION_PREVENTION_ON_QUIZ_TIMER_EXPIRATION
                && EFormSubmitAction.SWITCH_PAGE !== action
                && -1 === self.engine.getLoader().getLoaderDependency(ELoaderDependency.CURRENT_QUIZ_TIMER)) {
                return $.Deferred(function (defer) {
                    defer.reject(new Error(self.getEngine().getI18n().translateText('textdef_144')));
                }).promise();
            }
            return $.Deferred(function (defer) {
                self.trigger('submit-start', action);
                $(self.getRootNode()).find('[data-role=control][data-type=form-action-bar] button[data-role]').each(function () {
                    this.disabled = true;
                    if (EFormSubmitAction.SUBMIT === action && this.getAttribute('data-role') == 'submit') {
                        if (self.getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW
                            && self.getEngine().getLoader().isEnabledAutoSubmit() === false) {
                            this.setAttribute('data-autosubmit', '');
                        }
                        else {
                            this.setAttribute('data-is-submitting', '');
                        }
                    }
                });
                var submitURL = window.location.toString(), selectedPaymentProcessorTypeId = self.getEngine().getLoader().getLoaderDependency(ELoaderDependency.SELECTED_PAYMENT_PROCESSOR_TYPE_ID);
                if (null !== selectedPaymentProcessorTypeId) {
                    request.selectedPaymentProcessorTypeId = Math.abs(selectedPaymentProcessorTypeId);
                    request.selectedPaymentProcessorExtraParams = self.getEngine().getLoader().getLoaderDependency(ELoaderDependency.SELECTED_PAYMENT_PROCESSOR_EXTRA_DATA);
                    if (selectedPaymentProcessorTypeId < 0) {
                        request.isSecondaryPaymentProcessorTypeId = true;
                    }
                    else {
                        request.isSecondaryPaymentProcessorTypeId = false;
                    }
                }
                if (submitURL.indexOf('PHPSESSID') === -1) {
                    submitURL = self.addParameterToUrl(submitURL, 'PHPSESSID', self.getEngine().getLoader().getSessionId());
                }
                if (self.getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW &&
                    self.getEngine().getLoader().getViewFormEnvironmentContext() === EViewFormEnvironmentContext.MOBILE_APP_OFFLINE) {
                    var response = { "ok": true, "action": EFormSubmitAction.SWITCH_PAGE };
                    self.trigger('submit-ok', response);
                    $(self.getRootNode()).find('[data-role=control][data-type=form-action-bar] button[data-role]').each(function () {
                        this.disabled = false;
                        if (EFormSubmitAction.SUBMIT === action && this.getAttribute('data-role') == 'submit') {
                            this.removeAttribute('data-is-submitting');
                        }
                    });
                    self.trigger('submit-complete', action);
                    if (EFormSubmitAction.SUBMIT === action) {
                        window.postMessage(JSON.stringify({
                            type: 'submission-data',
                            submission: request
                        }), "*");
                    }
                    else if (action === EFormSubmitAction.SAVE_FOR_LATER) {
                        window.postMessage(JSON.stringify({
                            type: 'save-for-later-data',
                            submission: request
                        }), "*");
                    }
                    else {
                        defer.resolve(response);
                    }
                }
                else {
                    $.ajax({
                        url: submitURL,
                        data: JSON.stringify(request),
                        type: 'POST',
                        crossDomain: false,
                        contentType: "application/json",
                        dataType: 'json',
                        headers: {
                            "X-PHPSESSID": request.sessionId
                        }
                    }).then(function (response) {
                        self.trigger('submit-ok', response);
                        defer.resolve(response);
                    }).fail(function (e) {
                        self.trigger('submit-error', e);
                        if (window['CFTracker']) {
                            window['CFTracker'].event('form_submit_invalid_response');
                        }
                        defer.reject(e);
                    }).always(function () {
                        $(self.getRootNode()).find('[data-role=control][data-type=form-action-bar] button[data-role]').each(function () {
                            this.disabled = false;
                            if (EFormSubmitAction.SUBMIT === action && this.getAttribute('data-role') == 'submit') {
                                this.removeAttribute('data-is-submitting');
                            }
                        });
                        self.trigger('submit-complete', action);
                    });
                }
            }).promise();
        })(this.getEngine().getJQuery(), this);
    };
    Form.prototype.addParameterToUrl = function (submitURL, key, value) {
        if (!submitURL) {
            return;
        }
        var hashTagPosition = submitURL.indexOf('#'), hashTag = '', path = submitURL, urlData = [submitURL];
        if (hashTagPosition > -1) {
            urlData = submitURL.split('#');
            hashTag = '#' + urlData[1];
            path = urlData[0];
        }
        var paramsPosition = path.indexOf('?');
        if (paramsPosition > -1) {
            path += "&" + key + "=" + value;
        }
        else {
            path += "?" + key + "=" + value;
        }
        return path + hashTag;
    };
    Form.prototype.reset = function () {
        var abstractionLayer = this.engine.getLoader().getRules().getDOMAbstractionLayer();
        for (var i = 0, elements = this.flatten(), len = elements.length; i < len; i++) {
            if (elements[i].getElementKind() === EElementKind.CONTROL) {
                elements[i].onReset();
                var controlId = "control_" + elements[i].getId();
                abstractionLayer.trigger('control-event', EFormRuleEventType.TEXT_INPUT, elements[i].getRootNode(), controlId, null);
            }
        }
        abstractionLayer.clearControlsCache();
        abstractionLayer.trigger('compute-form-rules');
        this.getCaptcha().onReset();
    };
    Form.prototype.updateErrorsText = function () {
        var errors = this.getErrors();
        if (null === errors) {
            this.getRootNode().removeAttribute('data-has-errors');
            if (this.errorsDOMNode.parentNode) {
                this.errorsDOMNode.parentNode.removeChild(this.errorsDOMNode);
            }
        }
        else {
            this.getRootNode().setAttribute('data-has-errors', '1');
            this.errorsDOMNode.innerHTML = '';
            for (var i = 0, len = errors.length; i < len; i++) {
                this.appendErrorNode(JSON.parse(JSON.stringify(errors[i])));
            }
            this.getRootNode().appendChild(this.errorsDOMNode);
        }
    };
    Form.prototype.appendErrorNode = function (error) {
        var elementTemplateFileName = 'generic-backend-error.html';
        switch (error.code) {
            case FormElement.NET_ERR_FATAL_SUBMISSION_BAD_RESPONSE:
                elementTemplateFileName = '2099-submission-fatal-error.html';
                break;
            case FormElement.BACKEND_ERR_FATAL_FORM_IS_INACTIVE:
            case FormElement.BACKEND_ERR_FATAL_FORM_IS_UNAVAILABLE:
            case FormElement.BACKEND_ERR_FATAL_INVALID_FORM_DOMAIN:
            case FormElement.BACKEND_ERR_FATAL_FORM_GENERAL_MAINTENANCE:
            case FormElement.BACKEND_ERR_FATAL_FORM_GENERIC_EXCEPTION:
            default:
                break;
        }
        (function (self, $) {
            self.getEngine().getResourceManager().get('/modules/Typescript/Form/resources/form-errors/' + elementTemplateFileName)
                .then(function (template) {
                if (self.hasError(error.code)) {
                    var tpl = new Salvage(template);
                    $(self.errorsDOMNode).append(tpl.parse(error));
                }
            })
                .fail(function (e) {
                if (self.hasError(error.code)) {
                    var tpl = new Salvage('<div data-role="error" data-error-code="{{code}}">\n{{code}} - {{message}}</div>');
                    $(self.errorsDOMNode).append(tpl.parse(error));
                }
            });
        })(this, this.engine.getJQuery());
    };
    Form.prototype.addError = function (code, message) {
        var result = _super.prototype.addError.call(this, code, message);
        if (result) {
            this.updateErrorsText();
        }
        return result;
    };
    Form.prototype.removeError = function (code) {
        var result = _super.prototype.removeError.call(this, code);
        if (result) {
            this.updateErrorsText();
        }
        return result;
    };
    Form.prototype.removeAllBackendErrors = function () {
        var result = _super.prototype.removeAllBackendErrors.call(this);
        if (result) {
            this.updateErrorsText();
        }
        return result;
    };
    Form.prototype.withErrors = function (errors) {
        _super.prototype.withErrors.call(this, errors);
        this.updateErrorsText();
        return this;
    };
    Form.prototype.withRules = function (rules) {
        this.rules = rules || null;
        return this;
    };
    Form.prototype.getRules = function () {
        return this.rules || null;
    };
    Form.prototype.updateI18n = function () {
        this.engine.getI18n().translateDOMNode(document.body);
    };
    Form.prototype.getCurrentPageIndex = function () {
        return this.currentPageIndex;
    };
    Form.prototype.setCurrentPageIndex = function (currentPageIndex) {
        if (null !== currentPageIndex) {
            if ('number' !== typeof currentPageIndex || ~~currentPageIndex !== currentPageIndex) {
                throw new Error('Invalid argument: int expected!');
            }
        }
        if (currentPageIndex === this.currentPageIndex) {
            return;
        }
        this.currentPageIndex = currentPageIndex;
        for (var i = 0, len = this.getNumberOfPages(); i < len; i++) {
            if (null === this.currentPageIndex || i === this.currentPageIndex) {
                this.getPageByIndex(i).getRootNode().setAttribute('data-is-current-page', '1');
            }
            else {
                this.getPageByIndex(i).getRootNode().removeAttribute('data-is-current-page');
            }
        }
        this.trigger('page-changed', this.currentPageIndex);
    };
    Form.prototype.isSelectable = function () {
        return false;
    };
    Form.prototype.isDragable = function () {
        return false;
    };
    Form.prototype.getWidthUnit = function () {
        var widthInPixels = this.getProperty('options.widthInPixels'), widthInPercents = this.getProperty('options.widthInPercents');
        if (null !== widthInPixels || null === widthInPercents) {
            return 'px';
        }
        else {
            return '%';
        }
    };
    Form.prototype.setWidthUnit = function (widthUnit) {
        switch (widthUnit) {
            case '%':
                this.setProperty('options.widthInPixels', null);
                if (null === this.getProperty('options.widthInPercents')) {
                    this.setProperty('options.widthInPercents', 100);
                }
                break;
            case 'px':
            default:
                if (null === this.getProperty('options.widthInPixels')) {
                    this.setProperty('options.widthInPixels', 640);
                }
                break;
        }
    };
    Form.prototype.setPreviewMode = function (previewMode) {
        var formSettings = this.engine.getLoader().getLoaderDependency(ELoaderDependency.FORM_SETTINGS);
        if (!formSettings || !formSettings.allowPreviewMode) {
            console.warn('Form::setPreviewMode(): Request ignored, form does not support preview mode!');
            return;
        }
        previewMode = !!previewMode;
        if (previewMode === this.previewOnlyMode) {
            return;
        }
        this.previewOnlyMode = previewMode;
        if (this.previewOnlyMode) {
            this.rootNode.setAttribute('data-is-preview-mode-enabled', '');
            var keyboardCallback = function (e) {
                var target = e.srcElement || e.target;
                if (KeyboardUtils.KEY_TAB === (e.keyCode || e.charCode)
                    ||
                        !(UI.getJQuery()(e.srcElement).is('[data-type=form-action-bar] button[data-role]')
                            ||
                                UI.getJQuery()(e.target).is('[data-type=form-action-bar] button[data-role]')
                            ||
                                UI.getJQuery()(e.srcElement).is('[data-type=form-captcha] input')
                            ||
                                UI.getJQuery()(e.target).is('[data-type=form-captcha] input'))) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            };
            this.previewModeListeners.push({
                element: window,
                eventName: 'keydown',
                eventPhase: true,
                callback: keyboardCallback,
            });
            for (var i = 0, len = this.previewModeListeners.length; i < len; i++) {
                this.previewModeListeners[i].element.addEventListener(this.previewModeListeners[i].eventName, this.previewModeListeners[i].callback, this.previewModeListeners[i].eventPhase);
            }
        }
        else {
            this.rootNode.removeAttribute('data-is-preview-mode-enabled');
            for (var i = 0, len = this.previewModeListeners.length; i < len; i++) {
                this.previewModeListeners[i].element.removeEventListener(this.previewModeListeners[i].eventName, this.previewModeListeners[i].callback, this.previewModeListeners[i].eventPhase);
                this.previewModeListeners[i] = null;
            }
            this.previewModeListeners.splice(0, this.previewModeListeners.length);
        }
        FormUtils.refreshFrameHeightOnWix();
    };
    Form.prototype.isPreviewModeEnabled = function () {
        return this.previewOnlyMode;
    };
    Form.prototype.getConfiguration = function () {
        return this.configuration;
    };
    Form.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return false;
    };
    Form.prototype.registerOrphanElement = function (element) {
        if (!element) {
            throw new Error('Invalid argument: element: IFormElement expected!');
        }
        if (undefined !== this.orphanElementsHashMap[element.getHash()]) {
            throw new Error('Element ' + element.getHash() + ' is already registered as a orphan element!');
        }
        else {
            this.orphanElementsHashMap[element.getHash()] = element;
        }
    };
    Form.prototype.unregisterOrphanElement = function (element) {
        if (!element) {
            throw new Error('Invalid argument: element: IFormElement expected!');
        }
        if (undefined !== this.orphanElementsHashMap[element.getHash()]) {
            delete this.orphanElementsHashMap[element.getHash()];
        }
        else {
            throw new Error('Element ' + element.getHash() + ' was not previously registered as a orphan element!');
        }
    };
    Form.prototype.setupCaptcha = function () {
        var _this = this;
        if (this.captcha && !this.captcha.getParent()) {
            var captchaRowElement = this.engine.createElement(ElementTypes.CONTAINER_TYPE_ROW, undefined, this);
            this.registerOrphanElement(captchaRowElement);
            captchaRowElement.appendChild(this.captcha);
            this.captcha.withParent(captchaRowElement);
        }
        setTimeout(function () {
            var captchaWidth = _this.configuration.getProperty('captchaWidthInUnits');
            if (null !== captchaWidth) {
                _this.captcha.withColspan(captchaWidth);
            }
            else {
                _this.captcha.withColspan(20);
            }
            var marginLeftInUnits = _this.configuration.getProperty('captchaLeftMarginInUnits');
            _this.captcha.setMarginLeft(marginLeftInUnits);
        }, 10);
    };
    Form.prototype.findElementByHashInsideOrphans = function (elementHash) {
        for (var orphanHash in this.orphanElementsHashMap) {
            if (this.orphanElementsHashMap.hasOwnProperty(orphanHash)) {
                var parent_1 = this.orphanElementsHashMap[orphanHash];
                if (parent_1.getElementKind() === EElementKind.CONTAINER) {
                    for (var i = 0, children = parent_1.getChildren(), len = children.length; i < len; i++) {
                        if (children[i].getHash() === elementHash) {
                            return children[i];
                        }
                    }
                }
            }
        }
    };
    Form.prototype.hasEditorSetting = function (editorSettingTypeId) {
        for (var i = 0, len = this.editorSettings.length; i < len; i++) {
            if (this.editorSettings[i].getTypeId() === editorSettingTypeId) {
                return true;
            }
        }
        return false;
    };
    Form.prototype.withEditorSetting = function (editorSetting) {
        if (this.hasEditorSetting(editorSetting.getTypeId())) {
            throw new Error('Editor setting ' + editorSetting.getTypeId() + ' is already added in form!');
        }
        this.editorSettings.push(editorSetting);
        this.trigger('editor-settings-changed');
        this.trigger('errors-changed', editorSetting);
        this.trigger('change');
        return this;
    };
    Form.prototype.getEditorSettings = function () {
        return this.editorSettings.slice(0);
    };
    Form.prototype.removeEditorSetting = function (editorSetting) {
        for (var i = 0, len = this.editorSettings.length; i < len; i++) {
            if (this.editorSettings[i] === editorSetting) {
                this.editorSettings.splice(i, 1);
                this.trigger('editor-settings-changed');
                this.trigger('errors-changed', editorSetting);
                this.trigger('change');
                this.engine.getLoader().execCommand('set-active-panel', 'editor');
                break;
            }
        }
        return this;
    };
    Form.prototype.toggleEditorSettingEnabledState = function (editorSetting) {
        editorSetting.setProperty('isEnabled', !editorSetting.getProperty('isEnabled'));
        this.trigger('editor-settings-changed');
        this.trigger('errors-changed', editorSetting);
        this.trigger('change');
        return this;
    };
    Form.prototype.oAuthApplicationSaveData = function (settingTypeId, settingData) {
        settingData = FormUtils.clone(settingData);
        var setting = this.getEditorSettingByTypeId(settingTypeId), loader = this.engine.getLoader();
        if (null === setting) {
            return;
        }
        loader.getUndoService().trigger('user-action', 'update-setting-' + settingTypeId);
        for (var settingProperty in settingData) {
            if (settingData.hasOwnProperty(settingProperty) && settingData.propertyIsEnumerable(settingProperty)) {
                if (setting.hasProperty(settingProperty)) {
                    setting.setProperty(settingProperty, settingData[settingProperty]);
                }
            }
        }
        this.trigger('editor-settings-changed');
        this.trigger('errors-changed', setting);
        this.trigger('change');
        loader.getCommandDispatcher().loadEditorSettingIntoPanel(setting);
    };
    Form.prototype.oAuthApplicationDisconnect = function (settingTypeId) {
        var setting = this.getEditorSettingByTypeId(settingTypeId), loader = this.engine.getLoader();
        loader.getUndoService().trigger('user-action', 'update-setting-' + settingTypeId);
        switch (settingTypeId) {
            case EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING:
                setting.oAuthDisconnect();
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING:
                setting.oAuthDisconnect();
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING:
                setting.oAuthDisconnect();
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING:
                setting.oAuthDisconnect();
                break;
        }
        this.trigger('editor-settings-changed');
        this.trigger('errors-changed', setting);
        this.trigger('change');
    };
    Form.prototype.removeEditorSettingByTypeId = function (editorSettingTypeId) {
        for (var i = 0, len = this.editorSettings.length; i < len; i++) {
            if (this.editorSettings[i].getTypeId() === editorSettingTypeId) {
                var setting = this.editorSettings.splice(i, 1);
                this.trigger('editor-settings-changed');
                this.trigger('errors-changed', setting[0]);
                this.trigger('change');
                break;
            }
        }
        return this;
    };
    Form.prototype.getEditorSettingByTypeId = function (editorSettingTypeId) {
        for (var i = 0, len = this.editorSettings.length; i < len; i++) {
            if (this.editorSettings[i].getTypeId() === editorSettingTypeId) {
                return this.editorSettings[i];
            }
        }
        return null;
    };
    Form.prototype.setProperty = function (attributeFQNAccessorPath, propertyValue) {
        _super.prototype.setProperty.call(this, attributeFQNAccessorPath, propertyValue);
        if ('options.direction' == attributeFQNAccessorPath) {
            var resultValue = ETextAlignment.LEFT;
            if (EFormTextDirection.RIGHT_TO_LEFT == propertyValue) {
                resultValue = ETextAlignment.RIGHT;
            }
            this.setProperty('options.labelTextAlignment', resultValue);
            this.setProperty('options.instructionsTextAlignment', resultValue);
        }
        return this;
    };
    Form.prototype.enumerateTranslations = function () {
        var result = [], nodeTranslations;
        for (var i = 0, nodes = this.flatten(), len = nodes.length; i < len; i++) {
            if (nodes[i] === this) {
                continue;
            }
            nodeTranslations = nodes[i].enumerateTranslations();
            if (nodeTranslations && nodeTranslations.length) {
                for (var j = 0, n = nodeTranslations.length; j < n; j++) {
                    result.push(nodeTranslations[j]);
                }
            }
        }
        var additionalControls = [];
        if (this.getHeader()) {
            additionalControls.push(this.getHeader());
        }
        if (this.getCaptcha()) {
            additionalControls.push(this.getCaptcha());
        }
        if (this.getActionBar()) {
            additionalControls.push(this.getActionBar());
        }
        for (var i = 0, len = additionalControls.length; i < len; i++) {
            nodeTranslations = additionalControls[i].enumerateTranslations();
            if (nodeTranslations && nodeTranslations.length) {
                for (var j = 0, n = nodeTranslations.length; j < n; j++) {
                    result.push(nodeTranslations[j]);
                }
            }
        }
        return result;
    };
    Form.prototype.initApplicationControls = function () {
        var self = this;
        var linkedInAutoFillData = this.getConfiguration().getProperty('linkedInAutoFill');
        if (linkedInAutoFillData) {
            this.getChildren().forEach(function (child) {
                if (child.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE && child.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
                    return;
                }
                var body = child.getDOMInsertionNode();
                if (body.querySelector('[data-role="control"][data-type="linkedin-autofill"]')) {
                    return;
                }
                var controlContainer = document.createElement('div');
                controlContainer.setAttribute('data-role', 'control');
                controlContainer.setAttribute('data-type', 'linkedin-autofill');
                controlContainer.innerHTML = "\n                    <div>\n                        <button type=\"button\">\n                            <span class=\"linkedin-logo\">IN</span>\n                            <div class=\"linkedin-button-text-container\">\n                                <span data-i18n-text=\"edt_text_autofill_with\">Autofill with</span> <strong>LinkedIn</strong>\n                            </div>\n                        </button>\n                    </div>\n                ";
                controlContainer.addEventListener('click', function () {
                    var width = 350, height = 500, left = (screen.width / 2) - (width / 2), top = (screen.height / 2) - (height / 2);
                    window.open(linkedInAutoFillData['authorizeURI'], 'linkedInWindow', 'toolbar=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, ' +
                        'width=' + width + ', height=' + height + ', top=' + top + ', left=' + left);
                });
                window.addEventListener('message', function (e) {
                    var data = e.data;
                    for (var key in data) {
                        if (!data.hasOwnProperty(key)) {
                            continue;
                        }
                        try {
                            if (key.indexOf('-') === -1) {
                                self.getElementById(+key).setProperty('value.value', data[key]);
                            }
                            else {
                                var ks = key.split('-');
                                var control = self.getElementById(+ks[0]);
                                var property = control.getPropertyDescriptorByInputIndex(+ks[1]).targetPropertyFQN;
                                control.setProperty(property, data[key]);
                            }
                        }
                        catch (e) { }
                    }
                });
                body.insertAdjacentElement('afterbegin', controlContainer);
            });
        }
        return this;
    };
    Form.NORMALIZE_RULES = [];
    Form.nodeName = 'form';
    Form.attributes = {};
    Form.runtime = null;
    return Form;
}(FormContainer));
var FormSelection = (function (_super) {
    __extends(FormSelection, _super);
    function FormSelection(document) {
        var _this = _super.call(this) || this;
        _this.items = {};
        _this.length = 0;
        _this.virtualControl = null;
        _this.document = document;
        _this.init();
        return _this;
    }
    FormSelection.prototype.has = function (element) {
        return element && this.items[element.getHash()] === element;
    };
    FormSelection.prototype.add = function (element) {
        if (element && !this.has(element)) {
            this.items[element.getHash()] = element;
            this.length++;
            this.trigger('add', element);
            this.onChange();
        }
        return this;
    };
    FormSelection.prototype.remove = function (element) {
        if (element && this.has(element)) {
            this.length--;
            delete this.items[element.getHash()];
            this.trigger('remove', element);
            this.onChange();
        }
        return this;
    };
    FormSelection.prototype.set = function (element) {
        if (element && this.length === 1 && this.has(element)) {
            return this;
        }
        this.clear();
        if (element) {
            this.add(element);
        }
    };
    FormSelection.prototype.getLength = function () {
        return this.length;
    };
    FormSelection.prototype.clear = function () {
        if (this.length > 0) {
            var currentItemsList = this.getItems();
            this.length = 0;
            this.items = {};
            for (var i = 0, len = currentItemsList.length; i < len; i++) {
                this.trigger('remove', currentItemsList[i]);
            }
            this.onChange();
        }
        return this;
    };
    FormSelection.prototype.getItems = function () {
        var result = [];
        if (this.length > 0) {
            for (var hash in this.items) {
                if (this.items.hasOwnProperty(hash) && this.items.propertyIsEnumerable(hash)) {
                    result.push(this.items[hash]);
                }
            }
        }
        return result;
    };
    FormSelection.prototype.init = function () {
        (function (self) {
            self.onChange = Throttle.create(function () {
                self.trigger('change');
            }, 0);
            self.document.on('node-removal', function (node) {
                if (node) {
                    for (var nodes = node.flatten(), len = nodes.length, i = 0; i < len; i++) {
                        self.remove(nodes[i]);
                    }
                }
            });
        })(this);
    };
    FormSelection.prototype.synchronize = function () {
        var currentSelectionItems = this.getItems();
        for (var i = 0, len = currentSelectionItems.length; i < len; i++) {
            if (!this.document.getElementByHash(currentSelectionItems[i].getHash())) {
                this.remove(currentSelectionItems[i]);
            }
        }
    };
    FormSelection.prototype.isSingle = function () {
        return 1 === this.length;
    };
    FormSelection.prototype.rebuildVirtualSelectionControl = function () {
        if (this.length > 1) {
            this.virtualControl = new VirtualSelectionControl(this.document, this.getItems());
        }
        else {
            this.virtualControl = null;
        }
        return this;
    };
    FormSelection.prototype.getVirtualControl = function () {
        return this.virtualControl;
    };
    return FormSelection;
}(EventEmitter));
var UserFileExtensionsService = (function () {
    function UserFileExtensionsService() {
    }
    UserFileExtensionsService.prototype.getAllowedUserFileExtensions = function () {
        return this.allowedUserFileExtensions;
    };
    UserFileExtensionsService.prototype.getForbiddenUserFileExtensions = function () {
        return this.forbiddenUserFileExtensions;
    };
    UserFileExtensionsService.prototype.withAllowedUserFileExtensions = function (allowedFileExtensions) {
        this.allowedUserFileExtensions = (allowedFileExtensions || []).sort();
        return this;
    };
    UserFileExtensionsService.prototype.withForbiddenUserFileExtensions = function (forbiddenFileExtensions) {
        this.forbiddenUserFileExtensions = (forbiddenFileExtensions || []).sort();
        return this;
    };
    UserFileExtensionsService.prototype.withUI = function (ui) {
        this.ui = ui;
        return this;
    };
    UserFileExtensionsService.prototype.withResourceManager = function (resourceManager) {
        this.resourceManager = resourceManager;
        return this;
    };
    UserFileExtensionsService.prototype.createExtensionDialog = function (title, fromResource, okCallback, cancelCallback) {
        return (function (self, $) {
            return $.Deferred(function (defer) {
                self.resourceManager.get(fromResource).then(function (dialogTemplateHTMLMarkup) {
                    var result = self.ui.createDialog(title, [
                        {
                            type: EDialogButtonType.OK,
                            callback: function () {
                                okCallback(result);
                            }
                        },
                        {
                            type: EDialogButtonType.CANCEL,
                            callback: function () {
                                cancelCallback(result);
                            }
                        }
                    ], {
                        width: "500px",
                        onCloseButtonClick: function () {
                            cancelCallback(result);
                        }
                    });
                    result.body.innerHTML = dialogTemplateHTMLMarkup;
                    defer.resolve(result);
                });
            }).promise();
        })(this, UI.getJQuery());
    };
    UserFileExtensionsService.prototype.isValidExtensionName = function (extension) {
        return /^[a-z0-9\-]{1,10}$/.test(extension);
    };
    UserFileExtensionsService.prototype.canAddFileExtension = function (extension) {
        if (this.forbiddenUserFileExtensions.indexOf(extension) > -1) {
            return false;
        }
        if (this.allowedUserFileExtensions.indexOf(extension) > -1) {
            return false;
        }
        return true;
    };
    UserFileExtensionsService.prototype.addUserFileExtension = function () {
        return (function ($, self) {
            return $.Deferred(function (defer) {
                var setError = function (dialog, errorMessage) {
                    var span = document.createElement('span');
                    span.setAttribute('data-role', 'error');
                    span.textContent = errorMessage;
                    $(dialog.body).find('input[name=extension]').after(span);
                };
                var clearErrors = function (dialog) {
                    $(dialog.body).find('span[data-role=error]').remove();
                };
                self.createExtensionDialog('Add user file extension', '/modules/Typescript/Form/resources/add-allowed-file-extension-dialog.html', function (dialog) {
                    clearErrors(dialog);
                    var addExtension = $(dialog.body).find('input[name=extension]').val().toLowerCase();
                    if (!addExtension) {
                        setError(dialog, "Please specify a non-empty file extension!");
                        return;
                    }
                    if (!self.isValidExtensionName(addExtension)) {
                        setError(dialog, JSON.stringify(addExtension) + ' is not a supported file extension!');
                        return;
                    }
                    if (!self.canAddFileExtension(addExtension)) {
                        setError(dialog, JSON.stringify(addExtension) + ' extension cannot be added. Check if the extension is not already added in your supported extensions list, and if the extension is supported');
                        return;
                    }
                    $.post('/modules/FormEditor/ajax-user-extension-service.php', {
                        "do": "add-user-extension",
                        "extension": addExtension
                    }).then(function () {
                        dialog.close();
                        self.allowedUserFileExtensions.push(addExtension);
                        self.allowedUserFileExtensions.sort();
                        defer.resolve(addExtension);
                    }).fail(function () {
                        self.ui.alert('Error adding extension', 'Failed to add extension "' + addExtension + '" on server!');
                    });
                }, function (dialog) {
                    dialog.close();
                    defer.reject(new Error('User aborted operation'));
                }).then(function (dialog) {
                    dialog.body.setAttribute('data-dialog-type', 'add-file-extension');
                    $(dialog.body).on('input', 'input[name=extension]', function () {
                        clearErrors(dialog);
                    });
                });
            }).promise();
        })(UI.getJQuery(), this);
    };
    UserFileExtensionsService.getInstance = function () {
        return undefined === this.instance
            ? this.instance = new UserFileExtensionsService()
            : this.instance;
    };
    return UserFileExtensionsService;
}());
var UploadsService = (function (_super) {
    __extends(UploadsService, _super);
    function UploadsService(jq, document, userId, mimeTypeService) {
        var _this = _super.call(this) || this;
        _this.qos = [];
        _this.qosSchedulerThreadId = null;
        _this.jq = jq;
        _this.document = document;
        _this.userId = userId || null;
        _this.sessionKey = 'cfr_' + (+new Date) + '.' + ~~(1000 * Math.random());
        _this.mimeTypeService = mimeTypeService;
        return _this;
    }
    UploadsService.prototype.getMimeType = function (fileName) {
        return this.mimeTypeService.getMimeType(fileName);
    };
    UploadsService.prototype.createUpload = function (file) {
        return new UploadFile(file, this);
    };
    UploadsService.prototype.getDocument = function () {
        return this.document;
    };
    UploadsService.prototype.getUploadEndpoint = function () {
        return '/uploadajax.php?' +
            'uid=' + String(this.userId || '')
            + '&fid=' + String(this.document.getId() || '')
            + '&sessionKey=' + this.sessionKey
            + '&PHPSESSID=' + (this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.SESSION_ID) || '')
            + '&context=' + (this.document.getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW ? 'form-view' : 'editor');
    };
    UploadsService.prototype.getJQuery = function () {
        return this.jq;
    };
    UploadsService.prototype.onUploadQOSEnter = function (upload) {
        (function (self) {
            upload.on('success', upload.qosCleanupCallbacks['success'] = function () {
                self.removeFromQOS(upload);
            });
            upload.on('error', upload.qosCleanupCallbacks['error'] = function () {
                self.removeFromQOS(upload);
            });
            upload.on('remove', upload.qosCleanupCallbacks['remove'] = function () {
                self.removeFromQOS(upload);
            });
        })(this);
    };
    UploadsService.prototype.onUploadQOSLeave = function (upload) {
        if (undefined !== upload.qosCleanupCallbacks['success']) {
            upload.off('success', upload.qosCleanupCallbacks['success']);
            upload.qosCleanupCallbacks['success'] = undefined;
        }
        if (undefined !== upload.qosCleanupCallbacks['error']) {
            upload.off('error', upload.qosCleanupCallbacks['error']);
            upload.qosCleanupCallbacks['error'] = undefined;
        }
        if (undefined !== upload.qosCleanupCallbacks['remove']) {
            upload.off('remove', upload.qosCleanupCallbacks['remove']);
            upload.qosCleanupCallbacks['remove'] = undefined;
        }
    };
    UploadsService.prototype.addToQOS = function (upload) {
        for (var i = 0, len = this.qos.length; i < len; i++) {
            if (this.qos[i] === upload) {
                return upload;
            }
        }
        this.qos.push(upload);
        this.onUploadQOSEnter(upload);
        this.startQOSSchedulerThreadId();
        return upload;
    };
    UploadsService.prototype.removeFromQOS = function (upload) {
        for (var i = 0, len = this.qos.length; i < len; i++) {
            if (this.qos[i] === upload) {
                this.onUploadQOSLeave(upload);
                this.qos.splice(i, 1);
                break;
            }
        }
        return upload;
    };
    UploadsService.prototype.isQOSIdle = function () {
        return this.qos.length === 0;
    };
    UploadsService.prototype.qosGetNext = function () {
        for (var i = 0, len = this.qos.length; i < len; i++) {
            if (this.qos[i].getState() === EUploadState.PROGRESS) {
                break;
            }
            if (this.qos[i].getState() === EUploadState.NOT_STARTED) {
                return this.qos[i];
            }
        }
        return null;
    };
    UploadsService.prototype.stopQOSSchedulerThreadId = function () {
        if (null === this.qosSchedulerThreadId) {
            return;
        }
        window.clearInterval(this.qosSchedulerThreadId);
        this.qosSchedulerThreadId = null;
        console.warn('UploadsService: QOS stopped');
        this.trigger('qos-done');
    };
    UploadsService.prototype.startQOSSchedulerThreadId = function () {
        if (null !== this.qosSchedulerThreadId) {
            return;
        }
        (function (self) {
            self.qosSchedulerThreadId = window.setInterval(function () {
                if (self.isQOSIdle()) {
                    self.stopQOSSchedulerThreadId();
                }
                else {
                    var nextUpload = self.qosGetNext();
                    if (nextUpload) {
                        nextUpload.upload();
                    }
                }
            }, 200);
            console.warn('UploadsService: QOS started');
            self.trigger('qos-start');
        })(this);
    };
    UploadsService.prototype.flushQueuedUploads = function () {
        return (function (self, $) {
            if (null === self.qosSchedulerThreadId) {
                return $.Deferred(function (defer) {
                    defer.resolve(true);
                }).promise();
            }
            else {
                return $.Deferred(function (defer) {
                    var drainListener = function () {
                        self.off('qos-done', drainListener);
                        defer.resolve(true);
                    };
                    self.on('qos-done', drainListener);
                }).promise();
            }
        })(this, this.jq);
    };
    UploadsService.prototype.getSessionKey = function () {
        return this.sessionKey || null;
    };
    UploadsService.prototype.removeSubmittedUpload = function (sessionId, submissionId, uploaderInstanceIndex) {
        if ('string' !== typeof sessionId || !sessionId) {
            throw new Error('Invalid argument sessionId: string expected!');
        }
        if ('string' !== typeof submissionId || !submissionId) {
            throw new Error('Invalid argument: submissionId: string expected!');
        }
        if ('number' !== typeof uploaderInstanceIndex || uploaderInstanceIndex <= 0) {
            throw new Error('Invalid argument: uploaderInstanceIndex: number > 0 expected');
        }
        return (function ($, self) {
            return $.Deferred(function (defer) {
                $.get('/uploadajax.php?action=remove&id=' + uploaderInstanceIndex + '&PHPSESSID=' + encodeURIComponent(sessionId) + '&submissionid=' + encodeURIComponent(submissionId) + '&sessionKey=' + encodeURIComponent(self.sessionKey))
                    .then(function (result) {
                    if (result === 'Upload Removed') {
                        defer.resolve(true);
                    }
                    else {
                        defer.reject(new Error(result));
                    }
                })
                    .fail(function (reason) {
                    defer.reject('string' === typeof reason ? new Error(reason) : reason);
                });
            }).promise();
        })(this.jq, this);
    };
    return UploadsService;
}(EventEmitter));
var UploadFile = (function (_super) {
    __extends(UploadFile, _super);
    function UploadFile(file, service) {
        var _this = _super.call(this) || this;
        _this.uploaded = null;
        _this.packAsArchive = false;
        _this.qosCleanupCallbacks = {};
        _this.file = file;
        _this.uploaded = 0;
        _this.service = service;
        _this.state = EUploadState.NOT_STARTED;
        return _this;
    }
    UploadFile.prototype.isOfflineForm = function () {
        return this.service.getDocument().getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW &&
            this.service.getDocument().getEngine().getLoader().getViewFormEnvironmentContext() === EViewFormEnvironmentContext.MOBILE_APP_OFFLINE;
    };
    UploadFile.prototype.onUploadProgress = function (e) {
        var done = e.position || e.loaded, total = e.totalSize || e.total;
        this.trigger('progress', Math.floor(done / total * 1000) / 10);
    };
    UploadFile.prototype.onReadyStateChange = function (e) {
        if (4 === this.xhr.readyState) {
            if (200 === this.xhr.status) {
                try {
                    var responseText = this.xhr.responseText, decodedResponseText = void 0;
                    if (!responseText) {
                        throw new Error('Server returned a empty response text');
                    }
                    try {
                        decodedResponseText = JSON.parse(responseText);
                    }
                    catch (e) {
                        throw new Error('Failed to decode as JSON the server response text!');
                    }
                    if (undefined === decodedResponseText.files) {
                        throw new Error('The "files" property is missing from server JSON response!');
                    }
                    if (!decodedResponseText.files.length) {
                        throw new Error('The "files" property returned by server has no length!');
                    }
                    if (1 !== decodedResponseText.files.length) {
                        throw new Error('The length of the "files" property is different than 1. Unhandled scenario?');
                    }
                    if (!decodedResponseText.files[0]) {
                        throw new Error('The first file returned by the response should be an object!');
                    }
                    if (undefined === decodedResponseText.files[0].error) {
                        throw new Error('The "files[0]" property returned by the server is missing a property called "error"!');
                    }
                    if ('SUCCES' !== decodedResponseText.files[0].error) {
                        throw new Error(decodedResponseText.files[0].error);
                    }
                    this.storedFileNameOnServer = decodedResponseText.files[0].name;
                    this.storedFilePathOnServer = decodedResponseText.files[0].uploadedFileFullPath || null;
                    this.trigger('got-file-data', '');
                    this.state = EUploadState.SUCCESS;
                    this.trigger('success');
                }
                catch (e) {
                    this.trigger('error', e);
                    this.state = EUploadState.ERROR;
                }
                this.destroy(this.xhr);
            }
            else {
                this.state = EUploadState.ERROR;
                this.trigger('error', new Error('There was a response network problem while uploading the file with HTTP status code: ' + this.xhr.status));
            }
            this.destroy(this.xhr);
            this.xhr = undefined;
        }
    };
    UploadFile.prototype.onError = function (e) {
        this.state = EUploadState.ERROR;
        this.trigger('error');
        this.destroy(this.xhr);
    };
    UploadFile.prototype.createXHR = function () {
        var _this = this;
        var result = new XMLHttpRequest();
        result.upload.addEventListener('progress', this.bindedUploadProgress = function (e) { return _this.onUploadProgress(e); }, true);
        result.addEventListener('readystatechange', this.bindedReadyStateChange = function (e) { return _this.onReadyStateChange(e); }, true);
        result.addEventListener('error', this.bindedErrorListener = function (e) { return _this.onError(e); }, true);
        return result;
    };
    UploadFile.prototype.destroy = function (xhr) {
        try {
            xhr.abort();
        }
        catch (e) { }
        try {
            if (this.bindedUploadProgress) {
                xhr.upload.removeEventListener('progress', this.bindedUploadProgress, true);
            }
            if (this.bindedReadyStateChange) {
                xhr.removeEventListener('readystatechange', this.bindedReadyStateChange, true);
            }
            if (this.bindedErrorListener) {
                xhr.removeEventListener('error', this.bindedErrorListener, true);
            }
        }
        catch (e) { }
        this.bindedReadyStateChange = null;
        this.bindedUploadProgress = null;
        this.bindedErrorListener = null;
    };
    UploadFile.prototype.upload = function () {
        if (this.isOfflineForm()) {
            (function (self, $) {
                var reader = new FileReader();
                reader.addEventListener("load", function () {
                    var fileData = reader.result.toString().split(',');
                    self.trigger('got-file-data', fileData[1]);
                    self.trigger('progress', 100);
                    self.state = EUploadState.SUCCESS;
                    self.trigger('success');
                });
                self.trigger('start');
                self.trigger('progress', 0);
                reader.readAsDataURL(self.file);
            })(this, this.service.getJQuery());
        }
        else {
            if (undefined !== this.xhr) {
                this.destroy(this.xhr);
            }
            this.state = EUploadState.PROGRESS;
            this.trigger('start');
            var additionalPostArgs = [];
            if (null !== this.getUploaderInstanceIndex()) {
                additionalPostArgs.push('id=' + String(this.getUploaderInstanceIndex()));
            }
            if (null !== this.getControlId()) {
                additionalPostArgs.push('control_id=' + String(this.getControlId()));
            }
            if (this.isArchived()) {
                additionalPostArgs.push('multiple_uploads=1');
            }
            var formData = new FormData();
            formData.append('file' + this.uploaderInstanceIndex, this.file);
            this.xhr = this.createXHR();
            this.xhr.open('post', this.service.getUploadEndpoint() + (additionalPostArgs.length ? ('&' + additionalPostArgs.join('&')) : ''), true);
            this.xhr.send(formData);
            this.trigger('progress', 0);
        }
    };
    UploadFile.prototype.remove = function () {
        return (function (self, $) {
            if (undefined !== self.xhr) {
                return $.Deferred(function (defer) {
                    self.destroy(self.xhr);
                    self.xhr = undefined;
                    self.state = EUploadState.REMOVED;
                    self.trigger('remove');
                    defer.resolve(true);
                }).promise();
            }
            else {
                if (EUploadState.SUCCESS === self.state && !self.isOfflineForm()) {
                    var additionalURLArgs_1 = [];
                    if (null !== self.getUploaderInstanceIndex()) {
                        additionalURLArgs_1.push('id=' + String(self.getUploaderInstanceIndex()));
                    }
                    if (null !== self.getControlId()) {
                        additionalURLArgs_1.push('control_id=' + String(self.getControlId()));
                    }
                    additionalURLArgs_1.push('action=remove');
                    if (self.isArchived()) {
                        additionalURLArgs_1.push('multiple_uploads=1');
                        additionalURLArgs_1.push('filename=' + encodeURIComponent(self.getStoredFileNameOnServer() || self.file.name));
                    }
                    return $.Deferred(function (defer) {
                        $.get(self.service.getUploadEndpoint() + '&' + additionalURLArgs_1.join('&'))
                            .then(function (result) {
                            if ('Upload Removed' === result) {
                                self.state = EUploadState.REMOVED;
                                self.trigger('remove');
                                defer.resolve(true);
                            }
                            else {
                                defer.reject(new Error('The server returned a unhandled response: ' + JSON.stringify(result)));
                            }
                        })
                            .fail(function (e) {
                            defer.reject(e);
                        });
                    }).promise();
                }
                else {
                    return $.Deferred(function (defer) {
                        self.state = EUploadState.REMOVED;
                        self.trigger('remove');
                        defer.resolve(true);
                    }).promise();
                }
            }
        })(this, this.service.getJQuery());
    };
    UploadFile.prototype.getSize = function () {
        return this.file.size;
    };
    UploadFile.prototype.getName = function () {
        return this.file.name;
    };
    UploadFile.prototype.withControlId = function (controlId) {
        this.controlId = controlId;
        return this;
    };
    UploadFile.prototype.getControlId = function () {
        return this.controlId || null;
    };
    UploadFile.prototype.withUploaderInstanceIndex = function (instanceIndex) {
        this.uploaderInstanceIndex = instanceIndex;
        return this;
    };
    UploadFile.prototype.getUploaderInstanceIndex = function () {
        return this.uploaderInstanceIndex || null;
    };
    UploadFile.prototype.getState = function () {
        return this.state;
    };
    UploadFile.prototype.withArchivePacking = function (archivePacking) {
        this.packAsArchive = !!archivePacking;
        return this;
    };
    UploadFile.prototype.isArchived = function () {
        return this.packAsArchive;
    };
    UploadFile.prototype.getStoredFileNameOnServer = function () {
        if (EUploadState.SUCCESS === this.state) {
            return this.storedFileNameOnServer || null;
        }
        else {
            return null;
        }
    };
    UploadFile.prototype.getStoredFileURLFromCloud = function () {
        if (EUploadState.SUCCESS === this.state) {
            return this.storedFilePathOnServer || null;
        }
        else {
            return null;
        }
    };
    UploadFile.prototype.getMimeType = function () {
        return this.file.type;
    };
    return UploadFile;
}(EventEmitter));
var TinyMceUploadImage = (function () {
    function TinyMceUploadImage() {
    }
    TinyMceUploadImage.prepareFileForUplod = function (callback) {
        if (document.getElementById('tinymce-upload-image') != null) {
            document.getElementById("tinymce-upload-image").remove();
        }
        var input = document.createElement('input');
        input.setAttribute('id', 'tinymce-upload-image');
        input.setAttribute('type', 'file');
        input.setAttribute('accept', 'image/*');
        document.body.appendChild(input);
        document.getElementById('tinymce-upload-image').onchange = function () {
            var file = document.getElementById('tinymce-upload-image').files[0];
            var reader = new FileReader();
            reader.onload = function () {
                var id = 'blobid' + (new Date()).getTime();
                var blobCache = window['tinymce'].activeEditor.editorUpload.blobCache;
                var base64 = reader.result['split'](',')[1];
                var blobInfo = blobCache.create(id, file, base64);
                blobCache.add(blobInfo);
                callback(blobInfo.blobUri(), { title: file.name });
            };
            reader.readAsDataURL(file);
        };
        input.click();
    };
    TinyMceUploadImage.sendDataForUpload = function (failure, success, blobInfo, formId) {
        var xhr, formData;
        xhr = new XMLHttpRequest();
        xhr.withCredentials = false;
        xhr.open('POST', 'upload_img.php');
        xhr.onload = function () {
            var json;
            if (xhr.status != 200) {
                failure('HTTP Error: ' + xhr.status);
                return;
            }
            json = JSON.parse(xhr.responseText);
            if (!json || typeof json.location != 'string') {
                failure('Invalid JSON: ' + xhr.responseText);
                return;
            }
            success(json.location);
        };
        formData = new FormData();
        formData.append('image', blobInfo.blob());
        formData.append('xfid', String(formId));
        formData.append('new_editor', '1');
        xhr.send(formData);
    };
    return TinyMceUploadImage;
}());
var RenderersFactory = (function () {
    function RenderersFactory() {
        this.CUSTOM_CONTROL_RENDERER = null;
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL = null;
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD = null;
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL = null;
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD = null;
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL = null;
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD = null;
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD = null;
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD = null;
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD = null;
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD = null;
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD = null;
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD = null;
        this.CUSTOM_CONTROL_RENDERER = new CustomControlRenderer();
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL = new LabelPlacementTopInstructionsBelowLabelNoCompactFieldRenderer();
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD = new LabelPlacementTopInstructionsBelowFieldNoCompactFieldRenderer();
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL = new LabelPlacementLeftInstructionsBelowLabelNoCompactFieldRenderer();
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD = new LabelPlacementLeftInstructionsBelowFieldNoCompactFieldRenderer();
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL = new LabelPlacementRightInstructionsBelowLabelNoCompactFieldRenderer();
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD = new LabelPlacementRightInstructionsBelowFieldNoCompactFieldRenderer();
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD = new LabelPlacementTopInstructionsBelowLabelCompactFieldRenderer();
        this.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD = new LabelPlacementTopInstructionsBelowFieldCompactFieldRenderer();
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD = new LabelPlacementLeftInstructionsBelowLabelCompactFieldRenderer();
        this.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD = new LabelPlacementLeftInstructionsBelowFieldCompactFieldRenderer();
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD = new LabelPlacementRightInstructionsBelowLabelCompactFieldRenderer();
        this.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD = new LabelPlacementRightInstructionsBelowFieldCompactFieldRenderer();
    }
    RenderersFactory.getInstance = function () {
        return undefined === RenderersFactory.instance
            ? RenderersFactory.instance = new RenderersFactory()
            : RenderersFactory.instance;
    };
    RenderersFactory.getRendererByType = function (rendererType) {
        switch (rendererType) {
            case EElementRendererType.CUSTOM_CONTROL_RENDERER:
                return RenderersFactory.getInstance().CUSTOM_CONTROL_RENDERER;
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL;
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL;
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD;
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
                return RenderersFactory.getInstance().LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD;
            default:
                throw new Error('Renderers Factory: Unknown renderer type ' + JSON.stringify(rendererType));
        }
    };
    RenderersFactory.getSuggestedRenderer = function (ofElement, labelPlacement, instructionsPlacement) {
        var isLabelSuppressed = ofElement.hasProperty('label.isRemoved') && ofElement.getProperty('label.isRemoved'), isCompactField = isLabelSuppressed || (ofElement.hasProperty('label.isCompactField') && ofElement.getProperty('label.isCompactField'));
        switch (labelPlacement) {
            case EFormLabelPlacement.TOP_ALIGNED:
                switch (instructionsPlacement) {
                    case EFormInstructionsPlacement.BELOW_FIELD:
                        return isCompactField
                            ? EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD
                            : EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD;
                    case EFormInstructionsPlacement.BELOW_LABEL:
                    default:
                        return isCompactField
                            ? EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD
                            : EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL;
                }
            case EFormLabelPlacement.RIGHT_ALIGNED:
                switch (instructionsPlacement) {
                    case EFormInstructionsPlacement.BELOW_FIELD:
                        return isCompactField
                            ? EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD
                            : EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD;
                    case EFormInstructionsPlacement.BELOW_LABEL:
                    default:
                        return isCompactField
                            ? EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD
                            : EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL;
                }
            case EFormLabelPlacement.LEFT_ALIGNED:
            default:
                switch (instructionsPlacement) {
                    case EFormInstructionsPlacement.BELOW_FIELD:
                        return isCompactField
                            ? EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD
                            : EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD;
                    case EFormInstructionsPlacement.BELOW_LABEL:
                    default:
                        return isCompactField
                            ? EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD
                            : EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL;
                }
        }
    };
    return RenderersFactory;
}());
var Renderer = (function () {
    function Renderer() {
    }
    Renderer.prototype.clearElementDOMNodeRoot = function (element) {
        var rootNode = element.getRootNode();
        while (rootNode.childNodes.length) {
            rootNode.removeChild(rootNode.firstChild);
        }
    };
    Renderer.prototype.getSizeAttributeValue = function (width) {
        switch (width) {
            case EInputWidth.HALF:
                return 'half';
            case EInputWidth.QUARTER:
                return 'quarter';
            case EInputWidth.THIRD:
                return 'third';
            case EInputWidth.FILL:
                return 'fill';
            case EInputWidth.ONE_UNIT:
                return '1u';
            case EInputWidth.TWO_UNITS:
                return '2u';
            case EInputWidth.THREE_UNITS:
                return '3u';
            case EInputWidth.FOUR_UNITS:
                return '4u';
            case null:
                return null;
            case EInputWidth.FULL:
            default:
                return 'full';
        }
    };
    Renderer.prototype.getSizeInUnits = function (colspan, size) {
        switch (size) {
            case EInputWidth.FULL:
                return ~~colspan;
            case EInputWidth.HALF:
                return ~~(colspan / 2) || 1;
            case EInputWidth.QUARTER:
                return ~~(colspan / 4) || 1;
            case EInputWidth.THIRD:
                return ~~(colspan / 3) || 1;
            case EInputWidth.ONE_UNIT:
                return Math.min(colspan, 1);
            case EInputWidth.TWO_UNITS:
                return Math.min(colspan, 2);
            case EInputWidth.THREE_UNITS:
                return Math.min(colspan, 3);
            case EInputWidth.FOUR_UNITS:
                return Math.min(colspan, 4);
            default:
                return 0;
        }
    };
    Renderer.prototype.getElementLayoutSize = function (element) {
        var elementColspan = ~~element.getColspan(), result = {
            labelWidthInUnits: 0,
            inputWidthInUnits: elementColspan
        }, ownElementLabelWidth = element.hasProperty('label.widthInUnits')
            ? element.getProperty('label.widthInUnits')
            : null;
        result.labelWidthInUnits = (null !== ownElementLabelWidth && ownElementLabelWidth > 0)
            ? ownElementLabelWidth
            : element.getForm().getProperty('options.labelWidthInUnits');
        if (result.labelWidthInUnits > elementColspan) {
            result.labelWidthInUnits = elementColspan;
        }
        result.inputWidthInUnits -= result.labelWidthInUnits;
        if (result.inputWidthInUnits === 0) {
            result.inputWidthInUnits = 1;
            result.labelWidthInUnits--;
        }
        if ((result.labelWidthInUnits + result.inputWidthInUnits) > elementColspan) {
            if (result.inputWidthInUnits >= elementColspan) {
                result.inputWidthInUnits = elementColspan - 1;
            }
            result.labelWidthInUnits = elementColspan - result.inputWidthInUnits;
        }
        return result;
    };
    Renderer.setLabelCompactFieldState = function (enabled, labelText, onInputRows, isLabelSuppressed) {
        if (null !== onInputRows && onInputRows.length === 1 && onInputRows[0] && onInputRows[0].inputs && onInputRows[0].inputs.length === 1 && onInputRows[0].inputs[0] && onInputRows[0].inputs[0].input) {
            var inputDOMNode = Renderer.castToDOMElement(onInputRows[0].inputs[0].input);
            if (enabled) {
                inputDOMNode.setAttribute('placeholder', isLabelSuppressed ? '' : String(labelText || ''));
            }
            else {
                inputDOMNode.removeAttribute('placeholder');
            }
        }
    };
    Renderer.prototype.isLabelSuppressed = function (ofElement) {
        return ofElement.hasProperty('label.isRemoved') && ofElement.getProperty('label.isRemoved');
    };
    Renderer.castToDOMElement = function (element) {
        if (element && element instanceof UIElement) {
            return element.getRootNode();
        }
        else {
            return element;
        }
    };
    Renderer.LABEL_PLACEMENT_TOP_RENDERERS = [
        EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD,
        EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD,
        EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD,
        EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL,
    ];
    return Renderer;
}());
var PaymentProcessorsPluginFactory = (function () {
    function PaymentProcessorsPluginFactory(engine) {
        this.plugins = [];
        this.engine = engine;
    }
    PaymentProcessorsPluginFactory.prototype.getPlugin = function (paymentProcessorTypeId) {
        for (var i = 0, len = this.plugins.length; i < len; i++) {
            if (this.plugins[i].getPluginTypeId() === paymentProcessorTypeId) {
                return this.plugins[i];
            }
        }
        return null;
    };
    PaymentProcessorsPluginFactory.prototype.withPlugin = function (plugin) {
        this.plugins.push(plugin);
        return this;
    };
    PaymentProcessorsPluginFactory.NO_PLUGIN = null;
    PaymentProcessorsPluginFactory.SISOW_PLUGIN = 1;
    return PaymentProcessorsPluginFactory;
}());
var NullPaymentProcessorPlugin = (function () {
    function NullPaymentProcessorPlugin() {
    }
    NullPaymentProcessorPlugin.prototype.render = function (domNode, engine) {
        domNode.innerHTML = '';
    };
    NullPaymentProcessorPlugin.prototype.getValues = function (domNode, engine) {
        return null;
    };
    NullPaymentProcessorPlugin.prototype.getPluginTypeId = function () {
        return PaymentProcessorsPluginFactory.NO_PLUGIN;
    };
    return NullPaymentProcessorPlugin;
}());
var SisowPaymentProcessorPlugin = (function () {
    function SisowPaymentProcessorPlugin() {
    }
    SisowPaymentProcessorPlugin.prototype.render = function (domNode, engine) {
        domNode.innerHTML = SisowPaymentProcessorPlugin.htmlMarkupText || '';
        UI.upgradeDOMNodeFromForm(domNode);
    };
    SisowPaymentProcessorPlugin.prototype.getValues = function (domNode, engine) {
        var result = {};
        (function ($) {
            $(domNode).find('[data-role=frontend-plugin] select[name], [data-role=frontend-plugin] input[name]').each(function () {
                var name = this.getAttribute('name');
                if (name) {
                    result[name] = this.value || '';
                }
            });
        })(UI.getJQuery());
        return result;
    };
    SisowPaymentProcessorPlugin.prototype.getPluginTypeId = function () {
        return PaymentProcessorsPluginFactory.SISOW_PLUGIN;
    };
    SisowPaymentProcessorPlugin.withHTMLMarkupText = function (markupText) {
        this.htmlMarkupText = markupText;
    };
    SisowPaymentProcessorPlugin.htmlMarkupText = '<b>Sisow Plugin not initialized!</b>';
    return SisowPaymentProcessorPlugin;
}());
var PaymentProcessorsConfiguration = (function () {
    function PaymentProcessorsConfiguration(api, jq, paymentProcessorList) {
        this.api = api;
        this.jq = jq;
        this.paymentProcessorsList = paymentProcessorList;
    }
    PaymentProcessorsConfiguration.prototype.getModel = function (paymentProcessorId) {
        if (null === this.paymentProcessorsList) {
            throw new Error('Please initialize the Payment Processors List first.');
        }
        if (undefined === this.paymentProcessorsList[paymentProcessorId]) {
            throw new Error('Please specify a valid Processor ID.');
        }
        return this.api.GET('/v2/settings/payments/processor/model', {
            paymentProcessorId: paymentProcessorId
        })
            .fail(function (errorMessage) {
            throw new Error(errorMessage);
        });
    };
    PaymentProcessorsConfiguration.prototype.save = function (formId, paymentProcessorId, data) {
        var self = this;
        return this.jq.Deferred(function (dfd) {
            var processorModel;
            try {
                processorModel = self.getModel(paymentProcessorId);
            }
            catch (error) {
                dfd.reject(error);
            }
            if (undefined !== processorModel) {
                processorModel.done(function (paymentProcessorConfigurationStructure) {
                    var model = new PaymentProcessorConfigurationModel(paymentProcessorConfigurationStructure);
                    if (model.isDataCompliantWithModel(data)) {
                        self.api.PUT_JSON('/v2/settings/payments/processor/configuration', {
                            'formId': formId,
                            'processorId': paymentProcessorId,
                            'data': data
                        })
                            .done(function (response) {
                            dfd.resolve(true);
                        })
                            .fail(function (errorMessage) {
                            dfd.reject(errorMessage);
                        });
                    }
                    else {
                        dfd.reject(new Error('Data is not compliant with ' + self.paymentProcessorsList[paymentProcessorId] + ' Model.'));
                    }
                });
            }
        }).promise();
    };
    PaymentProcessorsConfiguration.prototype.getProcList = function () {
        return this.paymentProcessorsList;
    };
    return PaymentProcessorsConfiguration;
}());
var PaymentProcessorConfigurationModel = (function () {
    function PaymentProcessorConfigurationModel(modelStructure) {
        this.modelStructure = modelStructure;
    }
    PaymentProcessorConfigurationModel.prototype.isDataCompliantWithModel = function (data) {
        for (var propertyName in data) {
            if (!this.modelStructure.hasOwnProperty(propertyName)) {
                return false;
            }
        }
        return true;
    };
    return PaymentProcessorConfigurationModel;
}());
var PaymentsProductsDialog = (function () {
    function PaymentsProductsDialog() {
        this.unitType = [
            {
                unitTypeIndex: EPaymentsUnitTypes.PERCENTAGE,
                unitTypeName: 'percentage',
                unitTypeSymbol: '%'
            },
            {
                unitTypeIndex: EPaymentsUnitTypes.FIXED_VALUE,
                unitTypeName: 'fixed_value',
                unitTypeSymbol: '$'
            }
        ];
        this.productsToRemove = [];
    }
    PaymentsProductsDialog.prototype.open = function ($, engine) {
        var _this = this;
        if (engine) {
            this.engine = engine;
        }
        if ($) {
            this.jq = $;
        }
        this.ui = this.engine.getLoader().getUI();
        this.i18n = this.engine.getLoader().getI18n();
        this.dispatcher = this.engine.getLoader().getCommandDispatcher();
        this.resourceManager = this.engine.getResourceManager();
        this.settings = this.engine.getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING);
        this.temporaryControlsData = {};
        var self = this, currencyId = self.settings.getProperty('currencyId') || PaymentsProductsDialog.DEFAULT_CURRENCY_ID;
        return this.jq.Deferred(function (defer) {
            _this.jq.when(self.resourceManager.get('/modules/Typescript/Form/resources/editor/Payments/ProductsDialog/payments-products-dialog.html'), self.resourceManager.get('/modules/Typescript/Form/resources/editor/Payments/ProductsDialog/payments-products-dialog-table-headings.html'), self.resourceManager.get('/modules/Typescript/Form/resources/editor/Payments/ProductsDialog/payments-products-dialog-discount-on-total.html'))
                .done(function (dialogBodyMarkup, dialogHeaderMarkup, dialogFooterMarkup) {
                var dialogBodyTemplate = new Salvage(dialogBodyMarkup), dialogHeaderTemplate = new Salvage(dialogHeaderMarkup), dialogFooterTemplate = new Salvage(dialogFooterMarkup), dialog = self.ui.createDialog(self.i18n.translateText('edt_UI_property_payments_products_dialog_title') || 'Products', [
                    {
                        type: EDialogButtonType.CANCEL,
                        callback: function () {
                            dialog.close();
                            defer.reject(new Error('User closed the dialog by pressing the Cancel button'));
                        }
                    },
                    {
                        type: EDialogButtonType.SAVE,
                        callback: function () {
                            self.engine.getLoader().trigger('products_dialog_on_save');
                            self.saveProductRemovalFromDialog();
                            dialog.close();
                            defer.resolve(self.model);
                        }
                    }
                ], {
                    width: "900px",
                    height: "615px"
                }), dialogHeaderContainer = dialog.dialog.getElementsByClassName('ui-titlebar')[0], dialogFooterContainer = dialog.dialog.getElementsByClassName('ui-buttons')[0], currencyButton = new ReactiveButton({
                    onClick: function () {
                        dialog.close();
                        self.openCurrencyDialog();
                    },
                    classList: 'i123-payments currency-button'
                }), addButton = document.createElement('div'), dialogTableHeadingsModel = { tableHeaders: [{ name: 'name' }, { name: 'price' }, { name: 'quantity' }, { name: 'discount' }, { name: 'tax' }] };
                dialog.dialog.classList.add('products-dialog');
                self.model = {
                    currencyId: currencyId,
                    currencySymbol: self.engine.getCurrency().getCurrencySymbolById(currencyId),
                    onTotalDiscountValue: self.generateGenericPriceFormatFromInputValue(self.settings.getProperty('discountValue')),
                    onTotalDiscountUnitType: self.settings.getProperty('discountType') || 0,
                    onTotalTaxValue: self.generateGenericPriceFormatFromInputValue(self.settings.getProperty('taxValue')),
                    onTotalTaxUnitType: self.settings.getProperty('taxType') || 0,
                    unitType: self.unitType,
                    controls: self.getControlsDataForSalvage()
                };
                if (null !== self.settings.getProperty('fixedAmount')) {
                    self.model.fixedAmount = self.settings.getProperty('fixedAmount').toFixed(2);
                }
                self.unitType[EPaymentsUnitTypes.FIXED_VALUE]['unitTypeSymbol'] = self.model.currencySymbol;
                for (var x = 0, len = self.model.controls.length; x < len; x++) {
                    if (null === self.model.controls[x]) {
                        self.model.controls.splice(x, 1);
                        len = self.model.controls.length;
                        x--;
                    }
                }
                dialogHeaderContainer.appendChild(currencyButton.getElement());
                addButton.classList.add('i123-add');
                addButton.addEventListener('click', function () {
                    var addProductRow = dialog.body.getElementsByClassName('add-new-product');
                    if (addProductRow.length != 0) {
                        self.jq(addProductRow).find('[data-role="text-dropdown"]').trigger('click');
                    }
                    else {
                        self.renderAddProductRow(self.jq, dialog, dialogBodyTemplate);
                    }
                });
                dialogHeaderContainer.appendChild(addButton);
                dialogHeaderContainer.insertAdjacentHTML('beforeend', dialogHeaderTemplate.parse(dialogTableHeadingsModel));
                self.ui.upgrade(dialogHeaderContainer);
                self.renderDiscountOnTotal(dialogFooterContainer, dialogFooterTemplate);
                self.renderDialogBody(self.jq, dialog, dialogBodyTemplate);
                if (self.selectedCurrency) {
                    var selectedCurrencyId = void 0;
                    if (typeof self.selectedCurrency.id === 'string') {
                        selectedCurrencyId = parseInt(self.selectedCurrency.id);
                    }
                    else {
                        selectedCurrencyId = self.selectedCurrency.id;
                    }
                    self.updateCurrency(self.jq, selectedCurrencyId, dialog, dialogBodyTemplate, dialogFooterTemplate);
                }
            })
                .fail(function (e) {
                console.warn('Failed to open Payment Calculations Settings. Error is displayed below');
                console.error(e);
            });
        }).promise();
    };
    PaymentsProductsDialog.prototype.updateFeeControl = function () {
        var _this = this;
        var feeControls = document.querySelectorAll('#form [data-role=control][data-type=fee]'), priceCurrencies = document.querySelectorAll('.form-currency-container > a[data-plugin=currency-editor]'), basePriceElements = document.querySelectorAll('#item .fee-base-price-container > input');
        if (!feeControls)
            return;
        feeControls.forEach(function (element) {
            var elementHash = element.getAttribute('data-hash'), feeControl = _this.engine.getDocument().getElementByHash(elementHash);
            feeControl.updatePriceFee();
        });
        if (!priceCurrencies)
            return;
        priceCurrencies.forEach(function (element) {
            element.innerText = _this.engine.getCurrency().getCurrencyById(_this.model.currencyId).isoCode;
        });
        if (!basePriceElements)
            return;
        basePriceElements.forEach(function (element) {
            element.value = element.value.replace(/[^0-9.]/g, '');
            element.value = _this.model.currencySymbol + element.value;
        });
    };
    PaymentsProductsDialog.prototype.openCurrencyDialog = function () {
        var _this = this;
        var currencyId = this.settings.getProperty('currencyId') || PaymentsProductsDialog.DEFAULT_CURRENCY_ID;
        var selectedCurrency;
        var currencyList = this.engine.getCurrency().enumerateCurrencies();
        var dropdownOptions = currencyList.map(function (currency) {
            return {
                id: currency.id,
                label: _this.i18n.translateText(currency.i18n)
            };
        });
        dropdownOptions = _.orderBy(dropdownOptions, ['label'], ['asc']);
        var dialog = this.ui.createDialog(this.i18n.translateText('payments_form_currency') || PaymentsProductsDialog.CURRENCY_DIALOG_TITLE, [
            {
                type: EDialogButtonType.SAVE,
                callback: function () {
                    _this.currencyDialogOnSaveHandler(dialog, selectedCurrency);
                }
            },
            {
                type: EDialogButtonType.CANCEL,
                callback: function () {
                    _this.switchDialogs(dialog);
                }
            }
        ], {
            width: "500px",
            height: "270px",
        });
        dialog.dialog.classList.add('currency-dialog');
        var description = document.createElement('p');
        description.textContent = this.i18n.translateText('payments_currency_dialog_description');
        dialog.body.appendChild(description);
        var searchableDropdownConfig = {
            placeholder: ''
        };
        if (this.selectedCurrency) {
            searchableDropdownConfig.selected = this.selectedCurrency.id;
        }
        else if (currencyId) {
            searchableDropdownConfig.selected = currencyId;
        }
        var searchableDropdown = new VirtualSelect(this.jq).init(dialog.body, dropdownOptions, searchableDropdownConfig);
        searchableDropdown.on('change', function () {
            selectedCurrency = searchableDropdown.getSelectedOption();
        });
    };
    PaymentsProductsDialog.prototype.currencyDialogOnSaveHandler = function (currencyDialog, selectedCurrency) {
        if (selectedCurrency) {
            this.selectedCurrency = selectedCurrency;
        }
        this.engine.getLoader().execCommand('track-event', 'payments_currency_change');
        this.engine.getLoader().trigger('payments_currency_change', selectedCurrency);
        this.switchDialogs(currencyDialog);
    };
    PaymentsProductsDialog.prototype.switchDialogs = function (currencyDialog) {
        var _this = this;
        currencyDialog.close();
        this.open()
            .done(function (model) {
            _this.saveData(model);
        })
            .fail(function (error) {
            console.warn(error.message);
        });
    };
    PaymentsProductsDialog.prototype.updateCurrency = function ($, currencyId, dialog, template, footerTemplate) {
        this.model.currencyId = currencyId;
        this.model.currencySymbol = this.engine.getCurrency().getCurrencySymbolById(currencyId);
        this.unitType[EPaymentsUnitTypes.FIXED_VALUE]['unitTypeSymbol'] = this.model.currencySymbol;
        var dialogFooter = dialog.dialog.getElementsByClassName('ui-buttons')[0], tableRows = dialogFooter.getElementsByClassName('payments-products-dialog-row');
        for (var x = 0, len = tableRows.length; x < len; x++) {
            dialogFooter.removeChild(tableRows[0]);
        }
        this.renderDiscountOnTotal(dialogFooter, footerTemplate);
        this.ui.upgrade(dialogFooter);
        this.renderDialogBody(this.jq, dialog, template);
    };
    PaymentsProductsDialog.prototype.renderDiscountOnTotal = function (container, template) {
        container.insertAdjacentHTML('afterbegin', template.parse(this.model));
        this.ui.upgrade(container);
    };
    PaymentsProductsDialog.prototype.renderAddProductRow = function ($, dialog, template) {
        var self = this, container = dialog.body.querySelector('[data-role="edit-products-options"]'), row = document.createElement('div'), rows = container.getElementsByClassName('payments-products-dialog-row'), referenceElement = ((rows.length != 0)
            ? rows[rows.length - 1].nextSibling
            : container.firstChild), select = document.createElement('select'), deleteButton = document.createElement('div'), controlsList = this.getCompatibleProductControls();
        row.classList.add('payments-products-dialog-row');
        row.classList.add('add-new-product');
        select.setAttribute('data-appearance', 'text');
        var option = document.createElement('option');
        option.value = '';
        option.text = self.i18n.translateText('edt_UI_property_payments_products_dialog_select product_label');
        select.add(option);
        if (!this.model.fixedAmount) {
            var optionFixedAmount = document.createElement('option');
            optionFixedAmount.value = '1';
            optionFixedAmount.text = self.i18n.translateText('edt_UI_property_payments_products_dialog_fixed_amount_label');
            select.add(optionFixedAmount);
        }
        for (var x = 0, len = controlsList.length; x < len; x++) {
            var option_1 = document.createElement('option');
            option_1.value = controlsList[x].id.toString();
            option_1.text = controlsList[x].label;
            select.add(option_1);
        }
        row.appendChild(select);
        deleteButton.classList.add('payments-products-dialog-column');
        deleteButton.classList.add('i-lg');
        deleteButton.classList.add('i123-close');
        deleteButton.setAttribute('data-role', 'control-delete');
        row.appendChild(deleteButton);
        container.insertBefore(row, referenceElement);
        this.ui.upgrade(container.parentNode);
        container.parentNode.scrollTop = container.offsetHeight - container.parentNode.offsetHeight;
        var $upgradedDropdown = $('.add-new-product [data-role="text-dropdown"]');
        $upgradedDropdown.get(0).addEventListener('click', function (event) {
            var option = event.target;
            if (option.hasAttribute('data-value')) {
                var controlId = parseInt(event.target.getAttribute('data-value').replace(/"/g, '')), controlName = event.target.innerHTML;
                if (controlId === 1) {
                    self.model.fixedAmount = self.generateGenericPriceFormatFromInputValue('0');
                }
                else {
                    var control = self.engine.getDocument().getElementById(controlId);
                    if (control.hasProperty('payments')) {
                        control.setProperty('payments.isProduct', true);
                    }
                    var hasQuantity = self.getControlHasQuantity(control);
                    self.model.controls.push({
                        rowIndex: self.model.controls.length,
                        controlId: controlId,
                        name: controlName,
                        customName: null,
                        hasMultiplePrices: PaymentsProductsDialog.CONTROLS_WITH_MULTIPLE_PRICES.indexOf(control.getTypeId()) > -1,
                        hasVariablePrice: PaymentsProductsDialog.CONTROLS_WITH_VARIABLE_PRICE.indexOf(control.getTypeId()) > -1,
                        price: self.getControlSinglePrice(control),
                        hasQuantity: hasQuantity,
                        quantity: null,
                        quantityControls: hasQuantity ? self.getCompatibleQuantityControls(controlId) : null,
                        discountValue: self.generateGenericPriceFormatFromInputValue('0'),
                        discountUnitType: EPaymentsUnitTypes.PERCENTAGE,
                        taxValue: self.generateGenericPriceFormatFromInputValue('0'),
                        taxUnitType: EPaymentsUnitTypes.PERCENTAGE
                    });
                }
                self.renderDialogBody($, dialog, template);
                event.stopPropagation();
                self.engine.getLoader().execCommand('track-event', 'payments_products_add');
            }
        }, true);
        $upgradedDropdown.trigger('click');
    };
    PaymentsProductsDialog.prototype.renderDialogBody = function ($, dialog, template) {
        dialog.body.innerHTML = template.parse(this.model);
        this.i18n.translateDOMNode(dialog.body);
        this.dispatcher.addPerfectScrollbar(dialog.body);
        this.ui.upgrade(dialog.body);
        this.attachDialogEvents(dialog);
    };
    PaymentsProductsDialog.prototype.getControlHasQuantity = function (control) {
        if (control.getTypeId() === ElementTypes.CONTROL_TYPE_FEE) {
            return false;
        }
        return true;
    };
    PaymentsProductsDialog.prototype.getControlsDataForSalvage = function () {
        var _this = this;
        var products = this.settings.getProperty('productsData');
        var rowIndex = 0;
        if (null === products) {
            return [];
        }
        return products.map(function (product) {
            var control = _this.engine.getDocument().getElementById(product.controlId);
            if (!control) {
                return null;
            }
            var hasQuantity = _this.getControlHasQuantity(control);
            return {
                rowIndex: rowIndex++,
                controlId: product.controlId,
                name: _this.getControlName(control),
                customName: product.details,
                hasMultiplePrices: PaymentsProductsDialog.CONTROLS_WITH_MULTIPLE_PRICES.indexOf(control.getTypeId()) > -1,
                hasVariablePrice: PaymentsProductsDialog.CONTROLS_WITH_VARIABLE_PRICE.indexOf(control.getTypeId()) > -1,
                price: _this.getControlSinglePrice(control),
                hasQuantity: hasQuantity,
                quantity: product.quantityControlId,
                quantityControls: hasQuantity ? _this.getCompatibleQuantityControls(control.getId()) : null,
                discountValue: _this.generateGenericPriceFormatFromInputValue(String(product.discount)),
                discountUnitType: product.discountType,
                taxValue: _this.generateGenericPriceFormatFromInputValue(String(product.tax)),
                taxUnitType: product.taxType,
            };
        });
    };
    PaymentsProductsDialog.prototype.attachDialogEvents = function (dialog) {
        var self = this;
        if (!dialog.dialog.hasAttribute('events-attached')) {
            $(dialog.dialog)
                .on('click', '[data-role="control-price"][data-price-literal], [data-role="control-discount"], [data-role="control-tax"]', function () {
                self.removeClickedState($);
                this.setAttribute('data-has-click', '');
                $(this).find('input:not([type="hidden"])').each(function () {
                    this.focus();
                });
            })
                .on('click', '[data-role="control-price"][data-price-multiple]', function () {
                var i18n = self.engine.getLoader().getI18n();
                var controlId = +($(this).closest('[data-control-identifier]').attr('data-control-identifier'));
                var control = self.engine.getDocument().getElementById(controlId);
                var choices = typeof self.temporaryControlsData[controlId] !== 'undefined'
                    ? FormUtils.clone(self.temporaryControlsData[controlId])
                    : (FormUtils.clone(control.getProperty('choices.values')) || []);
                var choicesInspectorPluginInstance = new ChoicesEditorInspectorPlugin();
                dialog.hide();
                choicesInspectorPluginInstance.setCurrentSelectedControl(self.engine, control);
                choicesInspectorPluginInstance.setDialogOptions({
                    editingContext: "PAYMENTS_VALUES",
                    itemType: "CHOICE",
                    container: null,
                    choices: choices,
                    defaultOptionInputType: 0,
                    dialogTitle: i18n.translateText('edt_UI_property_payments_value'),
                    newChoiceText: i18n.translateText('edt_text_new_choice'),
                    editorUserInterface: self.ui,
                    useDifferentValuesPerStatement: false
                });
                choicesInspectorPluginInstance.editChoices()
                    .then(function (choices) {
                    self.temporaryControlsData[controlId] = FormUtils.clone(choices);
                    dialog.show();
                })
                    .fail(function (e) {
                    dialog.show();
                    console.warn('Failed to save options. Error is displayed below');
                    console.error(e);
                });
            })
                .on('change', '[data-role="control-name"] input:not([type="hidden"])', function () {
                var $parent = $(this).parents('.payments-products-dialog-row'), control = self.engine.getDocument().getElementById(parseInt($parent.attr('data-control-identifier'))), rowIndex = parseInt($parent.attr('data-index'));
                self.updateControlConfigurationInsideModel(rowIndex, 'customName', this.value);
                $parent.find('[data-role="control-name"]').attr('title', self.getControlName(control));
            })
                .on('change', '[data-role="control-price"][data-price-literal] input:not([type="hidden"])', function () {
                var $input = $(this), inputValue = self.generateGenericPriceFormatFromInputValue(this.value), $row = $input.parents('.payments-products-dialog-row'), $span = $row.find('.payments-products-dialog-column[data-role="control-price"][data-price-literal] span'), rowIndex = parseInt($row.attr('data-index'));
                if (rowIndex === -1) {
                    self.model.fixedAmount = inputValue;
                }
                else {
                    self.updateControlConfigurationInsideModel(rowIndex, 'price', inputValue);
                }
                $input.attr('title', self.model.currencySymbol + this.value);
                $span.text(self.model.currencySymbol + inputValue);
                this.value = inputValue;
            })
                .on('input', '[data-role="control-price"][data-price-literal] input:not([type="hidden"])', function () {
                var $parent = $(this).parents('.payments-products-dialog-row'), controlId = $parent.attr('data-control-identifier'), originalInputValue = self.generateGenericPriceFormatFromInputValue(this.value);
                $('[data-control-identifier="' + controlId + '"]').each(function () {
                    var $secondaryParent = $(this);
                    if ($parent.get(0) !== $secondaryParent.get(0)) {
                        var $input = $secondaryParent.find('.payments-products-dialog-column[data-role="control-price"][data-price-literal] input'), $span = $secondaryParent.find('.payments-products-dialog-column[data-role="control-price"][data-price-literal] span');
                        self.updateControlConfigurationInsideModel(parseInt($secondaryParent.attr('data-index')), 'price', originalInputValue);
                        $input.attr('title', self.model.currencySymbol + originalInputValue);
                        $span.text(self.model.currencySymbol + originalInputValue);
                        $secondaryParent.val(originalInputValue);
                    }
                });
            })
                .on('change', '[data-role="control-discount"] input:not([type="hidden"])', function () {
                var $input = $(this), $row = $input.parents('.payments-products-dialog-row'), $column = $input.parents('.payments-products-dialog-column'), $span = $column.find('span'), rowIndex = parseInt($row.attr('data-index')), inputValue = this.value, enforceMaxValue = false, title = '- ';
                if (!isNaN(rowIndex)) {
                    self.engine.getLoader().execCommand('track-event', 'payments_products_discount_value_change');
                    if (self.model.controls[rowIndex].discountUnitType === 0) {
                        enforceMaxValue = true;
                    }
                    inputValue = self.generateGenericPriceFormatFromInputValue(this.value, enforceMaxValue);
                    self.updateControlConfigurationInsideModel(rowIndex, 'discountValue', inputValue);
                    title += self.generateDiscountAndTaxValue(inputValue, self.model.controls[rowIndex].discountUnitType);
                }
                else {
                    self.engine.getLoader().execCommand('track-event', 'payments_products_discount_total_value_change');
                    if (self.model.onTotalDiscountUnitType === 0) {
                        enforceMaxValue = true;
                    }
                    inputValue = self.generateGenericPriceFormatFromInputValue(this.value, enforceMaxValue);
                    self.model.onTotalDiscountValue = inputValue;
                    title += self.generateDiscountAndTaxValue(inputValue, self.model.onTotalDiscountUnitType);
                }
                $column.attr('title', title);
                $span.text(title);
                $input.val(inputValue);
            })
                .on('change', '[data-role="control-tax"] input:not([type="hidden"])', function () {
                var $input = $(this), $row = $input.parents('.payments-products-dialog-row'), $column = $input.parents('.payments-products-dialog-column'), $span = $column.find('span'), rowIndex = parseInt($row.attr('data-index')), inputValue = this.value, title = '+ ';
                if (!isNaN(rowIndex)) {
                    self.engine.getLoader().execCommand('track-event', 'payments_products_tax_value_change');
                    inputValue = self.generateGenericPriceFormatFromInputValue(this.value);
                    self.updateControlConfigurationInsideModel(rowIndex, 'taxValue', inputValue);
                    title += self.generateDiscountAndTaxValue(inputValue, self.model.controls[rowIndex].taxUnitType);
                }
                else {
                    self.engine.getLoader().execCommand('track-event', 'payments_products_tax_total_value_change');
                    inputValue = self.generateGenericPriceFormatFromInputValue(this.value);
                    self.model.onTotalTaxValue = inputValue;
                    title += self.generateDiscountAndTaxValue(inputValue, self.model.onTotalTaxUnitType);
                }
                $column.attr('title', title);
                $span.text(title);
                $input.val(inputValue);
            })
                .on('click', '.ui-body .payments-products-dialog-row [data-role="control-delete"]', function () {
                var itemParent = $(this).parents('.payments-products-dialog-row');
                self.engine.getLoader().execCommand('track-event', 'payments_products_delete');
                var rowIndex = parseInt(itemParent.attr('data-index'));
                var rowControlId = parseInt(itemParent.attr('data-control-identifier'));
                self.productsToRemove.push(rowControlId);
                if (rowIndex === -1) {
                    self.model.fixedAmount = null;
                }
                else {
                    for (var x = 0, len = self.model.controls.length; x < len; x++) {
                        if (rowIndex === self.model.controls[x].rowIndex) {
                            self.model.controls.splice(x, 1);
                            break;
                        }
                    }
                }
                $(this).parent().remove();
            });
            dialog.dialog.setAttribute('events-attached', '1');
        }
        $('[data-role="control-quantity"] [data-role="text-dropdown"]').each(function () {
            this.addEventListener('click', function (event) {
                var option = $(event.target);
                if (option.attr('data-value')) {
                    var rowIndex = parseInt(option.parents('.payments-products-dialog-row').attr('data-index')), optionValue = parseInt(option.attr('data-value').replace(/"/g, '')) || null;
                    self.updateControlConfigurationInsideModel(rowIndex, 'quantity', optionValue);
                }
            }, true);
        });
        $('[data-role="control-discount"] [data-role="text-dropdown"]').each(function () {
            this.addEventListener('click', function (event) {
                var $option = $(event.target);
                if ($option.attr('data-value')) {
                    var $row = $option.parents('.payments-products-dialog-row'), $column = $option.parents('.payments-products-dialog-column'), $span = $column.find('span'), $input = $column.find('input:not([type="hidden"])'), rowIndex = parseInt($row.attr('data-index')), optionValue = parseInt(JSON.parse($option.attr('data-value'))), enforceMaxValue = optionValue === 0, inputValue = self.generateGenericPriceFormatFromInputValue($input.val(), enforceMaxValue), title = '- ';
                    if (!isNaN(rowIndex)) {
                        self.engine.getLoader().execCommand('track-event', 'payments_products_discount_type_change');
                        self.updateControlConfigurationInsideModel(rowIndex, 'discountUnitType', optionValue);
                        self.updateControlConfigurationInsideModel(rowIndex, 'discountValue', inputValue);
                        title += self.generateDiscountAndTaxValue(inputValue, self.model.controls[rowIndex].discountUnitType);
                    }
                    else {
                        self.engine.getLoader().execCommand('track-event', 'payments_products_discount_total_type_change');
                        self.model.onTotalDiscountUnitType = optionValue;
                        self.model.onTotalDiscountValue = inputValue;
                        title += self.generateDiscountAndTaxValue(inputValue, self.model.onTotalDiscountUnitType);
                    }
                    $column.attr('title', title);
                    $span.text(title);
                    $input.val(inputValue);
                    self.removeClickedState($);
                }
            }, true);
        });
        $('[data-role="control-tax"] [data-role="text-dropdown"]').each(function () {
            this.addEventListener('click', function (event) {
                var $option = $(event.target);
                if ($option.attr('data-value')) {
                    var $row = $option.parents('.payments-products-dialog-row'), $column = $option.parents('.payments-products-dialog-column'), $span = $column.find('span'), $input = $column.find('input:not([type="hidden"])'), rowIndex = parseInt($row.attr('data-index')), optionValue = parseInt(JSON.parse($option.attr('data-value'))), inputValue = self.generateGenericPriceFormatFromInputValue($input.val()), title = '+ ';
                    if (!isNaN(rowIndex)) {
                        self.engine.getLoader().execCommand('track-event', 'payments_products_tax_type_change');
                        self.updateControlConfigurationInsideModel(rowIndex, 'taxUnitType', optionValue);
                        self.updateControlConfigurationInsideModel(rowIndex, 'taxValue', inputValue);
                        title += self.generateDiscountAndTaxValue(inputValue, self.model.controls[rowIndex].taxUnitType);
                    }
                    else {
                        self.engine.getLoader().execCommand('track-event', 'payments_products_tax_total_type_change');
                        self.model.onTotalTaxUnitType = optionValue;
                        self.model.onTotalTaxValue = inputValue;
                        title += self.generateDiscountAndTaxValue(inputValue, self.model.onTotalTaxUnitType);
                    }
                    $column.attr('title', title);
                    $span.text(title);
                    $input.val(inputValue);
                    self.removeClickedState($);
                }
            }, true);
        });
        dialog.dialog.addEventListener('click', function (event) {
            var $element = $(event.target), $priceParents = $element.parents('[data-role="control-price"][data-price-literal]'), $discountParents = $element.parents('[data-role="control-discount"]'), $taxParents = $element.parents('[data-role="control-tax"]');
            if ($priceParents.length === 0 &&
                $discountParents.length === 0 &&
                $taxParents.length === 0) {
                self.removeClickedState($);
            }
        }, true);
    };
    PaymentsProductsDialog.prototype.generateGenericPriceFormatFromInputValue = function (value, enforceMax100Value) {
        enforceMax100Value = (undefined !== enforceMax100Value) ? enforceMax100Value : false;
        value = value || '0';
        if (parseFloat(value) < 0) {
            value = '0';
        }
        if (parseFloat(value) > 100 && true === enforceMax100Value) {
            value = '100';
        }
        return (Math.round(parseFloat(value || '0') * 100) / 100).toFixed(2);
    };
    PaymentsProductsDialog.prototype.generateDiscountAndTaxValue = function (inputValue, unitType) {
        var result = inputValue + this.unitType[EPaymentsUnitTypes.PERCENTAGE].unitTypeSymbol;
        if (unitType === 1) {
            result = this.model.currencySymbol + inputValue;
        }
        return result;
    };
    PaymentsProductsDialog.prototype.removeClickedState = function ($) {
        $('.payments-products-dialog-row [data-has-click]').each(function () {
            this.removeAttribute('data-has-click');
        });
    };
    PaymentsProductsDialog.prototype.updateControlConfigurationInsideModel = function (rowIndex, key, value) {
        for (var x = 0, len = this.model.controls.length; x < len; x++) {
            if (rowIndex === this.model.controls[x].rowIndex) {
                this.model.controls[x][key] = value;
                break;
            }
        }
    };
    PaymentsProductsDialog.prototype.getCompatibleProductControls = function () {
        var _this = this;
        var formControls = this.engine.getDocument().getControlsList();
        var result = [];
        formControls.forEach(function (control) {
            if (control.getId() !== null
                && (PaymentsProductsDialog.COMPATIBLE_QUANTITY_CONTROLS_WITHOUT_VALUE.indexOf(control.getTypeId()) > -1
                    || control.hasProperty('payments.value'))) {
                result.push({
                    id: control.getId(),
                    label: _this.getControlName(control)
                });
            }
        });
        return result;
    };
    PaymentsProductsDialog.prototype.getCompatibleQuantityControls = function (excludedElementId) {
        var formControls = this.engine.getDocument().getControlsList(), result = [];
        for (var x = 0, len = formControls.length; x < len; x++) {
            if (null === formControls[x].getId() || excludedElementId === formControls[x].getId()) {
                continue;
            }
            if (PaymentsProductsDialog.COMPATIBLE_QUANTITY_CONTROLS_WITHOUT_VALUE.indexOf(formControls[x].getTypeId()) > -1) {
                result.push({
                    id: formControls[x].getId(),
                    label: this.getControlName(formControls[x])
                });
                continue;
            }
            if (formControls[x].hasProperty('payments.value')) {
                var paymentsValue = formControls[x].getProperty('payments.value');
                if (null !== paymentsValue && paymentsValue.length >= 1 && paymentsValue.reduce(function (a, b) { return a + b; }, 0) !== 0) {
                    result.push({
                        id: formControls[x].getId(),
                        label: this.getControlName(formControls[x])
                    });
                }
            }
        }
        return result;
    };
    PaymentsProductsDialog.prototype.getControlName = function (control) {
        return (control.hasProperty('label.labelText')
            && '' !== control.getProperty('label.labelText'))
            ? control.getProperty('label.labelText')
            : 'Control #' + control.getId();
    };
    PaymentsProductsDialog.prototype.getControlSinglePrice = function (control) {
        if (!control.hasProperty('payments.value')) {
            return null;
        }
        var controlPrice = control.getProperty('payments.value') || ['0'];
        return (PaymentsProductsDialog.CONTROLS_WITH_MULTIPLE_PRICES.indexOf(control.getTypeId()) === -1
            && PaymentsProductsDialog.CONTROLS_WITH_VARIABLE_PRICE.indexOf(control.getTypeId()) === -1)
            ? this.generateGenericPriceFormatFromInputValue(controlPrice[0])
            : null;
    };
    PaymentsProductsDialog.prototype.saveProductRemovalFromDialog = function () {
        var countProductsToRemove = {};
        var countProductsInDialog = {};
        var self = this;
        self.productsToRemove.forEach(function (i) { countProductsToRemove[i] = (countProductsToRemove[i] || 0) + 1; });
        if (self.settings.getProperty('productsData') == null) {
            var dialogProducts = [];
        }
        else {
            var dialogProducts = self.settings.getProperty('productsData').map(function (elem) {
                return elem.controlId;
            });
        }
        dialogProducts.forEach(function (i) { countProductsInDialog[i] = (countProductsInDialog[i] || 0) + 1; });
        self.productsToRemove.map(function (elem) {
            if (!isNaN(elem) &&
                ((countProductsToRemove[elem] === countProductsInDialog[elem]) || (countProductsToRemove[elem] >= 1 && countProductsInDialog[elem] === undefined))) {
                var control = self.engine.getDocument().getElementById(elem);
                if (control.hasProperty('payments')) {
                    control.setProperty('payments.isProduct', false);
                }
            }
        });
    };
    PaymentsProductsDialog.prototype.saveData = function (model) {
        var self = this, inspector = document.getElementById('item'), controlOpenedInInspector = this.engine.getDocument().getElementByHash(inspector.getAttribute('data-target-element')), previouslyUsedControls = [], currentlyUsedControls = [];
        (this.settings.getProperty('productsData') || []).forEach(function (product) {
            previouslyUsedControls.push(product.controlId);
        });
        this.settings.setProperty('currencyId', model.currencyId);
        if (undefined !== model.fixedAmount && null !== model.fixedAmount) {
            this.settings.setProperty('fixedAmount', parseFloat(model.fixedAmount));
            this.engine.getLoader().getCommandDispatcher().trackFirstValueSaved();
        }
        else {
            this.settings.setProperty('fixedAmount', null);
        }
        this.settings.setProperty('discountValue', parseFloat(model.onTotalDiscountValue));
        this.settings.setProperty('discountType', model.onTotalDiscountUnitType);
        this.settings.setProperty('taxValue', parseFloat(model.onTotalTaxValue));
        this.settings.setProperty('taxType', model.onTotalTaxUnitType);
        this.settings.setProperty('productsData', model.controls.map(function (product) {
            var controlId = product.controlId, control = self.engine.getDocument().getElementById(controlId), choicesPropertyName = 'choices.values', loader = self.engine.getLoader(), settings = control.getForm().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), products = settings.getProperty('productsData'), paymentProcessorsLink = window.location.href.replace('p=edit_fields', 'p=settings&tab=4'), notificationMessage = loader.getI18n().translateText('edt_UI_msg_payments_products_first_add_notification', paymentProcessorsLink), configuration = self.engine.getDocument().getConfiguration(), hasProcessorsInjected = configuration.getProperty('hasProcessorsInjected');
            if ((!products || products.length === 0) && !hasProcessorsInjected) {
                loader.getUI().createNotification(notificationMessage, false, ENotificationStyle.DEFAULT, true);
            }
            if (PaymentsProductsDialog.CONTROLS_WITH_MULTIPLE_PRICES.indexOf(control.getTypeId()) === -1
                && PaymentsProductsDialog.CONTROLS_WITH_VARIABLE_PRICE.indexOf(control.getTypeId()) === -1) {
                control.setProperty('payments.value', [parseFloat(product.price || '0')]);
                self.updateFeeControl();
                self.engine.getLoader().getCommandDispatcher().trackFirstValueSaved();
                self.engine.getLoader().execCommand('track-event', 'payments_products_price_change');
                loader.trigger('payments_products_price_change');
                if (controlOpenedInInspector && controlOpenedInInspector.getId() === controlId) {
                    var inspectorFieldToUpdate = inspector.querySelector('[data-role="attribute-group"][data-name="payments"] [data-role="property"][data-property-name="payments-virtualValue"] input[type="number"]');
                    if (null !== inspectorFieldToUpdate) {
                        inspectorFieldToUpdate.value = String(product.price);
                    }
                }
            }
            if (PaymentsProductsDialog.CONTROLS_WITH_MULTIPLE_PRICES.indexOf(control.getTypeId()) > -1) {
                var choices = void 0;
                if (undefined === self.temporaryControlsData[controlId]) {
                    choices = control.getProperty(choicesPropertyName);
                }
                else {
                    choices = self.temporaryControlsData[controlId];
                }
                choices.forEach(function (choice) {
                    if (typeof choice.paymentsValue === 'undefined' || choice.paymentsValue === null) {
                        choice.paymentsValue = 0;
                    }
                });
                (new ChoicesEditorInspectorPlugin()).updateControlChoicesAndDOM(control, choices, self.engine.getJQuery());
            }
            currentlyUsedControls.push(controlId);
            if (control.hasProperty('payments.hasProductsSettingsEntry')) {
                control.setProperty('payments.hasProductsSettingsEntry', true);
            }
            return {
                controlId: controlId,
                details: product.customName,
                quantityControlId: product.quantity || null,
                tax: parseFloat(product.taxValue),
                taxType: product.taxUnitType,
                discount: parseFloat(product.discountValue),
                discountType: product.discountUnitType
            };
        }));
        this.engine.getLoader().getCommandDispatcher().reloadVisiblePanel();
        previouslyUsedControls.forEach(function (controlId) {
            if (currentlyUsedControls.indexOf(controlId) === -1) {
                var control = self.engine.getDocument().getElementById(controlId);
                if (control && control.hasProperty('payments.hasProductsSettingsEntry')) {
                    control.setProperty('payments.hasProductsSettingsEntry', false);
                }
            }
        });
    };
    PaymentsProductsDialog.openFromExternalSource = function () {
        var dialog = new PaymentsProductsDialog(), editorLoader = window['ed'];
        dialog.open(editorLoader.getJQuery(), editorLoader.getEngine())
            .done(function (model) {
            dialog.saveData(model);
        })
            .fail(function (error) {
            console.warn(error.message);
        });
    };
    PaymentsProductsDialog.DEFAULT_CURRENCY_ID = 1;
    PaymentsProductsDialog.COMPATIBLE_QUANTITY_CONTROLS_WITHOUT_VALUE = [
        ElementTypes.CONTROL_TYPE_TEXT,
        ElementTypes.CONTROL_TYPE_NUMBER,
        ElementTypes.CONTROL_TYPE_STAR_RATING,
        ElementTypes.CONTROL_TYPE_PRICE,
        ElementTypes.CONTROL_TYPE_FORMULA
    ];
    PaymentsProductsDialog.CONTROLS_WITH_MULTIPLE_PRICES = [
        ElementTypes.CONTROL_TYPE_DROPDOWN,
        ElementTypes.CONTROL_TYPE_CHECKBOX,
        ElementTypes.CONTROL_TYPE_RADIO,
        ElementTypes.CONTROL_TYPE_LIKERT_SCALE
    ];
    PaymentsProductsDialog.CONTROLS_WITH_VARIABLE_PRICE = [
        ElementTypes.CONTROL_TYPE_FORMULA
    ];
    PaymentsProductsDialog.CURRENCY_DIALOG_TITLE = 'Form currency';
    return PaymentsProductsDialog;
}());
var PaymentsSummaryHelper = (function () {
    function PaymentsSummaryHelper(engine) {
        this.engine = engine;
    }
    PaymentsSummaryHelper.salvageHelperTwoDecimals = function (s) {
        var toString = String(s || '0'), parts = toString.split('.'), intPart = parts[0] || '0';
        var floatPart = parts[1] || '';
        while (floatPart.length < 2) {
            floatPart = floatPart + "0";
        }
        return intPart + "." + floatPart;
    };
    PaymentsSummaryHelper.salvageHelperToPrice = function (s) {
        var toString = String(s || '0'), parts = toString.split('.'), intPart = parts[0] || '0';
        var floatPart = parts[1] || '';
        if (floatPart.length > 2) {
            floatPart = String(parseFloat("0." + floatPart).toFixed(2)).slice(2);
        }
        else {
            while (floatPart.length < 2) {
                floatPart = floatPart + "0";
            }
        }
        return intPart + "." + floatPart;
    };
    PaymentsSummaryHelper.salvageHelperToAbsPrice = function (s) {
        var toString = String(Math.abs(parseFloat(String(s || '0')))), parts = toString.split('.'), intPart = parts[0] || '0';
        var floatPart = parts[1] || '';
        if (floatPart.length > 2) {
            floatPart = String(parseFloat("0." + floatPart).toFixed(2)).slice(2);
        }
        else {
            while (floatPart.length < 2) {
                floatPart = floatPart + "0";
            }
        }
        return intPart + "." + floatPart;
    };
    PaymentsSummaryHelper.salvageHelperGetValueSign = function (s) {
        var theValue = parseFloat(String(s || '0'));
        if (theValue < 0) {
            return '-';
        }
        else if (theValue > 0) {
            return '+';
        }
        return '';
    };
    PaymentsSummaryHelper.addSalvageHelpers = function () {
        Salvage.addHelper({
            name: "twoDecimals",
            func: PaymentsSummaryHelper.salvageHelperTwoDecimals
        });
        Salvage.addHelper({
            name: "toPrice",
            func: PaymentsSummaryHelper.salvageHelperToPrice
        });
        Salvage.addHelper({
            name: "toAbsPrice",
            func: PaymentsSummaryHelper.salvageHelperToAbsPrice
        });
        Salvage.addHelper({
            name: "getValueSign",
            func: PaymentsSummaryHelper.salvageHelperGetValueSign
        });
    };
    PaymentsSummaryHelper.createInstance = function (engine) {
        if (!PaymentsSummaryHelper.instance && engine) {
            PaymentsSummaryHelper.instance = new PaymentsSummaryHelper(engine);
        }
    };
    PaymentsSummaryHelper.getInstance = function () {
        if (!PaymentsSummaryHelper.instance) {
            PaymentsSummaryHelper.createInstance(window["Engine"]);
        }
        return PaymentsSummaryHelper.instance;
    };
    PaymentsSummaryHelper.prototype.computeLastCalculationHTMLMarkup = function (templateText, response, options, isEditFormView) {
        var _this = this;
        if (isEditFormView === void 0) { isEditFormView = false; }
        if (!response || !response.invoiceObject || !response.invoiceObject.items || !response.invoiceObject.items.length) {
            return null;
        }
        var hasAccessibilityEnabled = this.engine.getDocument().getConfiguration().getProperty('hasAccessibilityEnabled', false);
        var hasPaymentProcessors = this.engine.getLoader().getLoaderDependency(ELoaderDependency.HAS_ENABLED_PAYMENT_PROCESSORS);
        var showDiscountAndTax = !!options.showDiscountAndTax, showQuantityColumn = !!options.showQuantityColumn, showIndexColumn = !!options.showIndexColumn, hasProductItems = _.some(response.invoiceObject.items, ['type', EInvoiceItemType.PRODUCT]) || _.some(response.invoiceObject.items, ['type', EInvoiceItemType.FIXED_AMOUNT]);
        var order = 0;
        var productIndex = 0;
        var items = [];
        _.forEach(response.invoiceObject.items, function (invoiceItem) {
            var isProduct = (invoiceItem.type === EInvoiceItemType.PRODUCT || invoiceItem.type === EInvoiceItemType.FIXED_AMOUNT);
            if (isProduct) {
                productIndex = invoiceItem.number;
            }
            var isAdditionalItem = _.indexOf(PaymentsSummaryHelper.additionalItemTypes, invoiceItem.type) > -1;
            var isCoupon = invoiceItem.type === EInvoiceItemType.INVOICE_COUPON;
            var isDiscount = invoiceItem.type === EInvoiceItemType.INVOICE_DISCOUNT || invoiceItem.type === EInvoiceItemType.PRODUCT_DISCOUNT;
            var isFee = invoiceItem.type === EInvoiceItemType.INVOICE_FEE;
            var isProductRow = isProduct ||
                ((invoiceItem.type === EInvoiceItemType.PRODUCT_DISCOUNT || invoiceItem.type === EInvoiceItemType.PRODUCT_TAX) && invoiceItem.number === productIndex);
            var isSubtotal = invoiceItem.type === EInvoiceItemType.SUBTOTAL;
            var isTax = invoiceItem.type === EInvoiceItemType.INVOICE_TAX || invoiceItem.type === EInvoiceItemType.PRODUCT_TAX;
            var isRowWithValueSign = isTax || isDiscount || isCoupon;
            var isVisible = ((invoiceItem.type === EInvoiceItemType.INVOICE_DISCOUNT || invoiceItem.type === EInvoiceItemType.INVOICE_TAX) && !showDiscountAndTax)
                || (invoiceItem.type === EInvoiceItemType.SUBTOTAL && !hasProductItems)
                ? false
                : true;
            var orderOffset = (isProductRow ? 0 : 10000) + invoiceItem.number;
            var formulaMatches = /\[\[\[\[(.*)\]\]\]\]/.exec(invoiceItem.description);
            var item = {
                options: {
                    isAdditionalItem: isAdditionalItem,
                    isDiscount: isDiscount,
                    isFee: isFee,
                    isProduct: isProduct,
                    isProductRow: isProductRow,
                    isRowWithValueSign: isRowWithValueSign,
                    isSubtotal: isSubtotal,
                    isTax: isTax,
                    isVisible: isVisible
                },
                order: orderOffset,
                orderVisible: isProduct ? ++order : 0,
                price: invoiceItem.totalPrice,
                primaryDescription: formulaMatches ? invoiceItem.description.replace(formulaMatches[0], '') : invoiceItem.description,
                quantity: invoiceItem.quantity,
                secondaryDescription: (isDiscount || isTax)
                    ? "" + (invoiceItem.valueType === EInvoiceValueType.FIXED ? response.currencyHTML : '') + invoiceItem.value + (invoiceItem.valueType === EInvoiceValueType.PERCENT ? '%' : '')
                    : '',
                total: invoiceItem.quantity * invoiceItem.totalPrice,
                type: invoiceItem.type
            };
            items.push(item);
            if (formulaMatches) {
                items.push(_this.getFormulaItem(formulaMatches, orderOffset));
            }
        });
        items = _.sortBy(items, 'order', function (paymentSummaryItem) {
            return PaymentsSummaryHelper.orderIndexByType[paymentSummaryItem.type];
        });
        var columnsName = {
            index: this.getColumnLabel(options.columns, ESettingColumnName.INDEX, 'textdef_255'),
            description: this.getColumnLabel(options.columns, ESettingColumnName.DESCRIPTION, 'textdef_147'),
            price: this.getColumnLabel(options.columns, ESettingColumnName.UNIT_PRICE, 'textdef_148'),
            quantity: this.getColumnLabel(options.columns, ESettingColumnName.QUANTITY, 'textdef_165'),
            total: this.getColumnLabel(options.columns, ESettingColumnName.TOTAL_PRICE, 'textdef_256'),
        };
        var model = {
            currency: response.currencyHTML,
            items: items,
            options: {
                hasAccessibilityEnabled: hasAccessibilityEnabled,
                hasPaymentProcessors: hasPaymentProcessors,
                hasProductItems: hasProductItems,
                isEditFormView: isEditFormView,
                showDiscountAndTax: showDiscountAndTax,
                showQuantityColumn: showQuantityColumn,
                showIndexColumn: showIndexColumn
            },
            total: response.invoiceObject.total,
            columnsName: columnsName
        };
        var salvage = new Salvage(templateText);
        return salvage.parse(model);
    };
    PaymentsSummaryHelper.prototype.getColumnLabel = function (columns, columnName, i18nKey) {
        var column = _.find(columns, function (column) { return column.name === columnName; });
        return column.label !== '' ? column.label : this.engine.getLoader().getI18n().translateText(i18nKey);
    };
    PaymentsSummaryHelper.prototype.getFormulaItem = function (matches, order) {
        return {
            options: {
                isAdditionalItem: true,
                isDiscount: false,
                isFee: false,
                isFormula: true,
                isProduct: false,
                isProductRow: true,
                isRowWithValueSign: false,
                isSubtotal: false,
                isTax: false,
                isVisible: true
            },
            order: order,
            orderVisible: null,
            price: null,
            primaryDescription: matches[1],
            quantity: null,
            secondaryDescription: null,
            total: null,
            type: EInvoiceItemType.PRODUCT_FORMULA
        };
    };
    PaymentsSummaryHelper.getPaymentSummaryColumn = function (name) {
        var columns = [];
        var paymentSummaries = document.querySelectorAll('.detailed-invoice-container');
        if (!paymentSummaries.length)
            return;
        paymentSummaries.forEach(function (paymentSummary) {
            var paymentSummaryHeader = paymentSummary.querySelector('.invoice-wrapper > .detailed-invoice-container > .invoice-header');
            if (!paymentSummaryHeader)
                return;
            var column;
            switch (name) {
                case ESettingColumnName.INDEX:
                    column = paymentSummaryHeader.querySelector('.invoice-index > span');
                    break;
                case ESettingColumnName.DESCRIPTION:
                    column = paymentSummaryHeader.querySelector('.invoice-item > span');
                    break;
                case ESettingColumnName.UNIT_PRICE:
                    column = paymentSummaryHeader.querySelector('.invoice-price > span');
                    break;
                case ESettingColumnName.QUANTITY:
                    column = paymentSummaryHeader.querySelector('.invoice-quantity > span');
                    break;
                case ESettingColumnName.TOTAL_PRICE:
                    column = paymentSummaryHeader.querySelector('.invoice-total > span');
                    break;
                default:
                    break;
            }
            if (column) {
                columns.push(column);
            }
        });
        return columns;
    };
    PaymentsSummaryHelper.prototype.setupI18n = function () {
        var loader = this.engine.getLoader(), invoiceOptions = this.engine.getLoader().getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS);
        if (!invoiceOptions)
            return;
        var columns = invoiceOptions.columns;
        if (this.engine.getLoader().getLoaderType() === EFormLoaderType.VIEW) {
            if (loader.getCurrentLanguage() === loader.getDefaultLanguage()) {
                _.forEach(columns, function (element) {
                    if (element.label) {
                        var columns_1 = PaymentsSummaryHelper.getPaymentSummaryColumn(element.name);
                        if (!columns_1 || !columns_1.length)
                            return;
                        _.forEach(columns_1, function (column) {
                            column.innerHTML = SanitizeHTML.sanitizeHTML(MiniMarkdown.parse(element.label));
                        });
                    }
                });
            }
        }
    };
    PaymentsSummaryHelper.orderIndexByType = {
        PRODUCT: 0,
        PRODUCT_FORMULA: 1,
        PRODUCT_DISCOUNT: 2,
        PRODUCT_TAX: 3,
        FIXED_AMOUNT: 0,
        SUBTOTAL: 4,
        INVOICE_FEE: 5,
        INVOICE_COUPON: 6,
        INVOICE_DISCOUNT: 7,
        INVOICE_TAX: 8,
        UNKNOWN: 9
    };
    PaymentsSummaryHelper.additionalItemTypes = [
        EInvoiceItemType.PRODUCT_DISCOUNT,
        EInvoiceItemType.PRODUCT_TAX,
        EInvoiceItemType.PRODUCT_FORMULA
    ];
    return PaymentsSummaryHelper;
}());
var EPaymentsUnitTypes;
(function (EPaymentsUnitTypes) {
    EPaymentsUnitTypes[EPaymentsUnitTypes["PERCENTAGE"] = 0] = "PERCENTAGE";
    EPaymentsUnitTypes[EPaymentsUnitTypes["FIXED_VALUE"] = 1] = "FIXED_VALUE";
})(EPaymentsUnitTypes || (EPaymentsUnitTypes = {}));
var LabelPlacementTopInstructionsBelowLabelNoCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementTopInstructionsBelowLabelNoCompactFieldRenderer, _super);
    function LabelPlacementTopInstructionsBelowLabelNoCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementTopInstructionsBelowLabelNoCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'tln');
        rootNode.removeAttribute('data-label-width');
        if (null !== labelElement) {
            rootNode.appendChild(labelElement);
        }
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(false, labelElement.textContent, inputsRows, false);
        }
    };
    LabelPlacementTopInstructionsBelowLabelNoCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL;
    };
    return LabelPlacementTopInstructionsBelowLabelNoCompactFieldRenderer;
}(Renderer));
var LabelPlacementTopInstructionsBelowFieldNoCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementTopInstructionsBelowFieldNoCompactFieldRenderer, _super);
    function LabelPlacementTopInstructionsBelowFieldNoCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementTopInstructionsBelowFieldNoCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'tfn');
        rootNode.removeAttribute('data-label-width');
        if (null !== labelElement) {
            rootNode.appendChild(labelElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(false, labelElement.textContent, inputsRows, false);
        }
    };
    LabelPlacementTopInstructionsBelowFieldNoCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD;
    };
    return LabelPlacementTopInstructionsBelowFieldNoCompactFieldRenderer;
}(Renderer));
var LabelPlacementLeftInstructionsBelowLabelNoCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementLeftInstructionsBelowLabelNoCompactFieldRenderer, _super);
    function LabelPlacementLeftInstructionsBelowLabelNoCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementLeftInstructionsBelowLabelNoCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelCol = document.createElement('div'), inputCol = document.createElement('div'), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, controlLayoutSizes = this.getElementLayoutSize(ofElement), sizeValue, inputRowWidth = controlLayoutSizes.inputWidthInUnits, currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'lln');
        rootNode.setAttribute('data-label-width', String(controlLayoutSizes.labelWidthInUnits));
        labelCol.setAttribute('data-role', 'label-column');
        labelCol.setAttribute('data-colspan', String(controlLayoutSizes.labelWidthInUnits));
        inputCol.setAttribute('data-role', 'input-column');
        inputCol.setAttribute('data-colspan', String(controlLayoutSizes.inputWidthInUnits));
        rootNode.appendChild(labelCol);
        rootNode.appendChild(inputCol);
        if (null !== labelElement) {
            labelCol.appendChild(labelElement);
        }
        if (null !== instructionsElement) {
            labelCol.appendChild(instructionsElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                inputCol.appendChild(rowDOMNode);
            }
        }
        if (null !== errorElement) {
            inputCol.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(false, labelElement.textContent, inputsRows, false);
        }
    };
    LabelPlacementLeftInstructionsBelowLabelNoCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL;
    };
    return LabelPlacementLeftInstructionsBelowLabelNoCompactFieldRenderer;
}(Renderer));
var LabelPlacementLeftInstructionsBelowFieldNoCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementLeftInstructionsBelowFieldNoCompactFieldRenderer, _super);
    function LabelPlacementLeftInstructionsBelowFieldNoCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementLeftInstructionsBelowFieldNoCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelCol = document.createElement('div'), inputCol = document.createElement('div'), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, controlLayoutSizes = this.getElementLayoutSize(ofElement), sizeValue, inputRowWidth = controlLayoutSizes.inputWidthInUnits, currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'lfn');
        rootNode.setAttribute('data-label-width', String(controlLayoutSizes.labelWidthInUnits));
        labelCol.setAttribute('data-role', 'label-column');
        labelCol.setAttribute('data-colspan', String(controlLayoutSizes.labelWidthInUnits));
        inputCol.setAttribute('data-role', 'input-column');
        inputCol.setAttribute('data-colspan', String(controlLayoutSizes.inputWidthInUnits));
        rootNode.appendChild(labelCol);
        rootNode.appendChild(inputCol);
        if (null !== labelElement) {
            labelCol.appendChild(labelElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                inputCol.appendChild(rowDOMNode);
            }
        }
        if (null !== instructionsElement) {
            inputCol.appendChild(instructionsElement);
        }
        if (null !== errorElement) {
            inputCol.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(false, labelElement.textContent, inputsRows, false);
        }
    };
    LabelPlacementLeftInstructionsBelowFieldNoCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD;
    };
    return LabelPlacementLeftInstructionsBelowFieldNoCompactFieldRenderer;
}(Renderer));
var LabelPlacementRightInstructionsBelowLabelNoCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementRightInstructionsBelowLabelNoCompactFieldRenderer, _super);
    function LabelPlacementRightInstructionsBelowLabelNoCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementRightInstructionsBelowLabelNoCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelCol = document.createElement('div'), inputCol = document.createElement('div'), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, controlLayoutSizes = this.getElementLayoutSize(ofElement), sizeValue, inputRowWidth = controlLayoutSizes.inputWidthInUnits, currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'rln');
        rootNode.setAttribute('data-label-width', String(controlLayoutSizes.inputWidthInUnits));
        labelCol.setAttribute('data-role', 'label-column');
        labelCol.setAttribute('data-colspan', String(controlLayoutSizes.labelWidthInUnits));
        inputCol.setAttribute('data-role', 'input-column');
        inputCol.setAttribute('data-colspan', String(controlLayoutSizes.inputWidthInUnits));
        rootNode.appendChild(inputCol);
        rootNode.appendChild(labelCol);
        if (null !== labelElement) {
            labelCol.appendChild(labelElement);
        }
        if (null !== instructionsElement) {
            labelCol.appendChild(instructionsElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                inputCol.appendChild(rowDOMNode);
            }
        }
        if (null !== errorElement) {
            inputCol.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(false, labelElement.textContent, inputsRows, false);
        }
    };
    LabelPlacementRightInstructionsBelowLabelNoCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL;
    };
    return LabelPlacementRightInstructionsBelowLabelNoCompactFieldRenderer;
}(Renderer));
var LabelPlacementRightInstructionsBelowFieldNoCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementRightInstructionsBelowFieldNoCompactFieldRenderer, _super);
    function LabelPlacementRightInstructionsBelowFieldNoCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementRightInstructionsBelowFieldNoCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelCol = document.createElement('div'), inputCol = document.createElement('div'), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, controlLayoutSizes = this.getElementLayoutSize(ofElement), sizeValue, inputRowWidth = controlLayoutSizes.inputWidthInUnits, currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'rfn');
        rootNode.setAttribute('data-label-width', String(controlLayoutSizes.inputWidthInUnits));
        labelCol.setAttribute('data-role', 'label-column');
        labelCol.setAttribute('data-colspan', String(controlLayoutSizes.labelWidthInUnits));
        inputCol.setAttribute('data-role', 'input-column');
        inputCol.setAttribute('data-colspan', String(controlLayoutSizes.inputWidthInUnits));
        rootNode.appendChild(inputCol);
        rootNode.appendChild(labelCol);
        if (null !== labelElement) {
            labelCol.appendChild(labelElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                inputCol.appendChild(rowDOMNode);
            }
        }
        if (null !== instructionsElement) {
            inputCol.appendChild(instructionsElement);
        }
        if (null !== errorElement) {
            inputCol.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(false, labelElement.textContent, inputsRows, false);
        }
    };
    LabelPlacementRightInstructionsBelowFieldNoCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD;
    };
    return LabelPlacementRightInstructionsBelowFieldNoCompactFieldRenderer;
}(Renderer));
var LabelPlacementTopInstructionsBelowLabelCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementTopInstructionsBelowLabelCompactFieldRenderer, _super);
    function LabelPlacementTopInstructionsBelowLabelCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementTopInstructionsBelowLabelCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'tlc');
        rootNode.removeAttribute('data-label-width');
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(true, labelElement.textContent, inputsRows, this.isLabelSuppressed(ofElement));
        }
    };
    LabelPlacementTopInstructionsBelowLabelCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD;
    };
    return LabelPlacementTopInstructionsBelowLabelCompactFieldRenderer;
}(Renderer));
var LabelPlacementTopInstructionsBelowFieldCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementTopInstructionsBelowFieldCompactFieldRenderer, _super);
    function LabelPlacementTopInstructionsBelowFieldCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementTopInstructionsBelowFieldCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'tfc');
        rootNode.removeAttribute('data-label-width');
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(true, labelElement.textContent, inputsRows, this.isLabelSuppressed(ofElement));
        }
    };
    LabelPlacementTopInstructionsBelowFieldCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD;
    };
    return LabelPlacementTopInstructionsBelowFieldCompactFieldRenderer;
}(Renderer));
var LabelPlacementLeftInstructionsBelowLabelCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementLeftInstructionsBelowLabelCompactFieldRenderer, _super);
    function LabelPlacementLeftInstructionsBelowLabelCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementLeftInstructionsBelowLabelCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'llc');
        rootNode.removeAttribute('data-label-width');
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(true, labelElement.textContent, inputsRows, this.isLabelSuppressed(ofElement));
        }
    };
    LabelPlacementLeftInstructionsBelowLabelCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD;
    };
    return LabelPlacementLeftInstructionsBelowLabelCompactFieldRenderer;
}(Renderer));
var LabelPlacementLeftInstructionsBelowFieldCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementLeftInstructionsBelowFieldCompactFieldRenderer, _super);
    function LabelPlacementLeftInstructionsBelowFieldCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementLeftInstructionsBelowFieldCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'lfc');
        rootNode.removeAttribute('data-label-width');
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(true, labelElement.textContent, inputsRows, this.isLabelSuppressed(ofElement));
        }
    };
    LabelPlacementLeftInstructionsBelowFieldCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD;
    };
    return LabelPlacementLeftInstructionsBelowFieldCompactFieldRenderer;
}(Renderer));
var LabelPlacementRightInstructionsBelowLabelCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementRightInstructionsBelowLabelCompactFieldRenderer, _super);
    function LabelPlacementRightInstructionsBelowLabelCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementRightInstructionsBelowLabelCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'rlc');
        rootNode.removeAttribute('data-label-width');
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(true, labelElement.textContent, inputsRows, this.isLabelSuppressed(ofElement));
        }
    };
    LabelPlacementRightInstructionsBelowLabelCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD;
    };
    return LabelPlacementRightInstructionsBelowLabelCompactFieldRenderer;
}(Renderer));
var LabelPlacementRightInstructionsBelowFieldCompactFieldRenderer = (function (_super) {
    __extends(LabelPlacementRightInstructionsBelowFieldCompactFieldRenderer, _super);
    function LabelPlacementRightInstructionsBelowFieldCompactFieldRenderer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabelPlacementRightInstructionsBelowFieldCompactFieldRenderer.prototype.updateRootNode = function (ofElement) {
        this.clearElementDOMNodeRoot(ofElement);
        var rootNode = ofElement.getRootNode(), labelElement = ofElement.getLabelDOMNode(), instructionsElement = ofElement.getInstructionsDOMNode(), errorElement = ofElement.getErrorDOMNode(), inputsRows = ofElement.getInputDOMNodes(), rowDOMNode, sizeValue, inputRowWidth = ofElement.getColspan(), currentRowWidth;
        if (ofElement.getElementKind() === EElementKind.CONTROL) {
            if (ofElement.getMinInputRowWidth() > inputRowWidth) {
                rootNode.setAttribute('data-force-mobile-rendering', '1');
            }
            else {
                rootNode.removeAttribute('data-force-mobile-rendering');
            }
        }
        rootNode.setAttribute('data-renderer-type', 'rfc');
        rootNode.removeAttribute('data-label-width');
        if (null !== inputsRows) {
            for (var i = 0, len = inputsRows.length; i < len; i++) {
                rowDOMNode = document.createElement('div');
                rowDOMNode.setAttribute('data-role', 'input-row');
                if (0 === i) {
                    rowDOMNode.setAttribute('data-is-first-row', '1');
                }
                if (len - 1 === i) {
                    rowDOMNode.setAttribute('data-is-last-row', '1');
                }
                currentRowWidth = 0;
                for (var j = 0, n = inputsRows[i].inputs.length; j < n; j++) {
                    rowDOMNode.appendChild(Renderer.castToDOMElement(inputsRows[i].inputs[j].input));
                    sizeValue = this.getSizeAttributeValue(inputsRows[i].inputs[j].width);
                    if (null !== sizeValue) {
                        inputsRows[i].inputs[j].input.setAttribute('data-size', sizeValue);
                        currentRowWidth += this.getSizeInUnits(inputRowWidth, inputsRows[i].inputs[j].width);
                    }
                    else {
                        inputsRows[i].inputs[j].input.removeAttribute('data-size');
                    }
                }
                rowDOMNode.setAttribute('data-fill-colspan', String(inputRowWidth - currentRowWidth));
                rootNode.appendChild(rowDOMNode);
            }
        }
        if (null !== instructionsElement) {
            rootNode.appendChild(instructionsElement);
        }
        if (null !== errorElement) {
            rootNode.appendChild(errorElement);
        }
        if (null !== labelElement && null !== inputsRows && ofElement.isCompactFieldPlaceholderSupported()) {
            Renderer.setLabelCompactFieldState(true, labelElement.textContent, inputsRows, this.isLabelSuppressed(ofElement));
        }
    };
    LabelPlacementRightInstructionsBelowFieldCompactFieldRenderer.prototype.getRendererType = function () {
        return EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD;
    };
    return LabelPlacementRightInstructionsBelowFieldCompactFieldRenderer;
}(Renderer));
var CustomControlRenderer = (function () {
    function CustomControlRenderer() {
    }
    CustomControlRenderer.prototype.updateRootNode = function (ofElement) {
        console.log('CustomControlRenderer: update: ', ofElement.getHash());
    };
    CustomControlRenderer.prototype.getRendererType = function () {
        return EElementRendererType.CUSTOM_CONTROL_RENDERER;
    };
    return CustomControlRenderer;
}());
var SaveActivity = (function (_super) {
    __extends(SaveActivity, _super);
    function SaveActivity(jq, engine, loader) {
        var _this = _super.call(this, jq, 5000, 2) || this;
        _this.engine = engine;
        _this.loader = loader;
        if (!window['errorLoggingService']) {
            throw new Error('Dependency not found: errorLoggingService');
        }
        _this.errorLogger = window['errorLoggingService'].getInstance();
        return _this;
    }
    SaveActivity.prototype.run = function () {
        var _this = this;
        window.addEventListener('beforeunload', this.beforeUnload);
        var api = this.loader.getAPI();
        var document = this.engine.getDocument();
        document.trigger('editor-save-form-started');
        return (function (api, document, loader, engine, self) {
            return api.PUT_JSON('/v2/editor/form', document.serialize())
                .then(function (result) {
                engine.updateState(result);
                window.removeEventListener('beforeunload', self.beforeUnload);
                document.trigger('editor-save-form-finished', result);
                self.stop();
            })
                .fail(function (error, result) {
                var _a, _b;
                _this.errorLogger.logError(api, "Error saving form: " + ((_a = result) === null || _a === void 0 ? void 0 : _a.responseText), EErrorPriority.ERROR, 'SaveActivityFE');
                (_b = CFTracker) === null || _b === void 0 ? void 0 : _b.event('editor_save_form_error');
            })
                .always(function () {
                self.jq(loader.getUICssSelector('saving-container')).removeClass('is-saving').text('');
            });
        })(api, document, this.loader, this.engine, this);
    };
    SaveActivity.prototype.beforeUnload = function (e) {
        var msg = 'There was an error saving your form. Changes may not be saved.';
        e.returnValue = msg;
        return msg;
    };
    SaveActivity.prototype.removeUnloadEventListener = function () {
        window.removeEventListener('beforeunload', this.beforeUnload);
    };
    return SaveActivity;
}(Activity));
var updateControlProperty = EditorUI.Actions.updateControlProperty;
var appendControl = EditorUI.Actions.appendControl;
var removeControls = EditorUI.Actions.removeControls;
var updatePaymentActiveState = EditorUI.Actions.updatePaymentActiveState;
var EditorCommandDispatcher = (function () {
    function EditorCommandDispatcher(editor, loader) {
        var _this = this;
        this.tinyMCEEditorUID = 0;
        this.trackers = {};
        this.lastTrackedSelectionName = '';
        if (!window['featureService']) {
            throw new Error('Dependency not found: featureService');
        }
        this.features = window['featureService'];
        if (!window['header']) {
            throw new Error('Dependency not found: header');
        }
        this.header = window['header'].getHeader();
        if (!window['planUtils']) {
            throw new Error('Dependency not found: planUtils');
        }
        this.planUtils = window['planUtils'];
        if (!window['builderStore']) {
            throw new Error('Dependency not found: builderStore');
        }
        this.store = window['builderStore'];
        if (!window['userService']) {
            throw new Error('Dependency not found: userService');
        }
        this.userService = window['userService'].getInstance();
        this.userService.getCurrentIdentity().then(function (response) {
            _this.availableUpgrades = response.abilities.upgrades;
        });
        if (!window['errorLoggingService']) {
            throw new Error('Dependency not found: errorLoggingService');
        }
        this.errorLogger = window['errorLoggingService'].getInstance();
        this.editor = editor;
        this.loader = loader;
        this.i18n = this.editor.getI18n();
        this.oAuth = this.loader.getOAuth();
        this.notificationTooltipManager = new NotificationTooltipManager(this, editor);
        this.saveActivity = new SaveActivity(this.loader.getJQuery(), this.editor, this.loader);
        this.wasThemeEditorLoaded = false;
        this.editorValueRendererFactory = new EditorValueRendererFactory(this.editor.getResourceManager(), this.loader.getJQuery(), this.editor.getGeolocation(), this.editor.getCurrency(), this.editor.getDocument());
        this.cookie = new Cookie();
        EditorValueRendererFactory.init(this.editorValueRendererFactory);
        this.initNotificationManager();
    }
    EditorCommandDispatcher.prototype.viewForm = function () {
        window.open('./view-form.php');
    };
    EditorCommandDispatcher.prototype.setActiveEditorPanel = function (panelName, scrollTop) {
        this.loader.getEditorPanelGroup().setActivePanel(panelName, scrollTop);
    };
    EditorCommandDispatcher.prototype.dispatchPropertyChangeInThemePanel = function (domNode, valueProperty) {
        var $ = this.editor.getJQuery(), propertyTarget = $(domNode).closest('[data-role=property]').attr('data-property-target'), propagateValueCSSSelector = domNode.hasAttribute('data-propagate-value-css-selector')
            ? domNode.getAttribute('data-propagate-value-css-selector') || null
            : null, propagateValueAttributeName = domNode.hasAttribute('data-propagate-value-attribute-name')
            ? domNode.getAttribute('data-propagate-value-attribute-name') || null
            : null;
        if (!propertyTarget) {
            return;
        }
        var propertyName = $(domNode).closest('[data-property-name]').attr('data-property-name'), propertyType = $(domNode).closest('[data-property-type]').attr('data-property-type');
        if (!propertyName || !propertyType) {
            return;
        }
        var domNodeValue = domNode[valueProperty];
        if (domNode.hasAttribute('data-is-json-value')) {
            try {
                domNodeValue = domNodeValue !== ''
                    ? JSON.parse(String(domNodeValue || ''))
                    : null;
            }
            catch (e) {
                domNodeValue = null;
            }
        }
        domNodeValue = this.getCastedPropertyValue(domNodeValue, propertyType);
        this.trackEvent('theme_property_change', {}, 50);
        switch (propertyTarget) {
            case 'theme':
                this.editor.getTheme().setProperty(propertyName.replace(/[\.]+/g, '_'), domNodeValue || '');
                break;
            case 'form':
                this.editor.getDocument().setProperty(propertyName, domNodeValue);
                if ('options.direction' == propertyName) {
                    this.loadThemePropertiesIntoPanel();
                }
                break;
        }
        this.loader.getUndoService().trigger('user-action', 'change-' + propertyName);
        if (propagateValueCSSSelector && propagateValueAttributeName) {
            $(propagateValueCSSSelector).each(function () {
                var _this = this;
                setTimeout(function () {
                    $(_this).trigger('attribute:propagate');
                }, 50);
            }).attr(propagateValueAttributeName, null === domNodeValue ? null : String(domNodeValue) || '');
        }
    };
    EditorCommandDispatcher.prototype.loadThemePropertiesIntoPanel = function () {
        (function (self, $, themeService, ui, engine, document) {
            self.wasThemeEditorLoaded = true;
            self.editorValueRendererFactory.resolve().then(function () {
                var decoratedProperties = [];
                for (var themeProps = themeService.enumerateProperties(), i = 0, len = themeProps.length; i < len; i++) {
                    decoratedProperties.push(ThemePropertyDecorator.getDecoratedThemeProperty(themeProps[i]));
                }
                for (var formProps = document.enumerateProperties(), i = 0, len = formProps.length; i < len; i++) {
                    if (!InspectorHiddenProperties.isPropertyEditable(formProps[i], document)) {
                        continue;
                    }
                    decoratedProperties.push(ThemePropertyDecorator.getDecoratedFormProperty(formProps[i], document.getProperty(formProps[i].name)));
                }
                if (!EngineToggles.ALLOW_THEME_ADVANCED_SETTINGS) {
                    decoratedProperties = decoratedProperties.filter(function (property) {
                        return !property.isAdvanced;
                    });
                }
                decoratedProperties = ThemePropertyDecorator.getSortedDecoratedThemeProperties(decoratedProperties);
                var model = {
                    categories: []
                }, categoryName, categoryIndex, categoryNameI18n;
                for (var i = 0, len = decoratedProperties.length; i < len; i++) {
                    decoratedProperties[i]['control'] = JSON.stringify({
                        element: -1,
                        property: decoratedProperties[i].name.replace(/[_]+/g, '.'),
                        type: decoratedProperties[i].type,
                        value: decoratedProperties[i].value,
                    });
                    categoryName = String(decoratedProperties[i].category || 'unknown').toLowerCase();
                    categoryNameI18n = String(decoratedProperties[i].categoryI18n || '');
                    categoryIndex = null;
                    for (var j = 0, n = model.categories.length; j < n; j++) {
                        if (model.categories[j].name === categoryName) {
                            categoryIndex = j;
                            break;
                        }
                    }
                    if (null == categoryIndex) {
                        categoryIndex = model.categories.length;
                        model.categories.push({
                            name: categoryName,
                            properties: [],
                            i18n: categoryNameI18n,
                        });
                    }
                    model.categories[categoryIndex].properties.push(decoratedProperties[i]);
                }
                self.editorValueRendererFactory.withElement(null);
                engine.getResourceManager().get('/modules/Typescript/Form/resources/theme-editor.html')
                    .then(function (htmlResult) {
                    var template = new Salvage(htmlResult);
                    $('#options > div[data-role=vertical-content]').each(function () {
                        $(this).find('div[data-role=category], div[data-role=separator]').remove();
                        $(this).append(template.parse(model));
                        ui.upgrade(this);
                        self.addPerfectScrollbar(this);
                    });
                })
                    .fail(function (e) {
                    console.error(e);
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_loading_module', 'Error loading module'), self.getUiTranslatedString('edt_UI_alert_error_loading_module_message', 'Failed to load resource: "/modules/Typescript/Form/resources/theme-editor.html"', '"/modules/Typescript/Form/resources/theme-editor.html"'));
                });
            });
        })(this, this.editor.getJQuery(), this.editor.getTheme(), this.loader.getUI(), this.editor, this.editor.getDocument());
    };
    EditorCommandDispatcher.prototype.loadEditorControlsIntoPanel = function () {
        (function (self, $, editor) {
            editor.getResourceManager().get('/modules/Typescript/Form/resources/editor-panel.html')
                .then(function (tpl) {
                var s = new Salvage(tpl), hasBasic = false, hasAdvanced = false, hasOther = false, hasECommerce = false, hasContainers = false;
                var supportedControlsList = editor.getFactory().getAvailableControlsList(), supportedEditorSettingsList = editor.getFactory().getAvailableSettingsList(), allSupportedItemsList, unSupportedControlsList = editor.getFactory().getUnavailableControlsList(), unSupportedEditorSettingsList = editor.getFactory().getUnavailableEditorSettingsList(), allUnsupportedItemsList, blockedEditorSettingsList = editor.getFactory().getBlockedEditorSettings();
                for (var i = supportedControlsList.length - 1; i >= 0; i--) {
                    if (supportedControlsList[i].isVirtual) {
                        supportedControlsList.splice(i, 1);
                    }
                }
                for (var i = supportedEditorSettingsList.length - 1; i >= 0; i--) {
                    if (!supportedEditorSettingsList[i].visible || blockedEditorSettingsList.indexOf(supportedEditorSettingsList[i].typeId) > -1) {
                        supportedEditorSettingsList.splice(i, 1);
                    }
                }
                allSupportedItemsList = FormUtils.merge(supportedControlsList, supportedEditorSettingsList);
                for (var i = 0, len = allSupportedItemsList.length; i < len; i++) {
                    allSupportedItemsList[i].isBasic = allSupportedItemsList[i].category === 'basic';
                    allSupportedItemsList[i].isAdvanced = allSupportedItemsList[i].category === 'advanced';
                    allSupportedItemsList[i].isOther = allSupportedItemsList[i].category === 'other';
                    allSupportedItemsList[i].isContainer = allSupportedItemsList[i].category === 'containers';
                    allSupportedItemsList[i].isECommerce = allSupportedItemsList[i].category === 'e-commerce';
                    allSupportedItemsList[i].isSupported = true;
                    allSupportedItemsList[i].itemType = 'string' === typeof allSupportedItemsList[i].typeId
                        ? 'setting'
                        : '';
                    hasBasic = allSupportedItemsList[i].isBasic || hasBasic;
                    hasAdvanced = allSupportedItemsList[i].isAdvanced || hasAdvanced;
                    hasOther = allSupportedItemsList[i].isOther || hasOther;
                    hasContainers = allSupportedItemsList[i].isContainer || hasContainers;
                    hasECommerce = allSupportedItemsList[i].isECommerce || hasECommerce;
                }
                for (var i = unSupportedControlsList.length - 1; i >= 0; i--) {
                    if (unSupportedControlsList[i].isVirtual) {
                        unSupportedControlsList.splice(i, 1);
                    }
                }
                for (var i = unSupportedEditorSettingsList.length - 1; i >= 0; i--) {
                    if (!unSupportedEditorSettingsList[i].visible) {
                        unSupportedEditorSettingsList.splice(i, 1);
                    }
                }
                allUnsupportedItemsList = FormUtils.merge(unSupportedControlsList, unSupportedEditorSettingsList);
                for (var i = 0, len = allUnsupportedItemsList.length; i < len; i++) {
                    allUnsupportedItemsList[i].isBasic = allUnsupportedItemsList[i].category === 'basic';
                    allUnsupportedItemsList[i].isAdvanced = allUnsupportedItemsList[i].category === 'advanced';
                    allUnsupportedItemsList[i].isOther = allUnsupportedItemsList[i].category === 'other';
                    allUnsupportedItemsList[i].isContainer = allUnsupportedItemsList[i].category === 'containers';
                    allUnsupportedItemsList[i].isECommerce = allUnsupportedItemsList[i].category === 'e-commerce';
                    allUnsupportedItemsList[i].isSupported = false;
                    allUnsupportedItemsList[i].itemType = 'string' === typeof allUnsupportedItemsList[i].typeId
                        ? 'setting'
                        : '';
                    hasBasic = allUnsupportedItemsList[i].isBasic || hasBasic;
                    hasAdvanced = allUnsupportedItemsList[i].isAdvanced || hasAdvanced;
                    hasOther = allUnsupportedItemsList[i].isOther || hasOther;
                    hasContainers = allUnsupportedItemsList[i].isContainer || hasContainers;
                    hasECommerce = allUnsupportedItemsList[i].isECommerce || hasECommerce;
                }
                var controlsSortedModel = FormUtils.merge(allSupportedItemsList, allUnsupportedItemsList)
                    .sort(function (a, b) {
                    return a.index - b.index;
                });
                $('#editor').html(s.parse({
                    model: controlsSortedModel,
                    hasBasic: hasBasic,
                    hasAdvanced: hasAdvanced,
                    hasOther: hasOther,
                    hasContainers: hasContainers,
                    hasECommerce: hasECommerce,
                }));
                self.addPerfectScrollbar('#editor div[data-role=vertical-content]');
                self.editor.getI18n().translateDOMNode(document.getElementById('editor'));
                self.loader.trigger('editor-sidebar-initialised');
            });
        })(this, this.editor.getJQuery(), this.editor);
    };
    EditorCommandDispatcher.prototype.filterSettingsProperties = function (searchTerm) {
        var preparedSearchTerm = String(searchTerm || '').toString().toLowerCase(), searchedKeywords = preparedSearchTerm.replace(/[^a-z0-9]+/g, ' ').split(' ');
        (function ($) {
            var $options = $('#options');
            if (searchTerm) {
                $options.attr('data-is-filtered', '');
            }
            else {
                $options.removeAttr('data-is-filtered');
            }
            $options
                .find('div[data-role=category]')
                .each(function () {
                var numberOfVisibleProperties = $(this).find('[data-role=property]').length;
                $(this).find('*[data-search-keywords]').each(function () {
                    if ('' === preparedSearchTerm) {
                        this.style.display = '';
                    }
                    else {
                        var myText = $(this).attr('data-search-keywords').toLowerCase().replace(/[^a-z0-9]+/g, ' '), myKeywords = myText.split(' '), isMatch = true;
                        for (var i = 0, len = searchedKeywords.length; i < len; i++) {
                            if (-1 === myKeywords.indexOf(searchedKeywords[i]) && -1 === myText.indexOf(searchedKeywords[i])) {
                                isMatch = false;
                                break;
                            }
                        }
                        this.style.display = isMatch
                            ? ''
                            : 'none';
                        if (!isMatch) {
                            numberOfVisibleProperties--;
                        }
                    }
                });
                $(this).attr('data-visible-properties-count', String(numberOfVisibleProperties));
            });
        })(this.loader.getJQuery());
    };
    EditorCommandDispatcher.prototype.updateThemesPanel = function () {
        (function (self, theme, engine, $) {
            engine.getResourceManager().get('/modules/Typescript/Form/resources/theme-picker-panel.html')
                .then(function (themePickerPanelMarkup) {
                var template = new Salvage(themePickerPanelMarkup), model = {
                    themes: theme.getThemesList()
                };
                var $themePanel = $('#theme-panel');
                $themePanel
                    .html(template.parse(model))
                    .find('[data-role=vertical-content]')
                    .each(function () {
                    self.addPerfectScrollbar(this);
                });
                $themePanel.find('[data-role=menu-popup]').each(function () {
                    self.createMenuPopup(this);
                });
                $themePanel.each(function () {
                    self.editor.getI18n().translateDOMNode(this);
                });
            });
        })(this, this.editor.getTheme(), this.editor, this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.createMenuPopup = function (menuButton) {
        (function (self, ui, $) {
            var $theme = $(menuButton).parent().parent();
            var themeIdAttributeText = $($theme).attr("data-theme-id");
            var themeId = null;
            if (themeIdAttributeText) {
                try {
                    themeId = JSON.parse(themeIdAttributeText);
                }
                catch (e) {
                    return;
                }
            }
            var isSystemTheme = $theme.attr("data-is-system-theme") === 'true';
            (new UIMenuPopup(menuButton, $))
                .on('apply-theme', function () {
                $('#theme-panel')
                    .attr('data-allow-revert', !$($theme).is('[data-role=current-theme] > [data-role=theme]')
                    ? '1'
                    : null)
                    .find('[data-role=theme].selected')
                    .removeClass('selected');
                $($theme).addClass('selected');
                self.loader.getEngine().getTheme().enterEditMode();
                self.setThemeById(themeId);
                setTimeout(function () {
                    self.loader.getEngine().getTheme().enterPreviewMode();
                    self.loader.getEngine().getTheme().enterEditMode();
                }, 200);
                setTimeout(function () {
                    self.loader.getEngine().getTheme().enterPreviewMode();
                }, 1000);
            })
                .on('delete-theme', function () {
                if (isSystemTheme) {
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_deleting_theme', 'Error deleting theme'), self.getUiTranslatedString('edt_UI_alert_error_deleting_system_theme_message', 'Systems themes can’t be removed.'));
                }
                else {
                    self.loader.getCommandDispatcher().deleteTheme(themeId);
                    self.loader.getCommandDispatcher().trackEvent('theme_btn_save_as_click');
                }
            })
                .on('save-theme', function () {
                self.loader.getCommandDispatcher().saveTheme(themeId);
                self.loader.getCommandDispatcher().trackEvent('theme_btn_save_as_click');
            });
        })(this, this.loader.getUI(), this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.updateCustomCSSPanel = function () {
        (function (self, theme, engine, $) {
            engine.getResourceManager().get('/modules/Typescript/Form/resources/custom-css-panel.html')
                .then(function (customCSSPanelMarkup) {
                var template = new Salvage(customCSSPanelMarkup), model = {
                    customCSSValue: engine.getDocument().getConfiguration().getProperty('customCss'),
                    customCSSURLValue: engine.getDocument().getConfiguration().getProperty('customCssFromUrl'),
                }, $themeCustomCSSPanel = $('#theme-custom-css');
                $themeCustomCSSPanel.html(template.parse(model));
                self.i18n.translateDOMNode(document.getElementById('theme-custom-css'));
                $themeCustomCSSPanel.find('> div[data-role=vertical-content]').each(function () {
                    self.addPerfectScrollbar(this);
                });
                self.setCustomCssText(engine.getDocument().getConfiguration().getProperty('customCss'));
            });
        })(this, this.editor.getTheme(), this.editor, this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.loadAvailableThemes = function () {
        return (function (api, self, theme, ui, $) {
            return $.Deferred(function (defer) {
                api.GET('/v2/editor/themes')
                    .then(function (themesListFromServer) {
                    Theme.availableThemes = [
                        Theme.getDefaultTheme()
                    ];
                    if (themesListFromServer && themesListFromServer.themes && themesListFromServer.themes.length) {
                        for (var i = 0, len = themesListFromServer.themes.length; i < len; i++) {
                            Theme.availableThemes.push({
                                name: themesListFromServer.themes[i].name,
                                id: themesListFromServer.themes[i].id,
                                userId: themesListFromServer.themes[i].userId,
                                value: JSON.stringify(themesListFromServer.themes[i].properties || []),
                                customCSSText: themesListFromServer.themes[i].customCSSText,
                                customCSSUrl: themesListFromServer.themes[i].customCSSUrl,
                            });
                        }
                    }
                    theme.trigger('load');
                    theme.currentSelectedThemeId = -1;
                    self.updateThemesPanel();
                    theme.onThemeSettingsChangedDeferred();
                    defer.resolve(true);
                })
                    .fail(function () {
                    theme.trigger('error');
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_loading_themes_module', 'Error loading themes module'), self.getUiTranslatedString('edt_UI_alert_error_loading_themes_module_message', 'There was an error loading the themes module. Please check if your session didn\'t expired.'));
                    defer.reject(new Error('Failed to load the themes module'));
                });
            }).promise();
        })(this.loader.getAPI(), this, this.editor.getTheme(), this.loader.getUI(), this.loader.getJQuery());
    };
    EditorCommandDispatcher.prototype.onFormNameChanged = function () {
        (function ($, loader, document) {
            var $currentFormInput = $(loader.getUICssSelector('form-name-input')), currentFormName = document.getProperty('name.value'), currentFormInputValue = $currentFormInput.val();
            if (currentFormName !== currentFormInputValue) {
                $currentFormInput.val(String(currentFormName || ''));
            }
        })(this.editor.getJQuery(), this.loader, this.editor.getDocument());
    };
    EditorCommandDispatcher.prototype.filterControlsList = function (filterValue) {
        var filterAsString = String(filterValue || '')
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, ' ')
            .replace(/(^[\s]+|[\s]+$)/g, ''), filterKeywords = filterAsString.split(' ');
        (function ($) {
            var seenControlsCategories = [];
            $('#editor > div[data-role=vertical-content] > *[data-keywords]').each(function () {
                var myOwnKeywordsAsString = $(this).attr('data-keywords')
                    .toLowerCase()
                    .replace(/[^a-z0-9]+/g, ' ')
                    .replace(/(^[\s]+|[\s]+$)/g, ''), myOwnKeywordsAsList = myOwnKeywordsAsString.split(' '), isVisible = true, categoryName;
                if ('' !== filterAsString) {
                    for (var i = 0, len = filterKeywords.length; i < len; i++) {
                        if (!(myOwnKeywordsAsString.indexOf(filterKeywords[i]) > -1 || myOwnKeywordsAsList.indexOf(filterKeywords[i]) > -1)) {
                            isVisible = false;
                            break;
                        }
                    }
                }
                this.style.display = isVisible
                    ? ''
                    : 'none';
                if (isVisible) {
                    this.removeAttribute('data-is-first-visible-control-in-category');
                    categoryName = $(this).attr('data-category');
                    if (seenControlsCategories.indexOf(categoryName) === -1) {
                        seenControlsCategories.push(categoryName);
                        this.setAttribute('data-is-first-visible-control-in-category', '');
                    }
                }
            });
            $('#editor > div[data-role=vertical-content] > h2[data-category]').each(function () {
                this.style.display = seenControlsCategories.indexOf($(this).attr('data-category')) > -1
                    ? ''
                    : 'none';
            });
        })(this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.onThemeIdChanged = function (themeId) {
        (function ($, commandDispatcher, themeService, engine) {
            engine.getResourceManager().get('/modules/Typescript/Form/resources/theme-actions-panel.html')
                .then(function (templateText) {
                var themeName;
                if (engine.getLoader().getLoaderDependency(ELoaderDependency.WIX_AUTHORIZED_REQUEST_DETAILS) === null) {
                    themeName = themeService.getCurrentThemeName();
                }
                else {
                    themeName = "Current theme";
                }
                var themeProperties = themeService.enumerateProperties(false), currentThemeFont = (function () {
                    for (var i = 0, len = themeProperties.length; i < len; i++) {
                        if (themeProperties[i].name === Theme.THUMBNAIL_PROPERTY_NAME_FONT_FAMILY) {
                            return themeProperties[i].value;
                        }
                    }
                    return null;
                })(), template = new Salvage(templateText), model = {
                    name: themeName,
                    themeIsChanged: true,
                }, theme = themeId !== null
                    ? themeService.getThemeById(themeId)
                    : null, fontsManager = engine.getLoader().getLoaderDependency(ELoaderDependency.FONTS_MANAGER);
                try {
                    var fontByName = fontsManager.getFontByName(currentThemeFont);
                    model.webfont_class = fontsManager.isSystemFont(currentThemeFont) ? null : (fontByName === null ? null : fontByName.cssClassAaBbCc);
                }
                catch (e) {
                    model.webfont_class = null;
                }
                if (null !== theme) {
                    if (engine.getLoader().getLoaderDependency(ELoaderDependency.WIX_AUTHORIZED_REQUEST_DETAILS) !== null) {
                        theme.name = "Current theme";
                    }
                    model.themeIsChanged = false;
                    model.id = theme.id;
                    model.name = theme.name;
                }
                $('#options div[data-role=theme-actions-panel]').html(template.parse(model));
                $('#options')
                    .attr('data-has-theme-actions-panel', 'yes')
                    .each(function () {
                    commandDispatcher.editor.getI18n().translateDOMNode(this);
                });
            });
        })(this.editor.getJQuery(), this, this.editor.getTheme(), this.editor);
    };
    EditorCommandDispatcher.prototype.setThemeById = function (themeId) {
        (function (theme, self) {
            theme.applyTheme(theme.getThemeById(themeId));
            self.loadThemePropertiesIntoPanel();
        })(this.editor.getTheme(), this);
    };
    EditorCommandDispatcher.prototype.saveTheme = function (themeId) {
        (function ($, engine, ui, theme, loader, api, self) {
            var themeProperties;
            engine.getResourceManager().get('/modules/Typescript/Form/resources/save-theme-dialog.html')
                .then(function (dialogTemplateMarkup) {
                var template = new Salvage(dialogTemplateMarkup);
                var dialog = ui.createDialog(self.getUiTranslatedString('edt_UI_create_dialog_save_theme', 'Save theme'), [
                    {
                        type: EDialogButtonType.SAVE,
                        callback: function () {
                            var themeNameAlreadyExists = false;
                            var existingThemeId = null;
                            var isSystemTheme = false;
                            if (self.loader.getReadonlySubuser()) {
                                console.log("Not allowed to save theme");
                                dialog.close();
                                return false;
                            }
                            var themeName = $(dialog.body).find('input[type=text][name=name]').val(), themeNameLower = themeName.toString().trim().toLowerCase();
                            if (themeNameLower === '') {
                                ui.alert(self.getUiTranslatedString('edt_UI_alert_input_theme_name', 'Please input theme name!'), self.getUiTranslatedString('edt_UI_alert_input_theme_name_message', 'There was an error saving your theme!. Please input a valid theme name'), function () {
                                    $(dialog.body).find('input[type=text][name=name]').focus();
                                });
                                return;
                            }
                            for (var i = 0, themes = self.editor.getTheme().getThemesList(), len = themes.length; i < len; i++) {
                                if (themes[i].name.toLowerCase() === themeNameLower) {
                                    themeNameAlreadyExists = true;
                                    if (null === themes[i].userId || 0 === themes[i].id) {
                                        isSystemTheme = true;
                                    }
                                    existingThemeId = themes[i].id;
                                    break;
                                }
                            }
                            if (themeId) {
                                themeProperties = self.editor.getTheme().getThemeById(themeId).value;
                            }
                            else {
                                themeProperties = JSON.stringify(theme.enumerateProperties(false));
                            }
                            if (themeNameAlreadyExists) {
                                if (isSystemTheme) {
                                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_saving_theme', 'Error Saving theme'), self.getUiTranslatedString('edt_UI_alert_error_override_system_theme', 'Overriding a system theme is not allowed. Please choose a different name.'));
                                }
                                else {
                                    ui.prompt(self.getUiTranslatedString('edt_UI_override_theme', 'Override theme'), self.getUiTranslatedString('edt_UI_override_theme_message', 'A theme with this name already exists. Do you want to replace it?'), function () {
                                        postThemeOnServer(themeName, existingThemeId, themeProperties);
                                    });
                                }
                            }
                            else {
                                postThemeOnServer(themeName, null, themeProperties);
                            }
                        }
                    },
                    {
                        type: EDialogButtonType.CANCEL,
                        callback: function () {
                            dialog.close();
                        }
                    }
                ], {
                    width: '360px',
                });
                function postThemeOnServer(themeName, themeId, themeProperties) {
                    var requestParameters = {
                        name: themeName,
                        id: String(themeId || ''),
                        properties: themeProperties
                    };
                    self.appendWixParametersIfNeeded(self, requestParameters);
                    api.POST('/v2/editor/themes', requestParameters).then(function (response) {
                        dialog.close();
                        var promise = self.loadAvailableThemes();
                        promise.then(function () {
                            self.onThemeEnteringPreviewMode();
                        });
                    }).fail(function (themeSaveError) {
                        ui.alert(self.getUiTranslatedString('edt_UI_alert_error_saving_theme', 'Error saving theme'), 'There was an error while saving your theme');
                        console.error(themeSaveError);
                    });
                }
                $(dialog.body).addClass('save-theme-dialog');
                $(dialog.body).html(template.parse({}));
                var currentThemeName = null !== themeId && undefined !== themeId
                    ? theme.getThemeById(themeId).name
                    : self.editor
                        .getDocument()
                        .getConfiguration()
                        .getProperty('themeCurrentName', 'Simple Light');
                $(dialog.body).find('input[type=text][name=name]').val(currentThemeName + ' edited');
            })
                .fail(function () {
                ui.alert(self.getUiTranslatedString('edt_UI_alert_error_starting_application', 'Error starting application'), self.getUiTranslatedString('edt_UI_alert_error_starting_application_message', 'Failed to start application: /modules/Typescript/Form/resources/save-theme-dialog.html', '"/modules/Typescript/Form/resources/save-theme-dialog.html"'));
            });
        })(this.editor.getJQuery(), this.editor, this.loader.getUI(), this.editor.getTheme(), this.loader, this.loader.getAPI(), this);
    };
    EditorCommandDispatcher.prototype.appendWixParametersIfNeeded = function (self, requestParameters) {
        var wixIdentity = self.loader.getLoaderDependency(ELoaderDependency.WIX_AUTHORIZED_REQUEST_DETAILS);
        if (null !== wixIdentity) {
            if (wixIdentity.instanceId) {
                requestParameters['wixInstanceId'] = wixIdentity.instanceId;
            }
            if (wixIdentity.compId) {
                requestParameters['wixCompId'] = wixIdentity.compId;
            }
        }
        return requestParameters;
    };
    EditorCommandDispatcher.prototype.deleteTheme = function (themeId) {
        (function ($, engine, ui, theme, loader, api, self) {
            ui.prompt(self.getUiTranslatedString('edt_UI_delete_theme', 'Delete theme'), self.getUiTranslatedString('edt_UI_delete_theme_message', 'Are you sure you want to delete this theme?'), function () {
                api.DELETE('/v2/editor/themes/' + String(themeId)).then(function (deletedTheme) {
                    var promise = self.loadAvailableThemes();
                    promise.then(function () {
                        self.onThemeEnteringPreviewMode();
                    });
                }).fail(function (themeDeleteError) {
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_deleting_theme', 'Error deleting theme'), self.getUiTranslatedString('edt_UI_alert_error_deleting_theme_message', 'There was an error while deleting your theme'));
                    console.error(themeDeleteError);
                });
            });
        })(this.editor.getJQuery(), this.editor, this.loader.getUI(), this.editor.getTheme(), this.loader, this.loader.getAPI(), this);
    };
    EditorCommandDispatcher.prototype.injectParameterInExtraDataJSONWithBackticks = function (oldExtraDataJSONWithBackticks, paramName, paramValue) {
        try {
            var unquotedData = oldExtraDataJSONWithBackticks.replace(/`/g, '"');
            var parsedData = JSON.parse(unquotedData);
            parsedData[paramName] = paramValue;
            unquotedData = JSON.stringify(parsedData).replace(/"/g, '`');
            return unquotedData;
        }
        catch (e) {
            console.error(e);
            throw new Error('Failed to inject parameter in extraDataJSONWithBackticks!');
        }
    };
    EditorCommandDispatcher.prototype.triggerPaywall = function (reason) {
        var _this = this;
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var upgradeCode = this.getPageUpgradeJavascriptCode();
        if (!upgradeCode) {
            return;
        }
        var callbackParamsParser = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            return Array.prototype.slice.call(arguments, 0);
        };
        var params = eval(upgradeCode.replace(/UpgradeMechanism.runUpgrade/, 'callbackParamsParser')), toPlan = params[0], displayModal = params[1], theToken = params[2], message = params[3], trackDescription = params[4], extraDataJsonWithBackticks = params[5], servicedomain = params[6], upgradeSettings = {
            controlNotSupported: null,
            extraDataBadJSONWithBackticksInsteadOfQuotes: extraDataJsonWithBackticks,
            message: message,
            toPlan: toPlan,
            newPlan: toPlan,
            paywallReason: reason,
            theToken: theToken,
            trackDescription: trackDescription,
            servicedomain: location.hostname,
        };
        switch (reason) {
            case EUpgradeReason.HTML_BLOCK_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                try {
                    var htmlBlockUpgradeObj = _.find(this.availableUpgrades, { name: 'html_block_control' });
                    var htmlBlockTarget = htmlBlockUpgradeObj.target[0];
                    toPlan = htmlBlockTarget
                        ? this.planUtils.getPlanIdByPlanName(htmlBlockTarget.name)
                        : 0;
                }
                catch (e) {
                    var api = this.loader.getAPI();
                    this.errorLogger.logError(api, "Error calculating upgrade details for reason EUpgradeReason.HTML_BLOCK_NOT_SUPPORTED_IN_CURRENT_USER_PLAN with error " + e.toString(), EErrorPriority.WARNING, 'Paywalls');
                }
                upgradeSettings.toPlan = toPlan;
                upgradeSettings.trackDescription = trackDescription = 'HTML Block';
                upgradeSettings.controlNotSupported = 'HTML_BLOCK';
                upgradeSettings.message = this.loader.getI18n().translateText('userAccountUpgrade_8');
                break;
            case EUpgradeReason.CONTROL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                switch (args[0]) {
                    case ElementTypes.CONTROL_TYPE_FILE:
                        toPlan = this.getUpgradePlanByControlType(EControlType.FILE_UPLOAD);
                        upgradeSettings.toPlan = toPlan;
                        upgradeSettings.trackDescription = trackDescription = 'Upload Field';
                        upgradeSettings.controlNotSupported = 'UPLOAD_FIELD';
                        upgradeSettings.message = this.loader.getI18n().translateText('userAccountUpgrade_9');
                        break;
                    case ElementTypes.CONTROL_TYPE_PASSWORD:
                        toPlan = this.getUpgradePlanByControlType(EControlType.PASSWORD);
                        upgradeSettings.toPlan = toPlan;
                        upgradeSettings.trackDescription = trackDescription = 'Password';
                        upgradeSettings.controlNotSupported = 'PASSWORD';
                        upgradeSettings.message = this.loader.getI18n().translateText('ajax_editFieldPasswordPaid');
                        break;
                    case ElementTypes.CONTROL_TYPE_COUPON:
                        upgradeSettings.trackDescription = trackDescription = 'Coupon';
                        upgradeSettings.controlNotSupported = 'COUPON';
                        upgradeSettings.message = this.loader.getI18n().translateText('userAccountUpgrade_80');
                        break;
                    case ElementTypes.CONTROL_TYPE_FORMULA:
                        toPlan = this.getUpgradePlanByControlType(EControlType.FORMULA);
                        upgradeSettings.toPlan = toPlan;
                        upgradeSettings.trackDescription = trackDescription = 'Formula';
                        upgradeSettings.controlNotSupported = 'FORMULA';
                        upgradeSettings.message = this.loader.getI18n().translateText('userAccountUpgrade_82');
                        break;
                    case ElementTypes.CONTAINER_TYPE_REPEATABLE:
                        toPlan = this.getUpgradePlanByControlType(EControlType.REPEATABLE);
                        upgradeSettings.toPlan = toPlan;
                        upgradeSettings.trackDescription = trackDescription = 'Repeatable Container';
                        upgradeSettings.controlNotSupported = 'REPEATABLE_CONTAINER';
                        upgradeSettings.message = this.loader.getI18n().translateText('userAccountUpgrade_83');
                        break;
                    case ElementTypes.CONTROL_TYPE_FEE:
                        toPlan = this.getUpgradePlanByControlType(EControlType.FEE);
                        upgradeSettings.toPlan = toPlan;
                        break;
                    default:
                        upgradeSettings.trackDescription = trackDescription = 'Control Not Supported';
                        upgradeSettings.controlNotSupported = 'OTHER_CONTROL';
                        break;
                }
                break;
            case EUpgradeReason.NUMBER_OF_FIELDS_EXCEEDED_IN_CURRENT_USER_PLAN:
                upgradeSettings.trackDescription = trackDescription = 'Fields Limit Exceeded';
                upgradeSettings.message = message = 'You have reached the maximum number of fields allowed for your plan.';
                upgradeSettings.redirect = 'gold';
                upgradeSettings.mkt_src = this.editor.getDocument().getId();
                extraDataJsonWithBackticks = this.injectParameterInExtraDataJSONWithBackticks(extraDataJsonWithBackticks, 'redirect', 'gold');
                extraDataJsonWithBackticks = this.injectParameterInExtraDataJSONWithBackticks(extraDataJsonWithBackticks, 'mkt_src', String(this.editor.getDocument().getId()));
                upgradeSettings.extraDataBadJSONWithBackticksInsteadOfQuotes = extraDataJsonWithBackticks;
                try {
                    var upgradeObj = _.find(this.availableUpgrades, { name: 'create_form_field' });
                    var target = upgradeObj.target[0];
                    toPlan = target
                        ? this.planUtils.getPlanIdByPlanName(target.name)
                        : 0;
                    upgradeSettings.toPlan = toPlan;
                }
                catch (e) {
                    var api = this.loader.getAPI();
                    this.errorLogger.logError(api, "Error calculating upgrade details for reason EUpgradeReason.NUMBER_OF_FIELDS_EXCEEDED_IN_CURRENT_USER_PLAN with error " + e.toString(), EErrorPriority.WARNING, 'Paywalls');
                }
                if (args[0] === ElementTypes.CONTROL_TYPE_HTML_BLOCK) {
                    var maxNumberOfControls = this.userService.getControlTotalLimitForControlType(ElementTypes.CONTROL_TYPE_HTML_BLOCK).toString();
                    upgradeSettings.message = this.i18n.translateText('formeditor_formHtmlLimit', maxNumberOfControls);
                }
                break;
            case EUpgradeReason.VALIDATOR_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                upgradeSettings.trackDescription = trackDescription = 'Field Validation';
                try {
                    var validaterUpgradeObj = _.find(this.availableUpgrades, { name: 'field_validation_control_option' });
                    var validatorUpgradeTarget = validaterUpgradeObj.target[0];
                    toPlan = validatorUpgradeTarget
                        ? this.planUtils.getPlanIdByPlanName(validatorUpgradeTarget.name)
                        : 0;
                    upgradeSettings.toPlan = toPlan;
                }
                catch (e) {
                    var api = this.loader.getAPI();
                    this.errorLogger.logError(api, "Error calculating upgrade details for reason EUpgradeReason.VALIDATOR_NOT_SUPPORTED_IN_CURRENT_USER_PLAN with error " + e.toString(), EErrorPriority.WARNING, 'Paywalls');
                }
                break;
            case EUpgradeReason.LIMIT_NUMBER_OF_TIME_OPTIONS_CAN_BE_CHOSEN:
                upgradeSettings.trackDescription = 'Limit times options can be chosen';
                upgradeSettings.message = message = 'Upgrade to limit the number of times options can be chosen';
                try {
                    var limitChoicesUpgradeObj = _.find(this.availableUpgrades, { name: 'limit_choices_control_option' });
                    var limitChoicesUpgradeTarget = limitChoicesUpgradeObj.target[0];
                    toPlan = limitChoicesUpgradeTarget
                        ? this.planUtils.getPlanIdByPlanName(limitChoicesUpgradeTarget.name)
                        : 0;
                    upgradeSettings.toPlan = toPlan;
                }
                catch (e) {
                    var api = this.loader.getAPI();
                    this.errorLogger.logError(api, "Error calculating upgrade details for reason EUpgradeReason.LIMIT_NUMBER_OF_TIME_OPTIONS_CAN_BE_CHOSEN with error " + e.toString(), EErrorPriority.WARNING, 'Paywalls');
                }
                break;
            case EUpgradeReason.QUIZ_OPTIONS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                upgradeSettings.trackDescription = 'Assigning points to questions is available only for upgraded users';
                upgradeSettings.message = message = this.i18n.translateText('userAccountUpgrade_11');
                try {
                    var quizOptionsUpgradeObj = _.find(this.availableUpgrades, { name: 'quiz_control_option' });
                    var quizOptionsUpgradeTarget = quizOptionsUpgradeObj.target[0];
                    toPlan = quizOptionsUpgradeTarget
                        ? this.planUtils.getPlanIdByPlanName(quizOptionsUpgradeTarget.name)
                        : 0;
                    upgradeSettings.toPlan = toPlan;
                }
                catch (e) {
                    var api = this.loader.getAPI();
                    this.errorLogger.logError(api, "Error calculating upgrade details for reason EUpgradeReason.QUIZ_OPTIONS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN with error " + e.toString(), EErrorPriority.WARNING, 'Paywalls');
                }
                break;
            case EUpgradeReason.MAXIMUM_NUMBER_OF_TRANSLATIONS_REACHED:
                upgradeSettings.trackDescription = trackDescription = 'Translations';
                upgradeSettings.message = message = 'Multilanguage forms are available only for paid accounts';
                if (this.isWixOrWeebly()) {
                    upgradeSettings.toPlan = 0;
                    toPlan = 0;
                }
                break;
            case EUpgradeReason.MAXIMUM_NUMBER_OF_LIKERT_STATEMENTS_IN_CURRENT_USER_PLAN:
                try {
                    var likertBlockUpgradeObj = _.find(this.availableUpgrades, { name: 'likert_scale_controll' });
                    var htmlBlockTarget = likertBlockUpgradeObj.target[0];
                    toPlan = htmlBlockTarget
                        ? this.planUtils.getPlanIdByPlanName(likertBlockUpgradeObj.name)
                        : 0;
                }
                catch (e) {
                    var api = this.loader.getAPI();
                    this.errorLogger.logError(api, "Error calculating upgrade details for reason EUpgradeReason.MAXIMUM_NUMBER_OF_LIKERT_STATEMENTS_IN_CURRENT_USER_PLAN with error " + e.toString(), EErrorPriority.WARNING, 'Paywalls');
                }
                upgradeSettings.toPlan = toPlan;
                upgradeSettings.trackDescription = trackDescription = 'Likert Scale';
                upgradeSettings.controlNotSupported = 'LIKERT_SCALE';
                upgradeSettings.message = this.loader.getI18n().translateText('userAccountUpgrade_8');
                break;
            case EUpgradeReason.CREATE_NEW_FORM_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                upgradeSettings.trackDescription = trackDescription = '';
                upgradeSettings.toPlan = args[0] != undefined
                    ? args[0]
                    : upgradeSettings.toPlan;
                toPlan = upgradeSettings.toPlan;
                break;
            case EUpgradeReason.SSL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                upgradeSettings.trackDescription = trackDescription = 'Turn your forms into data-collection powerhouses.';
                upgradeSettings.message = message = 'SSL is available only for Platinum and Professional accounts. Click the Upgrade button below in order to gain access to this feature.';
                upgradeSettings.toPlan = 2;
                toPlan = upgradeSettings.toPlan;
                break;
            case EUpgradeReason.DOMAIN_ALIAS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                upgradeSettings.trackDescription = trackDescription = 'Turn your forms into data-collection powerhouses.';
                upgradeSettings.message = message = args[0] === 3
                    ? 'Domain Aliasing is available only for Professional accounts. Click the Upgrade button below in order to gain access to this feature.'
                    : 'Domain Aliasing is available only for Platinum and Professional accounts. Click the Upgrade button below in order to gain access to this feature.';
                upgradeSettings.toPlan = args[0] || 2;
                toPlan = upgradeSettings.toPlan;
                break;
            case EUpgradeReason.PAYMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                try {
                    var formPaymentsUpgradeObj = _.find(this.availableUpgrades, { name: 'enable_form_payments' });
                    var target = formPaymentsUpgradeObj.target[0];
                    toPlan = target
                        ? this.planUtils.getPlanIdByPlanName(target.name)
                        : 0;
                }
                catch (e) {
                    var api = this.loader.getAPI();
                    this.errorLogger.logError(api, "Error calculating upgrade details for reason EUpgradeReason.PAYMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN with error " + e.toString(), EErrorPriority.WARNING, 'Paywalls');
                }
                upgradeSettings.toPlan = toPlan;
                upgradeSettings.trackDescription = 'Enable payment options';
                upgradeSettings.message = message = this.loader.getI18n().translateText('userAccountUpgrade_22');
                break;
            case EUpgradeReason.SALESFORCE_COMMUNITY_SHARING_NOT_SUPPORTED_IN_CURRENT_USER_PLAN:
                upgradeSettings.trackDescription = 'Share on salesforce community';
                upgradeSettings.buttonType = EDialogButtonType.UPGRADE_TO_ENTERPRISE;
                upgradeSettings.toPlan = 4;
                toPlan = upgradeSettings.toPlan;
                break;
            default:
                break;
        }
        this.trackEvent('user_upgrade_popup_open', {
            reason: EUpgradeReason[upgradeSettings.paywallReason],
            trackDescription: upgradeSettings.trackDescription
        });
        upgradeCode = 'UpgradeMechanism.runUpgrade('
            + JSON.stringify(toPlan) + ','
            + JSON.stringify(displayModal) + ','
            + JSON.stringify(theToken) + ','
            + JSON.stringify(message) + ','
            + JSON.stringify(upgradeSettings.trackDescription) + ','
            + JSON.stringify(extraDataJsonWithBackticks) + ','
            + JSON.stringify(EUpgradeReason[reason]) + ')';
        window.Paywall
            .getInstance()
            .withI18n(this.loader.getI18n())
            .withJQuery(this.loader.getJQuery())
            .withUpgradeMechanismCode(upgradeCode)
            .createPaywallDialog(reason, upgradeSettings);
        this.loader.getJQuery().get('modules/upgrade-button/views/salesChatOnPaywalls.php', {
            'do': 'showProactiveChat',
            'trackDescription': trackDescription,
            'enableProactiveChatFormNewEditor': true
        }).then(function (result) {
            _this.executeProactiveChatJavascriptCode(result);
        });
    };
    EditorCommandDispatcher.prototype.appendElement = function (elementTypeId) {
        var _this = this;
        var setupDefaultsElement;
        elementTypeId = ~~elementTypeId;
        if (!elementTypeId) {
            throw new Error('Invalid argument: int expected');
        }
        if (this.isPaywallRequired(elementTypeId))
            return;
        if (!this.editor.getFactory().isElementTypeIdSupported(elementTypeId)) {
            this.triggerPaywall(EUpgradeReason.CONTROL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN, elementTypeId);
            return;
        }
        if (elementTypeId === ElementTypes.CONTROL_TYPE_COUPON) {
            this.trackEvent('payments_coupon_add');
            if (!this.canAddAnotherCouponCode()) {
                return;
            }
        }
        if (elementTypeId === ElementTypes.CONTROL_TYPE_FORMULA) {
            this.trackEvent('payments_formula_add');
        }
        this.trackEventOnElementAddOrDuplicateByElementId(elementTypeId);
        this.loader.getUndoService().trigger('user-action', 'insert-element');
        (function (engine, document) {
            if (ElementTypes.CONTROL_TYPE_PAGE_BREAK === elementTypeId) {
                elementTypeId = ElementTypes.CONTAINER_TYPE_PAGE;
            }
            if (elementTypeId !== ElementTypes.CONTAINER_TYPE_PAGE && elementTypeId !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
                var newElement_1 = engine.createElement(elementTypeId);
                setupDefaultsElement = newElement_1;
                var totalNumberOfPages = document.getNumberOfPages(), insertionPage = void 0, insertionContainer = null, row_1;
                if (!totalNumberOfPages) {
                    insertionPage = engine.createElement(ElementTypes.CONTAINER_TYPE_PAGE).setupDefaults();
                    document.appendChild(insertionPage);
                }
                else {
                    if (document.getActiveElement()) {
                        insertionContainer = document.getActiveElement().getFirstParentContainer();
                        if (!insertionContainer) {
                            insertionPage = document.getActiveElement().getParentPage();
                        }
                        else {
                            insertionPage = null;
                        }
                    }
                    else {
                        insertionPage = document.getLastPageContainer();
                    }
                }
                row_1 = engine.createElement(ElementTypes.CONTAINER_TYPE_ROW);
                row_1.appendChild(newElement_1);
                (insertionContainer || insertionPage || document.getPageByIndex(document.getNumberOfPages() - 1)).appendChild(row_1);
                newElement_1.getRootNode().scrollIntoView();
                if (_this.loader.getOpenInspectorOnInsert()) {
                    _this.loader.execCommand('select-element', newElement_1);
                }
                setTimeout(function () {
                    var rowAction = appendControl(row_1);
                    _this.store.dispatch(rowAction);
                    var controlAction = appendControl(newElement_1);
                    _this.store.dispatch(controlAction);
                });
            }
            else if (elementTypeId === ElementTypes.CONTAINER_TYPE_PAGE) {
                var newPage = engine.createElement(ElementTypes.CONTAINER_TYPE_PAGE);
                var lastPage = document.getLastPageContainer();
                document.insertAfter(lastPage, newPage);
                _this.loader.trigger('page_created');
            }
            else if (elementTypeId === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
                var newPage = engine.createElement(ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE);
                document.appendChild(newPage);
                newPage.setAttached(true);
                _this.loader.trigger('page_created');
            }
            if (setupDefaultsElement) {
                setupDefaultsElement.setupDefaults();
            }
        })(this.editor, this.editor.getDocument());
    };
    EditorCommandDispatcher.prototype.trackEventOnElementAddOrDuplicateByElementId = function (elementTypeId) {
        var controlNameOnClick = this
            .loader
            .getEngine()
            .getFactory()
            .getItemStaticClassByTypeNameOrTypeId(elementTypeId)
            .getConfiguration().name
            || '';
        if (controlNameOnClick.length === 0) {
            controlNameOnClick = 'Unknown';
        }
        var trackedEventName = this.loader.getEngine().getFactory().getItemStaticClassByTypeNameOrTypeId(elementTypeId).getConfiguration().name.replace(/\s+/g, '-').toLowerCase();
        this.trackEvent('control_insert_' + trackedEventName, { type: controlNameOnClick, new_editor: '1' });
    };
    EditorCommandDispatcher.prototype.setGridVisibility = function (visibility) {
        (function ($) {
            $('#form').attr('data-grid-visibility', visibility ? '1' : null);
        })(this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.loadEditorSettingIntoPanel = function (editorSetting, autoScrollTop) {
        (function (editorValueRendererFactory, self, engine, $, resourceManager, ui, loader) {
            self.editorValueRendererFactory.resolve().then(function () {
                editorValueRendererFactory.withElement(editorSetting);
                var scrollTopValue = 0;
                if (autoScrollTop !== undefined) {
                    if (autoScrollTop === true) {
                        scrollTopValue = $('[data-role=vertical-content]', '#item').scrollTop();
                    }
                    else {
                        scrollTopValue = parseInt(String(autoScrollTop), 10);
                    }
                }
                resourceManager.get('/modules/Typescript/Form/resources/editor-setting-editor.html')
                    .then(function (templateText) {
                    var template = new Salvage(templateText), model = editorSetting.getSettingsModelForInspectorPanel();
                    if (model.groups) {
                        for (var i = 0, len = model.groups.length; i < len; i++) {
                            for (var j = 0, n = model.groups[i].properties.length; j < n; j++) {
                                model.groups[i].properties[j]['control'] = JSON.stringify({
                                    element: editorSetting.getTypeId(),
                                    property: model.groups[i].properties[j].propertyFQN,
                                    type: model.groups[i].properties[j].type,
                                    value: self.castValueToString(editorSetting.getProperty(model.groups[i].properties[j].propertyFQN)),
                                });
                            }
                        }
                    }
                    $('#item')
                        .attr('data-target-element-type', 'setting')
                        .attr('data-target-element', '')
                        .attr('data-target-setting-id', editorSetting.getTypeId);
                    $('#item > [data-role=vertical-content]').html(template.parse(model)).each(function () {
                        ui.upgrade(this);
                    });
                    for (var properties = editorSetting.enumerateProperties(), i = 0, len = properties.length; i < len; i++) {
                        var propertyValue = editorSetting.hasProperty(properties[i].name)
                            ? editorSetting.getProperty(properties[i].name)
                            : null;
                        self.updateEditorSettingPropertyIntoPanel(editorSetting, properties[i].name, propertyValue);
                    }
                    self.setActiveEditorPanel('item', scrollTopValue);
                    $('#item').find('span[data-role=item-type-name]').each(function () {
                        var configuration = editorSetting.getConfiguration();
                        this.textContent = configuration.name;
                        if (configuration.i18nName) {
                            this.setAttribute('data-i18n-text', configuration.i18nName);
                        }
                        else {
                            this.removeAttribute('data-i18n-text');
                        }
                    });
                    $('#item > div[data-role=vertical-content]').each(function () {
                        self.addPerfectScrollbar(this);
                    });
                    self.updateElementErrorsInInspectorPanel(editorSetting);
                    self.editor.getI18n().translateDOMNode(document.getElementById('item'));
                })
                    .fail(function (e) {
                    console.error(e);
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_loading_resource', 'Error loading resource'), self.getUiTranslatedString('edt_UI_alert_error_loading', 'Error loading "/modules/Typescript/Form/resources/item-editor.html"', '"/modules/Typescript/Form/resources/item-editor.html"'));
                });
            });
        })(this.editorValueRendererFactory, this, this.editor, this.loader.getJQuery(), this.editor.getResourceManager(), this.loader.getUI(), this.loader);
    };
    EditorCommandDispatcher.prototype.onSelectionChanged = function () {
        if (document.getSelection) {
            var documentSelection = document.getSelection();
            if (documentSelection.removeAllRanges) {
                documentSelection.removeAllRanges();
            }
        }
        (function (editorValueRendererFactory, self, engine, $, resourceManager, ui, selection, loader) {
            self.editorValueRendererFactory.resolve().then(function () {
                var selectionItems = selection.getItems();
                if (selectionItems.length > 1) {
                    selectionItems = [selection.rebuildVirtualSelectionControl().getVirtualControl()];
                }
                if (selectionItems.length === 1) {
                    editorValueRendererFactory.withElement(selectionItems[0]);
                }
                else {
                    editorValueRendererFactory.withElement(null);
                }
                var trackedEventName = self.lastTrackedSelectionName;
                if (selectionItems.length) {
                    trackedEventName = selectionItems[0].hasOwnProperty('elements')
                        ? 'multiple-elements'
                        : selectionItems[0].getRootNode().attributes['data-type'].value;
                }
                resourceManager.get('/modules/Typescript/Form/resources/item-editor.html')
                    .then(function (templateText) {
                    var template = new Salvage(templateText), numberOfSelectedItems = selectionItems.length, model;
                    switch (numberOfSelectedItems) {
                        case 0:
                            model = {
                                isEmpty: true,
                                isMultiple: false,
                                isSingle: false,
                                count: 0,
                            };
                            self.trackEvent('control_deselect_' + trackedEventName);
                            break;
                        case 1:
                            model = {
                                isEmpty: false,
                                isMultiple: false,
                                isSingle: true,
                                type: selectionItems[0]._static().nodeName,
                                count: 1,
                                attributes: self.createElementAttributesModel(selectionItems[0]),
                                hash: selectionItems[0].getHash(),
                                isRemovable: selectionItems[0].isRemovable(),
                                isDuplicatable: selectionItems[0].isDuplicatable(),
                                hasEditingCapabilities: selectionItems[0].isRemovable() || selectionItems[0].isDuplicatable(),
                                i18nName: (selectionItems[0]._static().getConfiguration() || {}).i18nName,
                                elementName: selectionItems[0].getElementName(),
                            };
                            self.lastTrackedSelectionName = trackedEventName;
                            self.trackEvent('control_select_' + trackedEventName, {}, 50);
                            switch (selectionItems[0].getTypeId()) {
                                case ElementTypes.CONTROL_TYPE_FORM_HEADER:
                                    self.trackEvent('edit_form_headline');
                                    break;
                            }
                            break;
                        default:
                            model = {
                                isEmpty: false,
                                isMultiple: true,
                                isSingle: false,
                                count: numberOfSelectedItems,
                                isRemovable: true,
                            };
                            for (var i = 0; i < numberOfSelectedItems; i++) {
                                if (!selectionItems[i].isRemovable()) {
                                    model.isRemovable = false;
                                    break;
                                }
                            }
                            self.trackEvent('control_select_multiple');
                    }
                    if (model.isSingle) {
                        $('#item')
                            .attr('data-target-element', selectionItems[0].getHash())
                            .attr('data-target-element-type', String(selectionItems[0].getElementName() || '').toLowerCase());
                    }
                    else {
                        $('#item').removeAttr('data-target-element-type');
                    }
                    $('#item > [data-role=vertical-content]').html(template.parse(model)).each(function () {
                        ui.upgrade(this);
                    });
                    if (model.isSingle) {
                        (function (element, properties) {
                            for (var i = 0, len = properties.length; i < len; i++) {
                                self.updateElementPropertyIntoPanel(element, properties[i].name, element.getProperty(properties[i].name));
                            }
                            self.checkRequiredAndHiddenProperties(element);
                        })(selectionItems[0], ElementPropertyOrder.getSortedElementProperties(selectionItems[0]));
                        self.setActiveEditorPanel('item');
                    }
                    else {
                        if (model.isEmpty) {
                            self.setActiveEditorPanel('editor');
                        }
                        else {
                            self.setActiveEditorPanel('item');
                        }
                        $('#item').attr('data-target-element', null);
                    }
                    $('#item').find('span[data-role=item-type-name]').each(function () {
                        if (selection.getLength() === 1) {
                            this.textContent = model.elementName;
                            if (model.i18nName) {
                                this.setAttribute('data-i18n-text', model.i18nName);
                            }
                            else {
                                this.removeAttribute('data-i18n-text');
                            }
                        }
                        else {
                            this.removeAttribute('data-i18n-text');
                            if (selection.getLength() > 1) {
                                var elements = selection.getVirtualControl().getElements();
                                _.forEach(elements, function (element) { return self.checkRequiredAndHiddenProperties(element); });
                                this.textContent = elements.length + ' fields selected';
                            }
                            else {
                                this.textContent = 0 + ' fields selected';
                            }
                        }
                    });
                    $('#item > div[data-role=vertical-content]').each(function () {
                        self.addPerfectScrollbar(this);
                    });
                    if (selection.isSingle()) {
                        self.updateElementErrorsInInspectorPanel(selection.getItems()[0]);
                    }
                    self.editor.getI18n().translateDOMNode(document.getElementById('item'));
                })
                    .fail(function (e) {
                    console.error(e);
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_loading_resource', 'Error loading resource'), self.getUiTranslatedString('edt_UI_alert_error_loading', 'Error loading "/modules/Typescript/Form/resources/item-editor.html"', '"/modules/Typescript/Form/resources/item-editor.html"'));
                });
            });
        })(this.editorValueRendererFactory, this, this.editor, this.loader.getJQuery(), this.editor.getResourceManager(), this.loader.getUI(), this.loader.getSelection(), this.loader);
    };
    EditorCommandDispatcher.prototype.checkRequiredAndHiddenProperties = function (element) {
        var selector = null, message = '';
        if (element.hasProperty('options.hidden') && element.getProperty('options.hidden') === true) {
            selector = 'options-required';
            message = 'Required option isn\'t compatible with the field property Hidden.';
        }
        if (element.hasProperty('options.required') && element.getProperty('options.required') === true) {
            selector = 'options-hidden';
            message = 'Hidden option isn\'t compatible with the field property Required.';
        }
        if (selector !== null) {
            var jq = this.loader.getJQuery(), requiredOption = jq('[data-property-name=' + selector + ']');
            requiredOption.find('input[type="checkbox"]').attr('disabled', true);
            requiredOption.css('opacity', .3);
            requiredOption
                .find('input[type=checkbox],span.decorator')
                .attr('title', message)
                .css('cursor', 'default');
        }
    };
    EditorCommandDispatcher.prototype.castValueToString = function (v) {
        if (v) {
            if (v instanceof Array) {
                return JSON.stringify(v);
            }
            else {
                if (v.constructor === Object) {
                    return JSON.stringify(v);
                }
            }
        }
        return v === null
            ? ''
            : String(v);
    };
    EditorCommandDispatcher.prototype.createElementAttributesModel = function (element) {
        var result = [], itemProperties = ElementPropertyOrder.getSortedElementProperties(element), attributeName, attributeHardcodedName, propertyName, propertyI18nName, propertyComponents, attribute, property, propertyValue, typeId = element.getTypeId();
        ElementHardcodedPropertyLabel.withI18n(this.loader.getI18n());
        if (!itemProperties || !itemProperties.length) {
            return;
        }
        for (var i = 0, len = itemProperties.length; i < len; i++) {
            if (!InspectorHiddenProperties.isPropertyEditable(itemProperties[i], element)) {
                continue;
            }
            propertyComponents = itemProperties[i].name.split('.');
            attributeName = ElementPropertyOrder.getHardcodedPropertyAttributeName(itemProperties[i].name, element);
            attributeHardcodedName = ElementHardcodedPropertyLabel.getHardcodedAttributeLabel(attributeName)
                || attributeName;
            propertyName = propertyComponents[1];
            propertyI18nName = ControlPropertyTranslator.translatePropertyName(itemProperties[i].name);
            attribute = null;
            for (var j = 0, n = result.length; j < n; j++) {
                if (result[j].name === attributeName) {
                    attribute = result[j];
                    break;
                }
            }
            if (null === attribute) {
                attribute = {
                    "name": attributeName,
                    "attributeHardcodedName": attributeHardcodedName,
                    "i18nName": ControlPropertyTranslator.translateAttributeName(attributeName),
                    "properties": []
                };
                result.push(attribute);
            }
            propertyValue = element.getProperty(itemProperties[i].name);
            property = {
                "type": itemProperties[i].type.replace(/\[\]$/, 'Array'),
                "i18nName": propertyI18nName,
                "name": propertyName,
                "attributeHardcodedName": attributeHardcodedName,
                "label": ElementHardcodedPropertyLabel.getHardcodedPropertyLabel(typeId, itemProperties[i].name) || propertyName,
                "propertyFQN": itemProperties[i].name.replace('.', '-'),
                "control": JSON.stringify({
                    element: element.getTypeId(),
                    property: itemProperties[i].name,
                    type: itemProperties[i].type,
                    value: this.castValueToString(propertyValue),
                }),
            };
            attribute.properties.push(property);
        }
        return result;
    };
    EditorCommandDispatcher.prototype.getCastedPropertyValue = function (propertyValue, propertyType) {
        var result;
        switch (propertyType) {
            case 'boolean':
                if ('false' === propertyValue) {
                    result = false;
                }
                else {
                    result = !!propertyValue;
                }
                break;
            case 'int':
                result = propertyValue === ''
                    ? null
                    : parseInt(propertyValue);
                break;
            case 'float':
            case 'number':
                result = propertyValue === ''
                    ? null
                    : parseFloat(propertyValue);
                break;
            case 'any':
                if (propertyValue === 0) {
                    return propertyValue;
                }
            case 'string':
            default:
                result = propertyValue || null;
                break;
        }
        return result;
    };
    EditorCommandDispatcher.prototype.updateEditorSettingProperty = function (setting, propertyName, propertyType, newPropertyValue) {
        newPropertyValue = this.getCastedPropertyValue(newPropertyValue, propertyType);
        var currentPropertyValue = setting.getProperty(propertyName);
        try {
            setting.setProperty(propertyName, newPropertyValue);
        }
        catch (e) {
            this.updateEditorSettingPropertyIntoPanel(setting, propertyName, currentPropertyValue);
        }
    };
    EditorCommandDispatcher.prototype.updateElementProperty = function (element, propertyName, propertyType, newPropertyValue) {
        newPropertyValue = this.getCastedPropertyValue(newPropertyValue, propertyType);
        var currentPropertyValue = element.getProperty(propertyName);
        try {
            element.setProperty(propertyName, newPropertyValue);
            this.triggerPropertyChangeAction(element, propertyName, newPropertyValue);
        }
        catch (e) {
            this.updateElementPropertyIntoPanel(element, propertyName, currentPropertyValue);
        }
    };
    EditorCommandDispatcher.prototype.triggerPropertyChangeAction = function (element, propertyName, newPropertyValue) {
        var _this = this;
        var action = updateControlProperty(element.getId(), propertyName, newPropertyValue);
        this.store.dispatch(action);
        var controlTypesWithChildren = [ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER];
        if (controlTypesWithChildren.includes(element.getTypeId())) {
            var children = element.getChildren();
            _.forEach(children, function (child) {
                var action = updateControlProperty(child.getId(), propertyName, newPropertyValue);
                _this.store.dispatch(action);
            });
        }
    };
    EditorCommandDispatcher.prototype.convertPropertyFQNToCSS = function (propertyFQN) {
        return propertyFQN.replace(/\./g, '-');
    };
    EditorCommandDispatcher.prototype.updateEditorSettingPropertyIntoPanel = function (editorSetting, propertyName, propertyValue) {
        (function ($, self) {
            $('#item[data-target-element-type=setting][data-target-setting-id=' + editorSetting.getTypeId() + '] [data-role=property][data-property-name=' + self.convertPropertyFQNToCSS(propertyName) + '] input:not([data-role=secondary]), ' +
                '#item[data-target-element-type=setting][data-target-setting-id=' + editorSetting.getTypeId() + '] [data-role=property][data-property-name=' + self.convertPropertyFQNToCSS(propertyName) + '] textarea:not([data-role=secondary])' +
                '#item[data-target-element-type=setting][data-target-setting-id=' + editorSetting.getTypeId() + '] [data-role=property][data-property-name=' + self.convertPropertyFQNToCSS(propertyName) + '] select:not([data-role=secondary])')
                .each(function () {
                var targetValueProperty = ['radio', 'checkbox'].indexOf($(this).attr('type')) > -1
                    ? 'checked'
                    : 'value', currentValue = this[targetValueProperty], isJSON = this.hasAttribute('data-is-json-value');
                if (isJSON) {
                    if (currentValue === '') {
                        currentValue = null;
                    }
                    else {
                        currentValue = JSON.parse(currentValue);
                    }
                }
                if (String(propertyValue) !== String(currentValue)) {
                    this[targetValueProperty] = null === propertyValue
                        ? ''
                        : isJSON
                            ? JSON.stringify(propertyValue)
                            : String(propertyValue);
                }
                var propagateValueCSSSelector = this.hasAttribute('data-propagate-value-css-selector')
                    ? this.getAttribute('data-propagate-value-css-selector') || null
                    : null, propagateValueAttributeName = this.hasAttribute('data-propagate-value-attribute-name')
                    ? this.getAttribute('data-propagate-value-attribute-name') || null
                    : null;
                if (propagateValueAttributeName && propagateValueCSSSelector) {
                    $(propagateValueCSSSelector).attr(propagateValueAttributeName, null === propertyValue ? null : String(propertyValue) || '');
                }
            });
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.updateElementPropertyIntoPanel = function (element, propertyName, propertyValue) {
        (function ($, self) {
            $('#item[data-target-element=' + element.getHash() + '] [data-role=property][data-property-name=' + self.convertPropertyFQNToCSS(propertyName) + '] input:not([data-role=secondary]), ' +
                '#item[data-target-element=' + element.getHash() + '] [data-role=property][data-property-name=' + self.convertPropertyFQNToCSS(propertyName) + '] textarea:not([data-role=secondary])' +
                '#item[data-target-element=' + element.getHash() + '] [data-role=property][data-property-name=' + self.convertPropertyFQNToCSS(propertyName) + '] select:not([data-role=secondary])')
                .each(function () {
                var targetValueProperty = ['radio', 'checkbox'].indexOf($(this).attr('type')) > -1
                    ? 'checked'
                    : 'value', currentValue = this[targetValueProperty], isJSON = this.hasAttribute('data-is-json-value');
                if (isJSON) {
                    if (currentValue === '') {
                        currentValue = null;
                    }
                    else {
                        currentValue = JSON.parse(currentValue);
                    }
                }
                if (String(propertyValue) !== String(currentValue)) {
                    this[targetValueProperty] = null === propertyValue
                        ? ''
                        : isJSON
                            ? JSON.stringify(propertyValue)
                            : String(propertyValue);
                }
                var propagateValueCSSSelector = this.hasAttribute('data-propagate-value-css-selector')
                    ? this.getAttribute('data-propagate-value-css-selector') || null
                    : null, propagateValueAttributeName = this.hasAttribute('data-propagate-value-attribute-name')
                    ? this.getAttribute('data-propagate-value-attribute-name') || null
                    : null;
                if (propagateValueAttributeName && propagateValueCSSSelector) {
                    $(propagateValueCSSSelector).attr(propagateValueAttributeName, null === propertyValue ? null : String(propertyValue) || '');
                }
            });
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.repaintFooterOnAllPages = function () {
        for (var i = 0, len = this.editor.getDocument().getNumberOfPages(); i < len; i++) {
            this.editor.getDocument().getPageByIndex(i).renderFooter();
        }
    };
    EditorCommandDispatcher.prototype.createHTMLEditorDialog = function (input, dialogTitle, dialogTitleI18n, style) {
        (function ($, ui, self, resourceManager) {
            resourceManager.loadJavascript('/includes/tinymce_4.6.4/tinymce/js/tinymce/tinymce.min.js')
                .then(function () {
                var tinyMCEStyleCorrectorElement = document.createElement('style'), tinyMCEEditorId = 'tinymce_' + self.tinyMCEEditorUID, textarea = document.createElement('textarea'), dialog = ui.createDialog(self.getUiTranslatedString(dialogTitleI18n, dialogTitle), [
                    {
                        type: EDialogButtonType.SAVE,
                        callback: function () {
                            var inputValue = window['tinyMCE'].activeEditor.getContent();
                            window['tinyMCE'].remove();
                            dialog.close();
                            tinyMCEStyleCorrectorElement.parentNode.removeChild(tinyMCEStyleCorrectorElement);
                            $('body > div[id^="mceu"].mce-container, body > div[id^="mceu"].mce-widget').remove();
                            input.value = inputValue;
                            $(input).trigger('input').trigger('change');
                        }
                    },
                    {
                        type: EDialogButtonType.CANCEL,
                        callback: function () {
                            dialog.close();
                            tinyMCEStyleCorrectorElement.parentNode.removeChild(tinyMCEStyleCorrectorElement);
                            window['tinyMCE'].remove();
                            $('body > div[id^="mceu"].mce-container, body > div[id^="mceu"].mce-widget').remove();
                        }
                    }
                ], {
                    onCloseButtonClick: function () {
                        tinyMCEStyleCorrectorElement.parentNode.removeChild(tinyMCEStyleCorrectorElement);
                        window['tinyMCE'].remove();
                        $('body > div[id^="mceu"].mce-container, body > div[id^="mceu"].mce-widget').remove();
                    }
                }), dialogWidth, dialogHeight;
                dialog.body.setAttribute('data-role', 'tinymce-editor');
                self.tinyMCEEditorUID++;
                textarea.id = tinyMCEEditorId;
                textarea.setAttribute('id', tinyMCEEditorId);
                dialog.body.appendChild(textarea);
                textarea.value = input.value;
                window['tinymce'].init({
                    selector: '#' + tinyMCEEditorId,
                    content_style: style ? String(style) : '',
                    branding: false,
                    menubar: false,
                    resize: false,
                    height: String(~~(document.body.getBoundingClientRect().height * .9) - 300),
                    width: String(~~(document.body.getBoundingClientRect().width * .9) - 200),
                    plugins: [
                        "textcolor",
                        "preview",
                        "link",
                        "image",
                        "emoticons",
                        "lists",
                        "hr",
                        "table",
                        "code",
                        "directionality",
                        "insertdatetime",
                    ],
                    toolbar1: 'fontselect fontsizeselect  styleselect | bold italic forecolor backcolor',
                    toolbar2: ' undo redo | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | insert table | code',
                    fontsize_formats: '8pt 10pt 12pt 14pt 18pt 24pt 36pt',
                    font_formats: 'Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;' +
                        'Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;' +
                        'Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Open Sans=open sans;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;' +
                        'Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;' +
                        'Webdings=webdings;Wingdings=wingdings,zapf dingbats',
                    convert_urls: false,
                    image_title: true,
                    automatic_uploads: true,
                    file_picker_types: 'image',
                    file_browser_callback: true,
                    entity_encoding: "raw",
                    extended_valid_elements: "iframe[src|title|width|height|allowfullscreen|frameborder|webkitAllowFullScreen|mozallowfullscreen|allowFullScreen|allow]",
                    file_picker_callback: function (callback, value, meta) {
                        TinyMceUploadImage.prepareFileForUplod(callback);
                    },
                    images_upload_handler: function (blobInfo, success, failure) {
                        TinyMceUploadImage.sendDataForUpload(failure, success, blobInfo, self.editor.getDocument().getId());
                    }
                });
                document.body.appendChild(tinyMCEStyleCorrectorElement);
                self.correctCSSTransformTimerFunction(tinyMCEStyleCorrectorElement, dialog.body, dialogWidth, dialogHeight);
            })
                .fail(function () {
                ui.alert(self.getUiTranslatedString('edt_UI_alert_failed_loading_external_module', 'Failed loading external module'), self.getUiTranslatedString('edt_UI_alert_failed_loading_external_module_message', 'There was an error loading TinyMCE module. Please retry'));
            });
        })(this.editor.getJQuery(), this.loader.getUI(), this, this.editor.getResourceManager());
    };
    EditorCommandDispatcher.prototype.makePreviewOverlayCoverEditorElementsOnWix = function () {
        (function ($) {
            var marginTop = $("body[data-form-editor-on-wix='1'] header[data-version='v1-1']").height();
            $("body[data-form-editor-on-wix='1'] .tmask").css({
                'margin-top': '-' + marginTop + 'px',
                'position': 'fixed',
                'z-index': '1000000',
                'top': 'initial'
            });
        })(this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.deleteSelection = function () {
        (function ($, self, document, ui, selection, resourceManager) {
            if (selection.getLength() === 0) {
                return;
            }
            var selectionContents = selection.getItems(), realSelectionLength = 0;
            for (var i = 0, len = selectionContents.length; i < len; i++) {
                for (var j = 0, items = selectionContents[i].flatten(), n = items.length; j < n; j++) {
                    if (!items[j].isRemovable()) {
                        ui.alert(self.getUiTranslatedString('edt_UI_alert_error_deleting_items', 'Error deleting items'), self.getUiTranslatedString('edt_UI_alert_error_deleting_items_message', 'Cannot delete selection: The selection contains items that cannot be deleted!'));
                        return;
                    }
                    if (items[j].isCountableWhenComputingFormNumberOfControls()) {
                        realSelectionLength++;
                    }
                }
            }
            if (realSelectionLength > 0) {
                if (realSelectionLength === 1) {
                    var trackedEventName = selectionContents[0].getRootNode().attributes['data-type'].value;
                    self.trackEvent('control_delete_' + trackedEventName);
                }
                else {
                    self.trackEvent('editor_delete_selected_click');
                }
            }
            var executeDeletion = function () {
                self.loader.getUndoService().trigger('user-action', 'delete-selection');
                var action = removeControls(selectionContents);
                self.store.dispatch(action);
                for (var i = 0, len = selectionContents.length; i < len; i++) {
                    try {
                        selectionContents[i].getParent().removeChild(selectionContents[i]);
                    }
                    catch (e) {
                        throw new Error(e);
                    }
                }
                document.normalize();
                selection.clear();
                document.setActiveElement(null);
                self.loader.trigger('control_deleted');
            };
            if (realSelectionLength > 0) {
                resourceManager.get('/modules/Typescript/Form/resources/delete-selection-dialog.html')
                    .then(function (templateHTML) {
                    var dialog = ui.createDialog(self.getUiTranslatedString('edt_UI_create_dialog_confirm_delete_operation', 'Confirm delete operation'), [
                        {
                            type: EDialogButtonType.YES,
                            callback: function () {
                                dialog.close();
                                executeDeletion();
                                self.setActiveEditorPanel('editor');
                                dialog = executeDeletion = null;
                                self.loader.trigger('deleted_element');
                            }
                        },
                        {
                            type: EDialogButtonType.NO,
                            callback: function () {
                                dialog.close();
                                dialog = executeDeletion = null;
                            }
                        }
                    ]), template = new Salvage(templateHTML);
                    dialog.body.innerHTML = template.parse({ "length": realSelectionLength, "isSingular": realSelectionLength === 1 });
                    self.editor.getI18n().translateDOMNode(dialog.body);
                })
                    .fail(function () {
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_error_executing_command', 'Error executing command'), self.getUiTranslatedString('edt_UI_alert_error_executing_command_message', 'Failed starting application "Delete Selection": resource "/modules/Typescript/Form/resources/delete-selection-dialog.html" could not be loaded', '"/modules/Typescript/Form/resources/delete-selection-dialog.html"'));
                });
            }
            else {
                executeDeletion();
                executeDeletion = null;
            }
        })(this.editor.getJQuery(), this, this.editor.getDocument(), this.loader.getUI(), this.loader.getSelection(), this.editor.getResourceManager());
    };
    EditorCommandDispatcher.prototype.saveForm = function () {
        this.saveActivity.start();
    };
    EditorCommandDispatcher.prototype.resizeElement = function (element, edge, delta) {
        (function (theme, self) {
            var deltaConvertedToGridUnits = 0, currentElementHeight, elementSibling, previousElementColspan = 0;
            switch (edge) {
                case EElementEdge.LEFT:
                case EElementEdge.RIGHT:
                    deltaConvertedToGridUnits = Math.round(delta / (theme.getComputedColumnSpacing() + theme.getComputedColumnWidth()));
                    if (deltaConvertedToGridUnits === 0) {
                        return;
                    }
                    previousElementColspan = element.getColspan();
                    element.withColspan(previousElementColspan - deltaConvertedToGridUnits);
                    if (previousElementColspan === element.getColspan()) {
                        return;
                    }
                    break;
                case EElementEdge.TOP:
                case EElementEdge.BOTTOM:
                    currentElementHeight = element.getHeight();
                    if (null === currentElementHeight || 0 === currentElementHeight) {
                        currentElementHeight = element.getRootNode().getBoundingClientRect().height;
                    }
                    currentElementHeight -= delta;
                    element.withHeight(currentElementHeight);
                    break;
            }
            if (edge !== EElementEdge.LEFT && edge !== EElementEdge.RIGHT) {
                return;
            }
            elementSibling = edge === EElementEdge.LEFT
                ? element.getPreviousSibling()
                : element.getNextSibling();
            if (elementSibling === null && EElementEdge.LEFT === edge && deltaConvertedToGridUnits > 0) {
                elementSibling = self.editor.createElement(ElementTypes.CONTROL_TYPE_SEPARATOR);
                element.getParent().insertBefore(element, elementSibling);
                elementSibling.withColspan(deltaConvertedToGridUnits);
            }
            else {
                if (elementSibling) {
                    elementSibling.withColspan(elementSibling.getColspan() + deltaConvertedToGridUnits);
                }
            }
            if (element.getParent() && ElementTypes.CONTAINER_TYPE_ROW === element.getParent().getTypeId()) {
                element.getParent().makeElementsToFitColspanUsingTheFairResizingAlgorithm(element.getParent().getColspan(), false);
            }
        })(this.editor.getTheme(), this);
    };
    EditorCommandDispatcher.prototype.resizeLabelByDelta = function (element, currentRenderedLabelWidthInUnits, deltaInPixels) {
        (function (theme, self, document) {
            var deltaInUnits = Math.round(deltaInPixels / (theme.getComputedColumnSpacing() + theme.getComputedColumnWidth()));
            if (0 === deltaInUnits) {
                return;
            }
            if (!element.hasProperty('label.widthInUnits')) {
                return;
            }
            var purposedLabelWidth = currentRenderedLabelWidthInUnits + deltaInUnits;
            if (purposedLabelWidth < 1) {
                return;
            }
            if (purposedLabelWidth > element.getColspan() - 1) {
                return;
            }
            purposedLabelWidth = purposedLabelWidth === document.getProperty('options.labelWidthInUnits')
                ? null
                : purposedLabelWidth;
            element.setProperty('label.widthInUnits', purposedLabelWidth);
            if (element.isRenderingSupported()) {
                var currentRendererType = void 0;
                currentRendererType = element.getRendererType();
                if (undefined !== currentRendererType && null !== currentRendererType) {
                    element['rendererType'] = undefined;
                    element.setRendererType(currentRendererType);
                }
            }
            var elementParent = element.getParent();
            if (elementParent && ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER === elementParent.getTypeId()) {
                elementParent.updateLabelWidthInUnitsToChildNodes(purposedLabelWidth);
            }
        })(this.editor.getTheme(), this, this.editor.getDocument());
    };
    EditorCommandDispatcher.prototype.executePageUpgradeButtonOnClickCodeIfPossible = function () {
        (function ($) {
            var code = this.getPageUpgradeJavascriptCode();
            if (!code) {
                return;
            }
            eval(code);
        })(this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.getPageUpgradeJavascriptCode = function () {
        var upgradeLink = this.header.getModel().settings.upgradeLink.href;
        return upgradeLink.replace(/^javascript\:/, '');
    };
    EditorCommandDispatcher.prototype.executeDropOperation = function (elementTypeIdOrElement, dropReferenceElement, dropReferenceEdge, isDuplicateDropOperation, canDropInItself) {
        var _this = this;
        if (canDropInItself === void 0) { canDropInItself = false; }
        var previousElemensInSelectionBeforeDrop = this.editor.getLoader().getSelection().getItems();
        if ('number' !== typeof elementTypeIdOrElement && !(elementTypeIdOrElement instanceof FormElement)) {
            throw new Error('Invalid argument (elementTypeIdOrElement): number|IFormElement expected!');
        }
        if ('number' === typeof elementTypeIdOrElement) {
            if (elementTypeIdOrElement === ElementTypes.CONTROL_TYPE_COUPON) {
                if (!this.canAddAnotherCouponCode()) {
                    return;
                }
            }
            if (this.isPaywallRequired(elementTypeIdOrElement))
                return;
        }
        else {
            if (isDuplicateDropOperation) {
                for (var testCreateElements = elementTypeIdOrElement.flatten(), i = 0, len = testCreateElements.length; i < len; i++) {
                    try {
                        var elementTypeId = testCreateElements[i].getTypeId();
                        if (this.isPaywallRequired(elementTypeId))
                            return;
                    }
                    catch (e) {
                        console.error(e);
                        break;
                    }
                }
                if (elementTypeIdOrElement.getTypeId() === ElementTypes.CONTROL_TYPE_COUPON) {
                    if (!this.canAddAnotherCouponCode()) {
                        return;
                    }
                }
            }
        }
        if (!(dropReferenceElement instanceof FormElement)) {
            throw new Error('Invalid argument (dropReferenceElement): FormElement expected!');
        }
        if (EElementEdge.TOP !== dropReferenceEdge
            && EElementEdge.RIGHT !== dropReferenceEdge
            && EElementEdge.BOTTOM !== dropReferenceEdge
            && EElementEdge.LEFT !== dropReferenceEdge) {
            throw new Error('Invalid argument (dropReferenceEdge): EElementEdge expected!');
        }
        if (dropReferenceElement.getPreviousSibling() === elementTypeIdOrElement && dropReferenceEdge === EElementEdge.LEFT) {
            console.warn('drop: edge case: drop after itself');
            return;
        }
        if ('number' !== typeof elementTypeIdOrElement) {
            var cursor = dropReferenceElement;
            while (cursor.getTypeId() !== ElementTypes.ELEMENT_TYPE_FORM) {
                if (cursor === elementTypeIdOrElement && !canDropInItself) {
                    console.warn('drop: edge case: drop in itself');
                    return;
                }
                cursor = cursor.getParent();
            }
        }
        var dropElement = null;
        if (elementTypeIdOrElement === ElementTypes.CONTROL_TYPE_PAGE_BREAK
            && (dropReferenceEdge === EElementEdge.TOP || dropReferenceEdge === EElementEdge.BOTTOM)
            && (ElementTypes.CONTAINER_TYPE_ROW === dropReferenceElement.getTypeId())
            && (dropReferenceElement.getParent().getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE)) {
            dropReferenceElement.getParent().split(dropReferenceElement, dropReferenceEdge);
        }
        else {
            dropElement = 'number' === typeof elementTypeIdOrElement
                ? this.editor.createElement(elementTypeIdOrElement).setupDefaults()
                : isDuplicateDropOperation
                    ? elementTypeIdOrElement.cloneNode()
                    : elementTypeIdOrElement;
            if ('number' !== typeof elementTypeIdOrElement && isDuplicateDropOperation) {
                dropElement.onDuplicate();
            }
            var rowContainer = void 0, wrapContainer = void 0, tempBoolean = void 0, notificationTextForForbiddenDropInRepeatableContainer = dropElement.getElementName() +
                (this.i18n.translateText('edt_control_not_allowed_in_repeatable_text') !== 'edt_control_not_allowed_in_repeatable_text'
                    ? this.i18n.translateText('edt_control_not_allowed_in_repeatable_text')
                    : ' field cannot be added to a Repeatable Container.');
            if (dropReferenceElement.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE) {
                if (dropReferenceEdge === EElementEdge.TOP || dropReferenceEdge === EElementEdge.BOTTOM) {
                    rowContainer = this.editor.createElement(ElementTypes.CONTAINER_TYPE_ROW);
                    rowContainer.appendChild(dropElement);
                    switch (dropReferenceEdge) {
                        case EElementEdge.TOP:
                            dropReferenceElement.getParent().getParent().insertBefore(dropReferenceElement.getParent(), rowContainer);
                            break;
                        case EElementEdge.BOTTOM:
                            dropReferenceElement.getParent().getParent().insertAfter(dropReferenceElement.getParent(), rowContainer);
                            break;
                        default:
                            break;
                    }
                    rowContainer.withColspan(dropReferenceElement.getParent().getColspan());
                    dropElement.withColspan(rowContainer.getColspan());
                    var RCrowAction = appendControl(rowContainer);
                    this.store.dispatch(RCrowAction);
                }
                else {
                    switch (dropReferenceEdge) {
                        case EElementEdge.LEFT:
                            dropReferenceElement.getParent().insertBefore(dropReferenceElement, dropElement);
                            break;
                        case EElementEdge.RIGHT:
                            dropReferenceElement.getParent().insertAfter(dropReferenceElement, dropElement);
                            break;
                        default:
                            break;
                    }
                    if (dropReferenceElement.getParent().getTypeId() === ElementTypes.CONTAINER_TYPE_ROW) {
                        dropReferenceElement.getParent().makeElementsToFitColspanUsingTheFairResizingAlgorithm(dropReferenceElement.getParent().getColspan());
                    }
                }
                if (!dropElement.getId()) {
                    var RCcontrolAction = appendControl(dropElement);
                    this.store.dispatch(RCcontrolAction);
                }
            }
            else if ((dropReferenceElement.getTypeId() === ElementTypes.CONTAINER_TYPE_ROW
                && (dropReferenceEdge === EElementEdge.TOP || dropReferenceEdge === EElementEdge.BOTTOM)) || (tempBoolean = this.isDNDStrategy1(dropReferenceElement, dropReferenceEdge))) {
                if (dropReferenceElement.isChildOf(ElementTypes.CONTAINER_TYPE_REPEATABLE, true)
                    &&
                        this.isDropElementNotEligibleForDropInRepeatableContainer(dropElement)) {
                    this.loader.getUI().createNotification(notificationTextForForbiddenDropInRepeatableContainer, false, ENotificationStyle.DEFAULT);
                    return;
                }
                this.trackEvent('dnd_strategy_1');
                if (tempBoolean) {
                    dropReferenceElement = dropReferenceElement.getParent();
                }
                rowContainer = this.editor.createElement(ElementTypes.CONTAINER_TYPE_ROW);
                rowContainer.appendChild(dropElement);
                if (dropReferenceEdge === EElementEdge.TOP) {
                    dropReferenceElement.getParent().insertBefore(dropReferenceElement, rowContainer);
                }
                else {
                    dropReferenceElement.getParent().insertAfter(dropReferenceElement, rowContainer);
                }
                rowContainer.withColspan(dropReferenceElement.getParent().getColspan());
                dropElement.withColspan(rowContainer.getColspan());
                if (this.loader.getOpenInspectorOnInsert()) {
                    this.loader.execCommand('select-element', dropElement);
                }
                if (!dropElement.getId()) {
                    var rowAction = appendControl(rowContainer);
                    this.store.dispatch(rowAction);
                    var elementAction = appendControl(dropElement);
                    this.store.dispatch(elementAction);
                }
            }
            else if (dropReferenceElement.getTypeId() === ElementTypes.CONTAINER_TYPE_ROW
                && (dropReferenceEdge === EElementEdge.LEFT || dropReferenceEdge === EElementEdge.RIGHT)) {
                if (dropReferenceElement.isChildOf(ElementTypes.CONTAINER_TYPE_REPEATABLE, true)
                    &&
                        this.isDropElementNotEligibleForDropInRepeatableContainer(dropElement)) {
                    this.loader.getUI().createNotification(notificationTextForForbiddenDropInRepeatableContainer, false, ENotificationStyle.DEFAULT);
                    return;
                }
                this.trackEvent('dnd_strategy_2');
                if (dropReferenceElement.getChildren().length === 0) {
                    dropReferenceElement.appendChild(dropElement);
                    if (!dropElement.getId()) {
                        this.store.dispatch(appendControl(dropElement));
                    }
                }
                else {
                    if (dropReferenceEdge === EElementEdge.LEFT) {
                        dropReferenceElement.insertBefore(dropReferenceElement.getFirstChild(), dropElement);
                        if (!dropElement.getId()) {
                            this.store.dispatch(appendControl(dropElement));
                        }
                    }
                    else {
                        dropReferenceElement.insertAfter(dropReferenceElement.getLastChild(), dropElement);
                        if (!dropElement.getId()) {
                            this.store.dispatch(appendControl(dropElement));
                        }
                    }
                }
                dropReferenceElement.makeElementsToFitColspanUsingTheFairResizingAlgorithm(dropReferenceElement.getColspan());
            }
            else if ((dropReferenceElement.getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE) && (dropReferenceEdge === EElementEdge.TOP) && 0 === (dropReferenceElement.getChildren() || []).length) {
                console.warn('dnd: strategy 3');
                this.trackEvent('dnd_strategy_3_drop_inside_empty_page');
                rowContainer = this.editor.createElement(ElementTypes.CONTAINER_TYPE_ROW);
                rowContainer.appendChild(dropElement);
                dropReferenceElement.appendChild(rowContainer);
                rowContainer.withColspan(dropReferenceElement.getColspan());
                dropElement.withColspan(rowContainer.getColspan());
                this.store.dispatch(appendControl(rowContainer));
                this.store.dispatch(appendControl(dropElement));
            }
            else if ((dropReferenceElement.getElementKind() === EElementKind.CONTAINER && dropReferenceElement.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP)) {
                console.warn('dnd: strategy 6');
                if (dropReferenceElement.isChildOf(ElementTypes.CONTAINER_TYPE_REPEATABLE, true)
                    &&
                        this.isDropElementNotEligibleForDropInRepeatableContainer(dropElement)) {
                    this.loader.getUI().createNotification(notificationTextForForbiddenDropInRepeatableContainer, false, ENotificationStyle.DEFAULT);
                    return;
                }
                rowContainer = this.editor.createElement(ElementTypes.CONTAINER_TYPE_ROW);
                rowContainer.withColspan(dropReferenceElement.getColspan());
                rowContainer.appendChild(dropElement);
                dropElement.withColspan(dropReferenceElement.getColspan());
                dropReferenceElement.appendChild(rowContainer);
                this.store.dispatch(appendControl(rowContainer));
                this.store.dispatch(appendControl(dropElement));
            }
            else if ((dropReferenceElement.getElementKind() === EElementKind.CONTROL || dropReferenceElement.getTypeId() !== ElementTypes.CONTAINER_TYPE_ROW)
                && (dropReferenceEdge === EElementEdge.TOP || dropReferenceEdge === EElementEdge.BOTTOM)) {
                if (dropReferenceElement.isChildOf(ElementTypes.CONTAINER_TYPE_REPEATABLE, true)
                    &&
                        this.isDropElementNotEligibleForDropInRepeatableContainer(dropElement)) {
                    this.loader.getUI().createNotification(notificationTextForForbiddenDropInRepeatableContainer, false, ENotificationStyle.DEFAULT);
                    return;
                }
                console.warn('dnd: strategy 4');
                this.trackEvent('dnd_strategy_4_drop_inside_container');
                if (dropReferenceElement.getParent().getTypeId() !== ElementTypes.CONTAINER_TYPE_ROW) {
                    console.warn('DND: Unexpected edge case: The parent of the reference is not a ROW!');
                    return;
                }
                if (!(dropReferenceElement.getParent().getParent().getElementKind() === EElementKind.CONTAINER
                    && [
                        ElementTypes.CONTAINER_TYPE_PAGE,
                        ElementTypes.CONTAINER_TYPE_ROW,
                        ElementTypes.ELEMENT_TYPE_FORM,
                        ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP,
                    ].indexOf(dropReferenceElement.getParent().getParent().getTypeId()) === -1)) {
                    wrapContainer = this.editor.createElement(ElementTypes.CONTAINER_TYPE_DIV);
                    wrapContainer.withColspan(dropReferenceElement.getColspan());
                    rowContainer = this.editor.createElement(ElementTypes.CONTAINER_TYPE_ROW);
                    wrapContainer.appendChild(rowContainer);
                    dropReferenceElement.getParent().insertBefore(dropReferenceElement, wrapContainer);
                    rowContainer.appendChild(dropReferenceElement);
                    rowContainer.withColspan(dropReferenceElement.getColspan());
                }
                else {
                    console.warn('nowrap');
                }
                rowContainer = this.editor.createElement(ElementTypes.CONTAINER_TYPE_ROW);
                rowContainer.appendChild(dropElement);
                if (EElementEdge.TOP === dropReferenceEdge) {
                    dropReferenceElement.getParent().getParent().insertBefore(dropReferenceElement.getParent(), rowContainer);
                }
                else {
                    dropReferenceElement.getParent().getParent().insertAfter(dropReferenceElement.getParent(), rowContainer);
                }
                rowContainer.withColspan(rowContainer.getParent().getColspan());
                dropElement.withColspan(rowContainer.getColspan());
                if (!dropElement.getId()) {
                    this.store.dispatch(appendControl(rowContainer));
                    this.store.dispatch(appendControl(dropElement));
                }
            }
            else if (((dropReferenceElement.getElementKind() === EElementKind.CONTROL || dropReferenceElement.getTypeId() !== ElementTypes.CONTAINER_TYPE_ROW)
                && (dropReferenceEdge === EElementEdge.LEFT || dropReferenceEdge === EElementEdge.RIGHT))
                ||
                    ((dropReferenceElement.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE)
                        && (dropReferenceEdge === EElementEdge.LEFT || dropReferenceEdge === EElementEdge.RIGHT))) {
                if (dropReferenceElement.isChildOf(ElementTypes.CONTAINER_TYPE_REPEATABLE, true)
                    &&
                        this.isDropElementNotEligibleForDropInRepeatableContainer(dropElement)) {
                    this.loader.getUI().createNotification(notificationTextForForbiddenDropInRepeatableContainer, false, ENotificationStyle.DEFAULT);
                    return;
                }
                console.warn('dnd: strategy 5');
                this.trackEvent('dnd_strategy_5');
                if (dropReferenceEdge === EElementEdge.LEFT) {
                    dropReferenceElement.getParent().insertBefore(dropReferenceElement, dropElement);
                }
                else {
                    dropReferenceElement.getParent().insertAfter(dropReferenceElement, dropElement);
                }
                if (!dropElement.getId()) {
                    this.store.dispatch(appendControl(dropElement));
                }
                if (dropReferenceElement.getParent().getTypeId() === ElementTypes.CONTAINER_TYPE_ROW) {
                    dropReferenceElement.getParent().makeElementsToFitColspanUsingTheFairResizingAlgorithm(dropReferenceElement.getParent().getColspan());
                }
            }
            else {
                console.warn('dnd: no elected strategy');
            }
        }
        try {
            this.editor.getDocument().normalize();
        }
        catch (e) {
            setTimeout(function () {
                _this.editor.getDocument().normalize();
            }, 100);
        }
        if (!isDuplicateDropOperation && 'number' !== typeof elementTypeIdOrElement) {
            this.trackEvent('control_order');
        }
        if (!isDuplicateDropOperation && 'number' === typeof elementTypeIdOrElement) {
            this.trackEventOnElementAddOrDuplicateByElementId(elementTypeIdOrElement);
            this.trackEvent('control_insert_drag_and_drop');
            if (dropElement) {
                if (dropElement.getTypeId() === ElementTypes.CONTROL_TYPE_COUPON) {
                    this.trackEvent('payments_coupon_add');
                }
                if (dropElement.getTypeId() === ElementTypes.CONTROL_TYPE_FORMULA) {
                    this.trackEvent('payments_formula_add');
                }
            }
        }
        if (null !== dropElement && isDuplicateDropOperation) {
            var trackedEventName = dropElement.getRootNode().attributes['data-type'].value;
            this.trackEvent('control_duplicate_' + trackedEventName);
            this.trackEvent('control_duplicate_by_drag_' + trackedEventName);
            setTimeout(function () {
                _this.editor.getLoader().execCommand('select-element', dropElement);
            }, 10);
        }
        else {
            setTimeout(function () {
                if (previousElemensInSelectionBeforeDrop.length === 1) {
                    _this.editor.getLoader().execCommand('select-element', previousElemensInSelectionBeforeDrop[0]);
                }
            }, 10);
        }
    };
    EditorCommandDispatcher.prototype.selectElementsByMousePoints = function (pointA, pointB, addToExistingSelection) {
        if (!pointA || !pointB || 'number' !== typeof pointA.left || 'number' !== typeof pointB.left || 'number' !== typeof pointA.top || 'number' !== typeof pointB.top) {
            throw new Error('Illegal arguments: pointA and pointB must be of type IPoint');
        }
        var selectionClientRect = {
            left: Math.min(pointA.left, pointB.left),
            top: Math.min(pointA.top, pointB.top),
            width: Math.abs(pointA.left - pointB.left),
            height: Math.abs(pointA.top - pointB.top)
        };
        if (selectionClientRect.width === 0 || selectionClientRect.height === 0) {
            return;
        }
        (function (document, selection) {
            if (!addToExistingSelection) {
                selection.clear();
            }
            var elementClientRect;
            for (var i = 0, elements = document.flatten(), len = elements.length; i < len; i++) {
                if (elements[i].getElementKind() === EElementKind.CONTROL ||
                    elements[i].getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER ||
                    elements[i].getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE) {
                    elementClientRect = (function (clientRect) {
                        return {
                            left: clientRect.left,
                            top: clientRect.top,
                            width: clientRect.width,
                            height: clientRect.height,
                        };
                    })(elements[i].getRootNode().getBoundingClientRect());
                    if (elements[i].isSelectable() && FormUtils.rectangleIntersects(selectionClientRect, elementClientRect)) {
                        selection.add(elements[i]);
                    }
                }
            }
            if (!addToExistingSelection && selection.getLength() === 1) {
                document.setActiveElement(selection.getItems()[0]);
            }
        })(this.editor.getDocument(), this.loader.getSelection());
    };
    EditorCommandDispatcher.prototype.interactiveDisplaySelectionFeedbackByMousePoints = function (pointA, pointB) {
        if (!pointA || !pointB || 'number' !== typeof pointA.left || 'number' !== typeof pointB.left || 'number' !== typeof pointA.top || 'number' !== typeof pointB.top) {
            throw new Error('Illegal arguments: pointA and pointB must be of type IPoint');
        }
        var selectionClientRect = {
            left: Math.min(pointA.left, pointB.left),
            top: Math.min(pointA.top, pointB.top),
            width: Math.abs(pointA.left - pointB.left),
            height: Math.abs(pointA.top - pointB.top)
        };
        (function (document, $) {
            var elementClientRect, isInSelectionArea;
            for (var i = 0, elements = document.flatten(), len = elements.length; i < len; i++) {
                if (elements[i].isSelectable()) {
                    if (selectionClientRect.width === 0 || selectionClientRect.height === 0) {
                        isInSelectionArea = false;
                    }
                    else {
                        elementClientRect = (function (clientRect) {
                            return {
                                left: clientRect.left,
                                top: clientRect.top,
                                width: clientRect.width,
                                height: clientRect.height,
                            };
                        })(elements[i].getRootNode().getBoundingClientRect());
                        isInSelectionArea = FormUtils.rectangleIntersects(selectionClientRect, elementClientRect);
                    }
                    $(elements[i].getRootNode())[isInSelectionArea ? 'addClass' : 'removeClass']('selected');
                }
            }
        })(this.editor.getDocument(), this.loader.getJQuery());
    };
    EditorCommandDispatcher.prototype.mergePageByIndexWithNextPage = function (pageIndex) {
        var _this = this;
        var pageBefore = this.editor.getDocument().getPageByIndex(pageIndex), pageAfter = this.editor.getDocument().getPageByIndex(pageIndex + 1);
        if (!pageBefore || !pageAfter) {
            return;
        }
        pageBefore.mergeWith(pageAfter);
        setTimeout(function () {
            _this.editor.getDocument().repaginate();
        }, 100);
    };
    EditorCommandDispatcher.prototype.executeSelectionCommand = function (command) {
        (function (self, $, document, ui) {
            switch (command) {
                case 'delete-selection':
                    self.deleteSelection();
                    break;
                default:
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_unknown_inspector_command', 'Unknown inspector command'), self.getUiTranslatedString('edt_UI_alert_unknown_inspector_command_message', 'The command ' + JSON.stringify(command) + ' is unknown to the engine (might be not implemented)', JSON.stringify(command)));
                    break;
            }
        })(this, this.editor.getJQuery(), this.editor.getDocument(), this.editor.getLoader().getUI());
    };
    EditorCommandDispatcher.prototype.executeElementCommand = function (element, command) {
        (function (self, $, document, ui) {
            var activePanel;
            switch (command) {
                case 'delete-element':
                    self.deleteSelection();
                    break;
                case 'duplicate-element':
                    self.duplicateElement(element);
                    break;
                case 'edit-element':
                    if (!self.loader.getEditorPanelGroup().isVisible() || ((activePanel = self.loader.getEditorPanelGroup().getActivePanel()) && (activePanel.getId() !== 'item'))) {
                        self.loader.getEditorPanelGroup().setActivePanel('item');
                        self.loader.getEditorPanelGroup().setVisible(true);
                    }
                    else {
                        self.loader.getEditorPanelGroup().setVisible(false);
                    }
                    break;
                case 'move-up-element':
                    self.moveElement(element, EElementMoveDirection.UP);
                    break;
                case 'move-down-element':
                    self.moveElement(element, EElementMoveDirection.DOWN);
                    break;
                default:
                    ui.alert(self.getUiTranslatedString('edt_UI_alert_unknown_inspector_command', 'Unknown inspector command'), self.getUiTranslatedString('edt_UI_alert_unknown_inspector_command_message', 'The command ' + JSON.stringify(command) + ' is unknown to the engine (might be not implemented)', JSON.stringify(command)));
                    break;
            }
        })(this, this.editor.getJQuery(), this.editor.getDocument(), this.editor.getLoader().getUI());
    };
    EditorCommandDispatcher.prototype.addPerfectScrollbar = function (divToAddScollbar) {
        (function ($) {
            $(divToAddScollbar).css('overflow', 'auto');
            $(divToAddScollbar).perfectScrollbar({ minScrollbarLength: 10 });
            $(divToAddScollbar).bindEditorScrollEvents();
        })(this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.duplicateVirtualElement = function (element) {
        var elements = element.getElements();
        if (elements.length === 1) {
            this.duplicateNonVirtualElement(elements[0]);
            return;
        }
        if (elements.length < 2) {
            return;
        }
        var formElements = this.editor.getDocument().flatten();
        elements.sort(function (a, b) {
            var aPos = formElements.indexOf(a), bPos = formElements.indexOf(b);
            return aPos - bPos;
        });
        var document = this.editor.getDocument(), engine = this.editor, lastFormPage = document.getPageByIndex(document.getNumberOfPages() - 1), row, clone, clonedItems = [], selection = this.loader.getSelection();
        if (!lastFormPage) {
            return;
        }
        var formLabelWidthInUnits = document.getProperty('options.labelWidthInUnits'), duplicatedAtLeastOneElement = false;
        for (var i = 0, len = elements.length; i < len; i++) {
            try {
                var currentElementId = elements[i].getTypeId();
                if (this.isPaywallRequired(currentElementId))
                    break;
            }
            catch (e) {
                console.error(e);
                break;
            }
            row = engine.createElement(ElementTypes.CONTAINER_TYPE_ROW, undefined, document);
            clone = elements[i].cloneNode();
            clone.withColspan(row.getColspan());
            if (clone.hasProperty('label.widthInUnits')) {
                clone.setProperty('label.widthInUnits', formLabelWidthInUnits);
            }
            row.appendChild(clone);
            clonedItems.push(clone);
            lastFormPage.appendChild(row);
            clone.reRender();
            duplicatedAtLeastOneElement = true;
            var rowAction = appendControl(row);
            this.store.dispatch(rowAction);
            var controlWithRowAction = appendControl(clone);
            this.store.dispatch(controlWithRowAction);
        }
        if (duplicatedAtLeastOneElement) {
            selection.clear();
            for (var i = 0, len = clonedItems.length; i < len; i++) {
                clonedItems[i].onDuplicate();
                selection.add(clonedItems[i]);
            }
            document.normalize();
            clonedItems[0].getRootNode().scrollIntoView();
        }
    };
    EditorCommandDispatcher.prototype.duplicateNonVirtualElement = function (element) {
        if (!element.isAttached()) {
            return;
        }
        var elementTypeId = element.getTypeId();
        if (this.isPaywallRequired(elementTypeId))
            return;
        var elementParent = element.getParent(), elementParentRow, clonedElement = element.cloneNode();
        clonedElement.onDuplicate();
        if (elementParent.getTypeId() === ElementTypes.CONTAINER_TYPE_ROW) {
            elementParent = elementParent.getParent();
            elementParentRow = element.getForm().getEngine().createElement(ElementTypes.CONTAINER_TYPE_ROW);
            elementParent.insertAfter(element.getParent(), elementParentRow);
            elementParentRow.withColspan(element.getParent().getColspan());
            elementParentRow.appendChild(clonedElement);
            var rowAction = appendControl(elementParentRow);
            this.store.dispatch(rowAction);
            var controlWithRowAction = appendControl(clonedElement);
            this.store.dispatch(controlWithRowAction);
        }
        else {
            elementParent.insertAfter(element, clonedElement);
            var controlAction = appendControl(clonedElement);
            this.store.dispatch(controlAction);
        }
        this.editor.getDocument().normalize();
        this.editor.getLoader().execCommand('select-element', clonedElement);
    };
    EditorCommandDispatcher.prototype.duplicateElement = function (element) {
        if (!element) {
            return;
        }
        if (!element.isDuplicatable()) {
            return;
        }
        if (element.getTypeId() === ElementTypes.CONTROL_TYPE_COUPON) {
            if (!this.canAddAnotherCouponCode()) {
                return;
            }
        }
        this.loader.getUndoService().trigger('user-action', 'duplicate-element');
        if (element.getTypeId() === ElementTypes.VIRTUAL_SELECTION_CONTROL) {
            this.duplicateVirtualElement(element);
        }
        else {
            this.duplicateNonVirtualElement(element);
        }
        var trackedEventName = element.hasOwnProperty('elements')
            ? 'multiple-elements'
            : element.getRootNode().attributes['data-type'].value;
        this.trackEvent('control_duplicate_' + trackedEventName);
    };
    EditorCommandDispatcher.prototype.dispatchSettingPropertyChangeInInspector = function (document, panel, domNode, settingProperty) {
        var $ = this.editor.getJQuery(), settingId = $(panel).attr('data-target-setting-id'), propagateValueCSSSelector = domNode.hasAttribute('data-propagate-value-css-selector')
            ? domNode.getAttribute('data-propagate-value-css-selector') || null
            : null, propagateValueAttributeName = domNode.hasAttribute('data-propagate-value-attribute-name')
            ? domNode.getAttribute('data-propagate-value-attribute-name') || null
            : null;
        if (!settingId) {
            return;
        }
        var setting = document.getEditorSettingByTypeId(settingId), propertyName = $(domNode).closest('[data-property-name]').attr('data-property-name'), propertyType = $(domNode).closest('[data-property-type]').attr('data-property-type');
        if (!propertyName || !propertyType) {
            return;
        }
        var domNodeValue = domNode[settingProperty];
        if (domNode.hasAttribute('data-is-json-value')) {
            try {
                domNodeValue = domNodeValue !== ''
                    ? JSON.parse(String(domNodeValue || ''))
                    : null;
            }
            catch (e) {
                domNodeValue = null;
            }
        }
        this.updateEditorSettingProperty(setting, propertyName.replace(/-/g, '.'), propertyType, domNodeValue);
        if (propagateValueCSSSelector && propagateValueAttributeName) {
            $(propagateValueCSSSelector).each(function () {
                var _this = this;
                setTimeout(function () {
                    $(_this).trigger('attribute:propagate');
                }, 50);
            }).attr(propagateValueAttributeName, null === domNodeValue ? null : String(domNodeValue) || '');
        }
        this.trackEvent('change_setting_property', {}, 1000);
        this.loader.getUndoService().trigger('user-action', 'change-' + propertyName.replace(/-/g, '.'));
        this.loader.trigger('payments_summary_realtime_changed');
    };
    EditorCommandDispatcher.prototype.dispatchPropertyChangeInInspector = function (document, panel, domNode, elementProperty) {
        var $ = this.editor.getJQuery(), elementHash = $(panel).attr('data-target-element'), propagateValueCSSSelector = domNode.hasAttribute('data-propagate-value-css-selector')
            ? domNode.getAttribute('data-propagate-value-css-selector') || null
            : null, propagateValueAttributeName = domNode.hasAttribute('data-propagate-value-attribute-name')
            ? domNode.getAttribute('data-propagate-value-attribute-name') || null
            : null;
        if (!elementHash) {
            return;
        }
        var element = document.getElementByHash(elementHash), propertyName = $(domNode).closest('[data-property-name]').attr('data-property-name'), propertyType = $(domNode).closest('[data-property-type]').attr('data-property-type');
        if (!propertyName || !propertyType) {
            return;
        }
        var domNodeValue = domNode[elementProperty];
        if (domNode.hasAttribute('data-is-json-value')) {
            try {
                domNodeValue = domNodeValue !== ''
                    ? JSON.parse(String(domNodeValue || ''))
                    : null;
            }
            catch (e) {
                domNodeValue = null;
            }
        }
        this.updateElementProperty(element, propertyName.replace(/-/g, '.'), propertyType, domNodeValue);
        if (propagateValueCSSSelector && propagateValueAttributeName) {
            $(propagateValueCSSSelector).each(function () {
                var _this = this;
                setTimeout(function () {
                    $(_this).trigger('attribute:propagate');
                }, 50);
            }).attr(propagateValueAttributeName, null === domNodeValue ? null : String(domNodeValue) || '');
        }
        var trackedEventName = element.hasOwnProperty('elements')
            ? 'multiple-elements'
            : element.getRootNode().attributes['data-type'].value;
        this.trackEvent('change_control_property_' + trackedEventName, {}, 1000);
        this.loader.getUndoService().trigger('user-action', 'change-' + propertyName.replace(/-/g, '.'));
    };
    EditorCommandDispatcher.prototype.updateElementErrorsInInspectorPanel = function (element) {
        var allErrorDOMNodes = [], allDOMErrors = [], elementErrors = (element.getErrors() || []).slice(0), propertiesWithErrors = [];
        for (var i = 0, len = elementErrors.length; i < len; i++) {
            if (elementErrors[i].propertyName) {
                propertiesWithErrors.push(elementErrors[i].propertyName.replace('.', '-'));
            }
        }
        (function (self, $) {
            $('#item').each(function () {
                $(this).find('[data-role=property]').each(function () {
                    if (propertiesWithErrors.indexOf(this.getAttribute('data-property-name')) > -1) {
                        this.setAttribute('data-has-error', '');
                    }
                    else {
                        this.removeAttribute('data-has-error');
                    }
                });
                $(this).find('div[data-role=element-error]').each(function () {
                    allErrorDOMNodes.push(this);
                });
            });
            var currentError, isErrorFound;
            for (var i = 0, len = allErrorDOMNodes.length; i < len; i++) {
                currentError = {
                    code: ~~allErrorDOMNodes[i].getAttribute('data-error-code'),
                    message: null,
                };
                if (allErrorDOMNodes[i].hasAttribute('data-property-name')) {
                    currentError.propertyName = allErrorDOMNodes[i].getAttribute('data-property-name');
                }
                if (allErrorDOMNodes[i].hasAttribute('data-field-name')) {
                    currentError.fieldName = allErrorDOMNodes[i].getAttribute('data-field-name');
                }
                allDOMErrors.push(currentError);
                currentError['node'] = allErrorDOMNodes[i];
                isErrorFound = false;
                for (var j = 0, n = elementErrors.length; j < n; j++) {
                    if (elementErrors[j].code === currentError.code && elementErrors[j].fieldName === currentError.fieldName && elementErrors[j].propertyName === currentError.propertyName) {
                        if (elementErrors[j].isHTML) {
                            allErrorDOMNodes[i].innerHTML = elementErrors[j].message;
                        }
                        else {
                            allErrorDOMNodes[i].textContent = elementErrors[j].message;
                        }
                        isErrorFound = true;
                        elementErrors.splice(j, 1);
                        break;
                    }
                }
                if (!isErrorFound) {
                    allErrorDOMNodes[i].parentNode.removeChild(allErrorDOMNodes[i]);
                }
            }
            var itemGlobalErrorsDOMNode = document.getElementById('item-global-errors'), newErrorDOMNode;
            for (var i = 0, len = elementErrors.length; i < len; i++) {
                newErrorDOMNode = document.createElement('div');
                newErrorDOMNode.setAttribute('data-role', 'element-error');
                newErrorDOMNode.setAttribute('data-error-code', String(elementErrors[i].code));
                if (elementErrors[i].isHTML) {
                    newErrorDOMNode.innerHTML = elementErrors[i].message;
                }
                else {
                    newErrorDOMNode.textContent = String(elementErrors[i].message || '');
                }
                if (elementErrors[i].fieldName) {
                    newErrorDOMNode.setAttribute('data-field-name', elementErrors[i].fieldName);
                }
                if (elementErrors[i].propertyName) {
                    newErrorDOMNode.setAttribute('data-property-name', elementErrors[i].propertyName);
                    $('#item').find('div[data-role=property][data-property-name="' + (elementErrors[i].propertyName.replace(/\./g, '-')) + '"]').after(newErrorDOMNode);
                }
                else {
                    itemGlobalErrorsDOMNode.appendChild(newErrorDOMNode);
                }
            }
        })(this, this.editor.getJQuery());
    };
    EditorCommandDispatcher.prototype.resetScrollbarPosition = function (cssSelectorOrDOMNode) {
        this.editor.getJQuery()(cssSelectorOrDOMNode).perfectScrollbar("update");
    };
    EditorCommandDispatcher.prototype.displayPostMigrationNotification = function () {
        var _this = this;
        var formId = this.editor.getDocument().getId();
        if (window.localStorage.getItem('migrated_to_new_editor_' + formId) === '1') {
            window.localStorage.removeItem('migrated_to_new_editor_' + formId);
            var notificationText = this.loader.getI18n().translateText('edt_text_convert_to_new_form_confirmation');
            this.loader.getUI().createNotification(notificationText, false, ENotificationStyle.SUCCESS);
            this.loader.getJQuery()('a[data-role=import-legacy-themes-notification]').click(function () {
                _this.displayLegacyEditorThemesDialog();
            });
        }
    };
    EditorCommandDispatcher.prototype.displayReadonlySubuserCannotSave = function () {
        var formId = this.editor.getDocument().getId();
        var notificationText = this.loader.getI18n().translateText('edt_text_form_readonly');
        this.loader.getUI().createNotification(notificationText, false, ENotificationStyle.DEFAULT, false);
    };
    EditorCommandDispatcher.prototype.displayMigrationNotification = function () {
        if (!this.loader.getLoaderDependency(ELoaderDependency.SHOW_DOWNGRADE_NOTIFICATION)) {
            return;
        }
        var notification = this.loader.getUI().createNotification('<a data-role="downgrade-editor-with-backup" href="javascript:;">Revert to latest old editor version</a>'
            + ' or ' +
            '<a data-role="downgrade-editor" href="javascript:;">Migrate current version to old editor</a>', false, ENotificationStyle.DEFAULT, false);
        notification.setAttribute('data-is-regular-box', '1');
    };
    EditorCommandDispatcher.prototype.downgradeToOldEditor = function (restoreFromBackup) {
        (function (ui, self, $, formId) {
            var result = ui.createDialog(restoreFromBackup
                ? self.getUiTranslatedString('edt_UI_revert_old_editor', 'Revert to latest old editor version')
                :
                    self.getUiTranslatedString('edt_UI_migrate_old_editor', 'Migrate current version to old editor'), [
                {
                    callback: function () {
                        result.close();
                        $.post('/modules/EditorV2/ajax-upgrade-editor.php', {
                            'do': 'downgrade-editor',
                            'id': formId,
                            'restoreFromBackup': restoreFromBackup,
                        }).then(function () {
                            ui.closeAllNotifications();
                            window.location.reload(true);
                        }).fail(function () {
                            ui.alert(self.getUiTranslatedString('edt_UI_alert_error_downgrading', 'Error downgrading'), self.getUiTranslatedString('edt_UI_alert_error_downgrading_message', 'There was an error downgrading to previous editor version. Please try again later'));
                        });
                    },
                    type: EDialogButtonType.YES
                },
                {
                    callback: function () {
                        result.close();
                    },
                    type: EDialogButtonType.NO
                }
            ], {
                width: '500px',
            });
            result.setHTML(restoreFromBackup
                ? self.getUiTranslatedString('edt_UI_revert_old_editor_message', 'Are you sure you want to revert to latest old editor version?')
                : self.getUiTranslatedString('edt_UI_migrate_old_editor_message', 'Are you sure you want to migrate current version to the old editor?'));
        })(this.loader.getUI(), this, this.loader.getJQuery(), this.editor.getDocument().getId());
    };
    EditorCommandDispatcher.prototype.disableMigrationNotification = function () {
        (function (ui, self, $, formId) {
            ui.closeAllNotifications();
        })(this.loader.getUI(), this, this.loader.getJQuery(), this.editor.getDocument().getId());
    };
    EditorCommandDispatcher.prototype.isErrorStateNotification = function (notification) {
        return notification && notification.getAttribute('data-notification-role') === 'form-error-state-notification';
    };
    EditorCommandDispatcher.prototype.updateFormErrorStateNotification = function () {
        var currentNotification = this.loader.getUI().getCurrentNotification(), errorStateNotificationExists = this.isErrorStateNotification(currentNotification), formHasErrors = false;
        for (var items = this.editor.getDocument().flatten(), i = 0, len = items.length; i < len; i++) {
            if (null !== items[i].getErrors()) {
                formHasErrors = true;
                break;
            }
        }
        if (!formHasErrors) {
            for (var settings = this.editor.getDocument().getEditorSettings() || [], i = 0, len = settings.length; i < len; i++) {
                if (null !== settings[i].getErrors()) {
                    formHasErrors = true;
                    break;
                }
            }
        }
        if ((formHasErrors && errorStateNotificationExists) || (!formHasErrors && !errorStateNotificationExists)) {
            return;
        }
        if (formHasErrors) {
            this.loader.getUI().createNotification('There are errors on your form! Changes to fields highlighted in red won’t be saved until you fix the errors.', true, ENotificationStyle.ERROR, false).setAttribute('data-notification-role', 'form-error-state-notification');
        }
        else {
            if (errorStateNotificationExists) {
                this.loader.getUI().closeAllNotifications();
            }
        }
    };
    EditorCommandDispatcher.prototype.executeFormPostUnserializationActions = function () {
        if (localStorage) {
            var implicitSaveFormLocalStorageKeyAfterMigration = 'editor_v2_implicit_form_save_' + this.editor.getDocument().getId();
            if (localStorage.getItem(implicitSaveFormLocalStorageKeyAfterMigration)) {
                localStorage.removeItem(implicitSaveFormLocalStorageKeyAfterMigration);
                this.loader['saveDocumentInImmediateMode']();
            }
        }
    };
    EditorCommandDispatcher.prototype.trackEvent = function (eventName, tags, throttleTimeout) {
        if (undefined === throttleTimeout) {
            console.warn('Track event: ', eventName);
            window['CFTracker'] && window['CFTracker'].event(eventName, tags);
            this.insertTooltipIfNeeded(eventName);
            return;
        }
        if (tags === null
            || typeof tags !== 'object'
            || Object.keys(tags).length === 0) {
            tags = undefined;
        }
        var trackerIndexName = JSON.stringify({
            'eventName': eventName,
            'eventTags': tags,
            'throttleTimeout': throttleTimeout
        });
        var self = this;
        if (undefined === this.trackers[trackerIndexName]) {
            this.trackers[trackerIndexName] = Throttle.create(function () {
                console.warn('Track event: ', eventName);
                window['CFTracker'] && window['CFTracker'].event(eventName, tags);
                self.insertTooltipIfNeeded(eventName);
            }, throttleTimeout);
        }
        this.trackers[trackerIndexName]();
    };
    EditorCommandDispatcher.prototype.onThemeEnteringPreviewMode = function () {
        (function ($, self) {
            $('#theme-panel')
                .attr('data-allow-revert', null)
                .find('[data-role=vertical-content]')
                .each(function () {
                this.scrollTop = 0;
            })
                .find('.selected')
                .removeClass('selected');
            $('#theme-panel [data-role=current-theme]').each(function () {
                this.innerHTML = '';
                (function (destinationContainer) {
                    $('#options [data-role=theme-actions-panel] [data-role=theme]').each(function () {
                        var clone = this.cloneNode(true);
                        clone.setAttribute("data-theme-id", null);
                        $(clone).addClass('selected');
                        var menuButton = document.createElement('button');
                        menuButton.setAttribute("data-role", "menu-popup");
                        menuButton.setAttribute("data-menu-items", "[{'name': 'Apply to form', 'action': 'apply-theme', 'i18n-name': 'edt_theme_menu_apply_theme' },{ 'name': 'Save theme as...', 'action': 'save-theme', 'i18n-name': 'edt_theme_menu_save_theme' }]");
                        var icon = document.createElement('span');
                        icon.className = "i-md i123-more_vertical";
                        menuButton.appendChild(icon);
                        self.createMenuPopup(menuButton);
                        $(clone).find('.theme-name').append(menuButton);
                        destinationContainer.appendChild(clone);
                    });
                })(this);
            });
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.discardThemeChanges = function () {
        this.editor.getTheme().applyTheme(this.editor.getTheme().getThemeById(null));
        this.setActiveEditorPanel('options');
        this.loadThemePropertiesIntoPanel();
    };
    EditorCommandDispatcher.prototype.updateThemeThumbnailFont = function (fontFamily) {
        var element = this.editor.getJQuery()('#options [data-role=theme][data-theme-id] > .thumbnail > div:nth-child(5)').get(0);
        if (!element) {
            return;
        }
        var fontsManager = this.editor.getLoader().getLoaderDependency(ELoaderDependency.FONTS_MANAGER);
        if (fontsManager.isSystemFont(fontFamily)) {
            element.removeAttribute('class');
        }
        else {
            var fontInfo = fontsManager.getFontByName(fontFamily);
            if (fontInfo) {
                element.className = 'gf-123 ' + fontInfo.cssClassAaBbCc;
            }
            else {
                element.removeAttribute('class');
            }
        }
    };
    EditorCommandDispatcher.prototype.getUiTranslatedString = function (i18nKey, defaultText) {
        var _a;
        var i18nVars = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            i18nVars[_i - 2] = arguments[_i];
        }
        var textToTranslate;
        textToTranslate = (_a = this.i18n).translateText.apply(_a, __spreadArrays([i18nKey], i18nVars));
        return i18nKey && textToTranslate && textToTranslate !== i18nKey
            ? textToTranslate
            : defaultText;
    };
    EditorCommandDispatcher.prototype.reloadVisiblePanel = function () {
        console.log('update current panel');
        var currentPanel = this.loader.getEditorPanelGroup().getActivePanel(), currentPanelElementType = this.loader.getEditorPanelGroup().getActivePanel().getRootNode().getAttribute('data-target-element-type'), currentPanelElementTypeId = this.loader.getEditorPanelGroup().getActivePanel().getRootNode().getAttribute('data-target-setting-id');
        switch (currentPanel.getId()) {
            case 'options':
                this.loadThemePropertiesIntoPanel();
                break;
            case 'item':
                if (currentPanelElementType !== 'setting') {
                    this.onSelectionChanged();
                }
                else {
                    var setting = this.loader.getEngine().getDocument().getEditorSettingByTypeId(currentPanelElementTypeId);
                    this.loader.getEngine().getLoader().getCommandDispatcher().loadEditorSettingIntoPanel(setting);
                }
                break;
            case 'editor':
                break;
        }
    };
    EditorCommandDispatcher.prototype.displayNotificationForFinalizationPricesAndPaymentProviderIfNeeded = function () {
        var currentURL = UrlUtils.parse(window.location.href), queryParts = UrlUtils.parseQueryString((currentURL.search || '?').replace(/^\?/g, ''));
        if (queryParts.fromNewFormWizard && ~~queryParts.fromNewFormWizard === 1) {
            this.loader.getJQuery()(this.loader.getUI().createNotification('<span class="i-lg i123-notifications"></span>Make sure to finalize your <a href="javascript:;" data-role="finalize-prices">prices</a> &amp; <a href="javascript:;" data-role="finalize-payment-provider">payment provider</a> setup.<div class="close"></div>', false, ENotificationStyle.DEFAULT, false)).attr('data-notification-role', 'finalize-prices-notification')
                .on('click', 'a[data-role]', function () {
                var paymentsURL = window.location.href.replace('edit_fields', 'settings') + '&tab=4';
                var role = this.getAttribute('data-role');
                switch (role) {
                    case 'finalize-prices':
                        window.location.href = paymentsURL + '#field-setup-sheet';
                        break;
                    case 'finalize-payment-provider':
                        window.location.href = paymentsURL + '#payment-processors-sheet';
                        break;
                }
            });
        }
    };
    EditorCommandDispatcher.prototype.notifyTrackerWithUserTimeSpentOnEditor = function (isFirstTime) {
        var prefix = 'registered_user_';
        if (isFirstTime) {
            prefix = 'first_registration_';
        }
        this.trackEvent(prefix + '15_sec', {}, 15000);
        this.trackEvent(prefix + '30_sec', {}, 30000);
        this.trackEvent(prefix + '60_sec', {}, 60000);
        this.trackEvent(prefix + '120_sec', {}, 120000);
    };
    EditorCommandDispatcher.prototype.insertTooltipIfNeeded = function (eventName) {
        switch (eventName) {
            case 'control_insert':
                if (this.notificationTooltipManager.wasTooltipTriggered('welcome_to_editor_tooltip')
                    && !this.notificationTooltipManager.wasTooltipTriggered('rearrange_resieze_fields_tooltip')) {
                    this.notificationTooltipManager.showTooltip('rearrange_resieze_fields_tooltip');
                }
                break;
            case 'change_control_property':
            case 'control_resize':
                if (this.notificationTooltipManager.wasTooltipTriggered('rearrange_resieze_fields_tooltip')
                    && !this.notificationTooltipManager.wasTooltipTriggered('theme_panel_tooltip')) {
                    this.notificationTooltipManager.showTooltip('theme_panel_tooltip');
                }
                break;
            case 'themes_open':
            case 'registered_user_120_sec':
                if (this.notificationTooltipManager.wasTooltipTriggered('theme_panel_tooltip')
                    && !this.notificationTooltipManager.wasTooltipTriggered('publish_section_tooltip')) {
                    this.notificationTooltipManager.showTooltip('publish_section_tooltip');
                }
                break;
        }
    };
    EditorCommandDispatcher.prototype.initNotificationManager = function () {
        (function ($, self) {
            self.notificationTooltipManager.registerNotificationTooltip('welcome_to_editor_tooltip', new NotificationTooltip(self.loader.getUI(), function (ui, notificationTooltip) {
                var result = ui.createNotificationTooltip([
                    {
                        html: "<span data-role='button-text'>Ok, got it! </span><span data-role='button-icon'>&#x1F44D;</span>",
                        callback: function () {
                            result.persistentClose();
                        }
                    }
                ], {
                    placement: ENotificationTooltipPlacement.BOTTOM_RIGHT,
                    tooltipId: 'welcome_to_editor_tooltip',
                    tooltipType: ENotificationTooltipType.DEFAULT,
                    onCloseCallback: function () {
                        notificationTooltip.close();
                    }
                });
                result.tooltip.innerHTML = '<div data-role="tooltip-message">' +
                    '<b>Welcome to the form editor!</b> ' +
                    'Start by adding the fields you need. ' +
                    'Drag and drop them from the left panel directly onto your form. ' +
                    'Then click on any form field to customize it.' +
                    '</div>' +
                    '<img src="/images3/tooltips/tooltip_add_and_edit_field.gif"/>';
                result.tooltip.setAttribute('data-dialog-role', 'system-dialog');
                $(result.body).on('click', 'img', function () {
                    result.hide();
                    var imageResult = ui.createDialog(null, [], {
                        width: "540px",
                        height: "338px"
                    });
                    imageResult.setHTML('<img src="/images3/tooltips/tooltip_add_and_edit_field.gif"\>' +
                        '<span data-role="close-button"></span>');
                    $('.ui-modal').attr('data-dialog-role', 'image-container');
                    $(imageResult.dialog).on('click', 'span[data-role="close-button"]', function () {
                        imageResult.close();
                        result.show();
                    });
                });
                return result;
            }, 'welcome_to_editor_tooltip', self.loader.getUserId()));
            self.notificationTooltipManager.registerNotificationTooltip('rearrange_resieze_fields_tooltip', new NotificationTooltip(self.loader.getUI(), function (ui, notificationTooltip) {
                var result = ui.createNotificationTooltip([
                    {
                        text: "I’ll give it a try!",
                        callback: function () {
                            result.persistentClose();
                        }
                    }
                ], {
                    placement: ENotificationTooltipPlacement.BOTTOM_RIGHT,
                    tooltipId: 'rearrange_resieze_fields_tooltip',
                    tooltipType: ENotificationTooltipType.DEFAULT,
                    onCloseCallback: function () {
                        notificationTooltip.close();
                    }
                });
                result.tooltip.innerHTML = '<div data-role="tooltip-message">' +
                    'In case you were wondering — you can rearrange and resize fields.' +
                    '</div>' +
                    '<img src="/images3/tooltips/tooltip_move_and_resize.gif"/>' +
                    '<div data-role="tooltip-message">' +
                    'Just click-drag a field wherever you want to move it. ' +
                    'To resize it, hover over one of its edges, grab the blue ' +
                    'handle and drag it to the left or to the right.' +
                    '</div>';
                result.tooltip.setAttribute('data-dialog-role', 'system-dialog');
                $(result.body).on('click', 'img', function () {
                    result.hide();
                    var imageResult = ui.createDialog(null, [], {
                        width: "540px",
                        height: "338px"
                    });
                    imageResult.setHTML('<img src="/images3/tooltips/tooltip_move_and_resize.gif"\>' +
                        '<span data-role="close-button"></span>');
                    $('.ui-modal').attr('data-dialog-role', 'image-container');
                    $(imageResult.dialog).on('click', 'span[data-role="close-button"]', function () {
                        imageResult.close();
                        result.show();
                    });
                });
                return result;
            }, 'rearrange_resieze_fields_tooltip', self.loader.getUserId()));
            self.notificationTooltipManager.registerNotificationTooltip('theme_panel_tooltip', new NotificationTooltip(self.loader.getUI(), function (ui, notificationTooltip) {
                var result = ui.createNotificationTooltip([
                    {
                        text: "Okay!",
                        callback: function () {
                            result.persistentClose();
                        }
                    }
                ], {
                    placement: ENotificationTooltipPlacement.BOTTOM_RIGHT,
                    tooltipId: 'theme_panel_tooltip',
                    tooltipType: ENotificationTooltipType.DEFAULT,
                    onCloseCallback: function () {
                        notificationTooltip.close();
                    }
                });
                result.tooltip.innerHTML = '<div data-role="tooltip-message">' +
                    'Why not adjust the look of your form to match your taste? ' +
                    'Explore the design panel to change the layout, colors and fonts.' +
                    '</div>' +
                    '<img src="/images3/tooltips/tooltip_design_options.gif"/>';
                result.tooltip.setAttribute('data-dialog-role', 'system-dialog');
                $(result.body).on('click', 'img', function () {
                    result.hide();
                    var imageResult = ui.createDialog(null, [], {
                        width: "540px",
                        height: "338px"
                    });
                    imageResult.setHTML('<img src="/images3/tooltips/tooltip_design_options.gif"\>' +
                        '<span data-role="close-button"></span>');
                    $('.ui-modal').attr('data-dialog-role', 'image-container');
                    $(imageResult.dialog).on('click', 'span[data-role="close-button"]', function () {
                        imageResult.close();
                        result.show();
                    });
                });
                return result;
            }, 'theme_panel_tooltip', self.loader.getUserId()));
            self.notificationTooltipManager.registerNotificationTooltip('publish_section_tooltip', new NotificationTooltip(self.loader.getUI(), function (ui, notificationTooltip) {
                var result = ui.createNotificationTooltip([
                    {
                        text: "Alright!",
                        callback: function () {
                            result.persistentClose();
                        }
                    }
                ], {
                    placement: ENotificationTooltipPlacement.BOTTOM_RIGHT,
                    tooltipType: ENotificationTooltipType.DEFAULT,
                    tooltipId: 'publish_section_tooltip',
                    onCloseCallback: function () {
                        notificationTooltip.close();
                    }
                });
                result.tooltip.innerHTML = '<div data-role="tooltip-message">' +
                    'When you are ready with your form, hit <b>Publish</b>. ' +
                    'You can share the form\'s direct link or embed it in your website.' +
                    '</div>' +
                    '<img src="/images3/tooltips/tooltip_publish.gif"/>';
                result.tooltip.setAttribute('data-dialog-role', 'system-dialog');
                $(result.body).on('click', 'img', function () {
                    result.hide();
                    var imageResult = ui.createDialog(null, [], {
                        width: "540px",
                        height: "338px"
                    });
                    imageResult.setHTML('<img src="/images3/tooltips/tooltip_publish.gif"\>' +
                        '<span data-role="close-button"></span>');
                    $('.ui-modal').attr('data-dialog-role', 'image-container');
                    $(imageResult.dialog).on('click', 'span[data-role="close-button"]', function () {
                        imageResult.close();
                        result.show();
                    });
                });
                return result;
            }, 'publish_section_tooltip', self.loader.getUserId()));
            self.notificationTooltipManager.on('ready', function () {
                if (!self.notificationTooltipManager.wasTooltipTriggered('welcome_to_editor_tooltip')) {
                    self.notificationTooltipManager.showTooltip('welcome_to_editor_tooltip');
                }
            });
        }(this.loader.getJQuery(), this));
    };
    EditorCommandDispatcher.prototype.showHipaaDialog = function () {
        (function ($, self, engine, ui, formId) {
            engine.getResourceManager().get('/modules/Typescript/Form/resources/hipaa-popup.html')
                .then(function (dialogTemplateMarkup) {
                var template = new Salvage(dialogTemplateMarkup), hipaaCheckboxActiveTab = function (value, element) {
                    $('#save-checked-security-option').val(value);
                    $('.security-option').removeClass('focus-state');
                    $('.form-type-chosen').removeClass('focus-state');
                    element.addClass('focus-state');
                    element.find('.form-type-chosen').addClass('focus-state');
                    $('.new-editor-hipaa-popup-buttons').find('.btn-disabled').removeClass('btn-disabled');
                };
                var dialog = ui.createDialog('', [
                    {
                        type: EDialogButtonType.CONTINUE,
                        callback: function () {
                            var secureForm = $('#save-checked-security-option').val();
                            $.post('/modules/EditorV2/ajax-upgrade-editor.php', {
                                'do': 'changeFormhipaaShield',
                                'id': formId,
                                'secureForm': secureForm
                            }).then(function () {
                                dialog.close();
                                window.location.reload();
                            }).fail(function () {
                                dialog.close();
                                ui.alert(self.getUiTranslatedString('dialog_generic_error', 'Error'), self.getUiTranslatedString('dialog_hipaa_error_content', 'Something went wrong. Please contact us at support@123formbuilder.com'));
                            });
                        },
                    }
                ]);
                $(dialog.dialog)
                    .attr('data-dialog-role', 'hipaa-security-form-popup')
                    .attr('data-no-selected-choices', '');
                $(dialog.body).on('click', 'div.new-form-compliance-secure', function () {
                    $(dialog.dialog).attr('data-no-selected-choices', null);
                    hipaaCheckboxActiveTab(1, $(this));
                });
                $(dialog.body).on('click', 'div.new-form-compliance-regular', function () {
                    $(dialog.dialog).attr('data-no-selected-choices', null);
                    hipaaCheckboxActiveTab(0, $(this));
                });
                $(dialog.body).html(template.parse({}));
                self.i18n.translateDOMNode(dialog.body);
            })
                .fail(function () {
                ui.alert(self.getUiTranslatedString('dialog_generic_error', 'Error'), self.getUiTranslatedString('dialog_hipaa_error_content', 'Something went wrong. Please contact us at support@123formbuilder.com'));
            });
        })(this.editor.getJQuery(), this, this.editor, this.loader.getUI(), this.loader.getFormId());
    };
    EditorCommandDispatcher.prototype.repopulateCustomCSSPanelWithActualValues = function () {
        (function ($, self) {
            self.editor.getTheme().updateCustomFormCSSText();
            self.editor.getTheme().updateCustomFormCSSFromUrl();
            $('#theme-custom-css div[data-role=vertical-content]').each(function () {
                $(this).find('textarea[data-role=custom-css]').val(self.editor.getDocument().getConfiguration().getProperty('customCss'));
                $(this).find('input[data-role=custom-css-from-url]').val(self.editor.getDocument().getConfiguration().getProperty('customCssFromUrl'));
            });
            self.updatePreviousValueCustomCSS();
            self.updatePreviousValueCustomCSSURL();
        })(this.loader.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.updatePreviousValueCustomCSS = function () {
        var _this = this;
        (function ($) {
            var currentCustomInlineCss = _this.loader.getEngine().getDocument().getConfiguration().getProperty('customCss');
            $('#theme-custom-css textarea[data-role=custom-css]').attr(currentCustomInlineCss
                ? {
                    'data-previous-value': currentCustomInlineCss,
                    "value": currentCustomInlineCss
                }
                : {
                    'data-previous-value': '',
                    "value": ''
                });
        })(this.loader.getJQuery());
    };
    EditorCommandDispatcher.prototype.updatePreviousValueCustomCSSURL = function () {
        var _this = this;
        (function ($) {
            var currentCustomCSSUrl = _this.loader.getEngine().getDocument().getConfiguration().getProperty('customCssFromUrl');
            $('#theme-custom-css input[data-role=custom-css-from-url]')
                .attr(currentCustomCSSUrl
                ? {
                    "data-previous-value": currentCustomCSSUrl,
                    "value": currentCustomCSSUrl,
                }
                : {
                    "data-previous-value": '',
                    "value": '',
                });
        })(this.loader.getJQuery());
    };
    EditorCommandDispatcher.prototype.setCustomCssText = function (newCustomCssValue) {
        this.loader.getUndoService().trigger('user-action', 'Changed custom CSS');
        var formConfiguration = this.loader.getEngine().getDocument().getConfiguration();
        formConfiguration.withProperty('customCss', newCustomCssValue || '');
        this.loader.getEngine().getTheme().updateCustomFormCSSText();
        this.updatePreviousValueCustomCSS();
    };
    EditorCommandDispatcher.prototype.setCustomCssUrl = function (newCustomCssFromUrlValue) {
        var _this = this;
        FormUtils.isRealCSSUrl(newCustomCssFromUrlValue, this.loader.getEngine()).then(function (isReal) {
            _this.loader.getUndoService().trigger('user-action', 'Changed custom CSS');
            _this.loader.getEngine().getDocument().getConfiguration().withProperty('customCssFromUrl', isReal ? newCustomCssFromUrlValue : '');
            _this.updateCustomCSSErrorDOMNodes(!isReal, "custom-css-from-url");
            _this.loader.getEngine().getTheme().updateCustomFormCSSFromUrl();
            _this.updatePreviousValueCustomCSSURL();
        });
    };
    EditorCommandDispatcher.prototype.updateCustomCSSErrorDOMNodes = function (hasErrors, propertyName) {
        (function (loader, hasErrors, $) {
            var $propertyContainer = $("#theme-custom-css").find("div[data-property-name=" + propertyName + "]");
            if ($propertyContainer.find("input").val() === "" || !hasErrors) {
                $propertyContainer.find("span[data-error-span-in-inspector]").remove();
                $propertyContainer.removeAttr("data-property-has-errors");
            }
            else {
                if (hasErrors) {
                    if (!$propertyContainer.is("[data-property-has-errors='1']")) {
                        var spanError = document.createElement("span");
                        spanError.setAttribute('data-error-span-in-inspector', '1');
                        if (propertyName === "custom-css") {
                            spanError.textContent = loader.getI18n().translateText("edt_custom_css_error_invalid_css_text");
                        }
                        else {
                            spanError.textContent = loader.getI18n().translateText("edt_custom_css_error_invalid_url_text");
                        }
                        $propertyContainer.append(spanError);
                        $propertyContainer.attr("data-property-has-errors", "1");
                    }
                }
            }
        })(this.loader, hasErrors, this.loader.getJQuery());
    };
    EditorCommandDispatcher.prototype.saveExternalFormTheme = function (themeId) {
        return (function ($, theme, wixIdentity, formId) {
            return $.Deferred(function (defer) {
                try {
                    var externalTheme = theme.getExternalTheme();
                    if (externalTheme.getThemeStrategy() !== EThemeStrategy.WIX_THEME) {
                        throw new Error('Illegal method call. Saving wix external theme is possible only on wix when a theme is selected!');
                    }
                    if (!wixIdentity) {
                        throw new Error('Illegal method call. A wix environment is not detected!');
                    }
                    var themeData = externalTheme.enumerateProperties();
                    if (null !== wixIdentity && wixIdentity.compId && wixIdentity.instanceId) {
                        var ajaxEndpoint = "/modules/EditorV2/ajax/ajax-save-wix-theme-properties.php?form_id=" + formId
                            + "&instanceID=" + encodeURIComponent(wixIdentity.instanceId)
                            + "&compID=" + encodeURIComponent(wixIdentity.compId);
                        if (undefined !== themeId) {
                            ajaxEndpoint += "&themeID=" + encodeURIComponent(String(themeId))
                                + '&do=save-theme-id';
                        }
                        $.ajax({
                            type: "POST",
                            url: ajaxEndpoint,
                            data: {
                                "theme": btoa(JSON.stringify(themeData))
                            }
                        }).then(function (d) {
                            defer.resolve(true);
                        }).fail(function (e) {
                            defer.reject(e);
                        });
                    }
                    else {
                        defer.reject(new Error('Invalid wix identity.'));
                    }
                }
                catch (e) {
                    defer.reject(e);
                }
            }).promise();
        })(this.loader.getJQuery(), this.loader.getEngine().getTheme(), this.loader.getLoaderDependency(ELoaderDependency.WIX_AUTHORIZED_REQUEST_DETAILS), this.loader.getFormId());
    };
    EditorCommandDispatcher.prototype.addSetting = function (settingTypeId) {
        if (this.editor.getDocument().hasEditorSetting(settingTypeId)) {
            throw new Error('Setting ' + JSON.stringify(settingTypeId) + ' already added!');
        }
        var factory = this.editor.getFactory();
        var setting = factory.createEditorSettingByTypeId(settingTypeId, this.editor.getDocument());
        if (!this.userService.canEnableFormPayments()) {
            this.triggerPaywall(EUpgradeReason.PAYMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN, setting.getTypeId());
            return;
        }
        this.loader.getUndoService().trigger('user-action', 'Add editor setting "' + settingTypeId + '"');
        this.editor.getDocument().withEditorSetting(setting);
        if (setting.getGroupTypeId() === EditorSettingGroups.PAYMENT_PROCESSORS) {
            this.trackEvent('payments_processor_add', { 'name': setting.getConfiguration()['name'] });
            this.trackFirstProcessorAdded();
        }
        if (this.loader.getOpenInspectorOnInsert() && settingTypeId !== EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING) {
            this.loadEditorSettingIntoPanel(setting);
        }
    };
    EditorCommandDispatcher.prototype.updateEditorSettingsPanel = function (scrollIntoView) {
        if (scrollIntoView === void 0) { scrollIntoView = true; }
        var settingsPanelDOMNode = this.loader.getLoaderDependency(ELoaderDependency.EDITOR_SETTINGS_PANEL), formSettings = this.editor.getDocument().getEditorSettings(), isSandboxEnabled = this.editor.getDocument().getConfiguration().getProperty('isPaymentSandboxEnabled'), isPaymentSummaryOnForm = !this.loader.getSummarySettingProperty('showSummaryAfterSubmit'), isSettingsPanelVisible = false, temp = {}, model = {
            "settings": []
        }, formDOMNode;
        for (var i = 0, len = formSettings.length; i < len; i++) {
            if (formSettings[i].isVisible()) {
                isSettingsPanelVisible = true;
                var settingGroup = formSettings[i].getGroupTypeId();
                if (undefined === temp[settingGroup]) {
                    temp[settingGroup] = [];
                }
                var config = FormUtils.clone(formSettings[i].getConfiguration());
                config['isEnabled'] = formSettings[i].hasProperty('isEnabled')
                    ? formSettings[i].getProperty('isEnabled')
                    : true;
                config['hasErrors'] = formSettings[i].hasErrors();
                temp[settingGroup].push(config);
            }
        }
        formDOMNode = this.editor.getDocument().getRootNode();
        if (!isSettingsPanelVisible) {
            formDOMNode.removeAttribute('data-has-settings');
            settingsPanelDOMNode.textContent = '';
            return;
        }
        for (var settingGroupTypeId in temp) {
            if (temp.hasOwnProperty(settingGroupTypeId)) {
                temp[settingGroupTypeId].sort(function (a, b) {
                    return a.index - b.index;
                });
                var groupTypeName = EditorSettingGroups.getGroupLabelTextByGroupTypeId(settingGroupTypeId), groupTypeI18nName = EditorSettingGroups.getGroupLabelI18nTextByGroupTypeId(settingGroupTypeId);
                if (settingGroupTypeId === EditorSettingGroups.PAYMENT_PROCESSORS && isSandboxEnabled) {
                    groupTypeName = EditorSettingGroups.getGroupLabelTextByGroupTypeId(EditorSettingGroups.PAYMENT_PROCESSORS_SANDBOX);
                    groupTypeI18nName = EditorSettingGroups.getGroupLabelI18nTextByGroupTypeId(EditorSettingGroups.PAYMENT_PROCESSORS_SANDBOX);
                }
                if (settingGroupTypeId !== EditorSettingGroups.PAYMENT_SETTINGS) {
                    model.settings.push({
                        groupTypeId: settingGroupTypeId,
                        groupTypeName: groupTypeName,
                        groupI18nName: groupTypeI18nName,
                        index: EditorSettingGroups.getGroupSortIndex(settingGroupTypeId),
                        settings: temp[settingGroupTypeId],
                    });
                }
            }
        }
        model.settings.sort(function (a, b) {
            return a.index - b.index;
        });
        (function (resourceManager, self) {
            resourceManager.get('/modules/Typescript/Form/resources/editor-settings-panel.html')
                .then(function (templateString) {
                var template = new Salvage(templateString);
                settingsPanelDOMNode.innerHTML = template.parse(model);
                self.i18n.translateDOMNode(settingsPanelDOMNode);
                formDOMNode.setAttribute('data-has-settings', '');
                if (scrollIntoView) {
                    settingsPanelDOMNode.scrollIntoView();
                }
            })
                .fail(function (e) {
                settingsPanelDOMNode.innerHTML = 'FAILED TO LOAD SETTINGS PANEL RESOURCE!';
                formDOMNode.setAttribute('data-has-settings', '');
                if (scrollIntoView) {
                    settingsPanelDOMNode.scrollIntoView();
                }
            });
            if (scrollIntoView) {
                settingsPanelDOMNode.scrollIntoView();
            }
        })(this.editor.getResourceManager(), this);
    };
    EditorCommandDispatcher.prototype.updateSettingErrorStateInEditorSettingsPanel = function (setting) {
        (function ($, self) {
            $(self.loader.getLoaderDependency(ELoaderDependency.EDITOR_SETTINGS_PANEL)).find('[data-role=setting][data-type-id="' + setting.getTypeId() + '"]').each(function () {
                if (setting.getErrors() === null) {
                    this.removeAttribute('data-has-errors');
                }
                else {
                    this.setAttribute('data-has-errors', '');
                }
            });
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.deleteEditorSetting = function (settingTypeId) {
        if (!settingTypeId) {
            return;
        }
        var setting = this.editor.getDocument().getEditorSettingByTypeId(settingTypeId);
        (function ($, self) {
            self.loader.getUI().prompt('Delete Form Setting', 'Are you sure you want to remove setting "' + setting.getConfiguration().name + '" from your form?', function () {
                self.loader.getUndoService().trigger('user-action', 'delete-setting-' + settingTypeId);
                self.editor.getDocument().removeEditorSetting(setting);
                if (setting.getGroupTypeId() === EditorSettingGroups.PAYMENT_PROCESSORS) {
                    self.trackEvent('payments_processor_delete', { 'name': setting.getConfiguration()['name'] });
                }
            });
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.enableEditorSetting = function (settingTypeId) {
        if (!settingTypeId) {
            return;
        }
        var setting = this.editor.getDocument().getEditorSettingByTypeId(settingTypeId);
        this.loader.getUndoService().trigger('user-action', 'enable-setting-' + settingTypeId);
        this.editor.getDocument().toggleEditorSettingEnabledState(setting);
        this.loadEditorSettingIntoPanel(setting);
        if (setting.getGroupTypeId() === EditorSettingGroups.PAYMENT_PROCESSORS) {
            this.trackEvent('payments_processor_enabled_intention', { 'name': setting.getConfiguration()['name'] });
        }
    };
    EditorCommandDispatcher.prototype.disableEditorSetting = function (settingTypeId) {
        if (!settingTypeId) {
            return;
        }
        var setting = this.editor.getDocument().getEditorSettingByTypeId(settingTypeId);
        this.loader.getUndoService().trigger('user-action', 'disable-setting-' + settingTypeId);
        this.editor.getDocument().toggleEditorSettingEnabledState(setting);
        this.loadEditorSettingIntoPanel(setting);
        if (setting.getGroupTypeId() === EditorSettingGroups.PAYMENT_PROCESSORS) {
            this.trackEvent('payments_processor_disabled', { 'name': setting.getConfiguration()['name'] });
        }
    };
    EditorCommandDispatcher.prototype.executeEditorSettingCommand = function (editorSettingTypeId, command) {
        switch (command) {
            case 'delete-element':
                this.deleteEditorSetting(editorSettingTypeId);
                break;
            case 'open-products-dialog':
                PaymentsProductsDialog.openFromExternalSource();
                break;
            case 'enable-element':
                this.enableEditorSetting(editorSettingTypeId);
                break;
            case 'disable-element':
                this.disableEditorSetting(editorSettingTypeId);
                break;
            case 'connect-element':
                this.oAuth.connect(editorSettingTypeId);
                break;
            case 'disconnect-element':
                this.oAuth.disconnect(editorSettingTypeId);
                break;
        }
    };
    EditorCommandDispatcher.prototype.executeProactiveChatJavascriptCode = function (result) {
        if (!result) {
            return;
        }
        result = result.replace(/(^[\s]+?<script[^>]+>|<\/script>[\s]+?$)/g, '');
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.textContent = '(function(){' + result + '})()';
        document.getElementsByTagName('head')[0].appendChild(script);
    };
    EditorCommandDispatcher.prototype.canAddAnotherCouponCode = function () {
        for (var controls = this.editor.getDocument().getControlsList(), i = 0, len = controls.length; i < len; i++) {
            if (controls[i].getTypeId() === ElementTypes.CONTROL_TYPE_COUPON) {
                this.editor.getLoader().getUI().alert('Failed to add field', 'There can be only a single coupon code control in the form');
                return false;
            }
        }
        return true;
    };
    EditorCommandDispatcher.prototype.updateMobileItemEditorPanel = function () {
        (function ($, self, resourceManager) {
            var itemEditingCapabilities = [];
            var resource = '/modules/Typescript/Form/resources/mobile-item-editor.html';
            var itemEditorPanelDOMNode = self.loader.getEditorPanelGroup().getPanelById('item').getRootNode(), targetEditingElementHash, model = {};
            var isPaymentProcessor = itemEditorPanelDOMNode.getAttribute('data-target-element-type') === 'setting';
            if (!(targetEditingElementHash = itemEditorPanelDOMNode.getAttribute('data-target-element'))) {
                model.isEmpty = true;
            }
            else {
                $(itemEditorPanelDOMNode).find('[data-role=editing-capabilities] button[data-role]').each(function () {
                    itemEditingCapabilities.push(this.getAttribute('data-role'));
                });
                model.targetElementHash = targetEditingElementHash;
                if (itemEditingCapabilities.length) {
                    model.deleteAction = itemEditingCapabilities.indexOf('delete-element') > -1;
                    model.duplicateAction = itemEditingCapabilities.indexOf('duplicate-element') > -1;
                    model.moveElementAction = model.deleteAction || model.duplicateAction;
                }
            }
            if (isPaymentProcessor) {
                var typeId = itemEditorPanelDOMNode.getAttribute('data-target-setting-id');
                resource = '/modules/Typescript/Form/resources/mobile-item-editor-setting.html';
                model.isEmpty = false;
                model.typeId = typeId;
            }
            if (!model.isEmpty) {
                resourceManager.get(resource).then(function (templateMarkup) {
                    var tpl = new Salvage(templateMarkup);
                    $('#mobile-item-editor-toolbar').attr('data-visible', '1').html(tpl.parse(model));
                });
            }
            else {
                $('#mobile-item-editor-toolbar').removeAttr('data-visible');
            }
        })(this.loader.getJQuery(), this, this.editor.getResourceManager());
    };
    EditorCommandDispatcher.prototype.moveElement = function (element, direction) {
        var accept = function (e) {
            if (!e) {
                return false;
            }
            if (e.getElementKind() === EElementKind.CONTROL) {
                if ([
                    ElementTypes.CONTROL_TYPE_SEPARATOR,
                    ElementTypes.CONTROL_TYPE_PAGE_BREAK,
                    ElementTypes.CONTROL_TYPE_CAPTCHA,
                    ElementTypes.CONTROL_TYPE_FORM_HEADER,
                    ElementTypes.CONTROL_TYPE_LIKERT_SCALE,
                    ElementTypes.CONTROL_TYPE_ACTION_BAR,
                    ElementTypes.VIRTUAL_SELECTION_CONTROL
                ].indexOf(e.getTypeId()) === -1) {
                    return true;
                }
            }
            else if (e.getElementKind() === EElementKind.CONTAINER) {
                if (e.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                    return true;
                }
            }
            return false;
        };
        if (!accept(element)) {
            return;
        }
        if (element.getElementKind() === EElementKind.CONTAINER && element.getTypeId() !== ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
            return;
        }
        var formElements = this.editor.getDocument().flatten(), numElements = formElements.length, myElementIndex = formElements.indexOf(element), targetElement;
        if (-1 === myElementIndex) {
            console.warn('Assertion: I DID NOT FIND MYSELF IN FORM FLATTENED LIST!');
            return;
        }
        while (true) {
            if (direction === EElementMoveDirection.UP) {
                myElementIndex--;
                if (myElementIndex < 0) {
                    return;
                }
            }
            else {
                if (direction === EElementMoveDirection.DOWN) {
                    myElementIndex++;
                    if (myElementIndex >= numElements) {
                        return;
                    }
                }
                else {
                    return;
                }
            }
            if (accept(formElements[myElementIndex]) && formElements[myElementIndex].getParent() !== element.getParent()) {
                targetElement = formElements[myElementIndex];
                break;
            }
        }
        this.executeDropOperation(element, targetElement, direction === EElementMoveDirection.DOWN
            ? EElementEdge.BOTTOM
            : EElementEdge.TOP, false);
    };
    EditorCommandDispatcher.prototype.resetUsedChoicesOnElement = function (element) {
        var choices = JSON.parse(JSON.stringify(element.getProperty('choices.values'))), choicesHasBeenReset = false;
        for (var i = 0, len = choices.length; i < len; i++) {
            if (choices[i].numberOfTimesThisOptionHasBeenChosen === -1) {
                choices[i].numberOfTimesThisOptionHasBeenChosen = 0;
                choicesHasBeenReset = true;
            }
        }
        if (choicesHasBeenReset) {
            element.setProperty('choices.values', choices);
        }
    };
    EditorCommandDispatcher.prototype.publishFormOnWeebly = function (formId, publishMethod, publishOptions) {
        var myFormsViewType = 'default', defaultPublishMethod = EPublishEmbedType.JAVASCRIPT, defaultPublishOptions = '';
        publishMethod = publishMethod || defaultPublishMethod;
        publishOptions = JSON.stringify(publishOptions) || defaultPublishOptions;
        return (function ($, self) {
            $.ajax({
                url: '/ajax_save_formsettings.php',
                type: 'POST',
                data: {
                    'modulename': 'weebly.php',
                    'someaction': 'update_site_id_with_form_id',
                    'form_id': formId,
                    'embed_method': publishMethod,
                    'embed_options': publishOptions,
                    'view_type': myFormsViewType,
                    'ajax_load': 1,
                }
            }).done(function () {
                var dialog = self.loader.getUI().createDialog('Form published', [
                    {
                        type: EDialogButtonType.KEEP_EDITING_FORM,
                        callback: function () {
                            dialog.close();
                        }
                    },
                    {
                        type: EDialogButtonType.CLOSE_EDITOR,
                        callback: function () {
                            window.parent.postMessage({ action: "dialog:close" }, '*');
                            dialog.close();
                        }
                    }
                ], {
                    width: '450px'
                });
                dialog.setHTML(self.i18n.translateText('userStepByStep_description_done_3'));
            }).fail(function () {
                self.loader.getUI().alert('Error publishing on Weebly', 'There was a problem with your request. Couldn\'t publish on weebly.');
            });
        })(this.loader.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.loadTranslationsPanel = function (translationsPanel, doneCallback) {
        (function (self, resourceManager, $, ui, api) {
            $.when(resourceManager
                .get('/modules/Typescript/Form/resources/translations-panel.html')
                .fail(function (e) {
                ui.alert('Error loading component', 'There was an error loading the translations panel. Please try again. If the problem persist, please contact our support team');
            }), api.GET('/v2/language/' + self.loader.getFormId())
                .fail(function (e) {
                ui.alert('Error loading component', 'There was an error enumerating your form translations. Please try again. If the problem persist, please contact our support team');
            }), TranslationsService.getLanguagesList()).then(function (templateHTMLText, installedFormLanguages, supportedFormLanguages) {
                self.loader
                    .getFormTranslationsService()
                    .setSupportedFormLanguages(supportedFormLanguages)
                    .setAvailableFormLanguages(installedFormLanguages.data);
                var tpl = new Salvage(templateHTMLText);
                var model = {
                    isBuilderSidebarExperiment: self.features.getInstance().isBuilderSidebarExperimentActive()
                };
                translationsPanel.getRootNode().innerHTML = tpl.parse(model);
                self.addPerfectScrollbar($(translationsPanel.getRootNode()).find('> [data-role=vertical-content]').get(0));
                var editor = new TranslationsEditor($(translationsPanel.getRootNode()).find('[data-role=add-translation]').get(0), $(translationsPanel.getRootNode()).find('[data-role=languages-container]').get(0), self.loader.getFormTranslationsService(), $, ui, resourceManager, api, self.loader);
                $(translationsPanel.getRootNode()).on('click', '[data-role=translations-actions] button[data-role]', function () {
                    editor.dispatchButtonClick(this.getAttribute('data-role'));
                });
                doneCallback();
            });
        })(this, this.editor.getResourceManager(), this.loader.getJQuery(), this.loader.getUI(), this.loader.getAPI());
    };
    EditorCommandDispatcher.prototype.refreshPaymentsAvailabilityStatus = function () {
        var document = this.loader.getEngine().getDocument();
        var processorsSettingIds = EditorSettingGroups.getGroupSettingTypeIds(EditorSettingGroups.PAYMENT_PROCESSORS);
        var status = false;
        for (var i = 0, len = processorsSettingIds.length; i < len; i++) {
            if (document.hasEditorSetting(processorsSettingIds[i]) && document.getEditorSettingByTypeId(processorsSettingIds[i]).getProperty('isEnabled') === true) {
                status = true;
                break;
            }
        }
        var action = updatePaymentActiveState(status);
        this.store.dispatch(action);
        this.loader.trigger('payments_status_changed');
        document.getConfiguration().withProperty('isPaymentEnabled', status);
    };
    EditorCommandDispatcher.prototype.displayLegacyEditorThemesDialog = function () {
        var _this = this;
        var dialog = this.loader.getUI().createDialog(this.i18n.translateText('edt_text_old_editor_themes'), [
            {
                type: EDialogButtonType.IMPORT,
                callback: function () {
                    var selectedThemeId = parseInt($(dialog.body).find('tbody tr.selected').attr('data-theme-id'));
                    if (!selectedThemeId || isNaN(selectedThemeId)) {
                        return;
                    }
                    _this.loader.getAPI().GET('/v2/editor/themes/legacy/' + selectedThemeId)
                        .then(function (themeInNewEditorFormat) {
                        _this.loader.getEngine().getTheme().applyTheme(themeInNewEditorFormat);
                        _this.loadThemePropertiesIntoPanel();
                        _this.loader.getEngine().getTheme().enterEditMode();
                        _this.setActiveEditorPanel('options');
                        dialog.close();
                        _this.loader.getUI().alert('Theme successfully imported', 'Theme "' + themeInNewEditorFormat.name + '" was applied successfully');
                    })
                        .fail(function (e) {
                        this.loader.getUI().alert('Error fetching legacy theme from server', 'There was an error while trying to fetch the selected legacy ' +
                            'theme from server. Please retry. If the problem persist, contact our support team');
                    });
                }
            },
            {
                type: EDialogButtonType.CANCEL,
                callback: function () {
                    dialog.close();
                }
            }
        ], {
            width: "500px",
            height: "500px",
        });
        dialog.body.innerHTML = "<div data-role=\"loader\">\n                                    <div data-role=\"loading-bar\"></div>\n                                    <div data-role=\"loading-bar\"></div>\n                                    <div data-role=\"loading-bar\"></div>\n                                </div>";
        (function (self, resourceManager, api, ui, dialog, $) {
            $.when(resourceManager.get('/modules/Typescript/Form/resources/legacy-editor-themes-dialog.html')
                .fail(function (e) {
                ui.alert('Failed to load UI component from server', 'There was an error loading legacy themes dialog from server. Please retry. If the problem persist, contact our support team');
            }), api.GET('/v2/editor/themes/legacy')
                .fail(function (e) {
                ui.alert('Failed to load legacy themes list from server', 'There was an error loading legacy themes list from server. Please retry. If the problem persist, contact our support team');
            })).then(function (resourceHTMLText, apiLegacyThemesResponse) {
                var template = new Salvage(resourceHTMLText), model = FormUtils.clone(apiLegacyThemesResponse);
                self.addPerfectScrollbar(dialog.body);
                dialog.body.innerHTML = template.parse(model);
                dialog.dialog.setAttribute('data-dialog-role', 'legacy-themes');
                $(dialog.body).on('click', 'table tbody tr', function () {
                    $(this).addClass('selected').siblings().removeClass('selected');
                });
            }).fail(function (e) {
            });
        })(this, this.loader.getEngine().getResourceManager(), this.loader.getAPI(), this.loader.getUI(), dialog, this.loader.getJQuery());
    };
    EditorCommandDispatcher.prototype.isDropElementNotEligibleForDropInRepeatableContainer = function (dropElement) {
        var elementType = dropElement.getTypeId(), forbiddenControlTypes = [
            ElementTypes.CONTROL_TYPE_MAP,
            ElementTypes.CONTROL_TYPE_PAGE_BREAK,
            ElementTypes.CONTROL_TYPE_IMAGE,
            ElementTypes.CONTROL_TYPE_WIDGET_VIDEO,
            ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK,
            ElementTypes.CONTROL_TYPE_WIDGET_PDF,
            ElementTypes.CONTROL_TYPE_SOCIAL,
            ElementTypes.CONTROL_TYPE_FILE
        ];
        var isPrefillInNestedRepeatableActive = this.loader.getControlsThatHaveRepeatablePathsAddedToPrefillValue().length > 0;
        if (!isPrefillInNestedRepeatableActive) {
            forbiddenControlTypes.push(ElementTypes.CONTAINER_TYPE_REPEATABLE);
        }
        if (forbiddenControlTypes.indexOf(elementType) > -1) {
            return true;
        }
        return false;
    };
    EditorCommandDispatcher.prototype.initializeDocumentFromOCRData = function (ocrData) {
        var doc = this.editor.getDocument();
        if (doc.getNumberOfPages() != 1) {
            return;
        }
        if (doc.getPageByIndex(0).flatten().length != 1) {
            return;
        }
        for (var i = 1, numPages = ocrData.children.length; i < numPages; i++) {
            var newPage = this.editor.getFactory().createItemByTypeId(ElementTypes.CONTAINER_TYPE_PAGE, doc);
            doc.appendChild(newPage);
            newPage.onCreated();
        }
        doc.repaginateInImmediateMode();
        doc.renderPageHeadersInImmediateMode();
        for (var pageIndex = 0, numPages = ocrData.children.length; pageIndex < numPages; pageIndex++) {
            var page = doc.getChildren()[pageIndex];
            for (var rowIndex = 0, numRows = ocrData.children[pageIndex].rows.length; rowIndex < numRows; rowIndex++) {
                var row = this.editor.getFactory().createItemByTypeId(ElementTypes.CONTAINER_TYPE_ROW, doc);
                for (var controlIndex = 0, numControlsPerRow = ocrData.children[pageIndex].rows[rowIndex].length; controlIndex < numControlsPerRow; controlIndex++) {
                    var control = this.editor.getFactory().createItemByTypeId(ocrData.children[pageIndex].rows[rowIndex][controlIndex].typeId, doc);
                    control.withColspan(ocrData.children[pageIndex].rows[rowIndex][controlIndex].colspan);
                    switch (true) {
                        case control.hasProperty('label.labelText'):
                            control.setProperty('label.labelText', ocrData.children[pageIndex].rows[rowIndex][controlIndex].text);
                            break;
                        case control.hasProperty('configuration.innerHTML'):
                            control.setProperty('configuration.innerHTML', FormUtils.htmlEntitiesWithBR(ocrData.children[pageIndex].rows[rowIndex][controlIndex].text));
                            break;
                    }
                    row.appendChild(control);
                }
                page.appendChild(row);
            }
            doc.normalize();
            doc.flatten().forEach(function (c) {
                if (c.getElementKind() === EElementKind.CONTROL) {
                    c.onCreated();
                }
            });
        }
    };
    EditorCommandDispatcher.prototype.getSaveActivity = function () {
        return this.saveActivity;
    };
    EditorCommandDispatcher.prototype.scrollToPaymentsInInspector = function () {
        (function ($, self) {
            if (self.loader.getEditorPanelGroup().getActivePanel().getId() !== 'editor') {
                var unsavedChangesInNotificationsPanel = self.loader.getEditorPanelGroup().getActivePanel().getId() === 'notifications'
                    && !self.loader.getEditorPanelGroup().getActivePanel().getUserConfirmationForDiscardingUnsavedChanges();
                if (unsavedChangesInNotificationsPanel)
                    return;
                self.loader.getEditorPanelGroup().setActivePanel('editor', 0);
            }
            setTimeout(function () {
                $('#editor [data-role=vertical-content]').find('h2[data-category=e-commerce]').each(function () {
                    if (!self.loader.getEditorPanelGroup().isVisible()) {
                        self.loader.getEditorPanelGroup().setVisible(true);
                    }
                    self.scrollTo($('#editor [data-role=vertical-content]')[0], this.offsetTop, 500);
                    self.trackEvent('payments_sidebar_autoscroll', {}, 50);
                });
            }, 200);
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.scrollTo = function (element, to, duration) {
        var _this = this;
        var start = element.scrollTop, change = to - start, currentTime = 0, increment = 20;
        var animateScroll = function () {
            currentTime += increment;
            var val = _this.easeInOutQuad(currentTime, start, change, duration);
            element.scrollTop = val;
            if (currentTime < duration) {
                setTimeout(animateScroll, increment);
            }
        };
        animateScroll();
    };
    EditorCommandDispatcher.prototype.easeInOutQuad = function (t, b, c, d) {
        t /= d / 2;
        if (t < 1)
            return c / 2 * t * t + b;
        t--;
        return -c / 2 * (t * (t - 2) - 1) + b;
    };
    ;
    EditorCommandDispatcher.prototype.trackFirstValueSaved = function (control) {
        var userFeatures = this.loader.getLoaderDependency(ELoaderDependency.USER_FEATURES);
        if (control) {
            var paymentValues = control.getProperty('payments.value');
            if (paymentValues.length > 0) {
                var hasValue = false;
                for (var i = 0, len = paymentValues.length; i < len; i++) {
                    if (paymentValues[i] && paymentValues[i] !== 0) {
                        hasValue = true;
                    }
                }
                if (!hasValue) {
                    return;
                }
            }
            else {
                if (paymentValues && paymentValues == 0) {
                    return;
                }
            }
        }
        if (userFeatures) {
            if (!userFeatures['firstPaymentsValue']) {
                this.trackEvent('user_first_payments_value');
                this.showFirstPaymentsValueNotification();
                this.cookie.setCookie('newPaymentsFirstValueSetNotificationVisible', 1, 14);
                this.cookie.setCookie('formIdForNewPaymentsFirstValueSetNotification', this.loader.getFormId(), 14);
                userFeatures['firstPaymentsValue'] = true;
                this.loader.withUserFeatures(userFeatures);
            }
        }
    };
    EditorCommandDispatcher.prototype.trackFirstProcessorAdded = function () {
        var userFeatures = this.loader.getLoaderDependency(ELoaderDependency.USER_FEATURES);
        if (userFeatures) {
            if (!userFeatures['firstProcessor']) {
                this.trackEvent('user_first_processor_added');
                if (!userFeatures['firstPaymentsValue']) {
                    this.showFirstProcessorAddedNotification();
                    this.cookie.setCookie('newPaymentsFirstProcessorAddedNotificationVisible', 1, 14);
                    this.cookie.setCookie('formIdForPaymentsFirstProcessorAddedNotification', this.loader.getFormId(), 14);
                }
                userFeatures['firstProcessor'] = true;
                this.loader.withUserFeatures(userFeatures);
            }
        }
    };
    EditorCommandDispatcher.prototype.trackPaymentsActivation = function () {
        if (this.paymentsInActivationProcess) {
            var document_1 = this.loader.getEngine().getDocument();
            var processorsSettingIds = EditorSettingGroups.getGroupSettingTypeIds(EditorSettingGroups.PAYMENT_PROCESSORS);
            var numberOfActiveProcessors = 0;
            for (var i = 0, len = processorsSettingIds.length; i < len; i++) {
                if (document_1.hasEditorSetting(processorsSettingIds[i])
                    && document_1.getEditorSettingByTypeId(processorsSettingIds[i]).getProperty('isEnabled') === true
                    && !document_1.getEditorSettingByTypeId(processorsSettingIds[i]).hasErrors()) {
                    numberOfActiveProcessors++;
                }
            }
            if (numberOfActiveProcessors === 1) {
                this.trackEvent('payments_enabled');
                this.paymentsInActivationProcess = false;
            }
        }
    };
    EditorCommandDispatcher.prototype.setPaymentsInActivationProcess = function (value) {
        this.paymentsInActivationProcess = value;
    };
    EditorCommandDispatcher.prototype.displayNotificationForFirstValueAndProcessorIfNeeded = function () {
        var _this = this;
        setTimeout(function () {
            var userFeatures = _this.loader.getLoaderDependency(ELoaderDependency.USER_FEATURES);
            if (_this.cookie.getCookie('newPaymentsFirstValueSetNotificationVisible')
                && userFeatures['firstPaymentsValue']
                && _this.cookie.getCookie('formIdForNewPaymentsFirstValueSetNotification')
                && (~~_this.cookie.getCookie('formIdForNewPaymentsFirstValueSetNotification') === _this.loader.getFormId())) {
                _this.showFirstPaymentsValueNotification();
            }
            if (_this.cookie.getCookie('newPaymentsFirstProcessorAddedNotificationVisible')
                && userFeatures['firstProcessor']
                && _this.cookie.getCookie('formIdForPaymentsFirstProcessorAddedNotification')
                && (~~_this.cookie.getCookie('formIdForPaymentsFirstProcessorAddedNotification') === _this.loader.getFormId())) {
                _this.showFirstProcessorAddedNotification();
            }
        }, 10);
    };
    EditorCommandDispatcher.prototype.showFirstPaymentsValueNotification = function () {
        this.loader.getUI().createNotification(this.loader.getI18n().translateHTMLText("[[edt_first_payments_value_saved_part1]]" +
            ' <a data-role="open-products" href="javascript:;">' +
            '[[edt_first_payments_value_saved_link1]]' +
            '</a> ' +
            '[[edt_first_payments_value_saved_part2]]' +
            ' <a data-role="scroll-to-payments" href="javascript:;">' +
            '[[edt_first_payments_value_saved_link2]]' +
            '</a>.'), false, ENotificationStyle.DEFAULT);
        (function ($, self) {
            $(self.loader.getUI().getCurrentNotification())
                .on('click', 'a[data-role=open-products]', function () {
                PaymentsProductsDialog.openFromExternalSource();
                self.trackEvent('user_first_price_notification_click_on_products');
            })
                .on('click', 'a[data-role=scroll-to-payments]', function () {
                self.scrollToPaymentsInInspector();
                self.trackEvent('user_first_price_notification_click_on_payments');
            })
                .on('click', '.close', function () {
                self.cookie.deleteCookie('newPaymentsFirstValueSetNotificationVisible');
                self.cookie.deleteCookie('formIdForNewPaymentsFirstValueSetNotification');
            });
            $.ajax({
                url: '/ajax_call.php',
                data: {
                    'module': 'modules/UserFeatures/index.php',
                    'action': 'updateFeature',
                    'featureName': 'firstPaymentsValue',
                    'featureValue': true
                }
            }).done(function (response) {
                console.log('successful feature updated: ' + 'firstPaymentsValue');
            }).fail(function (error) {
                console.error(new Error('error while updating feature: ' + 'firstPaymentsValue' + " \n " + String(error)));
            });
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.showFirstProcessorAddedNotification = function () {
        this.loader.getUI().createNotification(this.loader.getI18n().translateHTMLText("[[edt_first_processor_added]]" +
            ' <a data-role="open-products" href="javascript:;">' +
            '[[edt_first_processor_added_link]]' +
            '</a>.'), false, ENotificationStyle.DEFAULT);
        (function ($, self) {
            $(self.loader.getUI().getCurrentNotification())
                .on('click', 'a[data-role=open-products]', function () {
                PaymentsProductsDialog.openFromExternalSource();
                self.trackEvent('user_first_processor_notification_click_on_products');
            })
                .on('click', '.close', function () {
                self.cookie.deleteCookie('newPaymentsFirstProcessorAddedNotificationVisible');
                self.cookie.deleteCookie('formIdForPaymentsFirstProcessorAddedNotification');
            });
            $.ajax({
                url: '/ajax_call.php',
                data: {
                    'module': 'modules/UserFeatures/index.php',
                    'action': 'updateFeature',
                    'featureName': 'firstProcessor',
                    'featureValue': true
                }
            }).done(function (response) {
                console.log('successful feature updated: ' + 'firstProcessor');
            }).fail(function (error) {
                console.error(new Error('error while updating feature: ' + 'firstProcessor' + " \n " + String(error)));
            });
        })(this.editor.getJQuery(), this);
    };
    EditorCommandDispatcher.prototype.isWixOrWeebly = function () {
        return (window['UserData']
            && window['PLATFORM_WEEBLY']
            && window['PLATFORM_WIX']
            && (window['UserData']['serverPlatform'] == window['PLATFORM_WEEBLY']
                || window['UserData']['serverPlatform'] == window['PLATFORM_WIX']));
    };
    EditorCommandDispatcher.prototype.correctCSSTransformTimerFunction = function (tinyMCEStyleCorrectorElement, dialogBody, dialogWidth, dialogHeight) {
        var _this = this;
        if (!tinyMCEStyleCorrectorElement.parentNode) {
            return;
        }
        var currentDialogWidth = dialogBody.parentNode['offsetWidth'], currentDialogHeight = dialogBody.parentNode['offsetHeight'];
        if (currentDialogWidth !== dialogWidth || currentDialogHeight !== dialogHeight) {
            dialogWidth = currentDialogWidth;
            dialogHeight = currentDialogHeight;
            currentDialogWidth = ~~(~~currentDialogWidth / 2);
            currentDialogHeight = ~~(~~currentDialogHeight / 2);
            tinyMCEStyleCorrectorElement.textContent =
                "body[data-header-version='3'] .mce-container.mce-panel.mce-floatpanel.mce-menu,\n                                body[data-header-version='3'] .mce-tinymce-inline.mce-container.mce-panel.mce-floatpanel,\n                                body[data-header-version='3'] .mce-widget.mce-tooltip,\n                                body[data-header-version='3'] .mce-container.mce-panel.mce-floatpanel.mce-popover,\n                                body[data-header-version='3'] .mce-container.mce-panel.mce-floatpanel.mce-menu.mce-menu-align,\n                                body.header-v1 .mce-container.mce-panel.mce-floatpanel.mce-menu,\n                                body.header-v1 .mce-tinymce-inline.mce-container.mce-panel.mce-floatpanel,\n                                body.header-v1 .mce-widget.mce-tooltip,\n                                body.header-v1 .mce-container.mce-panel.mce-floatpanel.mce-popover,\n                                body.header-v1 .mce-container.mce-panel.mce-floatpanel.mce-menu.mce-menu-align {\n                                    transform: translate(-" + currentDialogWidth + "px, -" + currentDialogHeight + "px);\n                                    position:fixed;\n                                    z-index: 50000000 !important;\n                                    max-height: 180px !important;\n                                }\n                                body[data-header-version='3'] .mce-container.mce-panel.mce-floatpanel.mce-window,\n                                body.header-v1 .mce-container.mce-panel.mce-floatpanel.mce-window {\n                                    z-index: 60000000 !important;\n                                }\n                                body[data-header-version='3'] .mce-container.mce-panel.mce-floatpanel.mce-menu.mce-menu-align.mce-fixed,\n                                body.header-v1 .mce-container.mce-panel.mce-floatpanel.mce-menu.mce-menu-align.mce-fixed {\n                                   z-index: 100000000000!important;\n                                   transform: inherit;\n                                }\n                                ";
        }
        setTimeout(function () {
            _this.correctCSSTransformTimerFunction(tinyMCEStyleCorrectorElement, dialogBody, dialogWidth, dialogHeight);
        }, 1000);
    };
    EditorCommandDispatcher.prototype.recalculateForm = function () {
        var _this = this;
        return this.editor.getResourceManager()
            .get('/modules/Typescript/Form/resources/form-invoice.html')
            .done(function (templateText) {
            _this.lastCalculationHTMLMarkup = PaymentsSummaryHelper.getInstance().computeLastCalculationHTMLMarkup(templateText, _this.getEditFormInvoiceItems(), _this.loader.getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS), true);
        })
            .fail(function (e) {
            console.warn('Failed to get the markup for the payment summary. Error is displayed below.');
            console.error(e);
        });
    };
    EditorCommandDispatcher.prototype.getLastCalculationHTMLMarkup = function () {
        return this.lastCalculationHTMLMarkup;
    };
    EditorCommandDispatcher.prototype.addPaymentSummaryListener = function (element) {
        var _this = this;
        element.addEventListener('click', function (event) {
            if (_this.editor.getDocument().getConfiguration().getProperty('isPaymentEnabled', false)) {
                _this.loader.execCommand('edit-setting', EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
            }
            var numberOfPages = _this.loader.getEngine().getDocument().getNumberOfPages();
            _this.loader.getEngine().getDocument().getPageByIndex(numberOfPages - 1).selectPaymentSummaryContainer();
        });
        var addPaymentProcessorButton = element.querySelector('.add-payment-processors');
        if (addPaymentProcessorButton) {
            addPaymentProcessorButton.addEventListener('click', function (event) {
                event.preventDefault();
                event.stopPropagation();
                _this.loader.execCommand('scroll-inspector-to-payments');
            });
        }
    };
    EditorCommandDispatcher.prototype.getEditFormInvoiceItems = function () {
        var _this = this;
        var paymentSettings = this.editor.getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING);
        var currencyId = paymentSettings.getProperty('currencyId') || PaymentsProductsDialog.DEFAULT_CURRENCY_ID;
        var currencySymbol = this.editor.getCurrency().getCurrencySymbolById(currencyId);
        var index = 0;
        var items = [
            {
                type: EInvoiceItemType.PRODUCT,
                number: ++index,
                description: this.loader.getI18n().translateText('edt_payment_summary_sample_item_name'),
                quantity: 1,
                totalPrice: 1
            },
            {
                type: EInvoiceItemType.SUBTOTAL,
                number: ++index,
                description: this.loader.getI18n().translateText('edt_payment_summary_subtotal'),
                quantity: 1,
                totalPrice: 1
            }
        ];
        var products = this.loader.getProductsWithValue();
        _.forEach(_.filter(products, function (product) { return (product['type'] === ElementTypes.CONTROL_TYPE_FEE && product['value'] && product['value'].length && product['value'][0] > 0); }), function (fee) {
            var value = fee['value'][0];
            items.push({
                type: EInvoiceItemType.INVOICE_FEE,
                number: ++index,
                description: fee['details'],
                quantity: 1,
                totalPrice: value
            });
            if (fee['discount'] > 0) {
                items.push({
                    type: EInvoiceItemType.PRODUCT_DISCOUNT,
                    number: index,
                    description: _this.loader.getI18n().translateText('edt_payment_summary_discount'),
                    quantity: 1,
                    totalPrice: _this.calculateDiscountOrTax(fee['discountType'], fee['discount'], value),
                    value: fee['discount'].toString(),
                    valueType: fee['discountType']
                });
            }
            if (fee['tax'] > 0) {
                items.push({
                    type: EInvoiceItemType.PRODUCT_TAX,
                    number: index,
                    description: _this.loader.getI18n().translateText('edt_payment_summary_tax'),
                    quantity: 1,
                    totalPrice: _this.calculateDiscountOrTax(fee['taxType'], fee['tax'], value),
                    value: fee['tax'].toString(),
                    valueType: fee['taxType']
                });
            }
        });
        items.push({
            type: EInvoiceItemType.INVOICE_DISCOUNT,
            number: ++index,
            description: this.loader.getI18n().translateText('edt_payment_summary_discount'),
            quantity: 1,
            totalPrice: 0,
            value: paymentSettings.getProperty('discountValue'),
            valueType: paymentSettings.getProperty('discountType')
        });
        items.push({
            type: EInvoiceItemType.INVOICE_TAX,
            number: ++index,
            description: this.loader.getI18n().translateText('edt_payment_summary_tax'),
            quantity: 1,
            totalPrice: 0,
            value: paymentSettings.getProperty('taxValue'),
            valueType: paymentSettings.getProperty('taxType')
        });
        return {
            invoiceObject: {
                items: items,
                total: parseFloat(PageContainer.DUMMY_VALUE_FOR_RTS_RIBBON)
            },
            currencyHTML: currencySymbol
        };
    };
    EditorCommandDispatcher.prototype.calculateDiscountOrTax = function (type, discountOrTaxValue, itemValue) {
        return (type === 0 ? itemValue * discountOrTaxValue / 100 : discountOrTaxValue);
    };
    EditorCommandDispatcher.prototype.triggerFileUploadLimitDialog = function () {
        this.loader.getUI().alert(this.i18n.translateText('edt_error_adding_field') || 'Error adding field', this.i18n.translateText('edt_file_upload_fields_limit') || 'Only 50 File upload fields can be added on the form');
    };
    EditorCommandDispatcher.prototype.removePaymentSummaryAfterSubmit = function () {
        var paymentSummaryPage = this.editor.getDocument().getPageByIndex(this.editor.getDocument().getNumberOfPagesIncludingPaymentSummary() - 1);
        if (paymentSummaryPage.getTypeId() === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
            paymentSummaryPage.getParent().removeChild(paymentSummaryPage);
            this.editor.getDocument().repaginateInImmediateMode();
        }
    };
    EditorCommandDispatcher.prototype.isDNDStrategy1 = function (dropReferenceElement, dropReferenceEdge) {
        return (dropReferenceElement.getElementKind() === EElementKind.CONTROL ||
            (dropReferenceElement.getElementKind() === EElementKind.CONTAINER &&
                dropReferenceElement.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER))
            && (dropReferenceEdge === EElementEdge.TOP || dropReferenceEdge === EElementEdge.BOTTOM)
            && (dropReferenceElement.getParent().getParent().getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE)
            && (1 === dropReferenceElement.getParent().getChildren().length);
    };
    EditorCommandDispatcher.prototype.isPaywallRequired = function (controlType) {
        var state = this.store.getState();
        if (!this.userService.canAddControl(controlType, _.cloneDeep(state))) {
            if (controlType === ElementTypes.CONTROL_TYPE_FILE) {
                this.triggerFileUploadLimitDialog();
            }
            else if (controlType === ElementTypes.CONTROL_TYPE_HTML_BLOCK) {
                this.triggerPaywall(EUpgradeReason.HTML_BLOCK_NOT_SUPPORTED_IN_CURRENT_USER_PLAN, controlType);
            }
            else {
                var reason = this.getReasonByElementType(controlType, _.cloneDeep(state));
                this.triggerPaywall(reason, controlType);
            }
            return true;
        }
        return false;
    };
    EditorCommandDispatcher.prototype.getReasonByElementType = function (controlTypeId, state) {
        var _a = this.userService.getControlCount(controlTypeId, state).totalNumberOfControls, totalNumberOfControls = _a === void 0 ? 0 : _a;
        return totalNumberOfControls > 0
            ? EUpgradeReason.NUMBER_OF_FIELDS_EXCEEDED_IN_CURRENT_USER_PLAN
            : EUpgradeReason.CONTROL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN;
    };
    EditorCommandDispatcher.prototype.getUpgradePlanByControlType = function (controlType) {
        var _a;
        var toPlan = 0;
        try {
            var controlTarget = (_a = _.find(this.availableUpgrades, function (e) { return e.name === controlType; })) === null || _a === void 0 ? void 0 : _a.target;
            toPlan = controlTarget && controlTarget[0]
                ? this.planUtils.getPlanIdByPlanName(controlTarget[0].name)
                : 0;
        }
        catch (e) {
            var api = this.loader.getAPI();
            this.errorLogger.logError(api, "Error calculating upgrade details for control type: " + controlType + " with error " + JSON.stringify(e), EErrorPriority.WARNING, 'Paywalls');
        }
        return toPlan;
    };
    return EditorCommandDispatcher;
}());
var ViewFormCommandDispatcher = (function () {
    function ViewFormCommandDispatcher(engine, loader) {
        this.isPaymentProcessorChooserPluginInstalled = false;
        this.isQuizTimerCountdownPluginInstalled = false;
        this.isSubmitting = false;
        this.detailedInvoiceDialog = null;
        this.engine = engine;
        this.loader = loader;
        Salvage.addHelper({
            name: 'auto_uid',
            func: function (dummy) {
                return UUID.nextString;
            }
        });
        Salvage.addHelper({
            name: 'auto_uid_last_string',
            func: function (dummy_last) {
                return UUID.lastString;
            }
        });
    }
    ViewFormCommandDispatcher.prototype.navigateToRelativePageNumber = function (relativePageNumber) {
        var _this = this;
        var currentPageNumber = this.engine.getDocument().getCurrentPageIndex();
        this.engine.getDocument().submit(EFormSubmitAction.SWITCH_PAGE, {
            targetPage: currentPageNumber + relativePageNumber,
        }).then(function (response) {
            console.log(JSON.stringify(response, undefined, 4));
            if (!response || undefined === response.ok) {
                throw new Error('Oups, server responded with a unintelligible response!');
            }
            if (!response.ok) {
                if (undefined !== response.error) {
                    console.error(response.error);
                    throw new Error('Error proceeding to ' + (relativePageNumber === 1 ? 'next' : 'previous') + ' page');
                }
                _this.handleSubmitErrors(response);
            }
            else {
                currentPageNumber += relativePageNumber;
                _this.engine.getDocument().setCurrentPageIndex(currentPageNumber);
                _this.scrollToPageTop(currentPageNumber);
                _this.loader.trigger('navigate-to-relative-page-number');
            }
            if (_this.loader.getViewFormContext() === EViewFormContext.APPROVAL) {
                SignatureControl.drawSignaturesInPage(_this.loader);
            }
        }).fail(function (error) {
            _this.engine.getLoader().getUI().alert('Error', String(error));
        }).always(function () {
            FormUtils.scrollToTopOfFormWhenFormIsEmbeddedUnderIOS();
        });
    };
    ViewFormCommandDispatcher.prototype.scrollToPageTop = function (currentPageNumber) {
        var _this = this;
        var formSettings = this.loader.getFormSettings();
        if (formSettings.autoFocusParentTop) {
            window.parent.parent.scrollTo(0, 0);
            return;
        }
        document.body.scrollTop = 0;
        setTimeout(function () {
            var element = _this.engine.getDocument().getPageByIndex(currentPageNumber).getHeaderContainerDOMNode();
            FormUtils.refreshFrameHeightOnWix();
            FormUtils.allBrowsersCompatibleScrollIntoView(element);
        }, 100);
    };
    ViewFormCommandDispatcher.prototype.printPage = function () {
        window['print']();
    };
    ViewFormCommandDispatcher.prototype.reset = function () {
        this.engine.getDocument().reset();
        this.engine.getDocument().setCurrentPageIndex(0);
        this.scrollToPageTop(0);
    };
    ViewFormCommandDispatcher.prototype.preview = function () {
        this.engine.getDocument().setPreviewMode(!this.engine.getDocument().isPreviewModeEnabled());
        this.scrollToPageTop(0);
    };
    ViewFormCommandDispatcher.prototype.getFirstElementWithErrorsOnCurrentPage = function () {
        var currentPageNumber = this.engine.getDocument().getCurrentPageIndex(), pageChildren = this.engine.getDocument().getPageByIndex(currentPageNumber).flatten();
        for (var i = 0, len = pageChildren.length; i < len; i++) {
            if ((pageChildren[i].getElementKind() === EElementKind.CONTROL && pageChildren[i].isVisible())
                && pageChildren[i].getErrors()) {
                return pageChildren[i];
            }
        }
        return null;
    };
    ViewFormCommandDispatcher.prototype.getFirstElementWithErrorsOnForm = function () {
        for (var i = 0, children = this.engine.getDocument().flatten(), len = children.length; i < len; i++) {
            if ((children[i].getElementKind() === EElementKind.CONTROL && children[i].isVisible())
                && children[i].getErrors()) {
                return children[i];
            }
        }
        return null;
    };
    ViewFormCommandDispatcher.prototype.handleActionBarCommand = function (command) {
        var elementWithErrors = null;
        switch (command) {
            case 'submit':
                if (EngineToggles.ENABLE_SUBMISSION_PREVENTION_ON_QUIZ_TIMER_EXPIRATION
                    &&
                        -1 === this.loader.getLoaderDependency(ELoaderDependency.CURRENT_QUIZ_TIMER)) {
                    this.loader.getUI().alert('', this.loader.getI18n().translateText('textdef_144'));
                }
                else {
                    if (elementWithErrors = this.getFirstElementWithErrorsOnForm()) {
                        FormUtils.scrollElementIntoView(elementWithErrors.getRootNode());
                    }
                    else {
                        this.submit(EFormSubmitAction.SUBMIT);
                    }
                }
                break;
            case 'update':
                if (elementWithErrors = this.getFirstElementWithErrorsOnForm()) {
                    FormUtils.scrollElementIntoView(elementWithErrors.getRootNode());
                }
                else {
                    this.submit(EFormSubmitAction.UPDATE);
                }
                break;
            case 'previous-page':
                if (elementWithErrors = this.getFirstElementWithErrorsOnCurrentPage()) {
                    elementWithErrors.getRootNode().scrollIntoView(false);
                }
                else {
                    this.navigateToRelativePageNumber(-1);
                }
                break;
            case 'next-page':
                if (elementWithErrors = this.getFirstElementWithErrorsOnCurrentPage()) {
                    elementWithErrors.getRootNode().scrollIntoView(false);
                }
                else {
                    this.navigateToRelativePageNumber(1);
                }
                break;
            case 'print':
                this.printPage();
                break;
            case 'reset':
                this.reset();
                break;
            case 'preview':
                this.preview();
                break;
            case 'save-for-later':
                this.submit(EFormSubmitAction.SAVE_FOR_LATER);
                break;
            case 'approve':
                if (elementWithErrors = this.getFirstElementWithErrorsOnForm()) {
                    elementWithErrors.getRootNode().scrollIntoView();
                }
                else {
                    this.submit(EFormSubmitAction.APPROVE);
                }
                break;
            case 'reject':
                if (elementWithErrors = this.getFirstElementWithErrorsOnForm()) {
                    elementWithErrors.getRootNode().scrollIntoView();
                }
                else {
                    this.submit(EFormSubmitAction.REJECT);
                }
                break;
            case 'calculate':
                this.recalculateForm(true);
                break;
            default:
                console.warn('ViewFormDispatcher.handleActionBarCommand(' + JSON.stringify(command) + '): Unrecognized command');
                break;
        }
    };
    ViewFormCommandDispatcher.prototype.getQuizScoreResults = function () {
        return this.engine.getDocument().submit(EFormSubmitAction.CALCULATE_QUIZ_SCORE);
    };
    ViewFormCommandDispatcher.prototype.submit = function (actionType) {
        var _this = this;
        setTimeout(function () {
            if (_this.isSubmitting) {
                var loaderText = _this.loader.getI18n().translateTextDefault('submitting_pleaseWait', 'Submitting, please wait…');
                _this.loader.createLoader(loaderText);
            }
        }, 3000);
        if (this.isSubmitting) {
            return;
        }
        if (this.loader.isEnabledAutoSubmit()) {
            return;
        }
        this.isSubmitting = true;
        var isViewFormEmbedOnWorkflows = this.loader.getLoaderDependency(ELoaderDependency.IS_WORKFLOWS_VIEW_FORM_EMBED);
        (function (self, document) {
            document.submit(actionType).then(function (result) {
                if (!result.ok) {
                    self.handleSubmitErrors(result);
                }
                else {
                    if (isViewFormEmbedOnWorkflows) {
                        setTimeout(location.reload);
                    }
                    else {
                        self.engine.setSubmissionPhase(undefined === result.action
                            ? null
                            : result.action, undefined === result.details
                            ? null
                            : result.details);
                        setTimeout(function () {
                            var formSettings = self.loader.getFormSettings();
                            if (formSettings.autoFocusParentTop) {
                                window.parent.parent.scrollTo(0, 0);
                                return;
                            }
                            self.engine.getForm().scrollIntoView();
                        }, 100);
                    }
                }
            }).fail(function (e) {
                document.addError(FormElement.NET_ERR_FATAL_SUBMISSION_BAD_RESPONSE, 'Bad server response');
            }).always(function () {
                self.loader.hideLoader();
                self.isSubmitting = false;
                FormUtils.scrollToTopOfFormWhenFormIsEmbeddedUnderIOS();
            });
        })(this, this.engine.getDocument());
    };
    ViewFormCommandDispatcher.prototype.handleSubmitErrors = function (response) {
        if (response.errors) {
            var element = void 0, firstPageIndexThatHasErrors = null, currentElementPageIndex = void 0, firstError = true;
            var _loop_2 = function (elementHash) {
                if (response.errors.hasOwnProperty(elementHash) && response.errors.propertyIsEnumerable(elementHash)) {
                    element = this_1.engine.getDocument().getElementByHash(elementHash);
                    if (element) {
                        element.withErrors(response.errors[elementHash]);
                        if (element.getTypeId() === ElementTypes.CONTROL_TYPE_ADDRESS) {
                            element.updateFieldsWithErrors();
                        }
                        if (null !== element.getParentPage()) {
                            currentElementPageIndex = element.getParentPage().getIndex();
                        }
                        else {
                            switch (element.getTypeId()) {
                                case ElementTypes.CONTROL_TYPE_CAPTCHA:
                                    currentElementPageIndex = element.getForm().getNumberOfPages() - 1;
                                    break;
                                default:
                                    currentElementPageIndex = null;
                            }
                        }
                        if (null === firstPageIndexThatHasErrors) {
                            firstPageIndexThatHasErrors = currentElementPageIndex;
                        }
                        else {
                            firstPageIndexThatHasErrors = Math.min(firstPageIndexThatHasErrors, currentElementPageIndex);
                        }
                    }
                }
                if (firstError) {
                    var element_1 = this_1.engine.getDocument().getElementByHash(elementHash).getRootNode();
                    if ((FormUtils.isIOS() || FormUtils.isMAC()) && window["Wix"]) {
                        var _a = element_1.getBoundingClientRect(), top_1 = _a.top, height_1 = _a.height;
                        window["Wix"].getBoundingRectAndOffsets(function (data) {
                            window["Wix"].scrollTo(data.offsets.x, data.offsets.y + top_1 - height_1);
                        });
                    }
                    else if (FormUtils.isMAC() && window['parentIFrame']) {
                        var _b = element_1.getBoundingClientRect(), top_2 = _b.top, height = _b.height;
                        window['parentIFrame'].scrollToOffset(0, top_2 - height);
                    }
                    else if (!!window.MSInputMethodContext && !!document.documentMode) {
                        var _c = element_1.getBoundingClientRect(), top_3 = _c.top, height = _c.height;
                        document.documentElement.scrollTop = top_3 - height;
                    }
                    else {
                        element_1.scrollIntoView(false);
                    }
                    firstError = false;
                }
            };
            var this_1 = this;
            for (var elementHash in response.errors) {
                _loop_2(elementHash);
            }
            FormUtils.refreshFrameHeightOnWix();
            if (null !== firstPageIndexThatHasErrors) {
                this.engine.getDocument().setCurrentPageIndex(firstPageIndexThatHasErrors);
            }
        }
    };
    ViewFormCommandDispatcher.prototype.handleErrorActionCommand = function (command) {
        switch (command) {
            case 'clear-submit-net-error':
                this.engine.getDocument().removeError(FormElement.NET_ERR_FATAL_SUBMISSION_BAD_RESPONSE);
                break;
        }
    };
    ViewFormCommandDispatcher.prototype.onSubmissionPhaseShowReport = function (details, inRootDOMNode) {
        inRootDOMNode.textContent = '[TODO] Show report: ' + JSON.stringify(details);
    };
    ViewFormCommandDispatcher.prototype.onSubmissionPhaseShowQuizResults = function (details, inRootDOMNode) {
        inRootDOMNode.textContent = '[TODO] Show quiz results: ' + JSON.stringify(details);
    };
    ViewFormCommandDispatcher.prototype.onSubmissionPhaseShowHTML = function (details, inRootDOMNode) {
        inRootDOMNode.innerHTML = details.html;
        this.loader.getI18n().translateDOMNode(inRootDOMNode);
    };
    ViewFormCommandDispatcher.prototype.openURL = function (url, target, method, additionalParameters) {
        if (method === void 0) { method = 'get'; }
        var redirectUrl = '/url-redirect.php?'
            + 'url=' + encodeURIComponent(url)
            + '&target=' + encodeURIComponent(target)
            + '&method=' + encodeURIComponent(method)
            + '&token=' + encodeURIComponent(this.loader.getCSRFToken())
            + (this.loader.getLoaderDependency(ELoaderDependency.SESSION_ID)
                ? '&PHPSESSID=' + encodeURIComponent(this.loader.getLoaderDependency(ELoaderDependency.SESSION_ID))
                : '');
        for (var parameter in additionalParameters) {
            redirectUrl += '&' + encodeURIComponent(parameter) + '=' + encodeURIComponent(additionalParameters[parameter]);
        }
        window.location.href = redirectUrl;
    };
    ViewFormCommandDispatcher.prototype.onSubmissionPhaseRedirect = function (details, inRootDOMNode) {
        this.openURL(details.url, details.target, 'get', details.additional_url_parameters);
    };
    ViewFormCommandDispatcher.prototype.onSubmissionPhaseTextAndRedirect = function (details, inRootDOMNode) {
        (function (self, $) {
            self.engine.getResourceManager().get('/modules/Typescript/Form/resources/form-actions/text-and-redirect.html')
                .then(function (templateText) {
                details.timer = ~~(~~details.timer / 1000);
                var tpl = new Salvage(templateText);
                inRootDOMNode.innerHTML = tpl.parse(details);
                function timer() {
                    if (details.timer <= 0) {
                        self.openURL(details.url, details.target);
                    }
                    else {
                        details.timer--;
                        $(inRootDOMNode).find('span.timer').text(String(details.timer));
                        setTimeout(timer, 1000);
                    }
                }
                timer();
            });
        })(this, this.engine.getJQuery());
    };
    ViewFormCommandDispatcher.prototype.onSubmissionPhaseShowText = function (details, inRootDOMNode) {
        inRootDOMNode.textContent = details.text || 'Your form has been submitted';
    };
    ViewFormCommandDispatcher.prototype.onSubmissionPhaseUnhandled = function (details, inRootDOMNode) {
        (function (self, $) {
            self.engine.getResourceManager().get('/modules/Typescript/Form/resources/form-actions/unhandled.html')
                .then(function (templateText) {
                var tpl = new Salvage(templateText);
                inRootDOMNode.innerHTML = tpl.parse(details);
                self.openURL(details.url, details.target);
            });
        })(this, this.engine.getJQuery());
    };
    ViewFormCommandDispatcher.prototype.updatePaymentsSelectorCreditCardLogo = function (select) {
        var index = select.selectedIndex, opt = select.options[index], picsBase64 = opt.getAttribute('data-logos'), picsJSON = JSON.parse(atob(picsBase64)), $ = this.engine.getJQuery(), hasAccessibilityEnabled = this.engine.getDocument().getConfiguration().getProperty('hasAccessibilityEnabled', false);
        $(select).closest('label').find('span[data-role=credit-cards-list]').each(function () {
            this.innerHTML = '';
            var img;
            for (var i = 0, len = picsJSON.length; i < len; i++) {
                img = document.createElement('img');
                img.src = picsJSON[i];
                if (hasAccessibilityEnabled) {
                    img.tabIndex = 0;
                }
                this.appendChild(img);
                this.appendChild(document.createElement('span'));
            }
        });
    };
    ViewFormCommandDispatcher.prototype.initPaymentsSelector = function (domNode) {
        (function (self, $) {
            $(domNode).find('select').each(function () {
                var softwareDropdown = UI.createElement(UI.ELEMENT_TYPE_DROPDOWN), hasAccessibilityEnabled = self.engine.getDocument().getConfiguration().getProperty('hasAccessibilityEnabled', false);
                for (var i = 0, opts = Array.prototype.slice.call(this.options, 0), len = opts.length; i < len; i++) {
                    softwareDropdown.add(opts[i]);
                }
                softwareDropdown.setAttribute('data-role', 'i123-input');
                if (hasAccessibilityEnabled) {
                    softwareDropdown.setAttribute('tabindex', '0');
                }
                this.parentNode.insertBefore(softwareDropdown.getRootNode(), this);
                this.parentNode.removeChild(this);
                self.updatePaymentsSelectorCreditCardLogo(softwareDropdown.getRootNode());
                self.updatePaymentsSelectorCreditCardExtraOptions(domNode, softwareDropdown.getRootNode());
            });
            if (!self.isPaymentProcessorChooserPluginInstalled) {
                var lastDOMTarget_1 = null, lastDOMNode_1 = null, updatePluginThrottled_1 = Throttle.create(function () {
                    self.updatePaymentsSelectorCreditCardExtraOptions(lastDOMNode_1, lastDOMTarget_1);
                }, 10);
                $(self.engine.getForm()).on('change', 'div[data-role=control][data-type=payments-selector] label[data-role=secondary] div[data-ui-role=ui-element][data-type=dropdown]', function () {
                    var domNode = $(this).closest('[data-type=payments-selector]').get(0);
                    self.updatePaymentsSelectorCreditCardLogo(this);
                    lastDOMTarget_1 = this;
                    lastDOMNode_1 = domNode;
                    updatePluginThrottled_1();
                    $(this).closest('label').find('input[type=radio]').each(function () {
                        this.checked = true;
                    });
                });
                $(self.engine.getForm()).on('click mousedown mouseup', 'div[data-role=control][data-type=payments-selector] div[data-ui-role=ui-element][data-type=dropdown]', function () {
                    $(this).closest('label').find('input[type=radio]').each(function () {
                        this.checked = true;
                    });
                });
                $(self.engine.getForm()).on('click', 'div[data-role=control][data-type=payments-selector] input[type=radio]', function () {
                    var domNode = $(this).closest('[data-type=payments-selector]').get(0);
                    lastDOMTarget_1 = this;
                    lastDOMNode_1 = domNode;
                    updatePluginThrottled_1();
                });
                self.isPaymentProcessorChooserPluginInstalled = true;
            }
        })(this, this.engine.getJQuery());
    };
    ViewFormCommandDispatcher.prototype.updatePaymentsSelectorCreditCardExtraOptions = function (domNode, eventTarget) {
        var pluginTypeId = null;
        if (eventTarget.nodeName.toLowerCase() === 'input') {
            if (~~eventTarget.getAttribute('value') !== -1) {
                pluginTypeId = ~~eventTarget.getAttribute('data-frontend-plugin-type-id') || null;
            }
            else {
                var dropdown = (eventTarget.parentNode).querySelector('select');
                if (dropdown) {
                    pluginTypeId = ~~dropdown.options[dropdown.selectedIndex].getAttribute('data-frontend-plugin-type-id') || null;
                }
            }
        }
        else {
            var options = eventTarget.options, selectedIndex = eventTarget.selectedIndex;
            if (options && undefined !== selectedIndex && -1 !== selectedIndex) {
                pluginTypeId = ~~options[selectedIndex].getAttribute('data-frontend-plugin-type-id') || null;
            }
        }
        var renderer = this.engine.getPaymentProcessorsPluginFactory().getPlugin(pluginTypeId), renderingTarget = domNode.querySelector('div[data-role=frontend-plugin]');
        renderer.render(renderingTarget, this.engine);
        domNode.setAttribute('data-plugin-type-id', JSON.stringify(pluginTypeId));
    };
    ViewFormCommandDispatcher.prototype.getSelectedPaymentProcessorExtraData = function () {
        return (function (self, $) {
            var result = null;
            if (self.isPaymentProcessorChooserPluginInstalled) {
                $(self.engine.getForm()).find('div[data-role=control][data-type=payments-selector]').each(function () {
                    var pluginTypeIdString = this.getAttribute('data-plugin-type-id');
                    if (!pluginTypeIdString) {
                        return;
                    }
                    var pluginTypeId = JSON.parse(pluginTypeIdString), plugin = self.engine.getPaymentProcessorsPluginFactory().getPlugin(pluginTypeId);
                    result = plugin.getValues(this, self.engine);
                });
            }
            return result;
        })(this, this.engine.getJQuery());
    };
    ViewFormCommandDispatcher.prototype.getSelectedPaymentProcessorTypeId = function () {
        var result = null;
        if (this.isPaymentProcessorChooserPluginInstalled) {
            (function (self, $) {
                $(self.engine.getForm()).find('div[data-role=control][data-type=payments-selector] input[type=radio]').each(function () {
                    if (this.checked) {
                        var typeId = ~~this.value;
                        if (-1 === typeId) {
                            $(this).closest('label').find('select').each(function () {
                                result = -1 * (~~this.value);
                            });
                        }
                        else {
                            result = typeId;
                        }
                    }
                });
            })(this, this.engine.getJQuery());
        }
        return result;
    };
    ViewFormCommandDispatcher.prototype.setPageURL = function (url) {
        try {
            if (!url) {
                return;
            }
            history.replaceState({}, document.title, url.replace(/^(https?:)?\/\/[a-zA-Z0-9\.]+\//g, '/'));
        }
        catch (e) {
            console.warn('Failed to set URL: ', url, ': ', e);
        }
    };
    ViewFormCommandDispatcher.prototype.getLastCalculationHTMLMarkup = function () {
        return this.lastCalculationHTMLMarkup || null;
    };
    ViewFormCommandDispatcher.prototype.recalculateForm = function (manual) {
        console.warn('CALCULATE: ', manual ? 'MANUAL' : 'REALTIME');
        if (!manual) {
            var realTimeCalculations = this.loader.getLoaderDependency(ELoaderDependency.SHOW_REALTIME_CALCULATIONS);
            if (!realTimeCalculations) {
                return;
            }
        }
        (function (self, resourceManager, document, $) {
            $.when(resourceManager.get('/modules/Typescript/Form/resources/form-invoice.html'), document.calculate()).then(function (templateText, response) {
                if (!response || (!response.invoiceObject) || (response && 0 === response.invoiceObject.total)) {
                    $(document.getRootNode()).find('[data-role=page-header] [data-role=control][data-type=realtime-calculations]').attr('data-is-empty', '1');
                    $(document.getRootNode()).find('[data-role=page-footer] [data-type=payment-summary]').attr('data-is-empty', '1');
                    self.loader.trigger('form_has_products_or_fixed_fees_changed', true);
                }
                else {
                    $(document.getRootNode()).find('[data-role=page-header] [data-role=control][data-type=realtime-calculations]').removeAttr('data-is-empty');
                    $(document.getRootNode()).find('[data-role=page-footer] [data-type=payment-summary]').removeAttr('data-is-empty');
                    self.loader.trigger('form_has_products_or_fixed_fees_changed', false);
                    self.lastCalculationHTMLMarkup = PaymentsSummaryHelper.getInstance().computeLastCalculationHTMLMarkup(templateText, response, self.loader.getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS));
                    var calculationTotalHTML_1 = response.currencyHTML + response.invoiceObject.total;
                    $(document.getRootNode()).find('[data-role=page-header] [data-role=control][data-type=realtime-calculations] [data-role=calculation-total]').each(function () {
                        this.innerHTML = calculationTotalHTML_1;
                        self.loader.getI18n().translateDOMNode(this);
                    });
                    $(document.getRootNode())
                        .find('[data-role=page-footer] [data-type=payment-summary]')
                        .html(self.lastCalculationHTMLMarkup)
                        .each(function () {
                        self.loader.getI18n().translateDOMNode(this);
                    });
                    self.addNewLineIfNeeded(document.getRootNode(), $);
                    if (self.detailedInvoiceDialog) {
                        self.detailedInvoiceDialog.body.innerHTML = self.lastCalculationHTMLMarkup;
                        self.loader.getI18n().translateDOMNode(self.detailedInvoiceDialog.body);
                    }
                    PaymentsSummaryHelper.getInstance().setupI18n();
                }
                FormUtils.refreshFrameHeightOnWix();
            });
        })(this, this.engine.getResourceManager(), this.engine.getDocument(), this.engine.getJQuery());
    };
    ViewFormCommandDispatcher.prototype.startQuizTimerCountdownThread = function () {
        if (this.isQuizTimerCountdownPluginInstalled) {
            return;
        }
        if (null === this.loader.getQuizTimer()) {
            return;
        }
        (function (self, document, loader, $) {
            var value = loader.getLoaderDependency(ELoaderDependency.INITIAL_QUIZ_TIMER);
            Object.defineProperty(self, 'quizTimerCountdownValue', {
                get: function () {
                    return value;
                }
            });
            var countdownThreadId = window.setInterval(function () {
                if (null === value || value < 0) {
                    window.clearInterval(countdownThreadId);
                    return;
                }
                var hours, minutes, seconds, hoursAsString, minutesAsString, secondsAsString, v = value;
                hours = Math.floor(v / 3600);
                v -= (hours * 3600);
                minutes = Math.floor(v / 60);
                v -= (minutes * 60);
                seconds = v;
                hoursAsString = hours < 10
                    ? '0' + hours
                    : String(hours);
                minutesAsString = minutes < 10
                    ? '0' + minutes
                    : String(minutes);
                secondsAsString = seconds < 10
                    ? '0' + seconds
                    : String(seconds);
                $(document.getRootNode()).find('div[data-role=page] > [data-role=page-header] > [data-role=quiz-timer] > div[data-role]').each(function () {
                    switch (this.getAttribute('data-role')) {
                        case 'hours':
                            $(this).find('.value').text(hoursAsString);
                            break;
                        case 'minutes':
                            $(this).find('.value').text(minutesAsString);
                            break;
                        case 'seconds':
                            $(this).find('.value').text(secondsAsString);
                            break;
                    }
                });
                value = value - 1;
                if (value === 0) {
                    self.submit(EFormSubmitAction.SUBMIT_QUIZ);
                }
            }, 1000);
        })(this, this.engine.getDocument(), this.loader, this.engine.getJQuery());
        this.isQuizTimerCountdownPluginInstalled = true;
    };
    ViewFormCommandDispatcher.prototype.setFormLanguage = function (languageCode) {
        (function (i18n, document, langApiEndpointPath, $, loader) {
            i18n.clear().get(langApiEndpointPath).then(function () {
                $(document.getRootNode()).find('[data-role=language-selector] select').each(function () {
                    this.value = languageCode;
                });
                $.get('/ajax_call.php', {
                    theToken: loader.getCSRFToken(),
                    lang: i18n.getLanguageCode(),
                    formId: document.getId(),
                    module: 'modules/Form/useLanguage.php',
                    engine: 'TranslationsV2',
                });
            });
        })(this.loader.getI18n(), this.engine.getDocument(), this.loader.getApiRootAddress() + '/v2/language/' + languageCode + '/' + this.loader.getFormId(), this.loader.getJQuery(), this.loader);
    };
    ViewFormCommandDispatcher.prototype.focusOnFirstFormField = function () {
        var isFocused = false;
        this.engine
            .getJQuery()(this.engine.getDocument().getPageByIndex(0).getRootNode())
            .find('> [data-role=page-body]')
            .find('input:not([type=hidden]), textarea, select, [tabindex]').each(function () {
            if (!isFocused) {
                this.focus();
                if (document.activeElement === this) {
                    isFocused = true;
                }
            }
        });
    };
    ViewFormCommandDispatcher.prototype.showDetailedInvoiceDialog = function () {
        var _this = this;
        if (null === this.detailedInvoiceDialog) {
            this.detailedInvoiceDialog = this.loader.getUI().createDialog(this.loader.getI18n().translateText('textdef_114'), [], {
                onCloseButtonClick: function () {
                    _this.detailedInvoiceDialog = null;
                },
                "width": "644px",
            });
            this.loader.getJQuery()(this.detailedInvoiceDialog.body).closest('.ui-dialog').attr('data-dialog-role', 'detailed-invoice-dialog');
        }
        this.detailedInvoiceDialog.body.innerHTML = this.lastCalculationHTMLMarkup || '';
        this.loader.getJQuery()(this.detailedInvoiceDialog.body).perfectScrollbar();
        this.addNewLineIfNeeded(this.detailedInvoiceDialog.body, this.loader.getJQuery());
        this.loader.getI18n().translateDOMNode(this.detailedInvoiceDialog.body);
        PaymentsSummaryHelper.getInstance().setupI18n();
    };
    ViewFormCommandDispatcher.prototype.displayFormFooter = function (footerSettings) {
        (function (self, resourceManager, document, $) {
            resourceManager.get('/modules/Typescript/Form/resources/form-footer.html')
                .then(function (templateText) {
                var template = new Salvage(templateText), model = {
                    logo: footerSettings.logo
                        ? {
                            anchorUrl: footerSettings.logo.anchorUrl,
                            anchorTitle: footerSettings.logo.anchorTitle,
                            imageAlt: footerSettings.logo.imageAlt,
                            imageTitle: footerSettings.logo.imageTitle,
                            imageUrl: footerSettings.logo.imageUrl,
                            needsImageIcon: footerSettings.logo.needsImageIcon,
                        }
                        : null,
                    copyright: footerSettings.copyright
                        ? {
                            anchorContent: footerSettings.copyright.anchorContent,
                            anchorUrl: footerSettings.copyright.anchorUrl,
                            anchorTitle: footerSettings.copyright.anchorTitle,
                            textAfterAnchor: footerSettings.copyright.textAfterAnchor,
                            textBeforeAnchor: footerSettings.copyright.textBeforeAnchor,
                        }
                        : null,
                    abuse: footerSettings.abuse
                        ? {
                            anchorContent: footerSettings.abuse.anchorContent,
                            anchorUrl: footerSettings.abuse.anchorUrl,
                            anchorTitle: footerSettings.abuse.anchorTitle,
                        }
                        : null,
                    sensitiveInfo: footerSettings.sensitiveInfo
                        ? {
                            title: footerSettings.sensitiveInfo.title,
                        }
                        : null,
                };
                $(document.getRootNode())
                    .append(template.parse(model));
            });
        })(this, this.engine.getResourceManager(), this.engine.getDocument(), this.engine.getJQuery());
    };
    ViewFormCommandDispatcher.prototype.exploreJQLDatabase = function () {
        (function (self) {
            self.loader.getRules().exploreDatabase({
                getJQuery: function () {
                    return self.loader.getJQuery();
                },
                getResourceManager: function () {
                    return self.engine.getResourceManager();
                },
                createNotification: function (notificationText, escapeText, notificationStyle, allowCloseNotificationButton) {
                    console.warn('NOTIFICATION: ', notificationText);
                },
                alert: function (title, message, doneCallback) {
                    return self.loader.getUI().alert(title, message, doneCallback);
                },
                createDialog: function (dialogTitle, dialogButtons, settings) {
                    return self.loader.getUI().createDialog(dialogTitle, dialogButtons, settings);
                },
                getDatabase: function () {
                    return self.loader.getRules().getDatabase();
                }
            });
        })(this);
    };
    ViewFormCommandDispatcher.prototype.addNewLineIfNeeded = function (container, $) {
        $(container)
            .find('[data-role=detailed-invoice] [data-role=description]')
            .each(function () {
            var choices = this.textContent.split('\n'), result = choices[0];
            if (choices.length > 1) {
                this.textContent = choices[0];
                for (var i = 1, len = choices.length; i < len; i++) {
                    this.appendChild(document.createElement('br'));
                    this.appendChild(document.createTextNode(choices[i]));
                }
            }
        });
    };
    return ViewFormCommandDispatcher;
}());
var EditorUserInterface = (function (_super) {
    __extends(EditorUserInterface, _super);
    function EditorUserInterface(editor) {
        var _this = _super.call(this, editor, editor.getJQuery(), window.document.getElementById('notifications-area'), window.document.body) || this;
        _this.engine = editor;
        _this.datasetProvider = new DatasetProvider();
        _this.initDOMEvents();
        return _this;
    }
    EditorUserInterface.prototype.upgrade = function (container, pluginTypes) {
        (function ($, self) {
            var dispatcher = self.engine.getLoader().getCommandDispatcher();
            if (dispatcher.editorValueRendererFactory) {
                dispatcher.editorValueRendererFactory.injectDeferredElements(container);
            }
            for (var i = 0, len = EditorUserInterface.plugins.length; i < len; i++) {
                if (!pluginTypes || (pluginTypes && pluginTypes.indexOf(EditorUserInterface.plugins[i].getName()) > -1)) {
                    try {
                        EditorUserInterface.plugins[i].upgrade($, container, self);
                    }
                    catch (e) {
                        console.warn('FAILED TO UPGRADE, PLUGIN = ', EditorUserInterface.plugins[i]);
                    }
                }
            }
        })(this.jq, this);
    };
    EditorUserInterface.prototype.getSelectedDataset = function (datasetTypes, dialogTitle, existingOptions) {
        return (function (ui, self, $, resourceManager, datasetProvider, i18n, dispatcher) {
            return $.Deferred(function (defer) {
                resourceManager.get('/modules/Typescript/Form/resources/options-dataset-dialog.html')
                    .then(function (templateText) {
                    var model = {
                        datasets: []
                    }, dataset, template = new Salvage(templateText), dialog, selectedDatasetId = null, existingOptionsAsText;
                    for (var i = 0, len = datasetTypes.length; i < len; i++) {
                        dataset = datasetProvider.getDatasetByType(datasetTypes[i]);
                        if (dataset) {
                            model.datasets.push({
                                id: datasetTypes[i],
                                name: dataset.getName().text,
                                i18nName: dataset.getName().i18n || null,
                            });
                        }
                    }
                    model.title = 'Choices Sets';
                    model.i18nTitle = 'edt_text_choices_sets';
                    existingOptionsAsText = (function () {
                        var result = [];
                        for (var i = 0, len = existingOptions.length; i < len; i++) {
                            result.push(existingOptions[i].text);
                        }
                        return result;
                    })().join("\n");
                    model.existingOptions = existingOptionsAsText;
                    var onSaveButtonPress = function () {
                        var linesAsText = String($(dialog.body).find('.values-placeholder > textarea').val() || '').replace(/(^[\s]+|[\s]+$)/g, ''), lines = linesAsText.split('\n'), result = new BlankDataset(), atLeastOneItemIsAdded = false, sourceDataset;
                        if ('' === linesAsText) {
                            return;
                        }
                        if (null !== selectedDatasetId) {
                            sourceDataset = datasetProvider.getDatasetByType(selectedDatasetId);
                        }
                        result.withName(sourceDataset
                            ? sourceDataset.getName()
                            : { text: 'User provided dataset' });
                        for (var i = 0, len = lines.length; i < len; i++) {
                            lines[i] = lines[i].replace(/(^[\s]+|[\s]+$)/g, '');
                            if ('' !== lines[i]) {
                                result.withValue({
                                    text: lines[i],
                                    i18n: sourceDataset
                                        ? sourceDataset.getTranslationForText(lines[i])
                                        : null
                                });
                                atLeastOneItemIsAdded = true;
                            }
                        }
                        if (!atLeastOneItemIsAdded) {
                            return;
                        }
                        dialog.close();
                        defer.resolve(result);
                    };
                    dialog = ui.createDialog(dialogTitle, [
                        {
                            type: EDialogButtonType.CANCEL,
                            callback: function () {
                                dialog.close();
                                defer.reject(new Error('User closed the dialog by pressing the Cancel button'));
                            }
                        },
                        {
                            type: EDialogButtonType.SAVE,
                            callback: onSaveButtonPress
                        }
                    ], {
                        width: "600px",
                        height: "466px",
                        onCloseButtonClick: function () {
                            defer.reject(new Error('User closed the dialog by pressing the X button'));
                        }
                    });
                    dialog.body.innerHTML = template.parse(model);
                    dialog.body.setAttribute('data-dialog-role', 'choice-importer-dialog');
                    dispatcher.addPerfectScrollbar(dialog.body);
                    i18n.translateDOMNode(dialog.body);
                    $(dialog.body)
                        .on('click', 'a[data-role=dataset][data-type-id]', function () {
                        var datasetId = parseInt($(this).attr('data-type-id')), dataset = datasetProvider.getDatasetByType(datasetId), datasetOptions = dataset.getValues() || [], lines = [], i18n = self.getEngine().getI18n();
                        for (var i = 0, len = datasetOptions.length; i < len; i++) {
                            lines.push(i18n.translateText(datasetOptions[i].i18n)
                                && i18n.translateText(datasetOptions[i].i18n) !== datasetOptions[i].i18n
                                ? i18n.translateText(datasetOptions[i].i18n)
                                : datasetOptions[i].text);
                        }
                        $(dialog.body).find('.values-placeholder > textarea').val(lines.join("\n"));
                        selectedDatasetId = datasetId;
                    })
                        .on('keydown', 'textarea', function () {
                        this.style.height = "5px";
                        this.style.height = this.scrollHeight + "px";
                    });
                })
                    .fail(function (e) {
                    defer.reject(e);
                });
            }).promise();
        })(this.engine.getLoader().getUI(), this, this.engine.getJQuery(), this.engine.getResourceManager(), this.datasetProvider, this.engine.getI18n(), this.getEngine().getLoader().getCommandDispatcher());
    };
    EditorUserInterface.addPlugin = function (plugin) {
        this.plugins.push(plugin);
    };
    EditorUserInterface.prototype.getEngine = function () {
        return this.engine;
    };
    EditorUserInterface.prototype.initDOMEvents = function () {
        (function ($, self) {
            $('#notifications-area').on('click', '.notification > .close', function () {
                this.parentNode.parentNode.removeChild(this.parentNode);
                $('body').removeClass('with-notification');
            });
            document.body.addEventListener('mousewheel', function (e) {
                if (e.target && e.target['className'] && e.target['className'] === 'ui-modal') {
                    e.preventDefault();
                    e.stopPropagation();
                }
            }, true);
            document.body.addEventListener('mousemove', function (e) {
                if (e.target && e.target['className'] && e.target['className'] === 'ui-modal') {
                    e.preventDefault();
                    e.stopPropagation();
                }
            }, true);
        })(this.jq, this);
    };
    EditorUserInterface.prototype.createDialog = function (dialogTitle, dialogButtons, settings) {
        var result = _super.prototype.createDialog.call(this, dialogTitle, dialogButtons, settings);
        FormUtils.scrollElementIntoView(result.dialog);
        FormUtils.scrollElementIntoViewOnWix();
        return result;
    };
    EditorUserInterface.plugins = [];
    return EditorUserInterface;
}(GenericUserInterface));
var DropDownInspectorPlugin = (function () {
    function DropDownInspectorPlugin() {
    }
    DropDownInspectorPlugin.prototype.getName = function () {
        return DropDownInspectorPlugin.NAME;
    };
    DropDownInspectorPlugin.prototype.isSelected = function (value, inArray) {
        var v = String(value);
        for (var i = 0, len = inArray.length; i < len; i++) {
            if (String(inArray[i]) === v) {
                return true;
            }
        }
        return false;
    };
    DropDownInspectorPlugin.prototype.upgrade = function ($, fromContainer) {
        (function (self) {
            $(fromContainer).find('select[data-plugin][data-value]').each(function () {
                var isJSONValue;
                if (!this.hasAttribute('data-is-json-value')) {
                    this.value = $(this).attr('data-value');
                    $(this).attr('data-value', null);
                    isJSONValue = false;
                }
                else {
                    isJSONValue = true;
                    try {
                        var value = JSON.parse($(this).attr('data-value') || 'null') || null;
                        if (null !== value) {
                            switch (true) {
                                case 'string' === typeof value:
                                    this.value = value;
                                    break;
                                case value instanceof Array:
                                    for (var i = 0, len = this.options.length; i < len; i++) {
                                        if (self.isSelected(this.options[i].value, value)) {
                                            this.options[i].selected = true;
                                        }
                                    }
                                    break;
                            }
                        }
                        else {
                            this.value = null;
                        }
                    }
                    catch (e) {
                        console.warn('Could not parse dropdown values as JSON. Exception is shown below');
                        console.error(e);
                    }
                    if (!isJSONValue) {
                        $(this).attr('data-value', null);
                    }
                    else {
                        $(this).attr('value', null);
                    }
                }
            });
        })(this);
    };
    DropDownInspectorPlugin.NAME = 'DropDownInspectorPlugin';
    return DropDownInspectorPlugin;
}());
var InputTypeSizeInPixelsInspectorPlugin = (function () {
    function InputTypeSizeInPixelsInspectorPlugin() {
    }
    InputTypeSizeInPixelsInspectorPlugin.prototype.getName = function () {
        return InputTypeSizeInPixelsInspectorPlugin.NAME;
    };
    InputTypeSizeInPixelsInspectorPlugin.prototype.parseSizeInPixels = function (sizeInPixels) {
        if (typeof sizeInPixels === 'string') {
            var matches = /^((-)?([\d]+))(px)?$/.exec(sizeInPixels);
            if (matches) {
                return ~~matches[1];
            }
            else {
                return 0;
            }
        }
        else {
            return 0;
        }
    };
    InputTypeSizeInPixelsInspectorPlugin.prototype.upgrade = function ($, fromContainer, editorUserInterface) {
        (function (self) {
            $(fromContainer)
                .find('input[type=text][data-plugin=size-px]')
                .each(function () {
                $(this).next('input[type=range]').val(self.parseSizeInPixels(this.value));
                $(this).closest('[data-role=property]').attr('data-is-range-property', '');
            })
                .closest('[data-role=property]')
                .attr('data-plugin', 'size-px');
            if (!$(fromContainer).attr('data-size-in-pixels-upgraded')) {
                $(fromContainer).on('input change', 'input[type=text][data-plugin=size-px]', function () {
                    this.title = String(this.value);
                    var sizeInPixels = self.parseSizeInPixels(this.value);
                    $(this).next('input[type=range]').each(function () {
                        this.value = sizeInPixels;
                    });
                }).on('keydown', 'input[type=text][data-plugin=size-px]', function (e) {
                    var code = e.keyCode, myValue = self.parseSizeInPixels(this.value), changed = false;
                    switch (code) {
                        case 40:
                            if (myValue > 0) {
                                myValue--;
                                changed = true;
                            }
                            break;
                        case 38:
                            myValue++;
                            changed = true;
                            break;
                    }
                    if (changed) {
                        e.preventDefault();
                        this.value = myValue + "px";
                        $(this).trigger('input');
                    }
                }).on('blur', 'input[type=text][data-plugin=size-px]', function () {
                    this.value = self.parseSizeInPixels(this.value) + "px";
                    $(this).trigger('input');
                });
                $(fromContainer).on('change', 'input[type=text][data-plugin=size-px] + input[type=range]', function () {
                    var sizeInPixels = this.value;
                    $(this).prev('input[type=text]').val(sizeInPixels + 'px').trigger('input');
                    editorUserInterface.getEngine().getLoader().execCommand('track-event', 'edt_slider_change', {}, 1000);
                });
                $(fromContainer).attr('data-size-in-pixels-upgraded', '1');
            }
        })(this);
    };
    InputTypeSizeInPixelsInspectorPlugin.NAME = 'InputTypeSizeInPixelsInspectorPlugin';
    return InputTypeSizeInPixelsInspectorPlugin;
}());
var HTMLEditorInspectorPlugin = (function () {
    function HTMLEditorInspectorPlugin() {
    }
    HTMLEditorInspectorPlugin.prototype.getName = function () {
        return HTMLEditorInspectorPlugin.NAME;
    };
    HTMLEditorInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        if ($(container).attr('data-html-editor-upgraded')) {
            return;
        }
        $(container).on('click', 'input[type=hidden][data-role=html-editor] + a[data-role=html-popup]', function (e) {
            var dialogTitle = this.getAttribute('data-dialog-title') || 'Edit Rich Text', dialogTitleI18n = this.getAttribute('data-dialog-title-i18n') || 'edt_UI_create_dialog_edit_rich_text', triggerElementHash = $('#item').attr('data-target-element'), triggerElement = editorUserInterface.getEngine().getDocument().getElementByHash(triggerElementHash), triggerPropertyName = $(this).closest("[data-role=property]").attr('data-property-name'), style = null;
            if ([ElementTypes.CONTROL_TYPE_FORM_HEADER, ElementTypes.CONTROL_TYPE_HTML_BLOCK]
                .indexOf(triggerElement.getTypeId()) > -1
                && triggerPropertyName === 'configuration-innerHTML') {
                style = "\n                    html > body {\n                        background-color: " + editorUserInterface.getEngine().getTheme().getMergedProperties().page.background.color + ";\n                        color: " + editorUserInterface.getEngine().getTheme().getMergedProperties().form.color + ";\n                    }\n                ";
            }
            $(this).prev('input[type=hidden][data-role=html-editor]').each(function () {
                editorUserInterface.getEngine().getLoader().execCommand('edit-html', this, dialogTitle, dialogTitleI18n, style);
            });
        });
        $(container).attr('data-html-editor-upgraded', '1');
    };
    HTMLEditorInspectorPlugin.NAME = 'HTMLEditorInspectorPlugin';
    return HTMLEditorInspectorPlugin;
}());
var MarkdownEditorInspectorPlugin = (function () {
    function MarkdownEditorInspectorPlugin() {
    }
    MarkdownEditorInspectorPlugin.prototype.getName = function () {
        return MarkdownEditorInspectorPlugin.NAME;
    };
    MarkdownEditorInspectorPlugin.prototype.upgrade = function ($, domNode, editorUserInterface) {
        (function (self) {
            $(domNode).find('textarea[data-plugin="markdown-editor"][data-markdown-loaded="false"]').each(function () {
                (function (textareaDOMNode) {
                    $(textareaDOMNode).closest('label').each(function () {
                        (function (propertyLabel) {
                            var replaceWith = document.createElement('input');
                            replaceWith.setAttribute('type', 'hidden');
                            for (var i = 0, len = textareaDOMNode.attributes.length; i < len; i++) {
                                replaceWith.setAttribute(textareaDOMNode.attributes[i].name, textareaDOMNode.attributes[i].value);
                            }
                            textareaDOMNode.parentNode.appendChild(replaceWith);
                            propertyLabel.parentNode.appendChild(textareaDOMNode);
                            textareaDOMNode.setAttribute('data-markdown-loaded', 'true');
                            textareaDOMNode.value = MiniMarkdown.parse(textareaDOMNode.value);
                            var editorDOMContentsNode, editorDOMNode;
                            $(textareaDOMNode).trumbowyg({
                                btns: [
                                    [
                                        'strong',
                                        'em',
                                        'underline',
                                        'link',
                                        'removeformat',
                                    ]
                                ],
                                btnsDef: {
                                    unlink: {
                                        key: 'D'
                                    },
                                    createLink: {
                                        text: 'Add link',
                                        key: 'K',
                                        tag: 'a'
                                    }
                                },
                                semantic: true,
                                autogrowOnEnter: true,
                                svgPath: false,
                                hideButtonTexts: true,
                                removeformatPasted: false,
                                allowTagsFromPaste: [
                                    "b",
                                    "strong",
                                    "i",
                                    "em",
                                    "u",
                                    "del",
                                    "strike",
                                ]
                            }).on('tbwchange', function () {
                                replaceWith.value = self.convertDOMNodeToMarkdown(editorDOMContentsNode);
                                $(replaceWith).trigger('input');
                            }).on('tbwfocus', function () {
                            }).on('tbwblur', function () {
                                editorDOMNode.setAttribute('data-toolbar', '');
                                if (null !== editorDOMNode.querySelector('.trumbowyg-modal-box')) {
                                    editorDOMNode.setAttribute('data-toolbar', 'visible');
                                    var insertLinkURL = editorDOMNode.querySelector('.trumbowyg-modal-box input[name="url"]'), insertLinkText = editorDOMNode.querySelector('.trumbowyg-modal-box input[name="text"]'), insertLinkModalTitle = editorDOMNode.querySelector('.trumbowyg-modal-title');
                                    if (null !== insertLinkURL && null !== insertLinkText) {
                                        insertLinkURL.setAttribute('placeholder', 'URL');
                                        insertLinkURL.setAttribute('data-i18n-placeholder', 'themes_url');
                                        insertLinkURL.setAttribute('data-role', 'markdown-url');
                                        insertLinkText.setAttribute('placeholder', 'Text');
                                        insertLinkText.setAttribute('data-i18n-placeholder', 'editor_text');
                                        insertLinkText.setAttribute('data-role', 'markdown-url-text');
                                    }
                                    if (null !== insertLinkModalTitle) {
                                        insertLinkModalTitle.textContent = 'link';
                                        insertLinkModalTitle.setAttribute('data-i18n-text', 'applications_wordpress_select_format_link');
                                    }
                                    editorUserInterface.getEngine().getI18n().translateDOMNode(editorDOMNode);
                                }
                            }).on('tbwpaste', function () {
                                replaceWith.value = self.convertDOMNodeToMarkdown(editorDOMContentsNode);
                                $(replaceWith).trigger('input');
                            });
                            editorDOMContentsNode = (propertyLabel.parentNode.querySelector('.trumbowyg-editor'));
                            editorDOMNode = editorDOMContentsNode.parentNode;
                            $(editorDOMContentsNode).on('mousedown', function () {
                                editorDOMNode.setAttribute('data-toolbar', 'visible');
                            });
                            editorDOMNode.setAttribute('data-role', 'markdown-editor');
                            if (null !== $(editorDOMContentsNode).closest('[data-role=attribute-group]')) {
                                $(editorDOMContentsNode).closest('[data-role=attribute-group]').attr('data-has-markdown-property', '1');
                            }
                        })(this);
                    });
                })(this);
            });
        })(this);
    };
    MarkdownEditorInspectorPlugin.prototype.convertDOMNodeToMarkdown = function (domNode) {
        var lines = [], lineIndex = -1;
        var addText = function (s) {
            var chr;
            for (var i = 0, len = s.length; i < len; i++) {
                switch (chr = s.charAt(i)) {
                    case '*':
                        write('%ST%');
                        break;
                    case '_':
                        write('%UN%');
                        break;
                    case '+':
                        write('%PL%');
                        break;
                    case '-':
                        write('%MI%');
                        break;
                    case "\n":
                    case "\t":
                    case "\r":
                        write(' ');
                        break;
                    default:
                        write(chr);
                        break;
                }
            }
        };
        var write = function (text) {
            if (-1 === lineIndex) {
                createNewLine();
            }
            lines[lineIndex] += text;
        };
        var createNewLine = function () {
            lineIndex++;
            lines.push('');
        };
        var traversor = function (node, deep) {
            if (!node) {
                return;
            }
            if (node.nodeType === Node.ELEMENT_NODE) {
                switch (node.nodeName) {
                    case 'P':
                        createNewLine();
                        for (var i = 0, len = node.childNodes.length; i < len; i++) {
                            traversor(node.childNodes[i], deep + 1);
                        }
                        break;
                    case 'B':
                    case 'STRONG':
                        write('*');
                        for (var i = 0, len = node.childNodes.length; i < len; i++) {
                            traversor(node.childNodes[i], deep + 1);
                        }
                        write('*');
                        break;
                    case 'I':
                    case 'EM':
                        write('_');
                        for (var i = 0, len = node.childNodes.length; i < len; i++) {
                            traversor(node.childNodes[i], deep + 1);
                        }
                        write('_');
                        break;
                    case 'DEL':
                    case 'STRIKE':
                        write('-');
                        for (var i = 0, len = node.childNodes.length; i < len; i++) {
                            traversor(node.childNodes[i], deep + 1);
                        }
                        write('-');
                        break;
                    case 'U':
                        write('+');
                        for (var i = 0, len = node.childNodes.length; i < len; i++) {
                            traversor(node.childNodes[i], deep + 1);
                        }
                        write('+');
                        break;
                    case 'A':
                        write('[');
                        for (var i = 0, len = node.childNodes.length; i < len; i++) {
                            traversor(node.childNodes[i], deep + 1);
                        }
                        write('](');
                        write(node.getAttribute('href'));
                        write(')');
                        break;
                    case 'BR':
                        createNewLine();
                        break;
                    default:
                        addText(node.textContent);
                        break;
                }
            }
            else if (node.nodeType === Node.TEXT_NODE) {
                addText(node.textContent);
            }
        };
        for (var i = 0, children = domNode.childNodes || [], len = children.length; i < len; i++) {
            traversor(children[i], 0);
        }
        return lines.join('\n').trim();
    };
    MarkdownEditorInspectorPlugin.NAME = 'MarkdownEditorInspectorPlugin';
    return MarkdownEditorInspectorPlugin;
}());
var CheckBoxAndRadioInputInspectorPlugin = (function () {
    function CheckBoxAndRadioInputInspectorPlugin() {
    }
    CheckBoxAndRadioInputInspectorPlugin.prototype.getName = function () {
        return CheckBoxAndRadioInputInspectorPlugin.NAME;
    };
    CheckBoxAndRadioInputInspectorPlugin.prototype.upgrade = function ($, container) {
        $(container).find('input[type=checkbox][data-value], input[type=radio][data-value]').each(function () {
            this.checked = this.getAttribute('data-value') === true;
            this.removeAttribute('data-value');
        });
    };
    CheckBoxAndRadioInputInspectorPlugin.NAME = 'CheckBoxAndRadioInputInspectorPlugin';
    return CheckBoxAndRadioInputInspectorPlugin;
}());
var AcceptedDaysOfWeekInspectorPlugin = (function () {
    function AcceptedDaysOfWeekInspectorPlugin() {
    }
    AcceptedDaysOfWeekInspectorPlugin.prototype.getName = function () {
        return AcceptedDaysOfWeekInspectorPlugin.NAME;
    };
    AcceptedDaysOfWeekInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        $(container).find('input[type=hidden][data-plugin=accepted-days-of-week]').each(function () {
            var acceptedDaysOfWeek = null;
            if (this.getAttribute('data-value')) {
                acceptedDaysOfWeek = JSON.parse(this.getAttribute('data-value'));
            }
            this.value = JSON.stringify(acceptedDaysOfWeek);
            if (null !== acceptedDaysOfWeek) {
                $(this).closest('div[data-role=property]').find('div[data-role=secondary] input[type=checkbox]').each(function () {
                    this.checked = acceptedDaysOfWeek.indexOf(~~this.name.substr(1)) > -1;
                });
            }
            else {
                $(this).closest('div[data-role=property]').find('div[data-role=secondary] input[type=checkbox]').each(function () {
                    this.checked = true;
                });
            }
        });
        if ($(container).attr('data-accepted-days-of-week-upgraded')) {
            return;
        }
        $(container).on('click', 'input[type=hidden][data-plugin=accepted-days-of-week] + [data-role=secondary] input[type=checkbox]', function (e) {
            e.stopPropagation();
            var acceptedWeekDays = [];
            $(this).closest('div[data-role=secondary]').find('input[type=checkbox]').each(function () {
                if (this.checked) {
                    acceptedWeekDays.push(~~this.name.substr(1));
                }
            });
            $(this).closest('div[data-role=property]').find('input[type=hidden][data-plugin=accepted-days-of-week]').each(function () {
                $(this).val(JSON.stringify(acceptedWeekDays));
                $(this).trigger('input');
            });
        });
        $(container).attr('data-accepted-days-of-week-upgraded', '1');
    };
    AcceptedDaysOfWeekInspectorPlugin.NAME = 'AcceptedDaysOfWeekInspectorPlugin';
    return AcceptedDaysOfWeekInspectorPlugin;
}());
var ChoicesEditorInspectorPlugin = (function () {
    function ChoicesEditorInspectorPlugin() {
        if (!window['userService']) {
            throw new Error('Dependency not found: userService');
        }
        this.userService = window['userService'].getInstance();
    }
    ChoicesEditorInspectorPlugin.prototype.getName = function () {
        return ChoicesEditorInspectorPlugin.NAME;
    };
    ChoicesEditorInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        var _this = this;
        this.setCurrentSelectedControl(editorUserInterface.getEngine());
        $(container).find('input[type=hidden][data-plugin=text-choice-interface][data-value]').each(function (index, input) {
            var initializeOptionsAsString = input.getAttribute('data-value'), initializeOptions = [], defaultChoiceInputType = ~~input.getAttribute('data-default-choice-type'), setAsDefaultFirstOptionAfterTextDatasetImport = !!~~input.getAttribute('data-set-default-first-option-after-text-dataset-import'), synchronizeOtherProperties = input.getAttribute('data-synchronize-other-properties'), newChoiceText = input.getAttribute('data-new-choice-text') || 'New Choice', newChoiceTextI18n = input.getAttribute('data-new-choice-text-i18n');
            _this.setDialogOptions({
                choices: initializeOptions,
                container: container,
                editorUserInterface: editorUserInterface,
                defaultOptionInputType: defaultChoiceInputType,
                dialogTitle: '',
                newChoiceText: '',
                itemType: '',
                editingContext: '',
                useDifferentValuesPerStatement: false
            });
            $(input).on('reload', function (event) {
                try {
                    var input_1 = event.target, container_1 = $(input_1).closest('[data-role=property]').find('div[data-role=secondary]').get(0), $targetContainer = $(container_1).find('[data-role=container]');
                    _this.dialogOptions.choices = _this.reinitializeChoicesIndexes(JSON.parse(input_1.value), $targetContainer);
                    _this.updateChoices(input_1, $);
                    _this.updateContainerAttributes(container_1);
                }
                catch (e) { }
            });
            input.removeAttribute('data-value');
            if (initializeOptionsAsString) {
                _this.dialogOptions.choices = JSON.parse(initializeOptionsAsString) || [];
            }
            $(input).parent().find('[data-role=secondary]').each(function (index, container) {
                $(input).closest('label').after(container);
                var $targetContainer = $(container).find('[data-role=container]');
                _this.dialogOptions.choices = _this.resetChoicesIndex(_this.dialogOptions.choices, $targetContainer);
                _this.updateContainerAttributes(container);
                _this.makeChoicesInInspectorSortable($, container, input, synchronizeOtherProperties);
                $(container)
                    .on('click', 'a[data-role=edit-option], a[data-role=edit-more-option]', function (event) {
                    var element = event.currentTarget, dialogTitle = String(element.getAttribute('data-dialog-title')), dialogTitleI18n = String(element.getAttribute('data-dialog-title-i18n') || ''), newChoiceText = String(element.getAttribute('data-new-choice-text')), newChoiceTextI18n = String(element.getAttribute('data-new-choice-text-i18n')), itemType = String(element.getAttribute('data-item-type')), editingContext = input.getAttribute('data-editing-context');
                    _this.dialogOptions.itemType = itemType;
                    _this.dialogOptions.editingContext = editingContext;
                    _this.dialogOptions.useDifferentValuesPerStatement = _this.currentSelectedControl.hasProperty('options.useDifferentValuesPerStatement')
                        && _this.currentSelectedControl.getProperty('options.useDifferentValuesPerStatement');
                    _this.dialogOptions.dialogTitle = dialogTitleI18n
                        ? editorUserInterface.getEngine().getI18n().translateText(dialogTitleI18n)
                        : dialogTitle;
                    _this.dialogOptions.newChoiceText = newChoiceTextI18n
                        ? editorUserInterface.getEngine().getI18n().translateText(newChoiceTextI18n)
                        : newChoiceText;
                    _this.editChoices()
                        .then(function () {
                        _this.currentSelectedControl.hasProperty('options.useDifferentValuesPerStatement')
                            && _this.currentSelectedControl.setProperty('options.useDifferentValuesPerStatement', _this.dialogOptions.useDifferentValuesPerStatement);
                        initializeOptions = JSON.parse(JSON.stringify(_this.dialogOptions.choices));
                        initializeOptions = _this.reinitializeChoicesIndexes(initializeOptions, $targetContainer);
                        _this.updateContainerAttributes(container);
                        _this.updateChoices(input, $, synchronizeOtherProperties);
                        _this.makeChoicesInInspectorSortable($, container, input, synchronizeOtherProperties);
                        editorUserInterface.getEngine().getLoader().trigger('payments_products_price_change');
                    })
                        .fail(function (e) {
                        if (undefined !== e) {
                            console.warn('Failed to save options. Error is displayed below');
                            console.error(e);
                        }
                    });
                })
                    .on('click', 'a[data-role=add-option]', function (event) {
                    editorUserInterface.getEngine().getLoader().execCommand('track-event', 'edt_inspector_choice_option_add');
                    var element = event.target, newChoiceText = String(element.getAttribute('data-new-choice-text')), newChoiceTextI18n = String(element.getAttribute('data-new-choice-text-i18n')), selectedNewChoiceText = newChoiceTextI18n
                        ? editorUserInterface.getEngine().getI18n().translateText(newChoiceTextI18n)
                        : newChoiceText, choiceContainer = $(container).find('[data-role="container"]')[0], choiceInput = $(choiceContainer).find('[data-role="choice"]:last-child input[data-role="secondary"]')[0];
                    _this.insertNewChoice(choiceContainer, selectedNewChoiceText, choiceInput, $);
                    _this.updateContainerAttributes(container);
                    _this.updateChoices(input, $, synchronizeOtherProperties);
                    _this.makeChoicesInInspectorSortable($, container, input, synchronizeOtherProperties);
                })
                    .parent()
                    .on('click', 'a[data-role=import-option]', function (event) {
                    var element = event.target, datasets = JSON.parse(element.getAttribute('data-sets') || '[]'), dialogTitle = String(element.getAttribute('data-dialog-title') || 'Import choices'), dialogTitleI18n = String(element.getAttribute('data-dialog-title-i18n') || ''), choices = _this.dialogOptions.choices;
                    if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                        choices = JSON.parse(JSON.stringify(_this.dialogOptions.choices[0]));
                    }
                    editorUserInterface.getSelectedDataset(datasets, dialogTitleI18n
                        ? editorUserInterface.getEngine().getI18n().translateText(dialogTitleI18n)
                        : dialogTitle, choices)
                        .then(function (dataset) {
                        $targetContainer.find('[data-role=choice]').remove();
                        for (var i = 0, values = dataset.getValues(), len1 = values.length; i < len1; i++) {
                            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                                for (var j = 0, len2 = _this.dialogOptions.choices.length; j < len2; j++) {
                                    if (undefined === _this.dialogOptions.choices[j][i]) {
                                        _this.dialogOptions.choices[j].push(ChoicesEditorInspectorPlugin.createUniqueChoice({
                                            text: values[i].text,
                                            isDefault: false,
                                            index: i,
                                            numberOfTimesThisOptionCanBeChosen: null,
                                            numberOfTimesThisOptionHasBeenChosen: null,
                                            isCorrect: false,
                                            quizPoints: 0,
                                            paymentsValue: null,
                                        }, choices));
                                    }
                                    else {
                                        _this.dialogOptions.choices[j][i].text = values[i].text;
                                    }
                                    if (i === (len1 - 1)) {
                                        _this.dialogOptions.choices[j].length = len1;
                                    }
                                }
                                choices[i] = _this.dialogOptions.choices[0][i];
                            }
                            else {
                                if (undefined === _this.dialogOptions.choices[i]) {
                                    _this.dialogOptions.choices.push(ChoicesEditorInspectorPlugin.createUniqueChoice({
                                        text: values[i].text,
                                        isDefault: false,
                                        index: i,
                                        numberOfTimesThisOptionCanBeChosen: null,
                                        numberOfTimesThisOptionHasBeenChosen: null,
                                        isCorrect: false,
                                        quizPoints: 0,
                                        paymentsValue: null,
                                    }, choices));
                                }
                                else {
                                    _this.dialogOptions.choices[i].text = values[i].text;
                                }
                                choices[i] = _this.dialogOptions.choices[i];
                                if (i === (len1 - 1)) {
                                    _this.dialogOptions.choices.length = len1;
                                }
                            }
                            $targetContainer.append(_this.createChoiceElement(choices[i]));
                        }
                        _this.updateContainerAttributes(container);
                        _this.updateChoices(input, $, synchronizeOtherProperties);
                        _this.makeChoicesInInspectorSortable($, container, input, synchronizeOtherProperties);
                    })
                        .fail(function (e) {
                        console.warn('Failed to import choices. Error is displayed below');
                        console.error(e);
                    });
                })
                    .on('input', '[data-role=choice] > input[type=text][data-model-property=text]', function (event) {
                    var inputNode = event.target, index = ~~($(inputNode).closest('[data-role=choice]').attr('data-index'));
                    if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                        var children = _this.currentSelectedControl.getChildren();
                        for (var i = 0, len = children.length; i < len; i++) {
                            _this.dialogOptions.choices[i][index].text = inputNode.value;
                        }
                    }
                    else {
                        _this.dialogOptions.choices[index].text = inputNode.value;
                    }
                    _this.updateChoices(input, $, synchronizeOtherProperties);
                })
                    .on('paste', '[data-role=choice] > input[type=text][data-model-property=text]', function (event) {
                    var inputNode = event.target, dataAsText, arrayOfValues = [], targetIndex = ~~$(inputNode).closest('div[data-role=statement]').attr('data-index');
                    try {
                        var originalEvent = event.originalEvent || {}, clipboardData = event.originalEvent['clipboardData'] || null;
                        if (!clipboardData) {
                            return;
                        }
                        dataAsText = clipboardData.getData('text/plain');
                        var cleanDataAsText = String(dataAsText || '')
                            .replace(/(^[\s]+|[\s]+$)/g, '');
                        if (cleanDataAsText.indexOf('\n') > -1) {
                            arrayOfValues = cleanDataAsText.split('\n');
                        }
                        else {
                            return;
                        }
                        if (arrayOfValues.length === 1) {
                            return;
                        }
                        originalEvent.preventDefault();
                        originalEvent.stopPropagation();
                        if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                            initializeOptions = initializeOptions[0];
                        }
                        for (var i = 0, len = arrayOfValues.length; i < len; i++) {
                            var newChoice = ChoicesEditorInspectorPlugin.createUniqueChoice({
                                text: arrayOfValues[i],
                                index: targetIndex + i + 1
                            }, initializeOptions), newInputDiv = _this.createChoiceElement(newChoice);
                            initializeOptions.splice(newChoice.index, 0, newChoice);
                            $(newInputDiv).insertAfter($('div[data-role=choice][data-index=' + (newChoice.index - 1) + ']'));
                            initializeOptions = _this.reinitializeChoicesIndexes(initializeOptions, $(container));
                            _this.updateContainerAttributes(container);
                        }
                        _this.updateChoices(input, $, synchronizeOtherProperties);
                        _this.makeChoicesInInspectorSortable($, container, input, synchronizeOtherProperties);
                    }
                    catch (unknownBrowserException) {
                    }
                })
                    .on('click', '[data-role=choice] div[data-role=remove]', function (event) {
                    if (_this.dialogOptions.choices.length <= 1
                        || (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                            && _this.dialogOptions.choices[0].length <= 1)) {
                        return;
                    }
                    editorUserInterface.getEngine().getLoader().execCommand('track-event', 'edt_inspector_choice_option_remove');
                    var removeButton = event.target, $choiceContainerNode = $(removeButton).closest('[data-role="container"]'), $choiceNode = $(removeButton).closest('[data-role=choice]'), choiceIndex = ~~($choiceNode.attr('data-index'));
                    if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                        for (var i = 0, len = _this.dialogOptions.choices.length; i < len; i++) {
                            _this.dialogOptions.choices[i].splice(choiceIndex, 1);
                        }
                    }
                    else {
                        _this.dialogOptions.choices.splice(choiceIndex, 1);
                    }
                    _this.dialogOptions.choices = _this.reinitializeChoicesIndexes(_this.dialogOptions.choices, $($choiceContainerNode));
                    _this.updateChoices(input, $, synchronizeOtherProperties);
                    $choiceNode.remove();
                    _this.updateContainerAttributes($choiceContainerNode.closest('div[data-role=secondary]')[0]);
                })
                    .on('keydown', 'input', function (event) {
                    if ((event.keyCode || event.charCode) !== KeyboardUtils.KEY_ENTER
                        || initializeOptions[initializeOptions.length - 1].text === null
                        || initializeOptions[initializeOptions.length - 1].text === '') {
                        return;
                    }
                    var inputNode = event.target, targetIndex = ~~$(inputNode).parent().attr('data-index');
                    if (initializeOptions.length > ChoicesEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_CHOICES_IN_INSPECTOR_PANEL
                        && (targetIndex === ChoicesEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_CHOICES_IN_INSPECTOR_PANEL)) {
                        $('a[data-role=edit-more-option][data-target=choices]').trigger('click');
                    }
                    if (targetIndex < ChoicesEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_CHOICES_IN_INSPECTOR_PANEL) {
                        var newChoice = ChoicesEditorInspectorPlugin.createUniqueChoice({
                            text: newChoiceTextI18n
                                ? editorUserInterface.getEngine().getI18n().translateText(newChoiceTextI18n)
                                : newChoiceText,
                            index: initializeOptions.length
                        }, initializeOptions), newInputDiv = _this.createChoiceElement(newChoice);
                        initializeOptions.splice(targetIndex + 1, 0, newChoice);
                        $(newInputDiv).insertAfter(inputNode.parentNode);
                        initializeOptions = _this.reinitializeChoicesIndexes(initializeOptions, $(container));
                        _this.updateChoices(input, $, synchronizeOtherProperties);
                        _this.updateContainerAttributes(container);
                        _this.makeChoicesInInspectorSortable($, container, input, synchronizeOtherProperties);
                        $(newInputDiv)
                            .find('input')
                            .focus()
                            .select();
                    }
                });
            });
        });
    };
    ChoicesEditorInspectorPlugin.prototype.createChoiceElement = function (choice) {
        var node = document.createElement('div'), labelInput, removeButton, dragButton;
        node.setAttribute('data-role', 'choice');
        node.setAttribute('data-index', String(choice.index));
        labelInput = document.createElement('input');
        labelInput.setAttribute('type', 'text');
        labelInput.setAttribute('data-model-property', 'text');
        labelInput.setAttribute('data-role', 'secondary');
        node.appendChild(labelInput);
        removeButton = document.createElement('div');
        removeButton.setAttribute('data-role', 'remove');
        node.appendChild(removeButton);
        dragButton = document.createElement('div');
        dragButton.setAttribute('data-role', 'drag');
        node.appendChild(dragButton);
        labelInput.value = choice.text;
        return node;
    };
    ChoicesEditorInspectorPlugin.prototype.isUniqueSetOfChoices = function (choices) {
        if (!choices) {
            return true;
        }
        for (var i = 0, len = choices.length; i < len; i++) {
            for (var j = 0; j < i; j++) {
                if (choices[i].text === choices[j].text) {
                    return false;
                }
            }
        }
        return true;
    };
    ChoicesEditorInspectorPlugin.createUniqueChoice = function (usingTemplateChoice, inExistingSetOfChoices) {
        var autoIncrement = 0, baseChoiceText = usingTemplateChoice.text, isUnique, incrementedChoiceText;
        if (!inExistingSetOfChoices || !inExistingSetOfChoices.length) {
            return usingTemplateChoice;
        }
        do {
            isUnique = true;
            if (0 === autoIncrement) {
                incrementedChoiceText = baseChoiceText;
            }
            else {
                incrementedChoiceText = baseChoiceText + ' (' + autoIncrement + ')';
            }
            for (var i = 0, len = inExistingSetOfChoices.length; i < len; i++) {
                if (inExistingSetOfChoices[i].text === incrementedChoiceText) {
                    isUnique = false;
                    autoIncrement++;
                    break;
                }
            }
        } while (!isUnique);
        usingTemplateChoice.text = incrementedChoiceText;
        return usingTemplateChoice;
    };
    ChoicesEditorInspectorPlugin.prototype.editChoices = function () {
        var _this = this;
        this.dialogOptions.dialogTitle = this.dialogOptions.dialogTitle || 'Default choice';
        this.dialogOptions.newChoiceText = this.dialogOptions.newChoiceText || 'New Choice';
        this.dialogOptions.itemType = this.dialogOptions.itemType || 'CHOICE';
        var backupChoices = JSON.parse(JSON.stringify(this.dialogOptions.choices)), ui = this.dialogOptions.editorUserInterface, $ = this.dialogOptions.editorUserInterface.getEngine().getJQuery(), resourceManager = this.dialogOptions.editorUserInterface.getEngine().getResourceManager(), i18n = this.dialogOptions.editorUserInterface.getEngine().getI18n(), dispatcher = this.dialogOptions.editorUserInterface.getEngine().getLoader().getCommandDispatcher(), factory = this.dialogOptions.editorUserInterface.getEngine().getFactory();
        return $.Deferred(function (defer) {
            if (_this.dialogOptions && _this.dialogOptions.editingContext === 'QUIZ_OPTIONS') {
                if (!_this.userService.canUseQuizOptions()) {
                    dispatcher.triggerPaywall(EUpgradeReason.QUIZ_OPTIONS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN);
                    return;
                }
            }
            var editOptionDialog = '/modules/Typescript/Form/resources/edit-option-dialog.html', choices = _this.dialogOptions.choices, statements = [];
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                editOptionDialog = '/modules/Typescript/Form/resources/edit-option-dialog-likert.html';
                statements = _this.generateStatementsForSalvageModel();
                if (_this.dialogOptions.choices.length != 0) {
                    choices = _this.dialogOptions.choices[0];
                }
            }
            resourceManager.get(editOptionDialog)
                .then(function (templateText) {
                if (!(_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER)) {
                    for (var i = 0, len = choices.length; i < len; i++) {
                        var choice = choices[i];
                        if (!choice.isCorrect) {
                            choice.quizPoints = 0;
                        }
                        if (choice.numberOfTimesThisOptionHasBeenChosen < 0) {
                            choice.numberOfTimesThisOptionHasBeenChosen = 0;
                        }
                    }
                }
                var template = new Salvage(templateText), dialog, model = {
                    "choices": JSON.parse(JSON.stringify(choices)),
                    "inputType": _this.dialogOptions.defaultOptionInputType !== EChoiceDefaultOptionInputType.CHECKBOX,
                    "itemType": _this.dialogOptions.itemType,
                    "editingContext": _this.dialogOptions.editingContext,
                    "displayResetUsedChoicesOption": _this.isResetButtonVisibleInEditingPanel(choices),
                    "resetUsedColumnText": 'Reset used choices',
                    "resetUsedColumnTextI18n": 'edt_text_reset_used_choices',
                    "formTotalPointsText": 'Form total points:',
                    "formTotalPointsTextI18n": 'edt_text_form_total_points',
                    "formTotalPoints": FormUtils.getFormTotalPoints(_this.dialogOptions.editorUserInterface.getEngine().getDocument()),
                    "useDifferentValuesPerStatement": _this.dialogOptions.useDifferentValuesPerStatement,
                    "statements": statements
                };
                dialog = ui.createDialog(_this.dialogOptions.dialogTitle, [
                    {
                        type: EDialogButtonType.CANCEL,
                        callback: _this.onCancelButtonPress.bind(_this, backupChoices, defer)
                    },
                    {
                        type: EDialogButtonType.SAVE,
                        callback: _this.onSaveButtonPress.bind(_this, choices, ui, defer)
                    }
                ], {
                    width: "600px",
                    height: "600px"
                });
                dialog.body.setAttribute('data-dialog-role', 'edit-option');
                if (_this.dialogOptions && _this.dialogOptions.editingContext === 'CONFIGURE_VALUES') {
                    var setAllButtonContainer = document.createElement('div'), setAllButton = document.createElement('div'), edtSetToAll = document.createElement('div');
                    setAllButtonContainer.setAttribute('data-role', 'set-all-button-container');
                    setAllButton.setAttribute('data-role', 'set-all-button');
                    edtSetToAll.setAttribute('data-i18n-text', 'edt_set_to_all');
                    edtSetToAll.innerText = i18n.translateText('edt_set_to_all');
                    setAllButton.appendChild(edtSetToAll);
                    setAllButtonContainer.appendChild(setAllButton);
                    dialog.titlebody.appendChild(setAllButtonContainer);
                }
                _this.renderDialogBodyContent(dialog, template, model, i18n, dispatcher, $, choices, ui);
                var initialValue = 0, formTotalPointsWithoutCurrentControl;
                for (var i = 0, len = choices.length; i < len; i++) {
                    if (choices[i].isCorrect) {
                        initialValue = choices[i].quizPoints;
                        break;
                    }
                }
                formTotalPointsWithoutCurrentControl = FormUtils.getFormTotalPoints(_this.dialogOptions.editorUserInterface.getEngine().getDocument()) - initialValue;
                _this.attachDialogEvents($, dialog, ui, formTotalPointsWithoutCurrentControl, choices, model, template, i18n, dispatcher);
            })
                .fail(function (e) {
                defer.reject(e);
            });
        }).promise();
    };
    ChoicesEditorInspectorPlugin.prototype.onSaveButtonPress = function (choices, ui, defer, buttonType, dialog) {
        if (!(this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) && !this.isUniqueSetOfChoices(choices)) {
            ui.alert("Error Saving Choices", "You are not allowed to have 2 or more options with the same value");
            return;
        }
        dialog.close();
        defer.resolve(this.dialogOptions.choices);
    };
    ChoicesEditorInspectorPlugin.prototype.onCancelButtonPress = function (backupChoices, defer, buttonType, dialog) {
        this.dialogOptions.choices = backupChoices;
        dialog.close();
        defer.reject();
    };
    ;
    ChoicesEditorInspectorPlugin.prototype.generateStatementsForSalvageModel = function () {
        var statements = [], children = this.currentSelectedControl.getChildren();
        for (var i = 0, len = children.length; i < len; i++) {
            statements.push({
                'choices': JSON.parse(JSON.stringify(this.dialogOptions.choices[i])),
                'text': children[i].getProperty('label.labelText'),
                'index': i
            });
        }
        return statements;
    };
    ChoicesEditorInspectorPlugin.prototype.renderDialogBodyContent = function (dialog, template, model, i18n, dispatcher, $, choices, ui) {
        var _this = this;
        dialog.body.innerHTML = template.parse(model);
        i18n.translateDOMNode(dialog.body);
        dispatcher.addPerfectScrollbar(dialog.body);
        $(dialog.body).find('table tbody tr').each(function (index, element) {
            _this.updateNumberOfChoicesLeft($(element));
        });
        if ((model.editingContext === 'PAYMENTS_VALUES'
            && ((this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                && this.currentSelectedControl.hasProperty('options.useDifferentValuesPerStatement')
                && !this.currentSelectedControl.getProperty('options.useDifferentValuesPerStatement')) || !(this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER))) || model.editingContext !== 'PAYMENTS_VALUES') {
            this.makeChoicesInEditPanelSortable($, dialog.body);
        }
        ui.upgrade(dialog.body);
    };
    ChoicesEditorInspectorPlugin.prototype.attachDialogEvents = function ($, dialog, ui, formTotalPointsWithoutCurrentControl, choices, model, template, i18n, dispatcher) {
        var _this = this;
        $(dialog.body)
            .on('keydown', 'input[name=payments-values]', function (event) {
            var input = event.target;
            input.setAttribute('data-temp-value', input.value);
        })
            .on('input', 'input[name=payments-values]', function (event) {
            var input = event.target;
            if (input.value.length && !input.value.match(/^([0-9]+(\.[0-9]{1,2}|\.)?|\.[0-9]{1,2})$/)) {
                input.value = input.getAttribute('data-temp-value');
            }
        })
            .on('keyup', 'input[name=payments-values]', function (event) {
            var input = event.target;
            setTimeout(function () {
                input.removeAttribute('data-temp-value');
            }, 0);
        })
            .on('blur', 'input[name=payments-values]', function (event) {
            var input = event.target;
            if (input.value.indexOf('.') > -1) {
                var valueParts = input.value.split('.');
                var doUpdate = !valueParts[0].length || valueParts[1].length < 2;
                while (valueParts[1].length < 2) {
                    valueParts[1] += '0';
                }
                if (doUpdate) {
                    input.value = (valueParts[0] || '0') + '.' + valueParts[1];
                }
            }
        })
            .on('click', 'a[data-role=add-option]', function () {
            var input = $(dialog.body).find('tbody [data-role="choice"]:last-child [data-role="choice-name"] input')[0], newChoice = _this.insertNewChoice(dialog.body, _this.dialogOptions.newChoiceText, input, $);
            _this.makeChoicesInEditPanelSortable($, dialog.body);
            ui.upgrade(newChoice);
        })
            .on('input', 'td[data-role=choice-name] input[type=text]', function (event) {
            var input = event.target, value = input.value, parentRow = $(input).closest('tr'), statementIndex = ~~parentRow.attr('data-statement-index'), choiceIndex = ~~parentRow.attr('data-index'), changedChoice = _this.dialogOptions.choices[choiceIndex];
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                changedChoice = _this.dialogOptions.choices[statementIndex][choiceIndex];
                for (var i = 0, len = _this.dialogOptions.choices.length; i < len; i++) {
                    _this.dialogOptions.choices[i][choiceIndex].text = value;
                }
            }
            changedChoice.text = value;
        })
            .on('click', 'tr[data-role=choice] td[data-role=choice-name] div[data-role=remove]', function (event) {
            if (_this.dialogOptions.choices.length <= 1
                || (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                    && _this.dialogOptions.choices[0].length <= 1)) {
                return;
            }
            var removeButton = event.target, $choiceRow = $(removeButton).closest('[data-role=choice]'), $choicesContainer = $choiceRow.parent(), choiceIndex = ~~($choiceRow.attr('data-index'));
            $choiceRow.remove();
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                for (var i = 0, len1 = _this.dialogOptions.choices.length; i < len1; i++) {
                    _this.dialogOptions.choices[i].splice(choiceIndex, 1);
                    for (var j = 0, len2 = _this.dialogOptions.choices[i].length; j < len2; j++) {
                        if (_this.dialogOptions.choices[i][j].isCorrect) {
                            _this.updateFormTotalPoints(formTotalPointsWithoutCurrentControl, dialog.body, _this.dialogOptions.choices[i][j].quizPoints, $);
                        }
                        $choicesContainer.find('[data-role="choice"]').get(j).setAttribute('data-index', String(j));
                    }
                }
            }
            else {
                _this.dialogOptions.choices.splice(choiceIndex, 1);
                for (var i = 0, len = _this.dialogOptions.choices.length; i < len; i++) {
                    if (_this.dialogOptions.choices[i].isCorrect) {
                        _this.updateFormTotalPoints(formTotalPointsWithoutCurrentControl, dialog.body, _this.dialogOptions.choices[i].quizPoints, $);
                    }
                    $choicesContainer.find('[data-role="choice"]').get(i).setAttribute('data-index', String(i));
                }
            }
            _this.dialogOptions.choices = _this.reinitializeChoicesIndexes(_this.dialogOptions.choices);
        })
            .on('click', 'td[data-role=is-default-choice] input', function (event) {
            var input = event.target, choiceIndex = ~~$(input).closest('tr').attr('data-index');
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                for (var i = 0, len = _this.dialogOptions.choices.length; i < len; i++) {
                    for (var j = 0, len2 = _this.dialogOptions.choices[i].length; j < len2; j++) {
                        var isDefaultValue = false;
                        if (j === choiceIndex
                            && !_this.dialogOptions.choices[i][j].isDefault) {
                            isDefaultValue = true;
                        }
                        if (j === choiceIndex) {
                            input.checked = isDefaultValue;
                        }
                        _this.dialogOptions.choices[i][j].isDefault = isDefaultValue;
                    }
                }
            }
            else {
                for (var j = 0, len2 = _this.dialogOptions.choices.length; j < len2; j++) {
                    var isDefaultValue = false;
                    if ((_this.dialogOptions.defaultOptionInputType === EChoiceDefaultOptionInputType.CHECKBOX
                        && _this.dialogOptions.choices[j].isDefault === true
                        && j !== choiceIndex) || (j === choiceIndex
                        && !_this.dialogOptions.choices[j].isDefault)) {
                        isDefaultValue = true;
                    }
                    if (j === choiceIndex) {
                        input.checked = isDefaultValue;
                    }
                    _this.dialogOptions.choices[j].isDefault = isDefaultValue;
                }
            }
        })
            .on('keydown', 'input[type=text][data-role=choice-name]', function (event) {
            choices = (_this.dialogOptions.choices[0].length > 0
                ? _this.dialogOptions.choices[0]
                : _this.dialogOptions.choices);
            if ((event.keyCode || event.charCode) !== KeyboardUtils.KEY_ENTER
                || choices[choices.length - 1].text === null
                || choices[choices.length - 1].text === '') {
                return;
            }
            var input = event.target;
            _this.insertNewChoice(dialog.body, _this.dialogOptions.newChoiceText || 'New Choice', input, $);
            _this.makeChoicesInEditPanelSortable($, dialog.body);
        })
            .on('paste', 'td[data-role=choice-name] input[type=text]', function (event) {
            var dataAsText;
            var arrayOfValues = [];
            try {
                var input = event.target, originalEvent = event.originalEvent || {}, clipboardData = event.originalEvent['clipboardData'] || null;
                if (!clipboardData) {
                    return;
                }
                dataAsText = clipboardData.getData('text/plain');
                var cleanDataAsText = String(dataAsText || '')
                    .replace(/(^[\s]+|[\s]+$)/g, '');
                if (cleanDataAsText.indexOf('\n') > -1) {
                    arrayOfValues = cleanDataAsText.split('\n');
                }
                else {
                    return;
                }
                originalEvent.preventDefault();
                originalEvent.stopPropagation();
                for (var i = 0, len = arrayOfValues.length; i < len; i++) {
                    _this.insertNewChoice(dialog.body, arrayOfValues[i], input, $);
                }
                _this.makeChoicesInEditPanelSortable($, dialog.body);
            }
            catch (unknownBrowserException) {
                return;
            }
        })
            .on('input', 'td[data-role=total-number-of-choices] input[type=number]', function (event) {
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                || _this.dialogOptions.choices[0].length > 0) {
                return;
            }
            var input = event.target, rowIndex = ~~$(input).closest('tr').attr('data-index');
            _this.dialogOptions.choices[rowIndex].numberOfTimesThisOptionCanBeChosen = ~~input.value;
            $(input).closest('tr').each(function (index, element) {
                _this.updateNumberOfChoicesLeft($(element));
            });
        })
            .on('click', 'div[data-role=apply-all-button]', function () {
            var $defaultInput = $(dialog.body).find('input[type=number][name=apply-all-default-number-of-choices]'), defaultInput = $defaultInput.get(0), defaultInputValue = parseInt(defaultInput.value);
            if (defaultInputValue >= -1) {
                $(dialog.body).find('table tbody tr').each(function (index, element) {
                    $(element).find('td[data-role=total-number-of-choices] input[type=number]').val(defaultInputValue);
                    _this.updateNumberOfChoicesLeft($(element));
                });
                for (var i = 0; i < _this.dialogOptions.choices.length; i++) {
                    _this.dialogOptions.choices[i].numberOfTimesThisOptionCanBeChosen = defaultInputValue;
                }
            }
        })
            .on('click', 'a[data-role=reset-used-column]', function () {
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                || _this.dialogOptions.choices[0].length > 0) {
                return;
            }
            choices = _this.dialogOptions.choices;
            for (var i = 0, len = choices.length; i < len; i++) {
                choices[i].numberOfTimesThisOptionHasBeenChosen = -1;
            }
            $(dialog.body).find('table tbody tr').each(function (index, element) {
                var rowIndex = ~~$(element).attr('data-index');
                $(element).find('td[data-role=used-number-of-choices] div span').text('0');
                $(element).find('td[data-role=number-of-choices-left] div span').text(String(choices[rowIndex].numberOfTimesThisOptionCanBeChosen || '0'));
            });
        })
            .on('click', 'td[data-role=quiz-correct] input', function (event) {
            var input = event.target, choiceIndex = ~~$(input).closest('tr').attr('data-index'), $quizPointsInput = $(input).closest('tr').find('input[type=number][name=quiz-points]'), quizPointsInput = $quizPointsInput.get(0), allowUncheckCorrectChoice = true;
            _this.onCorrectChoiceCheckedStateModified(input, _this.dialogOptions, choiceIndex, quizPointsInput, allowUncheckCorrectChoice, $);
            if (input.checked) {
                setTimeout(function () {
                    $quizPointsInput.focus().select();
                }, 10);
            }
            else {
                var quizValue = _this.getQuizValue(quizPointsInput, $);
                $(dialog.body)
                    .find('div[data-role=form-total-points] span[data-role=form-total-points]')
                    .text(formTotalPointsWithoutCurrentControl + quizValue);
            }
        })
            .on('input', 'td[data-role=quiz-points] input[type=number]', function (event) {
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                || _this.dialogOptions.choices[0].length > 0) {
                return;
            }
            choices = _this.dialogOptions.choices;
            var input = event.target, quizPoints = ~~input.value;
            _this.setQuizValue(dialog.body, quizPoints, $);
            for (var i = 0, len = choices.length; i < len; i++) {
                if (choices[i].isCorrect) {
                    choices[i].quizPoints = quizPoints;
                }
            }
            _this.updateFormTotalPoints(formTotalPointsWithoutCurrentControl, dialog.body, ~~input.value, $);
        })
            .on('click focus', 'td[data-role=quiz-points] input', function (event) {
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                || _this.dialogOptions.choices[0].length > 0) {
                return;
            }
            choices = _this.dialogOptions.choices;
            var input = event.target, quizCorrectInput = $(input).closest('tr[data-role=choice]').find('td[data-role=quiz-correct] input').get(0), choiceIndex = ~~$(input).closest('tr').attr('data-index'), allowUncheckCorrectChoice = false;
            quizCorrectInput.checked = true;
            _this.onCorrectChoiceCheckedStateModified(quizCorrectInput, _this.dialogOptions, choiceIndex, input, allowUncheckCorrectChoice, $);
            for (var i = 0, len = choices.length; i < len; i++) {
                if (choices[i].isCorrect) {
                    choices[i].quizPoints = ~~input.value;
                }
            }
            _this.updateFormTotalPoints(formTotalPointsWithoutCurrentControl, dialog.body, ~~input.value, $);
        })
            .on('input', 'td[data-role=payments-values] input[type=text]', function (event) {
            var input = event.target, value = parseFloat(input.value), parentRow = $(input).closest('tr'), statementIndex = ~~parentRow.attr('data-statement-index'), choiceIndex = ~~parentRow.attr('data-index'), changedChoice = _this.dialogOptions.choices[choiceIndex];
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                changedChoice = _this.dialogOptions.choices[statementIndex][choiceIndex];
            }
            if (!isNaN(value) && value >= 0) {
                changedChoice.paymentsValue = value;
            }
            else {
                changedChoice.paymentsValue = null;
            }
        })
            .on('change', 'input#use-different-values-per-statement', function (event) {
            var inputNode = event.target, $tableContainer = $(dialog.body).find('div[data-editing-context][data-use-different-values]');
            _this.dialogOptions.useDifferentValuesPerStatement = inputNode.checked;
            $tableContainer.attr('data-use-different-values', String(inputNode.checked));
            model.useDifferentValuesPerStatement = _this.dialogOptions.useDifferentValuesPerStatement;
            model.choices = JSON.parse(JSON.stringify(_this.dialogOptions.choices[0]));
            model.statements = JSON.parse(JSON.stringify(_this.generateStatementsForSalvageModel()));
            _this.renderDialogBodyContent(dialog, template, model, i18n, dispatcher, $, choices, ui);
            if ((_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
                && !_this.dialogOptions.useDifferentValuesPerStatement) || !(_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER)) {
                _this.makeChoicesInEditPanelSortable($, dialog.body);
            }
        });
        $(dialog.titlebody).on('click', 'div[data-role=set-all-button-container]', function () {
            var $applyAllHolder = $(dialog.body).find('div[data-role=apply-all-holder]');
            if ($applyAllHolder.css('display') === 'none') {
                $applyAllHolder.css('display', 'inline-flex');
            }
            else {
                $applyAllHolder.hide();
            }
        });
    };
    ChoicesEditorInspectorPlugin.prototype.updateControlChoicesAndDOM = function (control, choices, $) {
        choices = this.getValidatedChoicesFromSet(choices);
        var inspector = document.getElementById('item');
        if (inspector.getAttribute('data-target-element') === control.getHash()) {
            var inputs = inspector.querySelectorAll('input[type=hidden][data-plugin=text-choice-interface]');
            var inputValue = choices.length
                ? JSON.stringify(choices)
                : 'null';
            for (var i = 0, len = inputs.length; i < len; i++) {
                $(inputs[i]).val(inputValue).trigger('reload');
            }
        }
        else {
            var hasPaymentsValues = false;
            var paymentsValues = [];
            for (var i = 0, len = choices.length; i < len; i++) {
                if (typeof choices[i].paymentsValue !== 'undefined' && choices[i].paymentsValue !== null) {
                    hasPaymentsValues = true;
                    paymentsValues.push(choices[i].paymentsValue);
                }
                else {
                    paymentsValues.push(null);
                }
            }
            control.setProperty('choices.values', choices);
            control.setProperty('payments.value', !hasPaymentsValues ? null : paymentsValues.map(function (v) { return Number(v); }));
            control.getForm().getEngine().getLoader().getCommandDispatcher().reloadVisiblePanel();
        }
    };
    ChoicesEditorInspectorPlugin.prototype.updateFormTotalPoints = function (formTotalPointsWithoutCurrentControl, container, value, $) {
        var totalPointsNewValue = formTotalPointsWithoutCurrentControl + ~~value;
        $(container)
            .find('div[data-role=form-total-points] span[data-role=form-total-points]')
            .text(totalPointsNewValue);
    };
    ChoicesEditorInspectorPlugin.prototype.getQuizValue = function (container, $) {
        var quizValue = 0;
        $(container).closest('table > tbody').find('input[type=number][name=quiz-points]').each(function () {
            if (this.value != 0) {
                quizValue = this.value;
                return quizValue;
            }
        });
        return ~~quizValue;
    };
    ChoicesEditorInspectorPlugin.prototype.setQuizValue = function (container, quizPoints, $) {
        $(container).find('input[type=number][name=quiz-points]').each(function () {
            if ($(this).closest('tr').find('[name=quiz-correct]').is(':checked')) {
                this.value = quizPoints;
            }
        });
    };
    ChoicesEditorInspectorPlugin.prototype.resetAllUncorrectChoicesPointsToZero = function (quizCorrectInput, quizPointsInput, options, $) {
        $(quizCorrectInput).closest('table > tbody').find('input[type=number][name=quiz-points]').each(function () {
            if (this !== quizPointsInput
                && !$(this).closest('tr').find('[name=quiz-correct]').is(':checked')) {
                options.choices = options.choices;
                var currentChoiceIndex = ~~$(this).closest('tr').attr('data-index');
                this.value = '0';
                options.choices[currentChoiceIndex].isCorrect = false;
                options.choices[currentChoiceIndex].quizPoints = 0;
            }
        });
    };
    ChoicesEditorInspectorPlugin.prototype.insertNewChoice = function (container, newChoiceText, targetElement, $) {
        var isModal = container.getAttribute('data-dialog-role') === 'edit-option', choices = (this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER)
            ? JSON.parse(JSON.stringify(this.dialogOptions.choices[0]))
            : JSON.parse(JSON.stringify(this.dialogOptions.choices)), targetRow = $(targetElement).closest('[data-role=choice]').get(0), newChoice = ChoicesEditorInspectorPlugin.createUniqueChoice({
            text: newChoiceText,
            isDefault: false,
            index: ~~targetRow.getAttribute('data-index') + 1,
            numberOfTimesThisOptionCanBeChosen: null,
            numberOfTimesThisOptionHasBeenChosen: null,
            isCorrect: false,
            quizPoints: 0,
            paymentsValue: null,
        }, choices), newlyInsertedRow;
        choices.push(newChoice);
        newlyInsertedRow = targetRow.cloneNode(true);
        var defaultOptionInput = $(newlyInsertedRow).find('td[data-role="is-default-choice"] input[name="default-option"]').get(0);
        if (defaultOptionInput) {
            defaultOptionInput.removeAttribute('checked');
            defaultOptionInput.checked = false;
        }
        $(newlyInsertedRow).insertAfter(targetRow);
        var choicesContainer = $(targetElement).closest('div[data-dialog-role=edit-option]');
        choicesContainer.scrollTop(choicesContainer.prop('scrollHeight'));
        if (this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
            var children = this.currentSelectedControl.getChildren();
            for (var i = 0, len = children.length; i < len; i++) {
                this.dialogOptions.choices[i].push(JSON.parse(JSON.stringify(newChoice)));
                if (!this.currentSelectedControl.hasProperty('options.useDifferentValuesPerStatement')
                    || !this.currentSelectedControl.getProperty('options.useDifferentValuesPerStatement')) {
                    for (var j = 0, len2 = this.dialogOptions.choices[i].length; j < len2; j++) {
                        this.dialogOptions.choices[i][j].paymentsValue = this.dialogOptions.choices[0][j].paymentsValue;
                    }
                }
            }
        }
        else {
            this.dialogOptions.choices = JSON.parse(JSON.stringify(choices));
        }
        if (isModal) {
            this.dialogOptions.choices = this.reinitializeChoicesIndexes(this.dialogOptions.choices);
        }
        else {
            this.dialogOptions.choices = this.reinitializeChoicesIndexes(this.dialogOptions.choices, $(container));
        }
        $(newlyInsertedRow)
            .find('td[data-role=choice-name] input[type=text]')
            .val(newChoice.text)
            .focus()
            .select();
        $(newlyInsertedRow)
            .find('td[data-role=total-number-of-choices] input[type=number]')
            .val(newChoice.numberOfTimesThisOptionCanBeChosen);
        $(newlyInsertedRow)
            .find('[data-role=used-number-of-choices] > span').text('0');
        $(newlyInsertedRow)
            .find('[data-role=number-of-choices-left] > span').text('0');
        $(newlyInsertedRow)
            .find('td[data-role=quiz-points] input[type=number]')
            .val(newChoice.quizPoints);
        $(newlyInsertedRow)
            .find('td[data-role=payments-values] input[type=number]')
            .val(String(newChoice.paymentsValue || ''));
        $(newlyInsertedRow)
            .find('td[data-role=payments-values] input[name=payments-values]')
            .val('');
        this.initializeNewlyInsertedRow(newlyInsertedRow, newChoice, $);
        if (this.dialogOptions.container) {
            this.updateContainerAttributes(this.dialogOptions.container);
        }
        return newlyInsertedRow;
    };
    ChoicesEditorInspectorPlugin.prototype.onCorrectChoiceCheckedStateModified = function (quizCorrectInput, options, choiceIndex, quizPointsInput, allowUncheckCorrectChoice, $) {
        options.choices = options.choices;
        this.resetAllUncorrectChoicesPointsToZero(quizCorrectInput, quizPointsInput, options, $);
        var quizValue = this.getQuizValue(quizCorrectInput, $);
        if (quizValue > 0) {
            $(quizPointsInput).val(quizValue);
        }
        if (allowUncheckCorrectChoice) {
            if (options.choices[choiceIndex].isCorrect) {
                quizCorrectInput.checked = false;
                quizPointsInput.value = '0';
            }
        }
        options.choices[choiceIndex].isCorrect = quizCorrectInput.checked;
        options.choices[choiceIndex].quizPoints = ~~quizPointsInput.value;
        if (options.defaultOptionInputType !== EChoiceDefaultOptionInputType.CHECKBOX) {
            for (var i = 0, len = options.choices.length; i < len; i++) {
                if (i != choiceIndex) {
                    options.choices[i].isCorrect = false;
                }
            }
        }
    };
    ChoicesEditorInspectorPlugin.prototype.updateNumberOfChoicesLeft = function ($row) {
        if ($row.find('[data-role=used-number-of-choices] > span').text() === null) {
            $row.find('[data-role=used-number-of-choices] > span').text('0');
        }
        var total = ~~$row.find('[name=total-number-of-choices]').val(), used = ~~$row.find('[data-role=used-number-of-choices] > span').text(), left = total - used;
        $row.find('[data-role=number-of-choices-left] > span').text(String(Math.max(0, left)));
    };
    ChoicesEditorInspectorPlugin.prototype.initializeNewlyInsertedRow = function (row, accordingToNewChoice, $) {
        $(row)
            .attr('data-index', (~~accordingToNewChoice.index).toString())
            .find('td[data-role=is-default-choice]')
            .each(function () {
            $(this).find('input').each(function () {
                this.checked = accordingToNewChoice.isDefault;
                this.setAttribute('id', 'choice-editor-' + (~~accordingToNewChoice.index).toString());
                this.setAttribute('index', (~~accordingToNewChoice.index).toString());
            });
            $(this).find('label').each(function () {
                this.setAttribute('for', 'choice-editor-' + (~~accordingToNewChoice.index).toString());
            });
        });
        $(row)
            .find('td[data-role=quiz-correct]')
            .each(function () {
            $(this).find('input').each(function () {
                this.checked = accordingToNewChoice.isCorrect;
                this.setAttribute('id', 'quiz-editor-' + (~~accordingToNewChoice.index).toString());
                this.setAttribute('index', (~~accordingToNewChoice.index).toString());
            });
            $(this).find('label').each(function () {
                this.setAttribute('for', 'quiz-editor-' + (~~accordingToNewChoice.index).toString());
            });
        });
    };
    ChoicesEditorInspectorPlugin.prototype.updateContainerAttributes = function (container) {
        var choices = this.dialogOptions.choices;
        if (this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
            choices = this.dialogOptions.choices[0];
        }
        container.setAttribute('data-truncate-options', String(~~(choices.length > ChoicesEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_CHOICES_IN_INSPECTOR_PANEL)));
    };
    ChoicesEditorInspectorPlugin.prototype.reinitializeChoicesIndexes = function (choices, $editorContainer) {
        if ($editorContainer) {
            $editorContainer.find('[data-role=choice]').remove();
            return this.resetChoicesIndex(choices, $editorContainer);
        }
        return this.resetChoicesIndex(choices);
    };
    ChoicesEditorInspectorPlugin.prototype.updateChoices = function (input, $, synchronizeOtherProperties) {
        var choices = this.getValidatedChoicesFromSet(this.dialogOptions.choices);
        input.value = choices.length
            ? JSON.stringify(choices)
            : 'null';
        $(input).trigger('input');
        if (synchronizeOtherProperties) {
            $(synchronizeOtherProperties).val(input.value).trigger('reload');
        }
    };
    ChoicesEditorInspectorPlugin.prototype.getValidatedChoicesFromSet = function (choices) {
        var result = [], choice;
        for (var i = 0, len = choices.length; i < len; i++) {
            if (Array.isArray(choices[i])) {
                var desiredIndex = i;
                result[i] = this.getValidatedChoicesFromSet(choices[desiredIndex]);
                continue;
            }
            var indexedChoice = choices[i];
            choice = {
                text: window.removeDangerousHtmlAttributes(indexedChoice.text)
            };
            if (undefined !== indexedChoice.isOther) {
                choice.isOther = indexedChoice.isOther;
            }
            if (undefined !== indexedChoice.isCorrect) {
                choice.isCorrect = indexedChoice.isCorrect;
            }
            if (undefined !== indexedChoice.isDefault) {
                choice.isDefault = indexedChoice.isDefault;
            }
            if (undefined !== indexedChoice.numberOfTimesThisOptionCanBeChosen) {
                choice.numberOfTimesThisOptionCanBeChosen = indexedChoice.numberOfTimesThisOptionCanBeChosen;
            }
            if (undefined !== indexedChoice.numberOfTimesThisOptionHasBeenChosen) {
                choice.numberOfTimesThisOptionHasBeenChosen = indexedChoice.numberOfTimesThisOptionHasBeenChosen;
            }
            if (undefined !== indexedChoice.quizPoints) {
                choice.quizPoints = indexedChoice.quizPoints;
            }
            if (undefined !== indexedChoice.paymentsValue) {
                choice.paymentsValue = indexedChoice.paymentsValue;
            }
            result.push(choice);
        }
        return result;
    };
    ChoicesEditorInspectorPlugin.prototype.isResetButtonVisibleInEditingPanel = function (choices) {
        for (var i = 0, len = choices.length; i < len; i++) {
            if (choices[i].numberOfTimesThisOptionHasBeenChosen !== null && choices[i].numberOfTimesThisOptionHasBeenChosen > 0) {
                return true;
            }
        }
        return false;
    };
    ChoicesEditorInspectorPlugin.prototype.makeChoicesInInspectorSortable = function ($, container, input, synchronizeOtherProperties) {
        var _this = this;
        var throttledChoiceReorderCallback = Throttle.create(function () {
            _this.reorderOptionsInInspector($, container, input, synchronizeOtherProperties);
        }, 100);
        SortablePlugin.makeSortable($, container, 'div[data-role=choice] div[data-role=drag]', 'div[data-role=choice]', function (elementSource, elementDestination, sortPosition) {
            throttledChoiceReorderCallback();
        }, function (elementSource, elementDestination, sortPosition) {
            var parent = elementSource.parentNode;
            if (sortPosition === SortablePluginPosition.BEFORE) {
                parent.insertBefore(elementSource, elementDestination);
            }
            else {
                parent.insertBefore(elementSource, elementDestination.nextSibling);
            }
            throttledChoiceReorderCallback();
        });
    };
    ChoicesEditorInspectorPlugin.prototype.makeChoicesInEditPanelSortable = function ($, container) {
        var _this = this;
        var throttledChoiceReorderInPanelCallback = Throttle.create(function () {
            _this.reorderOptionsInEditPanel($, container);
        }, 100);
        SortablePlugin.makeSortable($, container, 'table[data-role=edit-option] tr[data-role=choice] td[data-role=choice-name] div[data-role=drag]', 'table[data-role=edit-option] tr[data-role=choice]', function (elementSource, elementDestination, sortPosition) {
            throttledChoiceReorderInPanelCallback();
        }, function (elementSource, elementDestination, sortPosition) {
            var parent = elementSource.parentNode;
            if (sortPosition === SortablePluginPosition.BEFORE) {
                parent.insertBefore(elementSource, elementDestination);
            }
            else {
                parent.insertBefore(elementSource, elementDestination.nextSibling);
            }
            throttledChoiceReorderInPanelCallback();
        });
    };
    ChoicesEditorInspectorPlugin.prototype.onOptionsReorderedByDragAndDrop = function ($, container, choicesSelector) {
        var _this = this;
        var choices = this.dialogOptions.choices, needToTriggerChange = false;
        $(container).find(choicesSelector).each(function (choiceIndex, choiceNode) {
            var choiceIndexAttributeValue = ~~choiceNode.getAttribute('data-index');
            if (choiceIndex !== choiceIndexAttributeValue) {
                needToTriggerChange = true;
                if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                    for (var i = 0, len = _this.dialogOptions.choices.length; i < len; i++) {
                        choices = _this.dialogOptions.choices[i];
                        choices[choiceIndexAttributeValue].index = choiceIndex;
                    }
                }
                else {
                    choices[choiceIndexAttributeValue].index = choiceIndex;
                }
                choiceNode.setAttribute('data-index', String(choiceIndex));
            }
        });
        if (!needToTriggerChange) {
            return;
        }
        if (this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
            for (var i = 0, len = this.dialogOptions.choices.length; i < len; i++) {
                choices = this.dialogOptions.choices[i];
                choices.sort(function (a, b) {
                    return a.index - b.index;
                });
            }
        }
        else {
            choices.sort(function (a, b) {
                return a.index - b.index;
            });
        }
    };
    ChoicesEditorInspectorPlugin.prototype.reorderOptionsInInspector = function ($, container, input, synchronizeOtherProperties) {
        this.onOptionsReorderedByDragAndDrop($, container, '[data-role=choice]');
        this.updateChoices(input, $, synchronizeOtherProperties);
    };
    ChoicesEditorInspectorPlugin.prototype.reorderOptionsInEditPanel = function ($, container) {
        var _this = this;
        var choicesSelector = '[data-role=choice]';
        if (this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
            choicesSelector = 'div[data-editing-context="PAYMENTS_VALUES"][data-use-different-values="true"] table[data-role="edit-option"] tbody[data-role="multi-statement-choices"] ' + choicesSelector
                + ', div[data-editing-context="PAYMENTS_VALUES"][data-use-different-values="false"] table[data-role="edit-option"] tbody[data-role="single-statement-choices"] ' + choicesSelector
                + ', div:not([data-editing-context="PAYMENTS_VALUES"]) table[data-role="edit-option"] tbody[data-role="single-statement-choices"] ' + choicesSelector;
        }
        this.onOptionsReorderedByDragAndDrop($, container, choicesSelector);
        $(container).find(choicesSelector).each(function (choiceIndex, choiceNode) {
            var choices = _this.dialogOptions.choices;
            if (_this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                choices = _this.dialogOptions.choices[0];
            }
            _this.initializeNewlyInsertedRow(choiceNode, choices[choiceIndex], $);
        });
    };
    ChoicesEditorInspectorPlugin.prototype.resetChoicesIndex = function (initializeOptions, $targetContainer) {
        if (this.currentSelectedControl.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
            for (var i = 0, len1 = initializeOptions.length; i < len1; i++) {
                for (var j = 0, len2 = initializeOptions[i].length; j < len2; j++) {
                    initializeOptions[i][j].index = j;
                    if (i === 0 && $targetContainer) {
                        $targetContainer.append(this.createChoiceElement(initializeOptions[i][j]));
                    }
                }
            }
        }
        else {
            for (var i = 0, len = initializeOptions.length; i < len; i++) {
                initializeOptions[i].index = i;
                if ($targetContainer) {
                    $targetContainer.append(this.createChoiceElement(initializeOptions[i]));
                }
            }
        }
        return initializeOptions;
    };
    ChoicesEditorInspectorPlugin.prototype.setDialogOptions = function (options) {
        options.choices = this.resetChoicesIndex(options.choices);
        this.dialogOptions = options;
    };
    ChoicesEditorInspectorPlugin.prototype.setCurrentSelectedControl = function (engine, control) {
        if (undefined !== control) {
            this.currentSelectedControl = control;
            return;
        }
        var selectedControls = engine.getLoader().getSelection().getItems();
        if (selectedControls.length !== 0) {
            this.currentSelectedControl = selectedControls[0];
        }
    };
    ChoicesEditorInspectorPlugin.NAME = 'ChoicesEditorInspectorPlugin';
    ChoicesEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_CHOICES_IN_INSPECTOR_PANEL = 4;
    return ChoicesEditorInspectorPlugin;
}());
var CaptchaConfigurationInspectorPlugin = (function () {
    function CaptchaConfigurationInspectorPlugin() {
    }
    CaptchaConfigurationInspectorPlugin.prototype.getName = function () {
        return CaptchaConfigurationInspectorPlugin.NAME;
    };
    CaptchaConfigurationInspectorPlugin.prototype.upgrade = function ($, container) {
        (function (self) {
            $(container).find('input[data-plugin=captcha-configuration-type]').each(function () {
                (function (input) {
                    $(input)
                        .closest('label')
                        .find('div[data-role=secondary][data-plugin-type=captcha-configuration-type]')
                        .each(function () {
                        (function (container) {
                            $(container).on('click', 'input[type=radio]', function () {
                                var value = this.value;
                                input.value = this.value;
                                $(input).trigger('input');
                            });
                            var currentCaptchaValue = JSON.parse(input.getAttribute('data-value'));
                            $(container).find('input[type=radio]').each(function () {
                                this.checked = ~~this.value === currentCaptchaValue;
                            });
                        })(this);
                    });
                })(this);
            });
        })(this);
    };
    CaptchaConfigurationInspectorPlugin.NAME = 'CaptchaConfigurationInspectorPlugin';
    return CaptchaConfigurationInspectorPlugin;
}());
var TextAppearanceDropDownInspectorPlugin = (function () {
    function TextAppearanceDropDownInspectorPlugin() {
    }
    TextAppearanceDropDownInspectorPlugin.prototype.getName = function () {
        return TextAppearanceDropDownInspectorPlugin.NAME;
    };
    TextAppearanceDropDownInspectorPlugin.prototype.getPluginOptions = function (pluginOptionsAttributeValue) {
        var opts = String(pluginOptionsAttributeValue || '').toLowerCase().split(/[\s,]+/), result = [];
        for (var i = 0, len = opts.length; i < len; i++) {
            if (opts[i]) {
                result.push(opts[i]);
            }
        }
        return result.length
            ? result
            : null;
    };
    TextAppearanceDropDownInspectorPlugin.prototype.hasPluginOption = function (options, option) {
        if (!options || !option) {
            return false;
        }
        else {
            return options.indexOf(option) > -1;
        }
    };
    TextAppearanceDropDownInspectorPlugin.prototype.createOverlayOptionHeaderElement = function (canAddNewItem, dropdownEmptyStateOptionText, hasPluginSelectAllSelectNone) {
        var header = document.createElement('div'), a, span;
        header.setAttribute('data-role', 'header');
        if (canAddNewItem) {
            a = document.createElement('a');
            a.setAttribute('data-role', 'header-command');
            a.setAttribute('data-command', 'add-item');
            a.href = 'javascript:;';
            a.textContent = 'Add';
            header.appendChild(a);
        }
        if (dropdownEmptyStateOptionText) {
            span = document.createElement('span');
            span.appendChild(document.createTextNode(dropdownEmptyStateOptionText));
            span.setAttribute('data-is-disabled', '1');
            header.appendChild(span);
        }
        if (hasPluginSelectAllSelectNone) {
            a = document.createElement('a');
            a.setAttribute('data-role', 'header-command');
            a.setAttribute('data-command', 'select-all');
            a.href = 'javascript:;';
            a.textContent = 'All';
            a.title = 'Select All';
            header.appendChild(a);
            a = document.createElement('a');
            a.setAttribute('data-role', 'header-command');
            a.setAttribute('data-command', 'select-none');
            a.href = 'javascript:;';
            a.textContent = 'None';
            a.title = 'Deselect All';
            header.appendChild(a);
        }
        return header;
    };
    TextAppearanceDropDownInspectorPlugin.prototype.addNewItem = function (callbackText, options, inOverlay) {
        var promise;
        try {
            promise = eval(callbackText);
            if (!promise || !promise.then || 'function' !== typeof promise.then || !promise.fail || 'function' !== typeof promise.fail || !promise.always || 'function' !== typeof promise.always) {
                throw new Error('The returned eval\'d text ' + JSON.stringify(callbackText) + ' does not seem to be a JQueryPromise!');
            }
        }
        catch (e) {
            console.warn('Failed executing callback: ' + JSON.stringify(callbackText) + ' while running the add option plugin. Exception is shown in console!');
            console.error(e);
            return;
        }
        promise.then(function (newOption) {
            var option = {}, row;
            if (!newOption) {
                throw new Error('Promise did not returned a valid option!');
            }
            if ('string' === typeof newOption || 'number' === typeof newOption) {
                option.text = option.value = String(newOption);
                option.selected = false;
            }
            else {
                option.text = newOption.text || newOption.value || null;
                option.value = newOption.value || null;
                option.selected = !!newOption.selected;
                if (null === option.text || null === option.value) {
                    throw new Error('Promise did not returned a valid option!');
                }
            }
            for (var i = 0, len = options.length; i < len; i++) {
                if (options[i].value === option.value) {
                    throw new Error('Adding duplicate options is not supported!');
                }
            }
            row = document.createElement('div');
            row.setAttribute('data-value', JSON.stringify(option.value));
            row.textContent = option.text;
            if (option.selected) {
                row.setAttribute('data-is-selected', '');
            }
            inOverlay.appendChild(row);
            options.push(option);
            try {
                row.scrollIntoView();
            }
            catch (e) { }
        });
    };
    TextAppearanceDropDownInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        (function (self) {
            $(container).find('select[data-appearance=text]').each(function () {
                (function (dropdownElement) {
                    $(dropdownElement).closest('label').attr('data-has-text-dropdown', '1');
                    var replaceInput = document.createElement('input'), elementContainer = document.createElement('div'), options = [], caption, isMultiple = dropdownElement.hasAttribute('multiple'), emptyStateLabel = dropdownElement.getAttribute('data-empty-state-label') || '0 selected', isJSONValue = dropdownElement.hasAttribute('data-is-json-value'), pluginOptions = dropdownElement.hasAttribute('data-plugin-options')
                        ? self.getPluginOptions(dropdownElement.getAttribute('data-plugin-options'))
                        : null, allowNewItemAdd = dropdownElement.hasAttribute('data-allow-addition') && dropdownElement.hasAttribute("data-add-new-item-callback"), newItemAddCallback = dropdownElement.getAttribute("data-add-new-item-callback") || null, dropdownEmptyStateOptionText = dropdownElement.hasAttribute("data-dropdown-empty-state-option-i18n")
                        && editorUserInterface.getEngine().getI18n().translateText(dropdownElement.getAttribute("data-dropdown-empty-state-option-i18n"))
                        ? editorUserInterface.getEngine().getI18n().translateText(dropdownElement.getAttribute("data-dropdown-empty-state-option-i18n"))
                        : dropdownElement.hasAttribute("data-dropdown-empty-state-option")
                            ? dropdownElement.getAttribute("data-dropdown-empty-state-option") || null
                            : null, hasPluginSelectAllSelectNone = self.hasPluginOption(pluginOptions, TextAppearanceDropDownInspectorPlugin.PLUGIN_SELECT_ALL_SELECT_NONE);
                    if (dropdownElement.hasAttribute('data-value')) {
                        if (!isMultiple) {
                            dropdownElement.value = dropdownElement.getAttribute('data-value');
                        }
                        dropdownElement.removeAttribute('data-value');
                    }
                    if (dropdownElement.hasAttribute('data-skip-errors')) {
                        elementContainer.setAttribute('data-skip-errors', '1');
                    }
                    replaceInput.setAttribute('type', 'hidden');
                    for (var i = 0, len = dropdownElement.attributes.length; i < len; i++) {
                        if (!replaceInput.hasAttribute(dropdownElement.attributes[i].name)) {
                            replaceInput.setAttribute(dropdownElement.attributes[i].name, dropdownElement.attributes[i].value);
                        }
                    }
                    dropdownElement.parentNode.insertBefore(replaceInput, dropdownElement);
                    dropdownElement.parentNode.insertBefore(elementContainer, dropdownElement);
                    dropdownElement.parentNode.removeChild(dropdownElement);
                    for (var i = 0, len = dropdownElement.options.length; i < len; i++) {
                        options.push({
                            value: dropdownElement.options[i].value,
                            text: dropdownElement.options[i].text,
                            i18nText: dropdownElement.options[i].hasAttribute('data-i18n-text')
                                ? dropdownElement.options[i].getAttribute('data-i18n-text') || null
                                : null,
                            selected: dropdownElement.options[i].selected,
                            webfontClass: dropdownElement.options[i].hasAttribute('data-is-webfont')
                                ? dropdownElement.options[i].getAttribute('data-webfont-class') || null
                                : null
                        });
                    }
                    if (options.length) {
                        dropdownEmptyStateOptionText = null;
                    }
                    self.notifyChangeEvent(replaceInput, isMultiple, dropdownElement.value, options, $, isJSONValue, false);
                    caption = self.getElementCaption(options, dropdownElement.value, isMultiple, emptyStateLabel, editorUserInterface);
                    elementContainer.textContent
                        = elementContainer.title
                            = self.getTransformedTextCaption(caption, pluginOptions);
                    if ('' === caption) {
                        elementContainer.setAttribute('data-is-not-selected', '1');
                    }
                    else {
                        elementContainer.removeAttribute('data-is-not-selected');
                    }
                    elementContainer.setAttribute('data-role', 'text-dropdown');
                    $(elementContainer).on('click', function (e) {
                        if (elementContainer.hasAttribute('data-is-opened')) {
                            return;
                        }
                        if ($(elementContainer).closest('#item')
                            && $(elementContainer).closest('#item').attr('data-autosubmit-enabled')
                            && Number($(elementContainer).closest('#item').attr('data-autosubmit-enabled')) === 1) {
                            return;
                        }
                        e.stopPropagation();
                        e.preventDefault();
                        elementContainer.setAttribute('data-is-opened', '1');
                        var overlayElement = document.createElement('div'), optionElement;
                        overlayElement.setAttribute('data-role', 'text-dropdown-overlay');
                        if (isMultiple) {
                            overlayElement.setAttribute('data-is-multiple', '');
                        }
                        if (allowNewItemAdd || dropdownEmptyStateOptionText || hasPluginSelectAllSelectNone) {
                            overlayElement.appendChild(self.createOverlayOptionHeaderElement(allowNewItemAdd, dropdownEmptyStateOptionText, hasPluginSelectAllSelectNone));
                        }
                        for (var i = 0, len = options.length; i < len; i++) {
                            optionElement = document.createElement('div');
                            optionElement.setAttribute('data-value', JSON.stringify(options[i].value));
                            if (options[i].i18nText) {
                                optionElement.setAttribute('data-i18n-text', options[i].i18nText);
                            }
                            if (options[i].webfontClass) {
                                optionElement.setAttribute('data-is-webfont', '1');
                                optionElement.setAttribute('data-webfont-class', options[i].webfontClass);
                            }
                            optionElement.textContent = self.getTransformedTextCaption(options[i].text, pluginOptions);
                            self.transformOptionElement(optionElement, options[i], pluginOptions);
                            overlayElement.appendChild(optionElement);
                            if (options[i].selected) {
                                optionElement.setAttribute('data-is-selected', '');
                            }
                            else {
                                optionElement.removeAttribute('data-is-selected');
                            }
                        }
                        editorUserInterface.getEngine().getI18n().translateDOMNode(overlayElement);
                        var bodyClickEventListener = function (e) {
                            var clickedTargetElement = (e.srcElement || e.target);
                            if (clickedTargetElement === overlayElement
                                || $.contains(overlayElement, clickedTargetElement)
                                || clickedTargetElement === elementContainer) {
                                return;
                            }
                            elementContainer.removeAttribute('data-is-opened');
                            $(overlayElement).remove();
                            document.body.removeEventListener('mousedown', bodyClickEventListener, true);
                            bodyClickEventListener = null;
                        };
                        var dialog;
                        if (FormUtils.isMobile()) {
                            var closeCallback = function () {
                                elementContainer.removeAttribute('data-is-opened');
                                dialog.close();
                            };
                            var dialogButtons = isMultiple ? [{
                                    type: EDialogButtonType.DONE,
                                    callback: closeCallback
                                }] : [];
                            var overlayWrapper = document.createElement('div');
                            overlayWrapper.setAttribute('data-role', 'text-dropdown');
                            overlayWrapper.appendChild(overlayElement);
                            var ui = editorUserInterface.getEngine().getLoader().getUI();
                            var i18n = editorUserInterface.getEngine().getI18n();
                            dialog = ui.createDialog(i18n.translateText('edt_dropdown_UI_please_choose'), dialogButtons, { width: '100%', height: '100%', onCloseButtonClick: closeCallback });
                            dialog.body.appendChild(overlayWrapper);
                        }
                        else {
                            elementContainer.appendChild(overlayElement);
                            var parentClientRect = elementContainer.getBoundingClientRect(), windowClientRect = document.body.getBoundingClientRect(), containerClientRect = container.getBoundingClientRect(), relevantWindowRect = (windowClientRect.height + windowClientRect.top > containerClientRect.height)
                                ? containerClientRect
                                : windowClientRect;
                            if ((relevantWindowRect.bottom - parentClientRect.bottom) > overlayElement.offsetHeight) {
                                elementContainer.setAttribute('data-dropdown-position', 'bottom');
                            }
                            else {
                                elementContainer.setAttribute('data-dropdown-position', 'top');
                                if ((parentClientRect.top - relevantWindowRect.top) < overlayElement.offsetHeight + 5) {
                                    overlayElement.style.bottom = '-' + ((overlayElement.offsetHeight - (parentClientRect.bottom - relevantWindowRect.top)) + 5) + 'px';
                                }
                            }
                            document.body.addEventListener('mousedown', bodyClickEventListener, true);
                        }
                        $(overlayElement).on('click', '> div', function (e) {
                            if (this.hasAttribute('data-value')) {
                                editorUserInterface.getEngine().getLoader().execCommand('track-event', 'edt_property_dropdown_click');
                                var elementValue = JSON.parse(this.getAttribute('data-value')), caption_1;
                                self.updateSelectedState(options, isMultiple, elementValue);
                                self.notifyChangeEvent(replaceInput, isMultiple, elementValue, options, $, isJSONValue);
                                $(overlayElement).find('> div[data-value]').each(function (index) {
                                    if (options[index].selected) {
                                        this.setAttribute('data-is-selected', '');
                                    }
                                    else {
                                        this.removeAttribute('data-is-selected');
                                    }
                                });
                                caption_1 = self.getElementCaption(options, replaceInput.value, isMultiple, emptyStateLabel, editorUserInterface);
                                elementContainer.title = caption_1;
                                if (!isMultiple) {
                                    elementContainer.textContent = self.getTransformedTextCaption(caption_1, pluginOptions);
                                    setTimeout(function () {
                                        elementContainer.removeAttribute('data-is-opened');
                                    }, 10);
                                    if (FormUtils.isMobile()) {
                                        dialog && dialog.close();
                                    }
                                    else {
                                        $(overlayElement).remove();
                                    }
                                    if ('' === caption_1) {
                                        elementContainer.setAttribute('data-is-not-selected', '1');
                                    }
                                    else {
                                        elementContainer.removeAttribute('data-is-not-selected');
                                    }
                                    document.body.removeEventListener('mousedown', bodyClickEventListener, true);
                                }
                                else {
                                    elementContainer.childNodes[0].textContent = self.getTransformedTextCaption(caption_1, pluginOptions);
                                }
                            }
                            else {
                                if (this.getAttribute('data-role') != 'header') {
                                    return;
                                }
                                var target = e.srcElement || e.target;
                                switch (true) {
                                    case $(target).is('[data-role=header-command][data-command=add-item]'):
                                        self.addNewItem(newItemAddCallback, options, overlayElement);
                                        break;
                                    case $(target).is('[data-role=header-command][data-command=select-all]'):
                                        if (isMultiple) {
                                            self.setItemsSelectedState(true, options, overlayElement, $);
                                            self.notifyChangeEvent(replaceInput, isMultiple, null, options, $, isJSONValue);
                                            caption = self.getElementCaption(options, replaceInput.value, isMultiple, emptyStateLabel, editorUserInterface);
                                            elementContainer.title = caption;
                                            elementContainer.childNodes[0].textContent = self.getTransformedTextCaption(caption, pluginOptions);
                                        }
                                        break;
                                    case $(target).is('[data-role=header-command][data-command=select-none]'):
                                        if (isMultiple) {
                                            self.setItemsSelectedState(false, options, overlayElement, $);
                                            self.notifyChangeEvent(replaceInput, isMultiple, null, options, $, isJSONValue);
                                            caption = self.getElementCaption(options, replaceInput.value, isMultiple, emptyStateLabel, editorUserInterface);
                                            elementContainer.title = caption;
                                            elementContainer.childNodes[0].textContent = self.getTransformedTextCaption(caption, pluginOptions);
                                        }
                                        break;
                                }
                            }
                        }).on('mousewheel', function (e) {
                            e.stopPropagation();
                        });
                    });
                })(this);
            });
        })(this);
    };
    TextAppearanceDropDownInspectorPlugin.prototype.transformOptionElement = function (optionElement, option, pluginOptions) {
        if (option && this.hasPluginOption(pluginOptions, TextAppearanceDropDownInspectorPlugin.PLUGIN_OPTION_FONT_DROPDOWN)) {
            optionElement.title = optionElement.innerText;
            if (optionElement.hasAttribute('data-is-webfont')) {
                optionElement.innerText = '';
                optionElement.className += ' ' + optionElement.getAttribute('data-webfont-class') + ' gf-123';
            }
            else {
                optionElement.style.fontFamily = option.value || option.text || '';
                optionElement.setAttribute('data-is-font-style-option', '');
            }
        }
    };
    TextAppearanceDropDownInspectorPlugin.prototype.notifyChangeEvent = function (input, isMultiple, elementValue, options, $, isJSONValue, triggerChange) {
        if (triggerChange === void 0) { triggerChange = true; }
        if (!isMultiple) {
            input.value = isJSONValue
                ? JSON.stringify(elementValue)
                : elementValue;
        }
        else {
            var result = [];
            for (var i = 0, len = options.length; i < len; i++) {
                if (options[i].selected) {
                    result.push(options[i].value);
                }
            }
            input.value = isJSONValue
                ? JSON.stringify(result)
                : result.join(',');
        }
        if (triggerChange) {
            $(input).trigger('input');
        }
    };
    TextAppearanceDropDownInspectorPlugin.prototype.updateSelectedState = function (options, isMultiple, elementValue) {
        for (var i = 0, len = options.length; i < len; i++) {
            if (isMultiple) {
                if (options[i].value === elementValue) {
                    options[i].selected = !options[i].selected;
                }
            }
            else {
                options[i].selected = options[i].value === elementValue;
            }
        }
    };
    TextAppearanceDropDownInspectorPlugin.prototype.getTransformedTextCaption = function (caption, options) {
        if (this.hasPluginOption(options, TextAppearanceDropDownInspectorPlugin.PLUGIN_OPTION_FONT_DROPDOWN)) {
            return String(caption || '').replace(/,(.*)$/g, '');
        }
        return caption;
    };
    TextAppearanceDropDownInspectorPlugin.prototype.getElementCaption = function (options, value, isMultiple, multipleEmptyStateLabel, editorUserInterface) {
        var i18n = editorUserInterface.getEngine().getI18n();
        if (!isMultiple) {
            for (var i = 0, len = options.length; i < len; i++) {
                if (String(options[i].value) === String(value)) {
                    return options[i].i18nText && options[i].i18nText !== i18n.translateText(options[i].i18nText)
                        ? i18n.translateText(options[i].i18nText)
                        : options[i].text || '';
                }
            }
            return '';
        }
        else {
            var numberOfSelectedOptions = 0, selectedKey = 'edt_text_element_caption_selected', selectedKeyTranslation = i18n.translateText(selectedKey) && selectedKey !== i18n.translateText(selectedKey)
                ? i18n.translateText(selectedKey)
                : null, selectedStringI18n = selectedKeyTranslation
                ? " " + selectedKeyTranslation
                : " selected";
            for (var i = 0, len = options.length; i < len; i++) {
                if (options[i].selected) {
                    numberOfSelectedOptions++;
                }
            }
            return !numberOfSelectedOptions
                ? multipleEmptyStateLabel
                : numberOfSelectedOptions + selectedStringI18n;
        }
    };
    TextAppearanceDropDownInspectorPlugin.prototype.setItemsSelectedState = function (selectedState, options, overlayElement, $) {
        if (!options) {
            return;
        }
        for (var i = 0, len = options.length; i < len; i++) {
            options[i].selected = selectedState;
        }
        $(overlayElement).find('> div[data-value]').each(function () {
            if (selectedState) {
                this.setAttribute('data-is-selected', '');
            }
            else {
                this.removeAttribute('data-is-selected');
            }
        });
    };
    TextAppearanceDropDownInspectorPlugin.NAME = 'TextAppearanceDropDownInspectorPlugin';
    TextAppearanceDropDownInspectorPlugin.PLUGIN_OPTION_FONT_DROPDOWN = 'font-dropdown';
    TextAppearanceDropDownInspectorPlugin.PLUGIN_SELECT_ALL_SELECT_NONE = 'select-all';
    return TextAppearanceDropDownInspectorPlugin;
}());
var LikertStatementsEditorInspectorPlugin = (function () {
    function LikertStatementsEditorInspectorPlugin() {
        if (!window['userService']) {
            throw new Error('Dependency not found: userService');
        }
        this.userService = window['userService'].getInstance();
    }
    LikertStatementsEditorInspectorPlugin.prototype.getName = function () {
        return LikertStatementsEditorInspectorPlugin.NAME;
    };
    LikertStatementsEditorInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        (function (self) {
            $(container).find('input[type=hidden][data-plugin=likert-wrapper-choice-stament][data-value]').each(function () {
                (function (input) {
                    var initializeStatementsAsString = input.getAttribute('data-value'), initializeStatements = [], newStatementText = input.getAttribute('data-new-statement-title') || 'New Statement', newStatementTextI18n = input.getAttribute('data-new-statement-title-i18n'), maximumAllowedStatementsNumber = editorUserInterface.getEngine().getCapabilities().factory.maxLikertStatements, context = ~~input.getAttribute('data-context');
                    input.removeAttribute('data-value');
                    if (initializeStatementsAsString) {
                        initializeStatements = JSON.parse(initializeStatementsAsString) || [];
                    }
                    $(input).parent().find('[data-role=secondary]').each(function () {
                        $(input).closest('label').after(this);
                        (function (container) {
                            var $targetContainer = $(container).find('[data-role=container]');
                            for (var i = 0, len = initializeStatements.length; i < len; i++) {
                                initializeStatements[i].index = i;
                                $targetContainer.append(self.createI18nStatementElement(initializeStatements[i], initializeStatements[i].index));
                            }
                            self.updateContainerAttributes(container, initializeStatements);
                            self.makeStatementsInInspectorSortable(self, $, container, initializeStatements, input);
                            $(container)
                                .on('input', 'div[data-role=statement] input[type=text]', function (e) {
                                var statementIndex = ~~$(this).closest('[data-role=statement]').attr('data-index');
                                if (initializeStatements[statementIndex]) {
                                    initializeStatements[statementIndex].text = this.value;
                                    self.updateStatements(initializeStatements, input, $);
                                }
                            })
                                .on('click', 'div[data-role=statement] div[data-role=remove]', function (e) {
                                if (initializeStatements.length <= 1) {
                                    return;
                                }
                                editorUserInterface.getEngine().getLoader().execCommand('track-event', 'edt_inspector_choice_option_remove');
                                $(this).closest('[data-role=statement]').each(function () {
                                    var statementIndex = parseInt(this.getAttribute('data-index')), statementParent = this.parentNode;
                                    initializeStatements.splice(statementIndex, 1);
                                    statementParent.removeChild(this);
                                    $(statementParent).find('div[data-role=statement]').each(function (index) {
                                        this.setAttribute('data-index', String(index));
                                    });
                                    self.updateStatements(initializeStatements, input, $);
                                    self.updateContainerAttributes(container, initializeStatements);
                                });
                            })
                                .on('click', 'a[data-role=edit-option], a[data-role=edit-more-option]', function () {
                                var dialogTitle = String(this.getAttribute('data-dialog-title') || 'Statements option...'), dialogTitleI18n = String(this.getAttribute('data-dialog-title-i18n')), itemTypeName = String(this.getAttribute('data-item-type-name') || "STATEMENT"), itemTypeNameI18n = String(this.getAttribute('data-item-type-name-i18n')), newStatementText = String(this.getAttribute('data-new-statement-title') || 'New Statement'), newStatementTextI18n = String(this.getAttribute('data-new-statement-title-i18n')), itemTypeNameTranslated = itemTypeNameI18n
                                    && editorUserInterface.getEngine().getI18n().translateText(itemTypeNameI18n)
                                    && itemTypeNameI18n !== editorUserInterface.getEngine().getI18n().translateText(itemTypeNameI18n)
                                    ? editorUserInterface.getEngine().getI18n().translateText(itemTypeNameI18n)
                                    : itemTypeName;
                                self.editStatements(initializeStatements, container, dialogTitleI18n
                                    ? editorUserInterface.getEngine().getI18n().translateText(dialogTitleI18n)
                                    : dialogTitle, editorUserInterface, itemTypeNameTranslated, newStatementTextI18n
                                    ? editorUserInterface.getEngine().getI18n().translateText(newStatementTextI18n)
                                    : newStatementText).then(function (statements) {
                                    initializeStatements = JSON.parse(JSON.stringify(statements));
                                    $targetContainer.find('div[data-role=statement]').remove();
                                    for (var i = 0, len = initializeStatements.length; i < len; i++) {
                                        initializeStatements[i].index = i;
                                        $targetContainer.append(self.createI18nStatementElement(initializeStatements[i], initializeStatements[i].index));
                                    }
                                    self.updateContainerAttributes(container, initializeStatements);
                                    self.updateStatements(initializeStatements, input, $);
                                    self.makeStatementsInInspectorSortable(self, $, container, initializeStatements, input);
                                })
                                    .fail(function (e) {
                                    console.warn('Failed to save options. Error is displayed below');
                                    console.error(e);
                                });
                            })
                                .on('click', 'a[data-role=add-statement]', function (e) {
                                editorUserInterface.getEngine().getLoader().execCommand('track-event', 'edt_inspector_choice_option_add');
                                if (context === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER && self.triggerUpgdragePaywallOnAddStatement(initializeStatements, editorUserInterface, e)) {
                                    return;
                                }
                                var newStatement = self.createUniqueStatement({
                                    text: newStatementTextI18n
                                        ? editorUserInterface.getEngine().getI18n().translateText(newStatementTextI18n)
                                        : newStatementText,
                                    index: initializeStatements.length
                                }, initializeStatements), selectedControls = editorUserInterface.getEngine().getLoader().getSelection().getItems(), currentSelectedControl = (selectedControls.length !== 0)
                                    ? selectedControls[0]
                                    : null, choices = currentSelectedControl.hasProperty('choices.scale') ? currentSelectedControl.getProperty('choices.scale') : [], choicesLength = choices.length, choicesInput = $(container).closest('#item').find('input[type=hidden][data-plugin=text-choice-interface]').get(0), synchronizeOtherProperties = choicesInput ? choicesInput.getAttribute('data-synchronize-other-properties') : '';
                                initializeStatements.push(newStatement);
                                $targetContainer.append(self.createI18nStatementElement(newStatement, newStatement.index));
                                self.updateStatements(initializeStatements, input, $);
                                self.updateContainerAttributes(container, initializeStatements);
                                self.makeStatementsInInspectorSortable(self, $, container, initializeStatements, input);
                                if (choices) {
                                    choices[choicesLength] = [];
                                    for (var i = 0, len = choices[0].length; i < len; i++) {
                                        choices[choicesLength][i] = ChoicesEditorInspectorPlugin.createUniqueChoice({
                                            text: choices[0][i].text,
                                            isDefault: typeof choices[0][i].isDefault !== 'undefined' && choices[0][i].isDefault !== null
                                                ? choices[0][i].isDefault
                                                : null,
                                            index: i,
                                            numberOfTimesThisOptionCanBeChosen: null,
                                            numberOfTimesThisOptionHasBeenChosen: null,
                                            isCorrect: typeof choices[0][i].isCorrect !== 'undefined' && choices[0][i].isCorrect !== null
                                                ? choices[0][i].isCorrect
                                                : null,
                                            quizPoints: 0,
                                            paymentsValue: null,
                                        }, choices);
                                    }
                                    choicesInput.value = JSON.stringify(choices);
                                    $(choicesInput).trigger('input');
                                    if (synchronizeOtherProperties) {
                                        $(synchronizeOtherProperties).val(choicesInput.value).trigger('reload');
                                    }
                                }
                            })
                                .parent()
                                .on('click', 'a[data-role=import-statement]', function (e) {
                                var datasets = JSON.parse(this.getAttribute('data-sets') || '[]'), dialogTitle = String(this.getAttribute('data-dialog-title') || 'Import statements'), dialogTitleI18n = String(this.getAttribute('data-dialog-title-i18n') || '');
                                editorUserInterface.getSelectedDataset(datasets, dialogTitleI18n
                                    ? editorUserInterface.getEngine().getI18n().translateText(dialogTitleI18n)
                                    : dialogTitle, initializeStatements)
                                    .then(function (dataset) {
                                    if (self.triggerUpgdragePaywallOnAddStatement(dataset.getValues(), editorUserInterface, e)) {
                                        return;
                                    }
                                    $targetContainer.find('[data-role=statement]').remove();
                                    initializeStatements = [];
                                    for (var i = 0, values = dataset.getValues(), len = values.length; i < len; i++) {
                                        initializeStatements.push(values[i]);
                                        initializeStatements[i].index = i;
                                        $targetContainer.append(self.createI18nStatementElement(initializeStatements[i], initializeStatements[i].index));
                                    }
                                    self.updateStatements(initializeStatements, input, $);
                                    self.updateContainerAttributes(container, initializeStatements);
                                    self.makeStatementsInInspectorSortable(self, $, container, initializeStatements, input);
                                })
                                    .fail(function (e) {
                                    console.warn('Failed to import statements. Error is displayed below');
                                    console.error(e);
                                });
                            })
                                .on('keydown', 'input', function (evt) {
                                if ((evt.keyCode || evt.charCode) !== KeyboardUtils.KEY_ENTER
                                    || !initializeStatements[initializeStatements.length - 1].text) {
                                    return;
                                }
                                var targetIndex = ~~$(this.parentNode).attr('data-index');
                                if (initializeStatements.length > LikertStatementsEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_STATEMENTS_IN_INSPECTOR_PANEL
                                    && (targetIndex === LikertStatementsEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_STATEMENTS_IN_INSPECTOR_PANEL)) {
                                    $('a[data-role=edit-more-option][data-target=statements]').trigger('click');
                                }
                                if (targetIndex < LikertStatementsEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_STATEMENTS_IN_INSPECTOR_PANEL) {
                                    if (self.triggerUpgdragePaywallOnAddStatement(initializeStatements, editorUserInterface, evt)) {
                                        return;
                                    }
                                    var newStatement = self.createUniqueStatement({
                                        text: newStatementTextI18n
                                            ? editorUserInterface.getEngine().getI18n().translateText(newStatementTextI18n)
                                            : newStatementText,
                                        index: initializeStatements.length
                                    }, initializeStatements), newInputDiv = self.createI18nStatementElement(newStatement, newStatement.index);
                                    initializeStatements.splice(targetIndex + 1, 0, newStatement);
                                    $(newInputDiv).insertAfter(this.parentNode);
                                    self.reinitializeStatementsIndexes(initializeStatements, container, $);
                                    self.updateStatements(initializeStatements, input, $);
                                    self.updateContainerAttributes(container, initializeStatements);
                                    self.makeStatementsInInspectorSortable(self, $, container, initializeStatements, input);
                                    $(newInputDiv)
                                        .find('input')
                                        .focus()
                                        .select();
                                }
                            })
                                .on('paste', '[data-role=statement] > input[type=text]', function (e) {
                                var dataAsText, arrayOfValues = [], targetIndex = ~~$(this).closest('div[data-role=statement]').attr('data-index');
                                try {
                                    var originalEvent = e.originalEvent || {}, clipboardData = e.originalEvent['clipboardData'] || null;
                                    if (!clipboardData) {
                                        return;
                                    }
                                    dataAsText = clipboardData.getData('text/plain');
                                    var cleanDataAsText = String(dataAsText || '').replace(/(^[\s]+|[\s]+$)/g, '');
                                    if (cleanDataAsText.indexOf('\n') > -1) {
                                        arrayOfValues = cleanDataAsText.split('\n');
                                    }
                                    else {
                                        return;
                                    }
                                    originalEvent.preventDefault();
                                    originalEvent.stopPropagation();
                                    for (var i = 0, len = arrayOfValues.length; i < len; i++) {
                                        if (self.triggerUpgdragePaywallOnAddStatement(initializeStatements, editorUserInterface, e)) {
                                            return;
                                        }
                                        var newStatement = self.createUniqueStatement({
                                            text: arrayOfValues[i],
                                            index: targetIndex + i + 1
                                        }, initializeStatements), newInputDiv = self.createI18nStatementElement(newStatement, newStatement.index);
                                        initializeStatements.splice(newStatement.index, 0, newStatement);
                                        $(newInputDiv).insertAfter($('div[data-role=statement][data-index=' + (newStatement.index - 1) + ']'));
                                        self.reinitializeStatementsIndexes(initializeStatements, container, $);
                                        self.updateContainerAttributes(container, initializeStatements);
                                    }
                                    self.updateStatements(initializeStatements, input, $);
                                    self.makeStatementsInInspectorSortable(self, $, container, initializeStatements, input);
                                }
                                catch (unknownBrowserException) {
                                    return;
                                }
                            });
                        })(this);
                    });
                })(this);
            });
        })(this);
    };
    LikertStatementsEditorInspectorPlugin.prototype.updateContainerAttributes = function (container, statements) {
        container.setAttribute('data-truncate-options', String(~~(statements.length > LikertStatementsEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_STATEMENTS_IN_INSPECTOR_PANEL)));
    };
    LikertStatementsEditorInspectorPlugin.prototype.isUniqueSetOfStatements = function (statements) {
        if (!statements) {
            return true;
        }
        for (var i = 0, len = statements.length; i < len; i++) {
            for (var j = 0; j < i; j++) {
                if (statements[i].text === statements[j].text) {
                    return false;
                }
            }
        }
        return true;
    };
    LikertStatementsEditorInspectorPlugin.prototype.createUniqueStatement = function (usingTemplateStatement, inExistingSetOfStatements) {
        var autoIncrement = 0, baseStatementText = usingTemplateStatement.text, isUnique, incrementedStatementText;
        if (!inExistingSetOfStatements || !inExistingSetOfStatements.length) {
            return usingTemplateStatement;
        }
        do {
            isUnique = true;
            if (0 === autoIncrement) {
                incrementedStatementText = baseStatementText;
            }
            else {
                incrementedStatementText = baseStatementText + ' (' + autoIncrement + ')';
            }
            for (var i = 0, len = inExistingSetOfStatements.length; i < len; i++) {
                if (inExistingSetOfStatements[i].text === incrementedStatementText) {
                    isUnique = false;
                    autoIncrement++;
                    break;
                }
            }
        } while (!isUnique);
        usingTemplateStatement.text = incrementedStatementText;
        return usingTemplateStatement;
    };
    LikertStatementsEditorInspectorPlugin.prototype.reinitializeStatementsIndexes = function (statement, editorContainer, $) {
        for (var i = 0, len = statement.length; i < len; i++) {
            statement[i].index = i;
        }
        $(editorContainer).find('[data-role=statement]').each(function (statementIndex) {
            this.setAttribute('data-index', String(statementIndex));
        });
    };
    LikertStatementsEditorInspectorPlugin.prototype.editStatements = function (statements, container, dialogTitle, editorUserInterface, itemTypeName, newStatementText) {
        var backupStatements = JSON.parse(JSON.stringify(statements)), maximumAllowedStatementsNumber = editorUserInterface.getEngine().getCapabilities().factory.maxLikertStatements;
        return (function (ui, self, $, resourceManager, i18n, dispatcher) {
            return $.Deferred(function (defer) {
                resourceManager.get('/modules/Typescript/Form/resources/edit-statements-dialog.html')
                    .then(function (templateText) {
                    var template = new Salvage(templateText), dialog, model = {
                        "statements": statements,
                        "editStatementsDialogItemTypeName": itemTypeName
                    }, initializeStatements = statements;
                    var onSaveButtonPress = function () {
                        if (!self.isUniqueSetOfStatements(statements)) {
                            ui.alert("Error Saving Statements", "You are not allowed to have 2 or more statements with the same value");
                            return;
                        }
                        dialog.close();
                        defer.resolve(statements);
                    };
                    dialog = ui.createDialog(dialogTitle, [
                        {
                            type: EDialogButtonType.CANCEL,
                            callback: function () {
                                while (statements.length) {
                                    statements.pop();
                                }
                                for (var i = 0, len = backupStatements.length; i < len; i++) {
                                    statements.push(backupStatements[i]);
                                }
                                dialog.close();
                                defer.reject(new Error('User closed the dialog by pressing the Cancel button'));
                            }
                        },
                        {
                            type: EDialogButtonType.SAVE,
                            callback: onSaveButtonPress
                        }
                    ], {
                        width: "600px",
                        height: "600px",
                        onCloseButtonClick: function () {
                            defer.reject(new Error('User closed the dialog by pressing the X button'));
                        }
                    });
                    dialog.body.setAttribute('data-dialog-role', 'edit-statement');
                    dialog.body.innerHTML = template.parse(model);
                    i18n.translateDOMNode(dialog.body);
                    dispatcher.addPerfectScrollbar(dialog.body);
                    self.makeStatementsInEditPanelSortable(self, $, dialog.body, initializeStatements);
                    $(dialog.body)
                        .on('click', 'a[data-role=add-statement]', function (e) {
                        if (self.triggerUpgdragePaywallOnAddStatement(initializeStatements, editorUserInterface, e)) {
                            return;
                        }
                        self.insertNewStatement(self, initializeStatements, dialog.body, container, newStatementText, statements.length, $, editorUserInterface);
                        self.makeStatementsInEditPanelSortable(self, $, dialog.body, initializeStatements);
                        var choicesContainer = $(this).closest('div[data-dialog-role=edit-statement]');
                        choicesContainer.scrollTop(choicesContainer.prop('scrollHeight'));
                    })
                        .on('input', 'td[data-role=statement-name] input[type=text]', function () {
                        var rowIndex = ~~$(this).closest('tr').attr('data-index'), statementValue = this.value;
                        statements[rowIndex].text = statementValue;
                    })
                        .on('click', 'tr[data-role=statement] td[data-role=statement-name] div[data-role=remove]', function () {
                        if (initializeStatements.length <= 1)
                            return;
                        var statementIndex = ~~($(this).closest('[data-role=statement]').attr('data-index'));
                        initializeStatements.splice(statementIndex, 1);
                        $(this).closest('[data-role=statement]').remove();
                        self.reinitializeStatementsIndexes(initializeStatements, dialog.body, $);
                        self.updateContainerAttributes(container, initializeStatements);
                    })
                        .on('input', 'td[data-role=statement-name] input[type=text]', function () {
                        var rowIndex = ~~$(this).closest('tr').attr('data-index'), statementValue = this.value;
                        statements[rowIndex].text = statementValue;
                    })
                        .on('keydown', 'input[type=text][data-role=statement-name]', function (evt) {
                        if ((evt.keyCode || evt.charCode) !== KeyboardUtils.KEY_ENTER || initializeStatements[initializeStatements.length - 1].text === null || initializeStatements[initializeStatements.length - 1].text === '') {
                            return;
                        }
                        if (self.triggerUpgdragePaywallOnAddStatement(initializeStatements, editorUserInterface, evt)) {
                            return;
                        }
                        var targetIndex = ~~$(this.parentNode).closest('tr[data-role=statement]').attr('data-index') + 1;
                        self.insertNewStatement(self, initializeStatements, dialog.body, container, newStatementText, targetIndex, $, editorUserInterface);
                        self.makeStatementsInEditPanelSortable(self, $, dialog.body, initializeStatements);
                        var choicesContainer = $(this).closest('div[data-dialog-role=edit-statement]');
                        choicesContainer.scrollTop(choicesContainer.prop('scrollHeight'));
                    })
                        .on('paste', 'td[data-role=statement-name] input[type=text]', function (e) {
                        var dataAsText, arrayOfValues = [], targetIndex = ~~$(this).closest('tr[data-role=statement]').attr('data-index');
                        try {
                            var originalEvent = e.originalEvent || {}, clipboardData = e.originalEvent['clipboardData'] || null;
                            if (!clipboardData) {
                                return;
                            }
                            dataAsText = clipboardData.getData('text/plain');
                            var cleanDataAsText = String(dataAsText || '').replace(/(^[\s]+|[\s]+$)/g, '');
                            if (cleanDataAsText.indexOf('\n') > -1) {
                                arrayOfValues = cleanDataAsText.split('\n');
                            }
                            else {
                                return;
                            }
                            originalEvent.preventDefault();
                            originalEvent.stopPropagation();
                            var _loop_3 = function (i, len) {
                                if (self.triggerUpgdragePaywallOnAddStatement(initializeStatements, editorUserInterface, e)) {
                                    return { value: void 0 };
                                }
                                var newStatement = self.createUniqueStatement({
                                    text: arrayOfValues[i],
                                    index: targetIndex + i + 1
                                }, initializeStatements), newlyInsertedRow;
                                initializeStatements.splice(newStatement.index, 0, newStatement);
                                $(dialog.body).find('table').each(function () {
                                    newlyInsertedRow = this.tBodies[0].rows[this.tBodies[0].rows.length - 1].cloneNode(true);
                                    $(newlyInsertedRow).insertAfter($('tr[data-role=statement][data-index=' + (newStatement.index - 1) + ']'));
                                });
                                $(newlyInsertedRow)
                                    .find('td[data-role=statement-name] input[type=text]')
                                    .val(newStatement.text);
                                self.reinitializeStatementsIndexes(initializeStatements, dialog.body, $);
                            };
                            for (var i = 0, len = arrayOfValues.length; i < len; i++) {
                                var state_1 = _loop_3(i, len);
                                if (typeof state_1 === "object")
                                    return state_1.value;
                            }
                            self.updateContainerAttributes(container, initializeStatements);
                            self.makeStatementsInEditPanelSortable(self, $, dialog.body, initializeStatements);
                        }
                        catch (unknownBrowserException) {
                            return;
                        }
                    });
                })
                    .fail(function (e) {
                    defer.reject(e);
                });
            }).promise();
        })(editorUserInterface.getEngine().getLoader().getUI(), this, editorUserInterface.getEngine().getJQuery(), editorUserInterface.getEngine().getResourceManager(), editorUserInterface.getEngine().getI18n(), editorUserInterface.getEngine().getLoader().getCommandDispatcher());
    };
    LikertStatementsEditorInspectorPlugin.prototype.createI18nStatementElement = function (config, statementIndex) {
        var container = document.createElement('div'), input = container.appendChild(document.createElement('input')), removeButton = container.appendChild(document.createElement('div')), dragButton = container.appendChild(document.createElement('div'));
        input.setAttribute('type', 'text');
        input.setAttribute('data-role', 'secondary');
        input.value = config.text || 'No statement';
        removeButton.setAttribute('data-role', 'remove');
        dragButton.setAttribute('data-role', 'drag');
        container.setAttribute('data-role', 'statement');
        container.setAttribute('data-index', String(statementIndex));
        return container;
    };
    LikertStatementsEditorInspectorPlugin.prototype.updateStatements = function (statementsList, onInput, $) {
        onInput.value = statementsList && statementsList.length
            ? JSON.stringify(statementsList)
            : 'null';
        $(onInput).trigger('input');
    };
    LikertStatementsEditorInspectorPlugin.prototype.insertNewStatement = function (self, statements, dialog, container, newStatementText, targetIndex, $, ui) {
        var newStatement = self.createUniqueStatement({
            text: newStatementText || 'New Statement',
            index: targetIndex,
        }, statements), newlyInsertedRow, selectedControls = ui.getEngine().getLoader().getSelection().getItems(), currentSelectedControl = (selectedControls.length !== 0)
            ? selectedControls[0]
            : null, choices = currentSelectedControl.hasProperty('choices.scale') ? currentSelectedControl.getProperty('choices.scale') : [], choicesLength = choices.length, choicesInput = $(container).closest('#item').find('input[type=hidden][data-plugin=text-choice-interface]').get(0), synchronizeOtherProperties = choicesInput ? choicesInput.getAttribute('data-synchronize-other-properties') : '';
        statements.splice(targetIndex, 0, newStatement);
        $(dialog).find('table').each(function () {
            newlyInsertedRow = this.tBodies[0].rows[this.tBodies[0].rows.length - 1].cloneNode(true);
            $(newlyInsertedRow).insertAfter($('tr[data-index=' + (targetIndex - 1) + ']'));
        });
        $(newlyInsertedRow)
            .find('td[data-role=statement-name] input[type=text]')
            .val(newStatement.text)
            .focus()
            .select();
        newlyInsertedRow.setAttribute('data-index', (~~newStatement.index).toString());
        this.reinitializeStatementsIndexes(statements, dialog, $);
        self.updateContainerAttributes(container, statements);
        if (choices) {
            choices[choicesLength] = [];
            for (var i = 0, len = choices[0].length; i < len; i++) {
                choices[choicesLength][i] = ChoicesEditorInspectorPlugin.createUniqueChoice({
                    text: choices[0][i].text,
                    isDefault: typeof choices[0][i].isDefault !== 'undefined' && choices[0][i].isDefault !== null
                        ? choices[0][i].isDefault
                        : null,
                    index: i,
                    numberOfTimesThisOptionCanBeChosen: null,
                    numberOfTimesThisOptionHasBeenChosen: null,
                    isCorrect: typeof choices[0][i].isCorrect !== 'undefined' && choices[0][i].isCorrect !== null
                        ? choices[0][i].isCorrect
                        : null,
                    quizPoints: 0,
                    paymentsValue: null,
                }, choices);
            }
            choicesInput.value = JSON.stringify(choices);
            $(choicesInput).trigger('input');
            if (synchronizeOtherProperties) {
                $(synchronizeOtherProperties).val(choicesInput.value).trigger('reload');
            }
        }
    };
    LikertStatementsEditorInspectorPlugin.prototype.makeStatementsInInspectorSortable = function (self, $, container, initializeStatements, input) {
        var throttledStatementReorderCallback = Throttle.create(function () {
            self.reorderStatementsInInspector($, container, initializeStatements, input);
        }, 100);
        SortablePlugin.makeSortable($, container, 'div[data-role=statement] div[data-role=drag]', 'div[data-role=statement]', function (elementSource, elementDestination, sortPosition) {
            throttledStatementReorderCallback();
        }, function (elementSource, elementDestination, sortPosition) {
            var parent = elementSource.parentNode;
            if (sortPosition === SortablePluginPosition.BEFORE) {
                parent.insertBefore(elementSource, elementDestination);
            }
            else {
                parent.insertBefore(elementSource, elementDestination.nextSibling);
            }
            throttledStatementReorderCallback();
        });
    };
    LikertStatementsEditorInspectorPlugin.prototype.makeStatementsInEditPanelSortable = function (self, $, container, initializeStatements) {
        var throttledStatementReorderInPanelCallback = Throttle.create(function () {
            self.reorderStatementsInPanelCallback($, container, initializeStatements);
        }, 100);
        SortablePlugin.makeSortable($, container, 'table[data-role=edit-statements] tr[data-role=statement] td[data-role=statement-name] div[data-role=drag]', 'table[data-role=edit-statements] tr[data-role=statement]', function (elementSource, elementDestination, sortPosition) {
            throttledStatementReorderInPanelCallback();
        }, function (elementSource, elementDestination, sortPosition) {
            var parent = elementSource.parentNode;
            if (sortPosition === SortablePluginPosition.BEFORE) {
                parent.insertBefore(elementSource, elementDestination);
            }
            else {
                parent.insertBefore(elementSource, elementDestination.nextSibling);
            }
            throttledStatementReorderInPanelCallback();
        });
    };
    LikertStatementsEditorInspectorPlugin.prototype.onStatementsReorderedByDragAndDrop = function ($, container, initializeStatements) {
        var needToTriggerChange = false;
        $(container).find('[data-role=statement]').each(function (choiceIndex) {
            var choiceIndexAttributeValue = ~~this.getAttribute('data-index');
            if (choiceIndex !== choiceIndexAttributeValue) {
                needToTriggerChange = true;
                initializeStatements[choiceIndexAttributeValue].index = choiceIndex;
                this.setAttribute('data-index', String(choiceIndex));
            }
        });
        if (!needToTriggerChange) {
            return;
        }
        initializeStatements.sort(function (a, b) {
            return a.index - b.index;
        });
    };
    LikertStatementsEditorInspectorPlugin.prototype.reorderStatementsInInspector = function ($, container, initializeStatements, input) {
        this.onStatementsReorderedByDragAndDrop($, container, initializeStatements);
        this.updateStatements(initializeStatements, input, $);
    };
    LikertStatementsEditorInspectorPlugin.prototype.reorderStatementsInPanelCallback = function ($, container, initializeStatements) {
        this.onStatementsReorderedByDragAndDrop($, container, initializeStatements);
    };
    LikertStatementsEditorInspectorPlugin.prototype.triggerUpgdragePaywallOnAddStatement = function (statements, editorUserInterface, event) {
        if (this.userService.canAddLikertStatements(statements.length)) {
            return false;
        }
        editorUserInterface.getEngine().getLoader().getCommandDispatcher().triggerPaywall(EUpgradeReason.MAXIMUM_NUMBER_OF_LIKERT_STATEMENTS_IN_CURRENT_USER_PLAN);
        event.preventDefault();
        event.stopPropagation();
        return true;
    };
    LikertStatementsEditorInspectorPlugin.NAME = 'LikertStatementsEditorInspectorPlugin';
    LikertStatementsEditorInspectorPlugin.MAX_VISIBLE_NUMBER_OF_STATEMENTS_IN_INSPECTOR_PANEL = 4;
    return LikertStatementsEditorInspectorPlugin;
}());
var LikertQuizOptionsInspectorPlugin = (function () {
    function LikertQuizOptionsInspectorPlugin() {
        this.templatePath = '/modules/Typescript/Form/resources/edit-likert-option-dialog.html';
        this.totalQuizPoints = 0;
        if (!window['userService']) {
            throw new Error('Dependency not found: userService');
        }
        this.userService = window['userService'].getInstance();
    }
    LikertQuizOptionsInspectorPlugin.prototype.getName = function () {
        return LikertQuizOptionsInspectorPlugin.NAME;
    };
    LikertQuizOptionsInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        (function (self) {
            var results = $(container).find('input[type=hidden][data-plugin=text-choice-interface-likert][data-value]');
            results.each(function () {
                (function (input) {
                    var initializeOptionsAsString = input.getAttribute('data-value'), statementChoices = [];
                    if (initializeOptionsAsString) {
                        statementChoices = JSON.parse(initializeOptionsAsString) || [];
                    }
                    input.removeAttribute('data-value');
                    $(input).parent().find('[data-role=secondary]').on('click', 'a[data-role=edit-likert-quiz]', function () {
                        var popupTitle = $(this).data('dialog-title'), i18nPopupTitle = $(this).data('dialog-title-i18n'), currentElement = editorUserInterface.getEngine().getLoader().getSelection().getItems()[0], statementChoices = currentElement.getProperty('options.quizOptions'), parsedStatements = currentElement.getProperty('choices.statements'), document = editorUserInterface.getEngine().getDocument(), statementHashes = [];
                        for (var i = 0, len = currentElement.getChildren().length; i < len; i++) {
                            statementHashes.push(currentElement.getChildren()[i].getHash());
                        }
                        self.totalQuizPoints = FormUtils.getFormPointsWithoutElements(document, statementHashes);
                        self
                            .editQuizOptions({
                            editorUserInterface: editorUserInterface,
                            popupTitle: popupTitle,
                            i18nPopupTitle: i18nPopupTitle,
                            choices: statementChoices,
                            statements: parsedStatements,
                            inputType: EChoiceDefaultOptionInputType.RADIO,
                            totalPoints: FormUtils.getFormTotalPoints(document)
                        }, editorUserInterface.getEngine().getFactory())
                            .then(function (statements) {
                            self.updateQuizOptions(statements, input, $);
                        })
                            .fail(function (e) {
                            console.warn('Quiz settings not saved');
                            console.log(e);
                        });
                    });
                })(this);
            });
        })(this);
    };
    LikertQuizOptionsInspectorPlugin.prototype.updateQuizOptions = function (statements, input, $) {
        var result = [];
        for (var i = 0, len1 = statements.length; i < len1; i++) {
            var choices = [];
            for (var j = 0, len2 = statements[i].length; j < len2; j++) {
                choices.push({
                    text: statements[i][j].text,
                    isDefault: statements[i][j].isDefault,
                    isCorrect: statements[i][j].isCorrect,
                    quizPoints: statements[i][j].quizPoints,
                    numberOfTimesThisOptionCanBeChosen: statements[i][j].numberOfTimesThisOptionCanBeChosen ? statements[i][j].numberOfTimesThisOptionCanBeChosen : null,
                    paymentsValue: statements[i][j].paymentsValue ? statements[i][j].paymentsValue : null,
                    i18nLabel: (statements[i][j].i18nLabel != null ? statements[i][j].i18nLabel : '')
                });
            }
            result.push(JSON.parse(JSON.stringify(choices)));
        }
        input.value = JSON.stringify(result);
        $(input).trigger('input');
        if (input.getAttribute('data-synchronize-other-properties')) {
            $(input.getAttribute('data-synchronize-other-properties')).val(JSON.stringify(result)).trigger('reload');
        }
    };
    LikertQuizOptionsInspectorPlugin.prototype.editQuizOptions = function (options, factory) {
        return (function (self, ui, $, resourceManager, i18n, dispatcher) {
            return $.Deferred(function (defer) {
                if (self.checkIfShouldDisplayPaywall(dispatcher)) {
                    return defer.reject();
                }
                resourceManager
                    .get(self.templatePath)
                    .then(function (templateText) {
                    var model = {
                        statements: [],
                        formTotalPoints: options.totalPoints,
                        formTotalPointsText: 'Form total points:',
                        formTotalPointsTextI18n: 'edt_text_form_total_points',
                    };
                    for (var i = 0, len = options.choices.length; i < len; i++) {
                        var statement = {
                            choices: [],
                            i18n: null,
                            text: options.statements[i].text,
                            inputType: options.inputType,
                            index: i
                        };
                        for (var j = 0; j < options.choices[i].length; j++) {
                            var statementChoice = options.choices[i][j], choice = {
                                isCorrect: statementChoice.isCorrect,
                                isDefault: statementChoice.isDefault,
                                numberOfTimesThisOptionCanBeChosen: statementChoice.numberOfTimesThisOptionCanBeChosen,
                                quizPoints: statementChoice.quizPoints,
                                paymentsValue: statementChoice.paymentsValue,
                                text: statementChoice.text,
                                index: j
                            };
                            statement.choices.push(choice);
                        }
                        model.statements.push(statement);
                    }
                    var dialog = self.showDialog(ui, templateText, model, options, dispatcher, i18n, defer);
                    self.initDialogListeners(dialog, model);
                })
                    .fail(function (error) {
                    defer.reject(error);
                });
            }).promise();
        })(this, options.editorUserInterface.getEngine().getLoader().getUI(), options.editorUserInterface.getEngine().getJQuery(), options.editorUserInterface.getEngine().getResourceManager(), options.editorUserInterface.getEngine().getI18n(), options.editorUserInterface.getEngine().getLoader().getCommandDispatcher());
    };
    LikertQuizOptionsInspectorPlugin.prototype.checkIfShouldDisplayPaywall = function (dispatcher) {
        if (!this.userService.canUseQuizOptions()) {
            dispatcher.triggerPaywall(EUpgradeReason.QUIZ_OPTIONS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN);
            return true;
        }
        return false;
    };
    LikertQuizOptionsInspectorPlugin.prototype.showDialog = function (ui, templateText, model, options, dispatcher, i18n, defer) {
        var dialogTitle = this.getDialogTitle(options, i18n), dialogSettings = [
            {
                type: EDialogButtonType.CANCEL,
                callback: function () {
                    dialog.close();
                    defer.reject(new Error('Closed the popup by pressing cancel'));
                }
            },
            {
                type: EDialogButtonType.SAVE,
                callback: function () {
                    var result = [];
                    for (var i = 0, len1 = model.statements.length; i < len1; i++) {
                        result.push(model.statements[i].choices);
                    }
                    dialog.close();
                    defer.resolve(result);
                }
            }
        ], dimensions = {
            width: "600px",
            height: "600px"
        }, dialog = ui.createDialog(dialogTitle, dialogSettings, dimensions);
        dialog.body.setAttribute('data-dialog-role', 'edit-option');
        dialog.body.innerHTML = this.parseTemplate(templateText, model);
        i18n.translateDOMNode(dialog.body);
        dispatcher.addPerfectScrollbar(dialog.body);
        return dialog;
    };
    LikertQuizOptionsInspectorPlugin.prototype.parseTemplate = function (templateText, model) {
        var template = new Salvage(templateText);
        return template.parse(model);
    };
    LikertQuizOptionsInspectorPlugin.prototype.getDialogTitle = function (options, i18n) {
        if (options.i18nPopupTitle != null)
            return i18n.translateText(options.i18nPopupTitle);
        return options.popupTitle;
    };
    LikertQuizOptionsInspectorPlugin.prototype.initDialogListeners = function (dialog, model) {
        (function (self) {
            $(dialog.body)
                .find('input[type=number][data-statement][data-index]')
                .focus(function () {
                var statementIndex = $(this).data('statement'), choiceIndex = $(this).data('index');
                $('input[type=number][data-statement=' + statementIndex + ']:not([data-index=' + choiceIndex + '])').each(function () {
                    var value = parseInt($(this).val());
                    if (value !== 0) {
                        $(this).val('0');
                    }
                });
                $('input[type=radio][data-statement=' + statementIndex + ']').prop('checked', false);
                $('input[type=radio][data-statement=' + statementIndex + '][data-index=' + choiceIndex + ']').prop('checked', true);
                self.updateTotalQuizPoints(dialog);
            })
                .on('input', function () {
                var value = $(this).val();
                while (value.charAt(0) === '0') {
                    value = value.substr(1);
                }
                if (value == '') {
                    value = '0';
                }
                $(this).val(value);
                var statementIndex = $(this).data('statement'), choiceIndex = $(this).data('index');
                for (var i = 0, len = model.statements[statementIndex].choices.length; i < len; i++) {
                    if (i != choiceIndex) {
                        model.statements[statementIndex].choices[i].isCorrect = false;
                        model.statements[statementIndex].choices[i].quizPoints = 0;
                    }
                }
                model.statements[statementIndex].choices[choiceIndex].isCorrect = true;
                model.statements[statementIndex].choices[choiceIndex].quizPoints = ~~value;
                self.updateTotalQuizPoints(dialog);
            });
            $(dialog.body).find('input[type=radio][data-statement][data-index]')
                .click(function () {
                var statementIndex = $(this).data('statement'), choiceIndex = $(this).data('index'), isCorrect = model.statements[statementIndex].choices[choiceIndex].isCorrect;
                for (var i = 0, len = model.statements[statementIndex].choices.length; i < len; i++) {
                    if (i != choiceIndex) {
                        model.statements[statementIndex].choices[i].isCorrect = false;
                        model.statements[statementIndex].choices[i].quizPoints = 0;
                    }
                }
                model.statements[statementIndex].choices[choiceIndex].isCorrect = !isCorrect;
                var input = $('input[type=number][data-statement=' + statementIndex + '][data-index=' + choiceIndex + ']');
                if (isCorrect) {
                    input.val('0');
                    $('input[type=radio][data-statement=' + statementIndex + '][data-index=' + choiceIndex + ']').prop('checked', false);
                    model.statements[statementIndex].choices[choiceIndex].quizPoints = 0;
                }
                else {
                    input.focus().select();
                    $('input[type=radio][data-statement=' + statementIndex + '][data-index=' + choiceIndex + ']').prop('checked', true);
                    $('input[type=number][data-statement=' + statementIndex + ']:not([data-index=' + choiceIndex + '])').val('0');
                }
                self.updateTotalQuizPoints(dialog);
            });
        })(this);
    };
    LikertQuizOptionsInspectorPlugin.prototype.updateTotalQuizPoints = function (dialog) {
        var currentPoints = 0;
        $('input[type=number][name=quiz-points]').each(function () {
            currentPoints += parseInt($(this).val());
        });
        currentPoints += this.totalQuizPoints;
        $(dialog.body).find('div[data-role=form-total-points] span[data-role=form-total-points]').text(currentPoints);
    };
    LikertQuizOptionsInspectorPlugin.NAME = 'LikertQuizOptionsInspectorPlugin';
    return LikertQuizOptionsInspectorPlugin;
}());
var InputTypeNumberInspectorPlugin = (function () {
    function InputTypeNumberInspectorPlugin() {
    }
    InputTypeNumberInspectorPlugin.prototype.getName = function () {
        return InputTypeNumberInspectorPlugin.NAME;
    };
    InputTypeNumberInspectorPlugin.prototype.upgrade = function ($, fromContainer, editorUserInterface) {
        (function (self) {
            $(fromContainer)
                .find('input[type=number][data-plugin=size-int]')
                .each(function () {
                $(this).next('input[type=range]').val(this.value);
                $(this).closest('[data-role=property]').attr('data-is-range-property', '');
            })
                .closest('[data-role=property]')
                .attr('data-plugin', 'size-int');
            if (!$(fromContainer).attr('number-upgraded')) {
                $(fromContainer)
                    .on('input change', 'input[type=number][data-plugin=size-int]', function () {
                    var sizeOfRange = parseFloat(this.value) || 0.0;
                    this.title = String(this.value || '');
                    $(this).next('input[type=range]').each(function () {
                        this.value = sizeOfRange;
                    });
                })
                    .on('blur', 'input[type=number][data-plugin=size-int]', function () {
                    var sizeOfRange = parseFloat(this.value) || 0.0;
                    this.value = sizeOfRange = self.limitToRange(this, sizeOfRange);
                    this.title = String(this.value || '');
                    $(this).next('input[type=range]').each(function () {
                        this.value = sizeOfRange;
                    });
                    editorUserInterface.getEngine().getLoader().getCommandDispatcher().dispatchPropertyChangeInThemePanel(this, 'value');
                })
                    .on('change', 'input[type=number][data-plugin=size-int] + input[type=range]', function () {
                    var sizeOfRange = parseFloat(this.value) || 0;
                    $(this).prev('input[type=number]').val(sizeOfRange).trigger('input');
                    editorUserInterface.getEngine().getLoader().execCommand('track-event', 'edt_slider_change', {}, 1000);
                });
                $(fromContainer).attr('number-upgraded', '1');
            }
        })(this);
    };
    InputTypeNumberInspectorPlugin.prototype.limitToRange = function (input, sizeOfRange) {
        var minimum = input.hasAttribute('data-min') ? ~~input.getAttribute('data-min') : null, maximum = input.hasAttribute('data-max') ? ~~input.getAttribute('data-max') : null;
        if (maximum && sizeOfRange > maximum) {
            sizeOfRange = maximum;
        }
        if (minimum && sizeOfRange < minimum) {
            sizeOfRange = minimum;
        }
        return sizeOfRange;
    };
    InputTypeNumberInspectorPlugin.NAME = 'InputTypeNumberInspectorPlugin';
    return InputTypeNumberInspectorPlugin;
}());
var ImageUploaderInspectorPlugin = (function () {
    function ImageUploaderInspectorPlugin() {
    }
    ImageUploaderInspectorPlugin.prototype.getName = function () {
        return ImageUploaderInspectorPlugin.NAME;
    };
    ImageUploaderInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        $(container).find('input[type=file][data-plugin=image-uploader]').each(function () {
            (function (fileControl, uploadsService, propertyNode) {
                var userTextInput = ($(propertyNode).find('input[type=text]').get(0)), removeButton = ($(propertyNode).find('div[data-role=remove-image]').get(0)), fileInputSrc = userTextInput.value, imageNode = document.createElement('img');
                imageNode.setAttribute('data-role', 'inserted-image-container');
                $(imageNode)
                    .on('load', function () {
                    $(propertyNode).attr('data-image-is-loaded', '');
                })
                    .on('error', function () {
                    $(propertyNode).removeAttr('data-image-is-loaded');
                });
                $(propertyNode).find('div[data-role=uploader-label]').append(imageNode);
                imageNode.src = FormUtils.getImageURLAntiCache(fileInputSrc);
                var controlHash = $(propertyNode).closest('#item, #options').attr('data-target-element'), targetElement = null;
                if (controlHash) {
                    targetElement = editorUserInterface.getEngine().getDocument().getElementByHash(controlHash);
                    if (!targetElement) {
                        return;
                    }
                }
                $(removeButton).on('click', function () {
                    fileControl.value = null;
                    imageNode.src = FormUtils.getImageURLAntiCache("");
                    $(userTextInput)
                        .val('')
                        .trigger('input');
                    if (targetElement) {
                        targetElement.setProperty('configuration.remoteURL', null);
                        targetElement.setProperty('configuration.name', null);
                        targetElement.setProperty('configuration.mimeType', null);
                        targetElement.setProperty('configuration.size', null);
                    }
                });
                $(userTextInput).on('input', function () {
                    imageNode.src = FormUtils.getImageURLAntiCache(this.value);
                    if (targetElement) {
                        targetElement.setProperty('configuration.remoteURL', '');
                        targetElement.setProperty('configuration.remoteURL', this.value);
                        targetElement.setProperty('configuration.name', null);
                        targetElement.setProperty('configuration.mimeType', null);
                        targetElement.setProperty('configuration.size', null);
                    }
                });
                fileControl.addEventListener('change', function (e) {
                    var file = fileControl.files[0];
                    if (!file) {
                        console.warn('no file found');
                        return;
                    }
                    if (!file.size) {
                        console.warn('empty file');
                        return;
                    }
                    if (!/^image\/(png|jpg|jpeg|gif)$/i.test(file.type)) {
                        console.warn('not a picture but a ' + JSON.stringify(file.type));
                        return;
                    }
                    if (file.size > 5242880) {
                        console.warn('file size greater than 5 mb');
                        return;
                    }
                    var controlId = targetElement
                        ? targetElement.getId()
                        : null;
                    if (targetElement && !controlId) {
                        console.warn('element with hash ' + controlHash + ' don\'t have a id: ' + JSON.stringify(controlId));
                        return;
                    }
                    var upload = uploadsService.createUpload(file)
                        .withControlId(controlId)
                        .withArchivePacking(false)
                        .withUploaderInstanceIndex(~~!!controlId || ('theme_' + $(fileControl).closest('[data-property-name]').attr('data-property-name').replace(/\./g, '_')));
                    imageNode.src = '';
                    upload.on('success', function () {
                        var pictureURL = upload.getStoredFileURLFromCloud();
                        imageNode.setAttribute('src', FormUtils.getImageURLAntiCache(pictureURL));
                        if (targetElement) {
                            $(userTextInput)
                                .val(pictureURL)
                                .trigger('input');
                            targetElement.setProperty('configuration.remoteURL', '');
                            targetElement.setProperty('configuration.remoteURL', pictureURL);
                            targetElement.setProperty('configuration.name', upload.getStoredFileNameOnServer());
                            targetElement.setProperty('configuration.mimeType', upload.getMimeType());
                            targetElement.setProperty('configuration.size', upload.getSize());
                        }
                        else {
                            $(userTextInput)
                                .val(FormUtils.getImageURLAntiCache(pictureURL))
                                .trigger('input');
                        }
                        fileControl.value = null;
                        $(propertyNode).removeAttr('data-is-uploading');
                    });
                    upload.on('error', function (e) {
                        fileControl.value = null;
                        if (targetElement) {
                            targetElement.setProperty('configuration.remoteURL', null);
                            targetElement.setProperty('configuration.name', null);
                            targetElement.setProperty('configuration.mimeType', null);
                            targetElement.setProperty('configuration.size', null);
                        }
                        editorUserInterface.getEngine().getLoader().getUI().alert('There was an error uploading your file to our server', e.toString());
                        $(propertyNode).removeAttr('data-is-uploading');
                    });
                    $(propertyNode).attr('data-is-uploading', '1');
                    upload.upload();
                    $(propertyNode).find('input[type=text]').on('input', function () {
                        if (targetElement) {
                            targetElement.setProperty('configuration.remoteURL', this.value === '' ? null : this.value);
                            targetElement.setProperty('configuration.name', null);
                            targetElement.setProperty('configuration.mimeType', null);
                            targetElement.setProperty('configuration.size', null);
                        }
                    });
                }, true);
            })(this, editorUserInterface.getEngine().getUploadsService(), $(this).closest('div[data-role=property]').get(0));
        });
    };
    ImageUploaderInspectorPlugin.NAME = 'ImageUploaderInspectorPlugin';
    return ImageUploaderInspectorPlugin;
}());
var PropagatedDOMAttributes = (function () {
    function PropagatedDOMAttributes() {
    }
    PropagatedDOMAttributes.prototype.getName = function () {
        return PropagatedDOMAttributes.NAME;
    };
    PropagatedDOMAttributes.prototype.upgrade = function ($, domNode, editorUserInterface) {
        $(domNode).find('[data-propagate-value-css-selector][data-propagate-value-attribute-name]').each(function () {
            var propagateValueCSSSelector = this.getAttribute('data-propagate-value-css-selector') || null, propagateValueAttributeName = this.getAttribute('data-propagate-value-attribute-name') || null;
            if (!propagateValueCSSSelector || !propagateValueAttributeName) {
                return;
            }
            var nodeName = this.nodeName.toLowerCase(), nodeType = 'input' === nodeName
                ? this.type
                : nodeName, value = (nodeName === 'input' && nodeType === 'checkbox' || nodeType === 'radio')
                ? this.checked
                : this.value;
            $(propagateValueCSSSelector).each(function () {
                var _this = this;
                setTimeout(function () {
                    $(_this).trigger('attribute:propagate');
                }, 50);
            }).attr(propagateValueAttributeName, String(value) || null);
        });
    };
    PropagatedDOMAttributes.NAME = 'PropagatedDOMAttributes';
    return PropagatedDOMAttributes;
}());
var DateEditorInspectorPlugin = (function () {
    function DateEditorInspectorPlugin() {
        this.PRESETS_CONFIGURATION = {
            notSet: { text: "none", index: 0 },
            "-1w": { text: "today -1 week", index: 1, },
            "-1d": { text: "yesterday", index: 2, },
            "now": { text: "today", index: 3, },
            "+1d": { text: "tomorrow", index: 4, },
            "+1w": { text: "today +1 week", index: 5, },
            "-1hh": { text: "now -1 hour", index: 1, },
            "-1mm": { text: "now -1 minute", index: 2, },
            "+1mm": { text: "now +1 minute", index: 4, },
            "+1hh": { text: "now +1 hour", index: 5, },
            "-2d": { text: "Two days ago", index: 6, },
            "-3d": { text: "3 days ago", index: 7, },
            "-2w": { text: "2 weeks ago", index: 8, },
            "-3w": { text: "3 weeks ago", index: 9, },
            "-1m": { text: "1 month ago", index: 10, },
            "-2m": { text: "Two months ago", index: 11, },
            "-3m": { text: "3 months ago", index: 12, },
            "-6m": { text: "6 months ago", index: 13, },
            "-1y": { text: "1 year ago", index: 14, },
            "+2d": { text: "Overmorrow", index: 15, },
            "+3d": { text: "Over 3 days", index: 16, },
            "+2w": { text: "Over 2 weeks", index: 17, },
            "+3w": { text: "Over 3 weeks", index: 18, },
            "+1m": { text: "Over 1 month", index: 19, },
            "+2m": { text: "Over 2 months", index: 20, },
            "+3m": { text: "Over 3 months", index: 21, },
            "+6m": { text: "Over 6 months", index: 22, },
            "+1y": { text: "Over 1 year", index: 23, },
            custom: { text: "custom date", index: 99, },
            customTime: { text: "custom time", index: 99, },
        };
    }
    DateEditorInspectorPlugin.prototype.getName = function () {
        return DateEditorInspectorPlugin.NAME;
    };
    DateEditorInspectorPlugin.prototype.updateLabelText = function (originalInput, customDateEditorInput, labelPlaceholder, presets, isCustom) {
        if (isCustom === void 0) { isCustom = false; }
        var inputValue = String(originalInput.value || '').toLowerCase(), isPresetValue = inputValue !== 'custom' && inputValue !== 'customTime' && '' !== inputValue && presets.indexOf(inputValue) > -1;
        if (isPresetValue || ('' === inputValue && !isCustom)) {
            originalInput.removeAttribute('data-is-visible');
        }
        else {
            originalInput.setAttribute('data-is-visible', '');
        }
        if (isPresetValue) {
            labelPlaceholder.textContent = "now" === inputValue
                ? this.setNowTextForControl(originalInput)
                : this.PRESETS_CONFIGURATION[inputValue].text;
        }
        else {
            labelPlaceholder.textContent = ('' === inputValue || 'notset' === inputValue)
                ? this.PRESETS_CONFIGURATION.notSet.text
                : inputValue;
        }
    };
    DateEditorInspectorPlugin.prototype.setNowTextForControl = function (originalInput) {
        return originalInput.hasAttribute('data-return-time-part-only') ? "now" : "today";
    };
    DateEditorInspectorPlugin.prototype.triggerChange = function (customDateEditorInput, originalInput, $, timeUtils, returnOnlyTimePart, editorUserInterface) {
        var dateValidatorName = $(originalInput).closest('[data-role=property]').attr('data-validation-type') || DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY, dateValue = timeUtils.stringToTime(originalInput.value, dateValidatorName), inputValue = String(originalInput.value || '').toLowerCase(), controlHash = $('#item').attr('data-target-element'), targetElement = editorUserInterface.getEngine().getDocument().getElementByHash(controlHash);
        if (null === dateValue) {
            customDateEditorInput.value = 'null';
        }
        else {
            if (timeUtils.dateAdd(originalInput.value) || timeUtils.isHumanDateString(originalInput.value)) {
                customDateEditorInput.value = JSON.stringify(originalInput.value);
            }
            else {
                customDateEditorInput.value = JSON.stringify(returnOnlyTimePart
                    ? dateValue.getHours() * 3600 + dateValue.getMinutes() * 60 + dateValue.getSeconds()
                    : ~~(dateValue.getTime() / 1000));
            }
        }
        if ('' === inputValue || null === inputValue) {
            customDateEditorInput.value = inputValue;
        }
        $(customDateEditorInput).trigger('input');
    };
    DateEditorInspectorPlugin.prototype.updatePropertyCustomAttribute = function ($, originalInput, presets) {
        if (false === presets.indexOf(originalInput.value) > -1 && '' !== originalInput.value) {
            $(originalInput)
                .closest('[data-role=property]')
                .attr('data-property-has-custom-value', '1');
        }
        else if ('' === originalInput.value) {
            $(originalInput)
                .on('blur', function () {
                $(originalInput)
                    .closest('[data-role=property]')
                    .removeAttr('data-property-has-custom-value');
            });
        }
        else {
            $(originalInput)
                .closest('[data-role=property]')
                .removeAttr('data-property-has-custom-value');
        }
    };
    DateEditorInspectorPlugin.prototype.listenForDateFormatAttributePropagationChange = function (originalInput, customDateEditorInput, labelPlaceholder, $, timeUtils) {
        $(originalInput).closest('[data-role=property]').on('attribute:propagate', function () {
            var inputValue = customDateEditorInput.value, dateFormat = this.getAttribute('data-validation-type');
            if ('' !== inputValue && dateFormat) {
                try {
                    var dateValue = JSON.parse(inputValue);
                    if ('number' !== typeof dateValue) {
                        return;
                    }
                    if (0 === dateValue || null === dateValue) {
                        return;
                    }
                    var newDateFormat = null;
                    switch (dateFormat) {
                        case DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY:
                        case DataValidator.VALIDATOR_TYPE_DATE_DDMMYYYY:
                        case DataValidator.VALIDATOR_TYPE_DATE_YYYYMMDD:
                        case DataValidator.VALIDATOR_TYPE_DATE_MMYYYY:
                            newDateFormat = DateEditorInspectorPlugin.SUPPORTED_DATE_VALIDATOR_FORMATS[dateFormat];
                            break;
                        default:
                            return;
                    }
                    var formattedTime = timeUtils.formatTime(dateValue, newDateFormat);
                    $(labelPlaceholder).text(formattedTime);
                    $(originalInput).val(formattedTime);
                }
                catch (e) { }
            }
        });
    };
    DateEditorInspectorPlugin.prototype.upgrade = function ($, domNode, editorUserInterface) {
        var timeUtils = editorUserInterface.getEngine().getTimeUtils();
        (function (self) {
            $(domNode).find('input[data-plugin=date-editor]').each(function () {
                (function (originalInput) {
                    var presets = (String(originalInput.getAttribute('data-presets') || 'now -1d +1d -2d +2d -3d +3d -1w +1w -2w +2w -3w +3w -1m +1m -2m +2m -3m +3m -6m +6m -1y +1y custom'))
                        .trim()
                        .split(/[\s]+/)
                        .filter(function (presetName) {
                        return !!presetName && !!self.PRESETS_CONFIGURATION[presetName];
                    })
                        .sort(function (presetA, presetB) {
                        return self.PRESETS_CONFIGURATION[presetA].index - self.PRESETS_CONFIGURATION[presetB].index;
                    }), returnOnlyTimePart = originalInput.hasAttribute('data-return-time-part-only');
                    originalInput.setAttribute('data-role', 'secondary');
                    originalInput.title = $(originalInput).closest('label').find('span.property-label').text();
                    if ('' !== originalInput.value && "0" !== originalInput.value && originalInput.value === String(~~originalInput.value)) {
                        if (returnOnlyTimePart) {
                            originalInput.value = timeUtils.intToTime(~~originalInput.value, EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL ? '%H:%i:%S' : '%H:%i');
                        }
                        else {
                            var dateValidatorName = $(originalInput).closest('[data-role=property]').attr('data-validation-type'), dateFormat = DateEditorInspectorPlugin.SUPPORTED_DATE_VALIDATOR_FORMATS[dateValidatorName] || '%m/%d/%Y';
                            originalInput.value = timeUtils.formatTime(~~originalInput.value, dateFormat);
                        }
                    }
                    originalInput.value = "0" === originalInput.value
                        ? returnOnlyTimePart
                            ? "00:00"
                            : ""
                        : originalInput.value;
                    var elementContainer = document.createElement('div'), customDateEditorInput = document.createElement('input');
                    customDateEditorInput.setAttribute('type', 'hidden');
                    customDateEditorInput.setAttribute('data-is-json-value', '');
                    customDateEditorInput.value = String(~~originalInput.value) === originalInput.value
                        ? originalInput.value
                        : JSON.stringify(originalInput.value || null);
                    $(elementContainer).attr('data-role', 'text-dropdown');
                    self.listenForDateFormatAttributePropagationChange(originalInput, customDateEditorInput, elementContainer, $, timeUtils);
                    $(originalInput).before(elementContainer);
                    $(originalInput).before(customDateEditorInput);
                    $(originalInput).closest('label')
                        .attr('data-has-text-dropdown', '1');
                    $(originalInput)
                        .closest('[data-role=property]')
                        .attr('data-plugin', 'date-editor');
                    self.updatePropertyCustomAttribute($, originalInput, presets);
                    self.updateLabelText(originalInput, customDateEditorInput, elementContainer, presets);
                    $(originalInput).on('input', function () {
                        self.updateLabelText(originalInput, customDateEditorInput, elementContainer, presets);
                        self.triggerChange(customDateEditorInput, originalInput, $, timeUtils, returnOnlyTimePart, editorUserInterface);
                        self.updatePropertyCustomAttribute($, originalInput, presets);
                    });
                    $(elementContainer).on('click', function () {
                        if ($(elementContainer).closest('[data-role=property]').attr('data-is-opened')) {
                            return;
                        }
                        $(elementContainer).closest('[data-role=property]').attr('data-is-opened', '1');
                        var overlayElement = document.createElement('div'), optionElement;
                        overlayElement.setAttribute('data-role', 'text-dropdown-overlay');
                        for (var i = 0, len = presets.length; i < len; i++) {
                            optionElement = document.createElement('div');
                            optionElement.setAttribute('data-value', JSON.stringify(presets[i]));
                            optionElement.textContent = "now" === presets[i]
                                ? self.setNowTextForControl(originalInput)
                                : self.PRESETS_CONFIGURATION[presets[i]].text;
                            overlayElement.appendChild(optionElement);
                        }
                        var bodyClickEventListener = function (e) {
                            var clickedTargetElement = (e.srcElement || e.target);
                            if (clickedTargetElement === overlayElement || $.contains(overlayElement, clickedTargetElement) || clickedTargetElement === elementContainer) {
                                return;
                            }
                            $(elementContainer).closest('[data-role=property]').removeAttr('data-is-opened');
                            $(overlayElement).remove();
                            document.body.removeEventListener('mousedown', bodyClickEventListener, true);
                            bodyClickEventListener = null;
                        };
                        var dialog;
                        if (FormUtils.isMobile()) {
                            var overlayWrapper = document.createElement('div');
                            overlayWrapper.setAttribute('data-role', 'text-dropdown');
                            overlayWrapper.appendChild(overlayElement);
                            var i18n = editorUserInterface.getEngine().getI18n();
                            dialog = editorUserInterface.getEngine().getLoader().getUI()
                                .createDialog(i18n.translateText('edt_dropdown_UI_please_choose'), [], { width: '100%', height: '100%', onCloseButtonClick: function () {
                                    $(elementContainer).closest('[data-role=property]').removeAttr('data-is-opened');
                                } });
                            dialog.body.appendChild(overlayWrapper);
                            dialog.show();
                        }
                        else {
                            elementContainer.appendChild(overlayElement);
                            var overlayClientRect = elementContainer.getBoundingClientRect(), windowClientRect = document.body.getBoundingClientRect();
                            if (windowClientRect.height < (overlayClientRect.top + overlayClientRect.height)) {
                                elementContainer.setAttribute('data-dropdown-position', 'top');
                            }
                            else {
                                elementContainer.setAttribute('data-dropdown-position', 'bottom');
                            }
                            document.body.addEventListener('mousedown', bodyClickEventListener, true);
                        }
                        $(overlayElement).on('click', '> div', function (e) {
                            var newValue = JSON.parse(this.getAttribute('data-value'));
                            var now = new Date();
                            var dateValidatorName = $(originalInput).closest('[data-role=property]').attr('data-validation-type'), dateFormat = DateEditorInspectorPlugin.SUPPORTED_DATE_VALIDATOR_FORMATS[dateValidatorName] || '%m/%d/%Y';
                            originalInput.value = (newValue === 'custom' || newValue === 'customTime' || newValue === '')
                                ? returnOnlyTimePart
                                    ? timeUtils.intToTime(now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds(), EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL ? '%H:%i:%S' : '%H:%i')
                                    : timeUtils.formatTime(parseInt(String(+new Date / 1000)), dateFormat)
                                : newValue;
                            self.updateLabelText(originalInput, customDateEditorInput, elementContainer, presets);
                            self.triggerChange(customDateEditorInput, originalInput, $, timeUtils, returnOnlyTimePart, editorUserInterface);
                            self.updatePropertyCustomAttribute($, originalInput, presets);
                            document.body.removeEventListener('mousedown', bodyClickEventListener, true);
                            if (FormUtils.isMobile()) {
                                dialog && dialog.close();
                            }
                            setTimeout(function () {
                                $(elementContainer).closest('[data-role=property]').removeAttr('data-is-opened');
                            }, 50);
                        }).on('mousewheel', function (e) {
                            e.stopPropagation();
                        });
                    });
                })(this);
            });
        })(this);
    };
    DateEditorInspectorPlugin.NAME = 'DateEditorInspectorPlugin';
    DateEditorInspectorPlugin.SUPPORTED_DATE_VALIDATOR_FORMATS = {
        datemmddyyyy: '%m/%d/%Y',
        dateddmmyyyy: '%d/%m/%Y',
        dateyyyymmdd: '%Y/%m/%d',
        datemmyyyy: '%m/%Y',
    };
    return DateEditorInspectorPlugin;
}());
var RangedPropertiesDeferredSliderAppearance = (function () {
    function RangedPropertiesDeferredSliderAppearance() {
    }
    RangedPropertiesDeferredSliderAppearance.prototype.getName = function () {
        return RangedPropertiesDeferredSliderAppearance.NAME;
    };
    RangedPropertiesDeferredSliderAppearance.prototype.upgrade = function ($, domNode, editorUserInterface) {
        if (!$(domNode).attr('data-is-upgraded-deferred-ranged-slider')) {
            var currentProperty_1;
            var updateAppearance_1 = Throttle.create(function () {
                if (currentProperty_1) {
                    currentProperty_1.setAttribute('data-show-range', '1');
                }
            }, RangedPropertiesDeferredSliderAppearance.DEFERRED_TIMEOUT);
            $(domNode).on('mouseenter', '[data-role=property][data-is-range-property]', function () {
                currentProperty_1 = this;
                updateAppearance_1();
            }).on('mouseleave', '[data-role=property][data-is-range-property]', function () {
                currentProperty_1 = null;
                this.removeAttribute('data-show-range');
            });
        }
    };
    RangedPropertiesDeferredSliderAppearance.NAME = 'RangedPropertiesDeferredSliderAppearance';
    RangedPropertiesDeferredSliderAppearance.DEFERRED_TIMEOUT = 100;
    return RangedPropertiesDeferredSliderAppearance;
}());
var SortablePlugin = (function () {
    function SortablePlugin() {
    }
    SortablePlugin.makeSortable = function ($, sourceContainer, dragHandleCSSElementSelector, dragElementCSSSelector, dropCallback, mouseMoveCallback) {
        var state = SortablePluginState.IDLE, sourceElement, dragOverlay, initialDragCoordinates = {
            left: 0,
            top: 0,
        }, deltaDragCoordinates = {
            left: 0,
            top: 0,
        }, firstMove = false;
        var mouseDownFunction = function (e) {
            if (state !== SortablePluginState.IDLE) {
                return;
            }
            if (MouseUtils.getMouseButtonFromEvent(e) !== EMouseButton.LEFT) {
                return;
            }
            var target = e.target || e.srcElement;
            initialDragCoordinates.left = e.clientX;
            initialDragCoordinates.top = e.clientY;
            if ($(target).is(dragHandleCSSElementSelector + ', ' + dragHandleCSSElementSelector + ' *')) {
                sourceElement = $(target).closest(dragElementCSSSelector).get(0);
                if (!sourceElement) {
                    return;
                }
                state = SortablePluginState.START;
                document.body.addEventListener('mousemove', mouseMoveFunction, true);
                document.body.addEventListener('mouseup', mouseUpFunction, true);
            }
        };
        var mouseMoveFunction = function (e) {
            if (state !== SortablePluginState.START && state !== SortablePluginState.RUN) {
                return;
            }
            var target = e.target || e.srcElement;
            if (target !== sourceContainer && !$.contains(sourceContainer, target)) {
                return;
            }
            if (!firstMove) {
                var currentDragCoordinates = {
                    left: e.clientX,
                    top: e.clientY
                };
                if (FormUtils.computeDistance(initialDragCoordinates, currentDragCoordinates) < SortablePlugin.MINIMUM_DISTANCE_IN_PIXELS_TO_INITIATE_A_DRAG) {
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
                firstMove = true;
                var sourceContainerContext = $(sourceContainer).find('table').attr('data-editing-context');
                var sourceElementBoundingBox = sourceElement.getBoundingClientRect();
                dragOverlay = sourceElement.cloneNode(true);
                sourceElement.setAttribute('data-is-sortable-source-element', '');
                dragOverlay.style.width = sourceElementBoundingBox.width + 'px';
                dragOverlay.style.height = sourceElementBoundingBox.height + 'px';
                dragOverlay.style.left = sourceElementBoundingBox.left + 'px';
                dragOverlay.style.top = sourceElementBoundingBox.top + 'px';
                dragOverlay.setAttribute('data-element-type', 'sortable-overlay');
                dragOverlay.setAttribute('data-editing-context', sourceContainerContext);
                document.body.appendChild(dragOverlay);
            }
            e.preventDefault();
            e.stopPropagation();
            $(sourceContainer).attr("data-in-dragging-procedure", true);
            var closestTargetElement = $(target).closest(dragElementCSSSelector).get(0);
            if (closestTargetElement) {
                var closestTargetElementBoundingBox = closestTargetElement.getBoundingClientRect(), closestTargetElementMedianLine = closestTargetElementBoundingBox.top + (closestTargetElementBoundingBox.height / 2), movePosition = SortablePluginPosition.BEFORE;
                if (e.clientY > closestTargetElementMedianLine) {
                    movePosition = SortablePluginPosition.AFTER;
                }
                if (mouseMoveCallback) {
                    try {
                        mouseMoveCallback(sourceElement, closestTargetElement, movePosition);
                    }
                    catch (e) {
                    }
                }
            }
            state = SortablePluginState.RUN;
            deltaDragCoordinates.left = e.clientX - initialDragCoordinates.left;
            deltaDragCoordinates.top = e.clientY - initialDragCoordinates.top;
            dragOverlay.style.transform = 'translate(' + deltaDragCoordinates.left + 'px, ' + deltaDragCoordinates.top + 'px)';
        };
        var mouseUpFunction = function (e) {
            $(sourceContainer).removeAttr("data-in-dragging-procedure");
            firstMove = false;
            if (state !== SortablePluginState.RUN) {
                console.warn('RETURN (STATE IS NOT RUN)');
                state = SortablePluginState.IDLE;
                return;
            }
            dragOverlay.parentNode.removeChild(dragOverlay);
            state = SortablePluginState.IDLE;
            document.body.removeEventListener('mousemove', mouseMoveFunction, true);
            document.body.removeEventListener('mouseup', mouseUpFunction, true);
            sourceElement.removeAttribute('data-is-sortable-source-element');
            dragOverlay = null;
            initialDragCoordinates.left = initialDragCoordinates.top = deltaDragCoordinates.left = deltaDragCoordinates.top = 0;
            e.preventDefault();
            e.stopPropagation();
            var target = e.target || e.srcElement;
            if (target !== sourceContainer && !$.contains(sourceContainer, target)) {
                console.warn('RETURN: TARGET IS NOT (A CHILD OF) SOURCE CONTAINER');
                sourceElement = null;
                state = SortablePluginState.IDLE;
                return;
            }
            var targetDropElement = $(target).closest(dragElementCSSSelector).get(0);
            if (!targetDropElement) {
                if (dropCallback) {
                    try {
                        dropCallback(sourceElement, null, SortablePluginPosition.BEFORE);
                    }
                    catch (e) {
                        console.error('DROP CALLBACK EXCEPTION: ', e);
                    }
                }
                sourceElement = null;
                targetDropElement = null;
                console.warn('RETURN (NO TARGET DROP ELEMENT)');
                state = SortablePluginState.IDLE;
                return;
            }
            if (targetDropElement === sourceElement) {
                sourceElement = null;
                state = SortablePluginState.IDLE;
                console.warn('RETURN (TARGET DROP ELEMENT == SOURCE ELEMENT)');
                return;
            }
            var targetDropElementBoundingBox = targetDropElement.getBoundingClientRect(), targetDropElementMedianLine = targetDropElementBoundingBox.top + (targetDropElementBoundingBox.height / 2), dropPosition = SortablePluginPosition.BEFORE;
            if (e.clientY > targetDropElementMedianLine) {
                dropPosition = SortablePluginPosition.AFTER;
            }
            if (dropCallback) {
                try {
                    dropCallback(sourceElement, targetDropElement, dropPosition);
                }
                catch (e) {
                    console.error('DROP CALLBACK EXCEPTION: ', e);
                }
            }
            targetDropElement = null;
            sourceElement = null;
            state = SortablePluginState.IDLE;
        };
        $(dragElementCSSSelector).on('mousedown', mouseDownFunction);
    };
    SortablePlugin.MINIMUM_DISTANCE_IN_PIXELS_TO_INITIATE_A_DRAG = 5;
    return SortablePlugin;
}());
var PaymentsProductsPlugin = (function () {
    function PaymentsProductsPlugin() {
    }
    PaymentsProductsPlugin.prototype.getName = function () {
        return PaymentsProductsPlugin.NAME;
    };
    PaymentsProductsPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        var $containerObject = $(container), dialog = new PaymentsProductsDialog();
        $containerObject
            .find('input[data-plugin="payments-products"]').each(function () {
            var input = this;
            $(input).parent()
                .find('[data-role="secondary"] a[data-role="edit-payments-products"]')
                .on('click', function () {
                dialog.open($, editorUserInterface.getEngine())
                    .done(function (model) {
                    dialog.saveData(model);
                })
                    .fail(function (error) {
                    console.warn(error.message);
                });
            });
        });
    };
    PaymentsProductsPlugin.NAME = 'PaymentsProductsPlugin';
    return PaymentsProductsPlugin;
}());
var ECouponCodeDiscountType;
(function (ECouponCodeDiscountType) {
    ECouponCodeDiscountType[ECouponCodeDiscountType["PERCENTUAL"] = 1] = "PERCENTUAL";
    ECouponCodeDiscountType[ECouponCodeDiscountType["FIXED"] = 2] = "FIXED";
})(ECouponCodeDiscountType || (ECouponCodeDiscountType = {}));
var CouponCodesInspectorPlugin = (function () {
    function CouponCodesInspectorPlugin() {
    }
    CouponCodesInspectorPlugin.prototype.getName = function () {
        return CouponCodesInspectorPlugin.NAME;
    };
    CouponCodesInspectorPlugin.prototype.upgrade = function ($, container, editorUi) {
        (function (self) {
            $(container).find('input[data-plugin=coupon-codes-editor]').each(function () {
                (function (editorInput) {
                    var initialCouponCodes = JSON.parse(editorInput.getAttribute('data-value') || '[]'), targetCouponsList = editorInput.nextElementSibling.querySelector('[data-role=coupons-list]'), addCouponCodeButton = editorInput.parentNode.querySelector('[data-role=add-coupon-code]'), addCouponCodeEditButton = editorInput.parentNode.querySelector('[data-role=add-coupon-code-more]'), editCouponCodesLink = editorInput.parentNode.querySelector('[data-role=coupon-codes-editor]');
                    self.updateCouponsList(initialCouponCodes, targetCouponsList);
                    $([addCouponCodeEditButton, editCouponCodesLink]).on('click', function () {
                        self.editCouponCodesDialog(FormUtils.clone(initialCouponCodes), $, editorUi)
                            .then(function (newCouponCodes) {
                            initialCouponCodes.splice(0, initialCouponCodes.length);
                            for (var i = 0, len = newCouponCodes.length; i < len; i++) {
                                initialCouponCodes.push(newCouponCodes[i]);
                            }
                            self.updateCouponsList(initialCouponCodes, targetCouponsList);
                            self.propagateChanges(initialCouponCodes, editorInput, $);
                        });
                    });
                    $(addCouponCodeButton).on('click', function () {
                        self.addEmptyCouponCode(initialCouponCodes);
                        self.updateCouponsList(initialCouponCodes, targetCouponsList);
                        self.propagateChanges(initialCouponCodes, editorInput, $);
                        editorUi.getEngine().getLoader().execCommand('track-event', 'payments_coupon_set');
                    });
                    $(targetCouponsList)
                        .on('click', '[data-role=coupon-code-row] [data-role=remove]', function (e) {
                        editorUi.getEngine().getLoader().execCommand('track-event', 'payments_coupon_delete');
                        e.preventDefault();
                        e.stopPropagation();
                        var rowIndex = ~~this.parentNode.getAttribute('data-index');
                        initialCouponCodes.splice(rowIndex, 1);
                        self.updateCouponsList(initialCouponCodes, targetCouponsList);
                        self.propagateChanges(initialCouponCodes, editorInput, $);
                    })
                        .on('input', '[data-role=coupon-code-row] > input', function (e) {
                        var couponCodeIndex = ~~this.parentNode.getAttribute('data-index');
                        if (this.value === '') {
                            initialCouponCodes.splice(couponCodeIndex, 1);
                            self.updateCouponsList(initialCouponCodes, targetCouponsList);
                        }
                        else {
                            initialCouponCodes[couponCodeIndex].code = this.value;
                        }
                        self.propagateChanges(initialCouponCodes, editorInput, $);
                    });
                })(this);
            });
        })(this);
    };
    CouponCodesInspectorPlugin.prototype.createCouponCodeInputRow = function (couponValue) {
        var result = document.createElement('div');
        result.setAttribute('data-role', 'coupon-code-row');
        var input = document.createElement('input');
        input.setAttribute('type', 'text');
        result.appendChild(input);
        input.value = String(couponValue || '');
        input.setAttribute('data-role', 'secondary');
        result.appendChild(document.createElement('div')).setAttribute('data-role', 'remove');
        return result;
    };
    CouponCodesInspectorPlugin.prototype.updateCouponsList = function (initialCouponCodes, targetCouponsList) {
        while (targetCouponsList.firstChild) {
            targetCouponsList.removeChild(targetCouponsList.firstChild);
        }
        var couponRow;
        for (var i = 0, len = Math.min(5, initialCouponCodes.length); i < len; i++) {
            couponRow = this.createCouponCodeInputRow(initialCouponCodes[i].code);
            couponRow.setAttribute('data-index', String(i));
            targetCouponsList.appendChild(couponRow);
        }
        targetCouponsList.setAttribute('has-hidden-options', String(initialCouponCodes.length >= 5));
    };
    CouponCodesInspectorPlugin.prototype.addEmptyCouponCode = function (initialCouponCodes) {
        var randomCouponCodeText = window['JQLNativeFunctions'].UNIQUE_ID_BASED_ON_DATE_MILISECOND();
        initialCouponCodes.push({
            code: randomCouponCodeText,
            labelText: '',
            type: ECouponCodeDiscountType.PERCENTUAL,
            value: 0
        });
    };
    CouponCodesInspectorPlugin.prototype.propagateChanges = function (couponCodes, intoInput, $) {
        intoInput.value = JSON.stringify(couponCodes);
        $(intoInput).trigger('input');
    };
    CouponCodesInspectorPlugin.prototype.editCouponCodesDialog = function (couponCodes, $, ui) {
        return (function (self, resourceManager) {
            return $.Deferred(function (defer) {
                resourceManager.get('/modules/Typescript/Form/resources/editor/Coupon/coupon-codes-editor-dialog.html')
                    .then(function (templateMarkup) {
                    var getValue = function (input) {
                        if (input.value === '') {
                            return null;
                        }
                        if (isNaN(input.value)) {
                            return null;
                        }
                        return parseFloat(input.value);
                    };
                    var dialog = ui.createDialog('Coupon codes', [
                        {
                            callback: function () {
                                var focusOnError = null;
                                try {
                                    var result_2 = [];
                                    $(dialog.body).find('table tbody > tr').each(function () {
                                        var _this = this;
                                        var coupon = {
                                            code: $(this).find('[data-role=code]').val(),
                                            value: getValue($(this).find('[data-role=value]').get(0)),
                                            labelText: $(this).find('[data-role=labelText]').val(),
                                            type: ~~$(this).find('[data-role=type]').attr('data-value'),
                                        };
                                        coupon.code = String(coupon.code || '').replace(/(^[\s]+|[\s]+$)/g, '');
                                        if (!coupon.code) {
                                            focusOnError = $(this).find('[data-role=code]');
                                            throw new Error('Empty coupon codes are not allowed');
                                        }
                                        _.forEach(result_2, function (res) {
                                            if (res.code === coupon.code) {
                                                focusOnError = $(_this).find('[data-role=code]');
                                                throw new Error("Another coupon with code " + res.code + " is already present!");
                                            }
                                        });
                                        if (coupon.value === null) {
                                            focusOnError = $(this).find('[data-role=value]');
                                            throw new Error('Please specify a valid numeric discount');
                                        }
                                        if (coupon.value < 0) {
                                            focusOnError = $(this).find('[data-role=value]');
                                            throw new Error('Please specify a discount greater or equal to 0');
                                        }
                                        if (coupon.value > 100 && coupon.type === 1) {
                                            focusOnError = $(this).find('[data-role=value]');
                                            throw new Error('Percentual coupon codes cannot have discount greater than 100');
                                        }
                                        result_2.push(coupon);
                                    });
                                    dialog.close();
                                    defer.resolve(result_2);
                                }
                                catch (e) {
                                    ui.alert('Error saving coupon codes', String(e).replace(/^Error:/g, ''), function () {
                                        if (focusOnError) {
                                            focusOnError.focus();
                                            focusOnError.select();
                                        }
                                    });
                                }
                            },
                            type: EDialogButtonType.SAVE,
                        },
                        {
                            callback: function () {
                                defer.reject(new Error('User canceled!'));
                                dialog.close();
                            },
                            type: EDialogButtonType.CANCEL,
                        }
                    ], {
                        width: '584px',
                        onCloseButtonClick: function () {
                            defer.reject(new Error('User closed editor without saving!'));
                        }
                    }), template = new Salvage(templateMarkup), table;
                    dialog.body.innerHTML = template.parse({});
                    dialog.dialog.setAttribute('data-dialog-role', 'coupon-codes-editor');
                    table = dialog.body.querySelector('table');
                    var settings = ui.getEngine().getDocument().getForm()
                        .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), currencyId = settings.getProperty('currencyId') || CouponCodesInspectorPlugin.DEFAULT_CURRENCY_ID, currencySymbol = ui.getEngine().getCurrency().getCurrencySymbolById(currencyId);
                    var createMiniDropdown = function () {
                        var d = document.createElement('div');
                        d.setAttribute('data-role', 'dropdown');
                        var r = document.createElement('div');
                        r.setAttribute('data-value', '1');
                        r.textContent = CouponCodesInspectorPlugin.PERCENTAGE_SYMBOL;
                        d.appendChild(r);
                        r = document.createElement('div');
                        r.setAttribute('data-value', '2');
                        r.textContent = currencySymbol;
                        d.appendChild(r);
                        return d;
                    };
                    var createCouponCodeRow = function (couponCode) {
                        var row = document.createElement('tr'), cell1 = row.appendChild(document.createElement('td')), cell2 = row.appendChild(document.createElement('td')), cell3 = row.appendChild(document.createElement('td'));
                        var inputCode = document.createElement('input');
                        inputCode.setAttribute('type', 'text');
                        inputCode.setAttribute('data-role', 'code');
                        inputCode.value = couponCode.code;
                        cell1.appendChild(inputCode);
                        cell1.appendChild(document.createElement('div')).setAttribute('data-role', 'remove');
                        var inputDiscount = document.createElement('input');
                        inputDiscount.setAttribute('type', 'text');
                        inputDiscount.setAttribute('data-role', 'value');
                        inputDiscount.value = String(couponCode.value);
                        var discountType;
                        switch (couponCode.type) {
                            case ECouponCodeDiscountType.PERCENTUAL:
                                discountType = CouponCodesInspectorPlugin.PERCENTAGE_SYMBOL;
                                break;
                            case ECouponCodeDiscountType.FIXED:
                                discountType = currencySymbol;
                                break;
                            default:
                                throw new Error('Coupon code type is invalid');
                        }
                        var divDiscount = document.createElement('div');
                        divDiscount.setAttribute('data-role', 'type');
                        divDiscount.setAttribute('data-value', String(couponCode.type));
                        divDiscount.setAttribute('data-allow-keyboard', '');
                        divDiscount.textContent = discountType;
                        divDiscount.tabIndex = 0;
                        cell2.appendChild(inputDiscount);
                        cell2.appendChild(divDiscount);
                        cell2.appendChild(createMiniDropdown());
                        var inputLabel = document.createElement('input');
                        inputLabel.setAttribute('type', 'text');
                        inputLabel.setAttribute('data-role', 'labelText');
                        inputLabel.value = couponCode.labelText;
                        cell3.appendChild(inputLabel);
                        return row;
                    };
                    for (var i = 0, len = couponCodes.length; i < len; i++) {
                        var row = createCouponCodeRow(couponCodes[i]);
                        table.tBodies[0].appendChild(row);
                    }
                    var reindexTableRows = function () {
                        for (var i = 0, len = table.tBodies[0].rows.length; i < len; i++) {
                            table.tBodies[0].rows[i].setAttribute('data-index', String(i));
                        }
                    };
                    reindexTableRows();
                    $(dialog.body)
                        .on('focus', '[data-role=type]', function () {
                        var thisValue = this.getAttribute('data-value');
                        $(this).addClass('focused')
                            .next('[data-role=dropdown]')
                            .find('div[data-value]')
                            .each(function () {
                            if (this.getAttribute('data-value') === thisValue) {
                                $(this).addClass('selected');
                            }
                            else {
                                $(this).removeClass('selected');
                            }
                        });
                    })
                        .on('blur', '[data-role=type]', function () {
                        var _this = this;
                        setTimeout(function () {
                            $(_this).removeClass('focused');
                        }, 10);
                    })
                        .on('keydown', '[data-role=type]', function (e) {
                        var code = e.keyCode || e.charCode, handle = false, isDropdownOpened = $(this).hasClass('focused'), selectedIndex = null;
                        if (!isDropdownOpened) {
                            if (code === KeyboardUtils.KEY_ENTER) {
                                $(this).addClass('focused');
                                handle = true;
                            }
                        }
                        else {
                            if (e.shiftKey || e.altKey || e.ctrlKey || e.metaKey
                                || [KeyboardUtils.KEY_UP,
                                    KeyboardUtils.KEY_DOWN,
                                    KeyboardUtils.KEY_ESC,
                                    KeyboardUtils.KEY_ENTER
                                ].indexOf(code) === -1) {
                                return;
                            }
                            selectedIndex = -1;
                            var opts_1 = [];
                            $(this).next('[data-role=dropdown]').find('> div').each(function (index) {
                                opts_1.push(this);
                                if ($(this).hasClass('selected')) {
                                    selectedIndex = index;
                                }
                            });
                            switch (code) {
                                case KeyboardUtils.KEY_ENTER:
                                    if (selectedIndex != -1) {
                                        $(this).attr('data-value', $(opts_1[selectedIndex]).attr('data-value'));
                                        $(this).removeClass('focused');
                                    }
                                    break;
                                case KeyboardUtils.KEY_ESC:
                                    $(this).removeClass('focused');
                                    return;
                                case KeyboardUtils.KEY_DOWN:
                                    $(opts_1[selectedIndex] || null).removeClass('selected');
                                    selectedIndex++;
                                    if (selectedIndex >= opts_1.length) {
                                        selectedIndex = 0;
                                    }
                                    $(opts_1[selectedIndex] || null).addClass('selected');
                                    break;
                                case KeyboardUtils.KEY_UP:
                                    $(opts_1[selectedIndex] || null).removeClass('selected');
                                    selectedIndex--;
                                    if (selectedIndex < 0) {
                                        selectedIndex = opts_1.length - 1;
                                    }
                                    $(opts_1[selectedIndex] || null).addClass('selected');
                                    break;
                            }
                        }
                    })
                        .on('mousedown', '[data-role=dropdown] > [data-value]', function (e) {
                        var val = ~~this.getAttribute('data-value');
                        var valueType = this.parentNode.previousElementSibling;
                        valueType.setAttribute('data-value', String(val));
                        valueType.textContent = this.textContent;
                        if (val === ECouponCodeDiscountType.PERCENTUAL) {
                            var value = parseFloat(valueType.previousElementSibling.value || '0');
                            if (value > 100) {
                                valueType.previousElementSibling.value = '';
                            }
                        }
                    })
                        .on('mouseenter', '[data-role=dropdown] > [data-value]', function (e) {
                        var self = this;
                        $(this).parent().find('[data-value]').each(function () {
                            if (this !== self) {
                                $(this).removeClass('selected');
                            }
                            else {
                                $(this).addClass('selected');
                            }
                        });
                    })
                        .on('click', '[data-role=remove]', function () {
                        var index = ~~$(this).closest('tr').attr('data-index');
                        $(this).closest('tr').remove();
                        couponCodes.splice(index, 1);
                        reindexTableRows();
                    })
                        .on('click', 'td[data-role=add-coupon]', function () {
                        var couponCode = {
                            value: 0,
                            code: window['JQLNativeFunctions'].UNIQUE_ID_BASED_ON_DATE_MILISECOND(),
                            type: ECouponCodeDiscountType.PERCENTUAL,
                            labelText: '',
                        };
                        couponCodes.push(couponCode);
                        var row = createCouponCodeRow(couponCode);
                        table.tBodies[0].appendChild(row);
                        reindexTableRows();
                        dialog.body.scrollTop = 80000000;
                        ui.getEngine().getLoader().execCommand('track-event', 'payments_coupon_set');
                    });
                    $(dialog.body).perfectScrollbar();
                })
                    .fail(function () {
                    defer.reject(new Error('Failed to fetch coupon codes editor dialog markup'));
                });
            }).promise();
        })(this, ui.getEngine().getResourceManager());
    };
    CouponCodesInspectorPlugin.NAME = 'CouponCodesInspectorPlugin';
    CouponCodesInspectorPlugin.DEFAULT_CURRENCY_ID = 1;
    CouponCodesInspectorPlugin.PERCENTAGE_SYMBOL = '%';
    return CouponCodesInspectorPlugin;
}());
var FormulaInspectorPlugin = (function () {
    function FormulaInspectorPlugin() {
        this.editorUi = null;
        this.lastMouseDownKeyCode = null;
        this.lastMouseDownControlId = null;
        this.availableControls = {};
        this.didRefreshAvailableControls = false;
        this.validationQueues = {};
    }
    FormulaInspectorPlugin.prototype.getName = function () {
        return FormulaInspectorPlugin.NAME;
    };
    FormulaInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        var self = this;
        var containerObject = $(container);
        var formulaValueObject = $('input[data-plugin=formula]');
        this.lastMouseDownKeyCode = null;
        this.lastMouseDownControlId = null;
        this.availableControls = {};
        this.didRefreshAvailableControls = false;
        this.editorUi = editorUserInterface;
        if (!formulaValueObject.length) {
            return;
        }
        var formulaEditorObject = $('div[data-role=formula-editor]');
        var formulaInputObject = formulaEditorObject.find('div[data-role=formula-input]:first');
        if (!containerObject.attr('data-formula-one-time-logic')) {
            var i18n = this.editorUi.getEngine().getI18n();
            var labelKeyOfDeleted = formulaInputObject.attr('data-add-field-label-i18n');
            var labelKeyOfFixedAmount = formulaInputObject.attr('data-fixed-amount-label-i18n');
            var i18nLabelOfDeleted = i18n.translateText(labelKeyOfDeleted);
            var i18nLabelOfFixedAmount = i18n.translateText(labelKeyOfFixedAmount);
            this.labelOfDeleted = (i18nLabelOfDeleted && i18nLabelOfDeleted !== labelKeyOfDeleted)
                ? i18nLabelOfDeleted
                : formulaInputObject.attr('data-add-field-label');
            this.labelOfFixedAmount = (i18nLabelOfFixedAmount && i18nLabelOfFixedAmount !== labelKeyOfFixedAmount)
                ? i18nLabelOfFixedAmount
                : formulaInputObject.attr('data-fixed-amount-label');
        }
        this.initInputMarkupFromFormula(formulaValueObject.val(), formulaEditorObject.get(0));
        formulaInputObject.off('focus').on('focus', function () {
            this.setAttribute('data-focused', '1');
        });
        formulaInputObject.off('blur').on('blur', function () {
            this.setAttribute('data-focused', '0');
        });
        formulaInputObject.parent()
            .perfectScrollbar({
            minScrollbarLength: 50,
            maxScrollbarLength: 50
        });
        formulaEditorObject.find('div[data-role=formula-add-controls] > div')
            .perfectScrollbar({
            minScrollbarLength: 50,
            maxScrollbarLength: 50
        });
        if (containerObject.attr('data-formula-one-time-logic')) {
            return;
        }
        var caretObject = $('div', formulaInputObject);
        this.formulaInputRowHeight = (caretObject.outerHeight()
            + parseInt(caretObject.css('margin-top'), 10)
            + parseInt(caretObject.css('margin-bottom'), 10));
        this.formulaInputOffsetLeft = (formulaInputObject.offset().left
            + parseInt(formulaInputObject.css('padding-left'), 10));
        this.formulaInputOffsetTop = (formulaInputObject.offset().top
            + parseInt(formulaInputObject.css('padding-top'), 10));
        containerObject.on('mousedown', 'div[data-role=formula-keypad], div[data-role=formula-add-controls]', function (e) {
            e.preventDefault();
            if (e.target.hasAttribute('data-control-id')) {
                self.lastMouseDownKeyCode = null;
                self.lastMouseDownControlId = $(e.target).attr('data-control-id');
            }
            else if (e.target.hasAttribute('data-fixed-amount')) {
                self.lastMouseDownKeyCode = null;
                self.lastMouseDownControlId = String(FormulaInspectorPlugin.CONTROL_ID_FIXED_AMOUNT);
            }
            else if (e.target.hasAttribute('data-key-code')) {
                self.lastMouseDownKeyCode = parseInt($(e.target).attr('data-key-code'), 10);
                self.lastMouseDownControlId = null;
            }
            else {
                self.lastMouseDownKeyCode = null;
                self.lastMouseDownControlId = null;
            }
        });
        containerObject.on('mouseup', 'div[data-role=formula-keypad], div[data-role=formula-add-controls]', function (e) {
            e.preventDefault();
            if (e.target.hasAttribute('data-control-id')) {
                if (self.lastMouseDownControlId !== null) {
                    var formulaEditorNode = $(this).closest('div[data-role=formula-editor]').get(0);
                    var addFieldsObject = $(formulaEditorNode).children('div[data-role=formula-add-controls]');
                    var controlId = $(e.target).attr('data-control-id');
                    addFieldsObject.attr('data-open', '0');
                    self.addFormulaEntity(controlId, formulaEditorNode, FormulaInspectorPlugin.ENTITY_TYPE_CONTROL, $);
                }
            }
            else if (e.target.hasAttribute('data-fixed-amount')) {
                if (self.lastMouseDownControlId === String(FormulaInspectorPlugin.CONTROL_ID_FIXED_AMOUNT)) {
                    var formulaEditorNode = $(this).closest('div[data-role=formula-editor]').get(0);
                    var addFieldsObject = $(formulaEditorNode).children('div[data-role=formula-add-controls]');
                    addFieldsObject.attr('data-open', '0');
                    self.addFormulaEntity(null, formulaEditorNode, FormulaInspectorPlugin.ENTITY_TYPE_FIXED_AMOUNT, $);
                }
            }
            else if (e.target.hasAttribute('data-key-code')) {
                if (self.lastMouseDownKeyCode !== null) {
                    var keyCode = parseInt($(e.target).attr('data-key-code'), 10);
                    if (self.lastMouseDownKeyCode === keyCode) {
                        var formulaEditorNode = $(this).closest('div[data-role=formula-editor]').get(0);
                        self.pressKey(keyCode, formulaEditorNode, $);
                    }
                }
            }
            self.lastMouseDownKeyCode = null;
            self.lastMouseDownControlId = null;
        });
        containerObject.on('mouseleave', 'div[data-role=formula-keypad], div[data-role=formula-add-controls]', function () {
            self.lastMouseDownKeyCode = null;
            self.lastMouseDownControlId = null;
        });
        containerObject.on('mousedown', 'div[data-role=formula-input]', function (e) {
            var formulaEditorNode = $(this).closest('div[data-role=formula-editor]').get(0);
            self.handleMouseInteraction(e, formulaEditorNode, $);
        });
        containerObject.on('keydown', 'div[data-role=formula-input]', function (e) {
            var formulaEditorNode = $(this).closest('div[data-role=formula-editor]').get(0);
            self.handleKeyboardInteraction(e, formulaEditorNode, $);
        });
        containerObject.on('keypress', 'div[data-role=formula-input]', function (e) {
            var formulaEditorNode = $(this).closest('div[data-role=formula-editor]').get(0);
            self.handleKeyboardInteraction(e, formulaEditorNode, $);
        });
        containerObject.attr('data-formula-one-time-logic', '1');
    };
    FormulaInspectorPlugin.prototype.refreshAvailableControls = function () {
        if (this.didRefreshAvailableControls) {
            return;
        }
        var self = this;
        var editorDocument = this.editorUi.getEngine().getDocument();
        var thisControlHash = $('#item').attr('data-target-element');
        var thisControl = editorDocument.getElementByHash(thisControlHash);
        var controls = editorDocument.getControlsList();
        this.availableControls = {};
        for (var i = 0; i < controls.length; i++) {
            var controlTypeId = controls[i].getTypeId();
            if (controls[i].getId() != thisControl.getId()
                && (controlTypeId === ElementTypes.CONTROL_TYPE_FORMULA
                    || controlTypeId === ElementTypes.CONTROL_TYPE_NUMBER
                    || controlTypeId === ElementTypes.CONTROL_TYPE_TEXT
                    || controlTypeId === ElementTypes.CONTROL_TYPE_DROPDOWN
                    || controlTypeId === ElementTypes.CONTROL_TYPE_RADIO
                    || controlTypeId === ElementTypes.CONTROL_TYPE_CHECKBOX
                    || controlTypeId === ElementTypes.CONTROL_TYPE_DATE
                    || controlTypeId === ElementTypes.CONTROL_TYPE_TIME
                    || controlTypeId === ElementTypes.CONTROL_TYPE_PRICE
                    || controlTypeId === ElementTypes.CONTROL_TYPE_LIKERT_SCALE
                    || controlTypeId === ElementTypes.CONTROL_TYPE_STAR_RATING
                    || controlTypeId === ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE)) {
                self.availableControls[controls[i].getId()] = controls[i];
            }
        }
        this.didRefreshAvailableControls = true;
    };
    FormulaInspectorPlugin.getCaretMarkup = function () {
        return '<div><strong></strong></div>';
    };
    FormulaInspectorPlugin.prototype.initInputMarkupFromFormula = function (formula, formulaEditorNode) {
        var self = this;
        var markup = '';
        var formulaInputNode = $(formulaEditorNode).find('div[data-role=formula-input]:first').get(0);
        formula = formula.trim().replace(/\s\s+/g, ' ');
        formula = formula.replace(/(-)(:control_[\d]+(_[\d]+)?|:fixed_amount)/g, '$1 $2');
        if (formula.length) {
            this.refreshAvailableControls();
            formula.split(' ').forEach(function (entity) {
                if (entity.indexOf(':control_') == 0) {
                    var controlId = entity.split('_').pop();
                    var validValue = '1';
                    if (self.availableControls.hasOwnProperty(controlId)) {
                        entity = self.availableControls[controlId].getLabelDOMNode().innerText;
                    }
                    else {
                        entity = self.labelOfDeleted;
                        validValue = '0';
                    }
                    markup += ('<span data-control-id="' + controlId + '" data-valid="' + validValue + '">' + entity + '</span>');
                }
                else if (entity === ':fixed_amount') {
                    entity = self.labelOfFixedAmount;
                    markup += ('<span data-fixed-amount="true">' + entity + '</span>');
                }
                else {
                    for (var i = 0; i < entity.length; i++) {
                        markup += ('<span data-character="' + entity[i] + '">' + entity[i] + '</span>');
                    }
                }
            });
        }
        markup += FormulaInspectorPlugin.getCaretMarkup();
        $(formulaInputNode).html(markup);
    };
    FormulaInspectorPlugin.prototype.handleMouseInteraction = function (event, formulaEditorNode, $) {
        var formulaInputObject = $(formulaEditorNode).find('div[data-role=formula-input]:first');
        var caretObject = $('div', formulaInputObject);
        if (event.target === formulaInputObject.get(0)) {
            var clickX = event.pageX - this.formulaInputOffsetLeft;
            var clickY = event.pageY - this.formulaInputOffsetTop;
            if (clickX < 1 && clickY < this.formulaInputRowHeight) {
                caretObject.detach().prependTo(formulaInputObject);
            }
            else {
                caretObject.detach().appendTo(formulaInputObject);
            }
        }
        else if ($(event.target).is('span')) {
            caretObject.detach().insertAfter(event.target);
        }
        event.preventDefault();
        if (document.activeElement !== formulaInputObject.get(0)) {
            formulaInputObject.focus();
        }
    };
    FormulaInspectorPlugin.prototype.handleKeyboardInteraction = function (event, formulaEditorNode, $) {
        if (event.type == 'keydown') {
            if (event.keyCode == 8) {
                event.preventDefault();
                this.executeInputAction(FormulaInspectorPlugin.INPUT_ACTION_DELETE_ONE, formulaEditorNode, null, $);
            }
            else if (event.keyCode == 37) {
                event.preventDefault();
                this.executeInputAction(FormulaInspectorPlugin.INPUT_ACTION_MOVE_LEFT, formulaEditorNode, null, $);
            }
            else if (event.keyCode == 39) {
                event.preventDefault();
                this.executeInputAction(FormulaInspectorPlugin.INPUT_ACTION_MOVE_RIGHT, formulaEditorNode, null, $);
            }
            return;
        }
        var keyCodeToPress = null;
        event.preventDefault();
        switch (event.which) {
            case 48:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_ZERO;
                break;
            case 49:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_ONE;
                break;
            case 50:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_TWO;
                break;
            case 51:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_THREE;
                break;
            case 52:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_FOUR;
                break;
            case 53:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_FIVE;
                break;
            case 54:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_SIX;
                break;
            case 55:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_SEVEN;
                break;
            case 56:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_EIGHT;
                break;
            case 57:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_NINE;
                break;
            case 40:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_PARENTHESES_OPEN;
                break;
            case 41:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_PARENTHESES_CLOSE;
                break;
            case 47:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_DIVIDE;
                break;
            case 42:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_MULTIPLY;
                break;
            case 45:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_SUBSTRACT;
                break;
            case 43:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_ADD;
                break;
            case 46:
                keyCodeToPress = FormulaInspectorPlugin.KEY_CODE_DECIMAL_POINT;
                break;
            default:
                return;
        }
        this.pressKey(keyCodeToPress, formulaEditorNode, $);
    };
    FormulaInspectorPlugin.prototype.pressKey = function (keyCode, formulaEditorNode, $) {
        var characterToAdd = null;
        switch (keyCode) {
            case FormulaInspectorPlugin.KEY_CODE_ADD_FIELD:
                var addFieldsObject_1 = $(formulaEditorNode).children('div[data-role=formula-add-controls]');
                if (addFieldsObject_1.attr('data-open') == '1') {
                    addFieldsObject_1.attr('data-open', '0');
                }
                else {
                    this.refreshAvailableControls();
                    var html = '';
                    var productsSetting = this.editorUi.getEngine().getDocument().getForm()
                        .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING);
                    for (var i in this.availableControls) {
                        if (this.availableControls.hasOwnProperty(i)) {
                            var control = this.availableControls[i];
                            html += '<span data-control-id="' + i + '">' + control.getLabelDOMNode().innerText + '</span>';
                        }
                    }
                    if (productsSetting
                        && productsSetting.hasProperty('fixedAmount')
                        && null !== productsSetting.getProperty('fixedAmount')) {
                        html += '<span data-fixed-amount="true">' + this.labelOfFixedAmount + '</span>';
                    }
                    addFieldsObject_1.children('div').html(html);
                    if (html != '') {
                        addFieldsObject_1.attr('data-open', '1');
                        setTimeout(function () {
                            addFieldsObject_1.children('div').scrollTop(1);
                        }, 0);
                    }
                }
                return;
            case FormulaInspectorPlugin.KEY_CODE_ZERO:
                characterToAdd = '0';
                break;
            case FormulaInspectorPlugin.KEY_CODE_ONE:
                characterToAdd = '1';
                break;
            case FormulaInspectorPlugin.KEY_CODE_TWO:
                characterToAdd = '2';
                break;
            case FormulaInspectorPlugin.KEY_CODE_THREE:
                characterToAdd = '3';
                break;
            case FormulaInspectorPlugin.KEY_CODE_FOUR:
                characterToAdd = '4';
                break;
            case FormulaInspectorPlugin.KEY_CODE_FIVE:
                characterToAdd = '5';
                break;
            case FormulaInspectorPlugin.KEY_CODE_SIX:
                characterToAdd = '6';
                break;
            case FormulaInspectorPlugin.KEY_CODE_SEVEN:
                characterToAdd = '7';
                break;
            case FormulaInspectorPlugin.KEY_CODE_EIGHT:
                characterToAdd = '8';
                break;
            case FormulaInspectorPlugin.KEY_CODE_NINE:
                characterToAdd = '9';
                break;
            case FormulaInspectorPlugin.KEY_CODE_PARENTHESES_OPEN:
                characterToAdd = '(';
                break;
            case FormulaInspectorPlugin.KEY_CODE_PARENTHESES_CLOSE:
                characterToAdd = ')';
                break;
            case FormulaInspectorPlugin.KEY_CODE_DIVIDE:
                characterToAdd = '/';
                break;
            case FormulaInspectorPlugin.KEY_CODE_MULTIPLY:
                characterToAdd = '*';
                break;
            case FormulaInspectorPlugin.KEY_CODE_SUBSTRACT:
                characterToAdd = '-';
                break;
            case FormulaInspectorPlugin.KEY_CODE_ADD:
                characterToAdd = '+';
                break;
            case FormulaInspectorPlugin.KEY_CODE_DECIMAL_POINT:
                characterToAdd = '.';
                break;
            case FormulaInspectorPlugin.KEY_CODE_DELETE_ONE:
                this.executeInputAction(FormulaInspectorPlugin.INPUT_ACTION_DELETE_ONE, formulaEditorNode, null, $);
                return;
            case FormulaInspectorPlugin.KEY_CODE_DELETE_ALL:
                this.executeInputAction(FormulaInspectorPlugin.INPUT_ACTION_DELETE_ALL, formulaEditorNode, null, $);
                return;
            default:
                return;
        }
        this.addFormulaEntity(characterToAdd, formulaEditorNode, FormulaInspectorPlugin.ENTITY_TYPE_REGULAR, $);
    };
    FormulaInspectorPlugin.prototype.addFormulaEntity = function (entity, formulaEditorNode, entityType, $) {
        var entityNode = document.createElement('span');
        switch (entityType) {
            case FormulaInspectorPlugin.ENTITY_TYPE_CONTROL:
                if (!this.availableControls.hasOwnProperty(entity)) {
                    return;
                }
                entityNode.setAttribute('data-control-id', entity);
                entity = this.availableControls[entity].getLabelDOMNode().innerText;
                break;
            case FormulaInspectorPlugin.ENTITY_TYPE_FIXED_AMOUNT:
                entityNode.setAttribute('data-fixed-amount', 'true');
                entity = this.labelOfFixedAmount;
                break;
            case FormulaInspectorPlugin.ENTITY_TYPE_REGULAR:
                entityNode.setAttribute('data-character', entity);
                break;
            default:
                return;
        }
        entityNode.appendChild(document.createTextNode(entity));
        this.executeInputAction(FormulaInspectorPlugin.INPUT_ACTION_ADD, formulaEditorNode, entityNode, $);
    };
    FormulaInspectorPlugin.prototype.executeInputAction = function (action, formulaEditorNode, entityNode, $) {
        if (entityNode === void 0) { entityNode = null; }
        var formulaInputNode = $(formulaEditorNode).find('div[data-role=formula-input]:first').get(0);
        var formulaError = $(formulaEditorNode).parent().parent().parent().find('div[data-role=element-error]').length;
        var runFormulaValidation = true;
        if (document.activeElement !== formulaInputNode) {
            switch (action) {
                case FormulaInspectorPlugin.INPUT_ACTION_ADD:
                    $('div', formulaInputNode).detach().appendTo(formulaInputNode);
                    $(entityNode).insertBefore($('div', formulaInputNode));
                    break;
                case FormulaInspectorPlugin.INPUT_ACTION_DELETE_ONE:
                    $('div', formulaInputNode).detach().appendTo(formulaInputNode);
                    $('span', formulaInputNode).last().remove();
                    break;
                case FormulaInspectorPlugin.INPUT_ACTION_DELETE_ALL:
                    $(formulaInputNode).children().not('div').remove();
                    break;
                default:
                    return;
            }
            $(formulaInputNode).focus();
        }
        else {
            var caretObject = $('div', formulaInputNode);
            var targetObject = void 0;
            switch (action) {
                case FormulaInspectorPlugin.INPUT_ACTION_ADD:
                    $(entityNode).insertBefore(caretObject);
                    break;
                case FormulaInspectorPlugin.INPUT_ACTION_MOVE_LEFT:
                    runFormulaValidation = false;
                    targetObject = caretObject.prev('span');
                    if (targetObject.length) {
                        caretObject.detach().insertBefore(targetObject);
                    }
                    break;
                case FormulaInspectorPlugin.INPUT_ACTION_MOVE_RIGHT:
                    runFormulaValidation = false;
                    targetObject = caretObject.next('span');
                    if (targetObject.length) {
                        caretObject.detach().insertAfter(targetObject);
                    }
                    break;
                case FormulaInspectorPlugin.INPUT_ACTION_DELETE_ONE:
                    caretObject.prev().remove();
                    break;
                case FormulaInspectorPlugin.INPUT_ACTION_DELETE_ALL:
                    $(formulaInputNode).children().not(caretObject).remove();
                    break;
                default:
                    return;
            }
        }
        if (runFormulaValidation) {
            switch (true) {
                case FormulaInspectorPlugin.INPUT_ACTION_TRIGGER_SAVE_ON_BLUR:
                    this.triggerFormulaEvaluationOnBlur($, formulaInputNode);
                    break;
                case formulaError > 0:
                    this.validateFormula(formulaInputNode, $);
                    this.triggerFormulaEvaluationOnBlur($, formulaInputNode);
                    break;
                default:
                    this.validateFormula(formulaInputNode, $);
            }
        }
    };
    FormulaInspectorPlugin.prototype.triggerFormulaEvaluationOnBlur = function ($, formulaInputNode) {
        var self = this;
        $(formulaInputNode).off('blur').one('blur', function () {
            formulaInputNode.setAttribute('data-focused', '0');
            self.validateFormula(formulaInputNode, $);
        });
        $('[data-role="page"]').off('click').one('click', function () {
            formulaInputNode.setAttribute('data-focused', '0');
            self.validateFormula(formulaInputNode, $);
        });
    };
    FormulaInspectorPlugin.prototype.validateFormula = function (formulaInputNode, $) {
        var self = this;
        var controlHash = $('#item').attr('data-target-element');
        if (this.validationQueues.hasOwnProperty(controlHash)) {
            clearTimeout(this.validationQueues[controlHash]);
        }
        this.validationQueues[controlHash] = setTimeout(function () {
            var control = self.editorUi.getEngine().getDocument().getElementByHash(controlHash);
            if (!control) {
                return;
            }
            var $piecesObject = $(formulaInputNode).children('span');
            var formula = '';
            $piecesObject.each(function () {
                var toAppend = '';
                if (this.hasAttribute('data-control-id')) {
                    toAppend = ':control_' + this.getAttribute('data-control-id');
                }
                else if (this.hasAttribute('data-fixed-amount')) {
                    toAppend = ':fixed_amount';
                }
                else {
                    toAppend = this.innerText;
                }
                if (!toAppend.length) {
                    return;
                }
                if (toAppend == '.' || parseInt(toAppend, 10) >= 0) {
                    formula += toAppend;
                }
                else {
                    formula = (formula.trim() + ' ' + toAppend + ' ');
                }
            });
            formula = formula.trim();
            formula = formula.replace(/([*\/+]\s-)\s/g, '$1');
            control.setProperty('calculations.formula', formula);
        }, 500);
    };
    FormulaInspectorPlugin.NAME = 'FormulaInspectorPlugin';
    FormulaInspectorPlugin.ENTITY_TYPE_REGULAR = 1;
    FormulaInspectorPlugin.ENTITY_TYPE_CONTROL = 2;
    FormulaInspectorPlugin.ENTITY_TYPE_FIXED_AMOUNT = 3;
    FormulaInspectorPlugin.CONTROL_ID_FIXED_AMOUNT = -1;
    FormulaInspectorPlugin.KEY_CODE_ADD_FIELD = 100;
    FormulaInspectorPlugin.KEY_CODE_ZERO = 1;
    FormulaInspectorPlugin.KEY_CODE_ONE = 2;
    FormulaInspectorPlugin.KEY_CODE_TWO = 3;
    FormulaInspectorPlugin.KEY_CODE_THREE = 4;
    FormulaInspectorPlugin.KEY_CODE_FOUR = 5;
    FormulaInspectorPlugin.KEY_CODE_FIVE = 6;
    FormulaInspectorPlugin.KEY_CODE_SIX = 7;
    FormulaInspectorPlugin.KEY_CODE_SEVEN = 8;
    FormulaInspectorPlugin.KEY_CODE_EIGHT = 9;
    FormulaInspectorPlugin.KEY_CODE_NINE = 10;
    FormulaInspectorPlugin.KEY_CODE_PARENTHESES_OPEN = 11;
    FormulaInspectorPlugin.KEY_CODE_PARENTHESES_CLOSE = 12;
    FormulaInspectorPlugin.KEY_CODE_DELETE_ONE = 13;
    FormulaInspectorPlugin.KEY_CODE_DELETE_ALL = 14;
    FormulaInspectorPlugin.KEY_CODE_DIVIDE = 15;
    FormulaInspectorPlugin.KEY_CODE_MULTIPLY = 16;
    FormulaInspectorPlugin.KEY_CODE_SUBSTRACT = 17;
    FormulaInspectorPlugin.KEY_CODE_ADD = 18;
    FormulaInspectorPlugin.KEY_CODE_DECIMAL_POINT = 19;
    FormulaInspectorPlugin.INPUT_ACTION_ADD = 1;
    FormulaInspectorPlugin.INPUT_ACTION_MOVE_LEFT = 2;
    FormulaInspectorPlugin.INPUT_ACTION_MOVE_RIGHT = 3;
    FormulaInspectorPlugin.INPUT_ACTION_DELETE_ONE = 4;
    FormulaInspectorPlugin.INPUT_ACTION_DELETE_ALL = 5;
    FormulaInspectorPlugin.INPUT_ACTION_TRIGGER_SAVE_ON_BLUR = true;
    return FormulaInspectorPlugin;
}());
var SquareStoreLocationInspectorPlugin = (function () {
    function SquareStoreLocationInspectorPlugin() {
    }
    SquareStoreLocationInspectorPlugin.prototype.getName = function () {
        return SquareStoreLocationInspectorPlugin.NAME;
    };
    SquareStoreLocationInspectorPlugin.prototype.upgrade = function ($, container, editorUi) {
        var $container = $(container);
        var locationEditorNode = $container
            .find('div[data-role=property][data-property-name=locationId]').get(0) || null;
        var setting = editorUi.getEngine().getDocument()
            .getEditorSettingByTypeId($('#item').attr('data-target-setting-id'));
        if (!locationEditorNode || !setting) {
            return;
        }
        var model = {
            selectedValue: setting.getProperty('locationId'),
            locations: FormUtils.clone(setting.getProperty('locations'))
        };
        if (!locationEditorNode.hasAttribute('data-is-upgrading')) {
            $.when(editorUi.getEngine().getResourceManager()
                .get('/modules/Typescript/Form/resources/editor/Payments/Processors/Square/store-location.html')).then(function (template) {
                $('span.property-label', locationEditorNode).siblings().remove();
                $((new Salvage(template)).parse(model)).insertAfter($('span.property-label', locationEditorNode));
                locationEditorNode.setAttribute('data-is-upgrading', '1');
                editorUi.upgrade(document.querySelector('#item [data-role="vertical-content"]'));
            });
        }
        else {
            locationEditorNode.removeAttribute('data-is-upgrading');
        }
    };
    SquareStoreLocationInspectorPlugin.NAME = 'SquareStoreLocationInspectorPlugin';
    return SquareStoreLocationInspectorPlugin;
}());
var SquareStoreLocationsPopupInspectorPlugin = (function () {
    function SquareStoreLocationsPopupInspectorPlugin() {
    }
    SquareStoreLocationsPopupInspectorPlugin.prototype.getName = function () {
        return SquareStoreLocationsPopupInspectorPlugin.NAME;
    };
    SquareStoreLocationsPopupInspectorPlugin.prototype.upgrade = function ($, domNode, editorUserInterface) {
        (function (self) {
            $(domNode).find("[data-role=property][data-property-name=locations][data-property-type=string]").each(function () {
                $(this).find("a[data-role=edit-square-locations]").each(function () {
                    this.onclick = function () {
                        self.openSquareLocationsDialog($, domNode, editorUserInterface);
                    };
                });
            });
        })(this);
    };
    SquareStoreLocationsPopupInspectorPlugin.prototype.openSquareLocationsDialog = function ($, domNode, editorUserInterface) {
        var currentSetting = editorUserInterface.getEngine().getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING);
        if (!currentSetting) {
            console.error('Could not oppen Square locations dialog, invalid settings');
            return;
        }
        var locationsList = FormUtils.clone(currentSetting.getProperty("locations"));
        (function (self, ui, resourceManager, i18n) {
            var dialog = ui.createDialog(i18n.translateText('edt_UI_setting_processor_square_active_locations'), [
                {
                    type: EDialogButtonType.CLOSE,
                    callback: function () {
                        dialog.close();
                    }
                }
            ], {
                "width": "900px",
                "height": "615px"
            });
            dialog.dialog.setAttribute('data-dialog-role', 'square-active-locations');
            resourceManager.get('/modules/Typescript/Form/resources/editor/Payments/Processors/Square/square-locations-dialog.html').then(function (templateMarkup) {
                var model = {
                    "locations": locationsList
                }, template = new Salvage(templateMarkup);
                dialog.body.innerHTML = template.parse(model);
                i18n.translateDOMNode(dialog.body);
            }).fail(function (e) {
                console.error(e);
            });
        })(this, editorUserInterface.getEngine().getLoader().getUI(), editorUserInterface.getEngine().getResourceManager(), editorUserInterface.getEngine().getLoader().getI18n());
    };
    SquareStoreLocationsPopupInspectorPlugin.NAME = 'SquareStoreLocationsPopupInspectorPlugin';
    return SquareStoreLocationsPopupInspectorPlugin;
}());
var PaymentProcessorsInspectorPlugin = (function () {
    function PaymentProcessorsInspectorPlugin() {
    }
    PaymentProcessorsInspectorPlugin.prototype.getName = function () {
        return PaymentProcessorsInspectorPlugin.NAME;
    };
    PaymentProcessorsInspectorPlugin.prototype.upgrade = function ($, container, editorUi) {
        var itemNode = document.querySelector('#item');
        var settingTypeId = itemNode.getAttribute('data-target-setting-id');
        if (itemNode.getAttribute('data-target-element-type') !== 'setting'
            || EditorSettingGroups
                .getGroupSettingTypeIds(EditorSettingGroups.PAYMENT_PROCESSORS)
                .indexOf(settingTypeId) === -1) {
            return;
        }
        var setting = editorUi.getEngine().getDocument().getEditorSettingByTypeId(settingTypeId);
        if (!setting) {
            return;
        }
        var configuration = editorUi.getEngine().getDocument().getConfiguration();
        $.when(editorUi.getEngine().getResourceManager()
            .get('/modules/Typescript/Form/resources/editor/Payments/Processors/testing-mode.html')).then(function (template) {
            var testingModeContainer = container.querySelector('[data-role="attribute-group"][data-name="testing_mode"]');
            var properties;
            if (testingModeContainer) {
                properties = testingModeContainer.querySelectorAll("[data-role=\"property\"]:not([data-property-name=\"" + PaymentProcessorsInspectorPlugin.USE_SANDBOX_PROPERTY_NAME + "\"])");
                testingModeContainer.remove();
            }
            template = (new Salvage(template)).parse({
                useSandbox: !!configuration.getProperty('isPaymentSandboxEnabled')
            });
            var anchor = container.querySelector('[data-role="attribute-group"]:last-child');
            if (anchor) {
                anchor.insertAdjacentHTML('afterend', template);
            }
            else {
                anchor = container.querySelector('[data-role="separator"]');
                if (!anchor) {
                    return;
                }
                anchor.insertAdjacentHTML('beforebegin', template);
            }
            var sandboxCheckbox = container.querySelector("[data-property-name=\"" + PaymentProcessorsInspectorPlugin.USE_SANDBOX_PROPERTY_NAME + "\"] input[type=\"checkbox\"]");
            if (!sandboxCheckbox) {
                return;
            }
            sandboxCheckbox.addEventListener('change', function (evt) {
                configuration.withProperty('isPaymentSandboxEnabled', evt.target.checked);
                editorUi.getEngine().getLoader().trigger('payments_use_sandbox_changed');
            }, { passive: true });
            if (!properties) {
                return;
            }
            sandboxCheckbox.addEventListener('change', function () {
                var properties = container.querySelectorAll("[data-role=\"attribute-group\"][data-name=\"testing_mode\"] [data-role=\"property\"]:not([data-property-name=\"" + PaymentProcessorsInspectorPlugin.USE_SANDBOX_PROPERTY_NAME + "\"])");
                if (!properties) {
                    return;
                }
                properties.forEach(function (property) {
                    property.style.display = (property.style.display === 'block' || property.style.display === '') ? 'none' : 'block';
                });
            }, { passive: true });
            var sandbox = container.querySelector("[data-property-name=\"" + PaymentProcessorsInspectorPlugin.USE_SANDBOX_PROPERTY_NAME + "\"]");
            properties.forEach(function (property) {
                sandbox.insertAdjacentElement('afterend', property);
                if (!configuration.getProperty('isPaymentSandboxEnabled')) {
                    property.style.display = 'none';
                }
            });
        });
    };
    PaymentProcessorsInspectorPlugin.NAME = 'PaymentProcessorsInspectorPlugin';
    PaymentProcessorsInspectorPlugin.USE_SANDBOX_PROPERTY_NAME = 'useSandbox';
    return PaymentProcessorsInspectorPlugin;
}());
var PaymentProcessorsAssocsInspectorPlugin = (function () {
    function PaymentProcessorsAssocsInspectorPlugin() {
        this.supportedSettingTypeIds = [
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
        ];
        this.disabled = false;
        this.readyPluginTargetsCount = 0;
    }
    PaymentProcessorsAssocsInspectorPlugin.prototype.getName = function () {
        return PaymentProcessorsAssocsInspectorPlugin.NAME;
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.upgrade = function ($, container, editorUi) {
        var _this = this;
        if (this.disabled) {
            this.disabled = false;
            return;
        }
        var itemNode = document.getElementById('item');
        var settingId = itemNode.getAttribute('data-target-setting-id');
        if (itemNode.getAttribute('data-target-element-type') !== 'setting'
            || -1 === this.supportedSettingTypeIds.indexOf(settingId)) {
            return;
        }
        this.pluginTargets = [];
        switch (settingId) {
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING:
                this.setting = editorUi.getEngine().getDocument().getEditorSettingByTypeId(settingId);
                this.pluginTargets.push({
                    node: container.querySelector('[data-role="attribute-group"][data-name="shipping_information"]'),
                    propertyName: 'shippingInformation',
                    triggerPropertyName: 'useShipping'
                });
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING:
                this.setting = editorUi.getEngine().getDocument().getEditorSettingByTypeId(settingId);
                this.pluginTargets.push({
                    node: container.querySelector('[data-role="attribute-group"][data-name="shipping_information"]'),
                    propertyName: 'shippingInformation',
                    triggerPropertyName: 'useShipping'
                });
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING:
                this.setting = editorUi.getEngine().getDocument().getEditorSettingByTypeId(settingId);
                this.pluginTargets.push({
                    node: container.querySelector('[data-role="attribute-group"][data-name="client_information"]'),
                    propertyName: 'clientInformation',
                    triggerPropertyName: null
                }, {
                    node: container.querySelector('[data-role="attribute-group"][data-name="invoice_information"]'),
                    propertyName: 'invoiceInformation',
                    triggerPropertyName: null
                });
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING:
                this.setting = editorUi.getEngine().getDocument().getEditorSettingByTypeId(settingId);
                this.pluginTargets.push({
                    node: container.querySelector('[data-role="attribute-group"][data-name="description_information"]'),
                    propertyName: 'description',
                    useSingleValue: true,
                    triggerPropertyName: null
                });
                break;
        }
        if (!this.setting || !this.pluginTargets.length) {
            return;
        }
        this.jQuery = $;
        this.editorUi = editorUi;
        this.controls = null;
        this.readyPluginTargetsCount = 0;
        this.pluginTargets.forEach(function (pluginTarget) {
            _this.processPluginTarget(pluginTarget);
        });
        var OTLAttributeName = 'data-assocs-' + settingId.replace(/_/g, '-') + '-otl';
        if (container.hasAttribute(OTLAttributeName)) {
            return;
        }
        var self = this;
        var $editor = $('#item').parent();
        var settingSelector = '[id="item"][data-target-setting-id="' + settingId + '"]';
        this.pluginTargets.forEach(function (pluginTarget, i) {
            var triggerPropertySelector = settingSelector
                + ' [data-role="property"][data-property-name="' + pluginTarget.triggerPropertyName + '"]';
            var assocsInputsSelector = settingSelector
                + ' [data-role="property"][data-property-name="' + pluginTarget.propertyName + '"]'
                + ' [data-plugin="payment-processors-assocs"] [data-role="secondary"]';
            if (pluginTarget.triggerPropertyName) {
                $editor.on('click', triggerPropertySelector, function (e) {
                    if (e.target.tagName.toUpperCase() !== 'INPUT') {
                        return;
                    }
                    setTimeout(function () {
                        self.processPluginTarget(self.pluginTargets[i], true);
                    }, 0);
                });
            }
            $editor.on('input', assocsInputsSelector, function () {
                var pluginTarget = self.pluginTargets[i];
                var propertyData;
                var valueType = this.getAttribute('data-type') || null;
                var value = this.value.length
                    ? PaymentProcessorsAssocsInspectorPlugin.ensurePropertyValueWithType(this.value, valueType)
                    : null;
                if ('useSingleValue' in pluginTarget && pluginTarget.useSingleValue) {
                    propertyData = value;
                }
                else {
                    var fieldName = $(this).closest('[data-assoc-field]').attr('data-field-name');
                    propertyData = self.getMultipleValuePropertyData(pluginTarget.propertyName);
                    if (fieldName in propertyData) {
                        propertyData[fieldName] = value;
                    }
                }
                self.setting.setProperty(pluginTarget.propertyName, propertyData);
            });
        });
        var addControlsTriggerSelector = settingSelector
            + ' div[data-role=add-controls] > span';
        var addControlsItemSelector = settingSelector
            + ' div[data-role=add-controls] > div > span';
        $editor.on('click', addControlsTriggerSelector, function () {
            var rootNode = this.parentNode;
            var visible = rootNode.getAttribute('data-open') === '1';
            rootNode.setAttribute('data-open', visible ? '0' : '1');
            if (!visible) {
                setTimeout(function () {
                    $(rootNode).children('div').perfectScrollbar({
                        minScrollbarLength: 50,
                        maxScrollbarLength: 50
                    });
                }, 0);
            }
        });
        $editor.on('click', addControlsItemSelector, function () {
            var rootNode = $(this).closest('div[data-role=add-controls]').get(0);
            var textNode = rootNode.parentNode.querySelector('textarea');
            var placeholder = '[{' + this.innerText + '(' + this.getAttribute('data-control-id') + ')}]';
            if ('selection' in document && 'createRange' in document['selection']) {
                textNode.focus();
                var selection = document['selection']['createRange'].call(document['selection']);
                selection.text = placeholder;
            }
            else if (textNode.selectionStart || textNode.selectionStart === 0) {
                var start = textNode.selectionStart;
                var end = textNode.selectionEnd;
                var finalCaretPosition = start + placeholder.length;
                textNode.value =
                    textNode.value.substring(0, start)
                        + placeholder
                        + textNode.value.substring(end, textNode.value.length);
                textNode.selectionStart = finalCaretPosition;
                textNode.selectionEnd = finalCaretPosition;
            }
            else {
                textNode.value += placeholder;
            }
            $(textNode).trigger('input');
            rootNode.setAttribute('data-open', '0');
        });
        container.setAttribute(OTLAttributeName, '1');
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.processPluginTarget = function (pluginTarget, immediateDOMUpdate) {
        var _this = this;
        if (immediateDOMUpdate === void 0) { immediateDOMUpdate = false; }
        if (!pluginTarget || !pluginTarget.node) {
            return;
        }
        var visible = pluginTarget.triggerPropertyName
            ? !!this.setting.getProperty(pluginTarget.triggerPropertyName)
            : true;
        var pluginNode = pluginTarget.node;
        var propertyName = pluginTarget.propertyName;
        var isVisible = pluginNode.getAttribute('data-visible') === '1';
        var hasAsyncJob = false;
        if (visible) {
            var $_1 = this.jQuery;
            var model_1 = this.getTemplateModel(pluginTarget);
            if (this.setting.getProperty(propertyName) === null
                && (!('useSingleValue' in pluginTarget) || !pluginTarget.useSingleValue)) {
                this.setting.setProperty(propertyName, this.getMultipleValuePropertyData(propertyName));
            }
            if (!pluginNode.hasAttribute('data-is-upgraded')) {
                hasAsyncJob = true;
                $_1.when(this.editorUi.getEngine().getResourceManager()
                    .get('/modules/Typescript/Form/resources/editor/Payments/Processors/field-assocs.html')).done(function (template) {
                    var $anchor = $_1('[data-role="property"][data-property-name="' + propertyName + '"] span.property-label', pluginNode);
                    $anchor.siblings().remove();
                    $_1((new Salvage(template)).parse(model_1)).insertAfter($anchor);
                    pluginNode.setAttribute('data-is-upgraded', '1');
                    _this.notifyPluginTargetReady(immediateDOMUpdate);
                });
            }
        }
        else {
            if (visible !== isVisible) {
                this.setting.setProperty(propertyName, null);
                pluginNode.removeAttribute('data-is-upgraded');
            }
        }
        if (!hasAsyncJob) {
            this.notifyPluginTargetReady(immediateDOMUpdate);
        }
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.getTemplateModel = function (pluginTarget) {
        var propertyName = pluginTarget.propertyName;
        var model = this.getEmptyTemplateModel(propertyName);
        var data = this.setting
            ? this.setting.getProperty(propertyName)
            : null;
        model.fields.forEach(function (field) {
            if ('useSingleValue' in pluginTarget && pluginTarget.useSingleValue) {
                field.value = data;
            }
            else {
                field.value = data && (data.hasOwnProperty(field.name))
                    ? data[field.name]
                    : ('defaultValue' in field ? field.defaultValue : null);
            }
        });
        model.controls = this.getFormControls();
        return model;
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.getMultipleValuePropertyData = function (propertyName) {
        var data = {};
        var model = this.getEmptyTemplateModel(propertyName);
        var propertyData = this.setting.getProperty(propertyName) || {};
        model.fields.forEach(function (field) {
            var fieldName = field.name;
            data[fieldName] = fieldName in propertyData
                ? propertyData[fieldName]
                : ('defaultValue' in field ? field.defaultValue : null);
        });
        return data;
    };
    PaymentProcessorsAssocsInspectorPlugin.ensurePropertyValueWithType = function (value, valueType) {
        switch (valueType) {
            case 'int':
                return parseInt(value, 10);
            default:
                return String(value);
        }
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.getFormControls = function () {
        var _this = this;
        if (this.controls) {
            return this.controls;
        }
        this.controls = [];
        var controls = this.editorUi.getEngine().getDocument().getControlsList();
        controls.forEach(function (control) {
            if (!control.getLabelDOMNode()) {
                return;
            }
            var controlId = control.getId();
            var controlName = control.getLabelDOMNode().innerText;
            if (control.getTypeId() === ElementTypes.CONTROL_TYPE_ADDRESS
                || control.getTypeId() === ElementTypes.CONTROL_TYPE_NAME) {
                control.getInputDOMNodes().forEach(function (section) {
                    section.inputs.forEach(function (input) {
                        var inputNode = input.input instanceof HTMLInputElement
                            ? input.input
                            : input.input.getRootNode();
                        var inputI18nLabel = inputNode.hasAttribute('data-i18n-placeholder')
                            ? inputNode.getAttribute('data-i18n-placeholder')
                            : $(inputNode).find('input[data-i18n-placeholder]').attr('data-i18n-placeholder');
                        _this.controls.push({
                            id: controlId + '-' + inputNode.getAttribute('data-index'),
                            label: controlName
                                + ' - '
                                + _this.editorUi.getEngine().getI18n().translateText(inputI18nLabel)
                        });
                    });
                });
            }
            else {
                _this.controls.push({
                    id: String(controlId),
                    label: controlName
                });
            }
        });
        return this.controls;
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.notifyPluginTargetReady = function (immediateDOMUpdate) {
        if (immediateDOMUpdate === void 0) { immediateDOMUpdate = false; }
        this.readyPluginTargetsCount++;
        (immediateDOMUpdate || this.readyPluginTargetsCount === this.pluginTargets.length)
            && this.executeDOMUpdate();
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.executeDOMUpdate = function () {
        var _this = this;
        this.readyPluginTargetsCount = 0;
        this.disabled = true;
        this.pluginTargets.forEach(function (pluginTarget) {
            var visible = pluginTarget.triggerPropertyName
                ? !!_this.setting.getProperty(pluginTarget.triggerPropertyName)
                : true;
            pluginTarget.node.setAttribute('data-visible', visible ? '1' : '0');
        });
        this.editorUi.upgrade(document.querySelector('#item [data-role="vertical-content"]'));
    };
    PaymentProcessorsAssocsInspectorPlugin.prototype.getEmptyTemplateModel = function (propertyName) {
        var _this = this;
        var translate = function (label) {
            return _this.editorUi.getEngine().getI18n().translateText(label);
        };
        var model = {
            descriptionTexts: [],
            textFieldPlaceholder: translate('edt_text_write_something'),
            addFieldTriggerLabel: translate('payments_addField'),
            fields: [],
            controls: [],
        };
        var settingId = this.setting.getTypeId();
        switch (settingId) {
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING:
            case EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING:
                model.descriptionTexts = [
                    translate('edt_text_paypal_shipping_info_title'),
                    translate('edt_text_paypal_shipping_info_warning')
                ];
                model.fields.push({
                    name: 'firstName',
                    label: translate('edt_text_paypal_shipping_info_firstName'),
                    showEmptyOption: true
                }, {
                    name: 'lastName',
                    label: translate('edt_text_paypal_shipping_info_lastName'),
                    showEmptyOption: true
                }, {
                    name: 'email',
                    label: translate('edt_text_paypal_shipping_info_email'),
                    showEmptyOption: true
                }, {
                    name: 'address1',
                    label: translate('edt_text_paypal_shipping_info_address1'),
                    showEmptyOption: true,
                    required: true
                }, {
                    name: 'address2',
                    label: translate('edt_text_paypal_shipping_info_address2'),
                    showEmptyOption: true
                }, {
                    name: 'city',
                    label: translate('edt_text_paypal_shipping_info_city'),
                    showEmptyOption: true,
                    required: true
                }, {
                    name: 'stateCode',
                    label: translate('edt_text_paypal_shipping_info_stateCode'),
                    showEmptyOption: true
                }, {
                    name: 'zipCode',
                    label: translate('edt_text_paypal_shipping_info_zipCode'),
                    showEmptyOption: true
                }, {
                    name: 'countryCode',
                    label: translate('edt_text_paypal_shipping_info_countryCode'),
                    showEmptyOption: true,
                    required: true
                });
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING:
                switch (propertyName) {
                    case 'clientInformation':
                        model.descriptionTexts = [
                            translate('edt_text_paypal_shipping_info_title'),
                            translate('edt_text_paypal_shipping_info_warning')
                        ];
                        model.fields.push({
                            name: 'email',
                            label: translate('edt_text_freshbooks_client_info_email'),
                            showEmptyOption: true,
                            required: true
                        }, {
                            name: 'firstName',
                            label: translate('edt_text_freshbooks_client_info_firstName'),
                            showEmptyOption: true,
                            required: true
                        }, {
                            name: 'lastName',
                            label: translate('edt_text_freshbooks_client_info_lastName'),
                            showEmptyOption: true,
                            required: true
                        }, {
                            name: 'organization',
                            label: translate('edt_text_freshbooks_client_info_organization'),
                            showEmptyOption: true
                        }, {
                            name: 'address1',
                            label: translate('edt_text_freshbooks_client_info_address1'),
                            showEmptyOption: true
                        }, {
                            name: 'address2',
                            label: translate('edt_text_freshbooks_client_info_address2'),
                            showEmptyOption: true
                        }, {
                            name: 'city',
                            label: translate('edt_text_freshbooks_client_info_city'),
                            showEmptyOption: true
                        }, {
                            name: 'state',
                            label: translate('edt_text_freshbooks_client_info_state'),
                            showEmptyOption: true
                        }, {
                            name: 'country',
                            label: translate('edt_text_freshbooks_client_info_country'),
                            showEmptyOption: true
                        }, {
                            name: 'code',
                            label: translate('edt_text_freshbooks_client_info_code'),
                            showEmptyOption: true
                        }, {
                            name: 'workPhone',
                            label: translate('edt_text_freshbooks_client_info_workPhone'),
                            showEmptyOption: true
                        }, {
                            name: 'homePhone',
                            label: translate('edt_text_freshbooks_client_info_homePhone'),
                            showEmptyOption: true
                        }, {
                            name: 'mobilePhone',
                            label: translate('edt_text_freshbooks_client_info_mobilePhone'),
                            showEmptyOption: true
                        }, {
                            name: 'fax',
                            label: translate('edt_text_freshbooks_client_info_fax'),
                            showEmptyOption: true
                        }, {
                            name: 'internalNotes',
                            label: translate('edt_text_freshbooks_client_info_internalNotes'),
                            allowTextInput: true
                        });
                        break;
                    case 'invoiceInformation':
                        model.fields.push({
                            name: 'type',
                            label: translate('edt_text_freshbooks_invoice_info_create'),
                            showEmptyOption: false,
                            defaultValue: 0,
                            type: 'int',
                            options: [
                                { id: 0, label: translate('edt_text_freshbooks_invoice_info_create_invoice') },
                                { id: 1, label: translate('edt_text_freshbooks_invoice_info_create_estimate') }
                            ]
                        }, {
                            name: 'status',
                            label: translate('edt_text_freshbooks_invoice_info_status'),
                            showEmptyOption: false,
                            defaultValue: 0,
                            type: 'int',
                            options: [
                                { id: 0, label: translate('edt_text_freshbooks_invoice_info_status_email') },
                                { id: 1, label: translate('edt_text_freshbooks_invoice_info_status_draft') }
                            ]
                        }, {
                            name: 'notes',
                            label: translate('edt_text_freshbooks_invoice_info_notes'),
                            allowTextInput: true
                        }, {
                            name: 'terms',
                            label: translate('edt_text_freshbooks_invoice_info_terms'),
                            allowTextInput: true
                        });
                        break;
                }
                break;
            case EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING:
                model.descriptionTexts = [
                    translate('edt_UI_setting_processor_attribute_description_property_description')
                ];
                model.fields.push({
                    name: 'description',
                    allowTextInput: true
                });
                break;
        }
        return model;
    };
    PaymentProcessorsAssocsInspectorPlugin.NAME = 'PaymentProcessorsAssocsInspectorPlugin';
    return PaymentProcessorsAssocsInspectorPlugin;
}());
var SagepayCustomerEmailInspectorPlugin = (function () {
    function SagepayCustomerEmailInspectorPlugin() {
    }
    SagepayCustomerEmailInspectorPlugin.prototype.getName = function () {
        return SagepayCustomerEmailInspectorPlugin.NAME;
    };
    SagepayCustomerEmailInspectorPlugin.prototype.upgrade = function ($, container, editorUi) {
        var emailEditorNode = $(container)
            .find('div[data-role=property][data-property-name=customerEmail]').get(0) || null;
        var setting = editorUi.getEngine().getDocument()
            .getEditorSettingByTypeId($('#item').attr('data-target-setting-id'));
        if (!emailEditorNode || !setting) {
            return;
        }
        if (!emailEditorNode.hasAttribute('data-is-upgrading')) {
            var controls_1 = [];
            editorUi.getEngine().getDocument().getControlsList().forEach(function (control) {
                if (control.getTypeId() === ElementTypes.CONTROL_TYPE_EMAIL) {
                    controls_1.push({
                        id: control.getId(),
                        name: control.getLabelDOMNode().innerText
                    });
                }
            });
            var model_2 = {
                selectedValue: setting.getProperty('customerEmail'),
                controls: FormUtils.clone(controls_1)
            };
            $.when(editorUi.getEngine().getResourceManager()
                .get('/modules/Typescript/Form/resources/editor/Payments/Processors/Sagepay/customer-email.html')).then(function (template) {
                $('span.property-label', emailEditorNode).siblings().remove();
                $((new Salvage(template)).parse(model_2)).insertAfter($('span.property-label', emailEditorNode));
                emailEditorNode.setAttribute('data-is-upgrading', '1');
                editorUi.upgrade(document.querySelector('#item [data-role="vertical-content"]'));
            });
        }
        else {
            emailEditorNode.removeAttribute('data-is-upgrading');
        }
    };
    SagepayCustomerEmailInspectorPlugin.NAME = 'SagepayCustomerEmailInspectorPlugin';
    return SagepayCustomerEmailInspectorPlugin;
}());
var WorkflowEditUsersListInspectorPlugin = (function () {
    function WorkflowEditUsersListInspectorPlugin() {
    }
    WorkflowEditUsersListInspectorPlugin.prototype.getName = function () {
        return WorkflowEditUsersListInspectorPlugin.NAME;
    };
    WorkflowEditUsersListInspectorPlugin.prototype.upgrade = function ($, domNode, editorUserInterface) {
        (function (self) {
            $(domNode).find('[data-property-name="choices-isWorkflowsUserDropdown"]').each(function () {
                $(this)
                    .on("click", "[data-role=edit-workflows-users]", function () {
                    var controlHash = $(this).closest('#item[data-role=editor-panel][data-target-element]').attr('data-target-element'), dropdownControl = editorUserInterface.getEngine().getDocument().getElementByHash(controlHash);
                    self.editUsersList(dropdownControl, $, editorUserInterface);
                })
                    .on('change', 'input[type=checkbox]', function () {
                    if (this.checked) {
                        $(this).closest('[data-role=attribute-group]').attr('data-hide-choices', '');
                    }
                    else {
                        $(this).closest('[data-role=attribute-group]').attr('data-hide-choices', null);
                        var controlHash = $(this).closest('#item[data-role=editor-panel][data-target-element]').attr('data-target-element'), dropdownControl = editorUserInterface.getEngine().getDocument().getElementByHash(controlHash), workflowUsersList = [{ text: 'Please Select' }];
                        dropdownControl
                            .setProperty('choices.isWorkflowsUserDropdownSelectAll', false)
                            .setProperty('choices.values', workflowUsersList)
                            .synchronizeValue();
                        editorUserInterface.getEngine().getLoader().getCommandDispatcher().reloadVisiblePanel();
                    }
                });
                (function (self) {
                    setTimeout(function () {
                        $(self).find('input[type=checkbox]').each(function () {
                            var optionEnabled = this.checked;
                            $(this)
                                .closest('[data-role=attribute-group]')
                                .attr('data-hide-choices', optionEnabled
                                ? ''
                                : null);
                        });
                    }, 50);
                })(this);
            });
        })(this);
    };
    WorkflowEditUsersListInspectorPlugin.prototype.editUsersList = function (dropdownControl, $, editorUserInterface) {
        (function (ui, resourceManager, availableUsersList) {
            var dialog = ui.createDialog('Edit users list', [
                {
                    type: EDialogButtonType.SAVE,
                    callback: function () {
                        var selectedUsersList = [];
                        $(dialog.body).find('table tr[data-user-id]').each(function () {
                            var row = this;
                            $(this).find('input[type=checkbox]').each(function () {
                                if (this.checked) {
                                    selectedUsersList.push({
                                        id: ~~row.getAttribute('data-user-id'),
                                        email: row.getAttribute('data-user-email')
                                    });
                                }
                            });
                        });
                        var newDropdownChoices = [];
                        for (var i = 0, len = selectedUsersList.length; i < len; i++) {
                            newDropdownChoices.push({
                                text: selectedUsersList[i].email,
                            });
                        }
                        dropdownControl.setProperty('choices.values', newDropdownChoices);
                        dialog.close();
                    },
                },
                {
                    type: EDialogButtonType.CANCEL,
                    callback: function () {
                        dialog.close();
                    }
                }
            ], {
                width: "500px",
                height: "500px",
            });
            dialog.dialog.setAttribute('data-dialog-role', 'workflows-edit-users-dialog');
            $(dialog.body).on('change', 'table thead tr[data-role=all] input[type=checkbox]', function (i, v) {
                dropdownControl.setProperty('choices.isWorkflowsUserDropdownSelectAll', this.checked);
                $(dialog.body).find('table tbody tr[data-user-id] td input[type=checkbox]').prop("checked", this.checked);
            });
            $(dialog.body).on('change', 'table tbody tr[data-user-id] input[type=checkbox]', function (i, v) {
                if (this.checked === false) {
                    $(dialog.body).find('table thead tr[data-role=all] td input[type=checkbox]').prop("checked", false);
                    dropdownControl.setProperty('choices.isWorkflowsUserDropdownSelectAll', false);
                }
            });
            resourceManager
                .get('/modules/Typescript/Form/resources/editor/Dropdown/workflows-edit-users-list-dialog.html')
                .then(function (templateMarkup) {
                var template = new Salvage(templateMarkup), dropdownChoices = dropdownControl.getProperty('choices.values') || [], model = {
                    users: (function (allUsers) {
                        var result = [], isSelected;
                        for (var i = 0, len = allUsers.length; i < len; i++) {
                            isSelected = false;
                            for (var j = 0, n = dropdownChoices.length; j < n; j++) {
                                if (allUsers[i].email.toLowerCase() === String(dropdownChoices[j].text || '').toLowerCase()) {
                                    isSelected = true;
                                    break;
                                }
                            }
                            result.push({
                                id: allUsers[i].id,
                                email: allUsers[i].email,
                                selected: isSelected
                            });
                        }
                        return result;
                    })(FormUtils.clone(availableUsersList)),
                    allCheckbox: dropdownControl.getProperty('choices.isWorkflowsUserDropdownSelectAll') || false
                };
                dialog.body.innerHTML = template.parse(model);
                if (model.allCheckbox) {
                    $(dialog.body).find('table tr[data-user-id] input[type=checkbox]').prop('checked', true);
                }
            })
                .fail(function (e) {
                ui.alert('Error loading component', 'There was a network error obtaining the dialog contents. Please retry. If the problem persists, contact support', function () {
                    dialog.close();
                });
            });
        })(editorUserInterface.getEngine().getLoader().getUI(), editorUserInterface.getEngine().getResourceManager(), editorUserInterface.getEngine().getLoader().getLoaderDependency(ELoaderDependency.WORKFLOWS_USERS_LIST));
    };
    WorkflowEditUsersListInspectorPlugin.NAME = 'WorkflowEditUsersListInspectorPlugin';
    return WorkflowEditUsersListInspectorPlugin;
}());
var DropdownsEditFormsListInspectorPlugin = (function () {
    function DropdownsEditFormsListInspectorPlugin() {
        this.groups = null;
        this.modalIsLoading = false;
    }
    DropdownsEditFormsListInspectorPlugin.prototype.getName = function () {
        return DropdownsEditFormsListInspectorPlugin.NAME;
    };
    DropdownsEditFormsListInspectorPlugin.prototype.upgrade = function ($, domNode, editorUserInterface) {
        (function (self) {
            $(domNode).find('[data-property-name="choices-isDropdownWithForms"]').each(function () {
                $(this)
                    .on("click", '[data-role=edit-dropdowns-forms]', function (e) {
                    e.preventDefault();
                    if (!self.modalIsLoading) {
                        self.changeShowModalStatus();
                        var controlHash = $(this).closest('#item[data-role=editor-panel][data-target-element]').attr('data-target-element'), dropdownControl = editorUserInterface.getEngine().getDocument().getElementByHash(controlHash);
                        self.editGroupsList(dropdownControl, $, editorUserInterface);
                    }
                })
                    .on('change', 'input[type=checkbox]', function () {
                    if (this.checked) {
                        $(this).closest('[data-role=attribute-group]').attr('data-hide-choices', '');
                        $('[data-role=edit-dropdowns-forms]').trigger('click');
                    }
                    else {
                        $(this).closest('[data-role=attribute-group]').attr('data-hide-choices', null);
                        var controlHash = $(this).closest('#item[data-role=editor-panel][data-target-element]').attr('data-target-element'), dropdownControl = editorUserInterface.getEngine().getDocument().getElementByHash(controlHash), drowpdownGroupsList = [{ text: 'Please Select' }];
                        dropdownControl
                            .setProperty('choices.isDropdownWithForms', false)
                            .setProperty('choices.values', drowpdownGroupsList)
                            .synchronizeValue();
                        editorUserInterface.getEngine().getLoader().getCommandDispatcher().reloadVisiblePanel();
                    }
                });
                (function (self) {
                    setTimeout(function () {
                        $(self).find('input[type=checkbox]').each(function () {
                            var optionEnabled = this.checked;
                            $(this)
                                .closest('[data-role=attribute-group]')
                                .attr('data-hide-choices', optionEnabled
                                ? ''
                                : null);
                        });
                    }, 50);
                })(this);
            });
        })(this);
    };
    DropdownsEditFormsListInspectorPlugin.prototype.editGroupsList = function (dropdownControl, $, editorUserInterface) {
        (function (self, ui, resourceManager) {
            self.loadGroups($, editorUserInterface).then(function (groups) {
                self.includeDependency();
                var dialog = ui.createDialog('Import forms', [
                    {
                        type: EDialogButtonType.SAVE,
                        callback: function () {
                            var newDropdownChoices = [], selectedOptions = $('#hiltiSelectGroups').val();
                            for (var i = 0, len = selectedOptions.length || 0; i < len; i++) {
                                newDropdownChoices.push({
                                    text: selectedOptions[i],
                                });
                            }
                            dropdownControl.setProperty('choices.values', newDropdownChoices);
                            dialog.close();
                        },
                    },
                    {
                        type: EDialogButtonType.CANCEL,
                        callback: function () {
                            dialog.close();
                        }
                    }
                ], {
                    width: "500px",
                    height: "250px",
                });
                dialog.dialog.setAttribute('data-dialog-role', 'dropdown-forms-list-dialog');
                resourceManager
                    .get('/modules/Typescript/Form/resources/editor/Dropdown/dropdown-forms-list-dialog.html')
                    .then(function (templateMarkup) {
                    var template = new Salvage(templateMarkup), dropdownChoices = dropdownControl.getProperty('choices.values') || [], selectedOptionsCount = 0, model = {
                        groups: (function (allGroups) {
                            var result = [], isSelected;
                            for (var i = 0, len = allGroups.length; i < len; i++) {
                                isSelected = false;
                                for (var j = 0, n = dropdownChoices.length; j < n; j++) {
                                    if (allGroups[i].id === ~~dropdownChoices[j].text || null) {
                                        isSelected = true;
                                        selectedOptionsCount++;
                                        break;
                                    }
                                }
                                result.push({
                                    id: allGroups[i].id,
                                    name: allGroups[i].name,
                                    level: allGroups[i].level,
                                    selected: isSelected
                                });
                            }
                            return result;
                        })(FormUtils.clone(groups)),
                        hideClearAll: selectedOptionsCount >= 2 ? false : true
                    };
                    dialog.body.innerHTML = template.parse(model);
                    self.initiateSelect2DropdownAndDependency($);
                    self.changeShowModalStatus();
                })
                    .fail(function (e) {
                    ui.alert('Error loading component', 'There was a network error obtaining the dialog contents. Please retry. If the problem persists, contact support', function () {
                        dialog.close();
                    });
                });
            }).fail(function (err) {
                ui.alert('Error loading groups', 'There was a network error obtaining groups. Please retry. If the problem persists, contact support');
            });
        })(this, editorUserInterface.getEngine().getLoader().getUI(), editorUserInterface.getEngine().getResourceManager());
    };
    DropdownsEditFormsListInspectorPlugin.prototype.loadGroups = function ($, editorUserInterface) {
        return (function (self) {
            return $.Deferred(function (defer) {
                if (self.groups !== null) {
                    defer.resolve(self.groups);
                }
                else {
                    $.ajax({
                        type: "GET",
                        url: "/modules/CustomScripts/classes/Hilti/DropdownForms/ajaxCall.php",
                        data: {
                            do: 'getGroups'
                        },
                        contentType: "application/json",
                        success: function (groups) {
                            self.groups = groups;
                            defer.resolve(self.groups);
                        },
                        error: function () {
                            defer.reject();
                        }
                    });
                }
            }).promise();
        })(this);
    };
    DropdownsEditFormsListInspectorPlugin.prototype.includeDependency = function () {
        var cssId = 'select2';
        if (!document.getElementById(cssId)) {
            var head = document.getElementsByTagName('head')[0], link = document.createElement('link');
            link.id = cssId;
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = '/libraries/select2/select2-ver-2-4.0.3/css/select2.min.css';
            head.appendChild(link);
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = '/libraries/select2/select2-ver-2-4.0.3/js/select2.full.js';
            head.appendChild(script);
        }
    };
    DropdownsEditFormsListInspectorPlugin.prototype.initiateSelect2DropdownAndDependency = function ($) {
        setTimeout(function () {
            $('#hiltiSelectGroups').select2({
                width: '100%',
                multiple: true,
                placeholder: '*Please Select*',
                templateResult: function (item) {
                    if (typeof item.id != 'undefined') {
                        var id = item.id, optionElement = $('#hiltiSelectGroups option[value="' + id + '"]');
                        if (typeof optionElement.attr('data-type') != 'undefined') {
                            if (optionElement.attr('data-type') == 'group') {
                                var selectedElement = $(item.element).find('option').length - $(item.element).find('option:selected').length, level = optionElement.attr('data-level'), groupElement = $('<span class="i123-folder icon space-' + level + (selectedElement ? '' : ' group_selected') + '"></span> <span class="text">'
                                    + item.text + '</span>');
                                return groupElement;
                            }
                        }
                    }
                }
            });
        }, 100);
        $(document).off('change', '#hiltiSelectGroups').on('change', '#hiltiSelectGroups', function () {
            var groups = $('#hiltiSelectGroups').val(), clearAllElement = $('#hiltiClearAllButton');
            if (groups !== null) {
                if (groups.length > 1 && clearAllElement.hasClass('hidden')) {
                    clearAllElement.removeClass('hidden');
                }
                else if (groups.length <= 1 && !clearAllElement.hasClass('hidden')) {
                    clearAllElement.addClass('hidden');
                }
            }
            else if (!clearAllElement.hasClass('hidden')) {
                clearAllElement.addClass('hidden');
            }
        });
        $(document).off('click', '#hiltiClearAllButton').on('click', '#hiltiClearAllButton', function () {
            $('#hiltiSelectGroups').val(null).trigger('change');
            $(this).addClass('hidden');
        });
    };
    DropdownsEditFormsListInspectorPlugin.prototype.changeShowModalStatus = function () {
        if (this.modalIsLoading) {
            this.modalIsLoading = true;
        }
        else {
            this.modalIsLoading = false;
        }
    };
    DropdownsEditFormsListInspectorPlugin.NAME = 'DropdownsEditFormsListInspectorPlugin';
    return DropdownsEditFormsListInspectorPlugin;
}());
var PriceEditorInspectorPlugin = (function () {
    function PriceEditorInspectorPlugin() {
    }
    PriceEditorInspectorPlugin.prototype.getName = function () {
        return PriceEditorInspectorPlugin.NAME;
    };
    PriceEditorInspectorPlugin.prototype.upgrade = function ($, formContainer, editorUserInterface) {
        var _this = this;
        this.formContainer = formContainer;
        this.editorUserInterface = editorUserInterface;
        this.jq = $;
        this.init();
        $(this.formContainer)
            .find('a[data-plugin=currency-editor]')
            .each(function (index, link) {
            _this.setCurrency(link);
            link.onclick = function () {
                _this.triggerCurrencyDialog(link, formContainer);
            };
        });
        this.updatePriceFee();
        this.updateCurrencySymbol();
    };
    PriceEditorInspectorPlugin.prototype.init = function () {
        this.settings = this.editorUserInterface.getEngine().getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING);
        this.currencyService = this.editorUserInterface.getEngine().getCurrency();
        var currencyId = this.settings.getProperty('currencyId') || this.DEFAULT_CURRENCY_ID;
        this.currency = this.currencyService.getCurrencyById(currencyId);
        this.i18n = this.editorUserInterface.getEngine().getLoader().getI18n();
    };
    PriceEditorInspectorPlugin.prototype.updateCurrencySymbol = function () {
        var numberInputRegExp = /[^0-9.]/g, basePriceElements = document.querySelectorAll('#item .fee-base-price-container > input'), currencyId = this.settings.getProperty('currencyId') || this.DEFAULT_CURRENCY_ID, currencySymbol = this.currencyService.getCurrencySymbolById(currencyId);
        if (!basePriceElements)
            return;
        basePriceElements.forEach(function (element) {
            setTimeout(function () {
                element.value = element.value.replace(numberInputRegExp, '');
                element.value = currencySymbol + element.value;
            }, 1);
            element.addEventListener('keypress', function (e) {
                e.key.match(numberInputRegExp) && e.preventDefault();
            });
            element.addEventListener('focusin', function () {
                element.value = element.value.replace(numberInputRegExp, '');
            });
            element.addEventListener('focusout', function () {
                element.value = element.value.replace(numberInputRegExp, '');
                element.value = currencySymbol + element.value;
            });
        });
    };
    PriceEditorInspectorPlugin.prototype.setCurrency = function (element) {
        element.innerText = this.currency ? this.currency.isoCode : this.i18n.translateText('payment_currency_unknown');
    };
    PriceEditorInspectorPlugin.prototype.saveCurrency = function (newCurrencyId) {
        this.settings.setProperty('currencyId', newCurrencyId);
    };
    PriceEditorInspectorPlugin.prototype.updatePriceFee = function () {
        var _this = this;
        var feeControls = document.querySelectorAll('#form [data-role=control][data-type=fee]');
        if (!feeControls)
            return;
        feeControls.forEach(function (control) {
            var controlHash = control.getAttribute('data-hash'), feeControl = _this.editorUserInterface.getEngine().getDocument().getElementByHash(controlHash);
            feeControl.updatePriceFee();
        });
    };
    PriceEditorInspectorPlugin.prototype.updateDiscountAndTax = function (formContainer) {
        this.editorUserInterface.upgrade(formContainer, [DiscountAndTaxOnTotalInspectorPlugin.NAME]);
    };
    PriceEditorInspectorPlugin.prototype.triggerCurrencyDialog = function (element, formContainer) {
        var _this = this;
        var selectedCurrency;
        var currencyList = this.editorUserInterface.getEngine().getCurrency().enumerateCurrencies();
        var dropdownOptions = currencyList.map(function (currency) {
            return {
                id: currency.id,
                label: _this.i18n.translateText(currency.i18n)
            };
        });
        dropdownOptions = _.orderBy(dropdownOptions, ['label'], ['asc']);
        var dialog = this.editorUserInterface.createDialog(this.i18n.translateText('payments_form_currency') || PaymentsProductsDialog.CURRENCY_DIALOG_TITLE, [
            {
                type: EDialogButtonType.SAVE,
                callback: function () {
                    if (!selectedCurrency)
                        selectedCurrency = searchableDropdown.getSelectedOption();
                    _this.currency = _this.currencyService.getCurrencyById(selectedCurrency.id);
                    _this.setCurrency(element);
                    _this.saveCurrency(selectedCurrency.id);
                    _this.updatePriceFee();
                    _this.updateCurrencySymbol();
                    _this.updateDiscountAndTax(formContainer);
                    _this.editorUserInterface.getEngine().getLoader().execCommand('track-event', 'payments_currency_change');
                    _this.editorUserInterface.getEngine().getLoader().trigger('payments_currency_change', selectedCurrency);
                    dialog.close();
                }
            },
            {
                type: EDialogButtonType.CANCEL,
                callback: function () {
                    dialog.close();
                }
            }
        ], {
            width: "500px",
            height: "270px",
        });
        dialog.dialog.classList.add('currency-dialog');
        var description = document.createElement('p');
        description.textContent = this.i18n.translateText('payments_currency_dialog_description');
        dialog.body.appendChild(description);
        var searchableDropdownConfig = {
            placeholder: ''
        };
        if (this.currency) {
            searchableDropdownConfig.selected = this.currency.id;
        }
        var searchableDropdown = new VirtualSelect(this.jq).init(dialog.body, dropdownOptions, searchableDropdownConfig);
        searchableDropdown.on('change', function () {
            selectedCurrency = searchableDropdown.getSelectedOption();
        });
    };
    PriceEditorInspectorPlugin.NAME = 'PriceEditorInspectorPlugin';
    return PriceEditorInspectorPlugin;
}());
var DiscountAndTaxOnTotalInspectorPlugin = (function () {
    function DiscountAndTaxOnTotalInspectorPlugin() {
        var _this = this;
        this.unitType = [
            {
                unitTypeIndex: EPaymentsUnitTypes.PERCENTAGE,
                unitTypeName: 'percentage',
                unitTypeSymbol: '%'
            },
            {
                unitTypeIndex: EPaymentsUnitTypes.FIXED_VALUE,
                unitTypeName: 'fixed_value',
                unitTypeSymbol: '$'
            }
        ];
        this.clickHandler = function (event) {
            var $elem = $(event.target);
            var $discountParents = $elem.parents('[data-role="control-discount"]');
            var $taxParents = $elem.parents('[data-role="control-tax"]');
            if ($discountParents.length === 0) {
                _this.removeClickedState(_this.discountContainer.find('[data-role="control-discount"][data-has-click]').get(0));
                _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="discountOnTotal"] span.property-label'), false);
            }
            if ($taxParents.length === 0) {
                _this.removeClickedState(_this.taxContainer.find('[data-role="control-tax"][data-has-click]').get(0));
                _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="taxOnTotal"] span.property-label'), false);
            }
        };
    }
    DiscountAndTaxOnTotalInspectorPlugin.prototype.getName = function () {
        return DiscountAndTaxOnTotalInspectorPlugin.NAME;
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        this.parentContainer = $(container);
        this.discountContainer = this.parentContainer.find('[data-plugin="discount-on-total"]');
        this.taxContainer = this.parentContainer.find('[data-plugin="tax-on-total"]');
        this.upgradeDiscountContainer(editorUserInterface);
        this.upgradeTaxContainer(editorUserInterface);
        if (this.discountContainer.length || this.taxContainer.length) {
            this.parentContainer.off('click', this.clickHandler);
            this.parentContainer.on('click', this.clickHandler);
        }
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.upgradeDiscountContainer = function (editorUserInterface) {
        var _this = this;
        var engine = editorUserInterface.getEngine();
        var resourceManager = engine.getResourceManager();
        var paymentSettings = engine.getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING);
        var summarySettings = engine.getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
        var currencyId = paymentSettings.getProperty('currencyId') || PaymentsProductsDialog.DEFAULT_CURRENCY_ID;
        var currencySymbol = engine.getCurrency().getCurrencySymbolById(currencyId);
        if (this.discountContainer.length) {
            var discountValue_1 = this.generateGenericPriceFormatFromInputValue(paymentSettings.getProperty('discountValue'));
            this.unitType[EPaymentsUnitTypes.FIXED_VALUE].unitTypeSymbol = currencySymbol;
            var model_3 = {
                currencySymbol: currencySymbol,
                onTotalDiscountValue: discountValue_1,
                onTotalDiscountUnitType: paymentSettings.getProperty('discountType') || 0,
                unitType: this.unitType,
            };
            $.when(resourceManager.get('/modules/Typescript/Form/resources/editor/SummarySetting/discount-on-total.html'))
                .done(function (markup) {
                summarySettings.setProperty('discountOnTotal', parseFloat(discountValue_1));
                var template = new Salvage(markup);
                _this.discountContainer.get(0).innerHTML = '';
                _this.discountContainer.get(0).insertAdjacentHTML('afterbegin', template.parse(model_3));
                editorUserInterface.upgrade(_this.discountContainer.get(0), [TextAppearanceDropDownInspectorPlugin.NAME]);
                _this.discountContainer.mouseenter(function (event) {
                    _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="discountOnTotal"] span.property-label'), true);
                });
                _this.discountContainer.mouseleave(function (event) {
                    _this.discountContainer.find('[data-role="text-dropdown-overlay"] > [data-is-selected]').trigger('click');
                    if (_this.discountContainer.find('[data-role="control-discount"][data-has-click]').length == 0) {
                        _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="discountOnTotal"] span.property-label'), false);
                    }
                });
                _this.discountContainer.off('click', '[data-role="control-discount"]');
                _this.discountContainer.on('click', '[data-role="control-discount"]', function (event) {
                    _this.addClickedState(event.currentTarget);
                    _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="discountOnTotal"] span.property-label'), true);
                    _this.discountContainer.find('input:not([type="hidden"])').focus();
                });
                _this.discountContainer.find('[data-role="text-dropdown"]').each(function (index, elem) {
                    elem.addEventListener('click', function (event) {
                        var $option = $(event.target);
                        if ($option.attr('data-value')) {
                            var $input = _this.discountContainer.find('input:not([type="hidden"])');
                            var optionValue = parseInt(JSON.parse($option.attr('data-value')));
                            var inputValue_1 = _this.generateGenericPriceFormatFromInputValue($input.val(), optionValue === 0);
                            var title = '- ';
                            engine.getLoader().execCommand('track-event', 'payments_products_discount_total_type_change');
                            title += _this.generateDiscountAndTaxValue(inputValue_1, optionValue, model_3.currencySymbol);
                            _this.discountContainer.find('[data-role="control-discount"]').attr('title', title);
                            _this.discountContainer.find('[data-role="control-discount"] span').text(title);
                            _this.discountContainer.find('[data-role="control-discount"] input').each(function (index, elem) {
                                $(elem).val(inputValue_1);
                            });
                            paymentSettings.setProperty('discountType', optionValue);
                            paymentSettings.setProperty('discountValue', parseFloat(inputValue_1));
                            engine.getLoader().trigger('products_discount_tax_change');
                            _this.removeClickedState(_this.discountContainer.find('[data-role="control-discount"][data-has-click]').get(0));
                            _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="discountOnTotal"] span.property-label'), false);
                            event.preventDefault();
                        }
                    });
                });
                _this.discountContainer.off('change', 'input:not([type="hidden"])');
                _this.discountContainer.on('change', 'input:not([type="hidden"])', function (event) {
                    engine.getLoader().execCommand('track-event', 'payments_products_discount_total_value_change');
                    var $input = $(event.currentTarget);
                    var enforceMaxValue = false;
                    var inputValue = $input.val();
                    var title = '- ';
                    if (model_3.onTotalDiscountUnitType === 0) {
                        enforceMaxValue = true;
                    }
                    inputValue = _this.generateGenericPriceFormatFromInputValue(inputValue, enforceMaxValue);
                    title += _this.generateDiscountAndTaxValue(inputValue, model_3.onTotalDiscountUnitType, model_3.currencySymbol);
                    _this.discountContainer.find('[data-role="control-discount"]').attr('title', title);
                    _this.discountContainer.find('[data-role="control-discount"] span').text(title);
                    _this.discountContainer.find('[data-role="control-discount"] input').each(function (index, elem) {
                        $(elem).val(inputValue);
                    });
                    paymentSettings.setProperty('discountValue', parseFloat(inputValue));
                    engine.getLoader().trigger('products_discount_tax_change');
                });
            })
                .fail(function (e) {
                console.warn('Failed to open template for discount on total. Error is displayed below.');
                console.error(e);
            });
        }
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.upgradeTaxContainer = function (editorUserInterface) {
        var _this = this;
        var engine = editorUserInterface.getEngine();
        var resourceManager = engine.getResourceManager();
        var paymentSettings = engine.getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING);
        var summarySettings = engine.getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
        var currencyId = paymentSettings.getProperty('currencyId') || PaymentsProductsDialog.DEFAULT_CURRENCY_ID;
        var currencySymbol = engine.getCurrency().getCurrencySymbolById(currencyId);
        if (this.taxContainer.length) {
            var taxValue_1 = this.generateGenericPriceFormatFromInputValue(paymentSettings.getProperty('taxValue'));
            this.unitType[EPaymentsUnitTypes.FIXED_VALUE].unitTypeSymbol = currencySymbol;
            var model_4 = {
                currencySymbol: currencySymbol,
                onTotalTaxValue: taxValue_1,
                onTotalTaxUnitType: paymentSettings.getProperty('taxType') || 0,
                unitType: this.unitType,
            };
            $.when(resourceManager.get('/modules/Typescript/Form/resources/editor/SummarySetting/tax-on-total.html'))
                .done(function (markup) {
                summarySettings.setProperty('taxOnTotal', parseFloat(taxValue_1));
                var template = new Salvage(markup);
                _this.taxContainer.get(0).innerHTML = '';
                _this.taxContainer.get(0).insertAdjacentHTML('afterbegin', template.parse(model_4));
                editorUserInterface.upgrade(_this.taxContainer.get(0), [TextAppearanceDropDownInspectorPlugin.NAME]);
                _this.taxContainer.mouseenter(function (event) {
                    _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="taxOnTotal"] span.property-label'), true);
                });
                _this.taxContainer.mouseleave(function (event) {
                    _this.taxContainer.find('[data-role="text-dropdown-overlay"] > [data-is-selected]').trigger('click');
                    if (_this.taxContainer.find('[data-role="control-tax"][data-has-click]').length == 0) {
                        _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="taxOnTotal"] span.property-label'), false);
                    }
                });
                _this.taxContainer.off('click', '[data-role="control-tax"]');
                _this.taxContainer.on('click', '[data-role="control-tax"]', function (event) {
                    _this.addClickedState(event.currentTarget);
                    _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="discountOnTotal"] span.property-label'), true);
                    _this.taxContainer.find('input:not([type="hidden"])').focus();
                });
                _this.taxContainer.find('[data-role="text-dropdown"]').each(function (index, elem) {
                    elem.addEventListener('click', function (event) {
                        var $option = $(event.target);
                        if ($option.attr('data-value')) {
                            var $input = _this.taxContainer.find('input:not([type="hidden"])');
                            var optionValue = parseInt(JSON.parse($option.attr('data-value')));
                            var inputValue_2 = _this.generateGenericPriceFormatFromInputValue($input.val(), optionValue === 0);
                            var title = '+ ';
                            engine.getLoader().execCommand('track-event', 'payments_products_tax_total_type_change');
                            title += _this.generateDiscountAndTaxValue(inputValue_2, optionValue, model_4.currencySymbol);
                            _this.taxContainer.find('[data-role="control-tax"]').attr('title', title);
                            _this.taxContainer.find('[data-role="control-tax"] span').text(title);
                            _this.taxContainer.find('[data-role="control-tax"] input').each(function (index, elem) {
                                $(elem).val(inputValue_2);
                            });
                            paymentSettings.setProperty('taxType', optionValue);
                            paymentSettings.setProperty('taxValue', parseFloat(inputValue_2));
                            engine.getLoader().trigger('products_discount_tax_change');
                            _this.removeClickedState(_this.taxContainer.find('[data-role="control-tax"][data-has-click]').get(0));
                            _this.setShrunkPropertyOnLabel(_this.parentContainer.find('[data-property-name="taxOnTotal"] span.property-label'), false);
                            event.preventDefault();
                        }
                    });
                });
                _this.taxContainer.off('change', 'input:not([type="hidden"])');
                _this.taxContainer.on('change', 'input:not([type="hidden"])', function (event) {
                    engine.getLoader().execCommand('track-event', 'payments_products_tax_total_value_change');
                    var $input = $(event.currentTarget);
                    var enforceMaxValue = false;
                    var inputValue = $input.val();
                    var title = '+ ';
                    if (model_4.onTotalTaxUnitType === 0) {
                        enforceMaxValue = true;
                    }
                    inputValue = _this.generateGenericPriceFormatFromInputValue(inputValue, enforceMaxValue);
                    title += _this.generateDiscountAndTaxValue(inputValue, model_4.onTotalTaxUnitType, model_4.currencySymbol);
                    _this.taxContainer.find('[data-role="control-tax"]').attr('title', title);
                    _this.taxContainer.find('[data-role="control-tax"] span').text(title);
                    _this.taxContainer.find('[data-role="control-tax"] input').each(function (index, elem) {
                        $(elem).val(inputValue);
                    });
                    paymentSettings.setProperty('taxValue', parseFloat(inputValue));
                    engine.getLoader().trigger('products_discount_tax_change');
                });
            })
                .fail(function (e) {
                console.warn('Failed to open template for tax on total. Error is displayed below.');
                console.error(e);
            });
        }
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.addClickedState = function (element) {
        element.setAttribute('data-has-click', '');
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.removeClickedState = function (containerElement) {
        if (containerElement) {
            $(containerElement).each(function (index, element) {
                element.removeAttribute('data-has-click');
            });
        }
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.setShrunkPropertyOnLabel = function (label, isShrunk) {
        if (isShrunk) {
            label.addClass('shrunk');
        }
        else {
            label.removeClass('shrunk');
        }
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.generateGenericPriceFormatFromInputValue = function (value, enforceMax100Value) {
        enforceMax100Value = (undefined !== enforceMax100Value) ? enforceMax100Value : false;
        value = value || '0';
        if (parseFloat(value) < 0) {
            value = '0';
        }
        if (parseFloat(value) > 100 && true === enforceMax100Value) {
            value = '100';
        }
        return (Math.round(parseFloat(value || '0') * 100) / 100).toFixed(2);
    };
    DiscountAndTaxOnTotalInspectorPlugin.prototype.generateDiscountAndTaxValue = function (inputValue, unitType, currencySymbol) {
        var result = inputValue + this.unitType[EPaymentsUnitTypes.PERCENTAGE].unitTypeSymbol;
        if (unitType === 1) {
            result = currencySymbol + inputValue;
        }
        return result;
    };
    DiscountAndTaxOnTotalInspectorPlugin.NAME = 'DiscountAndTaxOnTotalInspectorPlugin';
    return DiscountAndTaxOnTotalInspectorPlugin;
}());
var ListEditorPlugin = (function () {
    function ListEditorPlugin() {
    }
    ListEditorPlugin.prototype.getName = function () {
        return ListEditorPlugin.NAME;
    };
    ListEditorPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        var _this = this;
        this.engine = editorUserInterface.getEngine();
        this.translator = this.engine.getI18n();
        $(container).find('div[data-plugin=list-editor]').each(function (index, div) {
            _this.targetContainer = div;
            var valueAsString = div.getAttribute('data-value');
            _this.targetContainer.onclick = function (event) { return event.preventDefault(); };
            if (valueAsString) {
                _this.values = JSON.parse(valueAsString) || [];
            }
            _.forEach(_this.values, function (value) {
                _this.createListElement(value);
            });
        });
    };
    ListEditorPlugin.prototype.createListElement = function (value) {
        var listElement = document.createElement('div'), input = this.createInput(value);
        listElement.classList.add('list-element');
        listElement.setAttribute('data-name', value.name);
        listElement.appendChild(input);
        if (value.isHideable && value.showFlag) {
            var visibilityButton = this.createVisibilityButton(this.engine.getLoader().getSummarySettingProperty(value.showFlag));
            listElement.appendChild(visibilityButton);
        }
        this.targetContainer.appendChild(listElement);
    };
    ListEditorPlugin.prototype.createInput = function (value) {
        var _this = this;
        var input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('data-role', 'secondary');
        if (value.label) {
            input.value = value.label;
        }
        else if (value.i18n) {
            input.value = this.translator.translateText(value.i18n);
        }
        input.oninput = function () {
            _.forEach(_this.values, function (val) {
                if (val.name === value.name) {
                    val.label = input.value;
                }
            });
            _this.updateListElements();
        };
        input.onblur = function () {
            if (input.value === '') {
                input.value = _this.translator.translateText(value.i18n);
            }
        };
        return input;
    };
    ListEditorPlugin.prototype.createVisibilityButton = function (isVisible) {
        var _this = this;
        var visibilityButton = document.createElement('button');
        visibilityButton.classList.add('visibility-button', 'i-lg', 'i123-hidden');
        this.setVisibilityButtonState(visibilityButton, isVisible);
        visibilityButton.onclick = function () {
            var isVisible = visibilityButton.getAttribute('data-column-is-visible') === 'true';
            _this.setVisibilityButtonState(visibilityButton, !isVisible);
        };
        return visibilityButton;
    };
    ListEditorPlugin.prototype.setVisibilityButtonState = function (button, isVisible) {
        button.setAttribute('data-column-is-visible', isVisible.toString());
        if (isVisible) {
            button.title = this.getTooltipMessage(EVisibilityMode.SHOW);
        }
        else {
            button.title = this.getTooltipMessage(EVisibilityMode.HIDE);
        }
    };
    ListEditorPlugin.prototype.getTooltipMessage = function (visibilityMode) {
        switch (visibilityMode) {
            case EVisibilityMode.HIDE:
                return this.translator.translateText('payments_show_column');
            case EVisibilityMode.SHOW:
                return this.translator.translateText('payments_hide_column');
        }
    };
    ListEditorPlugin.prototype.updateListElements = function () {
        var newValue = this.values.length
            ? JSON.stringify(this.values)
            : 'null';
        this.targetContainer.setAttribute('data-value', newValue);
    };
    ListEditorPlugin.NAME = 'ListEditorInspectorPlugin';
    return ListEditorPlugin;
}());
var PaymentsStringReadOnlyPlugin = (function () {
    function PaymentsStringReadOnlyPlugin() {
    }
    PaymentsStringReadOnlyPlugin.prototype.getName = function () {
        return PaymentsStringReadOnlyPlugin.NAME;
    };
    PaymentsStringReadOnlyPlugin.prototype.upgrade = function ($, container, editorUserInterface) {
        editorUserInterface.getEngine().getLoader().updateStripeConnectedAccountPlaceholder();
    };
    PaymentsStringReadOnlyPlugin.NAME = 'ListEditorInspectorPlugin';
    return PaymentsStringReadOnlyPlugin;
}());
var GlobalEventHandler = (function () {
    function GlobalEventHandler(engine, document) {
        this.engine = engine;
        this.document = document;
    }
    GlobalEventHandler.prototype.dispatch = function (element, propertyFQN, newValue, oldValue) {
        var isHookRunnable;
        for (var i = 0, len = GlobalEventHandler.hooks.length; i < len; i++) {
            isHookRunnable = true;
            if (null !== GlobalEventHandler.hooks[i].elementTypeId) {
                if ('number' === typeof GlobalEventHandler.hooks[i].elementTypeId) {
                    if (GlobalEventHandler.hooks[i].elementTypeId !== element.getTypeId()) {
                        isHookRunnable = false;
                    }
                }
                else {
                    if (GlobalEventHandler.hooks[i].elementTypeId instanceof Array) {
                        if (GlobalEventHandler.hooks[i].elementTypeId['indexOf'](element.getTypeId()) === -1) {
                            isHookRunnable = false;
                        }
                    }
                    else {
                        isHookRunnable = false;
                    }
                }
            }
            if (isHookRunnable && null !== GlobalEventHandler.hooks[i].propertySelector) {
                if ('string' === typeof GlobalEventHandler.hooks[i].propertySelector) {
                    if (propertyFQN !== GlobalEventHandler.hooks[i].propertySelector) {
                        isHookRunnable = false;
                    }
                }
                else {
                    if (GlobalEventHandler.hooks[i].propertySelector instanceof RegExp) {
                        if (!GlobalEventHandler.hooks[i].propertySelector['test'](propertyFQN)) {
                            isHookRunnable = false;
                        }
                    }
                    else {
                        isHookRunnable = false;
                    }
                }
            }
            if (isHookRunnable) {
                GlobalEventHandler.hooks[i].callback(this.engine, this.document, element, propertyFQN, newValue, oldValue);
            }
        }
    };
    GlobalEventHandler.addPropertyChangeEventListener = function (elementTypeId, propertyName, callbackFunction) {
        if (null !== elementTypeId && typeof elementTypeId !== 'number') {
            if (elementTypeId instanceof Array) {
                if (!elementTypeId.length) {
                    throw new Error('Invalid argument: elementTypeId is array, but has no elements (GlobalEventHandler.addPropertyChangeEventListener)');
                }
                for (var i = 0, len = elementTypeId.length; i < len; i++) {
                    if ('number' != typeof elementTypeId[i]) {
                        throw new Error('Invalid argument elementTypeId: null|number|number[] expected!');
                    }
                }
            }
            else {
                throw new Error('Invalid argument elementTypeId: null|number|number[] expected!');
            }
        }
        if (null !== propertyName && !(propertyName && (typeof propertyName === 'string' || propertyName instanceof RegExp))) {
            throw new Error('Invalid argument: propertyName: expected null|string|RegExp');
        }
        if (!callbackFunction || !(callbackFunction instanceof Function)) {
            throw new Error('Invalid argument: callbackFunction: expected <IGlobalEventHandlerCallback>Function');
        }
        GlobalEventHandler.hooks.push({
            elementTypeId: elementTypeId,
            propertySelector: propertyName,
            callback: callbackFunction
        });
    };
    GlobalEventHandler.hooks = [];
    return GlobalEventHandler;
}());
var EditorValueRendererFactory = (function (_super) {
    __extends(EditorValueRendererFactory, _super);
    function EditorValueRendererFactory(resourceManager, jq, geolocation, currency, document) {
        var _this = _super.call(this) || this;
        _this.renderers = [];
        _this.modelProviders = [];
        _this.responses = [];
        _this.pendingResponses = 0;
        _this.deferredDOMInsertionUIElements = [];
        _this.insertionId = 0;
        _this.resourceManager = resourceManager;
        _this.jq = jq;
        _this.rendererId = 0;
        _this.geolocation = geolocation;
        _this.currency = currency;
        _this.document = document;
        _this.htmlEscaper = window.document.createElement('div');
        (function (self) {
            Salvage.addHelper({
                name: "EDITOR_VALUE_RENDERER",
                func: function (dataType) {
                    return self.getRenderer(dataType);
                }
            });
        })(_this);
        return _this;
    }
    EditorValueRendererFactory.prototype.getDocument = function () {
        return this.document;
    };
    EditorValueRendererFactory.prototype.escapeHTML = function (unescapedString) {
        this.htmlEscaper.textContent = String(unescapedString || '');
        var result = this.htmlEscaper.innerHTML;
        this.htmlEscaper.textContent = '';
        return result;
    };
    EditorValueRendererFactory.prototype.withElement = function (element) {
        this.element = element;
        return this;
    };
    EditorValueRendererFactory.prototype.getRendererPriority = function (renderer) {
        var points = 0;
        if (null !== renderer.elementTypeId) {
            if (Array.isArray(renderer.elementTypeId)) {
                points += 5;
            }
            else {
                if (['number', 'string'].indexOf(typeof renderer.elementTypeId) > -1) {
                    points += 50;
                }
                else {
                    throw new Error('Invalid argument: elementTypeId: int|int[]|null expected!');
                }
            }
        }
        if (null !== renderer.propertyName) {
            switch (true) {
                case 'string' === typeof renderer.propertyName:
                    points += 50;
                    break;
                case renderer.propertyName instanceof Array:
                    points += 25;
                    break;
                case renderer.propertyName instanceof RegExp:
                    points += 20;
                    break;
                default:
                    throw new Error('Invalid argument: propertyName: string|string[]|RegExp|null expected!');
            }
        }
        return points;
    };
    EditorValueRendererFactory.prototype.isUIElementURI = function (uri) {
        return /^ui\:\/\/(.*)$/.test(String(uri || ''));
    };
    EditorValueRendererFactory.prototype.registerRenderer = function (runtimeValueType, propertyName, elementTypeId, fromTemplatePathOrUIElementURI, usingTemplateModelDefalts, priority) {
        var item = {
            elementTypeId: elementTypeId,
            propertyName: propertyName,
            runtimeValueType: runtimeValueType,
            template: null,
            priority: 0,
            id: this.rendererId,
            templateModelDefaultValues: usingTemplateModelDefalts || null,
        };
        this.responses.push('');
        this.pendingResponses++;
        (function (item, self) {
            if (!self.isUIElementURI(fromTemplatePathOrUIElementURI)) {
                item.template = self.resourceManager.get(fromTemplatePathOrUIElementURI)
                    .then(function (templateText) {
                    self.responses[item.id] = templateText;
                    self.pendingResponses--;
                })
                    .fail(function (e) {
                    self.pendingResponses--;
                    self.responses[item.id] = '<span style="color: red">Error loading control type: ' + item.runtimeValueType + '</span>';
                });
            }
            else {
                item.template = self.jq.Deferred(function (defer) {
                    self.responses[item.id] = fromTemplatePathOrUIElementURI;
                    self.pendingResponses--;
                    defer.resolve();
                }).promise();
            }
        })(item, this);
        this.rendererId++;
        if (undefined === priority) {
            item.priority = this.getRendererPriority(item);
        }
        else {
            item.priority = priority;
        }
        this.renderers.push(item);
        this.renderers.sort(function (a, b) {
            return b.priority - a.priority;
        });
        return this;
    };
    EditorValueRendererFactory.prototype.registerModelProvider = function (runtimeValueType, propertyName, elementTypeId, modelGenerator, priority) {
        var item = {
            elementTypeId: elementTypeId,
            propertyName: propertyName,
            runtimeValueType: runtimeValueType,
            priority: 0,
            generator: modelGenerator
        };
        if (undefined === priority) {
            item.priority = this.getRendererPriority(item);
        }
        else {
            item.priority = priority;
        }
        this.modelProviders.push(item);
        this.modelProviders.sort(function (a, b) {
            return b.priority - a.priority;
        });
        return this;
    };
    EditorValueRendererFactory.prototype.resolve = function () {
        return (function (self, $) {
            return $.Deferred(function (defer) {
                if (self.pendingResponses === 0) {
                    defer.resolve(self);
                }
                else {
                    var wait_1 = function () {
                        if (self.pendingResponses === 0) {
                            defer.resolve(self);
                        }
                        else {
                            setTimeout(function () {
                                wait_1();
                            }, 100);
                        }
                    };
                    wait_1();
                }
            }).promise();
        })(this, this.jq);
    };
    EditorValueRendererFactory.prototype.createUIElementFromURL = function (url, model) {
        var elementName = this.getUIElementName(url), elementParams = this.parseUIURLQueryString(url), result;
        result = UI.createElement(elementName);
        if (null !== elementParams) {
            for (var paramName in elementParams) {
                if (elementParams.hasOwnProperty(paramName)) {
                    result.setAttribute(paramName, JSON.stringify(model[elementParams[paramName]] || null));
                }
            }
        }
        return result;
    };
    EditorValueRendererFactory.prototype.electRenderer = function (elementTypeId, propertyName, runtimePropertyType) {
        var isElected;
        for (var i = 0, len = this.renderers.length; i < len; i++) {
            isElected = true;
            if (null !== this.renderers[i].elementTypeId) {
                switch (true) {
                    case 'number' === typeof this.renderers[i].elementTypeId:
                    case 'string' === typeof this.renderers[i].elementTypeId:
                        if (this.renderers[i].elementTypeId !== elementTypeId) {
                            isElected = false;
                        }
                        break;
                    case this.renderers[i].elementTypeId instanceof Array:
                        if (this.renderers[i].elementTypeId['indexOf'](elementTypeId) === -1) {
                            isElected = false;
                        }
                        break;
                    default:
                        isElected = false;
                        break;
                }
            }
            if (isElected && null !== this.renderers[i].propertyName) {
                switch (true) {
                    case 'string' === typeof this.renderers[i].propertyName:
                        if (this.renderers[i].propertyName !== propertyName) {
                            isElected = false;
                        }
                        break;
                    case this.renderers[i].propertyName instanceof Array:
                        if (this.renderers[i].propertyName['indexOf'](propertyName) === -1) {
                            isElected = false;
                        }
                        break;
                    case this.renderers[i].propertyName instanceof RegExp:
                        if (!this.renderers[i].propertyName['test'](propertyName)) {
                            isElected = false;
                        }
                        break;
                    default:
                        isElected = false;
                        break;
                }
            }
            if (isElected && null !== this.renderers[i].runtimeValueType) {
                if (runtimePropertyType !== this.renderers[i].runtimeValueType) {
                    isElected = false;
                }
            }
            if (isElected) {
                return this.renderers[i];
            }
        }
        return null;
    };
    EditorValueRendererFactory.prototype.electModelProvider = function (elementTypeId, propertyName, runtimePropertyType) {
        var isElected;
        for (var i = 0, len = this.modelProviders.length; i < len; i++) {
            isElected = true;
            if (null !== this.modelProviders[i].elementTypeId) {
                switch (true) {
                    case 'number' === typeof this.modelProviders[i].elementTypeId:
                    case 'string' === typeof this.modelProviders[i].elementTypeId:
                        if (this.modelProviders[i].elementTypeId !== elementTypeId) {
                            isElected = false;
                        }
                        break;
                    case this.modelProviders[i].elementTypeId instanceof Array:
                        if (this.modelProviders[i].elementTypeId['indexOf'](elementTypeId) === -1) {
                            isElected = false;
                        }
                        break;
                    default:
                        isElected = false;
                        break;
                }
            }
            if (isElected && null !== this.modelProviders[i].propertyName) {
                switch (true) {
                    case 'string' === typeof this.modelProviders[i].propertyName:
                        if (this.modelProviders[i].propertyName !== propertyName) {
                            isElected = false;
                        }
                        break;
                    case this.modelProviders[i].propertyName instanceof Array:
                        if (this.modelProviders[i].propertyName['indexOf'](propertyName) === -1) {
                            isElected = false;
                        }
                        break;
                    case this.modelProviders[i].propertyName instanceof RegExp:
                        if (!this.modelProviders[i].propertyName['test'](propertyName)) {
                            isElected = false;
                        }
                        break;
                    default:
                        isElected = false;
                        break;
                }
            }
            if (isElected && null !== this.modelProviders[i].runtimeValueType) {
                if (runtimePropertyType !== this.modelProviders[i].runtimeValueType) {
                    isElected = false;
                }
            }
            if (isElected) {
                return this.modelProviders[i];
            }
        }
        return null;
    };
    EditorValueRendererFactory.prototype.getDecoratedModel = function (defaultModel, elementTypeId, propertyName, runtimePropertyType) {
        var modelProvider = this.electModelProvider(elementTypeId, propertyName, runtimePropertyType), result = {}, generatedResultByModelProvider;
        for (var k in defaultModel) {
            if (defaultModel.hasOwnProperty(k) && defaultModel.propertyIsEnumerable(k)) {
                result[k] = defaultModel[k];
            }
        }
        if (null !== modelProvider) {
            generatedResultByModelProvider = modelProvider.generator(propertyName, runtimePropertyType) || {};
            for (var k in generatedResultByModelProvider) {
                if (result.hasOwnProperty(k) && result.propertyIsEnumerable(k)) {
                    result[k] = generatedResultByModelProvider[k];
                }
            }
        }
        return result;
    };
    EditorValueRendererFactory.prototype.getCompatibleControlsList = function (element) {
        if (!element) {
            return [];
        }
        var result = [];
        for (var i = 0, controls = this.document.getControlsList(), len = controls.length; i < len; i++) {
            if (null === controls[i].getId()) {
                continue;
            }
            if (element.getId() !== controls[i].getId()
                && controls[i].hasProperty('synchronize.enabled')
                && controls[i].hasValueCompatibleWith(element)) {
                result.push({
                    id: controls[i].getId(),
                    label: (controls[i].hasProperty('label.labelText')
                        ? controls[i].getProperty('label.labelText')
                        : 'Control #' + controls[i].getId()) || 'Control #' + controls[i].getId()
                });
            }
        }
        return result.sort(function (a, b) {
            var aLabel = a.label.toLowerCase(), bLabel = b.label.toLowerCase();
            if (aLabel === bLabel) {
                return 0;
            }
            else {
                return aLabel > bLabel
                    ? 1
                    : -1;
            }
        });
    };
    EditorValueRendererFactory.prototype.getRenderer = function (forDataType) {
        var control = JSON.parse(forDataType), elementTypeId = control.element, propertyName = control.property, runtimePropertyType = control.type, propertyValue = control.value;
        var electedControlRenderer = this.electRenderer(elementTypeId, propertyName, runtimePropertyType);
        if (null !== electedControlRenderer) {
            var model = {
                value: propertyValue,
                _geolocation: this.geolocation.getCountriesList(),
                _currency: this.currency.enumerateCurrencies(),
                _webfonts: this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.FONTS_MANAGER).getFontsList()
            };
            if (this.element instanceof FormElement) {
                model._validation = this.element
                    ? this.element._static().getSupportedValidators
                        ? this.element._static().getSupportedValidators()
                        : null
                    : null;
                model._compatibleControlsList = this.getCompatibleControlsList(this.element);
            }
            if (this.element instanceof MapControl) {
                var propagateCompatibleTypes = [
                    ElementTypes.CONTROL_TYPE_TEXT,
                    ElementTypes.CONTROL_TYPE_TEXTAREA,
                ], synchronizeCompatibleTypes = [
                    ElementTypes.CONTROL_TYPE_ADDRESS,
                ];
                model._compatibleControlsList = this.getMapPropagationCompatibleControls(propagateCompatibleTypes);
                model._synchronizeControlsList = this.getMapPropagationCompatibleControls(synchronizeCompatibleTypes);
            }
            if (null !== electedControlRenderer.templateModelDefaultValues) {
                var modelAdditionalProperties = this.getDecoratedModel(electedControlRenderer.templateModelDefaultValues, elementTypeId, propertyName, runtimePropertyType);
                for (var k in modelAdditionalProperties) {
                    if (modelAdditionalProperties.hasOwnProperty(k) && modelAdditionalProperties.propertyIsEnumerable(k)) {
                        model[k] = modelAdditionalProperties[k];
                    }
                }
            }
            if (!this.isUIElementURI(this.responses[electedControlRenderer.id])) {
                var templateString = this.responses[electedControlRenderer.id], template = new Salvage(templateString);
                return template.parse(model);
            }
            else {
                this.insertionId++;
                this.deferredDOMInsertionUIElements.push({
                    insertionId: this.insertionId,
                    element: this.createUIElementFromURL(this.responses[electedControlRenderer.id], model),
                });
                var elem = document.createElement('x-deferred-element');
                elem.setAttribute('data-insertion-id', String(this.insertionId));
                elem.setAttribute('data-property-value', JSON.stringify(propertyValue));
                var result = elem.outerHTML;
                elem = null;
                return result;
            }
        }
        else {
            return '<span style="color: green">' + runtimePropertyType + '</span>';
        }
    };
    EditorValueRendererFactory.prototype.getUIElementName = function (uiElementURI) {
        var matches;
        if (matches = /^ui:\/\/([a-zA-Z0-9_\-]+)(\?|$)/.exec(String(uiElementURI || ''))) {
            return matches[1];
        }
        else {
            return null;
        }
    };
    EditorValueRendererFactory.prototype.parseUIURLQueryString = function (uiElementURI) {
        var matches;
        if (matches = /^ui:\/\/([a-zA-Z0-9_]+)(\?(.*)?)?$/.exec(String(uiElementURI || ''))) {
            var result = {}, queryString = matches[3] || '';
            if (!queryString) {
                return null;
            }
            var queryParams = queryString.split('&'), paramName = void 0, paramValue = void 0;
            for (var i = 0, len = queryParams.length; i < len; i++) {
                matches = /^([^=]+)=(.*)$/.exec(queryParams[i]);
                if (matches) {
                    paramName = matches[1];
                    paramValue = matches[2];
                    result[paramName] = paramValue;
                }
            }
            return result;
        }
        return null;
    };
    EditorValueRendererFactory.prototype.getDeferredUIElementByInsertionId = function (insertionId) {
        for (var i = 0, len = this.deferredDOMInsertionUIElements.length; i < len; i++) {
            if (insertionId === this.deferredDOMInsertionUIElements[i].insertionId) {
                var returnValue = this.deferredDOMInsertionUIElements[i].element;
                this.deferredDOMInsertionUIElements.splice(i, 1);
                return returnValue;
            }
        }
        return null;
    };
    EditorValueRendererFactory.prototype.injectDeferredElements = function (inDOMContainer) {
        (function (self, $) {
            $(inDOMContainer).find('x-deferred-element[data-insertion-id][data-property-value]').each(function () {
                var componentInsertionId = ~~this.getAttribute('data-insertion-id'), element = self.getDeferredUIElementByInsertionId(componentInsertionId), elementValue = JSON.parse(this.getAttribute('data-property-value'));
                if (element) {
                    this.parentNode.insertBefore(element.getRootNode(), this);
                    this.parentNode.removeChild(this);
                    element.setValue(elementValue);
                }
            });
        })(this, this.jq);
    };
    EditorValueRendererFactory.init = function (instance) {
        instance.registerRenderer('string', null, null, '/modules/Typescript/Form/resources/editor/string.html', {
            placeholder: '',
            i18nPlaceholder: '',
        });
        instance.registerRenderer('int', null, null, '/modules/Typescript/Form/resources/editor/number.html', {
            min: '0',
            max: '1000',
            placeholder: '',
            i18nPlaceholder: '',
            inputMin: '',
            inputMax: ''
        });
        instance.registerRenderer('sint', null, null, '/modules/Typescript/Form/resources/editor/number.html', {
            min: '0',
            max: '1000',
            placeholder: '',
            i18nPlaceholder: '',
        });
        instance.registerRenderer('float', null, null, '/modules/Typescript/Form/resources/editor/number.html', {
            min: '0',
            max: '1000',
            placeholder: ''
        });
        instance.registerRenderer('sfloat', null, null, '/modules/Typescript/Form/resources/editor/number.html', {
            min: '0',
            max: '1000',
            placeholder: '',
            i18nPlaceholder: '',
        });
        instance.registerRenderer('number', null, null, '/modules/Typescript/Form/resources/editor/number.html', {
            min: '0',
            max: '1000',
            placeholder: '',
            i18nPlaceholder: '',
        });
        instance.registerRenderer('bool', null, null, '/modules/Typescript/Form/resources/editor/boolean.html', null);
        instance.registerRenderer('boolean', null, null, '/modules/Typescript/Form/resources/editor/boolean.html', {
            title: '',
            i18nTitle: '',
        });
        instance.registerRenderer('int', 'configuration.buttonsPosition', ElementTypes.CONTROL_TYPE_ACTION_BAR, '/modules/Typescript/Form/resources/editor/FormActionBar/configuration_buttonsPosition.html', null);
        instance.registerRenderer('string[]', 'configuration.configurableButtons', ElementTypes.CONTROL_TYPE_ACTION_BAR, '/modules/Typescript/Form/resources/editor/FormActionBar/configuration_configurableButtons.html', null);
        instance.registerRenderer('boolean', 'choices.isWorkflowsUserDropdown', ElementTypes.CONTROL_TYPE_DROPDOWN, '/modules/Typescript/Form/resources/editor/Dropdown/workflows-users-list.html', null);
        instance.registerRenderer('boolean', 'choices.isDropdownWithForms', ElementTypes.CONTROL_TYPE_DROPDOWN, '/modules/Typescript/Form/resources/editor/Dropdown/dowpdowns-forms-list.html', null);
        instance.registerRenderer('int', 'configuration.fontSize', ElementTypes.CONTROL_TYPE_HEADING, '/modules/Typescript/Form/resources/editor/Heading/configuration_fontSize.html', null);
        instance.registerRenderer('string', /^configuration.align(ment)?$/, [ElementTypes.CONTROL_TYPE_IMAGE, ElementTypes.CONTROL_TYPE_SOCIAL], '/modules/Typescript/Form/resources/editor/Image/image-alignment.html', null);
        instance.registerRenderer('string', 'options.choiceTextAlignment', ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, '/modules/Typescript/Form/resources/editor/Image/image-alignment.html', null);
        instance.registerRenderer(null, /^configuration\.(id|size|mimeType)$/, ElementTypes.CONTROL_TYPE_IMAGE, '/modules/Typescript/Form/resources/editor/disabled-property.html', null);
        instance.registerRenderer('string', 'options.intendedCurrencyISOCode', ElementTypes.CONTROL_TYPE_PRICE, '/modules/Typescript/Form/resources/editor/currency-iso-code.html', null);
        instance.registerRenderer('int', 'configuration.weekStart', ElementTypes.CONTROL_TYPE_DATE, '/modules/Typescript/Form/resources/editor/Date/week-start.html', null);
        instance.registerRenderer('string[]', 'configuration.acceptedDaysOfWeekString', ElementTypes.CONTROL_TYPE_DATE, '/modules/Typescript/Form/resources/editor/Date/accepted-days-of-week.html', null);
        instance.registerRenderer('TextChoiceInterface[]', /^choices.(values|scale)$/, [
            ElementTypes.CONTROL_TYPE_CHECKBOX,
            ElementTypes.CONTROL_TYPE_RADIO,
            ElementTypes.CONTROL_TYPE_DROPDOWN,
            ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
        ], '/modules/Typescript/Form/resources/editor/text-choice-interface.html', {
            addButtonText: '',
            addButtonTextI18n: '',
            importButtonText: 'import',
            importButtonTextI18n: 'edt_text_import',
            choicesOptionText: 'Default choice',
            choicesOptionTextI18n: 'edt_text_default_choice',
            dataSets: JSON.stringify([
                EDatasetProviderType.DAYS_OF_WEEK,
                EDatasetProviderType.MONTHS_OF_YEAR,
            ]),
            importDialogTitle: 'Import choices',
            importDialogTitleI18n: 'edt_text_import_choices',
            defaultChoiceInputType: String(EChoiceDefaultOptionInputType.RADIO),
            newChoiceText: 'New Choice',
            newChoiceTextI18n: 'edt_text_new_choice',
            itemType: 'CHOICE',
            setAsDefaultFirstOptionAfterTextDatasetImport: '',
            editingContext: 'DEFAULT_VALUES',
            synchronizeOtherProperties: '#item div[data-role=property][data-property-name=options-configureValues] input[data-plugin=text-choice-interface], ' +
                '#item div[data-role=property][data-property-name=options-quizOptions] input[data-plugin=text-choice-interface], ' +
                '#item div[data-role=property][data-property-name=payments-virtualValue] input[data-plugin=text-choice-interface], ' +
                '#item div[data-role=property][data-property-name=options-quizOptions] input[data-plugin=text-choice-interface-likert]'
        });
        instance.registerModelProvider('TextChoiceInterface[]', 'choices.scale', ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, function () {
            return {
                addButtonText: '',
                addButtonTextI18n: '',
                dataSets: JSON.stringify([
                    EDatasetProviderType.DEGREES_OF_AGREEMENT,
                    EDatasetProviderType.DEGREES_OF_IMPORTANCE,
                    EDatasetProviderType.DEGREES_OF_PROBABILITY,
                    EDatasetProviderType.DEGREES_OF_QUALITY,
                    EDatasetProviderType.DEGREES_OF_SATISFACTION,
                ]),
                importDialogTitle: 'Import scale',
                importDialogTitleI18n: 'edt_text_import_scale',
                defaultChoiceInputType: String(EChoiceDefaultOptionInputType.RADIO),
                newChoiceText: 'New Value',
                newChoiceTextI18n: 'edt_text_new_value',
                choicesOptionText: 'Default value',
                choicesOptionTextI18n: 'edt_text_default_value',
                itemType: 'VALUE',
            };
        });
        instance.registerModelProvider('TextChoiceInterface[]', 'choices.values', ElementTypes.CONTROL_TYPE_RADIO, function () {
            return {
                defaultChoiceInputType: String(EChoiceDefaultOptionInputType.RADIO),
            };
        });
        instance.registerModelProvider('int', 'options.widthInPercents', ElementTypes.ELEMENT_TYPE_FORM, function () {
            return {
                placeholder: '100',
                inputMin: '20',
                inputMax: '100',
                max: '100',
                min: '20',
            };
        });
        instance.registerModelProvider('int', 'options.widthInPixels', ElementTypes.ELEMENT_TYPE_FORM, function () {
            return {
                inputMin: '200',
                inputMax: '1920',
                max: '1920',
                min: '200',
            };
        });
        instance.registerModelProvider('TextChoiceInterface[]', 'choices.values', ElementTypes.CONTROL_TYPE_DROPDOWN, function () {
            return {
                defaultChoiceInputType: String(EChoiceDefaultOptionInputType.RADIO),
                setAsDefaultFirstOptionAfterTextDatasetImport: '1',
            };
        });
        instance.registerRenderer('I18nText[]', /^choices\.statements|configuration.titleChoices$/, [ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, ElementTypes.CONTROL_TYPE_NAME], '/modules/Typescript/Form/resources/editor/LikertWrapper/choice-statements.html', {
            hasImportButton: '1',
            addButtonText: '',
            addButtonTextI18n: '',
            importButtonText: 'import',
            importButtonTextI18n: 'edt_text_import',
            statementsOptionText: 'Statements option...',
            statementsOptionTextI18n: 'edt_text_statement_option',
            dataSets: JSON.stringify([
                EDatasetProviderType.DAYS_OF_WEEK,
                EDatasetProviderType.MONTHS_OF_YEAR
            ]),
            importDialogTitle: 'Import statements',
            importDialogTitleI18n: 'edt_text_import_statements',
            newStatementText: 'New Statement',
            newStatementTextI18n: 'edt_text_new_statement',
            statementTypeName: 'STATEMENT',
            statementTypeNameI18n: 'edt_text_statement_type',
            context: String(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER),
        });
        instance.registerModelProvider('I18nText[]', 'configuration.titleChoices', ElementTypes.CONTROL_TYPE_NAME, function () {
            return {
                hasImportButton: '',
                addButtonText: '',
                addButtonTextI18n: '',
                importButtonText: 'import',
                importButtonTextI18n: 'edt_text_import',
                statementsOptionText: 'Edit Titles...',
                statementsOptionTextI18n: 'edt_text_edit_titles',
                importDialogTitle: '',
                importDialogTitleI18n: '',
                newStatementText: 'Mr',
                newStatementTextI18n: 'edt_text_name_mr',
                statementTypeName: 'TITLE',
                statementTypeNameI18n: 'edt_text_title_type',
                context: String(ElementTypes.CONTROL_TYPE_NAME),
            };
        });
        instance.registerRenderer('string', 'layout.direction', [
            ElementTypes.CONTROL_TYPE_CHECKBOX,
            ElementTypes.CONTROL_TYPE_RADIO,
        ], '/modules/Typescript/Form/resources/editor/layout-direction.html', null);
        instance.registerRenderer('int', 'layout.columns', [
            ElementTypes.CONTROL_TYPE_CHECKBOX,
            ElementTypes.CONTROL_TYPE_RADIO,
        ], '/modules/Typescript/Form/resources/editor/layout-columns.html', null);
        instance.registerRenderer('string', 'configuration.timeFormat', ElementTypes.CONTROL_TYPE_TIME, '/modules/Typescript/Form/resources/editor/Time/time-format.html', null);
        instance.registerRenderer('int', 'configuration.type', ElementTypes.CONTROL_TYPE_CAPTCHA, '/modules/Typescript/Form/resources/editor/Captcha/configuration-type.html', null);
        instance.registerRenderer('int', 'configuration.displayAs', ElementTypes.CONTROL_TYPE_STAR_RATING, '/modules/Typescript/Form/resources/editor/StarRating/configuration-display-as.html', null);
        instance.registerRenderer('string', 'configuration.linkBehaviour', ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, '/modules/Typescript/Form/resources/editor/TermsOfService/configuration-link-behaviour.html', null);
        instance.registerRenderer('string', /^(.*)\.(innerHTML|agreementHTMLMarkup)$/, null, '/modules/Typescript/Form/resources/editor/html.html', {
            autoClick: '',
            dialogTitle: 'Edit Rich Text',
            dialogTitleI18n: 'edt_UI_create_dialog_edit_rich_text',
        });
        instance.registerModelProvider('string', 'configuration.innerHTML', ElementTypes.CONTROL_TYPE_FORM_HEADER, (function () {
            return {
                autoClick: '1',
                dialogTitle: 'Edit form header',
                dialogTitleI18n: 'edt_UI_create_dialog_edit_form_header',
            };
        }));
        instance.registerRenderer('int', 'options.paginationType', ElementTypes.CONTAINER_TYPE_PAGE, '/modules/Typescript/Form/resources/editor/Page/pagination-type.html', null);
        instance.registerRenderer('string', /\.color$/, ElementTypes.ELEMENT_TYPE_FORM, 'ui://color', null);
        instance.registerRenderer('string', /\.font\.family$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/font-face.html', null);
        instance.registerRenderer('string', /\.font\.line\.height$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/font-line-height.html', null, 99);
        instance.registerRenderer('string', 'options.widthUnit', ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/Form/form-width-in-pixels-or-percents.html', null, 200);
        instance.registerRenderer('string', /\.border\.style$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/border-style.html', null);
        instance.registerRenderer('string', /\.font\.style/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/font-style.html', null);
        instance.registerRenderer('string', /\.font\.weight/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/font-weight.html', null);
        instance.registerRenderer('string', /\.(border\.(radius|width)|height|width|margin(\.left|\.right|\.bottom|\.top|\.vertical)?|padding\.(bottom|left|right|top|horizontal|vertical)|font\.size)$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/size-px.html', {
            min: '0',
            max: '1280',
        });
        instance.registerModelProvider('string', /\.border\.radius$/, ElementTypes.ELEMENT_TYPE_FORM, function () {
            return {
                min: '0',
                max: '10',
            };
        });
        instance.registerModelProvider('string', /\.border\.width$/, ElementTypes.ELEMENT_TYPE_FORM, function () {
            return {
                min: '0',
                max: '5',
            };
        });
        instance.registerModelProvider('string', /\.font\.size$/, ElementTypes.ELEMENT_TYPE_FORM, function () {
            return {
                min: '8',
                max: '48',
            };
        });
        instance.registerRenderer('string', 'radio.appearance', ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/radio-input-appearance.html', null);
        instance.registerRenderer(null, 'validation.type', null, '/modules/Typescript/Form/resources/editor/validation-type.html', {
            propagateValueCSSSelector: '#item div[data-role=attribute-group][data-name=validation]',
            propagateValueAttributeName: 'data-validation-type',
        });
        instance.registerModelProvider(null, 'validation.type', ElementTypes.CONTROL_TYPE_DATE, function () {
            return {
                propagateValueCSSSelector: '#item div[data-role=attribute-group][data-name=validation], #item [data-role=property][data-property-name="configuration-defaultValue"], #item [data-role=property][data-property-name="configuration-maxDateRelativeValue"], #item [data-role=property][data-property-name="configuration-minDateRelativeValue"]',
            };
        });
        instance.registerModelProvider(null, 'label.visibilityMode', [
            ElementTypes.CONTROL_TYPE_TEXTAREA,
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_EMAIL,
            ElementTypes.CONTROL_TYPE_WEBSITE,
            ElementTypes.CONTROL_TYPE_PASSWORD,
            ElementTypes.CONTROL_TYPE_COUPON,
            ElementTypes.CONTROL_TYPE_FORMULA,
        ], function () {
            return {
                hasCompactProperty: 'true',
            };
        });
        instance.registerRenderer(null, 'label.visibilityMode', null, '/modules/Typescript/Form/resources/editor/visibility-mode.html', {
            hasCompactProperty: '',
        });
        instance.registerRenderer(null, 'options.groupedAnswersSeparatorType', ElementTypes.CONTROL_TYPE_CHECKBOX, '/modules/Typescript/Form/resources/editor/grouped-answers-separator.html', null);
        instance.registerRenderer('string', ['label.labelText', 'instructions.text', 'configuration.defaultValue', 'options.suggestions'], null, '/modules/Typescript/Form/resources/editor/multi-line-string.html', {
            isMarkdown: '',
            placeholder: 'Write something here...',
        });
        instance.registerModelProvider('string', ['label.labelText', 'instructions.text'], null, function () {
            return {
                isMarkdown: '1',
            };
        });
        instance.registerModelProvider('string', 'options.suggestions', [
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_EMAIL,
            ElementTypes.CONTROL_TYPE_WEBSITE,
        ], function () {
            return {
                placeholder: 'Write suggestions separated by enter',
            };
        });
        instance.registerModelProvider('string', 'label.labelText', ElementTypes.CONTAINER_TYPE_PAGE, function () {
            return {
                isMarkdown: '',
            };
        });
        instance.registerRenderer(null, 'configuration.uploadToCustomizeImage', ElementTypes.CONTROL_TYPE_IMAGE, '/modules/Typescript/Form/resources/editor/image-upload.html', null);
        instance.registerRenderer('int[]', /^(options\.requiredFields|configuration\.allowedFields)$/, ElementTypes.CONTROL_TYPE_ADDRESS, '/modules/Typescript/Form/resources/editor/Address/fields.html', null);
        instance.registerRenderer('int[]', /^(configuration\.allowedPlatforms)$/, ElementTypes.CONTROL_TYPE_SOCIAL, '/modules/Typescript/Form/resources/editor/social-platform-select.html', null);
        instance.registerRenderer('string', 'configuration.addressStyle', ElementTypes.CONTROL_TYPE_ADDRESS, '/modules/Typescript/Form/resources/editor/Address/address-style.html', null);
        instance.registerRenderer(null, /^configuration\.(countries|defaultCountry)$/, ElementTypes.CONTROL_TYPE_ADDRESS, '/modules/Typescript/Form/resources/editor/Address/countries.html', {
            multiple: "1",
        });
        instance.registerModelProvider(null, 'configuration.defaultCountry', ElementTypes.CONTROL_TYPE_ADDRESS, function () {
            return {
                multiple: "",
            };
        });
        instance.registerModelProvider('int[]', 'configuration.allowedFields', ElementTypes.CONTROL_TYPE_ADDRESS, function () {
            return {
                allowAllFields: null,
            };
        });
        instance.registerRenderer('string', 'configuration.zoneLabel', ElementTypes.CONTROL_TYPE_ADDRESS, '/modules/Typescript/Form/resources/editor/Address/zone-label.html', null);
        instance.registerRenderer('string', 'configuration.postalCodeLabel', ElementTypes.CONTROL_TYPE_ADDRESS, '/modules/Typescript/Form/resources/editor/Address/postalcode-label.html', null);
        instance.registerRenderer('int', 'options.labelPlacement', ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/Form/label-placement.html', null);
        instance.registerRenderer('int', 'options.instructionsPlacement', ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/Form/instructions-placement.html', null);
        instance.registerRenderer('int', 'options.direction', ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/Form/text-direction.html', null);
        instance.registerRenderer('int', /^options\.(label|instructions)TextAlignment$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/Form/label-text-alignment.html', null);
        instance.registerModelProvider('int', 'options.labelWidthInUnits', ElementTypes.ELEMENT_TYPE_FORM, function () {
            return {
                min: '1',
                max: '19',
            };
        });
        instance.registerRenderer('string', 'page.shadow.visibility', ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/page-shadow.html', null);
        instance.registerRenderer('string', /^(page|form)\.background\.size$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/image-background-size.html', null);
        instance.registerRenderer('string', /^(page|form)\.background\.position$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/image-background-position.html', null);
        instance.registerRenderer('string', /^(page|form)\.background\.repeat$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/image-background-repeat.html', null);
        instance.registerRenderer('string', /^(page|form)\.background\.attachment$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/image-background-attachment.html', null);
        instance.registerRenderer('string', /^(page|form)\.background\.image$/, ElementTypes.ELEMENT_TYPE_FORM, '/modules/Typescript/Form/resources/editor/image-upload.html', null);
        instance.registerRenderer(null, /^configuration\.(defaultValue|maxDateRelativeValue|minDateRelativeValue)$/, ElementTypes.CONTROL_TYPE_DATE, '/modules/Typescript/Form/resources/editor/Date/date-string.html', {
            'presets': 'notSet -1w -1d now +1d +1w custom',
            'isTimePart': '',
            'placeholder': 'mm/dd/yyyy OR ±5d2w1m',
            'i18nPlaceholder': 'edt_text_date_placeholder',
        });
        instance.registerRenderer(null, /^configuration\.(defaultValue)$/, ElementTypes.CONTROL_TYPE_TIME, '/modules/Typescript/Form/resources/editor/Date/date-string.html', {
            'presets': 'notSet -1hh -1mm now +1mm +1hh customTime',
            'isTimePart': '1',
            'placeholder': 'hh:mm AM or ±5h',
            'i18nPlaceholder': 'edt_text_time_placeholder',
        });
        instance.registerRenderer('boolean', 'configuration.useCustomLink', ElementTypes.CONTROL_TYPE_SOCIAL, '/modules/Typescript/Form/resources/editor/SocialControl/use-custom-link.html', null);
        instance.registerRenderer('int[]', 'configuration.optionalFields', ElementTypes.CONTROL_TYPE_NAME, '/modules/Typescript/Form/resources/editor/Name/optional-fields.html', null);
        instance.registerRenderer('boolean', 'options.hasGroupedAnswers', ElementTypes.CONTROL_TYPE_CHECKBOX, '/modules/Typescript/Form/resources/editor/has-grouped-answers-separator.html', null);
        instance.registerRenderer('string[]', /^configuration\.(allowExtensions|forbidExtensions)$/, ElementTypes.CONTROL_TYPE_FILE, '/modules/Typescript/Form/resources/editor/File/extensions.html', {
            extensions: JSON.parse('[]'),
            isAllow: '',
            isDeny: '',
            propagateAttributeName: '',
        });
        instance.registerRenderer('boolean', 'options.isNumberOfTimesAnOptionCanBeChosen', [ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_RADIO, ElementTypes.CONTROL_TYPE_DROPDOWN], '/modules/Typescript/Form/resources/editor/allow-number-of-times-an-option-can-be-chosen.html', null);
        instance.registerRenderer('boolean', 'options.displaySuggestions', [ElementTypes.CONTROL_TYPE_TEXT, ElementTypes.CONTROL_TYPE_EMAIL, ElementTypes.CONTROL_TYPE_WEBSITE], '/modules/Typescript/Form/resources/editor/display-suggestions.html', null);
        instance.registerRenderer('TextChoiceInterface[]', /^options\.(configureValues|quizOptions)$/, [
            ElementTypes.CONTROL_TYPE_CHECKBOX,
            ElementTypes.CONTROL_TYPE_RADIO,
            ElementTypes.CONTROL_TYPE_DROPDOWN
        ], '/modules/Typescript/Form/resources/editor/configure-values.html', {
            choicesOptionText: 'Configure values',
            choicesOptionTextI18n: 'edt_text_configure_values',
            defaultChoiceInputType: '',
            newChoiceText: 'New Choice',
            newChoiceTextI18n: 'edt_text_new_choice',
            itemType: 'CHOICE',
            editingContext: 'CONFIGURE_VALUES',
            synchronizeOtherProperties: '#item div[data-role=property][data-property-name=choices-values] input[data-plugin=text-choice-interface],' +
                ' #item div[data-role=property][data-property-name=options-quizOptions] input[data-plugin=text-choice-interface], ' +
                ' #item div[data-role=property][data-property-name=payments-virtualValue] input[data-plugin=text-choice-interface]'
        });
        instance.registerRenderer('TextChoiceInterface[]', 'options.quizOptions', [
            ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
        ], '/modules/Typescript/Form/resources/editor/configure-likert-quiz.html', {
            choicesOptionText: 'Quiz options',
            choicesOptionTextI18n: 'edt_text_configure_values',
            defaultChoiceInputType: '',
            newChoiceText: 'New Choice',
            newChoiceTextI18n: 'edt_text_new_choice',
            itemType: 'CHOICE',
            editingContext: 'QUIZ_OPTIONS',
            synchronizeOtherProperties: '#item div[data-role=property][data-property-name=choices-scale] input[data-plugin=text-choice-interface],' +
                ' #item div[data-role=property][data-property-name=payments-virtualValue] input[data-plugin=text-choice-interface]',
        });
        instance.registerModelProvider('TextChoiceInterface[]', 'options.quizOptions', [
            ElementTypes.CONTROL_TYPE_RADIO,
            ElementTypes.CONTROL_TYPE_DROPDOWN,
        ], function () {
            return {
                choicesOptionText: 'Quiz Options',
                choicesOptionTextI18n: 'edt_text_quiz_options',
                editingContext: 'QUIZ_OPTIONS',
                synchronizeOtherProperties: '#item div[data-role=property][data-property-name=choices-values] input[data-plugin=text-choice-interface],' +
                    ' #item div[data-role=property][data-property-name=options-configureValues] input[data-plugin=text-choice-interface], ' +
                    ' #item div[data-role=property][data-property-name=payments-virtualValue] input[data-plugin=text-choice-interface]',
                defaultChoiceInputType: String(EChoiceDefaultOptionInputType.RADIO),
            };
        });
        instance.registerModelProvider('TextChoiceInterface[]', 'options.quizOptions', [
            ElementTypes.CONTROL_TYPE_CHECKBOX
        ], function () {
            return {
                choicesOptionText: 'Quiz Options',
                choicesOptionTextI18n: 'edt_text_quiz_options',
                editingContext: 'QUIZ_OPTIONS',
                synchronizeOtherProperties: '#item div[data-role=property][data-property-name=choices-values] input[data-plugin=text-choice-interface],' +
                    ' #item div[data-role=property][data-property-name=options-configureValues] input[data-plugin=text-choice-interface], ' +
                    ' #item div[data-role=property][data-property-name=payments-virtualValue] input[data-plugin=text-choice-interface]',
                defaultChoiceInputType: String(EChoiceDefaultOptionInputType.CHECKBOX),
            };
        });
        instance.registerRenderer('TextChoiceInterface[]', 'payments.virtualValue', [
            ElementTypes.CONTROL_TYPE_CHECKBOX,
            ElementTypes.CONTROL_TYPE_RADIO,
            ElementTypes.CONTROL_TYPE_DROPDOWN,
            ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
        ], '/modules/Typescript/Form/resources/editor/configure-values.html', {
            choicesOptionText: 'Value / Price',
            choicesOptionTextI18n: 'edt_UI_property_payments_value',
            defaultChoiceInputType: String(EChoiceDefaultOptionInputType.RADIO),
            newChoiceText: 'New Choice',
            newChoiceTextI18n: 'edt_text_new_choice',
            itemType: 'CHOICE',
            editingContext: 'PAYMENTS_VALUES',
            synchronizeOtherProperties: '#item div[data-role=property][data-property-name=choices-values] input[data-plugin=text-choice-interface],' +
                ' #item div[data-role=property][data-property-name=choices-scale] input[data-plugin=text-choice-interface],' +
                ' #item div[data-role=property][data-property-name=options-quizOptions] input[data-plugin=text-choice-interface],' +
                ' #item div[data-role=property][data-property-name=options-configureValues] input[data-plugin=text-choice-interface]'
        });
        instance.registerModelProvider('TextChoiceInterface[]', '^choices\.values|payments\.virtualValue$', ElementTypes.CONTROL_TYPE_CHECKBOX, function () {
            return {
                defaultChoiceInputType: String(EChoiceDefaultOptionInputType.CHECKBOX),
            };
        });
        instance.registerModelProvider('string[]', 'configuration.allowExtensions', ElementTypes.CONTROL_TYPE_FILE, function () {
            return {
                extensions: JSON.parse(JSON.stringify(UserFileExtensionsService.getInstance().getAllowedUserFileExtensions())),
                isAllow: '1',
                isDeny: '',
                propagateAttributeName: 'data-allowed-extensions',
            };
        });
        instance.registerModelProvider('string[]', 'configuration.forbidExtensions', ElementTypes.CONTROL_TYPE_FILE, function () {
            return {
                extensions: JSON.parse(JSON.stringify(UserFileExtensionsService.getInstance().getForbiddenUserFileExtensions())),
                isAllow: '',
                isDeny: '1',
                propagateAttributeName: 'data-forbidden-extensions',
            };
        });
        instance.registerRenderer('boolean', 'options.multiple', ElementTypes.CONTROL_TYPE_FILE, '/modules/Typescript/Form/resources/editor/File/has-allow-multiple-files.html', null);
        instance.registerRenderer('boolean', 'layout.isSideBySide', [
            ElementTypes.CONTROL_TYPE_RADIO,
            ElementTypes.CONTROL_TYPE_CHECKBOX,
        ], '/modules/Typescript/Form/resources/editor/Radio/has-side-by-side-layout.html', null);
        instance.registerModelProvider('string', 'configuration.url', ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, function () {
            return {
                placeholder: 'e.g.: www.yourdomain.com/tos.html',
                i18nPlaceholder: 'edt_text_terms_of_service_example',
            };
        });
        instance.registerModelProvider('string', 'configuration.agreementLabelAdditionalText', ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, function () {
            return {
                placeholder: 'TIP: use the tags <link> and </link> to add a URL',
                i18nPlaceholder: 'edt_text_terms_of_service_agreement_text_example',
            };
        });
        instance.registerModelProvider('string', 'configuration.facebookTitle', ElementTypes.CONTROL_TYPE_SOCIAL, function () {
            return {
                placeholder: 'Title',
                i18nPlaceholder: 'edt_text_title',
            };
        });
        instance.registerModelProvider('string', 'configuration.facebookDescription', ElementTypes.CONTROL_TYPE_SOCIAL, function () {
            return {
                placeholder: 'Description',
                i18nPlaceholder: 'edt_text_description',
            };
        });
        instance.registerModelProvider('string', 'configuration.customLink', ElementTypes.CONTROL_TYPE_SOCIAL, function () {
            return {
                placeholder: 'e.g.: www.yourdomain.com',
                i18nPlaceholder: 'edt_text_social_custom_link_example',
            };
        });
        instance.registerModelProvider('string', 'validation.customValue', ElementTypes.CONTROL_TYPE_TEXT, function () {
            return {
                placeholder: 'Validation format',
                i18nPlaceholder: 'edt_text_validation_format',
            };
        });
        instance.registerModelProvider('int', /^(configuration|choices)\.(minLength|maxLength|minNumberOfWords|maxNumberOfWords|minNumberOfChoices|maxNumberOfChoices)$/, [
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_TEXTAREA,
            ElementTypes.CONTROL_TYPE_CHECKBOX,
        ], function () {
            return {
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerModelProvider('int', 'configuration.defaultValue', ElementTypes.CONTROL_TYPE_STAR_RATING, function () {
            return {
                min: '1',
                max: '10',
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerModelProvider('int', 'configuration.starsCount', ElementTypes.CONTROL_TYPE_STAR_RATING, function () {
            return {
                min: '3',
                max: '10',
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerModelProvider('int', /^(configuration)\.(minSizeInBytes|maxSizeInBytes)$/, ElementTypes.CONTROL_TYPE_FILE, function () {
            return {
                max: '10240000',
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerModelProvider('number', /^(configuration)\.(minSizeInKiloBytes|maxSizeInKiloBytes)$/, ElementTypes.CONTROL_TYPE_FILE, function () {
            return {
                max: '153600',
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerModelProvider(null, /^(configuration)\.(minValue|maxValue|minLength|maxLength)$/, [
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_EMAIL,
            ElementTypes.CONTROL_TYPE_WEBSITE,
            ElementTypes.CONTROL_TYPE_PASSWORD,
            ElementTypes.CONTROL_TYPE_FORMULA,
        ], function () {
            return {
                max: '1000',
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerModelProvider(null, /^(configuration)\.(popupWidthInPixels|popupHeightInPixels)$/, [
            ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
        ], function () {
            return {
                max: '1000'
            };
        });
        instance.registerModelProvider(null, 'configuration.initialZoom', [
            ElementTypes.CONTROL_TYPE_MAP,
        ], function () {
            return {
                max: '22',
                min: '1'
            };
        });
        instance.registerModelProvider('string', 'configuration.initialAddressText', [
            ElementTypes.CONTROL_TYPE_MAP,
        ], function () {
            return {
                placeholder: 'Write an address here...',
                i18nPlaceholder: 'edt_text_write_address',
            };
        });
        instance.registerModelProvider('string', /^(label)\.(submitButtonText|resetButtonText)$/, [
            ElementTypes.CONTROL_TYPE_ACTION_BAR,
        ], function () {
            return {
                placeholder: 'Button text',
                i18nPlaceholder: 'edt_text_button_text',
            };
        });
        instance.registerModelProvider('number', 'configuration.defaultValue', [
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_FORMULA
        ], function () {
            return {
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerModelProvider('string', /^configuration.(fieldName|alternateText)$/, [
            ElementTypes.CONTROL_TYPE_HTML_BLOCK,
            ElementTypes.CONTROL_TYPE_HEADING,
            ElementTypes.CONTROL_TYPE_IMAGE,
            ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK,
            ElementTypes.CONTROL_TYPE_WIDGET_PDF,
            ElementTypes.CONTROL_TYPE_WIDGET_VIDEO,
        ], function () {
            return {
                placeholder: 'Write something here...',
                i18nPlaceholder: 'edt_text_write_something',
            };
        });
        instance.registerModelProvider('boolean', 'label.isBold', null, function () {
            return {
                title: 'Bold',
                i18nTitle: 'edt_text_bold',
            };
        });
        instance.registerModelProvider('boolean', 'label.isItalic', null, function () {
            return {
                title: 'Italic',
                i18nTitle: 'edt_text_italic',
            };
        });
        instance.registerRenderer(null, 'synchronize.withControlId', [
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_PASSWORD,
            ElementTypes.CONTROL_TYPE_WEBSITE,
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_EMAIL,
            ElementTypes.CONTROL_TYPE_FORMULA,
        ], '/modules/Typescript/Form/resources/editor/matching-controls-list.html', null);
        instance.registerRenderer(null, 'propagate.onControlId', [
            ElementTypes.CONTROL_TYPE_MAP,
        ], '/modules/Typescript/Form/resources/editor/matching-controls-list.html', null);
        instance.registerRenderer(null, 'synchronize.withControlId', [
            ElementTypes.CONTROL_TYPE_MAP,
        ], '/modules/Typescript/Form/resources/editor/synchronize-map-list.html', null);
        instance.registerRenderer('boolean', 'synchronize.enabled', [
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_PASSWORD,
            ElementTypes.CONTROL_TYPE_WEBSITE,
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_EMAIL,
            ElementTypes.CONTROL_TYPE_FORMULA,
        ], '/modules/Typescript/Form/resources/editor/has-match-another-field-enabled.html', null);
        instance.registerModelProvider(null, 'size.heightInRows', ElementTypes.CONTROL_TYPE_TEXTAREA, function () {
            return {
                max: '20',
                min: '3'
            };
        });
        instance.registerRenderer('boolean', 'configuration.isLimitSubmissionsEnabled', [
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_FORMULA
        ], '/modules/Typescript/Form/resources/editor/Number/is-limit-submissions-enabled.html', null);
        instance.registerModelProvider('string', 'configuration.url', ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK, function () {
            return {
                placeholder: 'https://www.facebook.com/123FormBuilder',
                i18nPlaceholder: '',
            };
        });
        instance.registerModelProvider('string', 'configuration.url', ElementTypes.CONTROL_TYPE_WIDGET_PDF, function () {
            return {
                placeholder: 'Write a document URL here...',
                i18nPlaceholder: 'edt_text_write_document_url',
            };
        });
        instance.registerModelProvider('string', 'configuration.url', ElementTypes.CONTROL_TYPE_WIDGET_VIDEO, function () {
            return {
                placeholder: 'https://youtu.be/T4hCGUGxnoc',
                i18nPlaceholder: '',
            };
        });
        instance.registerRenderer('any', 'payments.productsDialogTrigger', [
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_STAR_RATING,
            ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
            ElementTypes.CONTROL_TYPE_RADIO,
            ElementTypes.CONTROL_TYPE_CHECKBOX,
            ElementTypes.CONTROL_TYPE_DROPDOWN,
            ElementTypes.CONTROL_TYPE_PRICE,
            ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
        ], '/modules/Typescript/Form/resources/editor/Payments/ProductsDialog/payments-products-dialog-trigger.html', {
            choicesOptionText: 'Quantity, Discount & Tax',
            choicesOptionTextI18n: 'edt_UI_property_payments_settings_toggle'
        });
        instance.registerModelProvider('number', 'payments.virtualValue', [
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_STAR_RATING,
            ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
            ElementTypes.CONTROL_TYPE_PRICE
        ], function () {
            return {
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerRenderer('ICouponCodeSettings[]', 'coupons.couponCodes', ElementTypes.CONTROL_TYPE_COUPON, '/modules/Typescript/Form/resources/editor/Coupon/coupon-codes.html', null);
        instance.registerRenderer('string', 'calculations.formula', ElementTypes.CONTROL_TYPE_FORMULA, '/modules/Typescript/Form/resources/editor/formula.html', {
            addFieldLabel: 'Add field',
            i18nAddFieldLabel: 'edt_formula_add_field_label',
            deletedFieldLabel: 'Deleted',
            i18nDeletedFieldLabel: 'edt_formula_deleted_field_label',
            fixedAmountLabel: 'Fixed amount',
            i18nFixedAmountLabel: 'edt_formula_fixed_amount_label',
        });
        instance.registerRenderer('int', 'currencyId', EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING, '/modules/Typescript/Form/resources/editor/SummarySetting/price.html', null);
        instance.registerRenderer('int', 'discountOnTotal', EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING, '/modules/Typescript/Form/resources/editor/SummarySetting/discount-on-total-container.html', null);
        instance.registerRenderer('int', 'taxOnTotal', EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING, '/modules/Typescript/Form/resources/editor/SummarySetting/tax-on-total-container.html', null);
        instance.registerRenderer('boolean', 'showSummaryAfterSubmit', EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING, '/modules/Typescript/Form/resources/editor/SummarySetting/show-summary.html', null);
        instance.registerRenderer('boolean', 'synchronize.enabled', ElementTypes.CONTROL_TYPE_MAP, '/modules/Typescript/Form/resources/editor/send-map-coordinates.html', {
            group_property: 'data-synchronize-enabled'
        });
        instance.registerRenderer('boolean', 'propagate.enabled', ElementTypes.CONTROL_TYPE_MAP, '/modules/Typescript/Form/resources/editor/send-map-coordinates.html', {
            group_property: 'data-propagate-enabled'
        });
        instance.registerModelProvider('number', 'propagate.onControlId', [
            ElementTypes.CONTROL_TYPE_MAP,
        ], function () {
            return {
                i18nPlaceholder: 'edt_text_none_placeholder',
            };
        });
        instance.registerRenderer('string', [
            'locations',
        ], EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING, '/modules/Typescript/Form/resources/editor/Payments/Processors/Square/locations-dialog-trigger.html', null);
        instance.registerRenderer('string', [
            'merchantId', 'publicKey', 'privateKey', 'planId',
            'userEmail', 'storeName', 'storeDescription', 'storeImage',
            'clientId',
            'encryptionKey',
            'userId', 'partner', 'password',
            'apiUsername', 'apiPassword', 'apiSignature',
            'merchantKey',
            'clientKey', 'serviceKey',
            'apiLoginId', 'transactionKey',
            'vendorName', 'encryptionPassword', 'vendorEmail', 'partnerId',
            'oAuthCustomUrl', 'oAuthCustomToken', 'failureEmail',
        ], [
            EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING,
        ], '/modules/Typescript/Form/resources/editor/multi-line-string.html', null);
        instance.registerRenderer('string', 'userEmail', [
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING,
        ], '/modules/Typescript/Form/resources/editor/Payments/Processors/Stripe/payments-string-read-only.html', null);
        instance.registerRenderer('string', 'language', [
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING
        ], '/modules/Typescript/Form/resources/editor/Payments/Processors/language.html', null);
        instance.registerModelProvider('int', 'recurrenceFrequency', [
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
        ], function () {
            return {
                placeholder: 'none',
                i18nPlaceholder: 'edt_text_none_placeholder',
                max: '52',
            };
        });
        instance.registerRenderer('int', 'recurrenceTimeUnit', [
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING,
        ], '/modules/Typescript/Form/resources/editor/Payments/Processors/recurrence-time-unit.html', null);
        instance.registerRenderer('int', 'recurrenceTimeUnit', [
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
        ], '/modules/Typescript/Form/resources/editor/Payments/Processors/Stripe/recurrence-time-unit-without-day.html', null);
        instance.registerRenderer('int', 'recurrenceCycles', [
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING
        ], '/modules/Typescript/Form/resources/editor/Payments/Processors/recurrence-cycles.html', null);
        instance.registerRenderer('string', 'customerEmail', EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING, '/modules/Typescript/Form/resources/editor/Payments/Processors/Sagepay/customer-email.html', null);
        instance.registerModelProvider('int', 'configuration.maxNumberOfGroupsAllowed', ElementTypes.CONTAINER_TYPE_REPEATABLE, function () {
            return {
                min: '1',
                max: '60',
            };
        });
        instance.registerRenderer('string', 'configuration.apiKey', ElementTypes.CONTROL_TYPE_MAP, '/modules/Typescript/Form/resources/editor/api-key-description.html', {
            placeholder: 'Paste here your API Key...',
            i18nPlaceholder: 'edt_text_paste_here_api_key',
            i18nApiKeyDescription: 'edt_api_key_description',
        });
        instance.registerRenderer('string', 'label.labelText', ElementTypes.CONTROL_TYPE_FEE, '/modules/Typescript/Form/resources/editor/Fee/name.html', {
            title: 'Name:',
            i18nTitle: 'XYZ',
            placeholder: 'Write something here...',
            i18nPlaceholder: 'XYZ'
        });
        instance.registerRenderer('string', 'instructions.text', ElementTypes.CONTROL_TYPE_FEE, '/modules/Typescript/Form/resources/editor/Fee/description.html', {
            title: 'Description:',
            i18nTitle: 'XYZ',
            placeholder: 'Write something here...',
            i18nPlaceholder: 'XYZ'
        });
        instance.registerRenderer('number', 'payments.virtualValue', ElementTypes.CONTROL_TYPE_FEE, '/modules/Typescript/Form/resources/editor/Fee/price.html', {
            basePrice: 'Base price:',
            i18nBasePrice: 'XYZ',
            formCurrency: 'Form currency:',
            i18nFormCurrency: 'XYZ',
            placeholder: '0',
            i18nPlaceholder: 'XYZ',
        });
        instance.registerRenderer('boolean', 'options.displayPrefix', [
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_FORMULA
        ], '/modules/Typescript/Form/resources/editor/display-prefix.html', null);
        instance.registerRenderer('string', 'configuration.prefix', [
            ElementTypes.CONTROL_TYPE_TEXT,
            ElementTypes.CONTROL_TYPE_NUMBER,
            ElementTypes.CONTROL_TYPE_FORMULA
        ], '/modules/Typescript/Form/resources/editor/prefix.html', null);
        instance.registerRenderer('array', 'columns', EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING, '/modules/Typescript/Form/resources/editor/list-editor.html', null);
    };
    EditorValueRendererFactory.prototype.getMapPropagationCompatibleControls = function (acceptedTypes) {
        var result = [], elements = this.document.getControlsList();
        for (var i = 0; i < elements.length; i++)
            if (acceptedTypes.indexOf(elements[i].getTypeId()) > -1) {
                result.push({
                    id: elements[i].getId(),
                    label: (elements[i].hasProperty('label.labelText')
                        ? elements[i].getProperty('label.labelText')
                        : 'Control #' + elements[i].getId()) || 'Control #' + elements[i].getId()
                });
            }
        return result;
    };
    return EditorValueRendererFactory;
}(EventEmitter));
var LegacyDataTranslator = (function () {
    function LegacyDataTranslator(document) {
        this.document = document;
    }
    LegacyDataTranslator.prototype.getMapping = function (controlId, repeatedIndex, repeatedPath) {
        repeatedIndex = repeatedIndex || 0;
        var matches = /^(control[-_]{0,1})?([\d]+)([-_]([\d]+))?/.exec(String(controlId || ''));
        if (!matches) {
            return null;
        }
        var elementId = parseInt(matches[2]), inputIndex = parseInt(matches[4] || '0'), element = null;
        if (repeatedPath) {
            element = this.document.getElementByIdAndRepeatedPath(elementId, repeatedIndex, repeatedPath);
        }
        else {
            element = this.document.getElementById(elementId, repeatedIndex);
        }
        if (!element) {
            return null;
        }
        if (EElementKind.CONTROL !== element.getElementKind()) {
            return null;
        }
        var propertyDescriptor = element.getPropertyDescriptorByInputIndex(inputIndex);
        if (null === propertyDescriptor) {
            if (0 === inputIndex) {
                var indexes = element.enumerateIndexes();
                if (indexes && indexes.length) {
                    propertyDescriptor = element.getPropertyDescriptorByInputIndex(indexes[0] || 0);
                }
                if (null === propertyDescriptor) {
                    return null;
                }
            }
            else {
                return null;
            }
        }
        propertyDescriptor.element = element;
        return propertyDescriptor;
    };
    LegacyDataTranslator.prototype.getDocument = function () {
        return this.document;
    };
    return LegacyDataTranslator;
}());
var ElementPropertyOrder = (function () {
    function ElementPropertyOrder() {
    }
    ElementPropertyOrder.getAttributeOrder = function (attributeName) {
        switch (attributeName) {
            case this.ATTRIBUTE_OPTIONS:
                return this.ORDER_ATTRIBUTE_OPTIONS;
            case ElementPropertyOrder.ATTRIBUTE_SIZE:
                return this.ORDER_ATTRIBUTE_SIZE;
            case this.ATTRIBUTE_SYNCHRONIZE:
                return this.ORDER_ATTRIBUTE_SYNCHRONIZE;
            case this.ATTRIBUTE_PROPAGATE:
                return this.ORDER_ATTRIBUTE_PROPAGATE;
            case this.ATTRIBUTE_CONFIGURATION:
                return this.ORDER_ATTRIBUTE_CONFIGURATION;
            case this.ATTRIBUTE_VALUE:
                return this.ORDER_ATTRIBUTE_VALUE;
            case this.ATTRIBUTE_VALIDATION:
                return this.ORDER_ATTRIBUTE_VALIDATION;
            case this.ATTRIBUTE_INSTRUCTIONS:
                return this.ORDER_ATTRIBUTE_INSTRUCTIONS;
            case this.ATTRIBUTE_LABEL:
                return this.ORDER_ATTRIBUTE_LABEL;
            case this.ATTRIBUTE_CHOICES:
                return this.ORDER_ATTRIBUTE_CHOICES;
            case this.ATTRIBUTE_LAYOUT:
                return this.ORDER_ATTRIBUTE_LAYOUT;
            case this.ATTRIBUTE_LAYOUT_SIZE:
                return this.ORDER_ATTRIBUTE_LAYOUT_SIZE;
            case this.ATTRIBUTE_NAME:
                return this.ORDER_ATTRIBUTE_NAME;
            case this.ATTRIBUTE_DEFAULT_VALUE:
                return this.ORDER_ATTRIBUTE_DEFAULT_VALUE;
            case this.ATTRIBUTE_SCALE:
                return this.ORDER_ATTRIBUTE_SCALE;
            case this.ATTRIBUTE_STATEMENTS:
                return this.ORDER_ATTRIBUTE_STATEMENTS;
            case this.ATTRIBUTE_ACCEPTED_DATES:
                return this.ORDER_ATTRIBUTE_ACCEPTED_DATES;
            case this.ATTRIBUTE_AGREEMENT_TEXT:
                return this.ORDER_ATTRIBUTE_AGREEMENT_TEXT;
            case this.ATTRIBUTE_TEXT:
                return this.ORDER_ATTRIBUTE_TEXT;
            case this.ATTRIBUTE_HTML_CONTENT:
                return this.ORDER_ATTRIBUTE_HTML_CONTENT;
            case this.ATTRIBUTE_IMAGE:
                return this.ORDER_ATTRIBUTE_IMAGE;
            case this.ATTRIBUTE_PAGE_TITLE:
                return this.ORDER_ATTRIBUTE_PAGE_TITLE;
            case this.ATTRIBUTE_BUTTONS:
                return this.ORDER_ATTRIBUTE_BUTTONS;
            case this.ATTRIBUTE_FACEBOOK_SHARE:
                return this.ORDER_ATTRIBUTE_FACEBOOK_SHARE;
            case this.ATTRIBUTE_DEFAULT_MAP:
                return this.ORDER_ATTRIBUTE_DEFAULT_MAP;
            case this.ATTRIBUTE_SUBMIT_BUTTON:
                return this.ORDER_ATTRIBUTE_SUBMIT_BUTTON;
            case this.ATTRIBUTE_RESET_BUTTON:
                return this.ORDER_ATTRIBUTE_RESET_BUTTON;
            case this.ATTRIBUTE_FIELD_NAME:
                return this.ORDER_ATTRIBUTE_FIELD_NAME;
            case this.ATTRIBUTE_ALT_TEXT:
                return this.ORDER_ATTRIBUTE_ALT_TEXT;
            case this.ATTRIBUTE_URL:
                return this.ORDER_ATTRIBUTE_URL;
            case this.ATTRIBUTE_PAYMENTS:
                return this.ORDER_ATTRIBUTE_PAYMENTS;
            case this.ATTRIBUTE_COUPONS:
                return this.ORDER_ATTRIBUTE_COUPONS;
            case this.ATTRIBUTE_CALCULATIONS:
                return this.ORDER_ATTRIBUTE_CALCULATIONS;
            case this.ATTRIBUTE_ADD_BUTTON:
                return this.ORDER_ATTRIBUTE_ADD_BUTTON;
            case this.ATTRIBUTE_MAPS_API_KEY:
                return this.ORDER_ATTRIBUTE_MAPS_API_KEY;
            case this.ATTRIBUTE_FEE_DETAILS:
                return this.ORDER_ATTRIBUTE_LABEL;
            case this.ATTRIBUTE_FEE_PRICE:
                return this.ORDER_ATTRIBUTE_CALCULATIONS;
            default:
                return this.ORDER_UNKNOWN_ATTRIBUTE;
        }
    };
    ElementPropertyOrder.getSortedElementProperties = function (element) {
        var properties = element.enumerateProperties(), self = this;
        properties.sort(function (a, b) {
            var attributeNameOfPropertyA = self.getHardcodedPropertyAttributeName(a.name, element), attributeNameOfPropertyB = self.getHardcodedPropertyAttributeName(b.name, element), propertyNameA = a.name.split('.')[1] || '', propertyNameB = b.name.split('.')[1] || '', attributeOrderA = ElementPropertyOrder.getAttributeOrder(attributeNameOfPropertyA), attributeOrderB = ElementPropertyOrder.getAttributeOrder(attributeNameOfPropertyB);
            if (attributeOrderA === attributeOrderB) {
                if (propertyNameA < propertyNameB) {
                    return -1;
                }
                else {
                    if (propertyNameA === propertyNameB) {
                        return 0;
                    }
                    else {
                        return 1;
                    }
                }
            }
            else {
                return attributeOrderA - attributeOrderB;
            }
        });
        var attributeNameIndex = null, currentAttributeNameIndex, indexStart, indexEnd, attributeName, nextAttributeName, nextAttributeNameIndex, elementTypeId = element.getTypeId();
        for (var i = 0, len = properties.length; i < len; i++) {
            attributeName = self.getHardcodedPropertyAttributeName(properties[i].name, element);
            currentAttributeNameIndex = this.getAttributeOrder(attributeName);
            if (currentAttributeNameIndex !== attributeNameIndex) {
                attributeNameIndex = currentAttributeNameIndex;
                indexStart = i;
                indexEnd = indexStart;
                for (var j = i + 1; j < len; j++) {
                    nextAttributeName = self.getHardcodedPropertyAttributeName(properties[j].name, element);
                    nextAttributeNameIndex = this.getAttributeOrder(nextAttributeName);
                    if (nextAttributeNameIndex === attributeNameIndex) {
                        indexEnd = j;
                        i = j;
                    }
                    else {
                        break;
                    }
                }
                if (indexEnd - indexStart > 0) {
                    this.sortPropertiesByRange(properties, indexStart, indexEnd, attributeNameIndex, elementTypeId);
                }
            }
        }
        return properties;
    };
    ElementPropertyOrder.searchPropertyInRange = function (properties, propertyName, rangeStart, rangeEnd) {
        for (var i = rangeStart; i <= rangeEnd; i++) {
            if (propertyName === properties[i].name.split('.')[1]) {
                return i;
            }
        }
        return null;
    };
    ElementPropertyOrder.sortPropertiesByRange = function (properties, rangeStart, rangeEnd, attributeOrder, elementTypeId) {
        var sourcePropertyIndex, referencePropertyIndex, isError = false;
        for (var i = 0, len = this.hardcodedPropertyOrder.length; i < len; i++) {
            if (this.hardcodedPropertyOrder[i].attributeOrder !== attributeOrder) {
                continue;
            }
            if ('number' === typeof this.hardcodedPropertyOrder[i].elementTypes) {
                if (this.hardcodedPropertyOrder[i].elementTypes !== elementTypeId) {
                    continue;
                }
            }
            else {
                if (null !== this.hardcodedPropertyOrder[i].elementTypes && -1 === this.hardcodedPropertyOrder[i].elementTypes.indexOf(elementTypeId)) {
                    continue;
                }
            }
            sourcePropertyIndex = this.searchPropertyInRange(properties, this.hardcodedPropertyOrder[i].propertyName, rangeStart, rangeEnd);
            if (null === sourcePropertyIndex) {
                continue;
            }
            referencePropertyIndex = this.searchPropertyInRange(properties, this.hardcodedPropertyOrder[i].referencePropertyName, rangeStart, rangeEnd);
            if (null === referencePropertyIndex) {
                continue;
            }
            this.moveArrayElement(properties, sourcePropertyIndex, referencePropertyIndex, this.hardcodedPropertyOrder[i].relativePosition);
        }
    };
    ElementPropertyOrder.moveArrayElement = function (array, index, referenceIndex, position) {
        if (index === referenceIndex) {
            return;
        }
        var source = array.splice(index, 1)[0];
        if (referenceIndex > index) {
            referenceIndex--;
        }
        if (position === EFormPropertyOrderPlacement.AFTER) {
            referenceIndex++;
        }
        array.splice(referenceIndex, 0, source);
    };
    ElementPropertyOrder.setPropertyOrder = function (elementTypeIdOrElementTypesList, attributeName, referencePropertyName, propertyName, relativePosition) {
        if (null !== elementTypeIdOrElementTypesList) {
            switch (true) {
                case 'number' === typeof elementTypeIdOrElementTypesList:
                    break;
                case elementTypeIdOrElementTypesList instanceof Array:
                    if (!elementTypeIdOrElementTypesList.length) {
                        throw new Error('Invalid argument: elementTypeIdOrElementTypesList: int|int[1..n] expected!');
                    }
                    for (var i = 0, len = elementTypeIdOrElementTypesList.length; i < len; i++) {
                        if ('number' !== typeof elementTypeIdOrElementTypesList[i]) {
                            throw new Error('Invalid argument: elementTypeIdOrElementTypesList: int|int[1..n] expected!');
                        }
                    }
                    break;
                default:
                    throw new Error('Invalid argument: elementTypeIdOrElementTypesList: int|int[1..n] expected!');
            }
        }
        this.hardcodedPropertyOrder.push({
            propertyName: propertyName,
            attributeOrder: this.getAttributeOrder(attributeName),
            referencePropertyName: referencePropertyName,
            elementTypes: elementTypeIdOrElementTypesList,
            relativePosition: relativePosition
        });
    };
    ElementPropertyOrder.setPropertyGroup = function (elementTypeIdOrElementTypeIDs, propertyFQN, attributeName) {
        if (null !== elementTypeIdOrElementTypeIDs) {
            if ('number' !== typeof elementTypeIdOrElementTypeIDs) {
                if (!(elementTypeIdOrElementTypeIDs instanceof Array)) {
                    throw new Error('Invalid argument: int|int[] expected');
                }
                if (!elementTypeIdOrElementTypeIDs.length) {
                    throw new Error('Invalid argument: empty arrays are not supported!');
                }
                for (var i = 0, len = elementTypeIdOrElementTypeIDs.length; i < len; i++) {
                    if ('number' !== typeof elementTypeIdOrElementTypeIDs[i]) {
                        throw new Error('Invalid argument: int|int[] expected!');
                    }
                }
            }
        }
        if ('string' !== typeof propertyFQN) {
            throw new Error('Invalid argument: string expected!');
        }
        var segments = propertyFQN.split('.');
        if (2 !== segments.length || '' === segments[0] || '' === segments[1]) {
            throw new Error('Invalid argument: propertyFQN: invalid property name!');
        }
        switch (segments[0]) {
            case this.ATTRIBUTE_OPTIONS:
            case this.ATTRIBUTE_SIZE:
            case this.ATTRIBUTE_SYNCHRONIZE:
            case this.ATTRIBUTE_PROPAGATE:
            case this.ATTRIBUTE_CONFIGURATION:
            case this.ATTRIBUTE_VALUE:
            case this.ATTRIBUTE_VALIDATION:
            case this.ATTRIBUTE_INSTRUCTIONS:
            case this.ATTRIBUTE_LABEL:
            case this.ATTRIBUTE_CHOICES:
            case this.ATTRIBUTE_LAYOUT:
            case this.ATTRIBUTE_LAYOUT_SIZE:
            case this.ATTRIBUTE_NAME:
            case this.ATTRIBUTE_DEFAULT_VALUE:
            case this.ATTRIBUTE_SCALE:
            case this.ATTRIBUTE_STATEMENTS:
            case this.ATTRIBUTE_ACCEPTED_DATES:
            case this.ATTRIBUTE_AGREEMENT_TEXT:
            case this.ATTRIBUTE_TEXT:
            case this.ATTRIBUTE_HTML_CONTENT:
            case this.ATTRIBUTE_IMAGE:
            case this.ATTRIBUTE_PAGE_TITLE:
            case this.ATTRIBUTE_BUTTONS:
            case this.ATTRIBUTE_FACEBOOK_SHARE:
            case this.ATTRIBUTE_DEFAULT_MAP:
            case this.ATTRIBUTE_SUBMIT_BUTTON:
            case this.ATTRIBUTE_RESET_BUTTON:
            case this.ATTRIBUTE_FIELD_NAME:
            case this.ATTRIBUTE_ALT_TEXT:
            case this.ATTRIBUTE_PAYMENTS:
            case this.ATTRIBUTE_URL:
            case this.ATTRIBUTE_CALCULATIONS:
            case this.ATTRIBUTE_ADD_BUTTON:
            case this.ATTRIBUTE_MAPS_API_KEY:
            case this.ATTRIBUTE_FEE_DETAILS:
                break;
            default:
                throw new Error('Invalid argument: attribute ' + JSON.stringify(segments[0]) + ' does not exist!');
        }
        if ('string' !== typeof attributeName) {
            throw new Error('Invalid argument: attributeName: string expected!');
        }
        switch (attributeName) {
            case this.ATTRIBUTE_OPTIONS:
            case this.ATTRIBUTE_SIZE:
            case this.ATTRIBUTE_SYNCHRONIZE:
            case this.ATTRIBUTE_PROPAGATE:
            case this.ATTRIBUTE_CONFIGURATION:
            case this.ATTRIBUTE_VALUE:
            case this.ATTRIBUTE_VALIDATION:
            case this.ATTRIBUTE_INSTRUCTIONS:
            case this.ATTRIBUTE_LABEL:
            case this.ATTRIBUTE_CHOICES:
            case this.ATTRIBUTE_LAYOUT:
            case this.ATTRIBUTE_NAME:
            case this.ATTRIBUTE_SCALE:
            case this.ATTRIBUTE_STATEMENTS:
            case this.ATTRIBUTE_TEXT:
            case this.ATTRIBUTE_IMAGE:
            case this.ATTRIBUTE_BUTTONS:
            case this.ATTRIBUTE_LAYOUT_SIZE:
            case this.ATTRIBUTE_DEFAULT_VALUE:
            case this.ATTRIBUTE_ACCEPTED_DATES:
            case this.ATTRIBUTE_AGREEMENT_TEXT:
            case this.ATTRIBUTE_HTML_CONTENT:
            case this.ATTRIBUTE_PAGE_TITLE:
            case this.ATTRIBUTE_FACEBOOK_SHARE:
            case this.ATTRIBUTE_DEFAULT_MAP:
            case this.ATTRIBUTE_SUBMIT_BUTTON:
            case this.ATTRIBUTE_RESET_BUTTON:
            case this.ATTRIBUTE_FIELD_NAME:
            case this.ATTRIBUTE_ALT_TEXT:
            case this.ATTRIBUTE_PAYMENTS:
            case this.ATTRIBUTE_URL:
            case this.ATTRIBUTE_CALCULATIONS:
            case this.ATTRIBUTE_ADD_BUTTON:
            case this.ATTRIBUTE_MAPS_API_KEY:
            case this.ATTRIBUTE_FEE_DETAILS:
            case this.ATTRIBUTE_FEE_PRICE:
                break;
            default:
                throw new Error('Invalid argument: attribute ' + JSON.stringify(attributeName) + ' does not exist!');
        }
        if (attributeName === segments[0]) {
            throw new Error('Setting conflict: propertyFQN and attributeName have the same attribute!');
        }
        this.hardcodedPropertyAttributes.push({
            elementTypes: elementTypeIdOrElementTypeIDs,
            propertyFQN: propertyFQN,
            attributeName: attributeName,
        });
    };
    ElementPropertyOrder.getHardcodedPropertyAttributeName = function (propertyFQN, element) {
        var defaultAttribute = propertyFQN.split('.')[0] || null, elementTypeId = element.getTypeId(), matchElementType;
        for (var i = 0, len = this.hardcodedPropertyAttributes.length; i < len; i++) {
            matchElementType = false;
            if (null === this.hardcodedPropertyAttributes[i].elementTypes) {
                matchElementType = true;
            }
            else if (elementTypeId === this.hardcodedPropertyAttributes[i].elementTypes) {
                matchElementType = true;
            }
            else if (this.hardcodedPropertyAttributes[i].elementTypes instanceof Array) {
                matchElementType = this.hardcodedPropertyAttributes[i].elementTypes.indexOf(elementTypeId) > -1;
            }
            if (!matchElementType) {
                continue;
            }
            if (propertyFQN === this.hardcodedPropertyAttributes[i].propertyFQN) {
                return this.hardcodedPropertyAttributes[i].attributeName;
            }
        }
        return defaultAttribute;
    };
    ElementPropertyOrder.ATTRIBUTE_OPTIONS = 'options';
    ElementPropertyOrder.ATTRIBUTE_SIZE = 'size';
    ElementPropertyOrder.ATTRIBUTE_SYNCHRONIZE = 'synchronize';
    ElementPropertyOrder.ATTRIBUTE_PROPAGATE = 'propagate';
    ElementPropertyOrder.ATTRIBUTE_CONFIGURATION = 'configuration';
    ElementPropertyOrder.ATTRIBUTE_VALUE = 'value';
    ElementPropertyOrder.ATTRIBUTE_VALIDATION = 'validation';
    ElementPropertyOrder.ATTRIBUTE_INSTRUCTIONS = 'instructions';
    ElementPropertyOrder.ATTRIBUTE_LABEL = 'label';
    ElementPropertyOrder.ATTRIBUTE_CHOICES = 'choices';
    ElementPropertyOrder.ATTRIBUTE_LAYOUT = 'layout';
    ElementPropertyOrder.ATTRIBUTE_LAYOUT_SIZE = 'layoutSize';
    ElementPropertyOrder.ATTRIBUTE_NAME = 'name';
    ElementPropertyOrder.ATTRIBUTE_DEFAULT_VALUE = 'defaultValue';
    ElementPropertyOrder.ATTRIBUTE_SCALE = 'scale';
    ElementPropertyOrder.ATTRIBUTE_STATEMENTS = 'statements';
    ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES = 'acceptedDates';
    ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT = 'agreementText';
    ElementPropertyOrder.ATTRIBUTE_TEXT = 'text';
    ElementPropertyOrder.ATTRIBUTE_HTML_CONTENT = 'htmlContent';
    ElementPropertyOrder.ATTRIBUTE_IMAGE = 'image';
    ElementPropertyOrder.ATTRIBUTE_PAGE_TITLE = 'pageTitle';
    ElementPropertyOrder.ATTRIBUTE_BUTTONS = 'buttons';
    ElementPropertyOrder.ATTRIBUTE_FACEBOOK_SHARE = 'facebookShare';
    ElementPropertyOrder.ATTRIBUTE_DEFAULT_MAP = 'defaultMap';
    ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON = 'submitButton';
    ElementPropertyOrder.ATTRIBUTE_RESET_BUTTON = 'resetButton';
    ElementPropertyOrder.ATTRIBUTE_URL = 'url';
    ElementPropertyOrder.ATTRIBUTE_FIELD_NAME = 'fieldName';
    ElementPropertyOrder.ATTRIBUTE_ALT_TEXT = 'altText';
    ElementPropertyOrder.ATTRIBUTE_PAYMENTS = 'payments';
    ElementPropertyOrder.ATTRIBUTE_COUPONS = 'coupons';
    ElementPropertyOrder.ATTRIBUTE_CALCULATIONS = 'calculations';
    ElementPropertyOrder.ATTRIBUTE_ADD_BUTTON = 'addButton';
    ElementPropertyOrder.ATTRIBUTE_MAPS_API_KEY = 'mapsApiKey';
    ElementPropertyOrder.ATTRIBUTE_FEE_DETAILS = 'feeDetails';
    ElementPropertyOrder.ATTRIBUTE_FEE_PRICE = 'feePrice';
    ElementPropertyOrder.ORDER_ATTRIBUTE_LABEL = 1;
    ElementPropertyOrder.ORDER_ATTRIBUTE_COUPONS = 1.5;
    ElementPropertyOrder.ORDER_ATTRIBUTE_CALCULATIONS = 1.5;
    ElementPropertyOrder.ORDER_ATTRIBUTE_TEXT = 2;
    ElementPropertyOrder.ORDER_ATTRIBUTE_HTML_CONTENT = 3;
    ElementPropertyOrder.ORDER_ATTRIBUTE_IMAGE = 4;
    ElementPropertyOrder.ORDER_ATTRIBUTE_PAGE_TITLE = 5;
    ElementPropertyOrder.ORDER_ATTRIBUTE_DEFAULT_VALUE = 5;
    ElementPropertyOrder.ORDER_ATTRIBUTE_CHOICES = 7;
    ElementPropertyOrder.ORDER_ATTRIBUTE_SCALE = 8;
    ElementPropertyOrder.ORDER_ATTRIBUTE_STATEMENTS = 9;
    ElementPropertyOrder.ORDER_ATTRIBUTE_DEFAULT_MAP = 10;
    ElementPropertyOrder.ORDER_ATTRIBUTE_MAPS_API_KEY = 10.3;
    ElementPropertyOrder.ORDER_ATTRIBUTE_PAYMENTS = 10.5;
    ElementPropertyOrder.ORDER_ATTRIBUTE_INSTRUCTIONS = 11;
    ElementPropertyOrder.ORDER_ATTRIBUTE_SIZE = 12;
    ElementPropertyOrder.ORDER_ATTRIBUTE_AGREEMENT_TEXT = 13;
    ElementPropertyOrder.ORDER_ATTRIBUTE_VALIDATION = 14;
    ElementPropertyOrder.ORDER_ATTRIBUTE_ACCEPTED_DATES = 15;
    ElementPropertyOrder.ORDER_ATTRIBUTE_BUTTONS = 16;
    ElementPropertyOrder.ORDER_ATTRIBUTE_FACEBOOK_SHARE = 17;
    ElementPropertyOrder.ORDER_ATTRIBUTE_OPTIONS = 18;
    ElementPropertyOrder.ORDER_ATTRIBUTE_NAME = 19;
    ElementPropertyOrder.ORDER_ATTRIBUTE_LAYOUT = 20;
    ElementPropertyOrder.ORDER_ATTRIBUTE_CONFIGURATION = 21;
    ElementPropertyOrder.ORDER_ATTRIBUTE_LAYOUT_SIZE = 22;
    ElementPropertyOrder.ORDER_ATTRIBUTE_SYNCHRONIZE = 23;
    ElementPropertyOrder.ORDER_ATTRIBUTE_PROPAGATE = 24;
    ElementPropertyOrder.ORDER_ATTRIBUTE_VALUE = 25;
    ElementPropertyOrder.ORDER_ATTRIBUTE_SUBMIT_BUTTON = 26;
    ElementPropertyOrder.ORDER_ATTRIBUTE_RESET_BUTTON = 27;
    ElementPropertyOrder.ORDER_ATTRIBUTE_ALT_TEXT = 28;
    ElementPropertyOrder.ORDER_ATTRIBUTE_URL = 29;
    ElementPropertyOrder.ORDER_ATTRIBUTE_FIELD_NAME = 30;
    ElementPropertyOrder.ORDER_ATTRIBUTE_ADD_BUTTON = 32;
    ElementPropertyOrder.ORDER_UNKNOWN_ATTRIBUTE = 50;
    ElementPropertyOrder.hardcodedPropertyOrder = [];
    ElementPropertyOrder.hardcodedPropertyAttributes = [];
    return ElementPropertyOrder;
}());
var ThemePropertyDecorator = (function () {
    function ThemePropertyDecorator() {
    }
    ThemePropertyDecorator.getDecoratedFormProperty = function (property, value) {
        var propertyLabel = this.deduceLabelFromPropertyName(property.name), decoratedProperty = {
            name: property.name,
            type: property.type,
            isColor: false,
            category: 'form',
            categoryI18n: this.CATEGORY_FORM_I18N,
            isAdvanced: false,
            keywords: this.deduceKeywordsFromPropertyName(property.name),
            label: propertyLabel,
            target: this.CATEGORY_FORM,
            value: value,
            i18n: this.deduceI18nPropertyLabelTranslation(property.name),
            keywordsI18n: this.deduceI18nPropertyKeywordsTranslation(property.name),
        };
        switch (property.name) {
            case 'options.labelTextAlignment':
            case 'options.labelPlacement':
                decoratedProperty.category = this.CATEGORY_LABEL;
                decoratedProperty.categoryI18n = this.CATEGORY_LABEL_I18N;
                break;
            case 'options.instructionsPlacement':
            case 'options.instructionsTextAlignment':
                decoratedProperty.category = this.CATEGORY_INSTRUCTIONS;
                decoratedProperty.categoryI18n = this.CATEGORY_INSTRUCTIONS_I18N;
                break;
            case 'options.labelWidthInUnits':
                decoratedProperty.category = this.CATEGORY_FIELD;
                decoratedProperty.categoryI18n = this.CATEGORY_FIELD_I18N;
                break;
        }
        return decoratedProperty;
    };
    ThemePropertyDecorator.getDecoratedThemeProperty = function (property) {
        var decoratedProperty = {
            name: property.name,
            isColor: property.isColor,
            value: property.value,
            category: null,
            categoryI18n: null,
            isAdvanced: null,
            keywords: null,
            label: null,
            target: 'theme',
            type: 'string',
            i18n: null,
            keywordsI18n: null,
        };
        switch (true) {
            case this.FORM_CATEGORY_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_FORM;
                decoratedProperty.categoryI18n = this.CATEGORY_FORM_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.PAGE_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_PAGE;
                decoratedProperty.categoryI18n = this.CATEGORY_PAGE_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.LABEL_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_LABEL;
                decoratedProperty.categoryI18n = this.CATEGORY_LABEL_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.LABEL_ADVANCED_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_LABEL;
                decoratedProperty.categoryI18n = this.CATEGORY_LABEL_I18N;
                decoratedProperty.isAdvanced = true;
                break;
            case this.INSTRUCTIONS_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_INSTRUCTIONS;
                decoratedProperty.categoryI18n = this.CATEGORY_INSTRUCTIONS_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.INSTRUCTIONS_ADVANCED_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_INSTRUCTIONS;
                decoratedProperty.categoryI18n = this.CATEGORY_INSTRUCTIONS_I18N;
                decoratedProperty.isAdvanced = true;
                break;
            case this.INPUT_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_INPUT;
                decoratedProperty.categoryI18n = this.CATEGORY_INPUT_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.FIELD_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_FIELD;
                decoratedProperty.categoryI18n = this.CATEGORY_FIELD_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.FIELD_HOVER_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_FIELD_HOVER;
                decoratedProperty.categoryI18n = this.CATEGORY_FIELD_HOVER_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.FIELD_FOCUS_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_FIELD_FOCUS;
                decoratedProperty.categoryI18n = this.CATEGORY_FIELD_FOCUS_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.ERROR_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_ERROR;
                decoratedProperty.categoryI18n = this.CATEGORY_ERROR_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.BUTTON_CATEGORIES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_BUTTON;
                decoratedProperty.categoryI18n = this.CATEGORY_BUTTON_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.BUTTON_PRIMARY_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_PRIMARY_BUTTON;
                decoratedProperty.categoryI18n = this.CATEGORY_PRIMARY_BUTTON_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.BUTTON_SECONDARY_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_SECONDARY_BUTTON;
                decoratedProperty.categoryI18n = this.CATEGORY_SECONDARY_BUTTON_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.CHOICES_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_CHOICES;
                decoratedProperty.categoryI18n = this.CATEGORY_CHOICES_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            case this.EDITOR_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_EDITOR;
                decoratedProperty.categoryI18n = this.CATEGORY_EDITOR_I18N;
                decoratedProperty.isAdvanced = true;
                break;
            case this.TABLE_PROPERTIES_IN_THEME.indexOf(property.name) > -1:
                decoratedProperty.category = this.CATEGORY_TABLE;
                decoratedProperty.categoryI18n = this.CATEGORY_TABLE_I18N;
                decoratedProperty.isAdvanced = false;
                break;
            default:
                decoratedProperty.isAdvanced = true;
                decoratedProperty.category = this.CATEGORY_OTHER;
                decoratedProperty.categoryI18n = this.CATEGORY_OTHER_I18N;
                break;
        }
        decoratedProperty.i18n = this.deduceI18nPropertyLabelTranslation(decoratedProperty.name);
        decoratedProperty.keywordsI18n = this.deduceI18nPropertyKeywordsTranslation(decoratedProperty.name);
        decoratedProperty.label = this.deduceLabelFromPropertyName(decoratedProperty.name);
        decoratedProperty.keywords = this.deduceKeywordsFromPropertyName(decoratedProperty.name);
        decoratedProperty.name = decoratedProperty.name.replace(/_/g, '.');
        return decoratedProperty;
    };
    ThemePropertyDecorator.deduceKeywordsFromPropertyName = function (propertyName) {
        if (this.THEME_PROPERTIES_LABEL_NAMES[propertyName]
            && this.THEME_PROPERTIES_LABEL_NAMES[propertyName].keywords) {
            return this.THEME_PROPERTIES_LABEL_NAMES[propertyName].keywords;
        }
        else {
            return propertyName.split('_').join(' ');
        }
    };
    ThemePropertyDecorator.deduceLabelFromPropertyName = function (propertyName) {
        if (undefined !== this.THEME_PROPERTIES_LABEL_NAMES[propertyName] && this.THEME_PROPERTIES_LABEL_NAMES[propertyName].text) {
            return this.THEME_PROPERTIES_LABEL_NAMES[propertyName].text;
        }
        else {
            var result = propertyName.split('_');
            for (var i = 0, len = result.length; i < len; i++) {
                result[i] = String(result[i].charAt(0) || '').toUpperCase() + result[i].slice(1);
            }
            return result.join(' ');
        }
    };
    ThemePropertyDecorator.getThemeCategoryIndex = function (category) {
        switch (category) {
            case this.CATEGORY_FORM:
                return this.INDEX_CATEGORY_FORM;
            case this.CATEGORY_PAGE:
                return this.INDEX_CATEGORY_PAGE;
            case this.CATEGORY_LABEL:
                return this.INDEX_CATEGORY_LABEL;
            case this.CATEGORY_INSTRUCTIONS:
                return this.INDEX_CATEGORY_INSTRUCTIONS;
            case this.CATEGORY_INPUT:
                return this.INDEX_CATEGORY_INPUT;
            case this.CATEGORY_FIELD:
                return this.INDEX_CATEGORY_FIELD;
            case this.CATEGORY_FIELD_HOVER:
                return this.INDEX_CATEGORY_FIELD_HOVER;
            case this.CATEGORY_FIELD_FOCUS:
                return this.INDEX_CATEGORY_FIELD_FOCUS;
            case this.CATEGORY_ERROR:
                return this.INDEX_CATEGORY_ERROR;
            case this.CATEGORY_BUTTON:
                return this.INDEX_CATEGORY_BUTTON;
            case this.CATEGORY_PRIMARY_BUTTON:
                return this.INDEX_CATEGORY_PRIMARY_BUTTON;
            case this.CATEGORY_SECONDARY_BUTTON:
                return this.INDEX_CATEGORY_SECONDARY_BUTTON;
            case this.CATEGORY_CHOICES:
                return this.INDEX_CATEGORY_CHOICES;
            case this.CATEGORY_EDITOR:
                return this.INDEX_CATEGORY_EDITOR;
            case this.CATEGORY_TABLE:
                return this.INDEX_CATEGORY_TABLE;
            case this.CATEGORY_OTHER:
            default:
                return this.INDEX_CATEGORY_OTHER;
        }
    };
    ThemePropertyDecorator.getSortedDecoratedThemeProperties = function (properties) {
        return (function (self) {
            var result = properties.sort(function (a, b) {
                var aCategoryIndex = self.getThemeCategoryIndex(a.category), bCategoryIndex = self.getThemeCategoryIndex(b.category);
                if (aCategoryIndex !== bCategoryIndex) {
                    return aCategoryIndex - bCategoryIndex;
                }
                else {
                    var aName = a.name.replace(/\./g, '_'), bName = b.name.replace(/\./g, '_'), aPropertyIndex = ~~(self.THEME_PROPERTIES_LABEL_NAMES[aName] || self.THEME_PROPERTIES_LABEL_NAMES[a.name] || { index: null }).index, bPropertyIndex = ~~(self.THEME_PROPERTIES_LABEL_NAMES[bName] || self.THEME_PROPERTIES_LABEL_NAMES[b.name] || { index: null }).index;
                    return aPropertyIndex - bPropertyIndex;
                }
            });
            return result;
        })(this);
    };
    ThemePropertyDecorator.deduceI18nPropertyLabelTranslation = function (name) {
        return this.THEME_PROPERTIES_LABEL_NAMES[name].i18n || name;
    };
    ThemePropertyDecorator.deduceI18nPropertyKeywordsTranslation = function (name) {
        return this.THEME_PROPERTIES_LABEL_NAMES[name].keywordsI18n || name;
    };
    ThemePropertyDecorator.CATEGORY_FORM = 'form';
    ThemePropertyDecorator.CATEGORY_FORM_I18N = 'edt_theme_UI_category_form';
    ThemePropertyDecorator.INDEX_CATEGORY_FORM = 1;
    ThemePropertyDecorator.CATEGORY_PAGE = 'page';
    ThemePropertyDecorator.CATEGORY_PAGE_I18N = 'edt_theme_UI_category_page';
    ThemePropertyDecorator.INDEX_CATEGORY_PAGE = 2;
    ThemePropertyDecorator.CATEGORY_LABEL = 'label';
    ThemePropertyDecorator.CATEGORY_LABEL_I18N = 'edt_theme_UI_category_label';
    ThemePropertyDecorator.INDEX_CATEGORY_LABEL = 3;
    ThemePropertyDecorator.CATEGORY_INSTRUCTIONS = 'instructions';
    ThemePropertyDecorator.CATEGORY_INSTRUCTIONS_I18N = 'edt_theme_UI_category_instructions';
    ThemePropertyDecorator.INDEX_CATEGORY_INSTRUCTIONS = 4;
    ThemePropertyDecorator.CATEGORY_INPUT = 'input';
    ThemePropertyDecorator.CATEGORY_INPUT_I18N = 'edt_theme_UI_category_input';
    ThemePropertyDecorator.INDEX_CATEGORY_INPUT = 5;
    ThemePropertyDecorator.CATEGORY_FIELD = 'field';
    ThemePropertyDecorator.CATEGORY_FIELD_I18N = 'edt_theme_UI_category_field';
    ThemePropertyDecorator.INDEX_CATEGORY_FIELD = 6;
    ThemePropertyDecorator.CATEGORY_FIELD_HOVER = 'field hover';
    ThemePropertyDecorator.CATEGORY_FIELD_HOVER_I18N = 'edt_theme_UI_category_field_hover';
    ThemePropertyDecorator.INDEX_CATEGORY_FIELD_HOVER = 7;
    ThemePropertyDecorator.CATEGORY_FIELD_FOCUS = 'field focus';
    ThemePropertyDecorator.CATEGORY_FIELD_FOCUS_I18N = 'edt_theme_UI_category_field_focus';
    ThemePropertyDecorator.INDEX_CATEGORY_FIELD_FOCUS = 8;
    ThemePropertyDecorator.CATEGORY_ERROR = 'error';
    ThemePropertyDecorator.CATEGORY_ERROR_I18N = 'edt_theme_UI_category_error';
    ThemePropertyDecorator.INDEX_CATEGORY_ERROR = 9;
    ThemePropertyDecorator.CATEGORY_BUTTON = 'button';
    ThemePropertyDecorator.CATEGORY_BUTTON_I18N = 'edt_theme_UI_category_button';
    ThemePropertyDecorator.INDEX_CATEGORY_BUTTON = 10;
    ThemePropertyDecorator.CATEGORY_PRIMARY_BUTTON = 'primary button';
    ThemePropertyDecorator.CATEGORY_PRIMARY_BUTTON_I18N = 'edt_theme_UI_category_primary_button';
    ThemePropertyDecorator.INDEX_CATEGORY_PRIMARY_BUTTON = 11;
    ThemePropertyDecorator.CATEGORY_SECONDARY_BUTTON = 'secondary button';
    ThemePropertyDecorator.CATEGORY_SECONDARY_BUTTON_I18N = 'edt_theme_UI_category_secondary_button';
    ThemePropertyDecorator.INDEX_CATEGORY_SECONDARY_BUTTON = 12;
    ThemePropertyDecorator.CATEGORY_CHOICES = 'choices';
    ThemePropertyDecorator.CATEGORY_CHOICES_I18N = 'edt_theme_UI_category_choices';
    ThemePropertyDecorator.INDEX_CATEGORY_CHOICES = 13;
    ThemePropertyDecorator.CATEGORY_EDITOR = 'editor';
    ThemePropertyDecorator.CATEGORY_EDITOR_I18N = 'edt_theme_UI_category_editor';
    ThemePropertyDecorator.INDEX_CATEGORY_EDITOR = 14;
    ThemePropertyDecorator.CATEGORY_TABLE = 'table';
    ThemePropertyDecorator.CATEGORY_TABLE_I18N = 'edt_theme_UI_category_table';
    ThemePropertyDecorator.INDEX_CATEGORY_TABLE = 16;
    ThemePropertyDecorator.CATEGORY_OTHER = 'other';
    ThemePropertyDecorator.CATEGORY_OTHER_I18N = 'edt_theme_UI_category_other';
    ThemePropertyDecorator.INDEX_CATEGORY_OTHER = 15;
    ThemePropertyDecorator.THEME_PROPERTIES_LABEL_NAMES = {
        "options.widthUnit": {
            text: 'Form width in',
            index: 1,
            i18n: 'edt_theme_UI_property_options_widthUnit',
            keywords: 'form width',
            keywordsI18n: 'edt_theme_UI_keywords_options_widthUnit'
        },
        "options.widthInPixels": {
            text: 'Form width (px)',
            index: 1,
            i18n: 'edt_theme_UI_property_options_widthInPixels',
            keywords: 'form width',
            keywordsI18n: 'edt_theme_UI_keywords_options_widthInPixels'
        },
        "options.widthInPercents": {
            text: 'Form width (%)',
            index: 1,
            i18n: 'edt_theme_UI_property_options_widthInPercents',
            keywords: 'form width',
            keywordsI18n: 'edt_theme_UI_keywords_options_widthInPercents'
        },
        page_padding_top: {
            text: 'Header padding',
            index: 2,
            i18n: 'edt_theme_UI_property_page_padding_top',
            keywords: 'form header padding',
            keywordsI18n: 'edt_theme_UI_keywords_page_padding_top'
        },
        page_padding_bottom: {
            text: 'Footer padding',
            index: 3,
            i18n: 'edt_theme_UI_property_page_padding_bottom',
            keywords: 'form footer padding',
            keywordsI18n: 'edt_theme_UI_keywords_page_padding_bottom'
        },
        page_padding_left: {
            text: 'Left padding',
            index: 4,
            i18n: 'edt_theme_UI_property_page_padding_left',
            keywords: 'form left padding',
            keywordsI18n: 'edt_theme_UI_keywords_page_padding_left'
        },
        page_padding_right: {
            text: 'Right padding',
            index: 5,
            i18n: 'edt_theme_UI_property_page_padding_right',
            keywords: 'form right padding',
            keywordsI18n: 'edt_theme_UI_keywords_page_padding_right'
        },
        "options.direction": {
            text: 'Form direction',
            index: 6,
            i18n: 'edt_theme_UI_property_options_direction',
            keywords: 'form text direction alignment',
            keywordsI18n: 'edt_theme_UI_keywords_options_direction'
        },
        page_background_color: {
            text: 'Background',
            index: 7,
            i18n: 'edt_theme_UI_property_page_background_color',
            keywords: 'form background color',
            keywordsI18n: 'edt_theme_UI_keywords_page_background_color'
        },
        page_background_image: {
            text: 'Background image',
            index: 8,
            i18n: 'edt_theme_UI_property_page_background_image',
            keywords: 'page background image',
            keywordsI18n: 'edt_theme_UI_keywords_page_background_image',
        },
        page_background_size: {
            text: 'Background size',
            index: 9,
            i18n: 'edt_theme_UI_property_page_background_size',
            keywords: 'page background size',
            keywordsI18n: 'edt_theme_UI_keywords_page_background_size',
        },
        page_background_position: {
            text: 'Background position',
            index: 10,
            i18n: 'edt_theme_UI_property_page_background_position',
            keywords: 'page background position',
            keywordsI18n: 'edt_theme_UI_keywords_page_background_position',
        },
        page_background_repeat: {
            text: 'Background repeat',
            index: 11,
            i18n: 'edt_theme_UI_property_page_background_repeat',
            keywords: 'page background repeat',
            keywordsI18n: 'edt_theme_UI_keywords_page_background_repeat',
        },
        page_background_attachment: {
            text: 'Background fix position',
            index: 12,
            i18n: 'edt_theme_UI_property_page_background_attachment',
            keywords: 'page background scroll',
            keywordsI18n: 'edt_theme_UI_keywords_page_background_attachment',
        },
        page_border_color: {
            text: 'Border',
            index: 13,
            i18n: 'edt_theme_UI_property_page_border_color',
            keywords: 'form border color',
            keywordsI18n: 'edt_theme_UI_keywords_page_border_color'
        },
        page_border_style: {
            text: 'Border style',
            index: 14,
            i18n: 'edt_theme_UI_property_page_border_style',
            keywords: 'form border style',
            keywordsI18n: 'edt_theme_UI_keywords_page_border_style'
        },
        page_border_width: {
            text: 'Border thickness',
            index: 15,
            i18n: 'edt_theme_UI_property_page_border_width',
            keywords: 'form border thickness width',
            keywordsI18n: 'edt_theme_UI_keywords_page_border_width'
        },
        page_shadow_visibility: {
            text: 'Shadow',
            index: 16,
            i18n: 'edt_theme_UI_property_page_shadow_visibility',
            keywords: 'form shadow',
            keywordsI18n: 'edt_theme_UI_keywords_page_shadow_visibility'
        },
        form_color: {
            text: 'Headings color',
            index: 17,
            i18n: 'edt_theme_UI_property_form_color',
            keywords: 'form headings text font color',
            keywordsI18n: 'edt_theme_UI_keywords_form_color'
        },
        colors_selected_color: {
            text: 'Decorations color',
            index: 18,
            i18n: 'edt_theme_UI_property_colors_selected_color',
            keywords: 'form decorations color',
            keywordsI18n: 'edt_theme_UI_keywords_colors_selected_color'
        },
        page_margin_top: {
            text: 'Top padding',
            index: 1,
            i18n: 'edt_theme_UI_property_page_margin_top',
            keywords: 'page top padding',
            keywordsI18n: 'edt_theme_UI_keywords_page_margin_top'
        },
        page_margin_bottom: {
            text: 'Bottom padding',
            index: 2,
            i18n: 'edt_theme_UI_property_page_margin_bottom',
            keywords: 'page bottom padding',
            keywordsI18n: 'edt_theme_UI_keywords_page_margin_bottom'
        },
        form_background_color: {
            text: 'Background',
            index: 3,
            i18n: 'edt_theme_UI_property_form_background_color',
            keywords: 'page background color',
            keywordsI18n: 'edt_theme_UI_keywords_form_background_color'
        },
        form_background_image: {
            text: 'Background image',
            index: 4,
            i18n: 'edt_theme_UI_property_form_background_image',
            keywords: 'page background image',
            keywordsI18n: 'edt_theme_UI_keywords_form_background_image',
        },
        form_background_size: {
            text: 'Background size',
            index: 5,
            i18n: 'edt_theme_UI_property_form_background_size',
            keywords: 'page background size',
            keywordsI18n: 'edt_theme_UI_keywords_form_background_size',
        },
        form_background_position: {
            text: 'Background position',
            index: 6,
            i18n: 'edt_theme_UI_property_form_background_position',
            keywords: 'page background position',
            keywordsI18n: 'edt_theme_UI_keywords_form_background_position',
        },
        form_background_repeat: {
            text: 'Background repeat',
            index: 7,
            i18n: 'edt_theme_UI_property_form_background_repeat',
            keywords: 'page background repeat',
            keywordsI18n: 'edt_theme_UI_keywords_form_background_repeat',
        },
        form_background_attachment: {
            text: 'Background fix position',
            index: 8,
            i18n: 'edt_theme_UI_property_form_background_attachment',
            keywords: 'page background fix position',
            keywordsI18n: 'edt_theme_UI_keywords_form_background_attachment',
        },
        "options.labelPlacement": {
            text: 'Placement',
            index: 1,
            i18n: 'edt_theme_UI_property_options_labelPlacement',
            keywords: 'labels label placement',
            keywordsI18n: 'edt_theme_UI_keywords_options_labelPlacement'
        },
        "options.labelTextAlignment": {
            text: 'Alignment',
            index: 2,
            i18n: 'edt_theme_UI_property_options_labelTextAlignment',
            keywords: 'labels label alignment',
            keywordsI18n: 'edt_theme_UI_keywords_options_labelTextAlignment'
        },
        form_font_family: {
            text: 'Font',
            index: 3,
            i18n: 'edt_theme_UI_property_form_font_family',
            keywords: 'labels label headings text font',
            keywordsI18n: 'edt_theme_UI_keywords_form_font_family'
        },
        form_font_weight: {
            text: 'Font weight',
            index: 4,
            i18n: 'edt_theme_UI_property_form_font_weight',
            keywords: 'labels label headings text font weight',
            keywordsI18n: 'edt_theme_UI_keywords_form_font_weight'
        },
        form_font_style: {
            text: 'Font style',
            index: 5,
            i18n: 'edt_theme_UI_property_form_font_style',
            keywords: 'labels label headings text font style',
            keywordsI18n: 'edt_theme_UI_keywords_form_font_style'
        },
        form_font_size: {
            text: 'Font size',
            index: 6,
            i18n: 'edt_theme_UI_property_form_font_size',
            keywords: 'labels label headings text font size',
            keywordsI18n: 'edt_theme_UI_keywords_form_font_size'
        },
        form_font_line_height: {
            text: 'Font line height',
            index: 7,
            i18n: 'edt_theme_UI_property_form_font_line_height',
            keywords: 'labels label headings text font line height',
            keywordsI18n: 'edt_theme_UI_keywords_form_font_line_height'
        },
        label_normal_color: {
            text: 'Color',
            index: 8,
            i18n: 'edt_theme_UI_property_label_normal_color',
            keywords: 'labels label text font color',
            keywordsI18n: 'edt_theme_UI_keywords_label_normal_color'
        },
        label_padding_top: {
            text: 'Top margin',
            index: 9,
            i18n: 'edt_theme_UI_property_label_padding_top',
            keywords: 'labels label top margin',
            keywordsI18n: 'edt_theme_UI_keywords_label_padding_top'
        },
        label_padding_bottom: {
            text: 'Bottom margin',
            index: 10,
            i18n: 'edt_theme_UI_property_label_padding_bottom',
            keywords: 'labels label bottom margin',
            keywordsI18n: 'edt_theme_UI_keywords_label_padding_bottom'
        },
        label_margin_top: {
            text: 'Advanced margin top',
            index: 11,
            i18n: 'edt_theme_UI_property_label_margin_top',
            keywords: 'labels label advanced top margin',
            keywordsI18n: 'edt_theme_UI_keywords_label_margin_top'
        },
        label_margin_bottom: {
            text: 'Advanced margin bottom',
            index: 12,
            i18n: 'edt_theme_UI_property_label_margin_bottom',
            keywords: 'labels label advanced bottom margin',
            keywordsI18n: 'edt_theme_UI_keywords_label_margin_bottom'
        },
        control_required_star_color: {
            text: 'Required star color',
            index: 13,
            i18n: 'edt_theme_UI_property_control_required_star_color',
            keywords: 'labels label required star color',
            keywordsI18n: 'edt_theme_UI_keywords_control_required_star_color'
        },
        "options.instructionsPlacement": {
            text: 'Placement',
            index: 1,
            i18n: 'edt_theme_UI_property_options_instructionsPlacement',
            keywords: 'instruction instructions placement',
            keywordsI18n: 'edt_theme_UI_keywords_options_instructionsPlacement'
        },
        "options.instructionsTextAlignment": {
            text: 'Alignment',
            index: 2,
            i18n: 'edt_theme_UI_property_options_instructionsTextAlignment',
            keywords: 'instruction instructions alignment',
            keywordsI18n: 'edt_theme_UI_keywords_options_instructionsTextAlignment'
        },
        instructions_font_family: {
            text: 'Font',
            index: 3,
            i18n: 'edt_theme_UI_property_instructions_font_family',
            keywords: 'instruction instructions font',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_font_family'
        },
        instructions_font_weight: {
            text: 'Font weight',
            index: 4,
            i18n: 'edt_theme_UI_property_instructions_font_weight',
            keywords: 'instruction instructions font weight',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_font_weight'
        },
        instructions_font_style: {
            text: 'Font style',
            index: 5,
            i18n: 'edt_theme_UI_property_instructions_font_style',
            keywords: 'instruction instructions font style',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_font_style'
        },
        instructions_font_size: {
            text: 'Font size',
            index: 6,
            i18n: 'edt_theme_UI_property_instructions_font_size',
            keywords: 'instruction instructions font size',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_font_size'
        },
        instructions_font_line_height: {
            text: 'Font line height',
            index: 7,
            i18n: 'edt_theme_UI_property_instructions_font_line_height',
            keywords: 'instruction instructions font line height',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_font_line_height'
        },
        instructions_normal_color: {
            text: 'Color',
            index: 8,
            i18n: 'edt_theme_UI_property_instructions_normal_color',
            keywords: 'instruction instructions text font color',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_normal_color'
        },
        instructions_padding_top: {
            text: 'Top margin',
            index: 9,
            i18n: 'edt_theme_UI_property_instructions_padding_top',
            keywords: 'instruction instructions top margin',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_padding_top'
        },
        instructions_padding_bottom: {
            text: 'Bottom margin',
            index: 10,
            i18n: 'edt_theme_UI_property_instructions_padding_bottom',
            keywords: 'instruction instructions bottom margin',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_padding_bottom'
        },
        instructions_margin_top: {
            text: 'Advanced margin top',
            index: 11,
            i18n: 'edt_theme_UI_property_instructions_margin_top',
            keywords: 'labels label advanced top margin',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_margin_top'
        },
        instructions_margin_bottom: {
            text: 'Advanced margin bottom',
            index: 12,
            i18n: 'edt_theme_UI_property_instructions_margin_bottom',
            keywords: 'labels label advanced bottom margin',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_margin_bottom'
        },
        input_normal_background_color: {
            text: 'Background',
            index: 1,
            i18n: 'edt_theme_UI_property_input_normal_background_color',
            keywords: 'inputs input background color',
            keywordsI18n: 'edt_theme_UI_keywords_input_normal_background_color'
        },
        input_normal_border_color: {
            text: 'Border',
            index: 2,
            i18n: 'edt_theme_UI_property_input_normal_border_color',
            keywords: 'inputs input border color',
            keywordsI18n: 'edt_theme_UI_keywords_input_normal_border_color'
        },
        input_border_style: {
            text: 'Border style',
            index: 3,
            i18n: 'edt_theme_UI_property_input_border_style',
            keywords: 'inputs input border style',
            keywordsI18n: 'edt_theme_UI_keywords_input_border_style'
        },
        input_border_width: {
            text: 'Border thickness',
            index: 4,
            i18n: 'edt_theme_UI_property_input_border_width',
            keywords: 'inputs input border thickness width',
            keywordsI18n: 'edt_theme_UI_keywords_input_border_width'
        },
        input_border_radius: {
            text: 'Border radius',
            index: 5,
            i18n: 'edt_theme_UI_property_input_border_radius',
            keywords: 'inputs input border radius shape',
            keywordsI18n: 'edt_theme_UI_keywords_input_border_radius'
        },
        input_font_family: {
            text: 'Font',
            index: 6,
            i18n: 'edt_theme_UI_property_input_font_family',
            keywords: 'inputs input font',
            keywordsI18n: 'edt_theme_UI_keywords_input_font_family'
        },
        input_font_weight: {
            text: 'Font weight',
            index: 7,
            i18n: 'edt_theme_UI_property_input_font_weight',
            keywords: 'inputs input font weight',
            keywordsI18n: 'edt_theme_UI_keywords_input_font_weight'
        },
        input_font_style: {
            text: 'Font style',
            index: 8,
            i18n: 'edt_theme_UI_property_input_font_style',
            keywords: 'inputs input font style',
            keywordsI18n: 'edt_theme_UI_keywords_input_font_style'
        },
        input_font_size: {
            text: 'Font size',
            index: 9,
            i18n: 'edt_theme_UI_property_input_font_size',
            keywords: 'inputs input font size',
            keywordsI18n: 'edt_theme_UI_keywords_input_font_size'
        },
        input_font_line_height: {
            text: 'Font line height',
            index: 10,
            i18n: 'edt_theme_UI_property_input_font_line_height',
            keywords: 'inputs input font line height',
            keywordsI18n: 'edt_theme_UI_keywords_input_font_line_height'
        },
        input_normal_color: {
            text: 'Text color',
            index: 11,
            i18n: 'edt_theme_UI_property_input_normal_color',
            keywords: 'inputs input text font color',
            keywordsI18n: 'edt_theme_UI_keywords_input_normal_color'
        },
        input_padding_horizontal: {
            text: 'Horizontal padding',
            index: 12,
            i18n: 'edt_theme_UI_property_input_padding_horizontal',
            keywords: 'inputs input horizontal padding',
            keywordsI18n: 'edt_theme_UI_keywords_input_padding_horizontal'
        },
        input_padding_vertical: {
            text: 'Vertical padding',
            index: 13,
            i18n: 'edt_theme_UI_property_input_padding_vertical',
            keywords: 'inputs input vertical padding',
            keywordsI18n: 'edt_theme_UI_keywords_input_padding_vertical'
        },
        container_padding_vertical: {
            text: 'Vertical padding',
            index: 1,
            i18n: 'edt_theme_UI_property_container_padding_vertical',
            keywords: 'fields field vertical padding',
            keywordsI18n: 'edt_theme_UI_keywords_container_padding_vertical'
        },
        container_padding_horizontal: {
            text: 'Horizontal padding',
            index: 2,
            i18n: 'edt_theme_UI_property_container_padding_horizontal',
            keywords: 'fields field horizontal padding',
            keywordsI18n: 'edt_theme_UI_keywords_container_padding_horizontal'
        },
        input_margin_vertical: {
            text: 'Fields spacing',
            index: 3,
            i18n: 'edt_theme_UI_property_input_margin_vertical',
            keywords: 'fields field fields spacing',
            keywordsI18n: 'edt_theme_UI_keywords_input_margin_vertical'
        },
        "options.labelWidthInUnits": {
            text: 'Default label width',
            index: 4,
            i18n: 'edt_theme_UI_property_options_labelWidthInUnits',
            keywords: 'fields field default label width',
            keywordsI18n: 'edt_theme_UI_keywords_options_labelWidthInUnits'
        },
        input_hover_background_color: {
            text: 'Input background',
            index: 1,
            i18n: 'edt_theme_UI_property_input_hover_background_color',
            keywords: 'fields field input background color',
            keywordsI18n: 'edt_theme_UI_keywords_input_hover_background_color'
        },
        input_hover_border_color: {
            text: 'Input border',
            index: 2,
            i18n: 'edt_theme_UI_property_input_hover_border_color',
            keywords: 'fields field input border color',
            keywordsI18n: 'edt_theme_UI_keywords_input_hover_border_color'
        },
        input_hover_color: {
            text: 'Input text color',
            index: 3,
            i18n: 'edt_theme_UI_property_input_hover_color',
            keywords: 'fields field input text font color',
            keywordsI18n: 'edt_theme_UI_keywords_input_hover_color'
        },
        label_hover_color: {
            text: 'Label color',
            index: 4,
            i18n: 'edt_theme_UI_property_label_hover_color',
            keywords: 'fields field label text font color',
            keywordsI18n: 'edt_theme_UI_keywords_label_hover_color'
        },
        instructions_hover_color: {
            text: 'Instructions color',
            index: 5,
            i18n: 'edt_theme_UI_property_instructions_hover_color',
            keywords: 'fields field instructions text font color',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_hover_color'
        },
        input_focused_background_color: {
            text: 'Input background',
            index: 1,
            i18n: 'edt_theme_UI_property_input_focused_background_color',
            keywords: 'fields field focus input background color',
            keywordsI18n: 'edt_theme_UI_keywords_input_focused_background_color'
        },
        input_focused_border_color: {
            text: 'Input border',
            index: 2,
            i18n: 'edt_theme_UI_property_input_focused_border_color',
            keywords: 'fields field focus input border color',
            keywordsI18n: 'edt_theme_UI_keywords_input_focused_border_color'
        },
        input_focused_color: {
            text: 'Input text color',
            index: 3,
            i18n: 'edt_theme_UI_property_input_focused_color',
            keywords: 'fields field focus input text font color',
            keywordsI18n: 'edt_theme_UI_keywords_input_focused_color'
        },
        label_focused_color: {
            text: 'Label color',
            index: 4,
            i18n: 'edt_theme_UI_property_label_focused_color',
            keywords: 'fields field focus label text font color',
            keywordsI18n: 'edt_theme_UI_keywords_label_focused_color'
        },
        instructions_focused_color: {
            text: 'Instructions color',
            index: 5,
            i18n: 'edt_theme_UI_property_instructions_focused_color',
            keywords: 'fields field focus instructions text font color',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_focused_color'
        },
        error_font_family: {
            text: 'Font',
            index: 1,
            i18n: 'edt_theme_UI_property_error_font_family',
            keywords: 'errors error font',
            keywordsI18n: 'edt_theme_UI_keywords_error_font_family'
        },
        error_font_weight: {
            text: 'Font weight',
            index: 2,
            i18n: 'edt_theme_UI_property_error_font_weight',
            keywords: 'errors error font weight',
            keywordsI18n: 'edt_theme_UI_keywords_error_font_weight'
        },
        error_font_style: {
            text: 'Font style',
            index: 3,
            i18n: 'edt_theme_UI_property_error_font_style',
            keywords: 'errors error font style',
            keywordsI18n: 'edt_theme_UI_keywords_error_font_style'
        },
        error_font_size: {
            text: 'Font size',
            index: 4,
            i18n: 'edt_theme_UI_property_error_font_size',
            keywords: 'errors error font size',
            keywordsI18n: 'edt_theme_UI_keywords_error_font_size'
        },
        error_font_line_height: {
            text: 'Font line height',
            index: 5,
            i18n: 'edt_theme_UI_property_error_font_line_height',
            keywords: 'errors error font line height',
            keywordsI18n: 'edt_theme_UI_keywords_error_font_line_height'
        },
        error_normal_color: {
            text: 'Color',
            index: 6,
            i18n: 'edt_theme_UI_property_error_normal_color',
            keywords: 'errors error text font color',
            keywordsI18n: 'edt_theme_UI_keywords_error_normal_color'
        },
        error_padding_top: {
            text: 'Top margin',
            index: 7,
            i18n: 'edt_theme_UI_property_error_padding_top',
            keywords: 'errors error top margin',
            keywordsI18n: 'edt_theme_UI_keywords_error_padding_top'
        },
        error_padding_bottom: {
            text: 'Bottom margin',
            index: 8,
            i18n: 'edt_theme_UI_property_error_padding_bottom',
            keywords: 'errors error bottom margin',
            keywordsI18n: 'edt_theme_UI_keywords_error_padding_bottom'
        },
        input_error_background_color: {
            text: 'Input background',
            index: 9,
            i18n: 'edt_theme_UI_property_input_error_background_color',
            keywords: 'errors error input background color',
            keywordsI18n: 'edt_theme_UI_keywords_input_error_background_color'
        },
        input_error_border_color: {
            text: 'Input border',
            index: 10,
            i18n: 'edt_theme_UI_property_input_error_border_color',
            keywords: 'errors error input border color',
            keywordsI18n: 'edt_theme_UI_keywords_input_error_border_color'
        },
        input_error_color: {
            text: 'Input text color',
            index: 11,
            i18n: 'edt_theme_UI_property_input_error_color',
            keywords: 'errors error input text font color',
            keywordsI18n: 'edt_theme_UI_keywords_input_error_color'
        },
        label_error_color: {
            text: 'Label color',
            index: 12,
            i18n: 'edt_theme_UI_property_label_error_color',
            keywords: 'errors error label text font color',
            keywordsI18n: 'edt_theme_UI_keywords_label_error_color'
        },
        instructions_error_color: {
            text: 'Instructions color',
            index: 13,
            i18n: 'edt_theme_UI_property_instructions_error_color',
            keywords: 'errors error instructions text font color',
            keywordsI18n: 'edt_theme_UI_keywords_instructions_error_color'
        },
        button_border_style: {
            text: 'Border style',
            index: 1,
            i18n: 'edt_theme_UI_property_button_border_style',
            keywords: 'buttons button primary secondary border style',
            keywordsI18n: 'edt_theme_UI_keywords_button_border_style'
        },
        button_border_width: {
            text: 'Border thickness',
            index: 2,
            i18n: 'edt_theme_UI_property_button_border_width',
            keywords: 'buttons button primary secondary border thickness width',
            keywordsI18n: 'edt_theme_UI_keywords_button_border_width'
        },
        button_border_radius: {
            text: 'Border radius',
            index: 3,
            i18n: 'edt_theme_UI_property_button_border_radius',
            keywords: 'buttons button primary secondary border radius shape',
            keywordsI18n: 'edt_theme_UI_keywords_button_border_radius'
        },
        button_font_family: {
            text: 'Font',
            index: 4,
            i18n: 'edt_theme_UI_property_button_font_family',
            keywords: 'buttons button primary secondary font',
            keywordsI18n: 'edt_theme_UI_keywords_button_font_family'
        },
        button_font_weight: {
            text: 'Font weight',
            index: 5,
            i18n: 'edt_theme_UI_property_button_font_weight',
            keywords: 'buttons button primary secondary font weight',
            keywordsI18n: 'edt_theme_UI_keywords_button_font_weight'
        },
        button_font_style: {
            text: 'Font style',
            index: 6,
            i18n: 'edt_theme_UI_property_button_font_style',
            keywords: 'buttons button primary secondary font style',
            keywordsI18n: 'edt_theme_UI_keywords_button_font_style'
        },
        button_font_size: {
            text: 'Font size',
            index: 7,
            i18n: 'edt_theme_UI_property_button_font_size',
            keywords: 'buttons button primary secondary font size',
            keywordsI18n: 'edt_theme_UI_keywords_button_font_size'
        },
        button_font_line_height: {
            text: 'Font line height',
            index: 8,
            i18n: 'edt_theme_UI_property_button_font_line_height',
            keywords: 'buttons button primary secondary font line height',
            keywordsI18n: 'edt_theme_UI_keywords_button_font_line_height'
        },
        button_padding_horizontal: {
            text: 'Horizontal padding',
            index: 9,
            i18n: 'edt_theme_UI_property_button_padding_horizontal',
            keywords: 'buttons button primary secondary horizontal padding',
            keywordsI18n: 'edt_theme_UI_keywords_button_padding_horizontal'
        },
        button_padding_vertical: {
            text: 'Vertical padding',
            index: 10,
            i18n: 'edt_theme_UI_property_button_padding_vertical',
            keywords: 'buttons button primary secondary vertical padding',
            keywordsI18n: 'edt_theme_UI_keywords_button_padding_vertical'
        },
        button_primary_normal_background_color: {
            text: 'Background',
            index: 1,
            i18n: 'edt_theme_UI_property_button_primary_normal_background_color',
            keywords: 'buttons button primary background color',
            keywordsI18n: 'edt_theme_UI_keywords_button_primary_normal_background_color'
        },
        button_primary_normal_border_color: {
            text: 'Border',
            index: 2,
            i18n: 'edt_theme_UI_property_button_primary_normal_border_color',
            keywords: 'buttons button primary border color',
            keywordsI18n: 'edt_theme_UI_keywords_button_primary_normal_border_color'
        },
        button_primary_normal_color: {
            text: 'Text color',
            index: 3,
            i18n: 'edt_theme_UI_property_button_primary_normal_color',
            keywords: 'buttons button primary text font color',
            keywordsI18n: 'edt_theme_UI_keywords_button_primary_normal_color'
        },
        button_primary_hover_background_color: {
            text: 'Hover background',
            index: 4,
            i18n: 'edt_theme_UI_property_button_primary_hover_background_color',
            keywords: 'buttons button primary hover background color',
            keywordsI18n: 'edt_theme_UI_keywords_button_primary_hover_background_color'
        },
        button_primary_hover_border_color: {
            text: 'Hover border',
            index: 5,
            i18n: 'edt_theme_UI_property_button_primary_hover_border_color',
            keywords: 'buttons button primary hover border color',
            keywordsI18n: 'edt_theme_UI_keywords_button_primary_hover_border_color'
        },
        button_primary_hover_color: {
            text: 'Hover text color',
            index: 6,
            i18n: 'edt_theme_UI_property_button_primary_hover_color',
            keywords: 'buttons button primary hover text font color',
            keywordsI18n: 'edt_theme_UI_keywords_button_primary_hover_color'
        },
        button_secondary_normal_background_color: {
            text: 'Background',
            index: 1,
            i18n: 'edt_theme_UI_property_button_secondary_normal_background_color',
            keywords: 'buttons button secondary background color',
            keywordsI18n: 'edt_theme_UI_keywords_button_secondary_normal_background_color'
        },
        button_secondary_normal_border_color: {
            text: 'Border',
            index: 2,
            i18n: 'edt_theme_UI_property_button_secondary_normal_border_color',
            keywords: 'buttons button secondary border color',
            keywordsI18n: 'edt_theme_UI_keywords_button_secondary_normal_border_color'
        },
        button_secondary_normal_color: {
            text: 'Text color',
            index: 3,
            i18n: 'edt_theme_UI_property_button_secondary_normal_color',
            keywords: 'buttons button secondary text font color',
            keywordsI18n: 'edt_theme_UI_keywords_button_secondary_normal_color'
        },
        button_secondary_hover_background_color: {
            text: 'Hover background',
            index: 4,
            i18n: 'edt_theme_UI_property_button_secondary_hover_background_color',
            keywords: 'buttons button secondary hover background color',
            keywordsI18n: 'edt_theme_UI_keywords_button_secondary_hover_background_color'
        },
        button_secondary_hover_border_color: {
            text: 'Hover border',
            index: 5,
            i18n: 'edt_theme_UI_property_button_secondary_hover_border_color',
            keywords: 'buttons button secondary hover border color',
            keywordsI18n: 'edt_theme_UI_keywords_button_secondary_hover_border_color'
        },
        button_secondary_hover_color: {
            text: 'Hover text color',
            index: 6,
            i18n: 'edt_theme_UI_property_button_secondary_hover_color',
            keywords: 'buttons button secondary hover text font color',
            keywordsI18n: 'edt_theme_UI_keywords_button_secondary_hover_color'
        },
        radio_appearance: {
            text: 'Radio shape',
            index: 1,
            i18n: 'edt_theme_UI_property_radio_appearance',
            keywords: 'choice choices radio shape',
            keywordsI18n: 'edt_theme_UI_keywords_radio_appearance'
        },
        radio_width: {
            text: 'Radio width',
            index: 2,
            i18n: 'edt_theme_UI_property_radio_width',
            keywords: 'choice choices radio width',
            keywordsI18n: 'edt_theme_UI_keywords_radio_width'
        },
        radio_height: {
            text: 'Radio height',
            index: 3,
            i18n: 'edt_theme_UI_property_radio_height',
            keywords: 'choice choices radio height',
            keywordsI18n: 'edt_theme_UI_keywords_radio_height'
        },
        radio_margin: {
            text: 'Radio right margin',
            index: 4,
            i18n: 'edt_theme_UI_property_radio_margin',
            keywords: 'choice choices radio right margin',
            keywordsI18n: 'edt_theme_UI_keywords_radio_margin'
        },
        checkbox_width: {
            text: 'Checkbox width',
            index: 5,
            i18n: 'edt_theme_UI_property_checkbox_width',
            keywords: 'choice choices checkbox width',
            keywordsI18n: 'edt_theme_UI_keywords_checkbox_width'
        },
        checkbox_height: {
            text: 'Checkbox height',
            index: 6,
            i18n: 'edt_theme_UI_property_checkbox_height',
            keywords: 'choice choices checkbox height',
            keywordsI18n: 'edt_theme_UI_keywords_checkbox_height'
        },
        checkbox_margin: {
            text: 'Checkbox right margin',
            index: 7,
            i18n: 'edt_theme_UI_property_checkbox_margin',
            keywords: 'choice choices checkbox right margin',
            keywordsI18n: 'edt_theme_UI_keywords_checkbox_margin'
        },
        button_primary_disabled_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        button_primary_disabled_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        button_primary_disabled_color: { text: '', index: 999, i18n: '', keywords: '' },
        button_secondary_disabled_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        button_secondary_disabled_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        button_secondary_disabled_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_border_radius: { text: '', index: 999, i18n: '', keywords: '' },
        control_border_style: { text: '', index: 999, i18n: '', keywords: '' },
        control_border_width: { text: '', index: 999, i18n: '', keywords: '' },
        control_disabled_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_disabled_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_error_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_error_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_focused_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_focused_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_hover_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_hover_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_normal_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_normal_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_selected_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        control_selected_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        input_disabled_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        input_disabled_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        input_disabled_color: { text: '', index: 999, i18n: '', keywords: '' },
        input_selected_background_color: { text: '', index: 999, i18n: '', keywords: '' },
        input_selected_border_color: { text: '', index: 999, i18n: '', keywords: '' },
        input_selected_color: { text: '', index: 999, i18n: '', keywords: '' },
        input_normal_placeholderColor: { text: '', index: 999, i18n: '', keywords: '' },
        instructions_disabled_color: { text: '', index: 999, i18n: '', keywords: '' },
        instructions_selected_color: { text: '', index: 999, i18n: '', keywords: '' },
        label_disabled_color: { text: '', index: 999, i18n: '', keywords: '' },
        label_selected_color: { text: '', index: 999, i18n: '', keywords: '' },
        table_header_background_color: {
            text: 'Header background',
            index: 1,
            i18n: 'edt_theme_UI_property_table_header_background_color',
            keywords: 'table header background color',
            keywordsI18n: 'edt_theme_UI_keywords_table_header_background_color'
        },
    };
    ThemePropertyDecorator.FORM_CATEGORY_PROPERTIES_IN_THEME = [
        'page_padding_top',
        'page_padding_bottom',
        'page_padding_left',
        'page_padding_right',
        'page_background_color',
        'page_border_color',
        'page_border_style',
        'page_border_width',
        'page_shadow_visibility',
        'form_color',
        'colors_selected_color',
        'page_background_image',
        'page_background_position',
        'page_background_repeat',
        'page_background_size',
        'page_background_attachment',
    ];
    ThemePropertyDecorator.PAGE_CATEGORIES_PROPERTIES_IN_THEME = [
        'page_margin_top',
        'page_margin_bottom',
        'form_background_color',
        'form_background_image',
        'form_background_position',
        'form_background_size',
        'form_background_repeat',
        'form_background_attachment',
    ];
    ThemePropertyDecorator.LABEL_CATEGORIES_PROPERTIES_IN_THEME = [
        'label_placement',
        'form_font_family',
        'form_font_weight',
        'form_font_style',
        'form_font_size',
        'form_font_line_height',
        'label_normal_color',
        'label_padding_top',
        'label_padding_bottom',
        'control_required_star_color',
    ];
    ThemePropertyDecorator.LABEL_ADVANCED_CATEGORIES_PROPERTIES_IN_THEME = [
        'label_margin_bottom',
        'label_margin_top',
    ];
    ThemePropertyDecorator.INSTRUCTIONS_CATEGORIES_PROPERTIES_IN_THEME = [
        'instructions_font_family',
        'instructions_font_weight',
        'instructions_font_style',
        'instructions_font_size',
        'instructions_font_line_height',
        'instructions_normal_color',
        'instructions_padding_top',
        'instructions_padding_bottom',
    ];
    ThemePropertyDecorator.INSTRUCTIONS_ADVANCED_CATEGORIES_PROPERTIES_IN_THEME = [
        'instructions_margin_bottom',
        'instructions_margin_top',
    ];
    ThemePropertyDecorator.INPUT_CATEGORIES_PROPERTIES_IN_THEME = [
        'input_normal_background_color',
        'input_normal_border_color',
        'input_border_style',
        'input_border_width',
        'input_border_radius',
        'input_font_family',
        'input_font_weight',
        'input_font_style',
        'input_font_size',
        'input_font_line_height',
        'input_normal_color',
        'input_padding_horizontal',
        'input_padding_vertical',
    ];
    ThemePropertyDecorator.FIELD_CATEGORIES_PROPERTIES_IN_THEME = [
        'container_padding_vertical',
        'container_padding_horizontal',
        'input_margin_vertical',
        'label_width',
    ];
    ThemePropertyDecorator.FIELD_HOVER_CATEGORIES_PROPERTIES_IN_THEME = [
        'input_hover_background_color',
        'input_hover_border_color',
        'input_hover_color',
        'label_hover_color',
        'instructions_hover_color',
    ];
    ThemePropertyDecorator.FIELD_FOCUS_CATEGORIES_PROPERTIES_IN_THEME = [
        'input_focused_background_color',
        'input_focused_border_color',
        'input_focused_color',
        'label_focused_color',
        'instructions_focused_color',
    ];
    ThemePropertyDecorator.ERROR_CATEGORIES_PROPERTIES_IN_THEME = [
        'error_font_family',
        'error_font_weight',
        'error_font_style',
        'error_font_size',
        'error_font_line_height',
        'error_normal_color',
        'error_padding_top',
        'error_padding_bottom',
        'input_error_background_color',
        'input_error_border_color',
        'input_error_color',
        'label_error_color',
        'instructions_error_color',
    ];
    ThemePropertyDecorator.BUTTON_CATEGORIES_PROPERTIES_IN_THEME = [
        'button_border_style',
        'button_border_width',
        'button_font_family',
        'button_font_weight',
        'button_font_style',
        'button_font_size',
        'button_font_line_height',
        'button_padding_horizontal',
        'button_padding_vertical',
        'button_border_radius',
    ];
    ThemePropertyDecorator.BUTTON_PRIMARY_PROPERTIES_IN_THEME = [
        'button_primary_normal_background_color',
        'button_primary_normal_border_color',
        'button_primary_normal_color',
        'button_primary_hover_background_color',
        'button_primary_hover_border_color',
        'button_primary_hover_color',
    ];
    ThemePropertyDecorator.BUTTON_SECONDARY_PROPERTIES_IN_THEME = [
        'button_secondary_normal_background_color',
        'button_secondary_normal_border_color',
        'button_secondary_normal_color',
        'button_secondary_hover_background_color',
        'button_secondary_hover_border_color',
        'button_secondary_hover_color',
    ];
    ThemePropertyDecorator.CHOICES_PROPERTIES_IN_THEME = [
        'radio_appearance',
        'radio_width',
        'radio_height',
        'radio_margin',
        'checkbox_width',
        'checkbox_height',
        'checkbox_margin',
    ];
    ThemePropertyDecorator.EDITOR_PROPERTIES_IN_THEME = [
        'button_primary_disabled_background_color',
        'button_primary_disabled_border_color',
        'button_primary_disabled_color',
        'button_secondary_disabled_background_color',
        'button_secondary_disabled_border_color',
        'button_secondary_disabled_color',
        'control_border_radius',
        'control_border_style',
        'control_border_width',
        'control_disabled_background_color',
        'control_disabled_border_color',
        'control_error_background_color',
        'control_error_border_color',
        'control_focused_background_color',
        'control_focused_border_color',
        'control_hover_background_color',
        'control_hover_border_color',
        'control_normal_background_color',
        'control_normal_border_color',
        'control_selected_background_color',
        'control_selected_border_color',
        'input_disabled_background_color',
        'input_disabled_border_color',
        'input_disabled_color',
        'input_selected_background_color',
        'input_selected_border_color',
        'input_selected_color',
        'input_normal_placeholderColor',
        'instructions_disabled_color',
        'instructions_selected_color',
        'label_disabled_color',
        'label_selected_color',
    ];
    ThemePropertyDecorator.TABLE_PROPERTIES_IN_THEME = [
        'table_header_background_color',
    ];
    return ThemePropertyDecorator;
}());
var EJQLMathOperator;
(function (EJQLMathOperator) {
    EJQLMathOperator[EJQLMathOperator["ADD"] = 0] = "ADD";
    EJQLMathOperator[EJQLMathOperator["SUBSTRACT"] = 1] = "SUBSTRACT";
    EJQLMathOperator[EJQLMathOperator["MULTIPLY"] = 2] = "MULTIPLY";
    EJQLMathOperator[EJQLMathOperator["DIVIDE"] = 3] = "DIVIDE";
})(EJQLMathOperator || (EJQLMathOperator = {}));
var ECSSUnit;
(function (ECSSUnit) {
    ECSSUnit[ECSSUnit["PX"] = 0] = "PX";
    ECSSUnit[ECSSUnit["PERCENT"] = 1] = "PERCENT";
    ECSSUnit[ECSSUnit["EM"] = 2] = "EM";
    ECSSUnit[ECSSUnit["CM"] = 3] = "CM";
    ECSSUnit[ECSSUnit["MM"] = 4] = "MM";
    ECSSUnit[ECSSUnit["IN"] = 5] = "IN";
    ECSSUnit[ECSSUnit["PT"] = 6] = "PT";
})(ECSSUnit || (ECSSUnit = {}));
var CSSEvalExpression = (function () {
    function CSSEvalExpression() {
        this.members = [];
        this.operators = [];
    }
    CSSEvalExpression.prototype.eval = function () {
        if (0 === this.members.length) {
            throw new Error('0 members!');
        }
        if ((this.members.length - this.operators.length) !== 1) {
            throw new Error('Bad number of members / operators');
        }
        while (1 !== this.members.length) {
            var index = null, priority = -1, currentPriority = -1;
            for (var i = 0, len = this.operators.length; i < len; i++) {
                if ((currentPriority = this.getOperatorPriority(this.operators[i])) > priority) {
                    index = i;
                    priority = currentPriority;
                }
            }
            if (index === null) {
                throw new Error('Bug!');
            }
            else {
                this.executeMathOperationAtExpressionPosition(index);
            }
        }
        return this.members[0];
    };
    CSSEvalExpression.prototype.executeMathOperationAtExpressionPosition = function (index) {
        var operandA = this.members[index], operandB = this.members[index + 1], operator = this.operators[index];
        this.members[index] = this.execMath(operandA, operandB, operator);
        this.members.splice(index + 1, 1);
        this.operators.splice(index, 1);
    };
    CSSEvalExpression.prototype.execMath = function (operandA, operandB, operator) {
        var result = {
            value: operandA.value,
            unit: null === operandA.unit
                ? operandB.unit
                : operandA.unit
        };
        if (null !== operandA.unit && null !== operandB.unit && operandA.unit !== operandB.unit) {
            throw new Error('Don\'t know how to do math on "' + this.unitToString(operandA.unit) + '" && "' + this.unitToString(operandB.unit) + '"');
        }
        switch (operator) {
            case EJQLMathOperator.MULTIPLY:
                result.value *= operandB.value;
                break;
            case EJQLMathOperator.DIVIDE:
                result.value /= operandB.value;
                break;
            case EJQLMathOperator.ADD:
                result.value += operandB.value;
                break;
            case EJQLMathOperator.SUBSTRACT:
                result.value -= operandB.value;
                break;
            default:
                throw new Error('Invalid operator!');
        }
        return result;
    };
    CSSEvalExpression.prototype.getOperatorPriority = function (operator) {
        switch (operator) {
            case EJQLMathOperator.ADD:
            case EJQLMathOperator.SUBSTRACT:
                return 1;
            case EJQLMathOperator.DIVIDE:
            case EJQLMathOperator.MULTIPLY:
                return 2;
            default:
                throw new Error('Invalid operator!');
        }
    };
    CSSEvalExpression.prototype.toString = function () {
        var constant = this.eval();
        return 0 === constant.value
            ? '0'
            : String(constant.value) + this.unitToString(constant.unit);
    };
    CSSEvalExpression.prototype.withMember = function (member) {
        this.members.push(member);
        return this;
    };
    CSSEvalExpression.prototype.withOperator = function (operator) {
        this.operators.push(operator);
        return this;
    };
    CSSEvalExpression.prototype.unitToString = function (unit) {
        switch (unit) {
            case null:
                return '';
            case ECSSUnit.CM:
                return 'cm';
            case ECSSUnit.MM:
                return 'mm';
            case ECSSUnit.EM:
                return 'em';
            case ECSSUnit.PX:
                return 'px';
            case ECSSUnit.PT:
                return 'pt';
            case ECSSUnit.IN:
                return 'in';
            case ECSSUnit.PERCENT:
                return '%';
            default:
                throw new Error('Unknown ECSSUnit: ' + unit);
        }
    };
    return CSSEvalExpression;
}());
var CSSExpressionParser = (function () {
    function CSSExpressionParser() {
        this.TOK_OPERATOR = /^[+\-\/\*]/;
        this.TOK_WHITESPACE = /^[\s]+/;
        this.TOK_BRACKET_START = /^(calc)?\(/;
        this.TOK_BRACKET_END = /^\)/;
        this.TOK_NUMBER = /^[-]?\d+(\.\d+)?/;
        this.TOK_CSS_UNIT = /^px|em|%|pt|in|mm|cm/i;
    }
    CSSExpressionParser.prototype.simplifyCSSCalcExpression = function (cssCalcExpression) {
        var buffer = new StringBuffer(cssCalcExpression);
        try {
            return this.parse(buffer).toString();
        }
        catch (e) {
            if (EngineToggles.VERBOSE_CONSOLE) {
                console.log('Simplify CSS ' + JSON.stringify(cssCalcExpression) + ' failed: ' + e.toString());
            }
            return cssCalcExpression;
        }
    };
    CSSExpressionParser.prototype.readOperator = function (buffer) {
        this.readWhitespace(buffer);
        var matches = this.TOK_OPERATOR.exec(buffer.toString());
        if (matches) {
            buffer.consume(1);
            switch (matches[0]) {
                case '+':
                    return EJQLMathOperator.ADD;
                case '-':
                    return EJQLMathOperator.SUBSTRACT;
                case '/':
                    return EJQLMathOperator.DIVIDE;
                case '*':
                    return EJQLMathOperator.MULTIPLY;
            }
        }
        else {
            return null;
        }
    };
    CSSExpressionParser.prototype.readWhitespace = function (buffer) {
        var matches = this.TOK_WHITESPACE.exec(buffer.toString());
        if (matches) {
            buffer.consume(matches[0].length);
        }
    };
    CSSExpressionParser.prototype.readCSSConstant = function (buffer) {
        this.readWhitespace(buffer);
        var matches = this.TOK_NUMBER.exec(buffer.toString());
        if (matches) {
            buffer.consume(matches[0].length);
            var result = {
                value: parseFloat(matches[0]),
                unit: null,
            };
            if (!isFinite(result.value)) {
                throw new Error('Invalid number: ' + matches[0]);
            }
            matches = this.TOK_CSS_UNIT.exec(buffer.toString());
            if (matches) {
                buffer.consume(matches[0].length);
                switch (matches[0].toLowerCase()) {
                    case 'px':
                        result.unit = ECSSUnit.PX;
                        break;
                    case 'pt':
                        result.unit = ECSSUnit.PT;
                        break;
                    case 'em':
                        result.unit = ECSSUnit.EM;
                        break;
                    case 'mm':
                        result.unit = ECSSUnit.MM;
                        break;
                    case 'in':
                        result.unit = ECSSUnit.IN;
                        break;
                    case 'cm':
                        result.unit = ECSSUnit.CM;
                        break;
                    case '%':
                        result.unit = ECSSUnit.PERCENT;
                        break;
                    default:
                        throw new Error('Unknown css unit: ' + matches[0]);
                }
            }
            if (0 === result.value) {
                result.unit = null;
            }
            return result;
        }
        else {
            return null;
        }
    };
    CSSExpressionParser.prototype.readBracketStart = function (buffer) {
        this.readWhitespace(buffer);
        var matches = this.TOK_BRACKET_START.exec(buffer.toString());
        if (matches) {
            buffer.consume(matches[0].length);
            return true;
        }
        return false;
    };
    CSSExpressionParser.prototype.readBracketEnd = function (buffer) {
        this.readWhitespace(buffer);
        var matches = this.TOK_BRACKET_END.exec(buffer.toString());
        if (matches) {
            buffer.consume(matches[0].length);
            return true;
        }
        return false;
    };
    CSSExpressionParser.prototype.readEof = function (buffer, recursionLevel) {
        this.readWhitespace(buffer);
        if (0 === recursionLevel) {
            return '' === buffer.toString();
        }
        else {
            return !!this.TOK_BRACKET_END.exec(buffer.toString());
        }
    };
    CSSExpressionParser.prototype.parse = function (buffer, recursionLevel) {
        if (recursionLevel === void 0) { recursionLevel = 0; }
        var result = new CSSEvalExpression(), constant, addedMember, operator, readNext;
        while (!this.readEof(buffer, recursionLevel)) {
            addedMember = false;
            readNext = false;
            if (this.readBracketStart(buffer)) {
                result.withMember(this.parse(buffer, recursionLevel + 1).eval());
                addedMember = true;
                if (!this.readBracketEnd(buffer)) {
                    throw new Error('")" expected!');
                }
            }
            else {
                if (constant = this.readCSSConstant(buffer)) {
                    result.withMember(constant);
                    addedMember = true;
                }
                else {
                    if (!this.readEof(buffer, recursionLevel)) {
                        throw new Error('Unterminated string');
                    }
                    else {
                        return result;
                    }
                }
            }
            if (addedMember) {
                operator = this.readOperator(buffer);
                if (null !== operator) {
                    result.withOperator(operator);
                    readNext = true;
                }
            }
            else {
                throw new Error('CSS constant expected!');
            }
            if (!readNext) {
                if (!this.readEof(buffer, recursionLevel)) {
                    throw new Error('Unexpected string continuation');
                }
                else {
                    break;
                }
            }
        }
        return result;
    };
    return CSSExpressionParser;
}());
var UI = (function () {
    function UI() {
    }
    UI.createElement = function (elementTypeName, configuration) {
        switch (elementTypeName) {
            case UI.ELEMENT_TYPE_TAGS:
                return new UITagsContainer(configuration);
            case UI.ELEMENT_TYPE_TAGS_LIST:
                return new UITagsListContainer(configuration);
            case UI.ELEMENT_TYPE_SINGLE_TAGS_LIST:
                return new UISingleTagsListContainer(configuration);
            case UI.ELEMENT_TYPE_SEARCHABLE_DROPDOWN:
                if ('' === BrowserDetector.meetsRequirements('* * desktop * *')) {
                    return new UISearchableDropDown();
                }
                else {
                    return new UIDropDown();
                }
            case UI.ELEMENT_TYPE_DROPDOWN:
                return new UIDropDown();
            case UI.ELEMENT_TYPE_COLOR:
                return new UIColorPicker();
            case UI.ELEMENT_TYPE_DATE:
                return new UIDate();
            case UI.ELEMENT_TYPE_TIME:
                return new UITime();
            case UI.ELEMENT_TYPE_FILE:
                return new UIFile();
            case UI.ELEMENT_TYPE_STAR_RATING:
                return new UIStarRating();
            default:
                throw new Error('Unrecognized UI element type: ' + JSON.stringify(elementTypeName));
        }
    };
    UI.withJQuery = function (jq) {
        UI.jq = jq;
    };
    UI.getJQuery = function () {
        return UI.jq;
    };
    UI.withI18n = function (i18n) {
        UI.i18n = i18n;
    };
    UI.getI18n = function () {
        return UI.i18n;
    };
    UI.withResourceManager = function (resourceManager) {
        this.resourceManager = resourceManager;
    };
    UI.getResourceManager = function () {
        return this.resourceManager;
    };
    UI.upgradeDOMNodeFromForm = function (domNode) {
        UI.jq(domNode).find('select').each(function () {
            var replaceNode = UI.createElement(UI.ELEMENT_TYPE_DROPDOWN), opts = this.options;
            replaceNode.setAttribute('data-role', 'i123-input');
            for (var i = 0, len = opts.length; i < len; i++) {
                replaceNode.add(opts[i].cloneNode(true));
            }
            this.parentNode.insertBefore(replaceNode.getRootNode(), this);
            this.parentNode.removeChild(this);
            var nativeDropdown = replaceNode.getRootNode().querySelector('select');
            for (var i = 0, len = this.attributes.length; i < len; i++) {
                nativeDropdown.setAttribute(this.attributes[i].name, this.attributes[i].value);
            }
            nativeDropdown.setAttribute('data-secondary', '');
        });
    };
    UI.ELEMENT_TYPE_SEARCHABLE_DROPDOWN = 'searchable-dropdown';
    UI.ELEMENT_TYPE_DROPDOWN = 'dropdown';
    UI.ELEMENT_TYPE_COLOR = 'color';
    UI.ELEMENT_TYPE_DATE = 'date';
    UI.ELEMENT_TYPE_TIME = 'time';
    UI.ELEMENT_TYPE_FILE = 'file';
    UI.ELEMENT_TYPE_STAR_RATING = 'star-rating';
    UI.ELEMENT_TYPE_TAGS = 'tags';
    UI.ELEMENT_TYPE_TAGS_LIST = 'tags-list';
    UI.ELEMENT_TYPE_SINGLE_TAGS_LIST = 'single-tags-list';
    UI.ELEMENT_TYPE_TAG = 'tag';
    UI.ELEMENT_TYPE_COLLECTION = [
        UI.ELEMENT_TYPE_SEARCHABLE_DROPDOWN,
        UI.ELEMENT_TYPE_DROPDOWN,
        UI.ELEMENT_TYPE_COLOR,
        UI.ELEMENT_TYPE_DATE,
        UI.ELEMENT_TYPE_TIME,
        UI.ELEMENT_TYPE_FILE,
        UI.ELEMENT_TYPE_STAR_RATING,
        UI.ELEMENT_TYPE_TAGS,
        UI.ELEMENT_TYPE_TAGS_LIST,
        UI.ELEMENT_TYPE_SINGLE_TAGS_LIST,
        UI.ELEMENT_TYPE_TAG,
    ];
    return UI;
}());
var InspectorDropdownComponent = (function () {
    function InspectorDropdownComponent() {
        this.rootNode = document.createElement("div");
        this.rootNode.setAttribute("data-role", "dropdown-component");
        this.dropdown = document.createElement("select");
        this.rootNode.appendChild(this.dropdown);
        this.rootNode.appendChild(document.createElement("div"));
    }
    InspectorDropdownComponent.prototype.getRoot = function () {
        return this.rootNode;
    };
    InspectorDropdownComponent.prototype.getSelectedIndex = function () {
        return this.dropdown.selectedIndex;
    };
    InspectorDropdownComponent.prototype.setSelectedIndex = function (selectedIndex) {
        this.dropdown.selectedIndex = selectedIndex;
        return this;
    };
    InspectorDropdownComponent.prototype.addGroup = function (id, name) {
        var group = document.createElement('optgroup');
        group.setAttribute('data-id', id);
        group.setAttribute('label', name);
        this.dropdown.appendChild(group);
        return this;
    };
    InspectorDropdownComponent.prototype.addOption = function (config, afterOption, inGroup, beforeOption) {
        var option = document.createElement('option');
        option.text = config.text;
        option.value = config.value;
        option.disabled = !!config.isSeparator || !!config.disabled;
        option.hidden = !!config.hidden;
        option.setAttribute('data-is-default', config.isDefault);
        if (beforeOption) {
            this.dropdown.add(option, beforeOption.previousSibling);
        }
        else if (afterOption) {
            this.dropdown.add(option, afterOption.nextSibling);
        }
        else {
            if (inGroup) {
                var group = this.dropdown.querySelector("optgroup[data-id=\"" + inGroup + "\"]");
                if (group) {
                    group.appendChild(option);
                }
            }
            else {
                this.dropdown.add(option);
            }
        }
        return this;
    };
    InspectorDropdownComponent.prototype.getOptionByValue = function (value) {
        return _.find(this.dropdown.options, function (option) { return option.value === value; });
    };
    InspectorDropdownComponent.prototype.getOptionAt = function (index) {
        return this.dropdown.options.item(index);
    };
    InspectorDropdownComponent.prototype.removeOption = function (atIndex) {
        this.dropdown.remove(atIndex);
        return this;
    };
    InspectorDropdownComponent.prototype.getValue = function () {
        return this.dropdown.value;
    };
    InspectorDropdownComponent.prototype.setValue = function (newValue) {
        this.dropdown.value = newValue;
        return this;
    };
    InspectorDropdownComponent.prototype.hasValue = function (value) {
        return _.some(this.dropdown.options, function (option) { return option.value === value; });
    };
    InspectorDropdownComponent.prototype.getValues = function () {
        var values = [];
        for (var i = 0, n = this.dropdown.options.length; i < n; i++) {
            values.push(this.dropdown.options[i].value);
        }
        return values;
    };
    InspectorDropdownComponent.prototype.getTexts = function () {
        var texts = [];
        for (var i = 0, n = this.dropdown.options.length; i < n; i++) {
            texts.push(this.dropdown.options[i].text);
        }
        return texts;
    };
    InspectorDropdownComponent.prototype.setValueByText = function (newValue) {
        for (var i = 0, n = this.dropdown.options.length; i < n; i++) {
            if (this.dropdown.options[i].text === newValue) {
                this.dropdown.selectedIndex = i;
                break;
            }
        }
    };
    InspectorDropdownComponent.prototype.getText = function () {
        return this.dropdown.options[this.dropdown.selectedIndex].text;
    };
    InspectorDropdownComponent.prototype.clear = function () {
        while (this.dropdown.options.length) {
            this.dropdown.remove(0);
        }
        var optgroups = this.dropdown.getElementsByTagName('optgroup');
        while (optgroups.length) {
            this.dropdown.removeChild(optgroups[0]);
        }
        return this;
    };
    InspectorDropdownComponent.prototype.setOptions = function (options) {
        this.clear();
        for (var i = 0, len = options.length; i < len; i++) {
            this.addOption(options[i]);
        }
        return this;
    };
    InspectorDropdownComponent.prototype.setSelectedOptionByValue = function (value) {
        this.dropdown.value = value;
    };
    return InspectorDropdownComponent;
}());
var UIElement = (function (_super) {
    __extends(UIElement, _super);
    function UIElement(elementTypeName, elementNodeType) {
        if (elementNodeType === void 0) { elementNodeType = 'div'; }
        var _this = _super.call(this) || this;
        _this.disabled = false;
        _this.readOnly = false;
        _this.elementTypeName = elementTypeName;
        _this.rootNode = document.createElement(elementNodeType);
        _this.rootNode.setAttribute('data-ui-role', 'ui-element');
        _this.rootNode.setAttribute('data-type', elementTypeName);
        _this.rootNode.tabIndex = 0;
        _this.enableSyncMode();
        return _this;
    }
    UIElement.prototype.getElementTypeName = function () {
        return this.elementTypeName;
    };
    UIElement.prototype.getRootNode = function () {
        return this.rootNode;
    };
    UIElement.prototype.isDisabled = function () {
        return this.disabled;
    };
    UIElement.prototype.setDisabled = function (on) {
        on = !!on;
        if (on === this.disabled) {
            return;
        }
        this.disabled = on;
        switch (this.disabled) {
            case true:
                this.rootNode.setAttribute('disabled', 'disabled');
                this.rootNode.tabIndex = null;
                break;
            case false:
                this.rootNode.removeAttribute('disabled');
                this.rootNode.tabIndex = 0;
                break;
        }
    };
    UIElement.prototype.isReadOnly = function () {
        return this.readOnly;
    };
    UIElement.prototype.setReadOnly = function (on) {
        on = !!on;
        if (on === this.readOnly) {
            return;
        }
        this.readOnly = on;
        switch (this.readOnly) {
            case true:
                this.rootNode.setAttribute('readonly', 'readonly');
                break;
            case false:
                this.rootNode.removeAttribute('readonly');
                break;
        }
    };
    UIElement.prototype.getAttribute = function (attributeName) {
        return this.rootNode.getAttribute(attributeName);
    };
    UIElement.prototype.setAttribute = function (attributeName, value) {
        this.rootNode.setAttribute(attributeName, value);
    };
    UIElement.prototype.hasAttribute = function (attributeName) {
        return this.rootNode.hasAttribute(attributeName);
    };
    UIElement.prototype.removeAttribute = function (attributeName) {
        this.rootNode.removeAttribute(attributeName);
    };
    UIElement.prototype.getId = function () {
        return this.rootNode.id;
    };
    UIElement.prototype.setId = function (newId) {
        this.rootNode.id = String(newId || '');
    };
    UIElement.prototype.append = function (targetElement, position) {
        switch (position) {
            case UIElement.APPEND_POSITION_BEFORE:
                targetElement.insertAdjacentElement('beforebegin', this.rootNode);
                break;
            case UIElement.APPEND_POSITION_AFTER:
                targetElement.insertAdjacentElement('afterend', this.rootNode);
                break;
            case UIElement.APPEND_POSITION_INSIDE:
            default:
                targetElement.insertAdjacentElement('beforeend', this.rootNode);
        }
        this.trigger('append');
    };
    UIElement.prototype.replace = function (targetElement) {
        targetElement.parentNode.replaceChild(this.rootNode, targetElement);
        this.trigger('replace');
    };
    UIElement.prototype.insert = function (targetElement) {
        var children = targetElement.childNodes, caret = new Caret(targetElement), initialCaretPosition = caret.position(), calculatedCaretPosition = initialCaretPosition, targetTextNode = null, i = 0, len = children.length;
        for (; i < len; i++) {
            var childTextLength = children[i].textContent.length;
            if (calculatedCaretPosition >= childTextLength) {
                calculatedCaretPosition -= childTextLength;
                continue;
            }
            targetTextNode = children[i];
            break;
        }
        if (null !== targetTextNode) {
            this.disableEvents();
            if (targetTextNode.nodeType === Node.TEXT_NODE) {
                this.replace(targetTextNode);
                var textPartOne = targetTextNode.textContent.substr(0, calculatedCaretPosition), textPartTwo = targetTextNode.textContent.substr(calculatedCaretPosition);
                if (undefined === children[i - 1] || children[i - 1].nodeType !== Node.TEXT_NODE) {
                    this.rootNode.insertAdjacentText('beforebegin', textPartOne);
                    i++;
                }
                else if (children[i - 1].nodeType === Node.TEXT_NODE) {
                    children[i - 1].nodeValue = textPartOne + children[i - 1].nodeValue;
                }
                if (undefined === children[i + 1] || children[i + 1].nodeType !== Node.TEXT_NODE) {
                    this.rootNode.insertAdjacentText('afterend', textPartTwo);
                }
                else if (children[i + 1].nodeType === Node.TEXT_NODE) {
                    children[i + 1].nodeValue += textPartTwo;
                }
            }
            else {
                this.append(targetTextNode, UIElement.APPEND_POSITION_BEFORE);
            }
            this.enableEvents();
        }
        else {
            this.append(targetElement, UIElement.APPEND_POSITION_INSIDE);
        }
        this.trigger('insert');
    };
    UIElement.prototype.delete = function () {
        this.rootNode.parentNode && this.rootNode.parentNode.removeChild(this.rootNode);
        this.trigger('delete');
    };
    UIElement.APPEND_POSITION_INSIDE = 0;
    UIElement.APPEND_POSITION_BEFORE = 1;
    UIElement.APPEND_POSITION_AFTER = 2;
    UIElement.APPEND_POSITION_REPLACE = 3;
    UIElement.APPEND_POSITION_AT_CURSOR = 4;
    return UIElement;
}(EventEmitter));
var UISearchableDropDown = (function (_super) {
    __extends(UISearchableDropDown, _super);
    function UISearchableDropDown() {
        var _this = _super.call(this, UI.ELEMENT_TYPE_SEARCHABLE_DROPDOWN) || this;
        _this.options = [];
        _this.selectedIndex = -1;
        _this.opened = false;
        _this.userFilter = null;
        _this.selectedIndexBeforeOpen = -1;
        _this.caption = document.createElement('input');
        _this.caption.setAttribute('type', 'text');
        _this.caption.setAttribute('autocomplete', 'none');
        _this.expander = document.createElement('button');
        _this.rootNode.appendChild(_this.caption);
        _this.rootNode.appendChild(_this.expander);
        _this.overlay = document.createElement('div');
        _this.overlay.setAttribute('data-role', 'dropdown-overlay');
        _this.overlayModal = document.createElement('div');
        _this.overlayModal.className = 'ui-modal';
        _this.overlayModal.setAttribute('data-transparent', '1');
        _this.init();
        return _this;
    }
    UISearchableDropDown.prototype.getSelectedIndex = function () {
        return this.selectedIndex;
    };
    UISearchableDropDown.prototype.add = function (option, index) {
        if (!option) {
            throw new Error('Invalid argument: option: IUIOption expected!');
        }
        var castedOption = option instanceof HTMLOptionElement
            ? UIDropDownOption.createFromHTMLOptionElement(this, option)
            : option;
        if (undefined === index) {
            this.options.push(castedOption);
        }
        else {
            if (index < 0 || index > this.options.length) {
                throw new Error('Invalid argument: index: int >= 0 <= ' + this.options.length + ' expected');
            }
            this.options.splice(index, 0, castedOption);
        }
        if (this.isOpened()) {
            this.userFilter = null;
            this.refreshOptions();
            this.setSelectedIndex(-1);
        }
        else {
            if (this.selectedIndex === -1) {
                this.setSelectedIndex(0);
            }
        }
    };
    UISearchableDropDown.prototype.remove = function (index) {
        if (null === index || index < 0 || index >= this.options.length) {
            throw new Error('Invalid argument index: int >= 0 < ' + this.options.length + ' expected!');
        }
        this.options.splice(index, 1);
        if (this.isOpened()) {
            this.userFilter = null;
            this.refreshOptions();
            this.selectedIndex = undefined;
            this.setSelectedIndex(Math.max(-1, this.options.length ? 0 : -1));
        }
        else {
            this.selectedIndex = undefined;
            this.setSelectedIndex(Math.max(-1, this.options.length ? 0 : -1));
        }
    };
    UISearchableDropDown.prototype.getValue = function () {
        if (this.selectedIndex === -1) {
            return null;
        }
        else {
            return this.options[this.selectedIndex].value;
        }
    };
    UISearchableDropDown.prototype.setValue = function (value) {
        var newIndex = -1;
        for (var i = 0, len = this.options.length; i < len; i++) {
            if (value === this.options[i].value) {
                newIndex = i;
                break;
            }
        }
        this.setSelectedIndex(newIndex);
    };
    UISearchableDropDown.prototype.setSelectedIndex = function (newSelectedIndex) {
        newSelectedIndex = ~~newSelectedIndex;
        if (newSelectedIndex < -1) {
            newSelectedIndex = -1;
        }
        if (newSelectedIndex >= this.options.length) {
            newSelectedIndex = this.options.length - 1;
        }
        if (!this.options[newSelectedIndex] || this.options[newSelectedIndex].hasAttribute('disabled')) {
            newSelectedIndex = -1;
        }
        if (newSelectedIndex === this.selectedIndex) {
            return;
        }
        this.selectedIndex = this.selectedIndexBeforeOpen = newSelectedIndex;
        this.userFilter = null;
        this.caption.value = String(-1 === this.selectedIndex
            ? ''
            : this.options[this.selectedIndex].text);
        if (this.options[this.selectedIndex]) {
            if (!this.selectedIndex &&
                !this.options[this.selectedIndex].value
                && this.caption.hasAttribute('placeholder')) {
                this.caption.value = '';
            }
            else {
                if (this.options[this.selectedIndex].hasAttribute('data-i18n-text')) {
                    if (UI.getI18n()) {
                        var key = this.options[this.selectedIndex].getAttribute('data-i18n-text'), newText = UI.getI18n().translateText(key);
                        if (newText && newText !== key) {
                            this.caption.value = newText;
                        }
                    }
                }
            }
        }
        this.updateSelectedIndexInOverlay();
        this.trigger('change');
        UI.getJQuery()(this.rootNode).trigger('change');
    };
    UISearchableDropDown.prototype.isOpened = function () {
        return this.opened;
    };
    UISearchableDropDown.prototype.refreshOptions = function () {
        var optionElement;
        this.overlay.innerHTML = '';
        for (var i = 0, len = this.options.length; i < len; i++) {
            optionElement = document.createElement('div');
            optionElement.setAttribute('data-index', String(i));
            optionElement.textContent = this.options[i].text;
            if (this.options[i].hasAttribute('disabled')) {
                (optionElement).setAttribute('data-is-disabled', 'true');
            }
            if (this.options[i].hasAttribute('data-i18n-text')) {
                (optionElement).setAttribute('data-i18n-text', this.options[i].getAttribute('data-i18n-text'));
            }
            if (this.options[i].hasAttribute('data-i18n-placeholder')) {
                (optionElement).setAttribute('data-i18n-placeholder', this.options[i].getAttribute('data-i18n-placeholder'));
            }
            this.overlay.appendChild(optionElement);
        }
        if (UI.getI18n()) {
            UI.getI18n().translateDOMNode(this.overlay);
        }
        document.body.appendChild(this.overlayModal);
    };
    UISearchableDropDown.prototype.setOpened = function (opened) {
        opened = !!opened;
        if (opened === this.opened) {
            return;
        }
        this.opened = opened;
        if (this.opened) {
            this.selectedIndexBeforeOpen = this.selectedIndex;
        }
        if (this.areAllOptionsHiddenByUserFilter()) {
            this.userFilter = null;
            this.removeHiddenAttributeFromAllDOMOptions();
            this.overlay.removeAttribute('empty');
            this.setSelectedIndex(!this.opened ? this.selectedIndexBeforeOpen : this.selectedIndex);
        }
        switch (this.opened) {
            case true:
                this.rootNode.setAttribute('data-is-opened', '1');
                var captionComputedStyle = FormUtils.getComputedStyle(this.caption);
                if (captionComputedStyle && captionComputedStyle.direction === 'rtl') {
                    this.overlay.style.direction = 'rtl';
                }
                else {
                    this.overlay.style.direction = '';
                }
                this.caption.value = '';
                if (UI.getI18n()) {
                    UI.getI18n().translateDOMNode(this.overlay);
                }
                break;
            case false:
                this.rootNode.removeAttribute('data-is-opened');
                this.caption.value = -1 === this.selectedIndex
                    ? ''
                    : this.options[this.selectedIndex].text;
                if (this.options[this.selectedIndex]) {
                    if (!this.selectedIndex
                        && !this.options[this.selectedIndex].value
                        && this.caption.hasAttribute('placeholder')) {
                        this.caption.value = '';
                    }
                    else {
                        if (this.options[this.selectedIndex].hasAttribute('data-i18n-text')) {
                            if (UI.getI18n()) {
                                var key = this.options[this.selectedIndex].getAttribute('data-i18n-text'), newText = UI.getI18n().translateText(key);
                                if (newText && newText !== key) {
                                    this.caption.value = newText;
                                }
                            }
                        }
                    }
                }
                break;
        }
        if (!this.opened) {
            this.overlay.parentNode.removeChild(this.overlay);
            this.overlayModal.parentNode.removeChild(this.overlayModal);
            this.overlay.innerHTML = '';
            document.body.removeEventListener('mousedown', this.bodyMouseDownEventListener, true);
            return;
        }
        this.refreshOptions();
        document.body.appendChild(this.overlay);
        this.reanchorOverlayElement();
        document.body.addEventListener('mousedown', this.bodyMouseDownEventListener, true);
        this.updateSelectedIndexInOverlay();
    };
    UISearchableDropDown.prototype.reanchorOverlayElement = function () {
        var dropDownClientRect = this.rootNode.getBoundingClientRect();
        this.overlay.style.width = dropDownClientRect.width + "px";
        var overlayClientRect = this.overlay.getBoundingClientRect(), overlayPosition = ElementPosition.getAnchorPosition(dropDownClientRect, overlayClientRect, 0, ['center-bottom', 'center-top',]);
        this.overlay.style.left = overlayPosition.left + "px";
        this.overlay.style.top = overlayPosition.top + "px";
    };
    UISearchableDropDown.prototype.updateSelectedIndexInOverlay = function () {
        if (!this.opened) {
            return;
        }
        for (var i = 0, nodes = this.overlay.childNodes, len = nodes.length; i < len; i++) {
            if (i === this.selectedIndex) {
                nodes[i].setAttribute('selected', 'selected');
                UISearchableDropDown.scrollOptionIntoView(nodes[i]);
            }
            else {
                nodes[i].removeAttribute('selected');
            }
        }
    };
    UISearchableDropDown.prototype.removeHiddenAttributeFromAllDOMOptions = function () {
        for (var i = 0, domNodes = this.overlay.childNodes, len = domNodes.length; i < len; i++) {
            this.overlay.childNodes[i].removeAttribute('hidden');
        }
    };
    UISearchableDropDown.prototype.filterOptionsInOverlay = function () {
        if (!this.isOpened()) {
            this.setOpened(true);
        }
        var wasFirstOptionSelected = false, shouldSetSelectedIndex = false, wasSelectedIndexSet = false, areAllOptionsFiltered = true;
        for (var i = 0, domNodes = this.overlay.childNodes, len = domNodes.length; i < len; i++) {
            if (this.overlay.childNodes[i] === this.overlayModal) {
                continue;
            }
            if (null === this.userFilter || '' === this.userFilter) {
                areAllOptionsFiltered = false;
                domNodes[i].removeAttribute('hidden');
                if (!wasFirstOptionSelected) {
                    wasFirstOptionSelected = shouldSetSelectedIndex = true;
                }
                else {
                    domNodes[i].removeAttribute('selected');
                }
            }
            else {
                if (String(this.options[i].text || '').toLowerCase().indexOf(this.userFilter) > -1) {
                    areAllOptionsFiltered = false;
                    domNodes[i].removeAttribute('hidden');
                    if (!wasFirstOptionSelected) {
                        wasFirstOptionSelected = shouldSetSelectedIndex = true;
                    }
                    else {
                        domNodes[i].removeAttribute('selected');
                    }
                }
                else {
                    domNodes[i].setAttribute('hidden', 'hidden');
                    domNodes[i].removeAttribute('selected');
                }
            }
            if (shouldSetSelectedIndex) {
                this.selectedIndex = i;
                domNodes[i].setAttribute('selected', 'selected');
                wasSelectedIndexSet = true;
                shouldSetSelectedIndex = false;
                UISearchableDropDown.scrollOptionIntoView(domNodes[i]);
            }
            if (areAllOptionsFiltered) {
                this.overlay.setAttribute('empty', 'empty');
            }
            else {
                this.overlay.removeAttribute('empty');
            }
        }
        if (!wasSelectedIndexSet) {
            this.selectedIndex = -1;
        }
        this.reanchorOverlayElement();
    };
    UISearchableDropDown.prototype.cycleSelectedOption = function (direction) {
        if (!this.isOpened()) {
            this.setOpened(true);
        }
        var numberOfCycledItems = 0, numberOfOptions = this.options.length, optionNodes = this.overlay.childNodes, newSelectedIndex = null, currentOptionIndex;
        if (numberOfOptions === 0) {
            return;
        }
        if (-1 === this.selectedIndex) {
            if (direction === -1) {
                currentOptionIndex = 0;
            }
            else {
                currentOptionIndex = numberOfOptions - 1;
            }
        }
        else {
            currentOptionIndex = this.selectedIndex;
        }
        var isDisabled, isHidden;
        do {
            currentOptionIndex += direction;
            if (currentOptionIndex < 0) {
                currentOptionIndex = numberOfOptions - 1;
            }
            else if (currentOptionIndex >= numberOfOptions) {
                currentOptionIndex = 0;
            }
            numberOfCycledItems++;
            if (this.options[currentOptionIndex]) {
                isDisabled = this.options[currentOptionIndex].hasAttribute('disabled');
                isHidden = optionNodes[currentOptionIndex].hasAttribute('hidden');
                if (!(isDisabled || isHidden)) {
                    newSelectedIndex = currentOptionIndex;
                }
            }
        } while (numberOfCycledItems <= numberOfOptions
            && (isDisabled || isHidden));
        if (null !== newSelectedIndex) {
            this.setSelectedIndex(newSelectedIndex);
        }
    };
    UISearchableDropDown.prototype.areAllOptionsHiddenByUserFilter = function () {
        if (null === this.userFilter || '' === this.userFilter) {
            return false;
        }
        for (var i = 0, opts = this.options || [], len = opts.length; i < len; i++) {
            if (String(opts[i].text || '').toLowerCase().indexOf(this.userFilter) > -1) {
                return false;
            }
        }
        return true;
    };
    UISearchableDropDown.prototype.init = function () {
        (function ($, self) {
            self.on('update', function () {
                self.caption.value = String(-1 === self.selectedIndex ? '' : self.options[self.selectedIndex].text);
            });
            $(self.caption).on('focus', function () {
                $(self.rootNode).attr('data-is-focused-child-element', '1');
            });
            $(self.caption).on('blur', function () {
                $(self.rootNode).removeAttr('data-is-focused-child-element');
            });
            Object.defineProperty(self.rootNode, 'selectedIndex', {
                get: function () {
                    return self.getSelectedIndex();
                },
                set: function (index) {
                    self.setSelectedIndex(index);
                }
            });
            Object.defineProperty(self.rootNode, 'value', {
                get: function () {
                    return self.getValue();
                },
                set: function (value) {
                    self.setValue(String(value || ''));
                }
            });
            Object.defineProperty(self.rootNode, 'disabled', {
                get: function () {
                    return self.isDisabled();
                },
                set: function (value) {
                    self.setDisabled(!!value);
                }
            });
            Object.defineProperty(self.rootNode, 'readOnly', {
                get: function () {
                    return self.isReadOnly();
                },
                set: function (readOnly) {
                    self.setReadOnly(!!readOnly);
                }
            });
            Object.defineProperty(self.rootNode, 'add', {
                'get': function () {
                    return function () {
                        self.add.apply(self, arguments);
                    };
                }
            });
            Object.defineProperty(self.rootNode, 'remove', {
                'get': function () {
                    return function () {
                        self.remove.apply(self, arguments);
                    };
                }
            });
            Object.defineProperty(self.rootNode, 'placeholder', {
                'get': function () {
                    return function () {
                        self.getPlaceholder.apply(self, arguments);
                    };
                },
                'set': function (placeholder) {
                    return function () {
                        self.setPlaceholder.apply(self, arguments);
                    };
                }
            });
            self.expander.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                if (undefined !== e.pageX && undefined !== e.pageY) {
                    if (0 === e.pageX && 0 === e.pageY) {
                        return;
                    }
                }
                self.caption && (self.caption).focus();
                self.setOpened(!self.isOpened());
            }, true);
            $(self.caption).on('click', function () {
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                self.setOpened(true);
            });
            $(self.caption).on('blur', function () {
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                self.setOpened(false);
            });
            $(self.caption).on('keydown', function (e) {
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                var keyCode = e.keyCode || e.charCode, cyclingDirection = null;
                switch (keyCode) {
                    case KeyboardUtils.KEY_DOWN:
                        cyclingDirection = 1;
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                    case KeyboardUtils.KEY_UP:
                        cyclingDirection = -1;
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                    case KeyboardUtils.KEY_ESC:
                        if (self.isOpened()) {
                            self.setOpened(false);
                        }
                        e.preventDefault();
                        e.stopPropagation();
                        return;
                    case KeyboardUtils.KEY_ENTER:
                        if (self.isOpened()) {
                            var currentSelectedIndex = self.getSelectedIndex();
                            if (!self.optionIsDisabled(self.overlay.childNodes[currentSelectedIndex])) {
                                self.setOpened(false);
                                self.selectedIndex = undefined;
                                self.setSelectedIndex(currentSelectedIndex);
                            }
                        }
                        else {
                            self.setOpened(true);
                        }
                        e.preventDefault();
                        e.stopPropagation();
                        return;
                    case KeyboardUtils.KEY_HOME:
                        self.selectedIndex = -1;
                        cyclingDirection = 1;
                        self.userFilter = null;
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                    case KeyboardUtils.KEY_END:
                        self.selectedIndex = -1;
                        cyclingDirection = -1;
                        self.userFilter = null;
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                    default:
                }
                if (null !== cyclingDirection) {
                    e.preventDefault();
                    e.stopPropagation();
                    self.cycleSelectedOption(cyclingDirection);
                }
            });
            $(self.overlay).on('click', '> div[data-index]', function (e) {
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                if (!self.optionIsDisabled(this)) {
                    self.setOpened(false);
                }
            });
            $(self.caption).on('input', function (e) {
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                try {
                    if (document.activeElement !== self.caption) {
                        return;
                    }
                }
                catch (e) { }
                self.userFilter = this.value.toLowerCase();
                self.filterOptionsInOverlay();
            });
            self.bodyMouseDownEventListener = function (e) {
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                var eventTarget = e.target || e.srcElement;
                if ($(eventTarget).is('body > [data-role=dropdown-overlay] > div[data-index]')
                    || eventTarget === self.caption
                    || eventTarget === self.expander) {
                    e.preventDefault();
                    e.stopPropagation();
                    var selectedIndex = ~~$(eventTarget).attr('data-index');
                    if (self.options[selectedIndex] && self.options[selectedIndex].hasAttribute('disabled')) {
                        return;
                    }
                    self.setSelectedIndex(selectedIndex);
                    self.setOpened(false);
                }
                else {
                    if ($(eventTarget).is('body > [data-role=dropdown-overlay]')) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    else {
                        self.setOpened(false);
                    }
                }
            };
            $(window).on('scroll', function () {
                if (self.isOpened()) {
                    self.setOpened(false);
                }
            });
        })(UI.getJQuery(), this);
    };
    UISearchableDropDown.prototype.setDisabled = function (disabledState) {
        _super.prototype.setDisabled.call(this, disabledState);
        this.caption.disabled = this.expander.disabled = this.isDisabled();
        if (this.isDisabled() && this.isOpened()) {
            this.setOpened(false);
        }
    };
    UISearchableDropDown.prototype.setReadOnly = function (readOnlyState) {
        _super.prototype.setReadOnly.call(this, readOnlyState);
        this.caption.readOnly = this.isReadOnly();
        if (this.isReadOnly() && this.isOpened()) {
            this.setOpened(false);
        }
    };
    UISearchableDropDown.prototype.getOptions = function () {
        return this.options;
    };
    UISearchableDropDown.prototype.setPlaceholder = function (placeholder) {
        this.caption.placeholder = String(placeholder || '');
    };
    UISearchableDropDown.prototype.getPlaceholder = function () {
        return this.caption.placeholder || null;
    };
    UISearchableDropDown.prototype.setAttribute = function (attributeName, attributeValue) {
        switch (attributeName) {
            case 'data-i18n-placeholder':
            case 'placeholder':
                this.caption.setAttribute(attributeName, attributeValue);
                break;
            default:
                _super.prototype.setAttribute.call(this, attributeName, attributeValue);
                break;
        }
    };
    UISearchableDropDown.prototype.optionIsDisabled = function (option) {
        var currentIndex = option.getAttribute('data-index');
        return this.options[currentIndex].hasAttribute('disabled');
    };
    UISearchableDropDown.scrollOptionIntoView = function (optionNode) {
        optionNode.parentNode.scrollTop = optionNode.offsetTop;
    };
    return UISearchableDropDown;
}(UIElement));
var UIDropDown = (function (_super) {
    __extends(UIDropDown, _super);
    function UIDropDown() {
        var _this = _super.call(this, UI.ELEMENT_TYPE_DROPDOWN) || this;
        _this.initSelectedIndex = null;
        _this.nativeDropDown = document.createElement('select');
        _this.rootNode.appendChild(_this.nativeDropDown);
        _this.selectedOption = document.createElement('div');
        _this.selectedOption.setAttribute('data-role', 'dropdown-skin');
        _this.rootNode.appendChild(_this.selectedOption);
        _this.updateSelectedOptionThrottled = Throttle.create(function () {
            _this.updateSelectedOption();
        }, 0);
        _this.rootNode.removeAttribute('tabindex');
        _this.init();
        return _this;
    }
    UIDropDown.prototype.getValue = function () {
        return this.nativeDropDown.value;
    };
    UIDropDown.prototype.setValue = function (newValue) {
        var currentIndex = this.nativeDropDown.selectedIndex;
        this.nativeDropDown.value = newValue;
        this.updateSelectedOptionThrottled();
        if (currentIndex !== this.nativeDropDown.selectedIndex) {
            UI.getJQuery()(this.rootNode).trigger('change');
        }
    };
    UIDropDown.prototype.getSelectedIndex = function () {
        return this.nativeDropDown.selectedIndex;
    };
    UIDropDown.prototype.setSelectedIndex = function (selectedIndex) {
        this.nativeDropDown.selectedIndex = selectedIndex;
        this.updateSelectedOptionThrottled();
    };
    UIDropDown.prototype.add = function (option, index) {
        if (!option) {
            throw new Error('Invalid argument: option: IUIOption|HTMLOptionElement expected!');
        }
        var castedOption = option instanceof HTMLOptionElement
            ? option
            : option.convertToHTMLOptionElement();
        if (castedOption !== option) {
            castedOption.text = option.text;
            castedOption.value = option.value;
        }
        this.nativeDropDown.add(castedOption, index);
        if (castedOption.hasAttribute('selected')) {
            this.initSelectedIndex = undefined === index
                ? this.nativeDropDown.options.length - 1
                : index;
        }
        this.updateSelectedOptionThrottled();
    };
    UIDropDown.prototype.getOptions = function () {
        return this.nativeDropDown.options;
    };
    UIDropDown.prototype.remove = function (index) {
        this.nativeDropDown.remove(index);
        this.updateSelectedOptionThrottled();
    };
    UIDropDown.prototype.updateSelectedOption = function () {
        if (this.initSelectedIndex !== null) {
            this.nativeDropDown.selectedIndex = this.initSelectedIndex;
            this.initSelectedIndex = null;
        }
        if (this.nativeDropDown.selectedIndex !== -1) {
            var opt = this.nativeDropDown.options[this.nativeDropDown.selectedIndex];
            this.selectedOption.textContent = opt.text;
        }
        else {
            this.selectedOption.textContent = '';
        }
    };
    UIDropDown.prototype.init = function () {
        (function ($, self) {
            self.on('update', function () {
                self.updateSelectedOption();
            });
            $(self.nativeDropDown).on('change', function (e) {
                self.updateSelectedOptionThrottled();
                $(self.rootNode).trigger('change');
                e.stopPropagation();
            });
            $(self.nativeDropDown)
                .on('focus', function () {
                $(self.rootNode).attr('data-is-focused-child-element', '1');
            })
                .on('blur', function () {
                $(self.rootNode).removeAttr('data-is-focused-child-element');
            });
            Object.defineProperty(self.rootNode, 'selectedIndex', {
                get: function () {
                    return self.getSelectedIndex();
                },
                set: function (index) {
                    self.setSelectedIndex(index);
                }
            });
            Object.defineProperty(self.rootNode, 'value', {
                get: function () {
                    return self.getValue();
                },
                set: function (value) {
                    self.setValue(String(value || ''));
                }
            });
            Object.defineProperty(self.rootNode, 'disabled', {
                get: function () {
                    return self.isDisabled();
                },
                set: function (value) {
                    self.setDisabled(!!value);
                }
            });
            Object.defineProperty(self.rootNode, 'readOnly', {
                get: function () {
                    return self.isReadOnly();
                },
                set: function (readOnly) {
                    self.setReadOnly(!!readOnly);
                }
            });
            Object.defineProperty(self.rootNode, 'add', {
                'get': function () {
                    return function () {
                        self.add.apply(self, arguments);
                    };
                }
            });
            Object.defineProperty(self.rootNode, 'remove', {
                'get': function () {
                    return function () {
                        self.remove.apply(self, arguments);
                    };
                }
            });
            Object.defineProperty(self.rootNode, 'options', {
                get: function () {
                    return self.getOptions();
                }
            });
        })(UI.getJQuery(), this);
    };
    UIDropDown.prototype.setDisabled = function (disabledState) {
        _super.prototype.setDisabled.call(this, disabledState);
        this.nativeDropDown.disabled = this.isDisabled();
    };
    UIDropDown.prototype.setReadOnly = function (readOnlyState) {
        _super.prototype.setReadOnly.call(this, readOnlyState);
        this.nativeDropDown['readOnly'] = this.isReadOnly();
    };
    UIDropDown.prototype.setAttribute = function (attributeName, attributeValue) {
        switch (attributeName) {
            case 'json-options':
                try {
                    var decodedJSONOptions = JSON.parse(attributeValue);
                    while (this.getOptions().length) {
                        this.remove(0);
                    }
                    if (!(decodedJSONOptions && decodedJSONOptions.length)) {
                        return;
                    }
                    for (var i = 0, len = decodedJSONOptions.length; i < len; i++) {
                        var option = UIDropDownOption.create(this, String(decodedJSONOptions[i].id || ''), String(decodedJSONOptions[i].name || decodedJSONOptions[i].id || ''));
                        this.add(option);
                    }
                }
                catch (e) {
                    console.warn('Failed to set UIDropdown attribute "json-options": ', e);
                }
                break;
            case 'json-value':
                try {
                    var decodedJSONValue = JSON.parse(attributeValue || '');
                    this.setValue(decodedJSONValue);
                }
                catch (e) {
                    console.warn('Failed to set UIDropdown attribute "json-value": ', e);
                }
                break;
            default:
                _super.prototype.setAttribute.call(this, attributeName, attributeValue);
                break;
        }
    };
    UIDropDown.upgradeDropdown = function (dropdown) {
        var result = new UIDropDown(), option;
        for (var i = 0, len = dropdown.options.length; i < len; i++) {
            option = UIDropDownOption.create(result, dropdown.options[i].value, dropdown.options[i].text);
            result.add(option);
        }
        result.setValue(dropdown.value);
        if (dropdown.parentNode) {
            dropdown.parentNode.insertBefore(result.getRootNode(), dropdown);
            dropdown.parentNode.removeChild(dropdown);
        }
        return result;
    };
    return UIDropDown;
}(UIElement));
var UIDropDownOption = (function () {
    function UIDropDownOption(host, value, text) {
        this.attrs = {
            "text": "",
            "value": "",
        };
        this.host = host;
        this.attrs.text = text;
        this.attrs.value = value;
    }
    UIDropDownOption.prototype.setAttribute = function (attributeName, attributeValue) {
        this.attrs[attributeName] = attributeValue;
    };
    UIDropDownOption.prototype.getAttribute = function (attributeName) {
        return undefined === this.attrs[attributeName]
            ? null
            : this.attrs[attributeName];
    };
    UIDropDownOption.prototype.removeAttribute = function (attributeName) {
        delete this.attrs[attributeName];
    };
    UIDropDownOption.prototype.hasAttribute = function (attributeName) {
        return undefined !== this.attrs[attributeName];
    };
    Object.defineProperty(UIDropDownOption.prototype, "text", {
        get: function () {
            return this.attrs.text;
        },
        set: function (text) {
            this.attrs.text = String(text || '');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(UIDropDownOption.prototype, "value", {
        get: function () {
            return this.attrs.value;
        },
        set: function (value) {
            this.attrs.value = String(value || '');
        },
        enumerable: true,
        configurable: true
    });
    UIDropDownOption.create = function (host, value, text) {
        return new UIDropDownOption(host, value, text);
    };
    UIDropDownOption.createFromHTMLOptionElement = function (host, element) {
        var result = UIDropDownOption.create(host, element.value, element.text);
        for (var attrs = element.attributes, len = attrs.length, i = 0; i < len; i++) {
            result.setAttribute(attrs[i].name, attrs[i].value);
        }
        return result;
    };
    UIDropDownOption.prototype.convertToHTMLOptionElement = function () {
        var result = document.createElement('option');
        result.text = this.attrs.text;
        result.value = this.attrs.value;
        for (var k in this.attrs) {
            if (k !== 'text' && k !== 'value' && this.attrs.hasOwnProperty(k) && this.attrs.propertyIsEnumerable(k)) {
                result.setAttribute(k, this.attrs[k]);
            }
        }
        return result;
    };
    return UIDropDownOption;
}());
var UIColorPicker = (function (_super) {
    __extends(UIColorPicker, _super);
    function UIColorPicker() {
        var _this = _super.call(this, 'color') || this;
        _this.value = [0, 0, 0, 1];
        _this.rollbackColor = [0, 0, 0, 1];
        _this.expanded = false;
        UIColorPicker.initializeOverlay();
        _this.colorDiv = document.createElement('div');
        _this.rootNode.appendChild(_this.colorDiv);
        _this.updateInputColor();
        _this.init();
        return _this;
    }
    UIColorPicker.prototype.getValue = function () {
        return ColorUtils.RGBToString(this.value);
    };
    UIColorPicker.prototype.getRGB = function () {
        return this.value;
    };
    UIColorPicker.prototype.getHSL = function () {
        return ColorUtils.RGBtoHSV(this.value);
    };
    UIColorPicker.prototype.updateInputColor = function () {
        this.colorDiv.style.backgroundColor = ColorUtils.RGBToString(this.value);
    };
    UIColorPicker.prototype.setValue = function (color) {
        var val = ColorUtils.stringToRGB(color);
        if (null === val) {
            val = [0, 0, 0, 1];
        }
        if (ColorUtils.areEqualRGBColors(this.value, val)) {
            return;
        }
        this.value = val;
        this.updateInputColor();
        if (this.expanded && UIColorPicker.expandedInstance === this) {
            UIColorPicker.overlayColor = ColorUtils.RGBtoHSV(this.value);
            UIColorPicker.repaint();
        }
    };
    UIColorPicker.prototype.rollback = function () {
        this.setValue(ColorUtils.RGBToString(this.rollbackColor));
    };
    UIColorPicker.prototype.reanchorOverlayElement = function () {
        var overlayClientRect = UIColorPicker.overlay.getBoundingClientRect();
        var parentDimensions = this.rootNode.parentElement.getBoundingClientRect();
        var viewportHeight = document.documentElement.clientHeight || window.innerHeight;
        UIColorPicker.overlay.style.left = (parentDimensions.width - overlayClientRect.width) / 2 + parentDimensions.left + "px";
        UIColorPicker.overlay.style.top = UIColorPicker.overlay.style.top = parentDimensions.top + parentDimensions.height + "px";
        if (overlayClientRect.height > viewportHeight - parentDimensions.top) {
            UIColorPicker.overlay.style.top = parentDimensions.top - overlayClientRect.height + "px";
        }
    };
    UIColorPicker.prototype.setExpanded = function (on) {
        on = !!on;
        if (on === this.expanded) {
            return;
        }
        if (on && null !== UIColorPicker.expandedInstance) {
            UIColorPicker.expandedInstance.setExpanded(false);
        }
        if (on) {
            this.rollbackColor[0] = this.value[0];
            this.rollbackColor[1] = this.value[1];
            this.rollbackColor[2] = this.value[2];
            this.rollbackColor[3] = this.value[3];
            if (UIColorPicker.expandedInstance && UIColorPicker.expandedInstance !== this) {
                UIColorPicker.expandedInstance.setExpanded(false);
            }
            UIColorPicker.expandedInstance = this;
            UIColorPicker.overlayColor = ColorUtils.RGBtoHSV(this.value);
            document.body.appendChild(UIColorPicker.overlay);
            this.reanchorOverlayElement();
            if (this.expanded && UIColorPicker.expandedInstance === this) {
                UIColorPicker.overlayColor = ColorUtils.RGBtoHSV(this.value);
                UIColorPicker.repaint();
            }
            UIColorPicker.repaint();
        }
        else {
            if (UIColorPicker.expandedInstance && UIColorPicker.expandedInstance === this) {
                UIColorPicker.expandedInstance = null;
            }
            if (UIColorPicker.overlay.parentNode) {
                UIColorPicker.overlay.parentNode.removeChild(UIColorPicker.overlay);
            }
        }
        this.expanded = on;
    };
    UIColorPicker.prototype.isExpanded = function () {
        return this.expanded;
    };
    UIColorPicker.prototype.setChangeCallback = function (callback) {
        UIColorPicker.changeCallback = callback;
    };
    UIColorPicker.prototype.init = function () {
        (function (self, $) {
            $(self.rootNode).on('click', function () {
                if (self.isDisabled() || self.isReadOnly()) {
                    return;
                }
                self.setExpanded(true);
                UIColorPicker.tryFocusColorTextInput();
            });
            Object.defineProperty(self.getRootNode(), 'value', {
                get: function () {
                    return self.getValue();
                },
                set: function (v) {
                    self.setValue(v);
                }
            });
            Object.defineProperty(self.getRootNode(), 'disabled', {
                get: function () {
                    return self.isDisabled();
                },
                set: function (disabled) {
                    self.setDisabled(!!disabled);
                }
            });
            Object.defineProperty(self.getRootNode(), 'readOnly', {
                get: function () {
                    return self.isReadOnly();
                },
                set: function (readOnly) {
                    self.setReadOnly(!!readOnly);
                }
            });
        })(this, UI.getJQuery());
    };
    UIColorPicker.paintHueOverlay = function () {
        var hueStep = 1 / this.OVERLAY_WIDTH, hue, ctx = this.hueCanvas.getContext('2d');
        for (var i = 0; i < this.OVERLAY_WIDTH; i++) {
            hue = i * hueStep;
            ctx.fillStyle = ColorUtils.HSVToString([hue, .5, .66, 1]);
            ctx.fillRect(i, 0, 1, this.HORIZONTAL_SLIDER_HEIGHT);
        }
        if (this.sliderSpriteLoaded) {
            var spriteLeftPosition = ~~(this.overlayColor[0] * this.OVERLAY_WIDTH);
            ctx.drawImage(this.sliderSprite, spriteLeftPosition + this.sliderSpritePaintTranslateX, this.sliderSpritePaintTranslateY);
        }
    };
    UIColorPicker.paintSaturationOverlay = function (hue, useCache, updateCache) {
        if (useCache === void 0) { useCache = false; }
        if (updateCache === void 0) { updateCache = false; }
        var xStep = 1 / this.OVERLAY_WIDTH, yStep = 1 / this.COLOR_CANVAS_HEIGHT, ctx = this.saturationCanvas.getContext('2d');
        if (useCache && this.saturationCanvasCacheReady) {
            ctx.drawImage(this.saturationCanvasCache, 0, 0);
        }
        else {
            for (var x = 0; x < this.OVERLAY_WIDTH; x++) {
                for (var y = 0; y < this.COLOR_CANVAS_HEIGHT; y++) {
                    ctx.fillStyle = ColorUtils.RGBToString(ColorUtils.HSVtoRGB([hue, 1 - (y * yStep), x * xStep, 1]), false);
                    ctx.fillRect(x, y, 1, 1);
                }
            }
            if (updateCache) {
                this.saturationCanvasCacheReady = false;
                this.saturationCanvasCache.src = this.saturationCanvas.toDataURL('image/png');
            }
        }
        if (this.crossSpriteLoaded) {
            var point = {
                top: ~~(this.COLOR_CANVAS_HEIGHT * (1 - this.overlayColor[1])),
                left: ~~(this.OVERLAY_WIDTH * this.overlayColor[2]),
            };
            ctx.drawImage(this.crossSprite, point.left + this.crossSpritePaintTranslateX, point.top + this.crossSpritePaintTranslateY);
        }
    };
    UIColorPicker.paintLightOverlay = function (hue, saturation) {
        var xStep = 1 / this.OVERLAY_WIDTH, ctx = this.lightCanvas.getContext('2d');
        for (var x = 0; x < this.OVERLAY_WIDTH; x++) {
            ctx.fillStyle = ColorUtils.HSVToString([hue, saturation, x * xStep, 1]);
            ctx.fillRect(x, 0, 1, this.HORIZONTAL_SLIDER_HEIGHT);
        }
        if (this.sliderSpriteLoaded) {
            var spriteLeftPosition = ~~(this.overlayColor[2] * this.OVERLAY_WIDTH);
            ctx.drawImage(this.sliderSprite, spriteLeftPosition + this.sliderSpritePaintTranslateX, this.sliderSpritePaintTranslateY);
        }
    };
    UIColorPicker.paintAlphaOverlay = function (hue, saturation, light) {
        var xStep = 1 / this.OVERLAY_WIDTH, ctx = this.alphaCanvas.getContext('2d'), pixel = [hue, saturation, light, 1];
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, this.OVERLAY_WIDTH, this.HORIZONTAL_SLIDER_HEIGHT);
        if (this.patternLoaded) {
            var pattern = ctx.createPattern(this.transparencyPattern, 'repeat');
            ctx.rect(0, 0, this.OVERLAY_WIDTH, this.HORIZONTAL_SLIDER_HEIGHT);
            ctx.fillStyle = pattern;
            ctx.fill();
        }
        else {
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, this.OVERLAY_WIDTH, this.HORIZONTAL_SLIDER_HEIGHT);
        }
        for (var i = 0; i < this.OVERLAY_WIDTH; i++) {
            pixel[3] = i * xStep;
            ctx.fillStyle = ColorUtils.HSVToString(pixel);
            ctx.fillRect(i, 0, 1, this.HORIZONTAL_SLIDER_HEIGHT);
        }
        if (this.sliderSpriteLoaded) {
            var spriteLeftPosition = ~~(this.overlayColor[3] * this.OVERLAY_WIDTH);
            ctx.drawImage(this.sliderSprite, spriteLeftPosition + this.sliderSpritePaintTranslateX, this.sliderSpritePaintTranslateY);
        }
    };
    UIColorPicker.updateColorText = function () {
        this.setOpaque.style.backgroundColor = ColorUtils.HSVToString(ColorUtils.removeAlpha(this.overlayColor));
        if (this.updateColorModel) {
            switch (this.colorModel) {
                case EColorModel.RGBA:
                    this.colorTextInput.value = ColorUtils.RGBToString(ColorUtils.HSVtoRGB(this.overlayColor));
                    break;
                case EColorModel.HSLA:
                    this.colorTextInput.value = ColorUtils.HSVToString(this.overlayColor);
                    break;
                default:
                    console.warn('Don\'t know how to update the color text');
                    break;
            }
        }
    };
    UIColorPicker.forcePointInClientRect = function (point, rect) {
        if (point.left < 0) {
            point.left = 0;
        }
        if (point.left >= rect.width) {
            point.left = rect.width - 1;
        }
        if (point.top < 0) {
            point.top = 0;
        }
        if (point.top >= rect.height) {
            point.top = rect.height - 1;
        }
        return point;
    };
    UIColorPicker.initializeOverlay = function () {
        if (this.initialized) {
            return;
        }
        this.overlay = document.createElement('div');
        this.overlay.setAttribute('data-role', 'color-overlay');
        this.overlayModal = document.createElement('div');
        this.overlayModal.className = 'ui-modal';
        this.overlayModal.setAttribute('data-transparent', '1');
        this.overlay.appendChild(this.overlayModal);
        this.hueCanvas = document.createElement('canvas');
        this.hueCanvas.setAttribute('data-role', 'hue');
        this.saturationCanvas = document.createElement('canvas');
        this.saturationCanvas.setAttribute('data-role', 'saturation');
        this.lightCanvas = document.createElement('canvas');
        this.lightCanvas.setAttribute('data-role', 'light');
        this.alphaCanvas = document.createElement('canvas');
        this.alphaCanvas.setAttribute('data-role', 'transparency');
        this.transparencyPattern = document.createElement('img');
        this.sliderSprite = document.createElement('img');
        this.crossSprite = document.createElement('img');
        this.colorTextInput = document.createElement('input');
        this.colorTextInput.setAttribute('type', 'text');
        this.colorTextInput.setAttribute('data-role', 'color-text');
        this.colorTextInput.setAttribute('placeholder', 'Type a color...');
        this.setTransparent = document.createElement('button');
        this.setTransparent.setAttribute('data-role', 'set-transparent');
        this.setOpaque = document.createElement('button');
        this.setOpaque.title = 'Set opaque color';
        this.setOpaque.setAttribute('data-role', 'set-opaque');
        this.setTransparent.title = 'Set full transparent';
        this.saturationCanvasCache = document.createElement('img');
        (function (self) {
            self.saveColorToTargetInputThrottle = Throttle.create(function () {
                self.setColorToTargetInput();
                if (self.changeCallback !== null) {
                    try {
                        self.changeCallback();
                    }
                    catch (e) {
                        console.error(e);
                    }
                }
            }, 50);
            self.transparencyPattern.addEventListener('load', function () {
                self.patternLoaded = true;
            });
            self.sliderSprite.addEventListener('load', function () {
                self.sliderSpriteLoaded = true;
            });
            self.crossSprite.addEventListener('load', function () {
                self.crossSpriteLoaded = true;
            });
            self.saturationCanvasCache.addEventListener('load', function () {
                self.saturationCanvasCacheReady = true;
            });
        })(this);
        this.transparencyPattern.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAAAAACo4kLRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QkbEgM2YPFhLAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAP0lEQVQY02P8zwADp+EsJgZkwMjA8P8fAwMLiuB/BgZGRnSVWLXTW5AF4Q9TZJX//jMwMKKqhJjwfxA5HqsgAFYwCPaivXxiAAAAAElFTkSuQmCC';
        this.sliderSprite.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHVSURBVCiRldIxaBNxFAbw995d+//uSlxKS4TiUBM4sSLdwoGrDhZBQoPQDLbQQoe0FEqLW3DpKlQ7qDWSzbTqUFRcnZNARRKwKW6CTjWDd/euSZ1SurS13/SG78d7w2M6kXfl8jBcd6HfmLsukDYAAfjuGPPBdd31ZCr1u9fl3lDa2Jg0xmw6wIEBXjuOUwfQRX//GICHAJJ9tj0z4nnbx/DJ2tqkA7wB8NIZHFzM5XLByUuq1WpfQuQxgFVLJDfiedtcXF4eHkgkWgb4VFhZecDMR3RK9nZ3n8GYvG1ZKekSLaiqCYJg6SxERERB8EhVu51OpyBRFE2o6pfVYvHnmYiI0plMW1U/xoeHE6Kqo6q6fx7qJVZtaRSlbFUlEXH/F4ZRNMAiR7aq7ouIf4GNvmVZLYmiaEdVry7Ozt47D33e2vI1jjMaRTsSMK+rajtWfb40Pz96GqqUSskwjsuq2g7D8KnVaDT+jqXTeyQyzURTt3z/143x8UatVusSEVUqFeu2798n5rfCfIWJpu5ks/Xjl8tns1kHeAXgEoADB/hmgC6AazBmCMAfA0zn5+beExFZPfi12Wze9LxNJgpZZIiZrzPRZWH+QcwvbOb8TKFQ7/X/AQl6styfo0m+AAAAAElFTkSuQmCC';
        this.crossSprite.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHVSURBVCiRldIxaBNxFAbw995d+//uSlxKS4TiUBM4sSLdwoGrDhZBQoPQDLbQQoe0FEqLW3DpKlQ7qDWSzbTqUFRcnZNARRKwKW6CTjWDd/euSZ1SurS13/SG78d7w2M6kXfl8jBcd6HfmLsukDYAAfjuGPPBdd31ZCr1u9fl3lDa2Jg0xmw6wIEBXjuOUwfQRX//GICHAJJ9tj0z4nnbx/DJ2tqkA7wB8NIZHFzM5XLByUuq1WpfQuQxgFVLJDfiedtcXF4eHkgkWgb4VFhZecDMR3RK9nZ3n8GYvG1ZKekSLaiqCYJg6SxERERB8EhVu51OpyBRFE2o6pfVYvHnmYiI0plMW1U/xoeHE6Kqo6q6fx7qJVZtaRSlbFUlEXH/F4ZRNMAiR7aq7ouIf4GNvmVZLYmiaEdVry7Ozt47D33e2vI1jjMaRTsSMK+rajtWfb40Pz96GqqUSskwjsuq2g7D8KnVaDT+jqXTeyQyzURTt3z/143x8UatVusSEVUqFeu2798n5rfCfIWJpu5ks/Xjl8tns1kHeAXgEoADB/hmgC6AazBmCMAfA0zn5+beExFZPfi12Wze9LxNJgpZZIiZrzPRZWH+QcwvbOb8TKFQ7/X/AQl6styfo0m+AAAAAElFTkSuQmCC';
        this.overlay.appendChild(this.hueCanvas);
        this.overlay.appendChild(this.saturationCanvas);
        this.overlay.appendChild(this.lightCanvas);
        this.overlay.appendChild(this.alphaCanvas);
        this.overlay.appendChild(this.colorTextInput);
        this.overlay.appendChild(this.setTransparent);
        this.overlay.appendChild(this.setOpaque);
        this.hueCanvas.width
            = UIColorPicker.lightCanvas.width
                = UIColorPicker.saturationCanvas.width
                    = UIColorPicker.alphaCanvas.width
                        = this.OVERLAY_WIDTH;
        this.hueCanvas.height
            = UIColorPicker.lightCanvas.height
                = UIColorPicker.alphaCanvas.height
                    = this.HORIZONTAL_SLIDER_HEIGHT;
        this.saturationCanvas.height = this.COLOR_CANVAS_HEIGHT;
        this.paintHueOverlay();
        this.updateColorText();
        (function (self, $) {
            var targetControl = EColorPickerTargetControl.NONE, targetClientRect = null;
            $(document.body).on('mousedown', function (e) {
                if (e.which !== 1) {
                    return;
                }
                var target = e.target || e.srcElement;
                if (self.expandedInstance) {
                    if ((!$.contains(self.overlay, target) || target === self.overlayModal) && !$.contains(self.expandedInstance.getRootNode(), target) && target !== self.expandedInstance.getRootNode() && target !== self.overlay) {
                        self.expandedInstance.setExpanded(false);
                        return;
                    }
                    switch (target) {
                        case self.hueCanvas:
                            targetControl = EColorPickerTargetControl.HUE;
                            targetClientRect = self.hueCanvas.getBoundingClientRect();
                            onMouseMove(e);
                            break;
                        case self.saturationCanvas:
                            targetControl = EColorPickerTargetControl.SATURATION;
                            targetClientRect = self.saturationCanvas.getBoundingClientRect();
                            onMouseMove(e);
                            break;
                        case self.lightCanvas:
                            targetControl = EColorPickerTargetControl.LIGHT;
                            targetClientRect = self.lightCanvas.getBoundingClientRect();
                            onMouseMove(e);
                            break;
                        case self.alphaCanvas:
                            targetControl = EColorPickerTargetControl.ALPHA;
                            targetClientRect = self.alphaCanvas.getBoundingClientRect();
                            onMouseMove(e);
                            break;
                        default:
                            targetControl = EColorPickerTargetControl.NONE;
                            targetClientRect = null;
                            break;
                    }
                }
            });
            $(document.body).on('mouseup', function (e) {
                targetControl = EColorPickerTargetControl.NONE;
                targetClientRect = null;
            });
            var onMouseMove = function (e) {
                if (targetControl === EColorPickerTargetControl.NONE) {
                    return;
                }
                var point = null, clientRect = null;
                switch (targetControl) {
                    case EColorPickerTargetControl.HUE:
                        clientRect = self.hueCanvas.getBoundingClientRect();
                        point = self.forcePointInClientRect({
                            left: e.clientX - clientRect.left,
                            top: e.clientY - clientRect.top,
                        }, clientRect);
                        self.setHueByPixels(point);
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                    case EColorPickerTargetControl.SATURATION:
                        clientRect = self.saturationCanvas.getBoundingClientRect();
                        point = self.forcePointInClientRect({
                            left: e.clientX - clientRect.left,
                            top: e.clientY - clientRect.top,
                        }, clientRect);
                        self.setSaturationByPixels(point);
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                    case EColorPickerTargetControl.LIGHT:
                        clientRect = self.lightCanvas.getBoundingClientRect();
                        point = self.forcePointInClientRect({
                            left: e.clientX - clientRect.left,
                            top: e.clientY - clientRect.top,
                        }, clientRect);
                        self.setLightByPixels(point);
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                    case EColorPickerTargetControl.ALPHA:
                        clientRect = self.alphaCanvas.getBoundingClientRect();
                        point = self.forcePointInClientRect({
                            left: e.clientX - clientRect.left,
                            top: e.clientY - clientRect.top,
                        }, clientRect);
                        self.setAlphaByPixels(point);
                        e.preventDefault();
                        e.stopPropagation();
                        break;
                }
            };
            document.body.addEventListener('mousemove', onMouseMove, true);
            $(self.overlay).on('click', 'button[data-role]', function (e) {
                var role = $(this).attr('data-role');
                self.execButtonCommand(role);
            });
            $(self.colorTextInput).on('input', function (e) {
                var parsedColor = ColorUtils.stringToRGB(this.value);
                if (null !== parsedColor) {
                    self.updateColorModel = false;
                    self.overlayColor = ColorUtils.RGBtoHSV(parsedColor);
                    self.repaint();
                    self.updateColorModel = true;
                    self.saveColorToTargetInputThrottle();
                }
            }).on('keyup', function (e) {
                var keyCode = e.keyCode || e.charCode;
                switch (keyCode) {
                    case 13:
                        if (self.expandedInstance) {
                            setTimeout(function (instance) {
                                return instance.getRootNode().focus;
                            }(self.expandedInstance), 1);
                            self.expandedInstance.setExpanded(false);
                        }
                        break;
                    case 27:
                        if (self.expandedInstance) {
                            self.expandedInstance.rollback();
                            setTimeout(function (instance) {
                                return instance.getRootNode().focus;
                            }(self.expandedInstance), 1);
                            self.expandedInstance.setExpanded(false);
                        }
                        break;
                }
            });
        })(this, UI.getJQuery());
        this.initialized = true;
    };
    UIColorPicker.setHueByPixels = function (point) {
        var hueAsFloat = point.left * (1 / this.OVERLAY_WIDTH);
        this.overlayColor[0] = hueAsFloat;
        this.paintHueOverlay();
        this.paintSaturationOverlay(this.overlayColor[0], false, true);
        this.paintLightOverlay(this.overlayColor[0], this.overlayColor[1]);
        this.paintAlphaOverlay(this.overlayColor[0], this.overlayColor[1], this.overlayColor[2]);
        this.updateColorText();
        this.saveColorToTargetInputThrottle();
        UIColorPicker.tryFocusColorTextInput();
    };
    UIColorPicker.setSaturationByPixels = function (point) {
        var lightAsFloat = point.left * (1 / this.OVERLAY_WIDTH), saturationAsFloat = 1 - (point.top * (1 / this.COLOR_CANVAS_HEIGHT));
        this.overlayColor[2] = lightAsFloat;
        this.overlayColor[1] = saturationAsFloat;
        this.paintSaturationOverlay(this.overlayColor[0], true);
        this.paintLightOverlay(this.overlayColor[0], this.overlayColor[1]);
        this.paintAlphaOverlay(this.overlayColor[0], this.overlayColor[1], this.overlayColor[2]);
        this.updateColorText();
        this.saveColorToTargetInputThrottle();
        UIColorPicker.tryFocusColorTextInput();
    };
    UIColorPicker.setLightByPixels = function (point) {
        var lightAsFloat = point.left * (1 / this.OVERLAY_WIDTH);
        this.overlayColor[2] = lightAsFloat;
        this.paintLightOverlay(this.overlayColor[0], this.overlayColor[1]);
        this.paintAlphaOverlay(this.overlayColor[0], this.overlayColor[1], this.overlayColor[2]);
        this.updateColorText();
        this.saveColorToTargetInputThrottle();
        UIColorPicker.tryFocusColorTextInput();
    };
    UIColorPicker.setAlphaByPixels = function (point) {
        var alphaAsFloat = point.left * (1 / this.OVERLAY_WIDTH);
        this.overlayColor[3] = alphaAsFloat;
        this.paintAlphaOverlay(this.overlayColor[0], this.overlayColor[1], this.overlayColor[2]);
        this.updateColorText();
        this.saveColorToTargetInputThrottle();
        UIColorPicker.tryFocusColorTextInput();
    };
    UIColorPicker.repaint = function () {
        this.paintHueOverlay();
        this.paintSaturationOverlay(this.overlayColor[0], false, true);
        this.paintLightOverlay(this.overlayColor[0], this.overlayColor[1]);
        this.paintAlphaOverlay(this.overlayColor[0], this.overlayColor[1], this.overlayColor[2]);
        this.updateColorText();
        UIColorPicker.tryFocusColorTextInput();
    };
    UIColorPicker.execButtonCommand = function (command) {
        switch (command) {
            case 'set-transparent':
                this.overlayColor[3] = 0;
                this.paintAlphaOverlay(this.overlayColor[0], this.overlayColor[1], this.overlayColor[2]);
                this.updateColorText();
                this.saveColorToTargetInputThrottle();
                UIColorPicker.tryFocusColorTextInput();
                break;
            case 'set-opaque':
                this.overlayColor[3] = 1;
                this.paintAlphaOverlay(this.overlayColor[0], this.overlayColor[1], this.overlayColor[2]);
                this.updateColorText();
                this.saveColorToTargetInputThrottle();
                UIColorPicker.tryFocusColorTextInput();
                break;
            default:
                console.warn('UIColorPicker.execButtonCommand: command ' + JSON.stringify(command) + ' is not implemented or unknown');
        }
    };
    UIColorPicker.setColorToTargetInput = function () {
        if (null === this.expandedInstance) {
            return;
        }
        this.expandedInstance.value = ColorUtils.HSVtoRGB(this.overlayColor);
        this.expandedInstance.updateInputColor();
        UI.getJQuery()(this.expandedInstance.getRootNode()).trigger('change');
    };
    UIColorPicker.tryFocusColorTextInput = function () {
        if (!FormUtils.isMobile()) {
            UIColorPicker.colorTextInput.focus();
        }
    };
    UIColorPicker.HORIZONTAL_SLIDER_HEIGHT = 20;
    UIColorPicker.OVERLAY_WIDTH = 220;
    UIColorPicker.COLOR_CANVAS_HEIGHT = 160;
    UIColorPicker.initialized = false;
    UIColorPicker.expandedInstance = null;
    UIColorPicker.patternLoaded = false;
    UIColorPicker.sliderSpriteLoaded = false;
    UIColorPicker.sliderSpritePaintTranslateX = -5;
    UIColorPicker.sliderSpritePaintTranslateY = 3;
    UIColorPicker.crossSpriteLoaded = false;
    UIColorPicker.crossSpritePaintTranslateX = -6;
    UIColorPicker.crossSpritePaintTranslateY = -7;
    UIColorPicker.colorModel = EColorModel.RGBA;
    UIColorPicker.updateColorModel = true;
    UIColorPicker.overlayColor = [0, 0, 0, 1];
    UIColorPicker.saturationCanvasCacheReady = false;
    UIColorPicker.changeCallback = null;
    return UIColorPicker;
}(UIElement));
var UIDate = (function (_super) {
    __extends(UIDate, _super);
    function UIDate() {
        var _this = _super.call(this, UI.ELEMENT_TYPE_DATE) || this;
        _this.dateGroups = [];
        _this.value = null;
        _this.expanded = false;
        _this.weekStart = EDateWeekStart.SUNDAY;
        _this.acceptedDaysOfWeek = null;
        _this.expander = document.createElement('div');
        _this.expander.setAttribute('data-role', 'expander');
        _this.expander.setAttribute('role', 'application');
        if (MouseUtils.isMobile()) {
            _this.hiddenInput = document.createElement('input');
            _this.hiddenInput.style.display = 'block';
            _this.hiddenInput.style.border = 'none';
            _this.hiddenInput.style.width = '1px';
            _this.hiddenInput.style.height = '1px';
            _this.hiddenInput.style.opacity = '.1';
            _this.hiddenInput.style.position = 'absolute';
            _this.hiddenInput.style.right = _this.hiddenInput.style.top = '0';
            _this.rootNode.appendChild(_this.hiddenInput);
        }
        _this.init();
        return _this;
    }
    UIDate.prototype.padNumber = function (n, toDigits) {
        var result = String(n || 0);
        while (result.length < toDigits) {
            result = '0' + result;
        }
        return result;
    };
    UIDate.prototype.withWeekStart = function (weekStart) {
        this.weekStart = ~~(weekStart) || EDateWeekStart.SUNDAY;
        return this;
    };
    UIDate.prototype.getWeekStart = function () {
        return this.weekStart;
    };
    UIDate.prototype.withAcceptedDaysOfWeek = function (acceptedDaysOfWeek) {
        this.acceptedDaysOfWeek = acceptedDaysOfWeek;
        return this;
    };
    UIDate.prototype.getAcceptedDaysOfWeek = function () {
        return this.acceptedDaysOfWeek;
    };
    UIDate.prototype.getValue = function () {
        if (null === this.value) {
            return '';
        }
        switch (this.format) {
            case DataValidator.VALIDATOR_TYPE_DATE_MMYYYY:
                return this.padNumber(this.value.getMonth() + 1, 2) + '/' + this.padNumber(this.value.getFullYear(), 4);
            case DataValidator.VALIDATOR_TYPE_DATE_YYYYMMDD:
                return this.padNumber(this.value.getFullYear(), 4) + '/' + this.padNumber(this.value.getMonth() + 1, 2) + '/' + this.padNumber(this.value.getDate(), 2);
            case DataValidator.VALIDATOR_TYPE_DATE_DDMMYYYY:
                return this.padNumber(this.value.getDate(), 2) + '/' + this.padNumber(this.value.getMonth() + 1, 2) + '/' + this.padNumber(this.value.getFullYear(), 4);
            case DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY:
            default:
                return this.padNumber(this.value.getMonth() + 1, 2) + '/' + this.padNumber(this.value.getDate(), 2) + '/' + this.padNumber(this.value.getFullYear(), 4);
        }
    };
    UIDate.prototype.setValue = function (value) {
        var newValue;
        if ('string' !== typeof value) {
            newValue = null;
            console.warn('Invalid date: ', value);
        }
        else {
            var matches = void 0, day = 1, month = null, year = null;
            switch (this.format) {
                case DataValidator.VALIDATOR_TYPE_DATE_DDMMYYYY:
                    matches = /^([\d]{2})[\/\-\.]{1}([\d]{2})[\/\-\.]{1}([\d]{4})$/.exec(value);
                    if (matches) {
                        day = parseInt(matches[1]);
                        month = parseInt(matches[2]);
                        year = parseInt(matches[3]);
                    }
                    break;
                case DataValidator.VALIDATOR_TYPE_DATE_MMYYYY:
                    matches = /^([\d]{2})[\/\-\.]{1}([\d]{4})$/.exec(value);
                    if (matches) {
                        month = parseInt(matches[1]);
                        year = parseInt(matches[2]);
                    }
                    break;
                case DataValidator.VALIDATOR_TYPE_DATE_YYYYMMDD:
                    matches = /^([\d]{4})[\/\-\.]{1}([\d]{2})[\/\-\.]{1}([\d]{2})$/.exec(value);
                    if (matches) {
                        year = parseInt(matches[1]);
                        month = parseInt(matches[2]);
                        day = parseInt(matches[3]);
                    }
                    break;
                case DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY:
                default:
                    matches = /^([\d]{2})[\/\-\.]{1}([\d]{2})[\/\-\.]{1}([\d]{4})$/.exec(value);
                    if (matches) {
                        month = parseInt(matches[1]);
                        day = parseInt(matches[2]);
                        year = parseInt(matches[3]);
                    }
                    break;
            }
            if (null == month || null == year) {
                newValue = null;
                console.warn('Invalid date: ', value);
            }
            else {
                newValue = new Date();
                newValue.setHours(12);
                newValue.setMinutes(0);
                newValue.setSeconds(0);
                newValue.setMilliseconds(0);
                newValue.setMonth(month - 1);
                newValue.setDate(day);
                newValue.setFullYear(year);
            }
            if (TimeUtils.dateEquals(this.value, newValue)) {
                return;
            }
            this.value = newValue;
            for (var i = 0, len = this.dateGroups.length; i < len; i++) {
                this.dateGroups[i].extractDatePartFrom(this.value);
            }
        }
    };
    UIDate.prototype.withHash = function (hash) {
        this.hash = hash;
        return this;
    };
    UIDate.prototype.getHash = function () {
        return this.hash;
    };
    UIDate.prototype.setAccessibilityEnabled = function (value) {
        this.hasAccessibilityEnabled = value;
    };
    UIDate.prototype.setFormat = function (format) {
        var delimiterElement;
        this.format = format;
        this.dateGroups = this.getFormatDateGroups(format);
        this.rootNode.textContent = '';
        var dateWrapper = document.createElement('div');
        dateWrapper.setAttribute('data-role', 'date-wrapper');
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            var dateGroupAttribute = this.getDateGroupAttribute(this.dateGroups[i].getRole(), this.hash);
            this.dateGroups[i].getRootNode().setAttribute('id', dateGroupAttribute);
            this.dateGroups[i].withDisabled(this.disabled).withReadOnly(this.readOnly);
            this.dateGroups[i].extractDatePartFrom(this.value);
            dateWrapper.appendChild(this.dateGroups[i].getRootNode());
            if (i < len - 1) {
                delimiterElement = dateWrapper.appendChild(document.createElement('span'));
                delimiterElement.setAttribute('data-delimiter', '1');
                delimiterElement.textContent = "/";
            }
        }
        this.updateAccessibilityFeature();
        this.rootNode.appendChild(dateWrapper);
        this.rootNode.appendChild(this.expander);
        this.setCurrentDateGroup(this.dateGroups[0] || null);
        if (this.hiddenInput) {
            this.rootNode.appendChild(this.hiddenInput);
        }
    };
    UIDate.prototype.getDateGroupAttribute = function (role, hash) {
        switch (role) {
            case EDatePartRole.DAY:
                return 'date-' + hash + '-day';
            case EDatePartRole.MONTH:
                return 'date-' + hash + '-month';
            case EDatePartRole.YEAR:
                return 'date-' + hash + '-year';
        }
        return '';
    };
    UIDate.prototype.getFormatDateGroups = function (format) {
        var result;
        switch (format) {
            case DataValidator.VALIDATOR_TYPE_DATE_DDMMYYYY:
                result = [
                    new UIDateGroup(EDatePartRole.DAY, this),
                    new UIDateGroup(EDatePartRole.MONTH, this),
                    new UIDateGroup(EDatePartRole.YEAR, this),
                ];
                break;
            case DataValidator.VALIDATOR_TYPE_DATE_MMDDYYYY:
                result = [
                    new UIDateGroup(EDatePartRole.MONTH, this),
                    new UIDateGroup(EDatePartRole.DAY, this),
                    new UIDateGroup(EDatePartRole.YEAR, this),
                ];
                break;
            case DataValidator.VALIDATOR_TYPE_DATE_MMYYYY:
                result = [
                    new UIDateGroup(EDatePartRole.MONTH, this),
                    new UIDateGroup(EDatePartRole.YEAR, this),
                ];
                break;
            case DataValidator.VALIDATOR_TYPE_DATE_YYYYMMDD:
                result = [
                    new UIDateGroup(EDatePartRole.YEAR, this),
                    new UIDateGroup(EDatePartRole.MONTH, this),
                    new UIDateGroup(EDatePartRole.DAY, this),
                ];
                break;
            default:
                throw new Error('Invalid date format! Expected DDMMYYYY, MMDDYYYY, MMYYYY, YYYYMMDD');
        }
        return result;
    };
    UIDate.prototype.updateAccessibilityFeature = function () {
        if (this.hasAccessibilityEnabled) {
            var expanderText = document.createElement('div');
            expanderText.setAttribute('id', 'date-expander-text-acc');
            expanderText.appendChild(document.createTextNode('Click to choose time'));
            expanderText.style.display = 'none';
            this.expander.tabIndex = 0;
            this.expander.appendChild(expanderText);
            this.expander.setAttribute('aria-labelledby', 'date-expander-text-acc');
        }
        else {
            this.expander.removeAttribute('tabindex');
        }
    };
    UIDate.prototype.getFormat = function () {
        return this.format;
    };
    UIDate.prototype.getDateValue = function () {
        return this.value;
    };
    UIDate.prototype.setDateValue = function (value) {
        if (null !== value && !(value instanceof Date)) {
            throw new Error('Invalid argument: Expected Date|null');
        }
        this.value = value;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            this.dateGroups[i].extractDatePartFrom(this.value);
        }
    };
    UIDate.prototype.setCurrentDateGroup = function (dateGroup) {
        if (this.currentDateGroup) {
            this.currentDateGroup.getRootNode().removeAttribute('data-is-focused');
        }
        this.currentDateGroup = dateGroup || null;
        if (this.currentDateGroup) {
            this.currentDateGroup.getRootNode().setAttribute('data-is-focused', 'data-is-focused');
        }
    };
    UIDate.prototype.isDateValidIfDatePartIs = function (part, value) {
        if (part === EDatePartRole.AM_PM) {
            return value === 0 || value === 1;
        }
        var d1 = new Date(), d2 = new Date(), chosenDate = 1, chosenMonth = 0, chosenYear = 0;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            switch (this.dateGroups[i].getRole()) {
                case 0:
                    chosenDate = this.dateGroups[i].getValue();
                    break;
                case 1:
                    chosenMonth = this.dateGroups[i].getValue();
                    break;
                case 2:
                    chosenYear = this.dateGroups[i].getValue();
                    break;
                default:
                    break;
            }
        }
        if (!chosenMonth && !chosenYear) {
            return true;
        }
        d1.setFullYear(chosenYear, chosenMonth - 1, chosenDate);
        d2.setFullYear(chosenYear, chosenMonth - 1, chosenDate);
        switch (part) {
            case EDatePartRole.DAY:
                d1.setDate(value);
                return d1.getMonth() === d2.getMonth() && d1.getFullYear() === d2.getFullYear();
            case EDatePartRole.MONTH:
                d1.setMonth(value - 1);
                return d1.getDate() === d2.getDate() && d1.getFullYear() === d2.getFullYear();
            case EDatePartRole.YEAR:
                d1.setFullYear(value);
                return d1.getDate() === d2.getDate() && d1.getMonth() === d2.getMonth();
            default:
                return true;
        }
    };
    UIDate.prototype.rebuildDateFromParts = function () {
        var day = 1, month = null, year = null;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            switch (this.dateGroups[i].getRole()) {
                case EDatePartRole.YEAR:
                    year = this.dateGroups[i].getValue();
                    break;
                case EDatePartRole.MONTH:
                    month = this.dateGroups[i].getValue();
                    break;
                case EDatePartRole.DAY:
                    day = this.dateGroups[i].getValue();
                    break;
            }
        }
        if (null === month || null === year) {
            this.value = null;
        }
        else {
            var d = new Date();
            d.setFullYear(year);
            d.setMonth(month - 1, day);
            d.setDate(day);
            if (d.getDate() === day && d.getMonth() === month - 1 && d.getFullYear() === year) {
                this.value = new Date();
                this.value.setTime(d.getTime());
            }
            else {
                this.value = null;
            }
        }
    };
    UIDate.prototype.setExpanded = function (expandedState) {
        if (!this.isReadOnly()) {
            expandedState = !!expandedState;
            if (expandedState === this.expanded) {
                return;
            }
            this.expanded = expandedState;
            UIDate.initOverlay(expandedState ? this : null);
            if (expandedState) {
                this.expander.setAttribute('data-expanded', '1');
            }
            else {
                this.expander.removeAttribute('data-expanded');
            }
        }
    };
    UIDate.prototype.init = function () {
        (function (self, $) {
            self.expander.addEventListener('keydown', function (e) {
                var shouldPreventDefault = false;
                var keyCode = e.keyCode || e.charCode;
                switch (keyCode) {
                    case KeyboardUtils.KEY_TAB:
                        if (self.expanded) {
                            UIDate.focusNextOverlayElement(e);
                            shouldPreventDefault = true;
                        }
                        else {
                            self.expander.removeAttribute('tabindex');
                            setTimeout(function () {
                                self.expander.tabIndex = 0;
                            }, 1000);
                            return;
                        }
                        break;
                    case KeyboardUtils.KEY_UP:
                    case KeyboardUtils.KEY_DOWN:
                    case KeyboardUtils.KEY_LEFT:
                    case KeyboardUtils.KEY_RIGHT:
                        UIDate.handleKeyboardPressButtonOnCurrentFocusedElement(e, keyCode);
                        shouldPreventDefault = true;
                        break;
                    case KeyboardUtils.KEY_ENTER:
                        self.setExpanded(true);
                        shouldPreventDefault = true;
                        break;
                    case KeyboardUtils.KEY_ESC:
                        self.setExpanded(false);
                        shouldPreventDefault = true;
                        break;
                    default:
                        shouldPreventDefault = false;
                        break;
                }
                if (shouldPreventDefault) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            }, true);
            $(self.rootNode).on('keydown', function (e) {
                if (null !== self.currentDateGroup) {
                    if (MouseUtils.isMobile()) {
                        for (var i = 0, len = self.dateGroups.length; i < len; i++) {
                            if (document.activeElement === self.dateGroups[i].getRootNode() && self.dateGroups[i] !== self.currentDateGroup) {
                                self.setCurrentDateGroup(self.dateGroups[i]);
                                break;
                            }
                        }
                    }
                    self.currentDateGroup.handleKeyEvent(e);
                }
            });
            $(self.rootNode).on('blur', function () {
                self.setCurrentDateGroup(self.dateGroups[0]);
            });
            $(self.hiddenInput).on('focus', function () {
                setTimeout(function () {
                    $(self.rootNode).focus().click();
                    self.setExpanded(true);
                }, 100);
            });
            $(self.rootNode).on('mousedown', function (e) {
                var target = (e.target || e.srcElement);
                if (MouseUtils.isMobile()) {
                    self.setExpanded(true);
                }
                else {
                    if (target === self.expander) {
                        setTimeout(function () {
                            self.setExpanded(true);
                        }, 50);
                    }
                    else {
                        for (var i = 0, len = self.dateGroups.length; i < len; i++) {
                            if (self.dateGroups[i].getRootNode() === target) {
                                self.setCurrentDateGroup(self.dateGroups[i]);
                                return;
                            }
                        }
                    }
                }
            });
            Object.defineProperty(self.rootNode, 'value', {
                get: function () {
                    return self.getValue();
                },
                set: function (val) {
                    if (val && val instanceof Date) {
                        self.setDateValue(val);
                    }
                    else {
                        self.setValue(val);
                    }
                }
            });
            Object.defineProperty(self.rootNode, 'disabled', {
                get: function () {
                    return self.isDisabled();
                },
                set: function (disabledState) {
                    self.setDisabled(disabledState);
                }
            });
            Object.defineProperty(self.rootNode, 'readOnly', {
                get: function () {
                    return self.isReadOnly();
                },
                set: function (readOnlyState) {
                    self.setReadOnly(readOnlyState);
                }
            });
        })(this, UI.getJQuery());
    };
    UIDate.emulateBlurOnOverlayActiveElement = function () {
        if (null === this.overlayFocusedElement) {
            return;
        }
        this.overlayFocusedElement.removeAttribute('data-soft-focused');
    };
    UIDate.emulateFocusOnOverlayActiveElement = function () {
        if (null === this.overlayFocusedElement) {
            return;
        }
        this.overlayFocusedElement.setAttribute('data-soft-focused', '1');
    };
    UIDate.focusNextOverlayElement = function (e) {
        if (!this.expandedInstance) {
            return;
        }
        this.emulateBlurOnOverlayActiveElement();
        if (!e.shiftKey) {
            switch (this.overlayFocusedElement) {
                case this.overlayHeader:
                    this.overlayFocusedElement = this.dateLayerNavigation;
                    break;
                case this.dateLayerNavigation:
                    this.overlayFocusedElement = this.dateLayerDaysHolder;
                    break;
                case this.dateLayerDaysHolder:
                default:
                    this.overlayFocusedElement = this.overlayHeader;
                    break;
            }
        }
        else {
            switch (this.overlayFocusedElement) {
                case this.overlayHeader:
                    this.overlayFocusedElement = this.dateLayerDaysHolder;
                    break;
                case this.dateLayerDaysHolder:
                    this.overlayFocusedElement = this.dateLayerNavigation;
                    break;
                case this.dateLayerNavigation:
                default:
                    this.overlayFocusedElement = this.overlayHeader;
                    break;
            }
        }
        this.emulateFocusOnOverlayActiveElement();
    };
    UIDate.handleKeyboardPressButtonOnCurrentFocusedElement = function (e, pressedKey) {
        if (!this.expandedInstance) {
            return;
        }
        switch (this.overlayFocusedElement) {
            case this.overlayHeader:
                break;
            case this.dateLayerNavigation:
                switch (pressedKey) {
                    case KeyboardUtils.KEY_LEFT:
                        this.incrementDatePart('months', -1);
                        break;
                    case KeyboardUtils.KEY_RIGHT:
                        this.incrementDatePart('months', 1);
                        break;
                }
                break;
            case this.dateLayerDaysHolder:
                switch (pressedKey) {
                    case KeyboardUtils.KEY_UP:
                        this.incrementDatePart('days', -7);
                        break;
                    case KeyboardUtils.KEY_DOWN:
                        this.incrementDatePart('days', 7);
                        break;
                    case KeyboardUtils.KEY_LEFT:
                        this.incrementDatePart('days', -1);
                        break;
                    case KeyboardUtils.KEY_RIGHT:
                        this.incrementDatePart('days', 1);
                        break;
                }
                break;
        }
    };
    UIDate.incrementDatePart = function (datePartRole, incrementDirection) {
        var day = this.localDate.getDate();
        switch (datePartRole) {
            case 'months':
                this.localDate.setMonth(this.localDate.getMonth() + incrementDirection);
                this.localDate.setFullYear(this.localDate.getFullYear());
                this.localDate.setDate(day);
                break;
            case 'days':
                this.localDate.setDate(this.localDate.getDate() + incrementDirection);
                this.localDate.setFullYear(this.localDate.getFullYear());
                this.localDate.setMonth(this.localDate.getMonth());
                break;
        }
        this.expandedInstance.setDateValue(this.localDate);
        this.paintMonthOverlay();
        this.paintDateOverlay();
        UI.getJQuery()(this.expandedInstance.getRootNode()).trigger('input');
        var accessibilityDiv = this.expandedInstance.expander.querySelector('div');
        if (accessibilityDiv) {
            accessibilityDiv.textContent = this.expandedInstance.getValue();
        }
        this.expandedInstance.expander.focus();
    };
    UIDate.prototype.focusPreviousDatePartGroup = function () {
        var currentGroupIndex = null;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i] === this.currentDateGroup) {
                currentGroupIndex = i;
                break;
            }
        }
        this.setCurrentDateGroup(this.dateGroups[(currentGroupIndex || 0) - 1] || this.dateGroups[0] || null);
    };
    UIDate.prototype.focusNextDatePartGroup = function () {
        var currentGroupIndex = null;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i] === this.currentDateGroup) {
                currentGroupIndex = i;
                break;
            }
        }
        this.setCurrentDateGroup(this.dateGroups[(currentGroupIndex || 0) + 1] || this.dateGroups[this.dateGroups.length - 1] || null);
    };
    UIDate.prototype.setDisabled = function (disabledState) {
        _super.prototype.setDisabled.call(this, disabledState);
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            this.dateGroups[i].withDisabled(this.disabled);
        }
    };
    UIDate.prototype.setReadOnly = function (readOnlyState) {
        _super.prototype.setReadOnly.call(this, readOnlyState);
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            this.dateGroups[i].withReadOnly(this.readOnly);
        }
    };
    UIDate.initOverlayElements = function () {
        this.overlay = document.createElement('div');
        this.overlay.setAttribute('data-role', 'date-overlay');
        this.overlayModal = document.createElement('div');
        this.overlayModal.className = 'ui-modal';
        this.overlayModal.setAttribute('data-transparent', '1');
        if (!MouseUtils.isMobile()) {
            this.overlay.appendChild(this.overlayModal);
        }
        this.overlayHeader = document.createElement('div');
        this.overlayHeader.setAttribute('data-component', 'header');
        this.overlay.appendChild(this.overlayHeader);
        this.dateLayer = document.createElement('div');
        this.dateLayer.setAttribute('data-component', 'date');
        this.dateLayerNavigation = document.createElement('div');
        this.dateLayerNavigation.setAttribute('data-role', 'navigation');
        this.dateLayerNavigationBTNPrevMonth = document.createElement('div');
        this.dateLayerNavigationBTNPrevMonth.setAttribute('data-action', 'btn-prev-month');
        this.dateLayerNavigationBTNNextMonth = document.createElement('div');
        this.dateLayerNavigationBTNNextMonth.setAttribute('data-action', 'btn-next-month');
        this.dateLayerNavigationLABELCurrentMonth = document.createElement('div');
        this.dateLayerNavigationLABELCurrentMonth.setAttribute('data-action', 'select-year');
        this.dateLayerDaysHolder = document.createElement('div');
        this.dateLayerDaysHolder.setAttribute('data-role', 'calendar');
        this.dateLayerNavigation.appendChild(this.dateLayerNavigationBTNPrevMonth);
        this.dateLayerNavigation.appendChild(this.dateLayerNavigationLABELCurrentMonth);
        this.dateLayerNavigation.appendChild(this.dateLayerNavigationBTNNextMonth);
        this.dateLayer.appendChild(this.dateLayerNavigation);
        this.dateLayer.appendChild(this.dateLayerDaysHolder);
        this.weekDays = this.weekDaysI18n || this.weekDays;
        var weekDayHeader;
        for (var i = 0; i < 7; i++) {
            this.dateLayerDaysHolder.appendChild(this.dayOfWeekColumns[String(i)]);
            this.dayOfWeekColumns[String(i)].setAttribute('data-role', 'day-of-week');
            weekDayHeader = document.createElement('div');
            weekDayHeader.setAttribute('data-role', 'week-day-header');
            weekDayHeader.textContent = this.weekDays[i];
            this.dayOfWeekColumns[String(i)].appendChild(weekDayHeader);
        }
        this.monthLayer = document.createElement('div');
        this.monthLayer.setAttribute('data-component', 'month');
        this.yearLayer = document.createElement('div');
        this.yearLayer.setAttribute('data-component', 'year');
        this.overlay.appendChild(this.dateLayer);
        this.overlay.appendChild(this.monthLayer);
        this.overlay.appendChild(this.yearLayer);
    };
    UIDate.initListeners = function () {
        (function ($, self) {
            self.bodyMouseDownListener = function (e) {
                var target = (e.target || e.srcElement);
                if (target !== self.overlayModal && ($.contains(self.overlay, target) || target === self.overlay)) {
                }
                else {
                    if (null !== self.expandedInstance) {
                        self.expandedInstance.setExpanded(false);
                    }
                }
            };
            self.bodyClickListener = function (e) {
                var target = (e.target || e.srcElement), prevent = false;
                if ($.contains(self.overlay, target) || target === self.overlay) {
                    switch (target) {
                        case self.dateLayerNavigationBTNPrevMonth:
                            self.monthNavigate(-1);
                            prevent = true;
                            break;
                        case self.dateLayerNavigationBTNNextMonth:
                            self.monthNavigate(1);
                            prevent = true;
                            break;
                        case self.dateLayerNavigationLABELCurrentMonth:
                            self.setPickerDateSelectionPhase(EDatePickerSelectionPhase.YEAR);
                            prevent = true;
                            break;
                        default:
                            if ($(target).is('div[data-role=day][data-day][data-month]')) {
                                self.onDayCellClicked(parseInt(target.getAttribute('data-day')), parseInt(target.getAttribute('data-month')) - 1);
                                prevent = true;
                            }
                            else {
                                if ($(target).is('div[data-component=year] > [data-year]')) {
                                    self.onYearRowClicked(parseInt(target.getAttribute('data-year')));
                                    prevent = true;
                                }
                                else {
                                    if ($(target).is('div[data-component=month] > [data-month]')) {
                                        self.onMonthRowClicked(parseInt(target.getAttribute('data-month')) - 1);
                                        prevent = true;
                                    }
                                }
                            }
                    }
                }
                if (prevent) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            };
            self.touchMoveListener = function (e) {
                var target = (e.target || e.srcElement);
                if ($.contains(self.overlay, target) || target === self.overlay) {
                    e.preventDefault();
                }
                self.clickStarted = false;
            };
            self.touchStartListener = function (e) {
                var target = (e.target || e.srcElement);
                if ($.contains(self.overlay, target) || target === self.overlay) {
                    self.lastTouchPosition.left = e.touches[0].pageX;
                    self.lastTouchPosition.top = e.touches[0].pageY;
                }
                self.clickStarted = true;
            };
            self.touchEndListener = function (e) {
                if (self.clickStarted) {
                    self.bodyClickListener(e);
                }
            };
            window.addEventListener('scroll', function () {
                if (self.expandedInstance && !MouseUtils.isMobile()) {
                    self.expandedInstance.setExpanded(false);
                }
            }, true);
            window.addEventListener('resize', function (e) {
                if (self.expandedInstance) {
                    self.expandedInstance.setExpanded(false);
                }
            }, true);
            $(self.yearLayer).on('mousewheel wheel touchmove', function (e) {
                if (e.type == 'mousewheel' || e.type == 'wheel') {
                    self.yearScroll(e.originalEvent['deltaY'] < 0 ? -1 : 1);
                }
                else {
                    var scrollDirection = self.getVerticalScrollDirection(e.originalEvent);
                    if (scrollDirection === 0) {
                        return;
                    }
                    self.yearScroll(scrollDirection);
                }
                e.preventDefault();
            });
            $(self.monthLayer).on('mousewheel wheel touchmove', function (e) {
                if (e.type === 'mousewheel' || e.type == 'wheel') {
                    self.monthScroll(e.originalEvent['deltaY'] < 0 ? -1 : 1);
                }
                else {
                    var scrollDirection = self.getVerticalScrollDirection(e.originalEvent);
                    if (scrollDirection === 0) {
                        return;
                    }
                    self.monthScroll(scrollDirection);
                }
                e.preventDefault();
            });
        })(UI.getJQuery(), this);
    };
    UIDate.initOverlay = function (instance) {
        this.firstTime = true;
        if (this.expandedInstance) {
            this.expandedInstance.setExpanded(false);
        }
        if (!this.timeUtils) {
            this.timeUtils = TimeUtils.createInstanceInNonSingletonModeWithoutInternationalizationSupport();
        }
        if (instance && instance.getI18n()) {
            this.timeUtils.setI18nService();
            this.weekDaysI18n = instance && instance.getI18n().translateText('edt_date_picker_week_days') && instance.getI18n().translateText('edt_date_picker_week_days') !== 'edt_date_picker_week_days' && instance.getI18n().translateText('edt_date_picker_week_days').split(",");
        }
        if (null !== instance) {
            this.initOverlayElements();
        }
        this.expandedInstance = instance || null;
        if (this.expandedInstance) {
            this.initListeners();
            document.body.addEventListener('mousedown', this.bodyMouseDownListener, true);
            if (!MouseUtils.isMobile()) {
                document.body.addEventListener('click', this.bodyClickListener, true);
            }
            else {
                document.body.addEventListener('touchstart', this.touchStartListener, true);
                document.body.addEventListener('touchmove', this.touchMoveListener, { passive: false });
                document.body.addEventListener('touchend', this.touchEndListener, true);
            }
            document.body.appendChild(this.overlay);
            var inputRect = this.expandedInstance.rootNode.getBoundingClientRect(), overlayRect = this.overlay.getBoundingClientRect(), position = ElementPosition.getAnchorPosition(inputRect, overlayRect, UIDate.DISTANCE_BETWEEN_THE_OVERLAY_AND_THE_INPUT, ['center-bottom', 'center-top']);
            this.overlay.style.top = position.top + "px";
            this.overlay.style.left = position.left + "px";
            if (!MouseUtils.isMobile()) {
                this.overlay.style.top = position.top + "px";
                this.overlay.style.left = (inputRect.left + (inputRect.width - overlayRect.width)) + "px";
            }
            else {
                if (screen.height - inputRect.bottom - UIDate.DISTANCE_BETWEEN_THE_OVERLAY_AND_THE_INPUT - overlayRect.height - 100 < 0
                    && position.mode !== "center-top") {
                    if (document.body.offsetHeight > screen.height) {
                        this.overlay.style.top = ~~(inputRect.top) + ~~(inputRect.height / 2) - ~~(overlayRect.width / 2) + "px";
                        FormUtils.allBrowsersCompatibleScrollIntoView(this.expandedInstance.rootNode, { block: "center" });
                    }
                    else {
                        this.overlay.style.top = ~~(screen.height / 2) - ~~(overlayRect.height / 2) + "px";
                        this.overlay.style.left = ~~(screen.width / 2) - ~~(overlayRect.width / 2) + "px";
                    }
                }
                if (document.body.hasAttribute('data-is-wix-embedded')) {
                    this.overlay.style.top = ~~(position.top) + "px";
                    this.overlay.style.left = ~~(inputRect.left / 2) + "px";
                }
            }
            this.resetOverlay();
        }
        else {
            document.body.removeEventListener('mousedown', this.bodyMouseDownListener, true);
            if (!MouseUtils.isMobile()) {
                document.body.removeEventListener('click', this.bodyClickListener, true);
            }
            else {
                document.body.removeEventListener('touchstart', this.touchStartListener, true);
                document.body.removeEventListener('touchmove', this.touchMoveListener, true);
                document.body.removeEventListener('touchend', this.touchEndListener, true);
            }
            if (this.overlay.parentNode) {
                this.overlay.parentNode.removeChild(this.overlay);
            }
        }
    };
    UIDate.getVerticalScrollDirection = function (e) {
        var currentPoint = {
            left: e.touches[0].screenX,
            top: e.touches[0].screenY,
        }, delta = (currentPoint.top - this.lastTouchPosition.top);
        if (Math.abs(delta) > 10) {
            this.lastTouchPosition.top = currentPoint.top;
            return delta > 0
                ? 1
                : -1;
        }
        return 0;
    };
    UIDate.monthNavigate = function (relativeMonths) {
        this.localDate.setMonth(this.localDate.getMonth() + relativeMonths);
        this.paintDateOverlay();
    };
    UIDate.yearScroll = function (relativeYears) {
        this.localDate.setFullYear(this.localDate.getFullYear() + relativeYears);
        this.paintYearOverlay();
    };
    UIDate.monthScroll = function (relativeMonths) {
        this.localDate.setMonth(this.localDate.getMonth() + relativeMonths);
        this.paintMonthOverlay();
    };
    UIDate.onMonthRowClicked = function (zeroIndexedMonth) {
        this.firstTime = true;
        this.localDate.setMonth(zeroIndexedMonth);
        var hasDayComponent = this.expandedInstance.getFormat() !== DataValidator.VALIDATOR_TYPE_DATE_MMYYYY;
        if (hasDayComponent) {
            this.setPickerDateSelectionPhase(EDatePickerSelectionPhase.DAY);
        }
        else {
            this.localDate.setDate(1);
            this.expandedInstance.setDateValue(this.localDate);
            UI.getJQuery()(this.expandedInstance.getRootNode()).trigger('input');
            this.expandedInstance.setExpanded(false);
        }
    };
    UIDate.onYearRowClicked = function (year) {
        this.firstTime = true;
        this.localDate.setFullYear(year);
        this.setPickerDateSelectionPhase(EDatePickerSelectionPhase.MONTH);
    };
    UIDate.onDayCellClicked = function (day, monthZeroIndexBased) {
        this.localDate.setMonth(monthZeroIndexBased);
        this.localDate.setDate(day);
        this.paintDateOverlay();
        var isDayAccepted = true, acceptedDaysOfWeek = this.expandedInstance.getAcceptedDaysOfWeek();
        if (null !== acceptedDaysOfWeek) {
            if (acceptedDaysOfWeek.indexOf(this.localDate.getDay()) === -1) {
                isDayAccepted = false;
            }
        }
        if (isDayAccepted) {
            this.expandedInstance.setDateValue(this.localDate);
            UI.getJQuery()(this.expandedInstance.getRootNode()).trigger('input');
            this.expandedInstance.setExpanded(false);
        }
    };
    UIDate.setPickerDateSelectionPhase = function (phase) {
        this.selectionPhase = phase;
        switch (phase) {
            case EDatePickerSelectionPhase.DAY:
                this.overlay.setAttribute('data-selection-phase', 'day');
                this.paintDateOverlay();
                break;
            case EDatePickerSelectionPhase.MONTH:
                this.overlay.setAttribute('data-selection-phase', 'month');
                this.paintMonthOverlay();
                break;
            case EDatePickerSelectionPhase.YEAR:
                this.overlay.setAttribute('data-selection-phase', 'year');
                this.paintYearOverlay();
                break;
            case EDatePickerSelectionPhase.TIME:
                this.overlay.setAttribute('data-selection-phase', 'time');
                break;
        }
    };
    UIDate.updateOverlayHeaderText = function () {
        var currentDate = this.expandedInstance.getDateValue() || (new Date()), hasDayComponent = this.expandedInstance.getFormat() !== DataValidator.VALIDATOR_TYPE_DATE_MMYYYY;
        this.overlayHeader.textContent = this.timeUtils.formatTime(Math.floor(currentDate.getTime() / 1000), hasDayComponent
            ? '%a, %b %e, %Y'
            : '%b %Y');
    };
    UIDate.paintDateOverlay = function () {
        for (var i = 0; i < 7; i++) {
            while (this.dayOfWeekColumns[String(i)].childNodes.length > 1) {
                if (this.dayOfWeekColumns[String(i)].childNodes[0].textContent !== this.weekDays[i]) {
                    this.dayOfWeekColumns[String(i)].childNodes[0].textContent = this.weekDays[i];
                }
                this.dayOfWeekColumns[String(i)].removeChild(this.dayOfWeekColumns[String(i)].childNodes[1]);
            }
        }
        var dayCell, localDateCopy = new Date(), thisMonth, thisYear, weekDay, today = new Date(), inputDate = this.expandedInstance.getDateValue();
        localDateCopy.setTime(this.localDate.getTime());
        localDateCopy.setDate(1);
        localDateCopy.setHours(0);
        localDateCopy.setMinutes(0);
        localDateCopy.setSeconds(0);
        localDateCopy.setMilliseconds(0);
        thisMonth = localDateCopy.getMonth();
        thisYear = localDateCopy.getFullYear();
        this.dateLayerNavigationLABELCurrentMonth.textContent = this.timeUtils.formatTime(Math.round(localDateCopy.getTime() / 1000), '%M %Y');
        while (localDateCopy.getDay() != this.expandedInstance.getWeekStart()) {
            localDateCopy.setDate(localDateCopy.getDate() - 1);
        }
        while ((localDateCopy.getMonth() <= thisMonth && localDateCopy.getFullYear() === thisYear)
            ||
                (localDateCopy.getMonth() > thisMonth && localDateCopy.getFullYear() < thisYear)) {
            dayCell = document.createElement('div');
            dayCell.setAttribute('data-role', 'day');
            weekDay = localDateCopy.getDay();
            if (localDateCopy.getMonth() === thisMonth) {
                dayCell.textContent = String(localDateCopy.getDate());
                dayCell.setAttribute('data-day', String(localDateCopy.getDate()));
                dayCell.setAttribute('data-month', String(thisMonth + 1));
                if (localDateCopy.getDate() === today.getDate()
                    && localDateCopy.getMonth() === today.getMonth()
                    && localDateCopy.getFullYear() === today.getFullYear()) {
                    dayCell.className = (dayCell.className || '') + 'today ';
                }
                if (null !== inputDate
                    && localDateCopy.getDate() === inputDate.getDate()
                    && localDateCopy.getMonth() === inputDate.getMonth()
                    && localDateCopy.getFullYear() === inputDate.getFullYear()) {
                    dayCell.className = (dayCell.className || '') + 'selected ';
                }
            }
            this.dayOfWeekColumns[String(weekDay)].appendChild(dayCell);
            localDateCopy.setDate(localDateCopy.getDate() + 1);
        }
    };
    UIDate.paintMonthOverlay = function () {
        var cursorDate = new Date(), div;
        cursorDate.setTime(this.localDate.getTime());
        cursorDate.setDate(1);
        cursorDate.setMonth(cursorDate.getMonth() - 6);
        for (var i = 0; i < 12; i++) {
            if (this.firstTime) {
                div = document.createElement('div');
            }
            else {
                div = this.monthLayer.children.item(i);
            }
            div.classList.remove('current');
            div.setAttribute('data-month', String(cursorDate.getMonth() + 1));
            div.textContent = this.timeUtils.formatTime(Math.round(cursorDate.getTime() / 1000), '%M');
            if (cursorDate.getMonth() === this.localDate.getMonth()) {
                div.className = 'current';
            }
            if (true === this.firstTime) {
                this.monthLayer.appendChild(div);
            }
            cursorDate.setMonth(cursorDate.getMonth() + 1);
        }
        this.firstTime = false;
    };
    UIDate.paintYearOverlay = function () {
        var cursorDate = new Date(), div;
        cursorDate.setTime(this.localDate.getTime());
        cursorDate.setDate(1);
        cursorDate.setFullYear(cursorDate.getFullYear() - 6);
        for (var i = 0; i < 12; i++) {
            if (this.firstTime) {
                div = document.createElement('div');
            }
            else {
                div = this.yearLayer.children.item(i);
            }
            div.classList.remove('current');
            div.setAttribute('data-year', String(cursorDate.getFullYear()));
            div.textContent = this.timeUtils.formatTime(Math.round(cursorDate.getTime() / 1000), '%Y');
            if (cursorDate.getFullYear() === this.localDate.getFullYear()) {
                div.className = 'current';
            }
            if (this.firstTime) {
                this.yearLayer.appendChild(div);
            }
            cursorDate.setFullYear(cursorDate.getFullYear() + 1);
        }
        this.firstTime = false;
    };
    UIDate.paintCurrentOverlay = function () {
        switch (this.selectionPhase) {
            case EDatePickerSelectionPhase.DAY:
                this.paintDateOverlay();
                break;
            case EDatePickerSelectionPhase.MONTH:
                this.paintMonthOverlay();
                break;
            case EDatePickerSelectionPhase.YEAR:
                this.paintYearOverlay();
                break;
            case EDatePickerSelectionPhase.TIME:
            default:
                break;
        }
    };
    UIDate.resetOverlay = function () {
        var hasDayComponent = this.expandedInstance.getFormat() !== DataValidator.VALIDATOR_TYPE_DATE_MMYYYY, weekStart = this.expandedInstance.getWeekStart(), acceptedWeekDays = this.expandedInstance.getAcceptedDaysOfWeek();
        this.dayOfWeekColumns["0"].parentNode.removeChild(this.dayOfWeekColumns["0"]);
        if (weekStart === EDateWeekStart.MONDAY) {
            this.dateLayerDaysHolder.appendChild(this.dayOfWeekColumns["0"]);
        }
        else {
            this.dateLayerDaysHolder.insertBefore(this.dayOfWeekColumns["0"], this.dateLayerDaysHolder.firstChild);
        }
        for (var i = 0; i < 7; i++) {
            if (null === acceptedWeekDays || acceptedWeekDays.indexOf(i) > -1) {
                this.dayOfWeekColumns[String(i)].removeAttribute('data-forbidden-week-day');
            }
            else {
                this.dayOfWeekColumns[String(i)].setAttribute('data-forbidden-week-day', '');
            }
        }
        this.localDate = this.expandedInstance.getDateValue() || (new Date());
        this.setPickerDateSelectionPhase(hasDayComponent ? EDatePickerSelectionPhase.DAY : EDatePickerSelectionPhase.YEAR);
        this.updateOverlayHeaderText();
        this.paintCurrentOverlay();
    };
    UIDate.prototype.setI18n = function (i18n) {
        this.i18n = i18n || null;
        return this;
    };
    UIDate.prototype.getI18n = function () {
        return this.i18n || null;
    };
    UIDate.prototype.isDateFieldEmpty = function () {
        var isEmpty = true;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i].getValue()) {
                isEmpty = false;
                break;
            }
        }
        return isEmpty;
    };
    UIDate.DISTANCE_BETWEEN_THE_OVERLAY_AND_THE_INPUT = 5;
    UIDate.lastTouchPosition = {
        left: 0,
        top: 0,
    };
    UIDate.overlayFocusedElement = null;
    UIDate.dayOfWeekColumns = {
        "0": document.createElement('div'),
        "1": document.createElement('div'),
        "2": document.createElement('div'),
        "3": document.createElement('div'),
        "4": document.createElement('div'),
        "5": document.createElement('div'),
        "6": document.createElement('div'),
    };
    UIDate.weekDaysI18n = null;
    UIDate.weekDays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
    UIDate.clickStarted = false;
    UIDate.firstTime = true;
    return UIDate;
}(UIElement));
var UIDateGroup = (function () {
    function UIDateGroup(role, input) {
        this.role = role;
        this.input = input;
        this.root = document.createElement('div');
        this.root.setAttribute('data-role', 'date-part');
        this.root.setAttribute('data-part', this.getDatePartRoleName(role));
        this.root.setAttribute('aria-labelledby', 'date-' + this.input.getHash() + '-' + this.getDatePartRoleName(role));
        this.disabled = false;
        this.readOnly = false;
        switch (role) {
            case EDatePartRole.DAY:
                this.min = 1;
                this.max = 31;
                this.padLength = 2;
                break;
            case EDatePartRole.MONTH:
                this.min = 1;
                this.max = 12;
                this.padLength = 2;
                break;
            case EDatePartRole.YEAR:
                this.min = 0;
                this.max = 9999;
                this.padLength = 4;
                break;
            case EDatePartRole.HOUR_24:
                this.min = 0;
                this.max = 23;
                this.padLength = 2;
                break;
            case EDatePartRole.HOUR_12:
                this.min = 0;
                this.max = 12;
                this.padLength = 2;
                break;
            case EDatePartRole.MINUTE:
            case EDatePartRole.SECOND:
                this.min = 0;
                this.max = 59;
                this.padLength = 2;
                break;
            case EDatePartRole.MILLISECOND:
                this.min = 0;
                this.max = 999;
                this.padLength = 3;
                break;
            case EDatePartRole.AM_PM:
                this.min = 0;
                this.max = 1;
                this.padLength = 1;
                break;
        }
    }
    UIDateGroup.prototype.withDisabled = function (disabledState) {
        this.disabled = !!disabledState;
        if (this.disabled) {
            this.root.setAttribute('disabled', '');
        }
        else {
            this.root.removeAttribute('disabled');
        }
        return this;
    };
    UIDateGroup.prototype.isDisabled = function () {
        return this.disabled;
    };
    UIDateGroup.prototype.withReadOnly = function (readOnlyState) {
        this.readOnly = !!readOnlyState;
        if (this.readOnly) {
            this.root.setAttribute('readonly', '');
        }
        else {
            this.root.removeAttribute('readonly');
        }
        return this;
    };
    UIDateGroup.prototype.extractDatePartFrom = function (d) {
        if (null === d) {
            this.value = null;
        }
        else {
            switch (this.role) {
                case EDatePartRole.DAY:
                    this.value = d.getDate();
                    break;
                case EDatePartRole.MONTH:
                    this.value = d.getMonth() + 1;
                    break;
                case EDatePartRole.YEAR:
                    this.value = d.getFullYear();
                    break;
                case EDatePartRole.HOUR_24:
                    this.value = d.getHours();
                    break;
                case EDatePartRole.HOUR_12:
                    this.value = d.getHours() > 12
                        ? d.getHours() - 12
                        : d.getHours();
                    break;
                case EDatePartRole.MINUTE:
                    this.value = d.getMinutes();
                    break;
                case EDatePartRole.SECOND:
                    this.value = d.getSeconds();
                    break;
                case EDatePartRole.MILLISECOND:
                    this.value = d.getMilliseconds();
                    break;
                case EDatePartRole.AM_PM:
                    this.value = d.getHours() >= 12
                        ? 1
                        : 0;
                    break;
            }
        }
        this.render();
        return this;
    };
    UIDateGroup.prototype.render = function () {
        if (null === this.value) {
            this.root.setAttribute('data-is-null', '');
            var placeholder = this.getPlaceholder();
            this.root.textContent = placeholder.text;
            if (placeholder.intlKey) {
                this.root.setAttribute('data-i18n-text', placeholder.intlKey);
            }
        }
        else {
            this.root.removeAttribute('data-is-null');
            this.root.removeAttribute('data-i18n-text');
            if (this.role === EDatePartRole.AM_PM) {
                this.root.textContent = this.value === 0
                    ? 'AM'
                    : 'PM';
            }
            else {
                var r = String(this.value);
                while (r.length < this.padLength) {
                    r = '0' + r;
                }
                this.root.textContent = r;
            }
        }
    };
    UIDateGroup.prototype.getPlaceholder = function () {
        var result, intlKey;
        switch (this.role) {
            case EDatePartRole.DAY:
                result = 'dd';
                intlKey = 'textdef_63';
                break;
            case EDatePartRole.MONTH:
                result = 'mm';
                intlKey = 'textdef_62';
                break;
            case EDatePartRole.YEAR:
                result = 'yyyy';
                intlKey = 'textdef_64';
                break;
            case EDatePartRole.HOUR_24:
                result = 'hh';
                intlKey = 'textdef_65';
                break;
            case EDatePartRole.HOUR_12:
                result = 'hh';
                intlKey = 'textdef_65';
                break;
            case EDatePartRole.MINUTE:
                result = 'mm';
                intlKey = 'textdef_66';
                break;
            case EDatePartRole.SECOND:
                result = 'ss';
                break;
            case EDatePartRole.MILLISECOND:
                result = 'ms';
                break;
            case EDatePartRole.AM_PM:
                result = 'AM';
                break;
        }
        if (intlKey) {
            var translatedResult = UI.getI18n()
                ? UI.getI18n().translateText(intlKey)
                : result;
            return {
                text: translatedResult,
                intlKey: intlKey,
            };
        }
        else {
            return {
                text: result,
                intlKey: '',
            };
        }
    };
    UIDateGroup.prototype.getDatePartRoleName = function (role) {
        switch (role) {
            case EDatePartRole.DAY:
                return 'day';
            case EDatePartRole.MONTH:
                return 'month';
            case EDatePartRole.YEAR:
                return 'year';
            case EDatePartRole.HOUR_24:
                return 'hour-24';
            case EDatePartRole.HOUR_12:
                return 'hour-12';
            case EDatePartRole.MINUTE:
                return 'minute';
            case EDatePartRole.SECOND:
                return 'second';
            case EDatePartRole.MILLISECOND:
                return 'millisecond';
            case EDatePartRole.AM_PM:
                return 'am-pm';
            default:
                return 'invalid';
        }
    };
    UIDateGroup.prototype.addDigit = function (digit, setInsteadOfAdd) {
        if (setInsteadOfAdd === void 0) { setInsteadOfAdd = false; }
        var newValue;
        if (null === digit) {
            newValue = null;
        }
        else {
            if (null === this.value) {
                newValue = digit;
            }
            else {
                newValue = (10 * this.value) + digit;
                if (newValue > this.max) {
                    newValue = digit;
                }
            }
            if (String(newValue).length > this.padLength) {
                newValue = ~~(String(newValue).substr(1));
            }
            if (newValue < this.min || newValue > this.max) {
                return;
            }
        }
        this.value = newValue;
        this.input.rebuildDateFromParts();
        this.input.trigger('date-part-changed');
        this.render();
    };
    UIDateGroup.prototype.incDec = function (direction) {
        var newValue = this.value;
        if (null === newValue) {
            if (direction === 1) {
                newValue = this.min;
            }
            else {
                newValue = this.max;
            }
        }
        else {
            newValue += direction;
            if (newValue > this.max) {
                newValue = this.min;
            }
            else {
                if (newValue < this.min) {
                    newValue = this.max;
                }
            }
        }
        this.value = newValue;
        this.input.rebuildDateFromParts();
        this.input.trigger('date-part-changed');
        this.render();
    };
    UIDateGroup.prototype.handleKeyEvent = function (e) {
        if (this.disabled || this.readOnly) {
            return;
        }
        var keyCode = (e.keyCode || e.charCode) | 0, previousDateValue = this.input.getDateValue(), triggerChange = false;
        switch (keyCode | 0) {
            case 37:
                this.input.focusPreviousDatePartGroup();
                e.preventDefault();
                e.stopPropagation();
                break;
            case 38:
                this.incDec(1);
                triggerChange = true;
                e.preventDefault();
                e.stopPropagation();
                break;
            case 39:
                this.input.focusNextDatePartGroup();
                e.preventDefault();
                e.stopPropagation();
                break;
            case 40:
                this.incDec(-1);
                triggerChange = true;
                e.preventDefault();
                e.stopPropagation();
                break;
            case 8:
            case 46:
                this.addDigit(null);
                triggerChange = true;
                e.preventDefault();
                e.stopPropagation();
                break;
            case 48:
            case 96:
                this.addDigit(0);
                triggerChange = true;
                e.preventDefault();
                e.stopPropagation();
                break;
            case 49:
            case 97:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(1);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 50:
            case 98:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(2);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 51:
            case 99:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(3);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 52:
            case 100:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(4);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 53:
            case 101:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(5);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 54:
            case 102:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(6);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 55:
            case 103:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(7);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 56:
            case 104:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(8);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 57:
            case 105:
                if (this.role !== EDatePartRole.AM_PM) {
                    this.addDigit(9);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 65:
                if (this.role === EDatePartRole.AM_PM) {
                    this.addDigit(0);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 80:
                if (this.role === EDatePartRole.AM_PM) {
                    this.addDigit(1);
                    triggerChange = true;
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
            case 9:
                if (e.shiftKey) {
                    this.input.focusPreviousDatePartGroup();
                }
                else {
                    this.input.focusNextDatePartGroup();
                }
                if (!this.getRootNode().hasAttribute('data-is-focused')) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                break;
        }
        if (triggerChange) {
            var actualDateValue = void 0;
            try {
                actualDateValue = this.input.getDateValue();
            }
            catch (e) {
                actualDateValue = null;
            }
            if (!TimeUtils.dateEquals(actualDateValue, previousDateValue)) {
                UI.getJQuery()(this.input.getRootNode()).trigger('input');
            }
        }
    };
    UIDateGroup.prototype.getRootNode = function () {
        return this.root;
    };
    UIDateGroup.prototype.getRole = function () {
        return this.role;
    };
    UIDateGroup.prototype.getValue = function () {
        return this.value;
    };
    UIDateGroup.prototype.setValue = function (value) {
        this.value = value;
        this.input.rebuildDateFromParts();
        this.render();
    };
    return UIDateGroup;
}());
var UITime = (function (_super) {
    __extends(UITime, _super);
    function UITime() {
        var _this = _super.call(this, UI.ELEMENT_TYPE_TIME) || this;
        _this.dateGroups = [];
        _this.value = null;
        _this.expanded = false;
        _this.inputErrorState = EInputErrorState.FILLED;
        _this.expander = document.createElement('div');
        _this.expander.setAttribute('data-role', 'expander');
        _this.expander.setAttribute('role', 'application');
        if (MouseUtils.isMobile()) {
            _this.hiddenInput = document.createElement('input');
            _this.hiddenInput.style.display = 'block';
            _this.hiddenInput.style.border = 'none';
            _this.hiddenInput.style.width = '1px';
            _this.hiddenInput.style.height = '1px';
            _this.hiddenInput.style.opacity = '.1';
            _this.hiddenInput.style.position = 'absolute';
            _this.hiddenInput.style.right = _this.hiddenInput.style.top = '0';
            _this.rootNode.appendChild(_this.hiddenInput);
        }
        _this.init();
        return _this;
    }
    UITime.prototype.padNumber = function (n, toDigits) {
        var result = String(n || 0);
        while (result.length < toDigits) {
            result = '0' + result;
        }
        return result;
    };
    UITime.prototype.getAMPMHourPart = function (hour) {
        if (hour < 12) {
            return hour;
        }
        else {
            return hour - 12;
        }
    };
    UITime.prototype.getValue = function () {
        if (null === this.value) {
            return '';
        }
        switch (this.format) {
            case DataValidator.VALIDATOR_TYPE_TIME_AMPM:
                return this.padNumber(this.getAMPMHourPart(this.value.getHours()), 2)
                    + ':'
                    + this.padNumber(this.value.getMinutes(), 2)
                    + (EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL
                        ? ':' + this.padNumber(this.value.getSeconds(), 2)
                        : '')
                    + ' '
                    + (this.value.getHours() < 12 ? 'AM' : 'PM');
            case DataValidator.VALIDATOR_TYPE_TIME:
            default:
                return this.padNumber(this.value.getHours(), 2) + ':' + this.padNumber(this.value.getMinutes(), 2) + ':' + this.padNumber(this.value.getSeconds(), 2);
        }
    };
    UITime.prototype.hasDatePart = function (datePart) {
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i].getRole() === datePart) {
                return true;
            }
        }
        return false;
    };
    UITime.prototype.setValue = function (value) {
        var newValue;
        if ('string' !== typeof value) {
            newValue = null;
            console.warn('Invalid date: ', value);
        }
        else {
            value = value.trim();
            var matches = void 0, hour = null, minute = null, second = null, ampm = null;
            switch (this.format) {
                case DataValidator.VALIDATOR_TYPE_TIME_AMPM:
                    matches = /^([\d]{2}):([\d]{2})(:([\d]{2}))? (am|pm)$/i.exec(value);
                    if (matches) {
                        hour = parseInt(matches[1]);
                        minute = parseInt(matches[2]);
                        second = parseInt(matches[4] || '0');
                        ampm = ~~(matches[5].toLowerCase() === 'pm');
                        if (hour > 12 || minute > 59 || second > 59) {
                            hour = minute = second = null;
                        }
                        else {
                            if (0 === hour && 1 === ampm) {
                                hour = 12;
                            }
                            else if (12 === hour && 0 === ampm) {
                                hour = 0;
                            }
                            else {
                                if (1 === ampm && 12 !== hour) {
                                    hour += 12;
                                }
                            }
                        }
                    }
                    break;
                case DataValidator.VALIDATOR_TYPE_TIME:
                default:
                    matches = /^([\d]{2}):([\d]{2})(:([\d]{2}))?$/.exec(value);
                    if (matches) {
                        hour = parseInt(matches[1]);
                        minute = parseInt(matches[2]);
                        second = parseInt(matches[4] || '0');
                        if (hour > 23 || minute > 59 || second > 59) {
                            hour = minute = second = null;
                        }
                    }
                    break;
            }
            if (null === hour || null === minute || null === second) {
                newValue = null;
                console.warn('Invalid date: ', value);
            }
            else {
                newValue = new Date();
                newValue.setHours(hour);
                newValue.setMinutes(minute);
                newValue.setSeconds(second);
                newValue.setMilliseconds(0);
                newValue.setDate(1);
                newValue.setMonth(1);
                newValue.setFullYear(1970);
            }
            if (TimeUtils.dateEquals(this.value, newValue)) {
                return;
            }
            this.value = newValue;
            for (var i = 0, len = this.dateGroups.length; i < len; i++) {
                this.dateGroups[i].extractDatePartFrom(this.value);
            }
        }
    };
    UITime.prototype.withHash = function (hash) {
        this.hash = hash;
        return this;
    };
    UITime.prototype.getHash = function () {
        return this.hash;
    };
    UITime.prototype.setAccessibilityEnabled = function (value) {
        this.hasAccessibilityEnabled = value;
    };
    UITime.prototype.setFormat = function (format) {
        switch (format) {
            case DataValidator.VALIDATOR_TYPE_TIME_AMPM:
                this.dateGroups = !EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL
                    ? [
                        new UIDateGroup(EDatePartRole.HOUR_12, this),
                        new UIDateGroup(EDatePartRole.MINUTE, this),
                        new UIDateGroup(EDatePartRole.AM_PM, this),
                    ]
                    : [
                        new UIDateGroup(EDatePartRole.HOUR_12, this),
                        new UIDateGroup(EDatePartRole.MINUTE, this),
                        new UIDateGroup(EDatePartRole.SECOND, this),
                        new UIDateGroup(EDatePartRole.AM_PM, this),
                    ];
                break;
            case DataValidator.VALIDATOR_TYPE_TIME:
                this.dateGroups = !EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL
                    ? [
                        new UIDateGroup(EDatePartRole.HOUR_24, this),
                        new UIDateGroup(EDatePartRole.MINUTE, this),
                    ]
                    : [
                        new UIDateGroup(EDatePartRole.HOUR_24, this),
                        new UIDateGroup(EDatePartRole.MINUTE, this),
                        new UIDateGroup(EDatePartRole.SECOND, this),
                    ];
                break;
            default:
                throw new Error('Invalid date format! Expected time, time_ampm!');
        }
        this.format = format;
        this.rootNode.textContent = '';
        var timeWrapper = document.createElement('div');
        timeWrapper.setAttribute('data-role', 'time-wrapper');
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            this.dateGroups[i].withDisabled(this.disabled).withReadOnly(this.readOnly);
            this.dateGroups[i].extractDatePartFrom(this.value);
            timeWrapper.appendChild(this.dateGroups[i].getRootNode());
            switch (this.dateGroups[i].getRole()) {
                case EDatePartRole.HOUR_12:
                case EDatePartRole.HOUR_24:
                    this.dateGroups[i].getRootNode().setAttribute('id', 'time-' + this.hash + '-hour');
                    break;
                case EDatePartRole.MINUTE:
                    this.dateGroups[i].getRootNode().setAttribute('id', 'time-' + this.hash + '-minute');
                    break;
                case EDatePartRole.SECOND:
                    this.dateGroups[i].getRootNode().setAttribute('id', 'time-' + this.hash + '-second');
                    break;
                case EDatePartRole.AM_PM:
                    this.dateGroups[i].getRootNode().setAttribute('id', 'time-' + this.hash + '-am-pm');
                    break;
                default:
                    break;
            }
            timeWrapper.appendChild(this.dateGroups[i].getRootNode());
            if (i < len - 1) {
                timeWrapper.appendChild(document.createTextNode((i === len - 2 && DataValidator.VALIDATOR_TYPE_TIME_AMPM === this.format)
                    ? ' '
                    : ':'));
            }
        }
        this.updateAccessibilityFeature();
        this.rootNode.appendChild(timeWrapper);
        this.rootNode.appendChild(this.expander);
        this.setCurrentDateGroup(this.dateGroups[0] || null);
        if (this.hiddenInput) {
            this.rootNode.appendChild(this.hiddenInput);
        }
    };
    UITime.prototype.updateAccessibilityFeature = function () {
        if (this.hasAccessibilityEnabled) {
            var expanderText = document.createElement('div');
            expanderText.setAttribute('id', 'time-expander-text-acc');
            expanderText.appendChild(document.createTextNode('Click to choose time'));
            expanderText.style.display = 'none';
            this.expander.tabIndex = 0;
            this.expander.appendChild(expanderText);
            this.expander.setAttribute('aria-labelledby', 'time-expander-text-acc');
        }
        else {
            this.expander.removeAttribute('tabindex');
        }
    };
    UITime.prototype.getFormat = function () {
        return this.format;
    };
    UITime.prototype.getDateValue = function () {
        return this.value;
    };
    UITime.prototype.setDateValue = function (value) {
        if (null !== value && !(value instanceof Date)) {
            throw new Error('Invalid argument: Expected Date|null');
        }
        this.value = value;
        this.inputErrorState = null === value
            ? EInputErrorState.UNFILLED
            : EInputErrorState.FILLED;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            this.dateGroups[i].extractDatePartFrom(this.value);
        }
    };
    UITime.prototype.setCurrentDateGroup = function (dateGroup) {
        if (this.currentDateGroup) {
            this.currentDateGroup.getRootNode().removeAttribute('data-is-focused');
        }
        this.currentDateGroup = dateGroup || null;
        if (this.currentDateGroup) {
            this.currentDateGroup.getRootNode().setAttribute('data-is-focused', 'data-is-focused');
        }
    };
    UITime.prototype.queryDatePart = function (part) {
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i].getRole() === part) {
                return this.dateGroups[i].getValue();
            }
        }
        return null;
    };
    UITime.prototype.setDatePart = function (part, value) {
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i].getRole() === part) {
                this.dateGroups[i].setValue(value);
            }
        }
    };
    UITime.prototype.isDateValidIfDatePartIs = function (part, value) {
        return true;
    };
    UITime.prototype.rebuildDateFromParts = function () {
        var day = 1, month = 1, year = 1970, hour = null, minute = null, second = null, millisecond = 0, ampm = 0, d;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            switch (this.dateGroups[i].getRole()) {
                case EDatePartRole.HOUR_12:
                case EDatePartRole.HOUR_24:
                    hour = this.dateGroups[i].getValue();
                    break;
                case EDatePartRole.MINUTE:
                    minute = this.dateGroups[i].getValue();
                    break;
                case EDatePartRole.SECOND:
                    second = this.dateGroups[i].getValue();
                    break;
                case EDatePartRole.AM_PM:
                    ampm = null === this.dateGroups[i].getValue()
                        ? ETimeAntiPostMeridian.AM
                        : this.dateGroups[i].getValue();
                    break;
            }
        }
        switch (true) {
            case null === hour && null === minute:
                this.inputErrorState = EInputErrorState.UNFILLED;
                this.value = null;
                break;
            case null === hour || null === minute:
                this.inputErrorState = EInputErrorState.ERROR;
                break;
            default:
                d = new Date();
                d.setDate(day);
                d.setMonth(month - 1);
                d.setFullYear(year);
                d.setHours(hour + (ampm * 12));
                d.setMinutes(minute);
                d.setSeconds(second);
                d.setMilliseconds(millisecond);
                this.value = d;
                this.inputErrorState = EInputErrorState.FILLED;
                break;
        }
    };
    UITime.prototype.setExpanded = function (expandedState) {
        if (!this.isReadOnly()) {
            expandedState = !!expandedState;
            if (this.expander.querySelector('div')) {
                this.expander.querySelector('div').textContent = 'Click to expand';
            }
            if (expandedState === this.expanded) {
                return;
            }
            this.expanded = expandedState;
            var thisVal = this.getValue();
            UITime.initOverlay(expandedState ? this : null);
            var afterVal = this.getValue();
            if (thisVal !== afterVal) {
                UI.getJQuery()(this.rootNode).trigger('input');
            }
            if (expandedState) {
                this.expander.setAttribute('data-expanded', '1');
            }
            else {
                this.expander.removeAttribute('data-expanded');
            }
        }
    };
    UITime.prototype.init = function () {
        (function (self, $) {
            self.expander.addEventListener('keydown', function (e) {
                var shouldPreventDefault = false;
                var keyCode = e.keyCode || e.charCode;
                switch (keyCode) {
                    case KeyboardUtils.KEY_TAB:
                        if (self.expanded) {
                            UITime.focusNextOverlayElement(e);
                            shouldPreventDefault = true;
                        }
                        else {
                            self.expander.removeAttribute('tabindex');
                            setTimeout(function () {
                                self.expander.tabIndex = 0;
                            }, 1000);
                            return;
                        }
                        break;
                    case KeyboardUtils.KEY_UP:
                    case KeyboardUtils.KEY_DOWN:
                    case KeyboardUtils.KEY_LEFT:
                    case KeyboardUtils.KEY_RIGHT:
                        UITime.handleKeyboardPressButtonOnCurrentFocusedElement(e, keyCode);
                        shouldPreventDefault = true;
                        break;
                    case KeyboardUtils.KEY_ENTER:
                        self.setExpanded(true);
                        shouldPreventDefault = true;
                        break;
                    case KeyboardUtils.KEY_ESC:
                        self.setExpanded(false);
                        shouldPreventDefault = true;
                        break;
                    default:
                        shouldPreventDefault = false;
                        break;
                }
                if (shouldPreventDefault) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            }, true);
            $(self.rootNode).on('keydown', function (e) {
                if (self.expanded) {
                    return;
                }
                if (null !== self.currentDateGroup) {
                    if (MouseUtils.isMobile()) {
                        for (var i = 0, len = self.dateGroups.length; i < len; i++) {
                            if (document.activeElement === self.dateGroups[i].getRootNode() && self.dateGroups[i] !== self.currentDateGroup) {
                                self.setCurrentDateGroup(self.dateGroups[i]);
                                break;
                            }
                        }
                    }
                    self.currentDateGroup.handleKeyEvent(e);
                }
                self.trigger('keydown');
            });
            $(self.rootNode).on('blur', function () {
                self.setCurrentDateGroup(self.dateGroups[0]);
            });
            $(self.hiddenInput).on('focus', function (e) {
                setTimeout(function () {
                    $(self.rootNode).focus().click();
                    self.setExpanded(true);
                }, 100);
            });
            $(self.rootNode).on('mousedown', function (e) {
                var target = (e.target || e.srcElement);
                if (MouseUtils.isMobile()) {
                    self.setExpanded(true);
                }
                else {
                    if (target === self.expander) {
                        self.setExpanded(true);
                    }
                    else {
                        for (var i = 0, len = self.dateGroups.length; i < len; i++) {
                            if (self.dateGroups[i].getRootNode() === target) {
                                self.setCurrentDateGroup(self.dateGroups[i]);
                                return;
                            }
                        }
                    }
                }
            });
            Object.defineProperty(self.rootNode, 'value', {
                get: function () {
                    return self.getValue();
                },
                set: function (val) {
                    if (val && val instanceof Date) {
                        self.setDateValue(val);
                    }
                    else {
                        self.setValue(val);
                    }
                }
            });
            Object.defineProperty(self.rootNode, 'dateValue', {
                get: function () {
                    return self.getDateValue();
                },
                set: function (v) {
                    if (v && (v instanceof Date)) {
                        this.setDateValue(v);
                    }
                    else {
                        self.setDateValue(null);
                    }
                }
            });
            Object.defineProperty(self.rootNode, 'disabled', {
                get: function () {
                    return self.isDisabled();
                },
                set: function (disabledState) {
                    self.setDisabled(disabledState);
                }
            });
            Object.defineProperty(self.rootNode, 'readOnly', {
                get: function () {
                    return self.isReadOnly();
                },
                set: function (readOnlyState) {
                    self.setReadOnly(readOnlyState);
                }
            });
        })(this, UI.getJQuery());
    };
    UITime.prototype.focusPreviousDatePartGroup = function () {
        var currentGroupIndex = null;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i] === this.currentDateGroup) {
                currentGroupIndex = i;
                break;
            }
        }
        this.setCurrentDateGroup(this.dateGroups[(currentGroupIndex || 0) - 1] || this.dateGroups[0] || null);
    };
    UITime.prototype.focusNextDatePartGroup = function () {
        var currentGroupIndex = null;
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            if (this.dateGroups[i] === this.currentDateGroup) {
                currentGroupIndex = i;
                break;
            }
        }
        this.setCurrentDateGroup(this.dateGroups[(currentGroupIndex || 0) + 1] || this.dateGroups[this.dateGroups.length - 1] || null);
    };
    UITime.prototype.setDisabled = function (disabledState) {
        _super.prototype.setDisabled.call(this, disabledState);
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            this.dateGroups[i].withDisabled(this.disabled);
        }
    };
    UITime.prototype.setReadOnly = function (readOnlyState) {
        _super.prototype.setReadOnly.call(this, readOnlyState);
        for (var i = 0, len = this.dateGroups.length; i < len; i++) {
            this.dateGroups[i].withReadOnly(this.readOnly);
        }
    };
    UITime.getVerticalScrollDirectionReversed = function (e) {
        var currentPoint = {
            left: e.touches[0].screenX,
            top: e.touches[0].screenY,
        }, delta = 0;
        if (Math.abs(delta = (currentPoint.top - this.lastTouchPosition.top)) > 10) {
            this.lastTouchPosition.top = currentPoint.top;
            return delta > 0
                ? -1
                : 1;
        }
        return 0;
    };
    UITime.emulateFocusOnOverlayActiveElement = function () {
        if (null === this.overlayFocusedElement) {
            return;
        }
        this.overlayFocusedElement.setAttribute('data-soft-focused', '1');
    };
    UITime.emulateBlurOnOverlayActiveElement = function () {
        if (null === this.overlayFocusedElement) {
            return;
        }
        this.overlayFocusedElement.removeAttribute('data-soft-focused');
    };
    UITime.focusNextOverlayElement = function (e) {
        if (!this.expandedInstance) {
            return;
        }
        this.emulateBlurOnOverlayActiveElement();
        if (!e.shiftKey) {
            switch (this.overlayFocusedElement) {
                case this.overlayHeader:
                    this.overlayFocusedElement = this.timeHoursColumn;
                    break;
                case this.timeHoursColumn:
                    this.overlayFocusedElement = this.timeMinutesColumn;
                    break;
                case this.timeMinutesColumn:
                default:
                    this.overlayFocusedElement = this.overlayHeader;
                    break;
            }
        }
        else {
            switch (this.overlayFocusedElement) {
                case this.overlayHeader:
                    this.overlayFocusedElement = this.timeMinutesColumn;
                    break;
                case this.timeMinutesColumn:
                    this.overlayFocusedElement = this.timeHoursColumn;
                    break;
                case this.timeHoursColumn:
                default:
                    this.overlayFocusedElement = this.overlayHeader;
                    break;
            }
        }
        this.emulateFocusOnOverlayActiveElement();
    };
    UITime.handleKeyboardPressButtonOnCurrentFocusedElement = function (e, pressedKey) {
        if (!this.expandedInstance) {
            return;
        }
        switch (this.overlayFocusedElement) {
            case this.overlayHeader:
                switch (pressedKey) {
                    case KeyboardUtils.KEY_LEFT:
                    case KeyboardUtils.KEY_RIGHT:
                        this.incrementDatePart('hours', 12);
                        break;
                }
                break;
            case this.timeHoursColumn:
                switch (pressedKey) {
                    case KeyboardUtils.KEY_UP:
                        this.incrementDatePart('hours', -1);
                        break;
                    case KeyboardUtils.KEY_DOWN:
                        this.incrementDatePart('hours', 1);
                        break;
                }
                break;
            case this.timeMinutesColumn:
                switch (pressedKey) {
                    case KeyboardUtils.KEY_UP:
                        this.incrementDatePart('minutes', -1);
                        break;
                    case KeyboardUtils.KEY_DOWN:
                        this.incrementDatePart('minutes', 1);
                        break;
                }
                break;
        }
    };
    UITime.initOverlay = function (instance) {
        var _this = this;
        if (this.expandedInstance) {
            this.expandedInstance.setExpanded(false);
        }
        this.overlayFocusedElement = null;
        if (!this.timeUtils) {
            this.timeUtils = TimeUtils.createInstanceInNonSingletonModeWithoutInternationalizationSupport();
        }
        if (!this.overlay && null !== instance) {
            this.overlay = document.createElement('div');
            this.overlay.setAttribute('data-role', 'date-overlay');
            this.overlay.setAttribute('data-selection-phase', 'time');
            this.overlayModal = document.createElement('div');
            this.overlayModal.className = 'ui-modal';
            this.overlayModal.setAttribute('data-transparent', '1');
            if (!MouseUtils.isMobile()) {
                this.overlay.appendChild(this.overlayModal);
            }
            this.overlayHeader = document.createElement('div');
            this.overlayHeader.setAttribute('data-component', 'header');
            this.overlay.appendChild(this.overlayHeader);
            this.overlayHeaderAMButton = document.createElement('div');
            this.overlayHeaderAMButton.textContent = 'AM';
            this.overlayHeaderAMButton.setAttribute('data-role', 'button');
            this.overlayHeaderAMButton.setAttribute('data-value', '0');
            this.overlayHeaderPMButton = document.createElement('div');
            this.overlayHeaderPMButton.textContent = 'PM';
            this.overlayHeaderPMButton.setAttribute('data-role', 'button');
            this.overlayHeaderPMButton.setAttribute('data-value', '1');
            this.overlayHeader.appendChild(this.overlayHeaderAMButton);
            this.overlayHeader.appendChild(this.overlayHeaderPMButton);
            this.timeLayer = document.createElement('div');
            this.timeLayer.setAttribute('data-component', 'time');
            this.timeHoursColumn = document.createElement('div');
            this.timeHoursColumn.setAttribute('data-role', 'hours');
            this.timeMinutesColumn = document.createElement('div');
            this.timeMinutesColumn.setAttribute('data-role', 'minutes');
            if (EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL) {
                this.timeSecondsColumn = document.createElement('div');
                this.timeSecondsColumn.setAttribute('data-role', 'seconds');
            }
            this.timeLayer.appendChild(this.timeHoursColumn);
            this.timeLayer.appendChild(this.timeMinutesColumn);
            if (EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL) {
                this.timeLayer.appendChild(this.timeSecondsColumn);
            }
            this.overlay.appendChild(this.timeLayer);
            this.overlayFooter = document.createElement('div');
            this.overlayFooter.setAttribute('data-component', 'footer');
            this.overlay.appendChild(this.overlayFooter);
            this.overlayFooterDoneButton = document.createElement('div');
            this.overlayFooterDoneButton.textContent = FormUtils.getUiTranslatedString('ui_time_done_text', 'Done');
            this.overlayFooterDoneButton.setAttribute('data-role', 'button');
            this.overlayFooter.appendChild(this.overlayFooterDoneButton);
        }
        if (!this.bodyMouseDownListener) {
            (function ($, self) {
                self.bodyMouseDownListener = function (e) {
                    var target = (e.target || e.srcElement);
                    if (target !== self.overlayModal && ($.contains(self.overlay, target) || target === self.overlay)) {
                    }
                    else {
                        if (null !== self.expandedInstance) {
                            self.expandedInstance.setExpanded(false);
                        }
                    }
                };
                self.bodyClickListener = function (e) {
                    var target = (e.target || e.srcElement);
                    if ($.contains(self.overlay, target) || target === self.overlay) {
                    }
                };
                self.touchMoveListener = function (e) {
                    var target = (e.target || e.srcElement);
                    if ($.contains(self.overlay, target) || target === self.overlay) {
                        e.preventDefault();
                    }
                };
                self.touchStartListener = function (e) {
                    var target = (e.target || e.srcElement);
                    if ($.contains(self.overlay, target) || target === self.overlay) {
                        self.lastTouchPosition.left = e.touches[0].pageX;
                        self.lastTouchPosition.top = e.touches[0].pageY;
                    }
                };
                window.addEventListener('scroll', function (e) {
                    if (self.expandedInstance) {
                        self.expandedInstance.setExpanded(false);
                    }
                }, true);
                window.addEventListener('resize', function (e) {
                    if (self.expandedInstance) {
                        self.expandedInstance.setExpanded(false);
                    }
                }, true);
                $(self.timeLayer).on('mousewheel wheel touchmove', '[data-role=hours], [data-role=minutes], [data-role=seconds]', function (e) {
                    var myRole = this.getAttribute('data-role');
                    var scrollDirection;
                    if (e.type === 'mousewheel' || e.type == 'wheel') {
                        scrollDirection = e.originalEvent.deltaY < 0
                            ? -1
                            : 1;
                    }
                    else {
                        scrollDirection = self.getVerticalScrollDirectionReversed(e.originalEvent);
                        if (scrollDirection === 0) {
                            return;
                        }
                    }
                    self.incrementDatePart(myRole, scrollDirection);
                    e.preventDefault();
                });
                $(self.overlayHeader).on('click', '[data-role=button][data-value]', function (e) {
                    var value = ~~this.getAttribute('data-value');
                    switch (value) {
                        case 0:
                            if (self.localDate.getHours() >= 12) {
                                self.localDate.setHours(self.localDate.getHours() - 12);
                                self.paintHours();
                                self.expandedInstance.setDateValue(self.localDate);
                                UI.getJQuery()(self.expandedInstance.getRootNode()).trigger('input');
                            }
                            break;
                        case 1:
                            if (self.localDate.getHours() < 12) {
                                self.localDate.setHours(self.localDate.getHours() + 12);
                                self.paintHours();
                                self.expandedInstance.setDateValue(self.localDate);
                                UI.getJQuery()(self.expandedInstance.getRootNode()).trigger('input');
                            }
                            break;
                    }
                });
                $(self.timeLayer).on('click', '[data-role=hours] > div, [data-role=minutes] > div, [data-role=seconds] > div', function (e) {
                    var targetPart, value;
                    switch (true) {
                        case this.hasAttribute('data-hour'):
                            targetPart = 'hours';
                            value = ~~this.getAttribute('data-hour');
                            self.localDate.setHours(value);
                            self.paintHours();
                            break;
                        case this.hasAttribute('data-minute'):
                            targetPart = 'minutes';
                            value = ~~this.getAttribute('data-minute');
                            self.localDate.setMinutes(value);
                            self.paintMinutes();
                            break;
                        case this.hasAttribute('data-second'):
                            targetPart = 'seconds';
                            value = ~~this.getAttribute('data-second');
                            self.localDate.setSeconds(value);
                            self.paintSeconds();
                            break;
                    }
                    self.expandedInstance.setDateValue(self.localDate);
                    UI.getJQuery()(self.expandedInstance.getRootNode()).trigger('input');
                });
            })(UI.getJQuery(), this);
            this.overlayFooterDoneButton.onclick = function () { return _this.expandedInstance.setExpanded(false); };
        }
        this.expandedInstance = instance || null;
        if (this.expandedInstance) {
            document.body.addEventListener('mousedown', this.bodyMouseDownListener, true);
            document.body.addEventListener('click', this.bodyClickListener, true);
            document.body.addEventListener('touchstart', this.touchStartListener, true);
            document.body.addEventListener('touchmove', this.touchMoveListener, { passive: false });
            document.body.appendChild(this.overlay);
            var inputRect = this.expandedInstance.rootNode.getBoundingClientRect(), overlayRect = this.overlay.getBoundingClientRect(), position = ElementPosition.getAnchorPosition(inputRect, overlayRect, UITime.DISTANCE_BETWEEN_OVERLAY_AND_INPUT, ['center-bottom', 'center-top']);
            this.overlay.style.top = position.top + "px";
            this.overlay.style.left = position.left + "px";
            if (!MouseUtils.isMobile()) {
                this.overlay.style.top = position.top + "px";
                if ((screen.width - inputRect.left + (inputRect.width - overlayRect.width)) > 0) {
                    this.overlay.style.left = (inputRect.left + (inputRect.width - overlayRect.width)) + "px";
                }
            }
            else {
                if (screen.height - inputRect.bottom - UITime.DISTANCE_BETWEEN_OVERLAY_AND_INPUT - overlayRect.height - 100 < 0
                    && position.mode !== "center-top") {
                    if (document.body.offsetHeight > screen.height) {
                        this.overlay.style.top = ~~(inputRect.top) + ~~(inputRect.height / 2) - ~~(overlayRect.width / 2) + "px";
                        FormUtils.allBrowsersCompatibleScrollIntoView(this.expandedInstance.rootNode, { block: "center" });
                    }
                    else {
                        this.overlay.style.top = ~~(screen.height / 2) - ~~(overlayRect.height / 2) + "px";
                        this.overlay.style.left = ~~(screen.width / 2) - ~~(overlayRect.width / 2) + "px";
                    }
                }
                if (document.body.hasAttribute('data-is-wix-embedded')) {
                    this.overlay.style.top = ~~(position.top) + "px";
                    this.overlay.style.left = ~~(inputRect.left / 2) + "px";
                }
            }
            this.resetOverlay();
        }
        else {
            document.body.removeEventListener('mousedown', this.bodyMouseDownListener, true);
            document.body.removeEventListener('click', this.bodyClickListener, true);
            document.body.removeEventListener('touchmove', this.touchMoveListener, true);
            document.body.removeEventListener('touchstart', this.touchStartListener, true);
            if (this.overlay.parentNode) {
                this.overlay.parentNode.removeChild(this.overlay);
            }
        }
    };
    UITime.incrementDatePart = function (datePartRole, incrementDirection) {
        var minute = this.localDate.getMinutes(), second = this.localDate.getSeconds(), hour = this.localDate.getHours();
        switch (datePartRole) {
            case 'hours':
                this.localDate.setHours(this.localDate.getHours() + incrementDirection);
                this.localDate.setMinutes(minute);
                this.localDate.setSeconds(second);
                this.paintHours();
                break;
            case 'minutes':
                this.localDate.setMinutes(this.localDate.getMinutes() + incrementDirection);
                this.localDate.setHours(hour);
                this.localDate.setSeconds(second);
                this.paintMinutes();
                break;
            case 'seconds':
                this.localDate.setSeconds(this.localDate.getSeconds() + incrementDirection);
                this.localDate.setMinutes(minute);
                this.localDate.setHours(hour);
                this.paintSeconds();
                break;
        }
        this.expandedInstance.setDateValue(this.localDate);
        UI.getJQuery()(this.expandedInstance.getRootNode()).trigger('input');
        var accessibilityDiv = this.expandedInstance.expander.querySelector('div');
        if (accessibilityDiv) {
            accessibilityDiv.textContent = this.expandedInstance.getValue();
        }
        this.expandedInstance.expander.focus();
    };
    UITime.paintHours = function () {
        var is12Format = this.expandedInstance.hasDatePart(EDatePartRole.AM_PM), cursorDate = new Date(), div;
        if (this.localDate) {
            cursorDate.setTime(this.localDate.getTime());
        }
        if (cursorDate.getHours() < 12) {
            this.overlayHeaderAMButton.setAttribute('data-is-active', '');
            this.overlayHeaderPMButton.removeAttribute('data-is-active');
        }
        else {
            this.overlayHeaderPMButton.setAttribute('data-is-active', '');
            this.overlayHeaderAMButton.removeAttribute('data-is-active');
        }
        cursorDate.setHours(cursorDate.getHours() - this.UNIT_COLUMN_MIDDLE_ELEMENT_INDEX);
        for (var i = 0; i < this.UNIT_COLUMN_NUMBER_OF_ELEMENTS; i++) {
            if (this.firstTimeHours) {
                div = document.createElement('div');
            }
            else {
                div = this.timeHoursColumn.children.item(i);
            }
            div.setAttribute('data-hour', String(cursorDate.getHours()));
            if (is12Format) {
                div.textContent = cursorDate.getHours() < 13
                    ? String(cursorDate.getHours())
                    : String(cursorDate.getHours() - 12);
            }
            else {
                div.textContent = String(cursorDate.getHours());
            }
            if (i === this.UNIT_COLUMN_MIDDLE_ELEMENT_INDEX) {
                div.setAttribute('data-is-current', '');
            }
            if (this.firstTimeHours) {
                this.timeHoursColumn.appendChild(div);
            }
            cursorDate.setHours(cursorDate.getHours() + 1);
        }
        this.firstTimeHours = false;
    };
    UITime.paintMinutes = function () {
        var cursorDate = new Date(), div;
        if (this.localDate) {
            cursorDate.setTime(this.localDate.getTime());
        }
        cursorDate.setMinutes(cursorDate.getMinutes() - this.UNIT_COLUMN_MIDDLE_ELEMENT_INDEX);
        for (var i = 0; i < this.UNIT_COLUMN_NUMBER_OF_ELEMENTS; i++) {
            if (this.firstTimeMinutes) {
                div = document.createElement('div');
            }
            else {
                div = this.timeMinutesColumn.children.item(i);
            }
            div.setAttribute('data-minute', String(cursorDate.getMinutes()));
            var minutes = String(cursorDate.getMinutes());
            if (parseInt(minutes) < 10) {
                minutes = '0' + minutes;
            }
            div.textContent = minutes;
            if (i === this.UNIT_COLUMN_MIDDLE_ELEMENT_INDEX) {
                div.setAttribute('data-is-current', '');
            }
            if (this.firstTimeMinutes) {
                this.timeMinutesColumn.appendChild(div);
            }
            cursorDate.setMinutes(cursorDate.getMinutes() + 1);
        }
        this.firstTimeMinutes = false;
    };
    UITime.paintSeconds = function () {
        if (!EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL) {
            return;
        }
        var cursorDate = new Date(), div;
        if (this.localDate) {
            cursorDate.setTime(this.localDate.getTime());
        }
        cursorDate.setSeconds(cursorDate.getSeconds() - this.UNIT_COLUMN_MIDDLE_ELEMENT_INDEX);
        while (this.timeSecondsColumn.firstChild) {
            this.timeSecondsColumn.removeChild(this.timeSecondsColumn.firstChild);
        }
        for (var i = 0; i < this.UNIT_COLUMN_NUMBER_OF_ELEMENTS; i++) {
            div = document.createElement('div');
            div.setAttribute('data-second', String(cursorDate.getSeconds()));
            div.textContent = String(cursorDate.getSeconds());
            if (i === this.UNIT_COLUMN_MIDDLE_ELEMENT_INDEX) {
                div.setAttribute('data-is-current', '');
            }
            this.timeSecondsColumn.appendChild(div);
            cursorDate.setSeconds(cursorDate.getSeconds() + 1);
        }
    };
    UITime.resetOverlay = function () {
        this.localDate = this.expandedInstance.getDateValue() || (function () {
            var result = new Date();
            result.setDate(1);
            result.setMonth(0);
            result.setFullYear(1970);
            return result;
        })();
        if (this.expandedInstance.hasDatePart(EDatePartRole.AM_PM)) {
            this.overlayHeader.setAttribute('data-format', '12');
            this.overlay.setAttribute('time-overlay-data-format', '12');
        }
        else {
            this.overlayHeader.setAttribute('data-format', '24');
            this.overlay.setAttribute('time-overlay-data-format', '24');
        }
        var classes = [];
        if (this.expandedInstance.hasDatePart(EDatePartRole.HOUR_12) || this.expandedInstance.hasDatePart(EDatePartRole.HOUR_24)) {
            classes.push('has-hours');
            this.paintHours();
        }
        if (this.expandedInstance.hasDatePart(EDatePartRole.MINUTE)) {
            classes.push('has-minutes');
            this.paintMinutes();
        }
        if (this.expandedInstance.hasDatePart(EDatePartRole.SECOND)) {
            classes.push('has-seconds');
            this.paintSeconds();
        }
        this.timeLayer.className = classes.join(' ');
        this.timeLayer.setAttribute('data-num-groups', String(classes.length));
        this.expandedInstance.setDateValue(this.localDate);
    };
    UITime.prototype.getInputErrorState = function () {
        return this.inputErrorState;
    };
    UITime.DISTANCE_BETWEEN_OVERLAY_AND_INPUT = 5;
    UITime.lastTouchPosition = {
        left: 0,
        top: 0,
    };
    UITime.overlayFocusedElement = null;
    UITime.firstTimeHours = true;
    UITime.firstTimeMinutes = true;
    UITime.UNIT_COLUMN_NUMBER_OF_ELEMENTS = 7;
    UITime.UNIT_COLUMN_MIDDLE_ELEMENT_INDEX = 3;
    return UITime;
}(UIElement));
var UIFile = (function (_super) {
    __extends(UIFile, _super);
    function UIFile() {
        var _this = _super.call(this, UI.ELEMENT_TYPE_FILE) || this;
        _this.files = [];
        _this.minUploadSizeInBytes = null;
        _this.maxUploadSizeInBytes = null;
        _this.allowedExtensions = null;
        _this.forbiddenExtensions = null;
        _this.instanceId = UIFile.INSTANCE_ID;
        UIFile.INSTANCE_ID++;
        _this.uploadOverlay = document.createElement('div');
        _this.uploadOverlay.setAttribute('data-role', 'upload-overlay');
        _this.uploadInput = document.createElement('input');
        _this.uploadInput.setAttribute('type', 'file');
        _this.placeholder = document.createElement('div');
        _this.placeholder.setAttribute('data-role', 'placeholder');
        _this.placeholder.textContent = 'Choose files or drag here';
        _this.placeholder.setAttribute('data-i18n-text', 'textdef_216');
        _this.uploadsContainer = document.createElement('div');
        _this.uploadsContainer.setAttribute('data-role', 'files-container');
        _this.rootNode.appendChild(_this.uploadsContainer);
        _this.abortAllUploadsButton = document.createElement('div');
        _this.abortAllUploadsButton.setAttribute('data-role', 'abort-all-uploads');
        _this.abortAllUploadsButton.textContent = 'Delete all uploads';
        _this.abortAllUploadsButton.setAttribute('data-i18n-text', 'textdef_217');
        _this.rootNode.appendChild(_this.abortAllUploadsButton);
        _this.rootNode.appendChild(_this.uploadOverlay);
        _this.uploadOverlay.appendChild(_this.uploadInput);
        _this.uploadOverlay.appendChild(_this.placeholder);
        if (_this.hasAccessibilityEnabled) {
            _this.uploadOverlay.setAttribute('tabindex', '0');
        }
        else {
            _this.uploadOverlay.removeAttribute('tabindex');
        }
        _this.rootNode.removeAttribute('tabindex');
        _this.onUploadNumberChanged();
        _this.init();
        return _this;
    }
    UIFile.prototype.withControl = function (control) {
        this.control = control;
        this.updateAccessibilityAttributes();
        return this;
    };
    UIFile.prototype.setAccessibility = function (value) {
        this.hasAccessibilityEnabled = value;
    };
    UIFile.prototype.getFilesList = function () {
        var result = [];
        for (var i = 0, len = this.files.length; i < len; i++) {
            if (this.files[i].getUploadStatus() === EUploadState.SUCCESS) {
                result.push({
                    id: 0,
                    name: this.files[i].getName(),
                    mimeType: this.control.getForm().getEngine().getUploadsService().getMimeType(this.files[i].getName()),
                    size: this.files[i].getSize(),
                    hash: this.files[i].getHash(),
                    data: this.files[i].getData() || '',
                });
            }
        }
        return result.length
            ? result
            : null;
    };
    UIFile.prototype.getValue = function () {
        var result = [];
        for (var i = 0, files = this.getFilesList() || [], len = files.length; i < len; i++) {
            result.push(files[i].name.indexOf(' ') > -1 ? '"' + files[i].name + '"' : files[i].name);
        }
        return result.length
            ? result.join(' ')
            : '';
    };
    UIFile.prototype.setValue = function (value) {
        var newFilesList = [], isQuote = false, currentFileName = '', ch, numFiles;
        value = String(value || '');
        if ('' !== value) {
            for (var i = 0, len = value.length; i < len; i++) {
                switch (ch = value.charAt(i)) {
                    case '"':
                        isQuote = !isQuote;
                        if (!isQuote) {
                            if ('' !== currentFileName) {
                                newFilesList.push(currentFileName);
                                currentFileName = '';
                            }
                            else {
                                throw new Error('Invalid value: Empty file name not allowed!');
                            }
                        }
                        break;
                    case ' ':
                        if (isQuote) {
                            currentFileName += ' ';
                        }
                        else {
                            if ('' !== currentFileName) {
                                newFilesList.push(currentFileName);
                                currentFileName = '';
                            }
                            else {
                                throw new Error('Invalid value: Empty file name not allowed!');
                            }
                        }
                        break;
                    default:
                        currentFileName = currentFileName.concat(ch);
                        break;
                }
            }
            if ('' !== currentFileName) {
                newFilesList.push(currentFileName);
            }
        }
        if (newFilesList.length > 1 && !this.isMultiple()) {
            throw new Error('Too many files!');
        }
        (function ($, self) {
            $.when.apply($, (function () {
                var result = [];
                for (var i = 0, len = self.files.length; i < len; i++) {
                    result.push(self.files[i].cancel());
                }
                return result || true;
            })()).then(function () {
                self.files = [];
                while (self.uploadsContainer.firstChild) {
                    self.uploadsContainer.removeChild(self.uploadsContainer.firstChild);
                }
                var upload;
                for (var i = 0, len = newFilesList.length; i < len; i++) {
                    upload = new UIFileUpload();
                    upload.updateAccessibilityAttributes(UUID.nextString, this.hasAccessibilityEnabled);
                    upload.withName(newFilesList[i]).withFileUtils(this.fileUtils);
                    self.files.push(upload);
                    self.uploadsContainer.appendChild(upload.getRootNode());
                }
                self.onUploadNumberChanged();
            });
        })(UI.getJQuery(), this);
    };
    UIFile.prototype.onUploadNumberChanged = function () {
        var numberOfUploads = this.files.length;
        this.rootNode.setAttribute('data-num-files', String(numberOfUploads));
        if (numberOfUploads < UIFile.MIN_NUMBER_OF_CONTROLS_IN_ORDER_TO_DISPLAY_THE_ABORT_ALL_DOWNLOADS_BUTTON) {
            this.rootNode.removeAttribute('data-has-abort-all-uploads');
        }
        else {
            this.rootNode.setAttribute('data-has-abort-all-uploads', '');
        }
        FormUtils.refreshFrameHeightOnWix();
    };
    UIFile.prototype.addFile = function (file) {
        var _this = this;
        if (!this.control) {
            return;
        }
        if (!this.control.isAttached()) {
            return;
        }
        if (this.isMultiple()) {
            var upload = new UIFileUpload();
            this.files.push(upload);
            upload.withName(file.file.name).withFileUtils(this.fileUtils);
            upload.updateAccessibilityAttributes(UUID.nextString, this.hasAccessibilityEnabled);
            this.uploadsContainer.appendChild(upload.getRootNode());
            upload.withUpload(this.control.getForm().getEngine().getUploadsService().addToQOS(this.control.getForm().getEngine().getUploadsService().createUpload(file.file).withUploaderInstanceIndex(this.instanceId)
                .withControlId(this.control.getId())
                .withArchivePacking(this.isMultiple())
                .on('success', function () {
                _this.onChange();
            })));
            this.onUploadNumberChanged();
        }
        else {
            (function ($, self) {
                if (self.files.length === 0) {
                    return $.Deferred(function (defer) {
                        defer.resolve(true);
                    }).promise();
                }
                else {
                    return $.Deferred(function (defer) {
                        self.files[0].cancel().then(function () {
                            self.uploadsContainer.removeChild(self.files[0].getRootNode());
                            self.files.splice(0, 1);
                            self.onUploadNumberChanged();
                            defer.resolve(true);
                        });
                    }).promise();
                }
            })(UI.getJQuery(), this).then(function () {
                var upload = new UIFileUpload();
                _this.files.push(upload);
                upload.withName(file.file.name).withFileUtils(_this.fileUtils);
                upload.updateAccessibilityAttributes(UUID.nextString, _this.hasAccessibilityEnabled);
                _this.uploadsContainer.appendChild(upload.getRootNode());
                upload.withUpload(_this.control.getForm().getEngine().getUploadsService().addToQOS(_this.control.getForm().getEngine().getUploadsService().createUpload(file.file)
                    .withUploaderInstanceIndex(_this.instanceId)
                    .withControlId(_this.control.getId())
                    .withArchivePacking(_this.isMultiple())
                    .on('success', function () {
                    _this.onChange();
                })));
                _this.onUploadNumberChanged();
            });
        }
    };
    UIFile.prototype.removeUpload = function (uploadRootNode) {
        var _this = this;
        var upload = null;
        for (var i = 0, len = this.files.length; i < len; i++) {
            if (this.files[i].getRootNode() === uploadRootNode) {
                upload = this.files[i];
                break;
            }
        }
        if (null === upload) {
            return;
        }
        upload.cancel().then(function () {
            _this.uploadsContainer.removeChild(uploadRootNode);
            _this.files.splice(_this.files.indexOf(upload), 1);
            _this.onUploadNumberChanged();
            _this.onChange();
        });
    };
    UIFile.prototype.addFilesList = function (files) {
        if (!files.length) {
            return;
        }
        var errors = [];
        if (!this.isMultiple() && files.length > 1) {
            errors.push('Only a single file is accepted!');
        }
        else {
            for (var i = 0, len = files.length; i < len; i++) {
                switch (true) {
                    case null !== this.getMinUploadSizeInBytes() && files[i].file.size < this.getMinUploadSizeInBytes():
                        errors.push(this.control.getForm().getEngine().getI18n().translateText('textdef_234', files[i].file.name, this.control.getForm().getEngine().getFileUtils().convertFileSizeToString(this.getMinUploadSizeInBytes())) ||
                            ('File "' + files[i].file.name + '" is too small, '
                                + 'min accepted file size is '
                                + this.control.getForm().getEngine().getFileUtils().convertFileSizeToString(this.getMinUploadSizeInBytes())));
                        break;
                    case null !== this.getMaxUploadSizeInBytes() && files[i].file.size > this.getMaxUploadSizeInBytes():
                        errors.push(this.control.getForm().getEngine().getI18n().translateText('textdef_226', files[i].file.name, this.control.getForm().getEngine().getFileUtils().convertFileSizeToString(this.getMaxUploadSizeInBytes())) ||
                            ('File "' + files[i].file.name + '" is too large, '
                                + 'max accepted file size is '
                                + this.control.getForm().getEngine().getFileUtils().convertFileSizeToString(this.getMaxUploadSizeInBytes())));
                        break;
                    case !this.isFileNamePermitted(files[i].file.name):
                        errors.push(this.control.getForm().getEngine().getI18n().translateText('textdef_227')
                            || 'File "' + files[i].file.name + '" is not allowed');
                        break;
                }
            }
        }
        if (errors.length > 0) {
            if (errors.length > 3) {
                var andMoreAdditionalErrors = '+ ' + (errors.length - 3) + ' more errors...';
                errors = errors.slice(0, 3);
                errors.push(andMoreAdditionalErrors);
            }
            this.control.getForm().getEngine().getLoader().getUI().alert('Error', errors.join("\n"));
        }
        else {
            for (var i = 0, len = files.length; i < len; i++) {
                this.addFile(files[i]);
            }
        }
    };
    UIFile.prototype.handleDragEnter = function () {
        console.warn('drag enter');
    };
    UIFile.prototype.handleDragLeave = function () {
        console.warn('drag leave');
    };
    UIFile.prototype.extractFiles = function (f) {
        var result = [];
        for (var i = 0, len = f.length; i < len; i++) {
            if (f[i].type !== '' || f[i].size) {
                result.push({
                    path: '',
                    file: f[i],
                });
            }
        }
        return result;
    };
    UIFile.prototype.handleDropEvent = function (event) {
        this.dropFiles = [];
        var self = this;
        var traverseFileTree = function (item, path) {
            if (item.isFile) {
                item.file(function (file) {
                    self.dropFiles.push({
                        path: path,
                        file: file
                    });
                    self.dropFilesThrottler();
                });
            }
            else if (item.isDirectory) {
                var dirReader = item.createReader();
                dirReader.readEntries(function (entries) {
                    for (var i = 0; i < entries.length; i++) {
                        traverseFileTree(entries[i], path + item.name + "/");
                    }
                });
            }
        };
        var items = event.dataTransfer.items;
        if (typeof items !== "undefined") {
            for (var i = 0; i < items.length; i++) {
                if (!items[i].webkitGetAsEntry) {
                    return;
                }
                var item = items[i].webkitGetAsEntry();
                if (item) {
                    traverseFileTree(item, '');
                }
            }
        }
        else {
            self.addFilesList(self.extractFiles(event.dataTransfer.files));
        }
    };
    UIFile.prototype.init = function () {
        (function (self, $) {
            self.uploadInput.addEventListener('change', function (e) {
                self.addFilesList(self.extractFiles(self.uploadInput.files));
                setTimeout(function () {
                    self.uploadInput.value = null;
                }, 0);
            }, true);
            $(self.uploadsContainer).on('click', '> div[data-role=upload] > [data-role=button-remove], > div[data-role=download] > [data-role=button-remove]', function (e) {
                $(this).closest('[data-role=upload], [data-role=download]').each(function () {
                    self.removeUpload(this);
                });
            });
            $(self.abortAllUploadsButton).on('click', function () {
                self.abortAllFiles();
            });
            self.uploadInput.addEventListener('dragenter', function () {
                self.handleDragEnter();
            }, true);
            self.uploadInput.addEventListener('dragleave', function () {
                self.handleDragLeave();
            }, true);
            self.uploadInput.addEventListener('dragover', function (e) {
                e.stopPropagation();
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            }, true);
            self.uploadInput.addEventListener('drop', function (e) {
                self.handleDropEvent(e);
                e.preventDefault();
            }, true);
            $(document).on({
                dragover: function () {
                    return false;
                },
                drop: function () {
                    return false;
                }
            });
            $(self.uploadInput).on('focus', function () {
                $(self.rootNode).attr('data-file-tab-focus-state', '1');
            }).on('blur', function () {
                $(self.rootNode).removeAttr('data-file-tab-focus-state');
            });
            self.dropFilesThrottler = Throttle.create(function () {
                self.addDroppedFiles();
            }, 500);
        })(this, UI.getJQuery());
    };
    UIFile.prototype.addDroppedFiles = function () {
        this.addFilesList(this.dropFiles);
        this.dropFiles = undefined;
    };
    UIFile.prototype.isMultiple = function () {
        return !!this.multiple;
    };
    UIFile.prototype.withMultiple = function (multiple) {
        this.multiple = !!multiple;
        if (this.multiple) {
            this.rootNode.setAttribute('data-is-multiple', '');
            this.uploadInput.setAttribute('multiple', '');
        }
        else {
            this.rootNode.removeAttribute('data-is-multiple');
            this.uploadInput.removeAttribute('multiple');
        }
        return this;
    };
    UIFile.prototype.withMinUploadSizeInBytes = function (minSize) {
        this.minUploadSizeInBytes = minSize;
        return this;
    };
    UIFile.prototype.getMinUploadSizeInBytes = function () {
        return this.minUploadSizeInBytes;
    };
    UIFile.prototype.withMaxUploadSizeInBytes = function (maxSize) {
        this.maxUploadSizeInBytes = maxSize;
        return this;
    };
    UIFile.prototype.withAllowedFileExtensions = function (extensions) {
        this.allowedExtensions = extensions && extensions.length
            ? extensions
            : null;
        return this;
    };
    UIFile.prototype.withForbiddenFileExtensions = function (extensions) {
        this.forbiddenExtensions = extensions && extensions.length
            ? extensions
            : null;
        return this;
    };
    UIFile.prototype.getMaxUploadSizeInBytes = function () {
        return this.maxUploadSizeInBytes;
    };
    UIFile.prototype.onChange = function () {
        UI.getJQuery()(this.rootNode).trigger('change');
    };
    UIFile.prototype.isFileNamePermitted = function (fileName) {
        if (!fileName) {
            return false;
        }
        if ('string' !== typeof fileName) {
            return false;
        }
        var fileExtension = ((/\.([^\.]+)$/.exec(fileName) || [])[1] || '').toLowerCase();
        if ('' === fileExtension) {
            return false;
        }
        if ((3 > fileExtension.length) && (fileExtension !== "ai")) {
            return false;
        }
        if (UserFileExtensionsService.getInstance().getForbiddenUserFileExtensions().indexOf(fileExtension) > -1) {
            return false;
        }
        if (null !== this.allowedExtensions) {
            return this.allowedExtensions.indexOf(fileExtension) > -1;
        }
        if (null !== this.forbiddenExtensions) {
            return this.forbiddenExtensions.indexOf(fileExtension) === -1;
        }
        return true;
    };
    UIFile.prototype.withFileUtils = function (fileUtils) {
        this.fileUtils = fileUtils;
        return this;
    };
    UIFile.prototype.abortAllFiles = function () {
        return (function ($, self) {
            var promises = [];
            for (var i = 0, len = self.files.length; i < len; i++) {
                promises.push(self.files[i].cancel());
            }
            return $.when.apply(self, promises).then(function () {
                self.files = [];
                while (self.uploadsContainer.firstChild) {
                    self.uploadsContainer.removeChild(self.uploadsContainer.firstChild);
                }
                self.onUploadNumberChanged();
                self.onChange();
            });
        })(UI.getJQuery(), this);
    };
    UIFile.prototype.setDownloadInfo = function (downloadInfo) {
        for (var i = 0, len = this.files.length; i < len; i++) {
            if (this.files[i].getTransferType() === EFileTransferType.UPLOAD) {
                this.uploadsContainer.removeChild(this.files[i].getRootNode());
                this.files.slice(i, 1);
                break;
            }
        }
        if (null !== downloadInfo) {
            var download = new UIFileDownload(this);
            for (var i = 0, len = this.files.length; i < len; i++) {
                if (this.files[i]['getDownloadURL']() === downloadInfo.url) {
                    return;
                }
            }
            this.files.push(download);
            download
                .withFileUtils(this.fileUtils)
                .withName(downloadInfo.name)
                .withFileSize(downloadInfo.size)
                .withDownloadURL(downloadInfo.url)
                .withUrlLinkToDownload(downloadInfo.url, this.control.getForm().getEngine().getLoader().getRules().getDatabase())
                .withProgress(100)
                .withSubmissionId(this.control.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.SUBMISSION_ID))
                .withUploaderInstanceIndex(this.instanceId)
                .withSessionId(this.control.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.SESSION_ID))
                .withUploadsService(this.control.getForm().getEngine().getUploadsService());
            this.uploadsContainer.appendChild(download.getRootNode());
            this.rootNode.setAttribute('data-is-download', '');
        }
        else {
            this.rootNode.removeAttribute('data-is-download');
        }
        this.onUploadNumberChanged();
    };
    UIFile.prototype.getDownloadInfo = function () {
        for (var i = 0, len = this.files.length; i < len; i++) {
            if (this.files[i].getTransferType() === EFileTransferType.UPLOAD) {
                return {
                    url: this.files[i].getDownloadURL(),
                    name: this.files[i].getName(),
                    size: this.files[i].getSize(),
                };
            }
        }
        return null;
    };
    UIFile.prototype.withAllowDirectoryUpload = function (allow) {
        if (allow) {
            if (BrowserDetector.meetsRequirements('* * * firefox *') === '') {
                this.uploadInput.setAttribute('allowdirs', '');
            }
            else if (BrowserDetector.meetsRequirements('android * * chrome *') !== '') {
                this.uploadInput.setAttribute('webkitdirectory', '');
            }
        }
        else {
            if (BrowserDetector.meetsRequirements('* * * firefox *') === '') {
                this.uploadInput.removeAttribute('allowdirs');
            }
            else {
                this.uploadInput.removeAttribute('webkitdirectory');
            }
        }
        return this;
    };
    UIFile.prototype.getErrors = function () {
        var result = [], errorString, seenErrors = {};
        for (var i = 0, len = this.files.length; i < len; i++) {
            errorString = this.files[i].getError();
            if (null !== errorString) {
                if (seenErrors[errorString] === undefined) {
                    result.push({
                        code: Errors.ERR_FILE_UPLOAD,
                        message: errorString
                    });
                    seenErrors[errorString] = "1";
                }
            }
        }
        return result;
    };
    UIFile.prototype.updateAccessibilityAttributes = function () {
        var hash = this.control.getHash();
        this.uploadOverlay.setAttribute('aria-labelledby', 'file-placeholder-' + hash + '-acc');
        this.placeholder.setAttribute('id', 'file-placeholder-' + hash + '-acc');
    };
    UIFile.prototype.clearFiles = function () {
        (function (self, $) {
            $(self.uploadsContainer).find('[data-role=upload], [data-role=download]').each(function () {
                self.removeUpload(this);
            });
        })(this, UI.getJQuery());
    };
    UIFile.MIN_NUMBER_OF_CONTROLS_IN_ORDER_TO_DISPLAY_THE_ABORT_ALL_DOWNLOADS_BUTTON = 6;
    UIFile.INSTANCE_ID = 1;
    return UIFile;
}(UIElement));
var UITagsContainer = (function (_super) {
    __extends(UITagsContainer, _super);
    function UITagsContainer(configuration) {
        var _this = _super.call(this, configuration.componentName) || this;
        _this.configuration = configuration;
        _this.valuesSection = document.createElement('div');
        _this.valuesSection.dataset.role = 'values';
        _this.valuesSection.setAttribute('contenteditable', 'true');
        _this.rootNode.dataset.name = configuration.componentName;
        _this.rootNode.dataset.type = UI.ELEMENT_TYPE_TAGS;
        _this.rootNode.appendChild(_this.valuesSection);
        if (configuration.placeholder) {
            var placeholder = document.createElement('span');
            placeholder.dataset.role = 'tag-placeholder';
            placeholder.appendChild(document.createTextNode(configuration.placeholder));
            _this.rootNode.appendChild(placeholder);
        }
        if (_this.configuration.allowKeywords) {
            _this.initializeNativeDropdown();
        }
        _this.valuesSection.onfocus = function () {
            _this.trigger('focus');
        };
        _this.nativeDropdown.onchange = function () {
            _this.trigger('ui_tags_container_variable_insert');
        };
        $(_this.valuesSection).on('keydown', function (e) {
            var childNodes;
            var selectedNode = window.getSelection().anchorNode;
            if (_this.valuesSection.hasChildNodes()) {
                childNodes = _this.valuesSection.childNodes;
            }
            switch (e.keyCode) {
                case KeyboardUtils.KEY_ENTER:
                    e.preventDefault();
                    break;
                case KeyboardUtils.KEY_BACKSPACE:
                    if (childNodes && childNodes.length >= 2) {
                        if (FormUtils.isElementASpace(selectedNode)) {
                            for (var i = 0, len = childNodes.length; i < len; i++) {
                                if (childNodes[i] === selectedNode
                                    && childNodes[i - 1]
                                    && _this.isElementATag(childNodes[i - 1])) {
                                    _this.valuesSection.removeChild(childNodes[i - 1]);
                                }
                            }
                        }
                        if (_this.isElementATag(selectedNode)) {
                            for (var i = 0, len = childNodes.length; i < len; i++) {
                                if (childNodes[i] === selectedNode
                                    && childNodes[i - 1]
                                    && FormUtils.isElementASpace(childNodes[i - 1])) {
                                    _this.valuesSection.removeChild(childNodes[i - 1]);
                                }
                            }
                        }
                    }
                    break;
                case KeyboardUtils.KEY_DELETE:
                    if (childNodes && childNodes.length >= 2) {
                        if (FormUtils.isElementASpace(selectedNode)) {
                            for (var i = 0, len = childNodes.length; i < len; i++) {
                                if (childNodes[i] === selectedNode
                                    && childNodes[i + 1]
                                    && _this.isElementATag(childNodes[i + 1])) {
                                    _this.valuesSection.removeChild(childNodes[i + 1]);
                                }
                            }
                        }
                        if (_this.isElementATag(selectedNode)) {
                            for (var i = 0, len = childNodes.length; i < len; i++) {
                                if (childNodes[i] === selectedNode
                                    && childNodes[i + 1]
                                    && FormUtils.isElementASpace(childNodes[i + 1])) {
                                    _this.valuesSection.removeChild(childNodes[i + 1]);
                                }
                            }
                        }
                        if (FormUtils.isElementASpace(selectedNode) &&
                            selectedNode === childNodes[childNodes.length - 1]) {
                            e.preventDefault();
                        }
                    }
                    break;
            }
            if (_this.valuesSection.childNodes.length === 1
                && _this.valuesSection.childNodes[0].nodeName === ENodeName.BR) {
                _this.valuesSection.removeChild(_this.valuesSection.childNodes[0]);
            }
            _this.trigger('keydown');
        });
        _this.valuesSection.addEventListener('paste', function (e) {
            var clipboard = (e.clipboardData || window['clipboardData']), paste = clipboard.getData('text/plain'), selection = window.getSelection();
            if (!selection.rangeCount)
                return false;
            selection.deleteFromDocument();
            selection.getRangeAt(0).insertNode(document.createTextNode(paste.replace(/\r\n|\r|\n/g, ' ')));
            e.preventDefault();
        });
        _this.valuesSection.addEventListener('blur', function () {
            for (var i = 0, len = _this.valuesSection.childNodes.length; i < len; i++) {
                if (_this.valuesSection.childNodes[i].nodeName === ENodeName.BR) {
                    _this.valuesSection.removeChild(_this.valuesSection.childNodes[i]);
                }
            }
        });
        _this.valuesSection.addEventListener('mscontrolselect', function (e) {
            e.preventDefault();
        });
        return _this;
    }
    UITagsContainer.prototype.resetNativeDropdown = function () {
        var dropdownContainer = this.rootNode.querySelector('[data-role="dropdown"]');
        if (dropdownContainer) {
            this.rootNode.removeChild(dropdownContainer);
        }
        if (this.configuration.allowKeywords) {
            this.initializeNativeDropdown();
        }
    };
    UITagsContainer.prototype.isElementATag = function (element) {
        return element.nodeName === ENodeName.SPAN
            && element.dataset.uiRole === 'ui-element'
            && element.dataset.type === 'tag';
    };
    UITagsContainer.prototype.initializeNativeDropdown = function () {
        var _this = this;
        var dropdownContainer = document.createElement('div');
        dropdownContainer.setAttribute('data-role', 'dropdown');
        this.rootNode.setAttribute('data-expandable', '1');
        this.nativeDropdown = document.createElement('select');
        dropdownContainer.appendChild(this.nativeDropdown);
        if (this.configuration.createValuesCallback) {
            var options = this.configuration.createValuesCallback();
            for (var i = 0, len = options.length; i < len; i++) {
                var option = document.createElement('option');
                option.text = options[i].text || options[i].value;
                option.value = options[i].value;
                this.nativeDropdown.add(option);
            }
            var expanderSign = document.createElement('span');
            expanderSign.className = 'i123-add';
            dropdownContainer.appendChild(expanderSign);
        }
        this.nativeDropdown.value = null;
        this.nativeDropdown.selectedIndex = -1;
        this.nativeDropdown.addEventListener('change', function (e) {
            var newValue = _this.nativeDropdown.value, newCaption = _this.nativeDropdown.options[_this.nativeDropdown.selectedIndex].text;
            _this.nativeDropdown.value = null;
            _this.nativeDropdown.selectedIndex = -1;
            _this.addTag(newCaption, newValue, false, newValue !== newCaption, UIElement.APPEND_POSITION_AT_CURSOR);
        }, true);
        this.nativeDropdown.onmouseover = function () {
            _this.nativeDropdown.value = null;
        };
        this.rootNode.appendChild(dropdownContainer);
        dropdownContainer.onclick = function (e) {
            if (e.clientX && e.clientY) {
                _this.trigger('dropdown-open');
            }
        };
    };
    UITagsContainer.prototype.addTag = function (caption, value, isDeleted, isVariable, position, targetElement) {
        var _this = this;
        if (isDeleted === void 0) { isDeleted = false; }
        if (isVariable === void 0) { isVariable = false; }
        if (position === void 0) { position = UIElement.APPEND_POSITION_INSIDE; }
        if (targetElement === void 0) { targetElement = this.valuesSection; }
        var removeLastTag = function () {
            var children = _this.valuesSection.childNodes;
            for (var i = 0, len = children.length; i < len; i++) {
                if (children[i].nodeValue && children[i].nodeValue.trim() === value) {
                    if (FormUtils.isFirefox() && children.length === 1) {
                        _this.valuesSection.removeChild(children[i]);
                    }
                    else {
                        children[i].nodeValue = children[i].nodeValue.replace(value, '');
                    }
                    return;
                }
            }
        };
        if (isVariable === false && this.configuration.textValidationCallback(value) === false) {
            this.addError(this.configuration.customErrorMessage);
            return removeLastTag();
        }
        if (this.configuration.tagsLimit && (this.configuration.tagsLimit <= this.getNumberOfTagValues())) {
            this.trigger('tags-limit-reached');
            return removeLastTag();
        }
        var tag = new UITag({
            componentName: UI.ELEMENT_TYPE_TAG,
            caption: caption,
            value: value,
            isVariable: isVariable,
            isDeleted: isDeleted
        }), caret = new Caret(this.valuesSection), oldCaretPosition = caret.position();
        tag.on('append', function () {
            if (!(_this instanceof UISingleTagsListContainer)) {
                caret.position(oldCaretPosition + 1);
            }
        });
        tag.on('replace', function () {
            if (!(_this instanceof UISingleTagsListContainer)) {
                caret.position(oldCaretPosition + 1);
            }
        });
        tag.on('insert', function () {
            if (!(_this instanceof UISingleTagsListContainer)) {
                caret.position(oldCaretPosition + caption.length + 1);
            }
        });
        if (this.valuesSection.childNodes.length === 0) {
            targetElement = this.valuesSection;
            position = UIElement.APPEND_POSITION_INSIDE;
        }
        switch (position) {
            case UIElement.APPEND_POSITION_REPLACE:
                tag.replace(targetElement);
                break;
            case UIElement.APPEND_POSITION_AT_CURSOR:
                tag.insert(targetElement);
                break;
            default:
                tag.append(targetElement, position);
        }
        this.trigger('tag-add', tag);
    };
    UITagsContainer.prototype.getValue = function () {
        var result = [], children = this.valuesSection.childNodes;
        for (var i = 0, len = children.length; i < len; i++) {
            var child = children[i], structure = void 0;
            if (child.nodeType === Node.TEXT_NODE) {
                if (child.nodeValue.length === 1 && child.nodeValue.charCodeAt(0) === UITag.THIN_SPACE_CHAR_CODE) {
                    continue;
                }
                structure = {
                    type: ETagValueType.TEXT,
                    value: child.nodeValue,
                    caption: child.nodeValue
                };
            }
            else if (child.nodeType !== Node.TEXT_NODE
                && child.textContent
                && child.textContent.trim().length !== 0) {
                structure = {
                    type: ETagValueType.TAG,
                    value: child.dataset.value,
                    caption: child.textContent
                };
            }
            if (undefined !== structure) {
                result.push(structure);
            }
        }
        return result;
    };
    UITagsContainer.prototype.setValue = function (tagConfiguration) {
        this.clearValues();
        for (var i = 0, len = tagConfiguration.length; i < len; i++) {
            if (tagConfiguration[i].type === ETagValueType.TAG) {
                var isVariable = !tagConfiguration[i].isRegularTag;
                this.addTag(tagConfiguration[i].caption, tagConfiguration[i].value, tagConfiguration[i].isDeleted, isVariable);
            }
            else {
                this.valuesSection.appendChild(document.createTextNode(tagConfiguration[i].value));
            }
        }
    };
    UITagsContainer.prototype.clearValues = function () {
        while (this.valuesSection.hasChildNodes()) {
            this.valuesSection.removeChild(this.valuesSection.lastChild);
        }
    };
    UITagsContainer.prototype.addError = function (errorMessage) {
        var _this = this;
        if (null !== this.rootNode.querySelector('[data-role="error"]')) {
            return;
        }
        var errorNode = document.createElement('div');
        errorNode.dataset.role = 'error';
        errorNode.appendChild(document.createTextNode(errorMessage));
        this.rootNode.appendChild(errorNode);
        setTimeout(function () {
            _this.rootNode.removeChild(errorNode);
        }, 5000);
    };
    UITagsContainer.prototype.setState = function (state) {
        switch (state) {
            case EUITagsContainerState.FULLY_DISABLED:
                this.valuesSection.removeAttribute('contenteditable');
                this.nativeDropdown.setAttribute('disabled', 'disabled');
                this.valuesSection.setAttribute('data-fully-disabled', '');
                break;
            case EUITagsContainerState.DISABLED:
                this.valuesSection.removeAttribute('contenteditable');
                this.nativeDropdown.setAttribute('disabled', 'disabled');
                this.valuesSection.hasAttribute('data-fully-disabled') && this.valuesSection.removeAttribute('data-fully-disabled');
                break;
            case EUITagsContainerState.ENABLED:
            default:
                this.valuesSection.setAttribute('contenteditable', 'true');
                this.nativeDropdown.removeAttribute('disabled');
                this.valuesSection.hasAttribute('data-fully-disabled') && this.valuesSection.removeAttribute('data-fully-disabled');
        }
    };
    UITagsContainer.prototype.getState = function () {
        if (this.nativeDropdown.hasAttribute('disabled')
            && this.valuesSection.hasAttribute('data-fully-disabled')) {
            return EUITagsContainerState.FULLY_DISABLED;
        }
        else if (this.nativeDropdown.hasAttribute('disabled')) {
            return EUITagsContainerState.DISABLED;
        }
        else {
            return EUITagsContainerState.ENABLED;
        }
    };
    UITagsContainer.prototype.getNumberOfTagValues = function () {
        var values = this.getValue();
        var counter = 0;
        _.forEach(values, function (value) {
            if (value.type === ETagValueType.TAG) {
                counter++;
            }
        });
        return counter;
    };
    UITagsContainer.prototype.getDropdownContainer = function () {
        return this.rootNode.querySelector('[data-role="dropdown"]');
    };
    return UITagsContainer;
}(UIElement));
var UITagsListContainer = (function (_super) {
    __extends(UITagsListContainer, _super);
    function UITagsListContainer(configuration) {
        var _this = _super.call(this, configuration) || this;
        $(_this.valuesSection).on('keydown', function (e) {
            if (e.keyCode === KeyboardUtils.KEY_SPACE || e.keyCode === KeyboardUtils.KEY_ENTER) {
                _this.replaceFirstTextNodeWithTag();
                e.preventDefault();
            }
        });
        _this.valuesSection.addEventListener('blur', function (e) {
            _this.replaceFirstTextNodeWithTag();
            _this.valuesSection.blur();
        });
        return _this;
    }
    UITagsListContainer.prototype.replaceFirstTextNodeWithTag = function () {
        var nodeList = this.valuesSection.childNodes, textNode = null;
        for (var i = 0, len = nodeList.length; i < len; i++) {
            if (nodeList[i].nodeType === Node.TEXT_NODE
                && nodeList[i].textContent.trim().length > 0) {
                textNode = nodeList[i];
                break;
            }
        }
        if (null !== textNode) {
            this.addTag(textNode.textContent.trim(), textNode.textContent.trim(), false, false, UIElement.APPEND_POSITION_REPLACE, textNode);
        }
    };
    return UITagsListContainer;
}(UITagsContainer));
var UISingleTagsListContainer = (function (_super) {
    __extends(UISingleTagsListContainer, _super);
    function UISingleTagsListContainer(configuration) {
        var _this = _super.call(this, configuration) || this;
        _this.on('tag-add', function (tag) {
            var dropdown = _this.getDropdownContainer();
            _this.setState(EUITagsContainerState.DISABLED);
            dropdown.setAttribute('title', configuration.disabledTitle || '');
            tag.on('delete', function () {
                _this.setState(EUITagsContainerState.ENABLED);
                dropdown.setAttribute('title', configuration.title || '');
            });
        });
        return _this;
    }
    return UISingleTagsListContainer;
}(UITagsListContainer));
var UITag = (function (_super) {
    __extends(UITag, _super);
    function UITag(configuration) {
        var _this = _super.call(this, configuration.componentName, 'span') || this;
        _this.rootNode.setAttribute('contenteditable', 'false');
        _this.rootNode.innerText = configuration.caption;
        _this.rootNode.dataset.value = configuration.value;
        if (configuration.isVariable === true) {
            _this.rootNode.classList.add('is-variable');
        }
        if (configuration.isDeleted) {
            _this.rootNode.setAttribute('data-is-deleted-field', "" + configuration.isDeleted);
        }
        _this.rootNode.addEventListener('click', function (e) {
            if (_this.rootNode.parentElement.hasAttribute('data-fully-disabled')) {
                return;
            }
            var sibling = _this.rootNode.nextSibling;
            if (null !== sibling && sibling.nodeType === Node.TEXT_NODE) {
                if (sibling.textContent.trim().length === 0) {
                    _this.rootNode.parentNode.removeChild(_this.rootNode.nextSibling);
                }
                else {
                    sibling.nodeValue = sibling.textContent.trim();
                }
            }
            _this.delete();
        });
        _this.on('append', function () {
            _this.appendSpacesBeforeAndAfter();
        });
        _this.on('replace', function () {
            _this.appendSpacesBeforeAndAfter();
        });
        _this.on('insert', function () {
            _this.appendSpacesBeforeAndAfter();
        });
        return _this;
    }
    UITag.prototype.getValue = function () {
        return this.rootNode.dataset.value;
    };
    UITag.prototype.setValue = function (value) {
    };
    UITag.prototype.appendSpacesBeforeAndAfter = function () {
        var parentChildren = this.rootNode.parentNode.childNodes, i = 0, len = parentChildren.length;
        for (; i < len; i++) {
            if (parentChildren[i] === this.rootNode) {
                if (i > 0 && parentChildren[i - 1].nodeType !== Node.TEXT_NODE) {
                    this.rootNode.insertAdjacentText('beforebegin', String.fromCharCode(UITag.THIN_SPACE_CHAR_CODE));
                }
                else if (i > 0
                    && parentChildren[i - 1].nodeType === Node.TEXT_NODE
                    && parentChildren[i - 1].nodeValue.charCodeAt(parentChildren[i - 1].nodeValue.length - 1) !== UITag.THIN_SPACE_CHAR_CODE) {
                    parentChildren[i - 1].nodeValue = parentChildren[i - 1].nodeValue + String.fromCharCode(UITag.THIN_SPACE_CHAR_CODE);
                }
                if (!parentChildren[i + 1] || parentChildren[i + 1].nodeType !== Node.TEXT_NODE) {
                    this.rootNode.insertAdjacentHTML('afterend', String.fromCharCode(UITag.THIN_SPACE_CHAR_CODE));
                }
                else if (parentChildren[i + 1].nodeType === Node.TEXT_NODE
                    && parentChildren[i + 1].nodeValue.charCodeAt(0) !== UITag.THIN_SPACE_CHAR_CODE) {
                    parentChildren[i + 1].nodeValue = String.fromCharCode(UITag.THIN_SPACE_CHAR_CODE) + parentChildren[i + 1].nodeValue;
                }
                break;
            }
        }
        if (len === 0) {
            this.rootNode.insertAdjacentHTML('afterend', String.fromCharCode(UITag.THIN_SPACE_CHAR_CODE));
        }
    };
    UITag.THIN_SPACE_CHAR_CODE = 8201;
    return UITag;
}(UIElement));
var TextMeasurement = (function () {
    function TextMeasurement() {
    }
    TextMeasurement.measureTextWidth = function (text, usingCSSSettingsOfDOMNode) {
        var computedCSSPropertiesOfDOMNode = window.getComputedStyle(usingCSSSettingsOfDOMNode);
        if (!this.temporarySpan.parentNode) {
            document.body.appendChild(this.temporarySpan);
            this.temporarySpan.style.cssText = ' position: fixed; left: -20000px; top: -20000px; display: block; padding: 0 !important; ';
        }
        this.temporarySpan.style.fontFamily = computedCSSPropertiesOfDOMNode.fontFamily;
        this.temporarySpan.style.fontSize = computedCSSPropertiesOfDOMNode.fontSize;
        this.temporarySpan.textContent = text;
        var result = this.temporarySpan.offsetWidth;
        this.temporarySpan.textContent = '';
        return result;
    };
    TextMeasurement.temporarySpan = document.createElement('span');
    return TextMeasurement;
}());
var AutoIncrement = (function () {
    function AutoIncrement() {
    }
    AutoIncrement.getId = function () {
        this.id++;
        var result = String(this.id);
        return result;
    };
    AutoIncrement.id = 0;
    return AutoIncrement;
}());
var TagsReadonlyKeyword = (function () {
    function TagsReadonlyKeyword() {
        this.root = document.createElement('div');
        this.root.setAttribute('data-role', 'readonly-keyword');
        this.id = AutoIncrement.getId();
        this.root.setAttribute('data-id', this.id);
    }
    TagsReadonlyKeyword.prototype.getRoot = function () {
        return this.root;
    };
    TagsReadonlyKeyword.prototype.getValue = function () {
        return this.value;
    };
    TagsReadonlyKeyword.prototype.setValue = function (newValue) {
        this.value = newValue;
        this.onValueOrCaptionChanged();
        return this;
    };
    TagsReadonlyKeyword.prototype.getCaption = function () {
        return this.caption;
    };
    TagsReadonlyKeyword.prototype.setCaption = function (caption) {
        this.caption = caption;
        this.root.textContent = caption;
        this.onValueOrCaptionChanged();
        return this;
    };
    TagsReadonlyKeyword.prototype.getType = function () {
        return ETagValueType.TAG;
    };
    TagsReadonlyKeyword.prototype.setType = function (newType) {
        throw new Error("Cannot set type of readonly tags");
    };
    TagsReadonlyKeyword.prototype.getId = function () {
        return this.id;
    };
    TagsReadonlyKeyword.prototype.onValueOrCaptionChanged = function () {
        if (!this.caption && this.value) {
            this.root.textContent = this.value;
        }
    };
    return TagsReadonlyKeyword;
}());
var TagsEditableKeyword = (function () {
    function TagsEditableKeyword() {
        var _this = this;
        this.root = document.createElement('div');
        this.root.setAttribute('data-role', 'editable-keyword');
        this.input = document.createElement('input');
        this.input.type = 'text';
        this.root.appendChild(this.input);
        this.id = AutoIncrement.getId();
        this.root.setAttribute('data-id', this.id);
        this.input.oninput = function () {
            _this.adjustInputWidth();
        };
        this.adjustInputWidth();
    }
    TagsEditableKeyword.prototype.getRoot = function () {
        return this.root;
    };
    TagsEditableKeyword.prototype.getValue = function () {
        return this.input.value;
    };
    TagsEditableKeyword.prototype.setValue = function (newValue) {
        this.input.value = newValue;
        this.adjustInputWidth();
        return this;
    };
    TagsEditableKeyword.prototype.getCaption = function () {
        return null;
    };
    TagsEditableKeyword.prototype.setCaption = function (newCaption) {
        throw new Error("Editable keywords don't have caption");
    };
    TagsEditableKeyword.prototype.getType = function () {
        return ETagValueType.TEXT;
    };
    TagsEditableKeyword.prototype.setType = function (newType) {
        throw new Error("Cannot set type of editable tags");
    };
    TagsEditableKeyword.prototype.getId = function () {
        return this.id;
    };
    TagsEditableKeyword.prototype.adjustInputWidth = function () {
        if (this.placeholder) {
            this.input.style.width = Math.max(TextMeasurement.measureTextWidth(this.input.value, this.input), TextMeasurement.measureTextWidth(this.placeholder, this.input)) + 15 + "px";
        }
        else {
            this.input.style.width = TextMeasurement.measureTextWidth(this.input.value, this.input) + 15 + "px";
        }
    };
    TagsEditableKeyword.prototype.getInput = function () {
        return this.input;
    };
    TagsEditableKeyword.prototype.setPlaceholder = function (placeholder) {
        this.placeholder = placeholder;
        this.input.placeholder = String(placeholder || '') || '';
        return this;
    };
    TagsEditableKeyword.prototype.getPlaceholder = function () {
        return this.placeholder;
    };
    return TagsEditableKeyword;
}());
var UITagsComponent = (function () {
    function UITagsComponent(configuration) {
        this.values = [];
        this.root = document.createElement('div');
        this.root.setAttribute('data-role', 'tags-component');
        this.valuesSection = document.createElement('div');
        this.valuesSection.setAttribute('data-role', 'values');
        this.dropdownSection = document.createElement('div');
        this.dropdownSection.setAttribute('data-role', 'dropdown');
        this.root.appendChild(this.valuesSection);
        this.root.appendChild(this.dropdownSection);
        this.configuration = configuration || UITagsComponent.createDefaultConfiguration();
        this.initializeNativeDropdown();
        this.initializeEditableNode();
        if (configuration.editableTextBackground && configuration.allowText) {
            this.root.setAttribute('data-text-has-background', '1');
        }
        if (configuration.allowText && configuration.textValidationCallback && configuration.customErrorMessage) {
            this.errorDOMNode = document.createElement('div');
            this.errorDOMNode.setAttribute('data-role', 'error');
            this.errorDOMNode.textContent = configuration.customErrorMessage;
            this.root.appendChild(this.errorDOMNode);
        }
        this.initEvents();
    }
    UITagsComponent.prototype.getRoot = function () {
        return this.root;
    };
    UITagsComponent.prototype.getValue = function () {
        var result = [];
        for (var i = 0, len = this.values.length; i < len; i++) {
            var tag = {};
            tag.type = this.values[i].getType();
            tag.value = this.values[i].getValue();
            var caption = this.values[i].getCaption();
            if (caption) {
                tag.caption = caption;
            }
            if (tag.value) {
                result.push(tag);
            }
        }
        return result;
    };
    UITagsComponent.createDefaultConfiguration = function () {
        return {
            componentName: 'undefined',
            allowText: true,
            editableTextBackground: false,
            allowKeywords: true,
            createValuesCallback: function () {
                return [
                    {
                        text: "Foo",
                        value: "foo",
                    }
                ];
            }
        };
    };
    UITagsComponent.prototype.initializeNativeDropdown = function () {
        var _this = this;
        if (this.configuration.allowKeywords) {
            this.root.setAttribute("data-expandable", "1");
            var nativeDropdown_1 = document.createElement('select');
            this.dropdownSection.appendChild(nativeDropdown_1);
            if (this.configuration.createValuesCallback) {
                var options = this.configuration.createValuesCallback();
                for (var i = 0, len = options.length; i < len; i++) {
                    var option = document.createElement('option');
                    option.text = options[i].text || options[i].value;
                    option.value = options[i].value;
                    nativeDropdown_1.add(option);
                }
                var expanderSign = document.createElement('span');
                expanderSign.className = 'i123-add';
                this.dropdownSection.appendChild(expanderSign);
            }
            nativeDropdown_1.value = null;
            nativeDropdown_1.selectedIndex = -1;
            setTimeout(function () {
                nativeDropdown_1.value = null;
                nativeDropdown_1.selectedIndex = -1;
            }, 10);
            nativeDropdown_1.addEventListener('change', function (e) {
                var newValue = nativeDropdown_1.value, newCaption = nativeDropdown_1.options[nativeDropdown_1.selectedIndex].text;
                nativeDropdown_1.value = null;
                nativeDropdown_1.selectedIndex = -1;
                _this.appendReadonlyKeyword(newValue, newCaption);
            }, true);
            nativeDropdown_1.onmouseover = function () {
                nativeDropdown_1.value = null;
            };
        }
    };
    UITagsComponent.prototype.appendReadonlyKeyword = function (tagValue, tagCaption) {
        var keyword = (new TagsReadonlyKeyword())
            .setValue(tagValue)
            .setCaption(tagCaption);
        this.values.push(keyword);
        if (this.editableNode) {
            this.valuesSection.insertBefore(keyword.getRoot(), this.editableNode.getRoot());
        }
        else {
            this.valuesSection.appendChild(keyword.getRoot());
        }
        this.onValuesChanged();
    };
    UITagsComponent.prototype.initEvents = function () {
        var _this = this;
        (function ($, self) {
            $(_this.valuesSection).on('click', '[data-role=readonly-keyword]', function (e) {
                var keywordId = $(this).attr('data-id');
                for (var i = 0, len = self.values.length; i < len; i++) {
                    if (self.values[i].getId() === keywordId) {
                        self.values.splice(i, 1);
                        len = self.values.length;
                        this.parentNode.removeChild(this);
                    }
                }
            });
            if (_this.configuration.allowText) {
                $(_this.root).on('click', function (e) {
                    if (e.which !== 1) {
                        return;
                    }
                    if (e.target !== _this.root) {
                        return;
                    }
                    if (e.target.nodeName === 'INPUT') {
                        return;
                    }
                    if (e.target.nodeName === 'SELECT') {
                        return;
                    }
                    if (_this.editableNode) {
                        if (_this.editableNode.getInput() !== document.activeElement) {
                            _this.editableNode.getInput().focus();
                        }
                        else {
                            _this.appendKeywordOperation();
                        }
                    }
                    e.preventDefault();
                    e.stopPropagation();
                });
            }
        })(UI.getJQuery(), this);
    };
    UITagsComponent.prototype.onValuesChanged = function () {
    };
    UITagsComponent.prototype.initializeEditableNode = function () {
        var _this = this;
        var $ = UI.getJQuery();
        if (this.configuration.allowText) {
            this.editableNode = new TagsEditableKeyword();
            if (this.configuration.placeholder) {
                this.editableNode.setPlaceholder(this.configuration.placeholder);
            }
            this.valuesSection.appendChild(this.editableNode.getRoot());
            setTimeout(function () {
                _this.editableNode.adjustInputWidth();
            }, 100);
            this.editableNode.getInput().onblur = function () {
                _this.appendKeywordOperation();
            };
            $(this.editableNode.getInput()).keydown(function (e) {
                var keyCode = e.keyCode || e.charCode;
                if (keyCode === KeyboardUtils.KEY_TAB || keyCode === KeyboardUtils.KEY_ENTER) {
                    if (_this.editableNode.getValue()) {
                        _this.appendKeywordOperation();
                        e.preventDefault();
                        e.stopPropagation();
                    }
                }
            });
        }
    };
    UITagsComponent.prototype.appendKeywordOperation = function () {
        var _this = this;
        if (this.editableNode.getValue()) {
            if (this.configuration.textValidationCallback) {
                if (!this.configuration.textValidationCallback(this.editableNode.getValue())) {
                    this.editableNode.getInput().value = '';
                    this.showError();
                    return;
                }
            }
            var newKeyword_1 = new TagsEditableKeyword();
            this.appendEditableKeyword(newKeyword_1);
            newKeyword_1.setValue(this.editableNode.getValue());
            this.editableNode.setValue('');
            (function ($, self) {
                $(newKeyword_1.getInput()).on('input', function () {
                    if (this.value !== '') {
                        return;
                    }
                    self.removeKeyword(newKeyword_1);
                });
                $(newKeyword_1.getInput()).on('focus', function () {
                    $(newKeyword_1.getInput()).select();
                });
                if (_this.configuration.textValidationCallback) {
                    $(newKeyword_1.getInput()).on('blur', function (e) {
                        if (!_this.configuration.textValidationCallback(newKeyword_1.getValue())) {
                            self.removeKeyword(newKeyword_1);
                            self.showError();
                        }
                    });
                }
            })(UI.getJQuery(), this);
        }
    };
    UITagsComponent.prototype.removeKeyword = function (newKeyword) {
        var previousComponent = this.values[this.values.indexOf(newKeyword) - 1]
            || this.values[this.values.indexOf(newKeyword) + 1]
            || null;
        if (newKeyword.getRoot().parentNode) {
            try {
                newKeyword.getRoot().parentNode.removeChild(newKeyword.getRoot());
            }
            catch (e) {
            }
        }
        this.values.splice(this.values.indexOf(newKeyword), 1);
        if (previousComponent && previousComponent.getRoot().getAttribute('data-role') === 'editable-keyword') {
            previousComponent.getInput().focus();
        }
        else {
            this.editableNode.getInput().focus();
        }
    };
    UITagsComponent.prototype.appendEditableKeyword = function (newKeyword) {
        this.values.push(newKeyword);
        this.valuesSection.insertBefore(newKeyword.getRoot(), this.editableNode.getRoot());
        this.onValuesChanged();
    };
    UITagsComponent.prototype.showError = function () {
        var _this = this;
        if (this.errorDOMNode) {
            this.root.setAttribute("data-show-error", "");
            setTimeout(function () {
                _this.root.removeAttribute("data-show-error");
            }, 3000);
        }
    };
    UITagsComponent.prototype.setValue = function (values) {
        if (values) {
            for (var i = 0, len = values.length; i < len; i++) {
                if (!this.configuration.allowText && values[i].type === ETagValueType.TEXT) {
                    throw new Error("Tags of type text are not allowed!");
                }
                if (!this.configuration.allowKeywords && values[i].type === ETagValueType.TAG) {
                    throw new Error("Tags of type keyword are not allowed!");
                }
            }
        }
        for (var i = 0, len = this.values.length; i < len; i++) {
            this.values[i].getRoot().parentNode.removeChild(this.values[i].getRoot());
        }
        this.values = [];
        var tag, text;
        if (!values) {
            return;
        }
        for (var i = 0, len = values.length; i < len; i++) {
            switch (values[i].type) {
                case ETagValueType.TAG:
                    tag = new TagsReadonlyKeyword();
                    tag.setCaption(values[i].caption || values[i].value);
                    tag.setValue(values[i].value);
                    if (this.editableNode) {
                        this.valuesSection.insertBefore(tag.getRoot(), this.editableNode.getRoot());
                    }
                    else {
                        this.valuesSection.appendChild(tag.getRoot());
                    }
                    this.values.push(tag);
                    break;
                case ETagValueType.TEXT:
                    text = new TagsEditableKeyword();
                    if (this.editableNode) {
                        this.valuesSection.insertBefore(text.getRoot(), this.editableNode.getRoot());
                    }
                    else {
                        this.valuesSection.appendChild(text.getRoot());
                    }
                    text.setValue(values[i].value);
                    this.values.push(text);
                    break;
            }
        }
    };
    UITagsComponent.prototype.generateSerializedValues = function () {
        var result = "";
        for (var i = 0, len = this.values.length; i < len; i++) {
            if (this.values[i].getType() === ETagValueType.TAG) {
                result = result + this.values[i].getValue().trim() + " ";
            }
            else {
                result = result + (this.values[i].getCaption()
                    ? this.values[i].getCaption().trim()
                    : (this.values[i].getValue() ? this.values[i].getValue().trim() : "")) + " ";
            }
        }
        result = result.trim();
        return result;
    };
    return UITagsComponent;
}());
var UIFileUpload = (function () {
    function UIFileUpload() {
        this.error = null;
        this.rootNode = document.createElement('div');
        this.rootNode.setAttribute('data-role', 'upload');
        this.fileNameContainer = document.createElement('div');
        this.fileNameContainer.setAttribute('data-role', 'name');
        this.rootNode.appendChild(this.fileNameContainer);
        this.fileSizeContainer = document.createElement('span');
        this.fileSizeContainer.setAttribute('data-role', 'size');
        this.rootNode.appendChild(this.fileSizeContainer);
        this.progressBarOuter = document.createElement('div');
        this.progressBarOuter.setAttribute('data-role', 'progress-bar');
        this.progressBarInner = document.createElement('div');
        this.progressBarInner.setAttribute('data-role', 'progress');
        this.progressBarOuter.appendChild(this.progressBarInner);
        this.removeButton = document.createElement('div');
        this.removeButton.setAttribute('data-role', 'button-remove');
        this.removeButton.setAttribute('aria-labelledby', 'file-control-remove-button-acc');
        this.rootNode.appendChild(this.removeButton);
    }
    UIFileUpload.prototype.withFileUtils = function (fileUtils) {
        this.fileUtils = fileUtils;
        return this;
    };
    UIFileUpload.prototype.updateAccessibilityAttributes = function (id, hasAccessibilityEnabled) {
        this.rootNode.setAttribute('aria-labelledby', 'fileupload-name-' + id + '-acc fileupload-size-' + id + '-acc file-control-error-' + id + '-acc');
        this.rootNode.setAttribute('index', id);
        if (hasAccessibilityEnabled) {
            var removeButtonTextSpan = document.createElement('span');
            removeButtonTextSpan.setAttribute('id', 'file-control-remove-button-acc');
            removeButtonTextSpan.appendChild(document.createTextNode('Remove Button'));
            removeButtonTextSpan.style.display = 'none';
            this.removeButton.appendChild(removeButtonTextSpan);
            this.rootNode.setAttribute('tabindex', '0');
            this.removeButton.setAttribute('tabindex', '0');
        }
        else {
            this.rootNode.removeAttribute('tabindex');
            this.removeButton.removeAttribute('tabindex');
            this.removeButton.textContent = '';
        }
        this.fileNameContainer.setAttribute('id', 'fileupload-name-' + id + '-acc');
        this.fileSizeContainer.setAttribute('id', 'fileupload-size-' + id + '-acc');
        if (this.getError()) {
            this.errorNode.setAttribute('id', 'file-control-error-' + id + '-acc');
        }
    };
    UIFileUpload.prototype.withError = function (e) {
        this.error = e;
        if (null === e) {
            if (this.errorNode) {
                if (this.errorNode.parentNode) {
                    this.errorNode.removeChild(this.errorNode);
                }
                this.errorNode = undefined;
            }
            this.rootNode.removeAttribute('data-has-error');
        }
        else {
            if (!this.errorNode) {
                this.errorNode = document.createElement('div');
                this.errorNode.setAttribute('data-role', 'error');
            }
            this.errorNode.textContent = String(e || 'Error').replace(/^Error\: /g, '');
            this.rootNode.appendChild(this.errorNode);
            this.rootNode.setAttribute('data-has-error', '');
        }
        return this;
    };
    UIFileUpload.prototype.getError = function () {
        if (null === this.error) {
            return null;
        }
        else {
            return String(this.error).replace(/^Error: /, '');
        }
    };
    UIFileUpload.prototype.withName = function (name) {
        this.fileNameContainer.textContent = String(name || 'File');
        this.uploadDetails = this.uploadDetails || {
            name: '',
            progress: 0,
            size: 0,
        };
        this.uploadDetails.name = name;
        return this;
    };
    UIFileUpload.prototype.getName = function () {
        return this.uploadDetails
            ? this.uploadDetails.name
            : null;
    };
    UIFileUpload.prototype.withData = function (data) {
        this.fileData = data;
        return this;
    };
    UIFileUpload.prototype.getData = function () {
        return this.fileData;
    };
    UIFileUpload.prototype.withUrlLinkToDownload = function (url, db) {
        if (url && db && db.getTable('session').getRowAt(0)[0] !== null) {
            var link = document.createElement('a');
            link.setAttribute('class', 'download-url');
            link.href = url;
            link.textContent = this.getName() || 'File';
            link.target = "_blank";
            this.fileNameContainer.textContent = '';
            this.fileNameContainer.appendChild(link);
        }
        return this;
    };
    UIFileUpload.prototype.withProgress = function (progress) {
        progress = ~~progress;
        if (progress < 0) {
            progress = 0;
        }
        if (progress > 100) {
            progress = 100;
        }
        this.progressBarInner.style.width = progress + '%';
        this.uploadDetails = this.uploadDetails || {
            name: '',
            progress: 0,
            size: 0,
        };
        this.uploadDetails.progress = progress;
        return this;
    };
    UIFileUpload.prototype.withUpload = function (upload) {
        var _this = this;
        this.upload = upload || null;
        if (this.upload) {
            this
                .withFileSize(this.upload.getSize())
                .withName(this.upload.getStoredFileNameOnServer() || this.upload.getName())
                .withProgress(0);
            this.upload.on('start', function () {
                _this.withError(null);
                if (!_this.progressBarOuter.parentNode) {
                    _this.rootNode.appendChild(_this.progressBarOuter);
                }
            });
            this.upload.on('progress', function (progress) { return _this.withProgress(progress); });
            this.upload.on('success', function () {
                if (_this.progressBarOuter.parentNode) {
                    _this.progressBarOuter.parentNode.removeChild(_this.progressBarOuter);
                }
                _this.withName(_this.upload.getStoredFileNameOnServer() || _this.upload.getName());
            });
            this.upload.on('error', function (e) { return _this.withError(e); });
            this.upload.on('got-file-data', function (data) { return _this.withData(data); });
        }
        else {
            if (this.uploadDetails) {
                this
                    .withFileSize(this.uploadDetails.size || null)
                    .withName(this.uploadDetails.name)
                    .withProgress(100);
            }
        }
        return this;
    };
    UIFileUpload.prototype.getUploadStatus = function () {
        if (!this.upload) {
            return EUploadState.SUCCESS;
        }
        else {
            return this.upload.getState();
        }
    };
    UIFileUpload.prototype.getRootNode = function () {
        return this.rootNode;
    };
    UIFileUpload.prototype.getSize = function () {
        if (this.upload) {
            return this.upload.getSize();
        }
        else {
            return null;
        }
    };
    UIFileUpload.prototype.cancel = function () {
        return (function (self, $) {
            return $.Deferred(function (defer) {
                if (self.upload) {
                    self.upload.remove().always(function () {
                        defer.resolve(true);
                    });
                }
                else {
                    defer.resolve(true);
                }
            }).promise();
        })(this, UI.getJQuery());
    };
    UIFileUpload.prototype.withFileSize = function (fileSize) {
        this.fileSize = Math.max(0, ~~fileSize);
        if (this.fileUtils && null !== this.fileSize && undefined !== this.fileSize && 0 < this.fileSize) {
            this.fileSizeContainer.textContent = '(' + this.fileUtils.convertFileSizeToString(this.fileSize) + ')';
        }
        else {
            this.fileSizeContainer.textContent = '';
        }
        return this;
    };
    UIFileUpload.prototype.getTransferType = function () {
        return EFileTransferType.UPLOAD;
    };
    UIFileUpload.prototype.getHash = function () {
        return null;
    };
    return UIFileUpload;
}());
var UIFileDownload = (function (_super) {
    __extends(UIFileDownload, _super);
    function UIFileDownload(fileControl) {
        var _this = _super.call(this) || this;
        _this.fileControl = fileControl;
        _this.rootNode.setAttribute('data-role', 'download');
        return _this;
    }
    UIFileDownload.prototype.withDownloadURL = function (url) {
        this.downloadURL = url;
        return this;
    };
    UIFileDownload.prototype.withSubmissionId = function (submissionId) {
        this.submissionId = submissionId;
        return this;
    };
    UIFileDownload.prototype.withUploaderInstanceIndex = function (uploaderInstanceIndex) {
        this.uploaderInstanceIndex = uploaderInstanceIndex;
        return this;
    };
    UIFileDownload.prototype.withSessionId = function (sessionId) {
        this.sessionId = sessionId;
        return this;
    };
    UIFileDownload.prototype.withUploadsService = function (uploadsService) {
        this.uploadsService = uploadsService;
        return this;
    };
    UIFileDownload.prototype.getTransferType = function () {
        return EFileTransferType.DOWNLOAD;
    };
    UIFileDownload.prototype.getDownloadURL = function () {
        return this.downloadURL;
    };
    UIFileDownload.prototype.cancel = function () {
        var _this = this;
        return this.uploadsService.removeSubmittedUpload(this.sessionId, this.submissionId, this.uploaderInstanceIndex).then(function () {
            _this.fileControl.setDownloadInfo(null);
        });
    };
    UIFileDownload.prototype.getUploadStatus = function () {
        return EUploadState.SUCCESS;
    };
    UIFileDownload.prototype.getHash = function () {
        return this.downloadURL
            ? (/fileid=([a-f\d]+)/i.exec(this.downloadURL) || [])[1] || null
            : null;
    };
    return UIFileDownload;
}(UIFileUpload));
var UIStarRating = (function (_super) {
    __extends(UIStarRating, _super);
    function UIStarRating() {
        var _this = _super.call(this, UI.ELEMENT_TYPE_STAR_RATING) || this;
        _this.value = 0;
        _this.minValue = 0;
        _this.maxValue = 10;
        _this.stars = [];
        _this.starShapeType = 'stars';
        _this.withMaxValue(_this.maxValue);
        _this.setValue(_this.value);
        _this.init();
        _this.rootNode.removeAttribute('tabindex');
        return _this;
    }
    UIStarRating.prototype.getValue = function () {
        return this.value;
    };
    UIStarRating.prototype.setValue = function (value) {
        value = ~~value;
        if (value < this.minValue) {
            throw new Error('Illegal value: Expected values >= ' + this.minValue);
        }
        if (value > this.maxValue) {
            throw new Error('Illegal value: Expected values <= ' + this.maxValue);
        }
        this.value = value;
        for (var i = 0, len = this.stars.length; i < len; i++) {
            if (i + 1 <= this.value) {
                this.stars[i].setAttribute('data-is-checked', '1');
            }
            else {
                this.stars[i].removeAttribute('data-is-checked');
            }
            var currentAccTextDOMNode = this.rootNode.querySelector("span[id='starrating-" + this.hash + "-" + i + "']");
            if (currentAccTextDOMNode) {
                currentAccTextDOMNode.textContent = (i + 1) + " of " + this.maxValue;
            }
            this.stars[i].removeAttribute('aria-label');
        }
        var selectedStarDOMNode = this.rootNode.querySelector("span[id='starrating-" + this.hash + "-" + (this.value - 1) + "']");
        if (selectedStarDOMNode) {
            selectedStarDOMNode.setAttribute('role', 'alert');
            selectedStarDOMNode.textContent = 'Selected ' + this.value + " of " + this.maxValue;
        }
        var currentStarDOMNodeIndex = this.value - 1;
        if (this.stars[currentStarDOMNodeIndex]) {
            this.stars[currentStarDOMNodeIndex].setAttribute('aria-label', 'Selected ' + this.value + " of " + this.maxValue);
        }
    };
    UIStarRating.prototype.getMinValue = function () {
        return this.minValue;
    };
    UIStarRating.prototype.withMinValue = function (value) {
        value = ~~value;
        if (value < 0) {
            throw new Error('Invalid argument: Min value should be >= 0');
        }
        if (value > this.maxValue) {
            throw new Error('Invalid argument: Min value should not be greater than maxValue');
        }
        this.minValue = value;
        return this;
    };
    UIStarRating.prototype.getMaxValue = function () {
        return this.maxValue;
    };
    UIStarRating.prototype.withHash = function (hash) {
        this.hash = hash;
        return this;
    };
    UIStarRating.prototype.withMaxValue = function (value) {
        var numberOfStars, star;
        value = ~~value;
        if (value < this.minValue) {
            throw new Error('Invalid argument: Max value should be >= MinValue');
        }
        this.maxValue = value;
        numberOfStars = this.stars.length;
        while (numberOfStars !== this.maxValue) {
            if (numberOfStars > this.maxValue) {
                numberOfStars--;
                this.rootNode.removeChild(this.stars[numberOfStars]);
                this.stars.splice(numberOfStars, 1);
            }
            else {
                numberOfStars++;
                star = document.createElement('div');
                star.setAttribute('data-role', 'star');
                star.setAttribute('data-star-index', String(numberOfStars));
                star.tabIndex = 0;
                this.rootNode.appendChild(star);
                this.stars.push(star);
            }
        }
        if (this.value > this.maxValue) {
            this.setValue(this.maxValue);
        }
        this.onAccessibilitySettingsChanged();
        return this;
    };
    UIStarRating.prototype.onAccessibilitySettingsChanged = function () {
        for (var i = 0, len = this.stars.length; i < len; i++) {
            if (this.hash) {
                var starText = document.createElement('span');
                starText.setAttribute('id', 'starrating-' + this.hash + '-' + i);
                starText.appendChild(document.createTextNode(String(i + 1) + ' of ' + this.maxValue));
                starText.style.display = 'none';
                this.stars[i].appendChild(starText);
                this.stars[i].setAttribute('aria-labelledby', 'starrating-' + this.hash + '-' + i);
            }
            else {
                this.stars[i].textContent = '';
            }
        }
    };
    UIStarRating.prototype.init = function () {
        (function (self, $, root) {
            self.rootNode.setAttribute('data-star-shape-type', self.starShapeType);
            Object.defineProperty(root, 'value', {
                get: function () {
                    return self.getValue();
                },
                set: function (value) {
                    self.setValue(value);
                }
            });
            Object.defineProperty(root, 'minValue', {
                get: function () {
                    return self.getMinValue();
                },
                set: function (minValue) {
                    self.withMinValue(minValue);
                }
            });
            Object.defineProperty(root, 'maxValue', {
                get: function () {
                    return self.getMaxValue();
                },
                set: function (maxValue) {
                    self.withMaxValue(maxValue);
                }
            });
            Object.defineProperty(root, 'starShapeType', {
                get: function () {
                    return self.getStarShapeType();
                },
                set: function (starShapeType) {
                    self.withStarShapeType(starShapeType);
                }
            });
            $(root).on('click', 'div[data-role=star]', function (e) {
                if (self.isReadOnly()) {
                    return;
                }
                var starValue = ~~$(this).attr('data-star-index');
                self.setValue(starValue);
                $(root).trigger('input');
            });
            $(root).on('mouseover', 'div[data-role=star]', function (e) {
                if (self.isReadOnly()) {
                    return;
                }
                var hover = true;
                for (var i = 0, len = self.stars.length; i < len; i++) {
                    if (hover) {
                        self.stars[i].setAttribute('data-is-hover', '1');
                    }
                    else {
                        self.stars[i].removeAttribute('data-is-hover');
                    }
                    if (self.stars[i] === this) {
                        hover = false;
                    }
                }
            });
            $(root)
                .on('mouseout', 'div[data-role=star]', function (e) {
                if (self.isReadOnly()) {
                    return;
                }
                for (var i = 0, len = self.stars.length; i < len; i++) {
                    self.stars[i].removeAttribute('data-is-hover');
                }
            })
                .on('focus', 'div[data-role=star]', function () {
                $(this).attr('data-rating-tab-focus-state', '1');
            })
                .on('blur', 'div[data-role=star]', function () {
                $(this).removeAttr('data-rating-tab-focus-state');
            });
        })(this, UI.getJQuery(), this.rootNode);
    };
    UIStarRating.prototype.withStarShapeType = function (starShapeType) {
        switch (starShapeType) {
            case 'adults':
            case 'children':
            case 'stars':
                this.starShapeType = starShapeType;
                break;
            default:
                this.starShapeType = 'stars';
                console.warn('UIStarRating: Invalid star shape type: ' + JSON.stringify(starShapeType));
                break;
        }
        this.rootNode.setAttribute('data-star-shape-type', this.starShapeType);
        return this;
    };
    UIStarRating.prototype.getStarShapeType = function () {
        return this.starShapeType;
    };
    return UIStarRating;
}(UIElement));
var EMenuPanelItemIconType;
(function (EMenuPanelItemIconType) {
    EMenuPanelItemIconType[EMenuPanelItemIconType["ICON"] = 0] = "ICON";
    EMenuPanelItemIconType[EMenuPanelItemIconType["ICONFONT"] = 1] = "ICONFONT";
})(EMenuPanelItemIconType || (EMenuPanelItemIconType = {}));
var ELightboxOverlayLinkType;
(function (ELightboxOverlayLinkType) {
    ELightboxOverlayLinkType[ELightboxOverlayLinkType["TEXT"] = 0] = "TEXT";
    ELightboxOverlayLinkType[ELightboxOverlayLinkType["IMAGE"] = 1] = "IMAGE";
    ELightboxOverlayLinkType[ELightboxOverlayLinkType["AUTO_POPUP"] = 2] = "AUTO_POPUP";
    ELightboxOverlayLinkType[ELightboxOverlayLinkType["FLOATING_BUTTON"] = 3] = "FLOATING_BUTTON";
})(ELightboxOverlayLinkType || (ELightboxOverlayLinkType = {}));
var ELinkToFormOverlayLinkType;
(function (ELinkToFormOverlayLinkType) {
    ELinkToFormOverlayLinkType[ELinkToFormOverlayLinkType["TEXT"] = 0] = "TEXT";
    ELinkToFormOverlayLinkType[ELinkToFormOverlayLinkType["IMAGE"] = 1] = "IMAGE";
})(ELinkToFormOverlayLinkType || (ELinkToFormOverlayLinkType = {}));
var EPanelTypes;
(function (EPanelTypes) {
    EPanelTypes["PUBLISH"] = "publish-form";
    EPanelTypes["NOTIFICATIONS"] = "notifications";
    EPanelTypes["EDITOR"] = "editor";
    EPanelTypes["TRANSLATIONS"] = "translations";
    EPanelTypes["ITEM"] = "item";
    EPanelTypes["PRODUCTS"] = "productsDialog";
})(EPanelTypes || (EPanelTypes = {}));
var AbstractMenuPanelChild = (function (_super) {
    __extends(AbstractMenuPanelChild, _super);
    function AbstractMenuPanelChild() {
        var _this = _super.call(this) || this;
        _this.rootNode = document.createElement('div');
        return _this;
    }
    AbstractMenuPanelChild.prototype.trackEvent = function (metric) {
        CFTracker && CFTracker.event(metric);
        console.log('tracker :: ' + metric);
    };
    AbstractMenuPanelChild.prototype.getRootNode = function () {
        return this.rootNode;
    };
    AbstractMenuPanelChild.prototype.getParent = function (parentClassType) {
        if (undefined === parentClassType) {
            return this.parent;
        }
        else {
            var cursor = this.parent;
            do {
                if (!cursor) {
                    return null;
                }
                if (cursor instanceof parentClassType) {
                    return cursor;
                }
                cursor = cursor.getParent(parentClassType);
            } while (cursor);
        }
    };
    AbstractMenuPanelChild.prototype.withParent = function (parent) {
        this.parent = parent;
        return this;
    };
    AbstractMenuPanelChild.prototype.getElementById = function (elementId) {
        if (this.getId && this.getId() === elementId) {
            return this;
        }
        if (!this.getChildren) {
            return null;
        }
        for (var children = this.getChildren(), len = children.length, i = 0; i < len; i++) {
            if (children[i].getElementById) {
                var foundElement = void 0;
                if (foundElement = children[i].getElementById(elementId)) {
                    return foundElement;
                }
            }
        }
        return null;
    };
    AbstractMenuPanelChild.prototype.withId = function (menuPanelElementId) {
        this.elementId = menuPanelElementId;
        this.rootNode.setAttribute('data-id', menuPanelElementId);
        return this;
    };
    AbstractMenuPanelChild.prototype.getId = function () {
        return this.elementId;
    };
    AbstractMenuPanelChild.prototype.getDependency = function (dependencyName) {
        var cursor = this;
        while (cursor.getParent && cursor.getParent()) {
            cursor = cursor.getParent();
        }
        if (cursor.getDependency) {
            return cursor.getDependency(dependencyName);
        }
        else {
            return null;
        }
    };
    AbstractMenuPanelChild.prototype.withVisibilityState = function (visibilityFlag) {
        this.rootNode.setAttribute('data-is-hidden', String(visibilityFlag));
        return this;
    };
    AbstractMenuPanelChild.prototype.isVisible = function () {
        var isHiddenAttribute = this.rootNode.getAttribute('data-is-hidden');
        if (isHiddenAttribute === "true") {
            return true;
        }
        return false;
    };
    return AbstractMenuPanelChild;
}(EventEmitter));
var AbstractMenuPanelChildThatSupportsChildren = (function (_super) {
    __extends(AbstractMenuPanelChildThatSupportsChildren, _super);
    function AbstractMenuPanelChildThatSupportsChildren() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.children = [];
        return _this;
    }
    AbstractMenuPanelChildThatSupportsChildren.prototype.appendChild = function (child) {
        this.getRootNode().appendChild(child.getRootNode());
        child.withParent(this);
        this.children.push(child);
        return this;
    };
    AbstractMenuPanelChildThatSupportsChildren.prototype.appendChildIf = function (condition, child) {
        if (true === condition && null !== child) {
            return this.appendChild(child);
        }
        return this;
    };
    AbstractMenuPanelChildThatSupportsChildren.prototype.getChildren = function () {
        return this.children;
    };
    AbstractMenuPanelChildThatSupportsChildren.prototype.removeChild = function (child) {
        var childIndex = this.children.indexOf(child);
        if (childIndex > -1) {
            this.children.splice(childIndex, 1);
        }
        return this;
    };
    return AbstractMenuPanelChildThatSupportsChildren;
}(AbstractMenuPanelChild));
var MenuPanelComponent = (function (_super) {
    __extends(MenuPanelComponent, _super);
    function MenuPanelComponent() {
        var _this = _super.call(this) || this;
        _this.dependencies = {};
        _this.enableSyncMode();
        _this.getRootNode().setAttribute('data-role', 'menu-panel');
        _this.on('filter', function (filterText) {
            for (var children = _this.getChildren(), len = children.length, i = 0; i < len; i++) {
                children[i].trigger('filter', filterText);
            }
        });
        return _this;
    }
    MenuPanelComponent.prototype.withDependency = function (propertyName, propertyValue) {
        this.dependencies[propertyName] = propertyValue;
        return this;
    };
    MenuPanelComponent.prototype.getDependency = function (propertyName) {
        return undefined === this.dependencies[propertyName]
            ? null
            : this.dependencies[propertyName];
    };
    MenuPanelComponent.prototype.getId = function () {
        return this.id;
    };
    MenuPanelComponent.prototype.withId = function (id) {
        this.id = id;
        this.getRootNode().setAttribute('id', this.id);
        return this;
    };
    MenuPanelComponent.prototype.setOpened = function (openedState) {
        if (openedState && !this.openedState) {
            if (this.getParent()) {
                if (!this.getParent().isOpened()) {
                    this.getParent().setOpened(true);
                }
            }
            else {
                this.trigger('open');
            }
        }
        var children = this.getChildren();
        for (var i = 0, len = children.length; i < len; i++) {
            if (children[i].setOpened) {
                children[i].setOpened(false);
            }
        }
        if (!openedState) {
            if (this.getRootNode().parentNode) {
                this.getRootNode().parentNode.removeChild(this.getRootNode());
            }
        }
        else {
            this.openFirstChild();
        }
        this.openedState = openedState;
        return this;
    };
    MenuPanelComponent.prototype.openElementById = function (elementId) {
        var element = this.getElementById(elementId);
        if (element && element.setOpened) {
            element.setOpened(true);
        }
    };
    MenuPanelComponent.prototype.isOpened = function () {
        return this.openedState;
    };
    MenuPanelComponent.prototype.render = function () {
        var myParentRootBoundingRect = this.getParent(MenuPanelComponent).getRootNode().getBoundingClientRect();
        document.body.appendChild(this.getRootNode());
        this.getRootNode().style.left = myParentRootBoundingRect.left + myParentRootBoundingRect.width + 'px';
        this.getRootNode().style.top = myParentRootBoundingRect.top + "px";
        this.getRootNode().style.bottom = document.documentElement.offsetHeight
            - myParentRootBoundingRect.top
            - myParentRootBoundingRect.height + "px";
    };
    MenuPanelComponent.prototype.openFirstChild = function () {
        var firstChild = this.getChildren()[0] || null;
        if (!firstChild) {
            return;
        }
        if (firstChild instanceof MenuPanelComponent || firstChild instanceof MenuPanelExtensionComponent) {
            firstChild.render();
        }
    };
    return MenuPanelComponent;
}(AbstractMenuPanelChildThatSupportsChildren));
var MenuPanelHeaderComponent = (function (_super) {
    __extends(MenuPanelHeaderComponent, _super);
    function MenuPanelHeaderComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-role', 'menu-panel-header');
        _this.captionDOMNode = document.createElement('span');
        _this.captionDOMNode.setAttribute('data-role', 'caption');
        _this.backButtonDOMNode = document.createElement('a');
        _this.backButtonDOMNode.setAttribute('href', 'javascript:void(0)');
        _this.backButtonDOMNode.setAttribute('data-role', 'back-button');
        _this.backButtonDOMNode.innerHTML = "<span class='i-lg i123-arrow-left2'></span>";
        _this.searchInputDOMNode = document.createElement('input');
        _this.searchInputDOMNode.setAttribute('data-role', 'search');
        _this.searchInputDOMNode.setAttribute('type', 'text');
        _this.searchIconDOMNode = document.createElement('span');
        _this.searchIconDOMNode.setAttribute('data-role', 'search-icon');
        _this.searchIconDOMNode.innerHTML = "<span class='i-lg i123-search'></span>";
        _this.closeIconDOMNode = document.createElement('span');
        _this.closeIconDOMNode.setAttribute('data-role', 'close-icon');
        _this.closeIconDOMNode.innerHTML = "<span class='i-lg i123-close'></span>";
        _this.getRootNode().appendChild(_this.captionDOMNode);
        _this.backButtonDOMNode.onclick = _this.captionDOMNode.onclick = function () {
            _this.closeParent();
            _this.trigger('back');
        };
        _this.searchInputDOMNode.onfocus = function () {
            _this.getRootNode().setAttribute('data-is-focused', '1');
            _this.trackEvent('publish_search');
        };
        _this.searchInputDOMNode.onblur = function () {
            if (!_this.searchInputDOMNode.value) {
                _this.getRootNode().removeAttribute('data-is-focused');
            }
        };
        _this.searchIconDOMNode.onclick = function () {
            _this.getRootNode().setAttribute('data-is-focused', '1');
            _this.searchInputDOMNode.focus();
        };
        _this.searchInputDOMNode.oninput = function () {
            var searchText = _this.searchInputDOMNode.value;
            _this.getParent(MenuPanelComponent).trigger('filter', searchText);
        };
        _this.closeIconDOMNode.onclick = function () {
            _this.trackEvent('publish_search_clear');
            _this.getRootNode().removeAttribute('data-is-focused');
            _this.searchInputDOMNode.value = '';
            _this.getParent(MenuPanelComponent).trigger('filter', '');
        };
        return _this;
    }
    MenuPanelHeaderComponent.prototype.withSearchCaption = function (searchCaption, i18nKey) {
        this.searchCaption = searchCaption;
        this.searchCaptionI18nKey = i18nKey;
        this.searchInputDOMNode.setAttribute('placeholder', this.searchCaption);
        this.searchInputDOMNode.setAttribute('data-i18n-placeholder', this.searchCaptionI18nKey);
        return this;
    };
    MenuPanelHeaderComponent.prototype.getSearchCaption = function () {
        return this.searchCaption;
    };
    MenuPanelHeaderComponent.prototype.withSearchable = function (searchable) {
        this.searchable = searchable;
        if (searchable) {
            this.getRootNode().appendChild(this.searchInputDOMNode);
            this.getRootNode().appendChild(this.searchIconDOMNode);
            this.getRootNode().appendChild(this.closeIconDOMNode);
            this.getRootNode().setAttribute('data-is-searchable', '');
        }
        else {
            if (this.searchInputDOMNode.parentNode) {
                this.getRootNode().removeChild(this.searchInputDOMNode);
            }
            if (this.searchIconDOMNode.parentNode) {
                this.getRootNode().removeChild(this.searchIconDOMNode);
            }
            if (this.closeIconDOMNode.parentNode) {
                this.getRootNode().removeChild(this.closeIconDOMNode);
            }
            this.getRootNode().removeAttribute('data-is-searchable');
        }
        return this;
    };
    MenuPanelHeaderComponent.prototype.isSearchable = function () {
        return this.searchable;
    };
    MenuPanelHeaderComponent.prototype.withCaption = function (captionText, i18nKey) {
        this.captionText = captionText;
        this.i18nCaptionText = i18nKey;
        this.captionDOMNode.textContent = this.captionText;
        this.captionDOMNode.setAttribute('data-i18n-text', this.i18nCaptionText);
        return this;
    };
    MenuPanelHeaderComponent.prototype.getCaption = function () {
        return this.captionText;
    };
    MenuPanelHeaderComponent.prototype.withBackButton = function (hasBackButton) {
        this.backButton = hasBackButton;
        if (hasBackButton) {
            this.getRootNode().appendChild(this.backButtonDOMNode);
            this.getRootNode().setAttribute('data-has-back-button', '');
        }
        else {
            if (this.backButtonDOMNode.parentNode) {
                this.getRootNode().removeChild(this.backButtonDOMNode);
            }
            this.getRootNode().removeAttribute('data-has-back-button');
        }
        return this;
    };
    MenuPanelHeaderComponent.prototype.hasBackButton = function () {
        return this.backButton;
    };
    MenuPanelHeaderComponent.prototype.closeParent = function () {
        if (this.getParent(MenuPanelItemComponent)) {
            this.getParent(MenuPanelItemComponent).setOpened(false);
        }
    };
    MenuPanelHeaderComponent.prototype.withId = function (elementId) {
        this.id = elementId;
        if (elementId) {
            this.getRootNode().setAttribute('data-component-id', elementId);
        }
        else {
            this.getRootNode().removeAttribute('data-component-id');
        }
        return this;
    };
    MenuPanelHeaderComponent.prototype.getId = function () {
        return this.id;
    };
    return MenuPanelHeaderComponent;
}(AbstractMenuPanelChild));
var MenuPanelItemComponent = (function (_super) {
    __extends(MenuPanelItemComponent, _super);
    function MenuPanelItemComponent() {
        var _this = _super.call(this) || this;
        _this.iconType = null;
        _this.opened = false;
        _this.isRegularItem = false;
        _this.platformMetric = '';
        if (!window['builderUrlHandler']) {
            throw new Error('Dependency not found: builderUrlHandler');
        }
        _this.URLHandler = window['builderUrlHandler'];
        _this.getRootNode().setAttribute('data-role', 'menu-panel-item');
        _this.iconPlaceholderSpan = document.createElement('span');
        _this.iconPlaceholderSpan.setAttribute('data-role', 'icon');
        _this.getRootNode().appendChild(_this.iconPlaceholderSpan);
        _this.captionPlaceholderSpan = document.createElement('span');
        _this.captionPlaceholderSpan.setAttribute('data-role', 'caption');
        _this.getRootNode().appendChild(_this.captionPlaceholderSpan);
        _this.getRootNode().onclick = function () {
            _this.trigger('click');
            if (!_this.isRegularItem) {
                _this.setOpened(true);
            }
            _this.initPlatformMetricsManager();
        };
        return _this;
    }
    MenuPanelItemComponent.prototype.withPlatformMetric = function (platformMetric) {
        this.platformMetric = platformMetric;
        return this;
    };
    MenuPanelItemComponent.prototype.withImageIcon = function (imageURLAddress) {
        this.iconType = EMenuPanelItemIconType.ICON;
        var icon = document.createElement('img');
        icon.src = imageURLAddress;
        this.iconPlaceholderSpan.textContent = '';
        this.iconPlaceholderSpan.appendChild(icon);
        this.iconPlaceholderSpan.setAttribute('data-icon-type', 'image');
        this.imageIconURL = imageURLAddress;
        this.iconFontClass = undefined;
        this.getRootNode().setAttribute('data-icon-type', 'image');
        return this;
    };
    MenuPanelItemComponent.prototype.withCaption = function (captionText, i18nKey) {
        this.captionText = captionText;
        this.captionTextI18n = i18nKey;
        this.captionPlaceholderSpan.textContent = captionText;
        if (i18nKey) {
            this.captionPlaceholderSpan.setAttribute('data-i18n-text', i18nKey);
        }
        else {
            this.captionPlaceholderSpan.removeAttribute('data-i18n-text');
        }
        return this;
    };
    MenuPanelItemComponent.prototype.getCaptionText = function () {
        return this.captionText;
    };
    MenuPanelItemComponent.prototype.getCaptionTextI18n = function () {
        return this.captionTextI18n;
    };
    MenuPanelItemComponent.prototype.withCustomFontIcon = function (customFontIconClass) {
        this.iconType = EMenuPanelItemIconType.ICONFONT;
        this.iconPlaceholderSpan.setAttribute('data-icon-type', 'iconfont');
        this.iconPlaceholderSpan.innerHTML = '<span class="i123 i-lg ' + customFontIconClass + '"></span>';
        this.imageIconURL = undefined;
        this.iconFontClass = customFontIconClass;
        this.getRootNode().setAttribute('data-icon-type', 'iconfont');
        return this;
    };
    MenuPanelItemComponent.prototype.getImageIconURL = function () {
        return this.imageIconURL;
    };
    MenuPanelItemComponent.prototype.getIconFontClass = function () {
        return this.iconFontClass;
    };
    MenuPanelItemComponent.prototype.appendChild = function (child) {
        if (!this.expanderIconPlaceholder && child instanceof MenuPanelComponent) {
            this.addExpanderIconToItem();
        }
        this.getChildren().push(child);
        child.withParent(this);
        return this;
    };
    MenuPanelItemComponent.prototype.addExpanderIconToItem = function () {
        this.expanderIconPlaceholder = document.createElement('span');
        this.expanderIconPlaceholder.setAttribute('data-role', 'expander');
        this.expanderIconPlaceholder.innerHTML = '<span class="i123 i123-arrow-right2"></span>';
        this.getRootNode().appendChild(this.expanderIconPlaceholder);
    };
    MenuPanelItemComponent.prototype.setOpened = function (openedState) {
        if (openedState) {
            if (this.getParent()) {
                this.getParent().setOpened(true);
                this.URLHandler.setNewUrl('publish-form', this.getRootNode().getAttribute('data-id'));
            }
            var siblings = this.getParent().getChildren();
            for (var i = 0, len = siblings.length; i < len; i++) {
                if (siblings[i] !== this && siblings[i].setOpened) {
                    siblings[i].setOpened(false);
                }
            }
            this.getRootNode().setAttribute('data-opened', '');
            this.openFirstChild();
            this.opened = true;
        }
        else {
            var children = this.getChildren();
            for (var i = 0, len = children.length; i < len; i++) {
                if (children[i].setOpened) {
                    children[i].setOpened(false);
                }
            }
            this.getRootNode().removeAttribute('data-opened');
            this.opened = false;
        }
        return this;
    };
    MenuPanelItemComponent.prototype.openFirstChild = function () {
        var firstChild = this.getChildren()[0] || null;
        if (!firstChild) {
            return;
        }
        if (firstChild instanceof MenuPanelComponent || firstChild instanceof MenuPanelExtensionComponent) {
            firstChild.render();
        }
    };
    MenuPanelItemComponent.prototype.withExpanderIconIncluded = function (shouldIconBeIncluded) {
        if (shouldIconBeIncluded) {
            if (!this.expanderIconPlaceholder) {
                this.addExpanderIconToItem();
            }
        }
        return this;
    };
    MenuPanelItemComponent.prototype.withRegularItem = function (isRegularItem) {
        if (isRegularItem) {
            if (this.getRootNode()) {
                this.getRootNode().setAttribute('data-is-regular-item', '1');
                this.isRegularItem = true;
            }
        }
        return this;
    };
    MenuPanelItemComponent.prototype.isOpened = function () {
        return this.opened;
    };
    MenuPanelItemComponent.prototype.initPlatformMetricsManager = function () {
        var platformMetricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        if ('' !== this.platformMetric &&
            null !== platformMetricsManager) {
            platformMetricsManager.trackPlatformMetric(this.platformMetric);
        }
    };
    return MenuPanelItemComponent;
}(AbstractMenuPanelChildThatSupportsChildren));
var MenuPanelDividerComponent = (function (_super) {
    __extends(MenuPanelDividerComponent, _super);
    function MenuPanelDividerComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-role', 'menu-panel-divider');
        return _this;
    }
    return MenuPanelDividerComponent;
}(AbstractMenuPanelChild));
var MenuPanelHeadingComponent = (function (_super) {
    __extends(MenuPanelHeadingComponent, _super);
    function MenuPanelHeadingComponent() {
        var _this = _super.call(this) || this;
        _this.heading = document.createElement('h2');
        _this.getRootNode().appendChild(_this.heading);
        _this.getRootNode().setAttribute('data-role', 'menu-panel-heading');
        return _this;
    }
    MenuPanelHeadingComponent.prototype.setCaption = function (captionText, i18nKey) {
        this.heading.textContent = captionText;
        if (i18nKey) {
            this.heading.setAttribute('data-i18n-text', i18nKey);
        }
        else {
            this.heading.removeAttribute('data-i18n-text');
        }
        return this;
    };
    return MenuPanelHeadingComponent;
}(AbstractMenuPanelChild));
var MenuPanelCheckboxComponent = (function (_super) {
    __extends(MenuPanelCheckboxComponent, _super);
    function MenuPanelCheckboxComponent() {
        var _this = _super.call(this) || this;
        _this.domainAlias = window.location.host;
        MenuPanelCheckboxComponent.instanceID++;
        _this.getRootNode().setAttribute('data-role', 'menu-panel-checkbox');
        _this.checkboxInputNode = document.createElement('input');
        _this.checkboxInputNode.setAttribute('type', 'checkbox');
        _this.checkboxInputNode.setAttribute('id', 'menu-panel-checkbox-' + MenuPanelCheckboxComponent.instanceID);
        _this.labelDOMNode = document.createElement('label');
        _this.labelDOMNode.setAttribute('data-role', 'label');
        _this.labelDOMNode.setAttribute('for', 'menu-panel-checkbox-' + MenuPanelCheckboxComponent.instanceID);
        var checkboxSkinLabel = document.createElement('label');
        checkboxSkinLabel.setAttribute('data-role', 'checkbox-skin');
        checkboxSkinLabel.setAttribute('for', 'menu-panel-checkbox-' + MenuPanelCheckboxComponent.instanceID);
        _this.getRootNode().appendChild(_this.checkboxInputNode);
        _this.getRootNode().appendChild(checkboxSkinLabel);
        _this.getRootNode().appendChild(_this.labelDOMNode);
        _this.addPanelCheckboxEventListeners();
        return _this;
    }
    MenuPanelCheckboxComponent.prototype.withDomainAlias = function (domainAlias) {
        this.domainAlias = domainAlias;
        return this;
    };
    MenuPanelCheckboxComponent.prototype.withChecked = function (checkedState) {
        this.checkboxInputNode.checked = checkedState;
        return this;
    };
    MenuPanelCheckboxComponent.prototype.isChecked = function () {
        return this.checkboxInputNode.checked;
    };
    MenuPanelCheckboxComponent.prototype.withCaption = function (captionText, i18nKey) {
        this.captionText = captionText;
        this.i18nCaptionText = i18nKey;
        this.labelDOMNode.textContent = this.captionText;
        this.labelDOMNode.setAttribute('data-i18n-text', this.i18nCaptionText);
        return this;
    };
    MenuPanelCheckboxComponent.prototype.getCaption = function () {
        return this.captionText;
    };
    MenuPanelCheckboxComponent.prototype.addPanelCheckboxEventListeners = function () {
    };
    MenuPanelCheckboxComponent.prototype.trackEvent = function (metric) {
        CFTracker && CFTracker.event(metric);
        console.log('tracker :: ' + metric);
    };
    MenuPanelCheckboxComponent.instanceID = 0;
    return MenuPanelCheckboxComponent;
}(AbstractMenuPanelChild));
var MenuPanelExtensionComponent = (function (_super) {
    __extends(MenuPanelExtensionComponent, _super);
    function MenuPanelExtensionComponent() {
        var _this = _super.call(this) || this;
        _this.initialized = false;
        _this.getRootNode().setAttribute('data-role', 'menu-panel-html-overlay');
        _this.header = document.createElement('div');
        _this.header.setAttribute('data-role', 'header');
        _this.getRootNode().appendChild(_this.header);
        _this.body = document.createElement('div');
        _this.body.setAttribute('data-role', 'body');
        _this.getRootNode().appendChild(_this.body);
        _this.backButton = document.createElement('span');
        _this.backButton.innerHTML = '<i class="i-lg i123-arrow-left2"></i>';
        _this.backButton.setAttribute('data-role', 'back-button');
        _this.captionPlaceholderSpan = document.createElement('span');
        _this.captionPlaceholderSpan.setAttribute('data-role', 'caption');
        _this.header.appendChild(_this.backButton);
        _this.header.appendChild(_this.captionPlaceholderSpan);
        _this.backButton.onclick = function () {
            _this.close();
        };
        return _this;
    }
    MenuPanelExtensionComponent.prototype.setResourceURLAddress = function (resourceURLAddres) {
        this.resourceURLAddress = resourceURLAddres;
        return this;
    };
    MenuPanelExtensionComponent.prototype.withCaption = function (captionText, i18nKey) {
        this.captionText = captionText;
        this.captionTextI18n = i18nKey;
        this.captionPlaceholderSpan.textContent = captionText;
        if (i18nKey) {
            this.captionPlaceholderSpan.setAttribute('data-i18n-text', i18nKey);
        }
        else {
            this.captionPlaceholderSpan.removeAttribute('data-i18n-text');
        }
        return this;
    };
    MenuPanelExtensionComponent.prototype.initialize = function () {
        if (this.initialized) {
            return;
        }
        this.loadOverlayComponentUI(null);
        this.checkStickyActionBar();
        this.onOverlayInitialized();
    };
    MenuPanelExtensionComponent.prototype.loadOverlayComponentUI = function (model) {
        var _this = this;
        if (this.resourceURLAddress) {
            UI.getResourceManager().get(this.resourceURLAddress)
                .then(function (htmlMarkupText) {
                var template = new Salvage(htmlMarkupText), templateModel = model
                    ? model
                    : _this.getModel();
                _this.body.innerHTML = template.parse(templateModel);
            });
        }
    };
    MenuPanelExtensionComponent.prototype.getModel = function () {
        return {};
    };
    MenuPanelExtensionComponent.prototype.getOpened = function () {
        return document.body.contains(this.getRootNode());
    };
    MenuPanelExtensionComponent.prototype.setOpened = function (openedState) {
        if (!openedState && this.getRootNode().parentNode) {
            this.getRootNode().parentNode.removeChild(this.getRootNode());
        }
        if (openedState) {
            this.render();
        }
    };
    MenuPanelExtensionComponent.prototype.close = function () {
        if (this.getParent(MenuPanelItemComponent)) {
            this.getParent(MenuPanelItemComponent).setOpened(false);
        }
        if (this.getParent(MenuPanelComponent)) {
            this.setOpened(false);
        }
    };
    MenuPanelExtensionComponent.prototype.getCompactFormName = function (formName) {
        return StringUtils.removeDiacritics(formName).toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/[\-]+/g, '-').replace(/^-|-$/g, '') || 'form';
    };
    MenuPanelExtensionComponent.prototype.includeHTMLOverlayComponentModuleFunctionality = function (templateModel) {
    };
    MenuPanelExtensionComponent.prototype.checkStickyActionBar = function () {
        if (this.getParent()) {
            (function (self) {
                setTimeout(function () {
                    var jq = self.getParent().getDependency('jq');
                    var editorPanelGroup = self.getParent().getDependency('editorPanelGroup');
                    if (jq) {
                        var overlayHeight = $(self.getRootNode()).innerHeight(), contentHeight = $(self.getRootNode()).find('[data-role=body]').innerHeight();
                        var elements = void 0, getNotifEmailOverlay = void 0, getNotifSmsOverlay = void 0;
                        if (!contentHeight) {
                            getNotifEmailOverlay = $(self.getRootNode()).find('[data-role=edit-email-overlay]');
                            getNotifSmsOverlay = $(self.getRootNode()).find('[data-role=edit-sms-overlay]');
                            if (getNotifEmailOverlay.length > 0) {
                                contentHeight = ~~getNotifEmailOverlay.innerHeight();
                            }
                            else if (getNotifSmsOverlay.length > 0) {
                                contentHeight = ~~getNotifSmsOverlay.innerHeight();
                            }
                        }
                        var publishButtonsContainer = void 0, notificationsButtonsContainer = void 0;
                        switch (editorPanelGroup.getActivePanel().getId()) {
                            case EPanelTypes.PUBLISH:
                                elements = jq(self.getRootNode()).find('[data-role=publish-buttons-container], ' +
                                    '[data-role=body]');
                                publishButtonsContainer = jq(self.getRootNode()).find('[data-role=publish-buttons-container]');
                                break;
                            case EPanelTypes.NOTIFICATIONS:
                                if (getNotifEmailOverlay.length > 0) {
                                    elements = jq(self.getRootNode()).find('[data-role=edit-email-overlay] [data-role=buttons-container], '
                                        + '[data-role=edit-email-overlay]');
                                }
                                else if (getNotifSmsOverlay.length > 0) {
                                    elements = jq(self.getRootNode()).find('[data-role=edit-sms-overlay] [data-role=buttons-container], '
                                        + '[data-role=edit-sms-overlay]');
                                }
                                notificationsButtonsContainer = jq(self.getRootNode()).find('[data-role=edit-email-overlay] [data-role=buttons-container]');
                                break;
                        }
                        if (elements) {
                            if (contentHeight > overlayHeight) {
                                elements.addClass('responsive');
                            }
                            else {
                                elements.removeClass('responsive');
                            }
                        }
                    }
                }, 500);
            })(this);
        }
    };
    MenuPanelExtensionComponent.prototype.onOverlayInitialized = function () {
        if (this.metricsManager == null) {
            this.metricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        }
    };
    MenuPanelExtensionComponent.prototype.render = function () {
        var myParentRootBoundingRect = this.getParent(MenuPanelComponent).getRootNode().getBoundingClientRect();
        document.body.appendChild(this.getRootNode());
        this.getRootNode().style.left = myParentRootBoundingRect.left + myParentRootBoundingRect.width + 'px';
        this.getRootNode().style.top = myParentRootBoundingRect.top + "px";
        this.getRootNode().style.bottom = document.documentElement.offsetHeight
            - myParentRootBoundingRect.top
            - myParentRootBoundingRect.height + "px";
        this.getRootNode().style.right = "0";
        this.initialize();
    };
    return MenuPanelExtensionComponent;
}(AbstractMenuPanelChild));
var MenuPanelScrollableComponent = (function (_super) {
    __extends(MenuPanelScrollableComponent, _super);
    function MenuPanelScrollableComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-role', 'scrollable-container');
        _this.on('filter', function (filterText) {
            _this.applyFilterText(filterText);
        });
        return _this;
    }
    MenuPanelScrollableComponent.prototype.setOpened = function (openedState) {
        if (openedState && this.getParent()) {
            this.getParent().setOpened(true);
        }
        var children = this.getChildren();
        for (var i = 0, len = children.length; i < len; i++) {
            if (children[i].setOpened) {
                children[i].setOpened(false);
            }
        }
        return this;
    };
    MenuPanelScrollableComponent.prototype.applyFilterText = function (filterText) {
        filterText = String(filterText || '')
            .toLowerCase()
            .replace(/[\s]+/g, ' ')
            .replace(/(^[\s]+|[\s]+$)/g, '');
        for (var children = this.getChildren(), i = 0, len = children.length; i < len; i++) {
            var childrenRootNode = children[i].getRootNode(), childrenTextContent = childrenRootNode.textContent.toLowerCase();
            if (childrenTextContent.indexOf(filterText) > -1) {
                childrenRootNode.style.display = '';
            }
            else {
                if (children[i].setOpened) {
                    children[i].setOpened(false);
                }
                childrenRootNode.style.display = 'none';
            }
        }
    };
    MenuPanelScrollableComponent.prototype.isOpened = function () {
        return this.opened;
    };
    MenuPanelScrollableComponent.prototype.addPerfectScrollbar = function (commandDispatcher) {
        commandDispatcher.addPerfectScrollbar(this.getRootNode());
        return this;
    };
    return MenuPanelScrollableComponent;
}(AbstractMenuPanelChildThatSupportsChildren));
var MenuPanelDropdownComponent = (function (_super) {
    __extends(MenuPanelDropdownComponent, _super);
    function MenuPanelDropdownComponent() {
        var _this = _super.call(this) || this;
        _this.dropdownItems = [];
        _this.getRootNode().setAttribute('data-role', 'menu-panel-dropdown');
        _this.labelPlaceholderSpan = document.createElement('span');
        _this.labelPlaceholderSpan.setAttribute('data-role', 'label');
        _this.textDropdownSpan = document.createElement('div');
        _this.textDropdownSpan.setAttribute('data-role', 'text-dropdown');
        _this.textDropdownSpan.textContent = undefined !== _this.getItems()[0] ? _this.getItems()[0].caption : "none";
        _this.getRootNode().appendChild(_this.labelPlaceholderSpan);
        _this.getRootNode().appendChild(_this.textDropdownSpan);
        _this.textDropdownSpan.onclick = function () {
            _this.displayTextDropdown();
        };
        return _this;
    }
    MenuPanelDropdownComponent.prototype.withLabel = function (labelText, i18nKey) {
        this.labelText = labelText;
        this.i18nLabelText = i18nKey;
        this.labelPlaceholderSpan.textContent = this.labelText;
        this.labelPlaceholderSpan.setAttribute('data-i18n-text', this.i18nLabelText);
        return this;
    };
    MenuPanelDropdownComponent.prototype.getCaption = function () {
        return this.labelText;
    };
    MenuPanelDropdownComponent.prototype.withItems = function (items) {
        if (items.length !== 0) {
            for (var i = 0, len = items.length; i < len; i++) {
                this.dropdownItems.push({
                    id: items[i].id,
                    caption: items[i].caption,
                    i18nKey: items[i].i18nKey
                });
            }
        }
        return this;
    };
    MenuPanelDropdownComponent.prototype.withSingleItem = function (item) {
        if (null !== item) {
            this.dropdownItems.push({
                id: item.id,
                caption: item.caption,
                i18nKey: item.i18nKey
            });
        }
        return this;
    };
    MenuPanelDropdownComponent.prototype.withSelectedItemId = function (selectedItemId) {
        if (selectedItemId) {
            this.textDropdownSpan.textContent = selectedItemId;
            this.textDropdownSpan.title = selectedItemId;
        }
        return this;
    };
    MenuPanelDropdownComponent.prototype.clearAllItems = function () {
        this.dropdownItems = [];
    };
    MenuPanelDropdownComponent.prototype.getItems = function () {
        return this.dropdownItems;
    };
    MenuPanelDropdownComponent.prototype.displayTextDropdown = function () {
        var _this = this;
        if (this.getRootNode().hasAttribute('data-is-opened')) {
            return;
        }
        this.getRootNode().setAttribute('data-is-opened', '1');
        this.withVisibilityState(true);
        var overlayElement = document.createElement('div'), optionElement;
        overlayElement.setAttribute('data-role', 'text-dropdown-overlay');
        for (var i = 0, len = this.dropdownItems.length; i < len; i++) {
            optionElement = document.createElement('div');
            optionElement.setAttribute('data-value', this.dropdownItems[i].caption);
            optionElement.textContent = this.dropdownItems[i].caption;
            if (undefined !== this.dropdownItems[i].i18nKey) {
                optionElement.setAttribute('data-i18n-text', this.dropdownItems[i].i18nKey);
            }
            optionElement.setAttribute('data-id', this.dropdownItems[i].id);
            overlayElement.appendChild(optionElement);
        }
        var panelClickEventListener = function (e) {
            var clickedTargetElement = (e.srcElement || e.target);
            if (clickedTargetElement === overlayElement
                || $.contains(overlayElement, clickedTargetElement)
                || clickedTargetElement === _this.getRootNode()
                || clickedTargetElement.parentElement === _this.getRootNode()) {
                return;
            }
            _this.getRootNode().removeAttribute('data-is-opened');
            $(overlayElement).remove();
            panelClickEventListener = null;
        };
        var itemClickEventListener = function (e) {
            var clickedTargetElement = (e.srcElement || e.target);
            if (clickedTargetElement === _this.getRootNode()
                || clickedTargetElement.parentElement === _this.getRootNode()) {
                return;
            }
            if ($.contains(overlayElement, clickedTargetElement)) {
                if (null !== clickedTargetElement.dataset.id) {
                    _this.withSelectedItemId(clickedTargetElement.textContent);
                    _this.handleDropdownComponentElementChangeEvent(clickedTargetElement.textContent);
                    $(overlayElement).remove();
                }
            }
            itemClickEventListener = null;
        };
        document.body.addEventListener('mousedown', itemClickEventListener, true);
        document.body.addEventListener('mousedown', panelClickEventListener, true);
        this.textDropdownSpan.appendChild(overlayElement);
    };
    MenuPanelDropdownComponent.prototype.withEmptyStatePlaceholder = function (emptyStatePlaceholder) {
        if (emptyStatePlaceholder) {
            this.textDropdownSpan.textContent = emptyStatePlaceholder;
        }
        return this;
    };
    MenuPanelDropdownComponent.prototype.withBackendSetItems = function (items) {
        var _this = this;
        if (items.length !== 0) {
            items.forEach(function (item, index) {
                _this.dropdownItems.push({
                    id: index.toString(),
                    caption: item
                });
            });
        }
        return this;
    };
    MenuPanelDropdownComponent.prototype.handleDropdownComponentElementChangeEvent = function (selectedAlias) {
    };
    return MenuPanelDropdownComponent;
}(AbstractMenuPanelChild));
var MenuPanelButtonComponent = (function (_super) {
    __extends(MenuPanelButtonComponent, _super);
    function MenuPanelButtonComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-role', 'menu-panel-button');
        _this.buttonDOMNode = document.createElement('a');
        _this.buttonDOMNode.setAttribute('data-role', 'menu-panel-button');
        _this.buttonDOMNode.setAttribute('href', 'javascript:;');
        _this.getRootNode().addEventListener('click', function () {
            _this.trigger('click');
        });
        _this.getRootNode().appendChild(_this.buttonDOMNode);
        return _this;
    }
    MenuPanelButtonComponent.prototype.disableButton = function () {
        this.disableEvents();
        this.getRootNode().style.backgroundColor = 'rgba(236,236,236,0.5)';
        this.buttonDOMNode.style.color = 'rgba(76,76,76, 0.5)';
        this.bindTooltip();
    };
    MenuPanelButtonComponent.prototype.enableButton = function () {
        this.enableEvents();
        this.getRootNode().style.backgroundColor = null;
        this.buttonDOMNode.style.color = null;
        this.destroyTooltip();
    };
    MenuPanelButtonComponent.prototype.getButtonNode = function () {
        return this.buttonDOMNode;
    };
    MenuPanelButtonComponent.prototype.withLabel = function (labelText, i18nKey) {
        this.labelText = labelText;
        this.i18nLabelText = i18nKey;
        this.buttonDOMNode.textContent = this.labelText;
        this.buttonDOMNode.setAttribute('data-i18n-text', this.i18nLabelText);
        return this;
    };
    MenuPanelButtonComponent.prototype.withDisabledTooltip = function (labelText) {
        this.disabledTooltipText = labelText;
        return this;
    };
    MenuPanelButtonComponent.prototype.setOpened = function (openedState) {
        if (!this.panel) {
            return;
        }
        if (openedState) {
            this.getRootNode().setAttribute('data-opened', '');
        }
        else {
            this.getRootNode().removeAttribute('data-opened');
        }
        if (this.panel instanceof MenuPanelComponent || this.panel instanceof MenuPanelExtensionComponent) {
            this.panel.setOpened(openedState);
        }
        return this;
    };
    MenuPanelButtonComponent.prototype.withPanel = function (panel) {
        this.panel = panel;
        return this;
    };
    MenuPanelButtonComponent.prototype.bindTooltip = function () {
        if (!this.disabledTooltipText)
            return;
        this.tooltipInstance = new PopperTooltip(this.getRootNode(), {
            title: this.disabledTooltipText,
            placement: 'bottom',
            popperOptions: {
                positionFixed: true
            }
        });
    };
    MenuPanelButtonComponent.prototype.destroyTooltip = function () {
        if (this.tooltipInstance) {
            this.tooltipInstance.dispose();
        }
    };
    return MenuPanelButtonComponent;
}(AbstractMenuPanelChild));
var MenuPanelContainerComponent = (function (_super) {
    __extends(MenuPanelContainerComponent, _super);
    function MenuPanelContainerComponent() {
        var _this = _super.call(this) || this;
        _this.dependencies = {};
        _this.getRootNode().setAttribute('data-role', 'menu-panel-container');
        return _this;
    }
    MenuPanelContainerComponent.prototype.withDependency = function (propertyName, propertyValue) {
        this.dependencies[propertyName] = propertyValue;
        return this;
    };
    MenuPanelContainerComponent.prototype.getDependency = function (propertyName) {
        return undefined === this.dependencies[propertyName]
            ? null
            : this.dependencies[propertyName];
    };
    MenuPanelContainerComponent.prototype.setOpened = function (openedState) {
        return undefined;
    };
    MenuPanelContainerComponent.prototype.isOpened = function () {
        return undefined;
    };
    return MenuPanelContainerComponent;
}(AbstractMenuPanelChildThatSupportsChildren));
var MenuPanelOverlaySidebarComponent = (function (_super) {
    __extends(MenuPanelOverlaySidebarComponent, _super);
    function MenuPanelOverlaySidebarComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-is-overlay-panel', '1');
        return _this;
    }
    MenuPanelOverlaySidebarComponent.prototype.setOpened = function (openedState) {
        if (openedState && !this.getRootNode().parentNode) {
            document.body.appendChild(this.getRootNode());
        }
        return _super.prototype.setOpened.call(this, openedState);
    };
    return MenuPanelOverlaySidebarComponent;
}(MenuPanelComponent));
var EmbedHTMLOverlayComponent = (function (_super) {
    __extends(EmbedHTMLOverlayComponent, _super);
    function EmbedHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.domainAlias = window.location.host;
        _this.domainProtocolPrefix = '//';
        _this.useThirdPartyShortener = false;
        _this.isOnSalesforceCommunity = false;
        _this.isOnSalesforceCommunityLoaded = false;
        _this.showLearnMore = true;
        _this.dependencies = {};
        _this.model = {
            embedCode: '',
            embedTypeId: -1,
            embedOptions: {},
            showLearnMore: true,
            isOnSalesforceCommunity: false
        };
        return _this;
    }
    EmbedHTMLOverlayComponent.prototype.withPublishSettings = function (settings) {
        var domain = window.location.host;
        if (settings.publishSettings.domainAliasOn &&
            settings.publishSettings.domainAliasURL !== null &&
            settings.publishSettings.domainAliasURL !== '') {
            domain = settings.publishSettings.domainAliasURL;
        }
        if (settings.publishSettings.ssl) {
            this.domainProtocolPrefix = 'https://';
        }
        else {
            if (this.getPanelType() == EPublishEmbedType.LINK) {
                this.domainProtocolPrefix = 'http://';
            }
        }
        this.domainAlias = domain;
        if (!_.isNil(settings.showLearnMore) && typeof settings.showLearnMore === 'boolean') {
            this.showLearnMore = settings.showLearnMore;
        }
        return this;
    };
    EmbedHTMLOverlayComponent.prototype.withDependency = function (propertyName, propertyValue) {
        this.dependencies[propertyName] = propertyValue;
        return this;
    };
    EmbedHTMLOverlayComponent.prototype.updateEmbedCode = function () {
        this.getEncryptedEmbedCode();
    };
    EmbedHTMLOverlayComponent.prototype.includeHTMLOverlayComponentModuleFunctionality = function () {
        var _this = this;
        setTimeout(function () {
            var copyCodeButton = _this.getRootNode().querySelector('[data-role=copy-code-button]'), codeContainerTextarea = _this.getRootNode().querySelector('textarea[data-role=code-container]'), viewDemoButton = _this.getRootNode().querySelector('[data-role=view-demo-button]'), learnMoreLink = _this.getRootNode().querySelector('.publish-learn-more-link'), embedFormButton = _this.getRootNode().querySelector('[data-role=embed-form-button]'), installButton = _this.getRootNode().querySelector('[data-role=install-app-button]'), publishOnSalesforceCommunityToggle = _this.getRootNode().querySelector('#publishOnSalesforceCommunity');
            if (null !== embedFormButton) {
                embedFormButton.onclick = function () {
                    _this.trackPlatformMetric('publish_embed_btn_click');
                    if (undefined === _this.dependencies['formId']
                        || undefined === _this.dependencies['command']) {
                        return false;
                    }
                    _this.dependencies['command'].publishFormOnWeebly(_this.dependencies['formId'], _this.model.embedTypeId, _this.model.embedOptions);
                };
            }
            if (null !== copyCodeButton) {
                copyCodeButton.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackCopyTextEvent();
                };
            }
            if (null !== codeContainerTextarea) {
                codeContainerTextarea.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackInputClickEvent();
                };
            }
            if (null !== viewDemoButton) {
                viewDemoButton.onclick = function () {
                    _this.trackPlatformMetric('publish_example_click');
                };
            }
            if (null !== learnMoreLink) {
                learnMoreLink.onclick = function () {
                    _this.trackEvent('publish_learn_more_click');
                };
            }
            if (null !== installButton) {
                installButton.onclick = function () {
                    window.open('https://apps.facebook.com/contact-forms/', '_blank');
                    _this.trackEvent('publish_install_btn_facebook');
                };
            }
            if (publishOnSalesforceCommunityToggle !== null) {
                publishOnSalesforceCommunityToggle.onchange = function () {
                    publishOnSalesforceCommunityToggle.checked = _this.isOnSalesforceCommunity;
                    if (_this.isOnSalesforceCommunity) {
                        var i18n = _this.getParent().getDependency('i18n');
                        var modal = _this.getDependency('UI').createDialog(i18n.translateText('publishTabCommunity_confirmTitle'), [
                            {
                                type: EDialogButtonType.OK,
                                callback: function (buttonType, result) {
                                    _this.toggleSalesforceCommunityForm(publishOnSalesforceCommunityToggle);
                                    result.close();
                                }
                            },
                            {
                                type: EDialogButtonType.CANCEL,
                                callback: function (buttonType, result) {
                                    result.close();
                                }
                            }
                        ], {
                            'width': '500px'
                        });
                        modal.setHTML(i18n.translateText('publishTabCommunity_confirmText'));
                    }
                    else {
                        _this.toggleSalesforceCommunityForm(publishOnSalesforceCommunityToggle);
                    }
                };
            }
            _this.getEncryptedEmbedCode();
            _this.translateI18NElements();
        }, 10);
        this.model.showLearnMore = this.showLearnMore;
        return this.model;
    };
    EmbedHTMLOverlayComponent.prototype.copyEmbedCodeToClipboard = function () {
        var jq = this.getParent().getDependency('jq');
        var temporaryInput = jq("<input readonly='readonly'>"), codeContent = this.body.querySelector('[data-role=code-container]').textContent;
        jq('body').append(temporaryInput);
        temporaryInput.val(codeContent).select();
        document.execCommand('copy');
        temporaryInput.remove();
    };
    EmbedHTMLOverlayComponent.prototype.getEncryptedEmbedCode = function () {
        var embedCodeToEncrypt = this.model.embedCode;
        var jq = this.getParent().getDependency('jq');
        if (this instanceof (LinkToFormHTMLOverlayComponent || LightboxHTMLOverlayComponent)) {
            if (this.model) {
                embedCodeToEncrypt = this.model.embedCode;
            }
            else if (this.model) {
                embedCodeToEncrypt = this.model.embedCode;
            }
        }
        jq.post('modules/publish/ajax_get_encrypted_embed_code.php', {
            embedMarkup: btoa(embedCodeToEncrypt)
        }, function (response) {
            var viewDemoCodeHolder = document.getElementById('view_demo_code_holder');
            if (viewDemoCodeHolder !== null) {
                viewDemoCodeHolder.value = response;
            }
        });
    };
    EmbedHTMLOverlayComponent.prototype.trackCopyTextEvent = function () {
        var userFeatures = this.getParent().getDependency('userFeatures') || {};
        this.trackPlatformMetric('publish_copy_btn_click');
        if (!userFeatures.firstPublish) {
            userFeatures.firstPublish = true;
            FormUtils.getRootPanelComponent(this).trigger('user_feature_changed_boolean', 'firstPublish', userFeatures.firstPublish);
        }
        this.triggerFirstPublish();
    };
    EmbedHTMLOverlayComponent.prototype.trackInputClickEvent = function () {
        var userFeatures = this.getParent().getDependency('userFeatures') || {};
        this.trackPlatformMetric('publish_input_click');
        if (!userFeatures.firstPublish) {
            userFeatures.firstPublish = true;
            FormUtils.getRootPanelComponent(this).trigger('user_feature_changed_boolean', 'firstPublish', userFeatures.firstPublish);
        }
        this.triggerFirstPublish();
    };
    EmbedHTMLOverlayComponent.prototype.translateI18NElements = function () {
        var i18n = this.getParent().getDependency('i18n');
        i18n.translateDOMNode(this.getRootNode());
    };
    EmbedHTMLOverlayComponent.prototype.copyToClipboard = function (copyCodeButton, updateDelay) {
        var _this = this;
        this.copyEmbedCodeToClipboard();
        if (copyCodeButton !== null) {
            copyCodeButton.textContent = this.translateDefaultText('publish_copy_button_copied', 'Copied');
        }
        setTimeout(function () {
            if (copyCodeButton !== null) {
                copyCodeButton.textContent = _this.translateDefaultText('publish_overlay_btn_copy_code', 'Copy code');
            }
        }, updateDelay);
    };
    EmbedHTMLOverlayComponent.prototype.translateDefaultText = function (i18nString, defaultString) {
        var i18n = this.getParent().getDependency('i18n');
        if (i18n === null) {
            console.warn('Translation service not available for translating ' + i18nString + '. No dependency defined.');
            return defaultString;
        }
        if (i18nString && defaultString) {
            var result = i18n.translateText(i18nString);
            if (result == i18nString) {
                return defaultString;
            }
            return result;
        }
        return defaultString;
    };
    EmbedHTMLOverlayComponent.prototype.triggerFirstPublish = function () {
        var userFeatures = this.getParent().getDependency('userFeatures') || {};
        if (!userFeatures.firstPublish) {
            userFeatures.firstPublish = true;
            FormUtils.getRootPanelComponent(this).trigger('user_feature_changed_boolean', 'firstPublish', userFeatures.firstPublish);
        }
    };
    EmbedHTMLOverlayComponent.prototype.trackPlatformMetric = function (metric) {
        this.metricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        if (null !== this.metricsManager) {
            this.metricsManager.trackPlatformMetric(metric);
        }
    };
    EmbedHTMLOverlayComponent.prototype.getPanelType = function () {
        return null;
    };
    EmbedHTMLOverlayComponent.prototype.switchSalesforceCommunityToggle = function (enable) {
        var toggle = this.getRootNode().querySelector('#publishOnSalesforceCommunity');
        if (!toggle) {
            return;
        }
        var toggleLabel = toggle.parentElement;
        if (enable) {
            toggle.removeAttribute('disabled');
            toggleLabel.removeAttribute('title');
            toggleLabel.classList.remove('switch--loading');
        }
        else {
            toggle.setAttribute('disabled', 'true');
            toggleLabel.setAttribute('title', this.translateDefaultText('loading_pleaseWait', 'Loading, please wait...'));
            toggleLabel.classList.add('switch--loading');
        }
        toggle.checked = this.isOnSalesforceCommunity;
    };
    EmbedHTMLOverlayComponent.prototype.getIsOnSalesforceCommunity = function () {
        var _this = this;
        if (this.isOnSalesforceCommunityLoaded) {
            setTimeout(function () {
                _this.switchSalesforceCommunityToggle(true);
            });
            return;
        }
        var jq = this.getDependency('jq');
        var payload = {
            action: 'isFormPublishedInSalesforceCommunities',
            module: 'modules/publish/ajax_calls.php',
            parameters: JSON.stringify({
                'form_id': this.getDependency('formId'),
                'user_id': this.getDependency('userId')
            })
        };
        jq.ajax({
            url: '/ajax_call.php',
            method: 'POST',
            data: payload,
            dataType: 'json',
            success: function (response) {
                var isOnSalesforceCommunity = response.isOnSalesforceCommunity;
                _this.isOnSalesforceCommunity = isOnSalesforceCommunity || false;
                _this.isOnSalesforceCommunityLoaded = true;
                _this.switchSalesforceCommunityToggle(true);
            },
            error: function (response) {
                _this.isOnSalesforceCommunity = false;
                _this.isOnSalesforceCommunityLoaded = false;
                _this.switchSalesforceCommunityToggle(true);
                var status = response.status;
                switch (status) {
                    case 401:
                        throw new Error('You are not authorized to perform this action!');
                    case 500:
                        throw new Error('Looks like something went wrong at our end. Try again and if the issue persists, get in touch.');
                    default:
                        throw new Error('Oops! Something went wrong. Please try again and if the issue persists, get in touch.');
                }
            }
        });
    };
    EmbedHTMLOverlayComponent.prototype.toggleSalesforceCommunityForm = function (shareFormToggle) {
        var _this = this;
        this.switchSalesforceCommunityToggle(false);
        var shareForm = !shareFormToggle.checked;
        var jq = this.getDependency('jq');
        var payload = {
            action: 'salesforceCommunityPublishV2',
            publish: shareForm,
            module: 'modules/publish/ajax_calls.php',
            parameters: JSON.stringify({
                'form_id': this.getDependency('formId'),
                'user_id': this.getDependency('userId')
            })
        };
        jq.ajax({
            url: '/ajax_call.php',
            method: 'POST',
            data: payload,
            dataType: 'json',
            success: function (response) {
                var success = response.success;
                if (success) {
                    _this.isOnSalesforceCommunity = shareForm;
                    shareFormToggle.checked = shareForm;
                }
                _this.switchSalesforceCommunityToggle(true);
            },
            error: function (response) {
                _this.switchSalesforceCommunityToggle(true);
                var status = response.status;
                switch (status) {
                    case 401:
                        _this.getDependency('commandDispatcher').triggerPaywall(EUpgradeReason.SALESFORCE_COMMUNITY_SHARING_NOT_SUPPORTED_IN_CURRENT_USER_PLAN);
                        break;
                    case 500:
                        throw new Error('Looks like something went wrong at our end. Try again and if the issue persists, get in touch.');
                    default:
                        throw new Error('Oops! Something went wrong. Please try again and if the issue persists, get in touch.');
                }
            }
        });
    };
    EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY = 5000;
    return EmbedHTMLOverlayComponent;
}(MenuPanelExtensionComponent));
var JavaScriptHTMLOverlayComponent = (function (_super) {
    __extends(JavaScriptHTMLOverlayComponent, _super);
    function JavaScriptHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'javascript');
        _this.getRootNode().setAttribute('data-overlay-tab', 'embed-code');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'javascript');
        return _this;
    }
    JavaScriptHTMLOverlayComponent.prototype.getModel = function () {
        this.model.embedCode = "<!-- " + this.domainAlias + " script begins here -->\n" +
            "<script type=\"text/javascript\" defer src=\"" + this.domainProtocolPrefix + this.domainAlias + "/embed/" + this.getDependency("formId") + ".js\" data-role=\"form\" data-default-width=\"650px\"></script>\n" +
            "<!-- " + this.domainAlias + " script ends here -->";
        this.model.embedTypeId = EPublishEmbedType.JAVASCRIPT;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    JavaScriptHTMLOverlayComponent.prototype.onOverlayInitialized = function () {
        _super.prototype.onOverlayInitialized.call(this);
        this.trackPlatformMetric('page_view_publish_javascript');
    };
    return JavaScriptHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var IFrameHTMLOverlayComponent = (function (_super) {
    __extends(IFrameHTMLOverlayComponent, _super);
    function IFrameHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'iframe');
        _this.getRootNode().setAttribute('data-overlay-tab', 'embed-code');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'iframe');
        return _this;
    }
    IFrameHTMLOverlayComponent.prototype.getModel = function () {
        var iframeSource = this.domainProtocolPrefix + this.domainAlias + "/my-contact-form-" + this.getDependency("formId") + ".html", iframeStyle = 'min-height:300px; height:inherit; overflow:auto;';
        this.model.embedCode = "<!-- " + this.domainAlias + " script begins here -->\n" +
            "<iframe allowTransparency=\"true\" style=\"" + iframeStyle + "\" width=\"100%\" id=\"contactform123\" name=\"contactform123\" marginwidth=\"0\" marginheight=\"0\" frameborder=\"0\" src=\"" + iframeSource + "\">\n" +
            "<p>Your browser does not support iframes. The contact form cannot be displayed. Please use another contact method (phone, fax etc)</p>\n" +
            "</iframe>\n" +
            "<!-- " + this.domainAlias + " script ends here -->";
        this.model.embedTypeId = EPublishEmbedType.IFRAME;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    IFrameHTMLOverlayComponent.prototype.onOverlayInitialized = function () {
        _super.prototype.onOverlayInitialized.call(this);
        this.trackPlatformMetric('page_view_publish_iframe');
    };
    return IFrameHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var LinkToFormHTMLOverlayComponent = (function (_super) {
    __extends(LinkToFormHTMLOverlayComponent, _super);
    function LinkToFormHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'link');
        _this.getRootNode().setAttribute('data-overlay-tab', 'embed-code');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'embed-html-text');
        return _this;
    }
    LinkToFormHTMLOverlayComponent.prototype.getModel = function () {
        var _this = this;
        setTimeout(function () {
            _this.includeEventListeners();
            _this.determineAndUpdateModelStateAccordingToEmbedType();
        }, 100);
        this.model.embedCode = this.getEmbedCode(ELinkToFormOverlayLinkType.TEXT);
        this.model.embedTypeId = EPublishEmbedType.EMBED_HTML_TEXT;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    LinkToFormHTMLOverlayComponent.prototype.determineAndUpdateModelStateAccordingToEmbedType = function () {
        var embedTypeStoredInOverlayHelper = undefined !== LinkToFormHTMLOverlayComponent.htmlOverlayHelper["embed-type"]
            ? LinkToFormHTMLOverlayComponent.htmlOverlayHelper["embed-type"]
            : "", numericValueOfEmbedType = this.getHtmlOverlayHelperEmbedNumericAttribute(embedTypeStoredInOverlayHelper) || 0;
        document.querySelector('[data-role=link-to-form-option][data-link-to-form-type="' + numericValueOfEmbedType + '"]').setAttribute('data-is-selected', '1');
        this.updateModelAccordingToEmbedType(numericValueOfEmbedType);
    };
    LinkToFormHTMLOverlayComponent.prototype.includeEventListeners = function () {
        var _this = this;
        this.getRootNode().querySelector('[data-role=link-to-form-options-container]').onclick = function (e) {
            _this.updateModelContentAccordingToEmbedType(e);
            _this.checkStickyActionBar();
        };
        this.getRootNode().querySelector('[id=link-input-value]').onkeyup = function (e) {
            _this.updateHtmlOverlayHelper(e);
        };
    };
    LinkToFormHTMLOverlayComponent.prototype.updateModelAccordingToEmbedType = function (embedType) {
        document.getElementById('link-to-form-embed-content').textContent = this.getEmbedCode(embedType);
        this.model.embedCode = this.getEmbedCode(embedType);
        var currentEmbedTypeId = EPublishEmbedType.EMBED_HTML_TEXT;
        switch (embedType) {
            case ELinkToFormOverlayLinkType.IMAGE:
                currentEmbedTypeId = EPublishEmbedType.EMBED_HTML_IMAGE;
                break;
            case ELinkToFormOverlayLinkType.TEXT:
            default:
                currentEmbedTypeId = EPublishEmbedType.EMBED_HTML_TEXT;
        }
        this.model.embedTypeId = currentEmbedTypeId;
        document.getElementById('link-section-title').textContent = this.getInputDefaultTitle(embedType);
        document.getElementById('link-input-value').value = this.getInputContentValue(embedType);
        document.getElementById('link-input-value').setAttribute('data-embed-type', "" + embedType);
        this.updateEmbedCode();
    };
    LinkToFormHTMLOverlayComponent.prototype.updateModelContentAccordingToEmbedType = function (e) {
        var linkOptions = this.getRootNode().querySelectorAll('[data-role=link-to-form-option]'), clickedTargetElement = (e.srcElement || e.target);
        if (clickedTargetElement.hasAttribute('data-link-to-form-type')) {
            var embedType = +clickedTargetElement.getAttribute('data-link-to-form-type');
            clickedTargetElement.setAttribute('data-is-selected', '1');
            LinkToFormHTMLOverlayComponent.htmlOverlayHelper["embed-type"] = this.getHtmlOverlayHelperEmbedAttribute(+embedType);
            this.updateModelAccordingToEmbedType(embedType);
            this.getRootNode().setAttribute('data-selected-embed-type', '' + embedType);
            this.getRootNode().querySelector('input[name=publish_type]').setAttribute('value', this.getHtmlOverlayHelperEmbedAttribute(embedType));
            this.getRootNode().setAttribute('data-overlay-tab', clickedTargetElement.getAttribute('data-overlay-tab'));
            this.getRootNode().setAttribute('data-overlay-embed-type', clickedTargetElement.getAttribute('data-overlay-type'));
        }
        for (var i = 0, length_4 = linkOptions.length; i < length_4; i++) {
            if (null !== linkOptions[i]) {
                if (clickedTargetElement !== linkOptions[i]) {
                    linkOptions[i].removeAttribute('data-is-selected');
                }
            }
        }
    };
    LinkToFormHTMLOverlayComponent.prototype.getEmbedCode = function (dataLinkType) {
        var embedCode = "", embedType = this.getHtmlOverlayHelperEmbedAttribute(dataLinkType), changedContentValueForEmbed = LinkToFormHTMLOverlayComponent.htmlOverlayHelper[embedType], embedUrl = this.domainProtocolPrefix
            + this.domainAlias
            + '/form-'
            + this.getDependency("formId")
            + '/'
            + this.getCompactFormName(this.getDependency('formName'));
        switch (dataLinkType) {
            case ELinkToFormOverlayLinkType.TEXT:
                var text = (undefined !== changedContentValueForEmbed)
                    ? changedContentValueForEmbed
                    : this.translateDefaultText('publish_contact_us_link_label', 'Contact us');
                embedCode = '<a href="' + embedUrl + '" class="blueLink13">' + text + '</a>';
                this.model.embedOptions['embedUrl'] = embedUrl;
                this.model.embedOptions['embedLinkText'] = text;
                break;
            case ELinkToFormOverlayLinkType.IMAGE:
                var imageLink = undefined !== changedContentValueForEmbed
                    ? changedContentValueForEmbed
                    : "https://cdn-main.123contactform.com/images3/contactbutton2.png";
                embedCode = "<a href=\"" + embedUrl + '\">'
                    + "<img border=\"0\" src=" + imageLink + ">"
                    + "</a>";
                this.model.embedOptions['embedUrl'] = embedUrl;
                this.model.embedOptions['embedImageUrl'] = imageLink;
                break;
        }
        return embedCode;
    };
    LinkToFormHTMLOverlayComponent.prototype.getInputDefaultTitle = function (dataLinkType) {
        var inputDefaultTitle = "";
        switch (dataLinkType) {
            case ELinkToFormOverlayLinkType.TEXT:
                inputDefaultTitle = this.translateDefaultText('publish_link_to_form_link_text_label', 'The text you want to use for the link');
                break;
            case ELinkToFormOverlayLinkType.IMAGE:
                inputDefaultTitle = this.translateDefaultText('publish_link_to_form_customize_image_label', 'Customize image');
                break;
        }
        return inputDefaultTitle;
    };
    LinkToFormHTMLOverlayComponent.prototype.getInputContentValue = function (dataLinkType) {
        var inputDefaultContentValue = "", embedType = this.getHtmlOverlayHelperEmbedAttribute(dataLinkType), inputChangedValueForEmbed = LinkToFormHTMLOverlayComponent.htmlOverlayHelper[embedType];
        switch (dataLinkType) {
            case ELinkToFormOverlayLinkType.TEXT:
                inputDefaultContentValue = undefined !== inputChangedValueForEmbed
                    ? inputChangedValueForEmbed
                    : this.translateDefaultText('publish_contact_us_link_label', 'Contact us');
                break;
            case ELinkToFormOverlayLinkType.IMAGE:
                inputDefaultContentValue = undefined !== inputChangedValueForEmbed
                    ? inputChangedValueForEmbed
                    : "https://cdn-main.123contactform.com/images3/contactbutton2.png";
                break;
        }
        return inputDefaultContentValue;
    };
    LinkToFormHTMLOverlayComponent.prototype.updateHtmlOverlayHelper = function (e) {
        var inputTarget = (e.srcElement || e.target), embedTypeKey = inputTarget.dataset.embedType, embedType = "";
        if (null !== inputTarget.value && undefined !== embedTypeKey) {
            embedType = this.getHtmlOverlayHelperEmbedAttribute(+embedTypeKey);
            if (null !== embedType && "" !== embedType) {
                LinkToFormHTMLOverlayComponent.htmlOverlayHelper[embedType] = inputTarget.value;
                document.getElementById('link-to-form-embed-content').textContent = this.getEmbedCode(+embedTypeKey);
            }
        }
    };
    LinkToFormHTMLOverlayComponent.prototype.getHtmlOverlayHelperEmbedAttribute = function (embedTypeKey) {
        var embedType = "";
        switch (embedTypeKey) {
            case ELinkToFormOverlayLinkType.TEXT:
                embedType = "embed-html-text";
                break;
            case ELinkToFormOverlayLinkType.IMAGE:
                embedType = "embed-html-image";
                break;
        }
        return embedType;
    };
    LinkToFormHTMLOverlayComponent.prototype.getHtmlOverlayHelperEmbedNumericAttribute = function (embedType) {
        var embedTypeKey = 0;
        switch (embedType) {
            case "embed-html-text":
                embedTypeKey = ELinkToFormOverlayLinkType.TEXT;
                break;
            case "embed-html-image":
                embedTypeKey = ELinkToFormOverlayLinkType.IMAGE;
                break;
        }
        return embedTypeKey;
    };
    LinkToFormHTMLOverlayComponent.prototype.onOverlayInitialized = function () {
        _super.prototype.onOverlayInitialized.call(this);
        this.trackPlatformMetric('page_view_publish_link_to_form');
    };
    LinkToFormHTMLOverlayComponent.htmlOverlayHelper = {};
    return LinkToFormHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var LightboxHTMLOverlayComponent = (function (_super) {
    __extends(LightboxHTMLOverlayComponent, _super);
    function LightboxHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.fontValue = 'arialblk';
        _this.fontPlacement = '1';
        _this.getRootNode().setAttribute('data-overlay-type', 'lightbox');
        _this.getRootNode().setAttribute('data-overlay-tab', 'embed-code');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'lightbox-text-link');
        return _this;
    }
    LightboxHTMLOverlayComponent.prototype.withPublishSettings = function (settings) {
        _super.prototype.withPublishSettings.call(this, settings);
        return this;
    };
    LightboxHTMLOverlayComponent.prototype.getModel = function () {
        var _this = this;
        setTimeout(function () {
            _this.includeEventListeners();
            _this.appendUIColorPickerElement();
            _this.determineAndUpdateModelStateAccordingToEmbedType();
            _this.initUIDropDownElements();
            if (_this.getRootNode().hasAttribute('data-overlay-embed-type')
                && _this.getRootNode().getAttribute('data-overlay-embed-type').indexOf("lightbox") !== -1
                && !_this.getRootNode().hasAttribute('data-selected-embed-type')) {
                _this.getRootNode().setAttribute('data-selected-embed-type', '0');
                _this.updateModelAccordingToEmbedType(0);
            }
        }, 10);
        this.model.embedCode = this.getEmbedCode(ELightboxOverlayLinkType.TEXT);
        this.model.embedTypeId = EPublishEmbedType.LIGHTBOX_TEXT_LINK;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    LightboxHTMLOverlayComponent.prototype.determineAndUpdateModelStateAccordingToEmbedType = function () {
        var embedTypeStoredInOverlayHelper = undefined !== LightboxHTMLOverlayComponent.htmlOverlayHelper["embed-type"]
            ? LightboxHTMLOverlayComponent.htmlOverlayHelper["embed-type"]
            : "", numericValueOfEmbedType = this.getHtmlOverlayHelperEmbedNumericAttribute(embedTypeStoredInOverlayHelper) || 0;
        document.querySelector('[data-role=lightbox-option][data-lightbox-type="' + numericValueOfEmbedType + '"]').setAttribute('data-is-selected', '1');
        this.updateModelAccordingToEmbedType(numericValueOfEmbedType);
    };
    LightboxHTMLOverlayComponent.prototype.updateModelAccordingToEmbedType = function (embedType) {
        document.getElementById('lightbox-embed-content').textContent = this.getEmbedCode(embedType);
        this.model.embedCode = this.getEmbedCode(embedType);
        var currentEmbedTypeId = EPublishEmbedType.LIGHTBOX_TEXT_LINK;
        switch (embedType) {
            case ELightboxOverlayLinkType.AUTO_POPUP:
                currentEmbedTypeId = EPublishEmbedType.LIGHTBOX_AUTO_POPUP;
                break;
            case ELightboxOverlayLinkType.FLOATING_BUTTON:
                currentEmbedTypeId = EPublishEmbedType.LIGHTBOX_FLOATING_BUTTON;
                break;
            case ELightboxOverlayLinkType.IMAGE:
                currentEmbedTypeId = EPublishEmbedType.LIGHTBOX_IMAGE_LINK;
                break;
            case ELightboxOverlayLinkType.TEXT:
            default:
                currentEmbedTypeId = EPublishEmbedType.LIGHTBOX_TEXT_LINK;
        }
        this.model.embedTypeId = currentEmbedTypeId;
        document.getElementById('lightbox-section-title').textContent = this.getInputDefaultTitle(embedType);
        document.getElementById('lightbox-input-value').value = this.getInputContentValue(embedType);
        document.getElementById('lightbox-input-value').setAttribute('data-embed-type', "" + embedType);
        this.setFloatingButtonProperties();
        var embedButton = this.getRootNode().querySelector('[data-role=copy-code-button]');
        if (embedButton) {
            embedButton.textContent = 'Copy code';
        }
        this.updateEmbedCode();
    };
    LightboxHTMLOverlayComponent.prototype.setFloatingButtonProperties = function () {
        var _this = this;
        setTimeout(function () {
            document.querySelector('[data-button-property-type=background-color] [data-type=color] div')
                .style.backgroundColor = _this.getFlotingButtonPropertyValue("background-color");
            document.querySelector('[data-button-property-type=text-color] [data-type=color] div')
                .style.backgroundColor = _this.getFlotingButtonPropertyValue("text-color");
            document.querySelector('[data-button-property-type=font] [data-role=dropdown-value-label]')
                .textContent = _this.getFlotingButtonPropertyValue("font");
            document.querySelector('[data-button-property-type=placement] [data-role=dropdown-value-label]')
                .textContent = _this.getFlotingButtonPropertyValue("placement");
        }, 10);
    };
    LightboxHTMLOverlayComponent.prototype.includeEventListeners = function () {
        var _this = this;
        var options = (this.getRootNode().querySelectorAll('[data-role=lightbox-option]'));
        for (var i = 0, len = options.length; i < len; i++) {
            var element = options[i];
            element.onclick = function (e) {
                _this.setChosenLightboxEmbedType(e);
                _this.checkStickyActionBar();
            };
        }
        this.getRootNode().querySelector('[id=lightbox-input-value]').onkeyup = function (e) {
            _this.updateHtmlOverlayHelper(e);
        };
        setTimeout(function () {
            var uiElementsTypeColor = _this.getRootNode().querySelectorAll('[data-role=lightbox-properties-container] [data-ui-role=ui-element][data-type=color]');
            for (var i = 0, len = uiElementsTypeColor.length; i < len; i++) {
                uiElementsTypeColor[i].onchange = function (e) {
                    _this.updateHtmlOverlayHelper(e);
                };
            }
        }, 10);
    };
    LightboxHTMLOverlayComponent.prototype.updateHtmlOverlayHelper = function (e) {
        var inputTarget = (e.srcElement || e.target), embedTypeKey = +inputTarget.dataset.embedType || +this.getRootNode().dataset.selectedEmbedType, embedType = "";
        if (inputTarget.dataset.role === "dropdown-value-label"
            || inputTarget.parentElement.dataset.role === "text-dropdown-overlay") {
            this.updateHtmlOverlayHelperForDropdowns(e, embedTypeKey);
        }
        else if (inputTarget.dataset.type === "color") {
            this.updateHtmlOverlayHelperForColorPickers(inputTarget, embedTypeKey);
        }
        else if (null !== inputTarget.value && undefined !== embedTypeKey) {
            embedType = this.getHtmlOverlayHelperEmbedAttribute(+embedTypeKey);
            if (null !== embedType && "" !== embedType) {
                LightboxHTMLOverlayComponent.htmlOverlayHelper[embedType] = inputTarget.value;
                document.getElementById('lightbox-embed-content').textContent = this.getEmbedCode(+embedTypeKey);
            }
        }
    };
    LightboxHTMLOverlayComponent.prototype.updateHtmlOverlayHelperForColorPickers = function (inputTarget, embedTypeKey) {
        var backgroundColorOfColorPicker = inputTarget.firstChild.style.backgroundColor;
        if (backgroundColorOfColorPicker) {
            if (undefined !== embedTypeKey) {
                var embedType = this.getHtmlOverlayHelperEmbedAttribute(+embedTypeKey);
                if (null !== embedType && "" !== embedType) {
                    var lightboxFloatingButtonChangedPropertyType = inputTarget.closest('[data-role=lightbox-property]')
                        .dataset.buttonPropertyType;
                    LightboxHTMLOverlayComponent
                        .htmlOverlayHelper[embedType + "-" + lightboxFloatingButtonChangedPropertyType] = backgroundColorOfColorPicker;
                }
            }
        }
    };
    LightboxHTMLOverlayComponent.prototype.updateHtmlOverlayHelperForDropdowns = function (e, embedTypeKey) {
        var inputTarget = (e.srcElement || e.target), chosenValueOfOption = inputTarget.dataset.value;
        if (undefined !== chosenValueOfOption) {
            var embedType = this.getHtmlOverlayHelperEmbedAttribute(+embedTypeKey) || "", lightboxFloatingButtonChangedPropertyType = inputTarget.closest('[data-role=lightbox-property]')
                .dataset.buttonPropertyType;
            LightboxHTMLOverlayComponent
                .htmlOverlayHelper[embedType + "-" + lightboxFloatingButtonChangedPropertyType] = document.querySelector('[data-button-property-type=' + lightboxFloatingButtonChangedPropertyType + '] [data-role=dropdown-value-label]').textContent;
        }
    };
    LightboxHTMLOverlayComponent.prototype.setChosenLightboxEmbedType = function (e) {
        var lightboxOptions = this.getRootNode().querySelectorAll('[data-role=lightbox-option]'), clickedTargetElement = (e.srcElement || e.target);
        if (clickedTargetElement.hasAttribute('data-lightbox-type')) {
            var embedType = +clickedTargetElement.getAttribute('data-lightbox-type');
            clickedTargetElement.setAttribute('data-is-selected', '1');
            LightboxHTMLOverlayComponent.htmlOverlayHelper["embed-type"] = this.getHtmlOverlayHelperEmbedAttribute(+embedType);
            this.updateModelAccordingToEmbedType(embedType);
            this.getRootNode().setAttribute('data-selected-embed-type', '' + embedType);
            this.getRootNode().setAttribute('data-overlay-tab', clickedTargetElement.getAttribute('data-overlay-tab'));
            this.getRootNode().setAttribute('data-overlay-embed-type', clickedTargetElement.getAttribute('data-overlay-type'));
        }
        for (var i = 0, length_5 = lightboxOptions.length; i < length_5; i++) {
            if (null !== lightboxOptions[i]) {
                if (clickedTargetElement !== lightboxOptions[i]) {
                    lightboxOptions[i].removeAttribute('data-is-selected');
                }
            }
        }
    };
    LightboxHTMLOverlayComponent.prototype.getEmbedCode = function (dataLightboxType) {
        var embedCode = "<!-- " + this.domainAlias + " script begins here -->\n" +
            "<script type=\"text/javascript\" defer src=\"" + this.domainProtocolPrefix + this.domainAlias + "/embed/" + this.getDependency("formId") + ".js?type=lightbox\" " +
            "data-role=\"form\" data-default-width=\"650px\" ", embedType = this.getHtmlOverlayHelperEmbedAttribute(dataLightboxType), changedContentValueForEmbed = LightboxHTMLOverlayComponent.htmlOverlayHelper[embedType];
        switch (dataLightboxType) {
            case ELightboxOverlayLinkType.TEXT:
                var text = (undefined !== changedContentValueForEmbed
                    ? changedContentValueForEmbed
                    : 'Contact us');
                embedCode += 'data-embed-type="lightbox-text-link" data-embed-text-link="' + text + '"';
                this.model.embedOptions['data-embed-type'] = 'lightbox-text-link';
                this.model.embedOptions['data-embed-text-link'] = text;
                break;
            case ELightboxOverlayLinkType.IMAGE:
                var imageLink = undefined !== changedContentValueForEmbed
                    ? changedContentValueForEmbed
                    : "https://cdn-main.123contactform.com/images3/contactbutton2.png";
                embedCode += "data-embed-type=\"lightbox-image-link\" data-embed-image-link=" + imageLink;
                this.model.embedOptions['data-embed-type'] = 'lightbox-image-link';
                this.model.embedOptions['data-embed-image-link'] = imageLink;
                break;
            case ELightboxOverlayLinkType.AUTO_POPUP:
                var seconds = (undefined !== changedContentValueForEmbed
                    ? changedContentValueForEmbed
                    : "3");
                embedCode += "data-embed-type=\"lightbox-auto-popup\" data-embed-popup-seconds=\"" + seconds + "\"";
                this.model.embedOptions['data-embed-type'] = 'lightbox-auto-popup';
                this.model.embedOptions['data-embed-popup-seconds'] = seconds;
                break;
            case ELightboxOverlayLinkType.FLOATING_BUTTON:
                var buttonBackgroundColor = this.buttonBackgroundColorPicker.getValue().replace('#', ''), buttonTextColor = this.buttonTextColorPicker.getValue().replace('#', '');
                if (buttonBackgroundColor === 'black') {
                    var backgroundColorFromOverlayHelper = LightboxHTMLOverlayComponent.htmlOverlayHelper["embed-lightbox-floating-button-background-color"];
                    buttonBackgroundColor = undefined !== backgroundColorFromOverlayHelper
                        ? backgroundColorFromOverlayHelper
                        : '000000';
                }
                if (buttonTextColor === 'black') {
                    var textColorFromOverlayHelper = LightboxHTMLOverlayComponent.htmlOverlayHelper["embed-lightbox-floating-button-text-color"];
                    buttonTextColor = undefined !== textColorFromOverlayHelper
                        ? textColorFromOverlayHelper
                        : '000000';
                }
                var embedImageLink = '//' + this.domainAlias + '/verticalbutton2.php?&bg=' + buttonBackgroundColor + '&fnt=' + buttonTextColor + '&pos=' + this.fontPlacement + '&text=' +
                    (undefined !== changedContentValueForEmbed
                        ? changedContentValueForEmbed
                        : 'Contact us') + '&font=' + this.fontValue;
                embedCode += 'data-embed-type="lightbox-floating-button" ' +
                    'data-embed-image-link="' + embedImageLink + '" ' +
                    'data-embed-placement="' + this.fontPlacement + '"';
                this.model.embedOptions['data-embed-type'] = 'lightbox-floating-button';
                this.model.embedOptions['data-embed-image-link'] = embedImageLink;
                this.model.embedOptions['data-embed-placement'] = this.fontPlacement;
                break;
            default:
                embedCode += "EMBED CODE EXAMPLE lightbox test ";
                break;
        }
        embedCode += "></script>\n" +
            "<!-- " + this.domainAlias + " script ends here -->";
        return embedCode;
    };
    LightboxHTMLOverlayComponent.prototype.getInputDefaultTitle = function (dataLinkType) {
        var inputDefaultTitle = "";
        switch (dataLinkType) {
            case ELightboxOverlayLinkType.TEXT:
                inputDefaultTitle = this.translateDefaultText('publish_lightbox_link_enter_text', 'Enter the text you want to use for the link');
                break;
            case ELightboxOverlayLinkType.IMAGE:
                inputDefaultTitle = this.translateDefaultText('publish_lightbox_image_enter_text', 'Enter the URL of the image you want to use for the link');
                break;
            case ELightboxOverlayLinkType.FLOATING_BUTTON:
                inputDefaultTitle = this.translateDefaultText('publish_lightbox_floating_enter_text', 'Button text');
                break;
            case ELightboxOverlayLinkType.AUTO_POPUP:
                inputDefaultTitle = this.translateDefaultText('publish_lightbox_auto_enter_text', 'Number of seconds after which the lightbox should pop up');
                break;
        }
        return inputDefaultTitle;
    };
    LightboxHTMLOverlayComponent.prototype.getInputContentValue = function (dataLinkType) {
        var inputDefaultContentValue = "", embedType = this.getHtmlOverlayHelperEmbedAttribute(dataLinkType), inputChangedValueForEmbed = LightboxHTMLOverlayComponent.htmlOverlayHelper[embedType];
        switch (dataLinkType) {
            case ELightboxOverlayLinkType.TEXT:
            case ELightboxOverlayLinkType.FLOATING_BUTTON:
                inputDefaultContentValue = undefined !== inputChangedValueForEmbed
                    ? inputChangedValueForEmbed
                    : this.translateDefaultText('publish_lightbox_contact_us', 'Contact us');
                break;
            case ELightboxOverlayLinkType.IMAGE:
                inputDefaultContentValue = undefined !== inputChangedValueForEmbed
                    ? inputChangedValueForEmbed
                    : "https://cdn-main.123contactform.com/images3/contactbutton2.png";
                break;
            case ELightboxOverlayLinkType.AUTO_POPUP:
                inputDefaultContentValue = undefined !== inputChangedValueForEmbed
                    ? inputChangedValueForEmbed
                    : "3";
                break;
        }
        return inputDefaultContentValue;
    };
    LightboxHTMLOverlayComponent.prototype.getFlotingButtonPropertyValue = function (property) {
        var propertyDefaultContentValue = "", propertyChangedValueForEmbed = LightboxHTMLOverlayComponent.htmlOverlayHelper["embed-lightbox-floating-button-" + property];
        switch (property) {
            case "background-color":
                propertyDefaultContentValue = undefined !== propertyChangedValueForEmbed
                    ? propertyChangedValueForEmbed
                    : "#5d3d3d";
                break;
            case "text-color":
                propertyDefaultContentValue = undefined !== propertyChangedValueForEmbed
                    ? propertyChangedValueForEmbed
                    : "#ffffff";
                break;
            case "font":
                propertyDefaultContentValue = undefined !== propertyChangedValueForEmbed
                    ? propertyChangedValueForEmbed
                    : "Arial";
                break;
            case "placement":
                propertyDefaultContentValue = undefined !== propertyChangedValueForEmbed
                    ? propertyChangedValueForEmbed
                    : "Left";
                break;
        }
        return propertyDefaultContentValue;
    };
    LightboxHTMLOverlayComponent.prototype.getHtmlOverlayHelperEmbedAttribute = function (embedTypeKey) {
        var embedType = "";
        switch (embedTypeKey) {
            case ELightboxOverlayLinkType.TEXT:
                embedType = "embed-lightbox-text";
                break;
            case ELightboxOverlayLinkType.IMAGE:
                embedType = "embed-lightbox-image";
                break;
            case ELightboxOverlayLinkType.FLOATING_BUTTON:
                embedType = "embed-lightbox-floating-button";
                break;
            case ELightboxOverlayLinkType.AUTO_POPUP:
                embedType = "embed-lightbox-auto-popup";
                break;
        }
        return embedType;
    };
    LightboxHTMLOverlayComponent.prototype.getHtmlOverlayHelperEmbedNumericAttribute = function (embedType) {
        var embedTypeKey = 0;
        switch (embedType) {
            case "embed-lightbox-text":
                embedTypeKey = ELightboxOverlayLinkType.TEXT;
                break;
            case "embed-lightbox-image":
                embedTypeKey = ELightboxOverlayLinkType.IMAGE;
                break;
            case "embed-lightbox-floating-button":
                embedTypeKey = ELightboxOverlayLinkType.FLOATING_BUTTON;
                break;
            case "embed-lightbox-auto-popup":
                embedTypeKey = ELightboxOverlayLinkType.AUTO_POPUP;
                break;
        }
        return embedTypeKey;
    };
    LightboxHTMLOverlayComponent.prototype.appendUIColorPickerElement = function () {
        var _this = this;
        var pickerContainers = this.getRootNode().querySelectorAll('[data-role=lightbox-property] [data-role=color-picker-container]');
        if (pickerContainers.length > 0) {
            for (var i = 0, len = pickerContainers.length; i < len; i++) {
                var colorPicker = UI.createElement(UI.ELEMENT_TYPE_COLOR);
                pickerContainers[i].appendChild(colorPicker.getRootNode());
                if (i == 0) {
                    this.buttonBackgroundColorPicker = colorPicker;
                    this.buttonBackgroundColorPicker.setValue(this.getFlotingButtonPropertyValue('background-color'));
                }
                if (i == 1) {
                    this.buttonTextColorPicker = colorPicker;
                    this.buttonTextColorPicker.setValue(this.getFlotingButtonPropertyValue('text-color'));
                }
            }
        }
        var updatePickerStateAccordingToTouchEvent = function (e) {
            var touchedTargetElement = (e.srcElement || e.target), openOverlays = $('[data-role=color-overlay]'), jq = _this.getParent().getDependency('jq');
            if (openOverlays.length === 0) {
                return;
            }
            for (var i = 0, len = openOverlays.length; i < len; i++) {
                var element = openOverlays.get(i);
                if (element === touchedTargetElement
                    || jq.contains(element, touchedTargetElement)
                    || (touchedTargetElement.hasAttribute("data-type")
                        && touchedTargetElement.getAttribute("data-type") === "color")) {
                    element.style.display = "block";
                }
                else {
                    element.style.display = "none";
                }
            }
        };
        document.addEventListener('touchend', updatePickerStateAccordingToTouchEvent);
        this.buttonBackgroundColorPicker.setChangeCallback(function () {
            _this.determineAndUpdateModelStateAccordingToEmbedType();
        });
        this.buttonTextColorPicker.setChangeCallback(function () {
            _this.determineAndUpdateModelStateAccordingToEmbedType();
        });
    };
    LightboxHTMLOverlayComponent.prototype.initUIDropDownElements = function () {
        var _this = this;
        var buttonFontDropdown = this.getRootNode().querySelector('#button-font-dropdown'), buttonPlacementDropdown = this.getRootNode().querySelector('#button-placement-dropdown'), jq = this.getParent().getDependency('jq');
        buttonFontDropdown.onclick = function (e) {
            buttonPlacementDropdown.parentElement.removeAttribute('data-is-open');
            _this.toggleDropdown(buttonFontDropdown);
            _this.updateHtmlOverlayHelper(e);
        };
        buttonPlacementDropdown.onclick = function (e) {
            buttonFontDropdown.parentElement.removeAttribute('data-is-open');
            _this.toggleDropdown(buttonPlacementDropdown);
            _this.updateHtmlOverlayHelper(e);
        };
        this.initDropdown(buttonFontDropdown, function (font) {
            _this.fontValue = font;
            _this.determineAndUpdateModelStateAccordingToEmbedType();
        });
        this.initDropdown(buttonPlacementDropdown, function (placement) {
            _this.fontPlacement = placement;
            _this.determineAndUpdateModelStateAccordingToEmbedType();
        });
        var documentClickHandler = function (e) {
            var clickedTargetElement = (e.srcElement || e.target), openOverlays = jq('[data-role=menu-panel-dropdown][data-is-open] [data-role=text-dropdown-overlay]');
            if (openOverlays.length === 0) {
                return;
            }
            for (var i = 0, len = openOverlays.length; i < len; i++) {
                var element = openOverlays.get(i);
                if (element === clickedTargetElement ||
                    jq.contains(element, clickedTargetElement) ||
                    clickedTargetElement.parentElement === buttonFontDropdown ||
                    clickedTargetElement.parentElement === buttonPlacementDropdown) {
                    return;
                }
            }
            buttonPlacementDropdown.parentElement.removeAttribute('data-is-open');
            buttonFontDropdown.parentElement.removeAttribute('data-is-open');
        };
        document.body.addEventListener('mousedown', documentClickHandler, true);
    };
    LightboxHTMLOverlayComponent.prototype.initDropdown = function (element, callback) {
        var jq = this.getParent().getDependency('jq');
        jq(element).find('[data-value]').click(function (e) {
            var clickedTargetElement = (e.srcElement || e.target), value = clickedTargetElement.getAttribute('data-value'), label = clickedTargetElement.textContent;
            jq(element).find('[data-role=dropdown-value-label]').text(label);
            if (callback !== null) {
                callback(value);
            }
        });
    };
    LightboxHTMLOverlayComponent.prototype.toggleDropdown = function (element) {
        if (element.parentElement.hasAttribute('data-is-open')) {
            element.parentElement.removeAttribute('data-is-open');
        }
        else {
            element.parentElement.setAttribute('data-is-open', '1');
        }
    };
    LightboxHTMLOverlayComponent.prototype.onOverlayInitialized = function () {
        _super.prototype.onOverlayInitialized.call(this);
        this.trackPlatformMetric('page_view_publish_lightbox');
    };
    LightboxHTMLOverlayComponent.htmlOverlayHelper = {};
    return LightboxHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var BigCommerceHTMLOverlayComponent = (function (_super) {
    __extends(BigCommerceHTMLOverlayComponent, _super);
    function BigCommerceHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'big-commerce');
        _this.getRootNode().setAttribute('data-overlay-tab', 'bigcommerce');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'bigcommerce');
        return _this;
    }
    BigCommerceHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_bigcommerce');
        this.model.embedCode = "<!-- " + window.location.host + " script begins here -->\n" +
            "<script type=\"text/javascript\" defer src=\"" + this.domainProtocolPrefix + this.domainAlias + "/embed/" + this.getDependency("formId") + ".js\" data-role=\"form\" data-default-width=\"650px\"></script>\n" +
            "<!-- " + window.location.host + " script ends here -->";
        this.model.embedTypeId = EPublishEmbedType.APP_BIGCOMMERCE;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return BigCommerceHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var FacebookHTMLOverlayComponent = (function (_super) {
    __extends(FacebookHTMLOverlayComponent, _super);
    function FacebookHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'facebook');
        _this.getRootNode().setAttribute('data-overlay-tab', 'facebook');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'facebook');
        return _this;
    }
    FacebookHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_facebook');
        this.model.embedCode = "https://apps.facebook.com/contact-forms/";
        this.model.embedTypeId = EPublishEmbedType.APP_FACEBOOK;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    FacebookHTMLOverlayComponent.prototype.trackCopyTextEvent = function () {
        this.model.embedCode = "EMBED CODE EXAMPLE FACEBOOK";
        this.model.embedTypeId = EPublishEmbedType.APP_FACEBOOK;
        this.trackEvent('publish_copy_btn_facebook');
        _super.prototype.trackCopyTextEvent.call(this);
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    FacebookHTMLOverlayComponent.prototype.trackInputClickEvent = function () {
        _super.prototype.trackInputClickEvent.call(this);
        this.trackEvent('publish_copy_btn_facebook');
    };
    return FacebookHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var BloggerHTMLOverlayComponent = (function (_super) {
    __extends(BloggerHTMLOverlayComponent, _super);
    function BloggerHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'blogger');
        _this.getRootNode().setAttribute('data-overlay-tab', 'blogger');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'blogger');
        return _this;
    }
    BloggerHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_blogger');
        this.model.embedCode = "<!-- " + this.domainProtocolPrefix + this.domainAlias + " script begins here -->\n" +
            "<script type=\"text/javascript\" defer src=\"" + this.domainProtocolPrefix + this.domainAlias + "/embed/" + this.getDependency("formId") + ".js\" data-role=\"form\"></script>\n" +
            "<!-- " + this.domainProtocolPrefix + this.domainAlias + " script ends here -->";
        this.model.embedTypeId = EPublishEmbedType.APP_BLOGGER;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return BloggerHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var WordpressHTMLOverlayComponent = (function (_super) {
    __extends(WordpressHTMLOverlayComponent, _super);
    function WordpressHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'wordpress');
        _this.getRootNode().setAttribute('data-overlay-tab', 'wordpress');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'wordpress');
        return _this;
    }
    WordpressHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_wordpress');
        this.model.embedCode = '[123-form-builder i' + this.getDependency("formId") + ']';
        this.model.embedTypeId = EPublishEmbedType.APP_WORDPRESS;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return WordpressHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var JoomlaHTMLOverlayComponent = (function (_super) {
    __extends(JoomlaHTMLOverlayComponent, _super);
    function JoomlaHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'joomla');
        _this.getRootNode().setAttribute('data-overlay-tab', 'joomla');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'joomla');
        return _this;
    }
    JoomlaHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_joomla');
        this.model.embedCode = "[123-form-builder i" + this.getDependency("formId") + "]";
        this.model.embedTypeId = EPublishEmbedType.APP_JOOMLA;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return JoomlaHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var SalesforceHTMLOverlayComponent = (function (_super) {
    __extends(SalesforceHTMLOverlayComponent, _super);
    function SalesforceHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'salesforce');
        _this.getRootNode().setAttribute('data-overlay-tab', 'exacttarget');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'exacttarget');
        return _this;
    }
    SalesforceHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_salesforce');
        var contactUsLabel = this.translateDefaultText('publish_contact_us_link_label', 'Contact us');
        this.model.embedCode = "<span style='border:1px solid #ccc; padding:5px; margin:3px; display:block; font-size:14px; text-align:center; font-weight:bold; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px;'>"
            + "<a href='" + this.domainProtocolPrefix + this.domainAlias + "/form-" + this.getDependency("formId") + "/" + this.getCompactFormName(this.getDependency('formName')) + "' class='blueLink13'>"
            + contactUsLabel
            + "</a>"
            + "</span>";
        this.model.embedTypeId = EPublishEmbedType.APP_SALESFORCE;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return SalesforceHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var SalesforceCommunityHTMLOverlayComponent = (function (_super) {
    __extends(SalesforceCommunityHTMLOverlayComponent, _super);
    function SalesforceCommunityHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'salesforce-community');
        _this.getRootNode().setAttribute('data-overlay-tab', 'salesforce-community');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'salesforce-community');
        return _this;
    }
    SalesforceCommunityHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_salesforce_community');
        this.model.isOnSalesforceCommunity = this.isOnSalesforceCommunity;
        this.getIsOnSalesforceCommunity();
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return SalesforceCommunityHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var UnbounceHTMLOverlayComponent = (function (_super) {
    __extends(UnbounceHTMLOverlayComponent, _super);
    function UnbounceHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'unbounce');
        _this.getRootNode().setAttribute('data-overlay-tab', 'unbounce');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'unbounce');
        return _this;
    }
    UnbounceHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_unbounce');
        this.model.embedCode = "<!-- " + this.domainAlias + " script begins here -->\n" +
            "<script type=\"text/javascript\" defer src=\"" + this.domainProtocolPrefix + this.domainAlias + "/embed/" + this.getDependency("formId") + ".js\" data-role=\"form\"></script>\n" +
            "<!-- " + this.domainAlias + " script ends here -->" +
            "<script type=\"text/javascript\">" +
            "var ubx=window.ub.page;" +
            "var oImg=document.createElement('img');" +
            "oImg.setAttribute('src', '//www.123formbuilder.com/ub_setvars.php?ub_variant_id='+ubx.variantId+'&ub_visitor_id='+ubx.visitorId+'&ub_page_id='+ubx.id+'&ub_page_name='+ubx.name);" +
            "oImg.style.display='none';" +
            "document.body.appendChild(oImg);" +
            "</script>";
        this.model.embedTypeId = EPublishEmbedType.APP_UNBOUNCE;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return UnbounceHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var GoogleSitesHTMLOverlayComponent = (function (_super) {
    __extends(GoogleSitesHTMLOverlayComponent, _super);
    function GoogleSitesHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'google-sites');
        _this.getRootNode().setAttribute('data-overlay-tab', 'google-sites');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'google-sites');
        return _this;
    }
    GoogleSitesHTMLOverlayComponent.prototype.getModel = function () {
        this.trackEvent('page_view_publish_google');
        this.model.embedCode = this.domainProtocolPrefix + this.domainAlias + "/google-sites-gadget-form-" + this.getDependency("formId") + ".xml";
        this.model.embedTypeId = EPublishEmbedType.APP_GOOGLE;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    return GoogleSitesHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var TwitterHTMLOverlayComponent = (function (_super) {
    __extends(TwitterHTMLOverlayComponent, _super);
    function TwitterHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'twitter');
        _this.getRootNode().setAttribute('data-overlay-tab', 'twitter');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'twitter');
        return _this;
    }
    TwitterHTMLOverlayComponent.prototype.getModel = function () {
        var _this = this;
        this.trackEvent('page_view_publish_twitter');
        this.model.embedCode = "Loading ...";
        this.model.embedTypeId = EPublishEmbedType.APP_TWITTER;
        if (this.useThirdPartyShortener) {
            this.getShortUrl().then(function (url) {
                _this.model.embedCode = url;
                _this.loadOverlayComponentUI(_this.includeHTMLOverlayComponentModuleFunctionality());
            });
        }
        else {
            this.model.embedCode = this.getFullUrl();
            this.loadOverlayComponentUI(this.includeHTMLOverlayComponentModuleFunctionality());
        }
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    TwitterHTMLOverlayComponent.prototype.getShortUrl = function () {
        var formUrl = this.domainProtocolPrefix
            + this.domainAlias
            + "/form-"
            + this.getDependency("formId")
            + "/"
            + this.getCompactFormName(this.getDependency('formName')), $ = this.getDependency("jq");
        return $.Deferred(function (defer) {
            $.ajax({
                type: "POST",
                url: "https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyAHouy3P-7v738jDVmOQ9KwiCm9otY-9Go",
                data: JSON.stringify({
                    longUrl: 'https:' + formUrl
                }),
                contentType: "application/json",
                success: function (data) {
                    if (data && data.id) {
                        defer.resolve(data.id);
                    }
                },
                error: function () {
                    defer.reject();
                }
            });
        });
    };
    TwitterHTMLOverlayComponent.prototype.getFullUrl = function () {
        var domainProtocol = this.domainProtocolPrefix === '//' ? 'http://' : this.domainProtocolPrefix;
        var formUrl = "" + domainProtocol + this.domainAlias + "/form-" + this.getDependency("formId");
        return formUrl;
    };
    return TwitterHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var LinkHTMLOverlayComponent = (function (_super) {
    __extends(LinkHTMLOverlayComponent, _super);
    function LinkHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'link');
        _this.getRootNode().setAttribute('data-overlay-tab', 'form-link');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'form-link');
        return _this;
    }
    LinkHTMLOverlayComponent.prototype.getModel = function () {
        var _this = this;
        setTimeout(function () {
            _this.initializeButtons();
            _this.setButtonListeners();
        }, 100);
        this.model.embedCode = this.domainProtocolPrefix + this.domainAlias + "/form-" + this.getDependency("formId") + "/" + this.getCompactFormName(this.getDependency('formName'));
        this.model.embedTypeId = EPublishEmbedType.LINK;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    LinkHTMLOverlayComponent.prototype.popitup = function (type, url, title, popupWidth, popupHeight) {
        var dualScreenLeft = (window.screenLeft) ? window.screenLeft : screen['left'];
        var dualScreenTop = (window.screenTop) ? window.screenTop : screen['top'];
        var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
        var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;
        var left = ((width / 2) - (popupWidth / 2)) + dualScreenLeft;
        var top = ((height / 2) - (popupHeight / 2)) + dualScreenTop;
        var newWindow = window.open(url, title, 'scrollbars=yes, width=' + popupWidth + ', height=' + popupHeight + ', top=' + top + ', left=' + left);
        if (window.focus) {
            newWindow.focus();
        }
        return false;
    };
    LinkHTMLOverlayComponent.prototype.setButtonListeners = function () {
        var _this = this;
        if (!this.facebookBtn ||
            !this.twitterBtn ||
            !this.googleplusBtn ||
            !this.linkedinBtn ||
            !this.emailBtn) {
            return this;
        }
        this.facebookBtn.addEventListener("click", function () {
            _this.popitup('Facebook', 'https://www.facebook.com/sharer/sharer.php?u=' + _this.getFormLink(), 'xtf', 500, 250);
            _this.metricsManager.trackPlatformMetric('publish_social_share_click');
        });
        this.twitterBtn.addEventListener("click", function () {
            _this.popitup('Twitter', 'https://twitter.com/share?text=' + _this.getFormLink() + '&url=false', 'xtf', 500, 250);
            _this.metricsManager.trackPlatformMetric('publish_social_share_click');
        });
        this.googleplusBtn.addEventListener("click", function () {
            _this.popitup('Google Plus', 'https://plus.google.com/share?url=' + _this.getFormLink(), 'xtf', 500, 250);
            _this.metricsManager.trackPlatformMetric('publish_social_share_click');
        });
        this.linkedinBtn.addEventListener("click", function () {
            _this.popitup('Linkedin', 'https://www.linkedin.com/cws/share?url=' + _this.getFormLink(), 'xtf', 500, 250);
            _this.metricsManager.trackPlatformMetric('publish_social_share_click');
        });
        this.emailBtn.addEventListener("click", function () {
            _this.metricsManager.trackPlatformMetric('publish_social_share_click');
            window.location.href = "mailto:?subject=Check out this form&body=" + _this.getFormLink();
        });
        this.getParent().getParent().on('ssl-changed', function (isSSLChecked) {
            _this.domainProtocolPrefix = isSSLChecked ? 'https://' : 'http://';
        });
        return this;
    };
    LinkHTMLOverlayComponent.prototype.getFormLink = function () {
        return (this.domainProtocolPrefix === '//' ? 'http://' : this.domainProtocolPrefix) +
            window.location.host +
            "/form-" +
            this.getDependency("formId") + "/" +
            this.getCompactFormName(this.getDependency('formName'));
    };
    LinkHTMLOverlayComponent.prototype.initializeButtons = function () {
        this.facebookBtn = document.querySelector('[data-role=social-media-container] [data-role=social-media-element][data-social-media-type=facebook-share]');
        this.twitterBtn = document.querySelector('[data-role=social-media-container] [data-role=social-media-element][data-social-media-type=twitter-share]');
        this.googleplusBtn = document.querySelector('[data-role=social-media-container] [data-role=social-media-element][data-social-media-type=google-plus-share]');
        this.linkedinBtn = document.querySelector('[data-role=social-media-container] [data-role=social-media-element][data-social-media-type=linkedin-share]');
        this.emailBtn = document.querySelector('[data-role=social-media-container] [data-role=social-media-element][data-social-media-type=mail-share]');
    };
    LinkHTMLOverlayComponent.prototype.onOverlayInitialized = function () {
        this.metricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        if (this.metricsManager !== null) {
            this.metricsManager.trackPlatformMetric('page_view_publish_formlink');
        }
    };
    LinkHTMLOverlayComponent.prototype.getPanelType = function () {
        return EPublishEmbedType.LINK;
    };
    return LinkHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var ShopifyHTMLOverlayComponent = (function (_super) {
    __extends(ShopifyHTMLOverlayComponent, _super);
    function ShopifyHTMLOverlayComponent() {
        var _this = _super.call(this) || this;
        _this.getRootNode().setAttribute('data-overlay-type', 'shopify');
        _this.getRootNode().setAttribute('data-overlay-tab', 'shopify');
        _this.getRootNode().setAttribute('data-overlay-embed-type', 'shopify');
        return _this;
    }
    ShopifyHTMLOverlayComponent.prototype.getModel = function () {
        this.model.embedCode = '<div class="123formbuilder" fid="' + this.getDependency("formId") + '"></div>';
        this.model.embedTypeId = EPublishEmbedType.APP_SHOPIFY;
        return this.includeHTMLOverlayComponentModuleFunctionality();
    };
    ShopifyHTMLOverlayComponent.prototype.onOverlayInitialized = function () {
        this.trackEvent('page_view_publish_shopify');
    };
    return ShopifyHTMLOverlayComponent;
}(EmbedHTMLOverlayComponent));
var PlatformSpecificJavaScriptOverlayComponent = (function (_super) {
    __extends(PlatformSpecificJavaScriptOverlayComponent, _super);
    function PlatformSpecificJavaScriptOverlayComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PlatformSpecificJavaScriptOverlayComponent.prototype.includeHTMLOverlayComponentModuleFunctionality = function () {
        var _this = this;
        setTimeout(function () {
            var copyCodeButton = _this.getRootNode().querySelector('[data-role=copy-code-button]'), codeContainerTextarea = _this.getRootNode().querySelector('textarea[data-role=code-container]'), viewDemoButton = _this.getRootNode().querySelector('[data-role=view-demo-button]'), learnMoreLink = _this.getRootNode().querySelector('.publish-learn-more-link'), installButton = _this.getRootNode().querySelector('[data-role=install-app-button]'), embedFormButton = _this.getRootNode().querySelector('[data-role=embed-form-button]');
            if (null !== embedFormButton) {
                embedFormButton.onclick = function () {
                    _this.trackPlatformMetric('specific_publish_embed_btn_click');
                    if (undefined === _this.dependencies['formId']
                        || undefined === _this.dependencies['command']) {
                        return false;
                    }
                    _this.dependencies['command'].publishFormOnWeebly(_this.dependencies['formId'], _this.model.embedTypeId, _this.model.embedOptions);
                };
            }
            if (null !== copyCodeButton) {
                copyCodeButton.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackPlatformMetric('specific_publish_copy_btn_click');
                };
            }
            if (null !== codeContainerTextarea) {
                codeContainerTextarea.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackPlatformMetric('publish_input_click');
                };
            }
            if (null !== viewDemoButton) {
                viewDemoButton.onclick = function () {
                    _this.trackPlatformMetric('specific_publish_example_click');
                };
            }
            if (null !== learnMoreLink) {
                learnMoreLink.onclick = function () {
                    _this.trackEvent('publish_learn_more_click');
                };
            }
            if (null !== installButton) {
                installButton.onclick = function () {
                    window.open('https://apps.facebook.com/contact-forms/', '_blank');
                    _this.trackEvent('publish_install_btn_facebook');
                };
            }
            _this.getEncryptedEmbedCode();
            _this.translateI18NElements();
        }, 10);
        return this.model;
    };
    PlatformSpecificJavaScriptOverlayComponent.prototype.onOverlayInitialized = function () {
        if (this.metricsManager == null) {
            this.metricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        }
        this.metricsManager.trackPlatformMetric('specific_publish_embed');
    };
    return PlatformSpecificJavaScriptOverlayComponent;
}(JavaScriptHTMLOverlayComponent));
var PlatformSpecificLinkToFormOverlayComponent = (function (_super) {
    __extends(PlatformSpecificLinkToFormOverlayComponent, _super);
    function PlatformSpecificLinkToFormOverlayComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PlatformSpecificLinkToFormOverlayComponent.prototype.includeHTMLOverlayComponentModuleFunctionality = function () {
        var _this = this;
        setTimeout(function () {
            var copyCodeButton = _this.getRootNode().querySelector('[data-role=copy-code-button]'), codeContainerTextarea = _this.getRootNode().querySelector('textarea[data-role=code-container]'), viewDemoButton = _this.getRootNode().querySelector('[data-role=view-demo-button]'), learnMoreLink = _this.getRootNode().querySelector('.publish-learn-more-link'), installButton = _this.getRootNode().querySelector('[data-role=install-app-button]'), embedFormButton = _this.getRootNode().querySelector('[data-role=embed-form-button]');
            if (null !== embedFormButton) {
                embedFormButton.onclick = function () {
                    _this.trackPlatformMetric('specific_publish_embed_btn_click');
                    if (undefined === _this.dependencies['formId']
                        || undefined === _this.dependencies['command']) {
                        return false;
                    }
                    _this.dependencies['command'].publishFormOnWeebly(_this.dependencies['formId'], _this.model.embedTypeId, _this.model.embedOptions);
                };
            }
            if (null !== copyCodeButton) {
                copyCodeButton.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackPlatformMetric('specific_publish_copy_btn_click');
                };
            }
            if (null !== codeContainerTextarea) {
                codeContainerTextarea.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackPlatformMetric('publish_input_click');
                };
            }
            if (null !== viewDemoButton) {
                viewDemoButton.onclick = function () {
                    _this.trackPlatformMetric('specific_publish_example_click');
                };
            }
            if (null !== learnMoreLink) {
                learnMoreLink.onclick = function () {
                    _this.trackEvent('publish_learn_more_click');
                };
            }
            if (null !== installButton) {
                installButton.onclick = function () {
                    window.open('https://apps.facebook.com/contact-forms/', '_blank');
                    _this.trackEvent('publish_install_btn_facebook');
                };
            }
            _this.getEncryptedEmbedCode();
            _this.translateI18NElements();
        }, 10);
        return this.model;
    };
    PlatformSpecificLinkToFormOverlayComponent.prototype.onOverlayInitialized = function () {
        if (this.metricsManager == null) {
            this.metricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        }
        this.metricsManager.trackPlatformMetric('specific_publish_link');
    };
    return PlatformSpecificLinkToFormOverlayComponent;
}(LinkToFormHTMLOverlayComponent));
var PlatformSpecificLightboxOverlayComponent = (function (_super) {
    __extends(PlatformSpecificLightboxOverlayComponent, _super);
    function PlatformSpecificLightboxOverlayComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PlatformSpecificLightboxOverlayComponent.prototype.includeHTMLOverlayComponentModuleFunctionality = function () {
        var _this = this;
        setTimeout(function () {
            var copyCodeButton = _this.getRootNode().querySelector('[data-role=copy-code-button]'), codeContainerTextarea = _this.getRootNode().querySelector('textarea[data-role=code-container]'), viewDemoButton = _this.getRootNode().querySelector('[data-role=view-demo-button]'), learnMoreLink = _this.getRootNode().querySelector('.publish-learn-more-link'), installButton = _this.getRootNode().querySelector('[data-role=install-app-button]'), embedFormButton = _this.getRootNode().querySelector('[data-role=embed-form-button]');
            if (null !== embedFormButton) {
                embedFormButton.onclick = function () {
                    _this.trackPlatformMetric('specific_publish_embed_btn_click');
                    if (undefined === _this.dependencies['formId']
                        || undefined === _this.dependencies['command']) {
                        return false;
                    }
                    _this.dependencies['command'].publishFormOnWeebly(_this.dependencies['formId'], _this.model.embedTypeId, _this.model.embedOptions);
                };
            }
            if (null !== copyCodeButton) {
                copyCodeButton.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackPlatformMetric('specific_publish_copy_btn_click');
                };
            }
            if (null !== codeContainerTextarea) {
                codeContainerTextarea.onclick = function () {
                    _this.copyToClipboard(copyCodeButton, EmbedHTMLOverlayComponent.COPIED_STATE_UPDATE_DELAY);
                    _this.trackPlatformMetric('publish_input_click');
                };
            }
            if (null !== viewDemoButton) {
                viewDemoButton.onclick = function () {
                    _this.trackPlatformMetric('specific_publish_example_click');
                };
            }
            if (null !== learnMoreLink) {
                learnMoreLink.onclick = function () {
                    _this.trackEvent('publish_learn_more_click');
                };
            }
            if (null !== installButton) {
                installButton.onclick = function () {
                    window.open('https://apps.facebook.com/contact-forms/', '_blank');
                    _this.trackEvent('publish_install_btn_facebook');
                };
            }
            _this.getEncryptedEmbedCode();
            _this.translateI18NElements();
        }, 10);
        return this.model;
    };
    PlatformSpecificLightboxOverlayComponent.prototype.onOverlayInitialized = function () {
        if (this.metricsManager == null) {
            this.metricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        }
        this.metricsManager.trackPlatformMetric('specific_publish_lightbox');
    };
    return PlatformSpecificLightboxOverlayComponent;
}(LightboxHTMLOverlayComponent));
var PlatformMetricPrefixes;
(function (PlatformMetricPrefixes) {
    PlatformMetricPrefixes["NO_PLATFORM"] = "";
    PlatformMetricPrefixes["WEEBLY"] = "weebly_";
    PlatformMetricPrefixes["WIX"] = "wix_";
    PlatformMetricPrefixes["SHOPIFY"] = "shopify_";
    PlatformMetricPrefixes["BIG_COMMERCE"] = "bigcommerce_";
})(PlatformMetricPrefixes || (PlatformMetricPrefixes = {}));
var PlatformMetricsManager = (function () {
    function PlatformMetricsManager(platformDetails) {
        this.platformDetails = platformDetails;
    }
    PlatformMetricsManager.prototype.trackPlatformMetric = function (metric) {
        var platformPrefix = this.getCurrentPlatformSuffix(), resultMetric = platformPrefix + metric;
        CFTracker && CFTracker.event(resultMetric);
        console.log('tracker :: ' + resultMetric);
    };
    PlatformMetricsManager.prototype.getCurrentPlatformSuffix = function () {
        if (this.platformDetails.isWeebly)
            return PlatformMetricPrefixes.WEEBLY;
        if (this.platformDetails.isWixInternal)
            return PlatformMetricPrefixes.WIX;
        if (this.platformDetails.isShopify)
            return PlatformMetricPrefixes.SHOPIFY;
        if (this.platformDetails.isBigCommerce)
            return PlatformMetricPrefixes.BIG_COMMERCE;
        return PlatformMetricPrefixes.NO_PLATFORM;
    };
    PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY = 'platformMetricsManager';
    return PlatformMetricsManager;
}());
var DomainAliasDialog = (function () {
    function DomainAliasDialog(domainsDropdown) {
        this.domainsDropdown = domainsDropdown || (new MenuPanelDropdownComponent());
    }
    DomainAliasDialog.prototype.displayDomainAliasAddDialog = function (loader, checkboxStateToUpdate) {
        var _this = this;
        var dialog = loader.getUI().createDialog('Add domain alias', [
            {
                type: EDialogButtonType.ADD_DOMAIN,
                callback: function () {
                    _this.addDomainAliasToDropdown(loader, dialog);
                }
            },
            {
                type: EDialogButtonType.CANCEL,
                callback: function () {
                    dialog.close();
                    if (null !== checkboxStateToUpdate && undefined !== checkboxStateToUpdate) {
                        checkboxStateToUpdate.checked = false;
                    }
                }
            }
        ], {
            width: '575px',
            onCloseButtonClick: function () {
                if (null !== checkboxStateToUpdate && undefined !== checkboxStateToUpdate) {
                    checkboxStateToUpdate.checked = false;
                }
            }
        });
        dialog.body.setAttribute('data-role', 'domain-aliasing-content');
        dialog.body.innerHTML = '<div data-role="add-domain-alias-title" data-i18n-text="publish_da_enter_domain">' +
            'Enter the domain you want to use for domain aliasing' +
            '</div>' +
            '<input data-role="domain-value" type="text" placeholder="forms.yourdomain.com">' +
            '<div data-role="domain-alias-error" data-i18n-text="publish_da_domain_error">CNAME record was not found. Please set it up following the instructions below. If you need assistance, please <a href="/contactus.html" target="_blank"> contact us</a>. </div>' +
            '<div data-role="add-domain-aliasing-learn-more" >' +
            '<span data-i18n-text="publish_da_learn_more_text">Set up your CNAME record in order to use domain aliasing.</span>' +
            '<a href="//www.123formbuilder.com/docs/domain-aliasing/" target="_blank" data-i18n-text="publish_overlay_learn_more">Learn more</a>' +
            '</div>';
        loader.getI18n().translateDOMNode(dialog.body);
        return dialog;
    };
    DomainAliasDialog.prototype.addDomainAliasToDropdown = function (loader, dialog) {
        var _this = this;
        var jq = loader.getJQuery();
        var tabAndTypeElement = jq('[data-overlay-tab][data-overlay-embed-type]'), tab = 'form-link', embedType = 'form-link';
        if (tabAndTypeElement !== null) {
            tab = tabAndTypeElement.attr('data-overlay-tab');
            embedType = tabAndTypeElement.attr('data-overlay-embed-type');
        }
        var ajaxParameters = JSON.stringify({
            "form_id": loader.getFormId(),
            "user_id": loader.getUserId(),
            "PHPSESSID": loader.getSessionId(),
            "needs_upgrade": false,
            "needs_alias_upgrade": 0,
            "tab": tab,
            "embed_type": embedType,
            "activate_alias_option": true
        });
        jq.post('ajax_call.php', {
            'module': 'modules/publish/ajax_calls.php',
            'action': 'add_domain_alias',
            'parameters': ajaxParameters,
            'value': document.querySelector('[data-role=domain-value]').value
        }, function (data) {
            var parsedData = JSON.parse(data);
            if (parsedData.status === "OK") {
                if (_this.domainsDropdown !== null) {
                    var caption = document.querySelector('[data-role=domain-value]').value;
                    var parent_2 = jq('[data-role=menu-panel][data-number-of-existing-domains]'), currentDomains = parseInt(jq(parent_2).attr('data-number-of-existing-domains'));
                    parent_2.attr('data-number-of-existing-domains', currentDomains + 1);
                    parent_2.attr('data-domain-alias-checkbox-state', 'true');
                    if (undefined !== _this.domainsDropdown) {
                        _this.domainsDropdown.clearAllItems();
                    }
                    _this.domainsDropdown.withSingleItem({
                        id: "5",
                        caption: caption
                    }).withSelectedItemId(caption);
                    if (currentDomains == 0) {
                        _this.domainsDropdown.handleDropdownComponentElementChangeEvent(caption);
                    }
                }
                if (jq(dialog.body).has('data-domain-alias-error')) {
                    jq(dialog.body).removeAttr('data-domain-alias-error');
                }
                dialog.close();
            }
            else if (parsedData.status === "UPGRADE") {
                loader.getCommandDispatcher()
                    .triggerPaywall(EUpgradeReason.DOMAIN_ALIAS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN, parsedData.toPlan);
            }
            else {
                jq(dialog.body).attr('data-domain-alias-error', '1');
            }
        });
    };
    return DomainAliasDialog;
}());
var SSLCheckboxComponent = (function (_super) {
    __extends(SSLCheckboxComponent, _super);
    function SSLCheckboxComponent() {
        return _super.call(this) || this;
    }
    SSLCheckboxComponent.prototype.addPanelCheckboxEventListeners = function () {
        var _this = this;
        this.checkboxInputNode.onchange = function () {
            var tabAndTypeElement = $('[data-overlay-tab][data-overlay-embed-type]'), tab = 'form-link', embedType = 'form-link', jq = _this.getParent().getDependency('jq');
            if (tabAndTypeElement !== null) {
                tab = tabAndTypeElement.attr('data-overlay-tab');
                embedType = tabAndTypeElement.attr('data-overlay-embed-type');
            }
            var ajaxParamObj = {
                "form_id": _this.getDependency("formId"),
                "user_id": _this.getDependency("userId"),
                "PHPSESSID": _this.getDependency("sessionId"),
                "needs_upgrade": false,
                "needs_alias_upgrade": 0,
                "tab": tab,
                "embed_type": embedType,
                "activate_alias_option": true,
                "selected_alias": _this.domainAlias
            };
            var isSslChecked = _this.isChecked(), ajaxParameters = JSON.stringify(ajaxParamObj);
            jq.post('ajax_call.php', {
                'module': 'modules/publish/ajax_calls.php',
                'action': 'change_ssl_option',
                'parameters': ajaxParameters,
                'value': (isSslChecked ? 1 : 0)
            }, function (data) {
                try {
                    var parsedData = JSON.parse(data);
                    if (parsedData.status === "OK") {
                        var parsedDataCode = parsedData.generated_code;
                        if (ajaxParamObj['tab'] == 'twitter') {
                            var arr = parsedData.generated_code.split('/');
                            arr.pop();
                            parsedDataCode = arr.join('/');
                        }
                        document.querySelector('textarea[data-role="code-container"]').textContent = parsedDataCode;
                        _this.getParent().trigger('ssl-changed', isSslChecked);
                    }
                    else if (parsedData.status === "UPGRADE") {
                        _this.checkboxInputNode.checked = false;
                        _this.getDependency("commandDispatcher").triggerPaywall(EUpgradeReason.SSL_NOT_SUPPORTED_IN_CURRENT_USER_PLAN);
                    }
                    else {
                        _this.checkboxInputNode.checked = false;
                        _this.getDependency("UI").alert('Error saving setting', 'There was an error saving the secured SSL setting.');
                    }
                }
                catch (error) {
                    console.error(error);
                }
            });
            _this.trackEvent('publish_connection_ssl_click');
        };
    };
    return SSLCheckboxComponent;
}(MenuPanelCheckboxComponent));
var DomainAliasCheckboxComponent = (function (_super) {
    __extends(DomainAliasCheckboxComponent, _super);
    function DomainAliasCheckboxComponent(loader, dropdown) {
        var _this = _super.call(this) || this;
        _this.loader = loader;
        _this.domainAliasDialog = new DomainAliasDialog(dropdown);
        return _this;
    }
    DomainAliasCheckboxComponent.prototype.addPanelCheckboxEventListeners = function () {
        var _this = this;
        setTimeout(function () {
            _this.getRootNode().parentElement.setAttribute('data-domain-alias-checkbox-state', String(_this.checkboxInputNode.checked));
        }, 10);
        this.checkboxInputNode.onchange = function () {
            var hasNoneAlreadyExistingDomains = +_this.getRootNode().parentElement.getAttribute('data-number-of-existing-domains') === 0;
            var tabAndTypeElement = $('[data-overlay-tab][data-overlay-embed-type]'), tab = 'form-link', embedType = 'form-link';
            _this.trackPlatformMetric('publish_domain_alias_click');
            if (tabAndTypeElement !== null) {
                tab = tabAndTypeElement.attr('data-overlay-tab');
                embedType = tabAndTypeElement.attr('data-overlay-embed-type');
            }
            var isSslChecked = _this.isChecked(), ajaxParameters = JSON.stringify({
                "form_id": _this.getDependency("formId"),
                "user_id": _this.getDependency("userId"),
                "PHPSESSID": _this.getDependency("sessionId"),
                "needs_upgrade": false,
                "needs_alias_upgrade": 0,
                "tab": tab,
                "embed_type": embedType,
                "activate_alias_option": true,
                "selected_alias": _this.domainAlias
            });
            $.post('ajax_call.php', {
                'module': 'modules/publish/ajax_calls.php',
                'action': 'change_alias_option',
                'parameters': ajaxParameters,
                'value': (isSslChecked ? 1 : 0)
            }, function (data) {
                try {
                    var parsedData = JSON.parse(data);
                    if (parsedData.status === "OK") {
                        if (hasNoneAlreadyExistingDomains) {
                            if (_this.isChecked()) {
                                _this.domainAliasDialog.displayDomainAliasAddDialog(_this.loader, _this.checkboxInputNode);
                            }
                        }
                        else {
                            if (_this.isChecked()) {
                                document.querySelector('textarea[data-role="code-container"]').textContent = parsedData.generated_code;
                            }
                            _this.getRootNode().parentElement.setAttribute('data-domain-alias-checkbox-state', String(_this.checkboxInputNode.checked));
                        }
                    }
                    else if (parsedData.status === "UPGRADE") {
                        _this.checkboxInputNode.checked = false;
                        _this.getDependency("commandDispatcher")
                            .triggerPaywall(EUpgradeReason.DOMAIN_ALIAS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN, parsedData.toPlan);
                    }
                    else {
                        _this.checkboxInputNode.checked = false;
                        _this.getDependency("UI")
                            .alert('Error saving setting', 'There was an error saving the domain alias setting.');
                    }
                }
                catch (error) {
                    console.error(error);
                }
            });
        };
    };
    DomainAliasCheckboxComponent.prototype.trackPlatformMetric = function (metric) {
        if (null == this.platformMetricsManager) {
            this.platformMetricsManager = this.getParent().getDependency(PlatformMetricsManager.PLATFORM_METRICS_DEPENDECY);
        }
        if (null !== this.platformMetricsManager) {
            this.platformMetricsManager.trackPlatformMetric(metric);
        }
    };
    return DomainAliasCheckboxComponent;
}(MenuPanelCheckboxComponent));
var DomainAliasDropdownComponent = (function (_super) {
    __extends(DomainAliasDropdownComponent, _super);
    function DomainAliasDropdownComponent(jquery) {
        var _this = _super.call(this) || this;
        _this.jq = jquery;
        setTimeout(function () {
            _this.getRootNode().parentElement.setAttribute('data-number-of-existing-domains', _this.getItems().length.toString());
        }, 10);
        return _this;
    }
    DomainAliasDropdownComponent.prototype.handleDropdownComponentElementChangeEvent = function (selectedAlias) {
        var _this = this;
        var tabAndTypeElement = $('[data-overlay-tab][data-overlay-embed-type]'), tab = 'form-link', embedType = 'form-link', selectedDropdownOptionValue = selectedAlias;
        if (tabAndTypeElement !== null) {
            tab = tabAndTypeElement.attr('data-overlay-tab');
            embedType = tabAndTypeElement.attr('data-overlay-embed-type');
        }
        var ajaxParameters = JSON.stringify({
            "form_id": this.getDependency("formId"),
            "user_id": this.getDependency("userId"),
            "PHPSESSID": this.getDependency("sessionId"),
            "needs_upgrade": false,
            "needs_alias_upgrade": 0,
            "tab": tab,
            "embed_type": embedType,
            "selected_alias": selectedDropdownOptionValue
        });
        this.jq.post('ajax_call.php', {
            'module': 'modules/publish/ajax_calls.php',
            'action': 'change_domain_alias',
            'parameters': ajaxParameters,
            'value': selectedDropdownOptionValue
        }, function (data) {
            try {
                var parsedData = JSON.parse(data);
                if (parsedData.status === "OK") {
                    document.querySelector('textarea[data-role="code-container"]').textContent = parsedData.generated_code;
                }
                else {
                    _this.getDependency("UI").alert('Error saving setting', 'There was an error adding the domain to the database.');
                }
            }
            catch (error) {
                console.error(error);
            }
        });
    };
    return DomainAliasDropdownComponent;
}(MenuPanelDropdownComponent));
(function (e, t) { 'object' == typeof exports && 'undefined' != typeof module ? module.exports = t() : 'function' == typeof define && define.amd ? define(t) : e.Popper = t(); })(this, function () {
    'use strict';
    function e(e) { return e && '[object Function]' === {}.toString.call(e); }
    function t(e, t) { if (1 !== e.nodeType)
        return []; var o = e.ownerDocument.defaultView, n = o.getComputedStyle(e, null); return t ? n[t] : n; }
    function o(e) { return 'HTML' === e.nodeName ? e : e.parentNode || e.host; }
    function n(e) { if (!e)
        return document.body; switch (e.nodeName) {
        case 'HTML':
        case 'BODY': return e.ownerDocument.body;
        case '#document': return e.body;
    } var i = t(e), r = i.overflow, p = i.overflowX, s = i.overflowY; return /(auto|scroll|overlay)/.test(r + s + p) ? e : n(o(e)); }
    function r(e) { return 11 === e ? pe : 10 === e ? se : pe || se; }
    function p(e) { if (!e)
        return document.documentElement; for (var o = r(10) ? document.body : null, n = e.offsetParent || null; n === o && e.nextElementSibling;)
        n = (e = e.nextElementSibling).offsetParent; var i = n && n.nodeName; return i && 'BODY' !== i && 'HTML' !== i ? -1 !== ['TH', 'TD', 'TABLE'].indexOf(n.nodeName) && 'static' === t(n, 'position') ? p(n) : n : e ? e.ownerDocument.documentElement : document.documentElement; }
    function s(e) { var t = e.nodeName; return 'BODY' !== t && ('HTML' === t || p(e.firstElementChild) === e); }
    function d(e) { return null === e.parentNode ? e : d(e.parentNode); }
    function a(e, t) { if (!e || !e.nodeType || !t || !t.nodeType)
        return document.documentElement; var o = e.compareDocumentPosition(t) & Node.DOCUMENT_POSITION_FOLLOWING, n = o ? e : t, i = o ? t : e, r = document.createRange(); r.setStart(n, 0), r.setEnd(i, 0); var l = r.commonAncestorContainer; if (e !== l && t !== l || n.contains(i))
        return s(l) ? l : p(l); var f = d(e); return f.host ? a(f.host, t) : a(e, d(t).host); }
    function l(e) { var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 'top', o = 'top' === t ? 'scrollTop' : 'scrollLeft', n = e.nodeName; if ('BODY' === n || 'HTML' === n) {
        var i = e.ownerDocument.documentElement, r = e.ownerDocument.scrollingElement || i;
        return r[o];
    } return e[o]; }
    function f(e, t) { var o = 2 < arguments.length && void 0 !== arguments[2] && arguments[2], n = l(t, 'top'), i = l(t, 'left'), r = o ? -1 : 1; return e.top += n * r, e.bottom += n * r, e.left += i * r, e.right += i * r, e; }
    function m(e, t) { var o = 'x' === t ? 'Left' : 'Top', n = 'Left' == o ? 'Right' : 'Bottom'; return parseFloat(e['border' + o + 'Width'], 10) + parseFloat(e['border' + n + 'Width'], 10); }
    function h(e, t, o, n) { return ee(t['offset' + e], t['scroll' + e], o['client' + e], o['offset' + e], o['scroll' + e], r(10) ? parseInt(o['offset' + e]) + parseInt(n['margin' + ('Height' === e ? 'Top' : 'Left')]) + parseInt(n['margin' + ('Height' === e ? 'Bottom' : 'Right')]) : 0); }
    function c(e) { var t = e.body, o = e.documentElement, n = r(10) && getComputedStyle(o); return { height: h('Height', t, o, n), width: h('Width', t, o, n) }; }
    function g(e) { return fe({}, e, { right: e.left + e.width, bottom: e.top + e.height }); }
    function u(e) { var o = {}; try {
        if (r(10)) {
            o = e.getBoundingClientRect();
            var n = l(e, 'top'), i = l(e, 'left');
            o.top += n, o.left += i, o.bottom += n, o.right += i;
        }
        else
            o = e.getBoundingClientRect();
    }
    catch (t) { } var p = { left: o.left, top: o.top, width: o.right - o.left, height: o.bottom - o.top }, s = 'HTML' === e.nodeName ? c(e.ownerDocument) : {}, d = s.width || e.clientWidth || p.right - p.left, a = s.height || e.clientHeight || p.bottom - p.top, f = e.offsetWidth - d, h = e.offsetHeight - a; if (f || h) {
        var u = t(e);
        f -= m(u, 'x'), h -= m(u, 'y'), p.width -= f, p.height -= h;
    } return g(p); }
    function b(e, o) { var i = 2 < arguments.length && void 0 !== arguments[2] && arguments[2], p = r(10), s = 'HTML' === o.nodeName, d = u(e), a = u(o), l = n(e), m = t(o), h = parseFloat(m.borderTopWidth, 10), c = parseFloat(m.borderLeftWidth, 10); i && s && (a.top = ee(a.top, 0), a.left = ee(a.left, 0)); var b = g({ top: d.top - a.top - h, left: d.left - a.left - c, width: d.width, height: d.height }); if (b.marginTop = 0, b.marginLeft = 0, !p && s) {
        var w = parseFloat(m.marginTop, 10), y = parseFloat(m.marginLeft, 10);
        b.top -= h - w, b.bottom -= h - w, b.left -= c - y, b.right -= c - y, b.marginTop = w, b.marginLeft = y;
    } return (p && !i ? o.contains(l) : o === l && 'BODY' !== l.nodeName) && (b = f(b, o)), b; }
    function w(e) { var t = 1 < arguments.length && void 0 !== arguments[1] && arguments[1], o = e.ownerDocument.documentElement, n = b(e, o), i = ee(o.clientWidth, window.innerWidth || 0), r = ee(o.clientHeight, window.innerHeight || 0), p = t ? 0 : l(o), s = t ? 0 : l(o, 'left'), d = { top: p - n.top + n.marginTop, left: s - n.left + n.marginLeft, width: i, height: r }; return g(d); }
    function y(e) { var n = e.nodeName; if ('BODY' === n || 'HTML' === n)
        return !1; if ('fixed' === t(e, 'position'))
        return !0; var i = o(e); return !!i && y(i); }
    function E(e) { if (!e || !e.parentElement || r())
        return document.documentElement; for (var o = e.parentElement; o && 'none' === t(o, 'transform');)
        o = o.parentElement; return o || document.documentElement; }
    function v(e, t, i, r) { var p = 4 < arguments.length && void 0 !== arguments[4] && arguments[4], s = { top: 0, left: 0 }, d = p ? E(e) : a(e, t); if ('viewport' === r)
        s = w(d, p);
    else {
        var l;
        'scrollParent' === r ? (l = n(o(t)), 'BODY' === l.nodeName && (l = e.ownerDocument.documentElement)) : 'window' === r ? l = e.ownerDocument.documentElement : l = r;
        var f = b(l, d, p);
        if ('HTML' === l.nodeName && !y(d)) {
            var m = c(e.ownerDocument), h = m.height, g = m.width;
            s.top += f.top - f.marginTop, s.bottom = h + f.top, s.left += f.left - f.marginLeft, s.right = g + f.left;
        }
        else
            s = f;
    } i = i || 0; var u = 'number' == typeof i; return s.left += u ? i : i.left || 0, s.top += u ? i : i.top || 0, s.right -= u ? i : i.right || 0, s.bottom -= u ? i : i.bottom || 0, s; }
    function x(e) { var t = e.width, o = e.height; return t * o; }
    function O(e, t, o, n, i) { var r = 5 < arguments.length && void 0 !== arguments[5] ? arguments[5] : 0; if (-1 === e.indexOf('auto'))
        return e; var p = v(o, n, r, i), s = { top: { width: p.width, height: t.top - p.top }, right: { width: p.right - t.right, height: p.height }, bottom: { width: p.width, height: p.bottom - t.bottom }, left: { width: t.left - p.left, height: p.height } }, d = Object.keys(s).map(function (e) { return fe({ key: e }, s[e], { area: x(s[e]) }); }).sort(function (e, t) { return t.area - e.area; }), a = d.filter(function (e) { var t = e.width, n = e.height; return t >= o.clientWidth && n >= o.clientHeight; }), l = 0 < a.length ? a[0].key : d[0].key, f = e.split('-')[1]; return l + (f ? '-' + f : ''); }
    function L(e, t, o) { var n = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : null, i = n ? E(t) : a(t, o); return b(o, i, n); }
    function S(e) { var t = e.ownerDocument.defaultView, o = t.getComputedStyle(e), n = parseFloat(o.marginTop || 0) + parseFloat(o.marginBottom || 0), i = parseFloat(o.marginLeft || 0) + parseFloat(o.marginRight || 0), r = { width: e.offsetWidth + i, height: e.offsetHeight + n }; return r; }
    function T(e) { var t = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' }; return e.replace(/left|right|bottom|top/g, function (e) { return t[e]; }); }
    function C(e, t, o) { o = o.split('-')[0]; var n = S(e), i = { width: n.width, height: n.height }, r = -1 !== ['right', 'left'].indexOf(o), p = r ? 'top' : 'left', s = r ? 'left' : 'top', d = r ? 'height' : 'width', a = r ? 'width' : 'height'; return i[p] = t[p] + t[d] / 2 - n[d] / 2, i[s] = o === s ? t[s] - n[a] : t[T(s)], i; }
    function D(e, t) { return Array.prototype.find ? e.find(t) : e.filter(t)[0]; }
    function N(e, t, o) { if (Array.prototype.findIndex)
        return e.findIndex(function (e) { return e[t] === o; }); var n = D(e, function (e) { return e[t] === o; }); return e.indexOf(n); }
    function P(t, o, n) { var i = void 0 === n ? t : t.slice(0, N(t, 'name', n)); return i.forEach(function (t) { t['function'] && console.warn('`modifier.function` is deprecated, use `modifier.fn`!'); var n = t['function'] || t.fn; t.enabled && e(n) && (o.offsets.popper = g(o.offsets.popper), o.offsets.reference = g(o.offsets.reference), o = n(o, t)); }), o; }
    function k() { if (!this.state.isDestroyed) {
        var e = { instance: this, styles: {}, arrowStyles: {}, attributes: {}, flipped: !1, offsets: {} };
        e.offsets.reference = L(this.state, this.popper, this.reference, this.options.positionFixed), e.placement = O(this.options.placement, e.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding), e.originalPlacement = e.placement, e.positionFixed = this.options.positionFixed, e.offsets.popper = C(this.popper, e.offsets.reference, e.placement), e.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute', e = P(this.modifiers, e), this.state.isCreated ? this.options.onUpdate(e) : (this.state.isCreated = !0, this.options.onCreate(e));
    } }
    function W(e, t) { return e.some(function (e) { var o = e.name, n = e.enabled; return n && o === t; }); }
    function B(e) { for (var t = [!1, 'ms', 'Webkit', 'Moz', 'O'], o = e.charAt(0).toUpperCase() + e.slice(1), n = 0; n < t.length; n++) {
        var i = t[n], r = i ? '' + i + o : e;
        if ('undefined' != typeof document.body.style[r])
            return r;
    } return null; }
    function H() { return this.state.isDestroyed = !0, W(this.modifiers, 'applyStyle') && (this.popper.removeAttribute('x-placement'), this.popper.style.position = '', this.popper.style.top = '', this.popper.style.left = '', this.popper.style.right = '', this.popper.style.bottom = '', this.popper.style.willChange = '', this.popper.style[B('transform')] = ''), this.disableEventListeners(), this.options.removeOnDestroy && this.popper.parentNode.removeChild(this.popper), this; }
    function A(e) { var t = e.ownerDocument; return t ? t.defaultView : window; }
    function M(e, t, o, i) { var r = 'BODY' === e.nodeName, p = r ? e.ownerDocument.defaultView : e; p.addEventListener(t, o, { passive: !0 }), r || M(n(p.parentNode), t, o, i), i.push(p); }
    function F(e, t, o, i) { o.updateBound = i, A(e).addEventListener('resize', o.updateBound, { passive: !0 }); var r = n(e); return M(r, 'scroll', o.updateBound, o.scrollParents), o.scrollElement = r, o.eventsEnabled = !0, o; }
    function I() { this.state.eventsEnabled || (this.state = F(this.reference, this.options, this.state, this.scheduleUpdate)); }
    function R(e, t) { return A(e).removeEventListener('resize', t.updateBound), t.scrollParents.forEach(function (e) { e.removeEventListener('scroll', t.updateBound); }), t.updateBound = null, t.scrollParents = [], t.scrollElement = null, t.eventsEnabled = !1, t; }
    function U() { this.state.eventsEnabled && (cancelAnimationFrame(this.scheduleUpdate), this.state = R(this.reference, this.state)); }
    function Y(e) { return '' !== e && !isNaN(parseFloat(e)) && isFinite(e); }
    function V(e, t) { Object.keys(t).forEach(function (o) { var n = ''; -1 !== ['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(o) && Y(t[o]) && (n = 'px'), e.style[o] = t[o] + n; }); }
    function j(e, t) { Object.keys(t).forEach(function (o) { var n = t[o]; !1 === n ? e.removeAttribute(o) : e.setAttribute(o, t[o]); }); }
    function q(e, t) { var o = e.offsets, n = o.popper, i = o.reference, r = $, p = function (e) { return e; }, s = r(i.width), d = r(n.width), a = -1 !== ['left', 'right'].indexOf(e.placement), l = -1 !== e.placement.indexOf('-'), f = t ? a || l || s % 2 == d % 2 ? r : Z : p, m = t ? r : p; return { left: f(1 == s % 2 && 1 == d % 2 && !l && t ? n.left - 1 : n.left), top: m(n.top), bottom: m(n.bottom), right: f(n.right) }; }
    function K(e, t, o) { var n = D(e, function (e) { var o = e.name; return o === t; }), i = !!n && e.some(function (e) { return e.name === o && e.enabled && e.order < n.order; }); if (!i) {
        var r = '`' + t + '`';
        console.warn('`' + o + '`' + ' modifier is required by ' + r + ' modifier in order to work, be sure to include it before ' + r + '!');
    } return i; }
    function z(e) { return 'end' === e ? 'start' : 'start' === e ? 'end' : e; }
    function G(e) { var t = 1 < arguments.length && void 0 !== arguments[1] && arguments[1], o = ce.indexOf(e), n = ce.slice(o + 1).concat(ce.slice(0, o)); return t ? n.reverse() : n; }
    function _(e, t, o, n) { var i = e.match(/((?:\-|\+)?\d*\.?\d*)(.*)/), r = +i[1], p = i[2]; if (!r)
        return e; if (0 === p.indexOf('%')) {
        var s;
        switch (p) {
            case '%p':
                s = o;
                break;
            case '%':
            case '%r':
            default: s = n;
        }
        var d = g(s);
        return d[t] / 100 * r;
    } if ('vh' === p || 'vw' === p) {
        var a;
        return a = 'vh' === p ? ee(document.documentElement.clientHeight, window.innerHeight || 0) : ee(document.documentElement.clientWidth, window.innerWidth || 0), a / 100 * r;
    } return r; }
    function X(e, t, o, n) { var i = [0, 0], r = -1 !== ['right', 'left'].indexOf(n), p = e.split(/(\+|\-)/).map(function (e) { return e.trim(); }), s = p.indexOf(D(p, function (e) { return -1 !== e.search(/,|\s/); })); p[s] && -1 === p[s].indexOf(',') && console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.'); var d = /\s*,\s*|\s+/, a = -1 === s ? [p] : [p.slice(0, s).concat([p[s].split(d)[0]]), [p[s].split(d)[1]].concat(p.slice(s + 1))]; return a = a.map(function (e, n) { var i = (1 === n ? !r : r) ? 'height' : 'width', p = !1; return e.reduce(function (e, t) { return '' === e[e.length - 1] && -1 !== ['+', '-'].indexOf(t) ? (e[e.length - 1] = t, p = !0, e) : p ? (e[e.length - 1] += t, p = !1, e) : e.concat(t); }, []).map(function (e) { return _(e, i, t, o); }); }), a.forEach(function (e, t) { e.forEach(function (o, n) { Y(o) && (i[t] += o * ('-' === e[n - 1] ? -1 : 1)); }); }), i; }
    function J(e, t) { var o, n = t.offset, i = e.placement, r = e.offsets, p = r.popper, s = r.reference, d = i.split('-')[0]; return o = Y(+n) ? [+n, 0] : X(n, p, s, d), 'left' === d ? (p.top += o[0], p.left -= o[1]) : 'right' === d ? (p.top += o[0], p.left += o[1]) : 'top' === d ? (p.left += o[0], p.top -= o[1]) : 'bottom' === d && (p.left += o[0], p.top += o[1]), e.popper = p, e; }
    for (var Q = Math.min, Z = Math.floor, $ = Math.round, ee = Math.max, te = 'undefined' != typeof window && 'undefined' != typeof document, oe = ['Edge', 'Trident', 'Firefox'], ne = 0, ie = 0; ie < oe.length; ie += 1)
        if (te && 0 <= navigator.userAgent.indexOf(oe[ie])) {
            ne = 1;
            break;
        }
    var i = te && window.Promise, re = i ? function (e) { var t = !1; return function () { t || (t = !0, window.Promise.resolve().then(function () { t = !1, e(); })); }; } : function (e) { var t = !1; return function () { t || (t = !0, setTimeout(function () { t = !1, e(); }, ne)); }; }, pe = te && !!(window.MSInputMethodContext && document.documentMode), se = te && /MSIE 10/.test(navigator.userAgent), de = function (e, t) { if (!(e instanceof t))
        throw new TypeError('Cannot call a class as a function'); }, ae = function () { function e(e, t) { for (var o, n = 0; n < t.length; n++)
        o = t[n], o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(e, o.key, o); } return function (t, o, n) { return o && e(t.prototype, o), n && e(t, n), t; }; }(), le = function (e, t, o) { return t in e ? Object.defineProperty(e, t, { value: o, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = o, e; }, fe = Object.assign || function (e) { for (var t, o = 1; o < arguments.length; o++)
        for (var n in t = arguments[o], t)
            Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e; }, me = te && /Firefox/i.test(navigator.userAgent), he = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'], ce = he.slice(3), ge = { FLIP: 'flip', CLOCKWISE: 'clockwise', COUNTERCLOCKWISE: 'counterclockwise' }, ue = function () { function t(o, n) { var i = this, r = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : {}; de(this, t), this.scheduleUpdate = function () { return requestAnimationFrame(i.update); }, this.update = re(this.update.bind(this)), this.options = fe({}, t.Defaults, r), this.state = { isDestroyed: !1, isCreated: !1, scrollParents: [] }, this.reference = o && o.jquery ? o[0] : o, this.popper = n && n.jquery ? n[0] : n, this.options.modifiers = {}, Object.keys(fe({}, t.Defaults.modifiers, r.modifiers)).forEach(function (e) { i.options.modifiers[e] = fe({}, t.Defaults.modifiers[e] || {}, r.modifiers ? r.modifiers[e] : {}); }), this.modifiers = Object.keys(this.options.modifiers).map(function (e) { return fe({ name: e }, i.options.modifiers[e]); }).sort(function (e, t) { return e.order - t.order; }), this.modifiers.forEach(function (t) { t.enabled && e(t.onLoad) && t.onLoad(i.reference, i.popper, i.options, t, i.state); }), this.update(); var p = this.options.eventsEnabled; p && this.enableEventListeners(), this.state.eventsEnabled = p; } return ae(t, [{ key: 'update', value: function () { return k.call(this); } }, { key: 'destroy', value: function () { return H.call(this); } }, { key: 'enableEventListeners', value: function () { return I.call(this); } }, { key: 'disableEventListeners', value: function () { return U.call(this); } }]), t; }();
    return ue.Utils = ('undefined' == typeof window ? global : window).PopperUtils, ue.placements = he, ue.Defaults = { placement: 'bottom', positionFixed: !1, eventsEnabled: !0, removeOnDestroy: !1, onCreate: function () { }, onUpdate: function () { }, modifiers: { shift: { order: 100, enabled: !0, fn: function (e) { var t = e.placement, o = t.split('-')[0], n = t.split('-')[1]; if (n) {
                    var i = e.offsets, r = i.reference, p = i.popper, s = -1 !== ['bottom', 'top'].indexOf(o), d = s ? 'left' : 'top', a = s ? 'width' : 'height', l = { start: le({}, d, r[d]), end: le({}, d, r[d] + r[a] - p[a]) };
                    e.offsets.popper = fe({}, p, l[n]);
                } return e; } }, offset: { order: 200, enabled: !0, fn: J, offset: 0 }, preventOverflow: { order: 300, enabled: !0, fn: function (e, t) { var o = t.boundariesElement || p(e.instance.popper); e.instance.reference === o && (o = p(o)); var n = B('transform'), i = e.instance.popper.style, r = i.top, s = i.left, d = i[n]; i.top = '', i.left = '', i[n] = ''; var a = v(e.instance.popper, e.instance.reference, t.padding, o, e.positionFixed); i.top = r, i.left = s, i[n] = d, t.boundaries = a; var l = t.priority, f = e.offsets.popper, m = { primary: function (e) { var o = f[e]; return f[e] < a[e] && !t.escapeWithReference && (o = ee(f[e], a[e])), le({}, e, o); }, secondary: function (e) { var o = 'right' === e ? 'left' : 'top', n = f[o]; return f[e] > a[e] && !t.escapeWithReference && (n = Q(f[o], a[e] - ('right' === e ? f.width : f.height))), le({}, o, n); } }; return l.forEach(function (e) { var t = -1 === ['left', 'top'].indexOf(e) ? 'secondary' : 'primary'; f = fe({}, f, m[t](e)); }), e.offsets.popper = f, e; }, priority: ['left', 'right', 'top', 'bottom'], padding: 5, boundariesElement: 'scrollParent' }, keepTogether: { order: 400, enabled: !0, fn: function (e) { var t = e.offsets, o = t.popper, n = t.reference, i = e.placement.split('-')[0], r = Z, p = -1 !== ['top', 'bottom'].indexOf(i), s = p ? 'right' : 'bottom', d = p ? 'left' : 'top', a = p ? 'width' : 'height'; return o[s] < r(n[d]) && (e.offsets.popper[d] = r(n[d]) - o[a]), o[d] > r(n[s]) && (e.offsets.popper[d] = r(n[s])), e; } }, arrow: { order: 500, enabled: !0, fn: function (e, o) { var n; if (!K(e.instance.modifiers, 'arrow', 'keepTogether'))
                    return e; var i = o.element; if ('string' == typeof i) {
                    if (i = e.instance.popper.querySelector(i), !i)
                        return e;
                }
                else if (!e.instance.popper.contains(i))
                    return console.warn('WARNING: `arrow.element` must be child of its popper element!'), e; var r = e.placement.split('-')[0], p = e.offsets, s = p.popper, d = p.reference, a = -1 !== ['left', 'right'].indexOf(r), l = a ? 'height' : 'width', f = a ? 'Top' : 'Left', m = f.toLowerCase(), h = a ? 'left' : 'top', c = a ? 'bottom' : 'right', u = S(i)[l]; d[c] - u < s[m] && (e.offsets.popper[m] -= s[m] - (d[c] - u)), d[m] + u > s[c] && (e.offsets.popper[m] += d[m] + u - s[c]), e.offsets.popper = g(e.offsets.popper); var b = d[m] + d[l] / 2 - u / 2, w = t(e.instance.popper), y = parseFloat(w['margin' + f], 10), E = parseFloat(w['border' + f + 'Width'], 10), v = b - e.offsets.popper[m] - y - E; return v = ee(Q(s[l] - u, v), 0), e.arrowElement = i, e.offsets.arrow = (n = {}, le(n, m, $(v)), le(n, h, ''), n), e; }, element: '[x-arrow]' }, flip: { order: 600, enabled: !0, fn: function (e, t) { if (W(e.instance.modifiers, 'inner'))
                    return e; if (e.flipped && e.placement === e.originalPlacement)
                    return e; var o = v(e.instance.popper, e.instance.reference, t.padding, t.boundariesElement, e.positionFixed), n = e.placement.split('-')[0], i = T(n), r = e.placement.split('-')[1] || '', p = []; switch (t.behavior) {
                    case ge.FLIP:
                        p = [n, i];
                        break;
                    case ge.CLOCKWISE:
                        p = G(n);
                        break;
                    case ge.COUNTERCLOCKWISE:
                        p = G(n, !0);
                        break;
                    default: p = t.behavior;
                } return p.forEach(function (s, d) { if (n !== s || p.length === d + 1)
                    return e; n = e.placement.split('-')[0], i = T(n); var a = e.offsets.popper, l = e.offsets.reference, f = Z, m = 'left' === n && f(a.right) > f(l.left) || 'right' === n && f(a.left) < f(l.right) || 'top' === n && f(a.bottom) > f(l.top) || 'bottom' === n && f(a.top) < f(l.bottom), h = f(a.left) < f(o.left), c = f(a.right) > f(o.right), g = f(a.top) < f(o.top), u = f(a.bottom) > f(o.bottom), b = 'left' === n && h || 'right' === n && c || 'top' === n && g || 'bottom' === n && u, w = -1 !== ['top', 'bottom'].indexOf(n), y = !!t.flipVariations && (w && 'start' === r && h || w && 'end' === r && c || !w && 'start' === r && g || !w && 'end' === r && u), E = !!t.flipVariationsByContent && (w && 'start' === r && c || w && 'end' === r && h || !w && 'start' === r && u || !w && 'end' === r && g), v = y || E; (m || b || v) && (e.flipped = !0, (m || b) && (n = p[d + 1]), v && (r = z(r)), e.placement = n + (r ? '-' + r : ''), e.offsets.popper = fe({}, e.offsets.popper, C(e.instance.popper, e.offsets.reference, e.placement)), e = P(e.instance.modifiers, e, 'flip')); }), e; }, behavior: 'flip', padding: 5, boundariesElement: 'viewport', flipVariations: !1, flipVariationsByContent: !1 }, inner: { order: 700, enabled: !1, fn: function (e) { var t = e.placement, o = t.split('-')[0], n = e.offsets, i = n.popper, r = n.reference, p = -1 !== ['left', 'right'].indexOf(o), s = -1 === ['top', 'left'].indexOf(o); return i[p ? 'left' : 'top'] = r[o] - (s ? i[p ? 'width' : 'height'] : 0), e.placement = T(t), e.offsets.popper = g(i), e; } }, hide: { order: 800, enabled: !0, fn: function (e) { if (!K(e.instance.modifiers, 'hide', 'preventOverflow'))
                    return e; var t = e.offsets.reference, o = D(e.instance.modifiers, function (e) { return 'preventOverflow' === e.name; }).boundaries; if (t.bottom < o.top || t.left > o.right || t.top > o.bottom || t.right < o.left) {
                    if (!0 === e.hide)
                        return e;
                    e.hide = !0, e.attributes['x-out-of-boundaries'] = '';
                }
                else {
                    if (!1 === e.hide)
                        return e;
                    e.hide = !1, e.attributes['x-out-of-boundaries'] = !1;
                } return e; } }, computeStyle: { order: 850, enabled: !0, fn: function (e, t) { var o = t.x, n = t.y, i = e.offsets.popper, r = D(e.instance.modifiers, function (e) { return 'applyStyle' === e.name; }).gpuAcceleration; void 0 !== r && console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!'); var s, d, a = void 0 === r ? t.gpuAcceleration : r, l = p(e.instance.popper), f = u(l), m = { position: i.position }, h = q(e, 2 > window.devicePixelRatio || !me), c = 'bottom' === o ? 'top' : 'bottom', g = 'right' === n ? 'left' : 'right', b = B('transform'); if (d = 'bottom' == c ? 'HTML' === l.nodeName ? -l.clientHeight + h.bottom : -f.height + h.bottom : h.top, s = 'right' == g ? 'HTML' === l.nodeName ? -l.clientWidth + h.right : -f.width + h.right : h.left, a && b)
                    m[b] = 'translate3d(' + s + 'px, ' + d + 'px, 0)', m[c] = 0, m[g] = 0, m.willChange = 'transform';
                else {
                    var w = 'bottom' == c ? -1 : 1, y = 'right' == g ? -1 : 1;
                    m[c] = d * w, m[g] = s * y, m.willChange = c + ', ' + g;
                } var E = { "x-placement": e.placement }; return e.attributes = fe({}, E, e.attributes), e.styles = fe({}, m, e.styles), e.arrowStyles = fe({}, e.offsets.arrow, e.arrowStyles), e; }, gpuAcceleration: !0, x: 'bottom', y: 'right' }, applyStyle: { order: 900, enabled: !0, fn: function (e) { return V(e.instance.popper, e.styles), j(e.instance.popper, e.attributes), e.arrowElement && Object.keys(e.arrowStyles).length && V(e.arrowElement, e.arrowStyles), e; }, onLoad: function (e, t, o, n, i) { var r = L(i, t, e, o.positionFixed), p = O(o.placement, r, t, e, o.modifiers.flip.boundariesElement, o.modifiers.flip.padding); return t.setAttribute('x-placement', p), V(t, { position: o.positionFixed ? 'fixed' : 'absolute' }), o; }, gpuAcceleration: void 0 } } }, ue;
});
!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t(require("popper.js")) : "function" == typeof define && define.amd ? define(["popper.js"], t) : e.PopperTooltip = t(e.Popper); }(this, function (e) {
    "use strict";
    e = e && e.hasOwnProperty("default") ? e.default : e;
    var t = function (e, t) { if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function"); }, i = function () { function e(e, t) { for (var i = 0; i < t.length; i++) {
        var n = t[i];
        n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n);
    } } return function (t, i, n) { return i && e(t.prototype, i), n && e(t, n), t; }; }(), n = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) {
        var i = arguments[t];
        for (var n in i)
            Object.prototype.hasOwnProperty.call(i, n) && (e[n] = i[n]);
    } return e; }, o = { container: !1, delay: 0, html: !1, placement: "top", title: "", template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>', trigger: "hover focus", offset: 0, arrowSelector: ".tooltip-arrow, .tooltip__arrow", innerSelector: ".tooltip-inner, .tooltip__inner" }, r = function () { function r(e, i) { t(this, r), s.call(this), i = n({}, o, i), e.jquery && (e = e[0]), this.reference = e, this.options = i; var p = "string" == typeof i.trigger ? i.trigger.split(" ").filter(function (e) { return -1 !== ["click", "hover", "focus"].indexOf(e); }) : []; this._isOpen = !1, this._popperOptions = {}, this._setEventListeners(e, p, i); } return i(r, [{ key: "_create", value: function (e, t, i, n) { var o = window.document.createElement("div"); o.innerHTML = t.trim(); var r = o.childNodes[0]; r.id = "tooltip_" + Math.random().toString(36).substr(2, 10), r.setAttribute("aria-hidden", "false"); var s = o.querySelector(this.options.innerSelector); return this._addTitleContent(e, i, n, s), r; } }, { key: "_addTitleContent", value: function (e, t, i, n) { if (1 === t.nodeType || 11 === t.nodeType)
                i && n.appendChild(t);
            else if ((r = t) && "[object Function]" === {}.toString.call(r)) {
                var o = t.call(e);
                i ? n.innerHTML = o : n.textContent = o;
            }
            else
                i ? n.innerHTML = t : n.textContent = t; var r; } }, { key: "_show", value: function (t, i) { if (this._isOpen && !this._isOpening)
                return this; if (this._isOpen = !0, this._tooltipNode)
                return this._tooltipNode.style.visibility = "visible", this._tooltipNode.setAttribute("aria-hidden", "false"), this.popperInstance.update(), this; var o = t.getAttribute("title") || i.title; if (!o)
                return this; var r = this._create(t, i.template, o, i.html); t.setAttribute("aria-describedby", r.id); var s = this._findContainer(i.container, t); return this._append(r, s), this._popperOptions = n({}, i.popperOptions, { placement: i.placement }), this._popperOptions.modifiers = n({}, this._popperOptions.modifiers, { arrow: n({}, this._popperOptions.modifiers && this._popperOptions.modifiers.arrow, { element: i.arrowSelector }), offset: n({}, this._popperOptions.modifiers && this._popperOptions.modifiers.offset, { offset: i.offset }) }), i.boundariesElement && (this._popperOptions.modifiers.preventOverflow = { boundariesElement: i.boundariesElement }), this.popperInstance = new e(t, r, this._popperOptions), this._tooltipNode = r, this; } }, { key: "_hide", value: function () { return this._isOpen ? (this._isOpen = !1, this._tooltipNode.style.visibility = "hidden", this._tooltipNode.setAttribute("aria-hidden", "true"), this) : this; } }, { key: "_dispose", value: function () { var e = this; return this._events.forEach(function (t) { var i = t.func, n = t.event; e.reference.removeEventListener(n, i); }), this._events = [], this._tooltipNode && (this._hide(), this.popperInstance.destroy(), this.popperInstance.options.removeOnDestroy || (this._tooltipNode.parentNode.removeChild(this._tooltipNode), this._tooltipNode = null)), this; } }, { key: "_findContainer", value: function (e, t) { return "string" == typeof e ? e = window.document.querySelector(e) : !1 === e && (e = t.parentNode), e; } }, { key: "_append", value: function (e, t) { t.appendChild(e); } }, { key: "_setEventListeners", value: function (e, t, i) { var n = this, o = [], r = []; t.forEach(function (e) { switch (e) {
                case "hover":
                    o.push("mouseenter"), r.push("mouseleave");
                    break;
                case "focus":
                    o.push("focus"), r.push("blur");
                    break;
                case "click": o.push("click"), r.push("click");
            } }), o.forEach(function (t) { var o = function (t) { !0 !== n._isOpening && (t.usedByTooltip = !0, n._scheduleShow(e, i.delay, i, t)); }; n._events.push({ event: t, func: o }), e.addEventListener(t, o); }), r.forEach(function (t) { var o = function (t) { !0 !== t.usedByTooltip && n._scheduleHide(e, i.delay, i, t); }; n._events.push({ event: t, func: o }), e.addEventListener(t, o), "click" === t && i.closeOnClickOutside && document.addEventListener("mousedown", function (t) { if (n._isOpening) {
                var i = n.popperInstance.popper;
                e.contains(t.target) || i.contains(t.target) || o(t);
            } }, !0); }); } }, { key: "_scheduleShow", value: function (e, t, i) { var n = this; this._isOpening = !0; var o = t && t.show || t || 0; this._showTimeout = window.setTimeout(function () { return n._show(e, i); }, o); } }, { key: "_scheduleHide", value: function (e, t, i, n) { var o = this; this._isOpening = !1; var r = t && t.hide || t || 0; window.clearTimeout(this._showTimeout), window.setTimeout(function () { if (!1 !== o._isOpen && document.body.contains(o._tooltipNode)) {
                if ("mouseleave" === n.type)
                    if (o._setTooltipNodeEvent(n, e, t, i))
                        return;
                o._hide(e, i);
            } }, r); } }, { key: "_updateTitleContent", value: function (e) { if (void 0 !== this._tooltipNode) {
                var t = this._tooltipNode.querySelector(this.options.innerSelector);
                this._clearTitleContent(t, this.options.html, this.reference.getAttribute("title") || this.options.title), this._addTitleContent(this.reference, e, this.options.html, t), this.options.title = e, this.popperInstance.update();
            }
            else
                void 0 !== this.options.title && (this.options.title = e); } }, { key: "_clearTitleContent", value: function (e, t, i) { 1 === i.nodeType || 11 === i.nodeType ? t && e.removeChild(i) : t ? e.innerHTML = "" : e.textContent = ""; } }]), r; }(), s = function () { var e = this; this.show = function () { return e._show(e.reference, e.options); }, this.hide = function () { return e._hide(); }, this.dispose = function () { return e._dispose(); }, this.toggle = function () { return e._isOpen ? e.hide() : e.show(); }, this.updateTitleContent = function (t) { return e._updateTitleContent(t); }, this._events = [], this._setTooltipNodeEvent = function (t, i, n, o) { var r = t.relatedreference || t.toElement || t.relatedTarget; return !!e._tooltipNode.contains(r) && (e._tooltipNode.addEventListener(t.type, function n(r) { var s = r.relatedreference || r.toElement || r.relatedTarget; e._tooltipNode.removeEventListener(t.type, n), i.contains(s) || e._scheduleHide(i, o.delay, o, r); }), !0); }; };
    return r;
});
var UIMenuPopup = (function (_super) {
    __extends(UIMenuPopup, _super);
    function UIMenuPopup(rootNode, $) {
        var _this = _super.call(this) || this;
        _this.rootNode = rootNode;
        _this.menuItems = eval((rootNode).getAttribute('data-menu-items'));
        _this.jq = $;
        _this.attachEvents();
        UIMenuPopup.initializeEvents($);
        return _this;
    }
    UIMenuPopup.prototype.attachEvents = function () {
        var _this = this;
        var self = this;
        this.jq(this.rootNode).on('click', function (e) {
            e.stopPropagation();
            var isMenuOpened = !!_this.overlayElement && !!_this.overlayElement.parentNode;
            if (isMenuOpened) {
                _this.closeMenu();
            }
            else {
                _this.openMenu();
            }
        });
        window.addEventListener('wheel', function (e) {
            self.closeMenu();
        }, true);
        window.addEventListener('resize', function (e) {
            self.closeMenu();
        }, true);
        this.on('refreshOptions', function () {
            _this.menuItems = eval((_this.rootNode).getAttribute('data-menu-items'));
            _this.overlayElement = _this.createMenuContainer();
        });
    };
    UIMenuPopup.prototype.openMenu = function () {
        this.closeMenu();
        this.overlayElement = this.overlayElement || this.createMenuContainer();
        document.body.appendChild(this.overlayElement);
        var containerDimensions = this.overlayElement.getBoundingClientRect(), rootNodePosition = this.rootNode.getBoundingClientRect(), bodyDimensions = document.body.getBoundingClientRect();
        if (rootNodePosition.top + rootNodePosition.height + containerDimensions.height < bodyDimensions.height) {
            this.overlayElement.style.top = rootNodePosition.top + rootNodePosition.height + "px";
        }
        else {
            this.overlayElement.style.top = rootNodePosition.top - containerDimensions.height + 10 + "px";
        }
        this.overlayElement.style.left = rootNodePosition.left + rootNodePosition.width - containerDimensions.width + "px";
    };
    UIMenuPopup.prototype.createMenuContainer = function () {
        var self = this;
        var container = document.createElement('div');
        container.setAttribute('data-menu-container', '');
        for (var i = 0, len = this.menuItems.length; i < len; i++) {
            var itemDiv = this.createMenuItem(this.menuItems[i].name, this.menuItems[i].action);
            container.appendChild(itemDiv);
        }
        this.jq(container).on("mousedown", "> div > div", function (e) {
            self.selectElement(this.getAttribute('data-action'));
            self.closeMenu();
        });
        return container;
    };
    UIMenuPopup.prototype.createMenuItem = function (caption, action) {
        var outerDiv = document.createElement("div");
        var innerDiv = document.createElement("div");
        innerDiv.appendChild(document.createTextNode(caption));
        innerDiv.setAttribute('data-action', String(action || ''));
        outerDiv.appendChild(innerDiv);
        return outerDiv;
    };
    UIMenuPopup.prototype.selectElement = function (action) {
        this.trigger(action);
    };
    ;
    UIMenuPopup.prototype.closeMenu = function () {
        if (this.overlayElement && this.overlayElement.parentNode) {
            this.overlayElement.parentNode.removeChild(this.overlayElement);
        }
    };
    UIMenuPopup.initializeEvents = function ($) {
        if (this.eventsInitialized) {
            return;
        }
        document.body.addEventListener('mousedown', function (e) {
            var target = e.target || e.srcElement;
            if ($(target).is('body > [data-menu-container], body > [data-menu-container] *')) {
                return;
            }
            $('body > [data-menu-container]').remove();
        }, true);
        document.addEventListener('scroll', function (e) {
            $('body > [data-menu-container]').remove();
        });
        $('[data-role=scrollable-container]').on('scroll', function () {
            $('body > [data-menu-container]').remove();
        });
        this.eventsInitialized = true;
    };
    return UIMenuPopup;
}(EventEmitter));
var GlobalPageLoader = (function () {
    function GlobalPageLoader() {
        var _this = this;
        this.loadRequests = 0;
        this.rootNode = document.createElement('div');
        this.rootNode.setAttribute('data-role', 'page-loader');
        this.rootNode.textContent = 'Loading data...';
        this.lazyLoaderThrottle = Throttle.create(function () {
            _this.updateLoaderState();
        }, 200);
    }
    GlobalPageLoader.prototype.show = function () {
        if (!this.rootNode.parentNode) {
            document.body.appendChild(this.rootNode);
            document.body.setAttribute('data-is-loading', '');
        }
    };
    GlobalPageLoader.prototype.hide = function () {
        if (this.rootNode.parentNode) {
            document.body.removeChild(this.rootNode);
            document.body.removeAttribute('data-is-loading');
        }
    };
    GlobalPageLoader.prototype.updateLoaderState = function () {
        if (this.loadRequests > 0) {
            this.show();
        }
        else {
            this.hide();
        }
    };
    GlobalPageLoader.prototype.onLoadRequestStart = function () {
        this.loadRequests++;
        this.lazyLoaderThrottle();
    };
    GlobalPageLoader.prototype.onLoadRequestEnd = function () {
        this.loadRequests--;
        if (this.loadRequests < 0) {
            this.loadRequests = 0;
        }
        this.updateLoaderState();
    };
    return GlobalPageLoader;
}());
var DropdownButtonComponent = (function (_super) {
    __extends(DropdownButtonComponent, _super);
    function DropdownButtonComponent(buttonText) {
        var _this = _super.call(this) || this;
        _this.rootNode = document.createElement("div");
        _this.rootNode.setAttribute("data-role", "dropdown-button-component");
        _this.dropdownButton = document.createElement('div');
        _this.dropdownButton.setAttribute('data-role', 'dropdown-button');
        _this.rootNode.appendChild(_this.dropdownButton);
        _this.dropdownButton.textContent = buttonText;
        _this.nativeDropdown = document.createElement("select");
        _this.dropdownButton.appendChild(_this.nativeDropdown);
        _this.addEventListeners();
        return _this;
    }
    DropdownButtonComponent.prototype.getRoot = function () {
        return this.rootNode;
    };
    DropdownButtonComponent.prototype.clear = function () {
        while (this.nativeDropdown.options.length) {
            this.nativeDropdown.remove(0);
        }
    };
    DropdownButtonComponent.prototype.setOptions = function (options) {
        this.options = options;
        this.clear();
        for (var i = 0, len = this.options.length; i < len; i++) {
            var option = document.createElement('option');
            option.text = this.options[i].text;
            option.value = this.options[i].value;
            this.nativeDropdown.add(option);
        }
    };
    DropdownButtonComponent.prototype.setOptionsWithActions = function (options) {
        this.setOptions(options);
        this.setActionsOnOptions();
    };
    DropdownButtonComponent.prototype.setActionsOnOptions = function () {
        var _this = this;
        var self = this;
        this.nativeDropdown.addEventListener('change', function () {
            var option = self.findOption(self.nativeDropdown.value);
            option.action();
            self.nativeDropdown.value = null;
        });
        this.nativeDropdown.onmouseover = function () {
            _this.nativeDropdown.value = null;
        };
    };
    DropdownButtonComponent.prototype.findOption = function (value) {
        for (var i = 0, len = this.options.length; i < len; i++) {
            if (value == this.options[i].value)
                return this.options[i];
        }
    };
    DropdownButtonComponent.prototype.addEventListeners = function () {
        var _this = this;
        $(this.nativeDropdown).on('click', function (e) {
            if (e.clientX && e.clientY) {
                _this.trigger('dropdown-open');
            }
        });
    };
    DropdownButtonComponent.prototype.blurDropdown = function () {
        this.nativeDropdown.blur();
    };
    return DropdownButtonComponent;
}(EventEmitter));
var UITextareaTagsComponent = (function () {
    function UITextareaTagsComponent(configuration) {
        this.root = document.createElement('div');
        this.root.setAttribute('data-role', 'textarea-tags-component');
        this.textarea = document.createElement('textarea');
        this.textarea.setAttribute('data-role', 'text-container');
        this.textWithHighlightContainer = document.createElement('div');
        this.textWithHighlightContainer.className = 'container';
        var backdrop = document.createElement('div');
        backdrop.className = 'backdrop';
        var highlights = document.createElement('div');
        highlights.className = 'highlights';
        backdrop.appendChild(highlights);
        this.textWithHighlightContainer.appendChild(backdrop);
        this.textWithHighlightContainer.appendChild(this.textarea);
        this.dropdownSection = document.createElement('div');
        this.dropdownSection.setAttribute('data-role', 'dropdown');
        this.root.appendChild(this.textWithHighlightContainer);
        this.root.appendChild(this.dropdownSection);
        this.configuration = configuration || UITextareaTagsComponent.createDefaultConfiguration();
        this.initializeNativeDropdown();
        this.initializeTextarea();
        this.addEventListeners();
    }
    UITextareaTagsComponent.prototype.getRoot = function () {
        return this.root;
    };
    UITextareaTagsComponent.prototype.getValue = function () {
        return this.textarea.value;
    };
    UITextareaTagsComponent.prototype.setValue = function (value) {
        this.textarea.value = value;
        return this;
    };
    UITextareaTagsComponent.prototype.addEventListeners = function () {
        var _this = this;
        this.textarea.addEventListener('input', function () { _this.handleInputOnTextarea(); });
        this.textarea.addEventListener('scroll', function () { _this.handleScrollOnTextarea(); });
    };
    UITextareaTagsComponent.createDefaultConfiguration = function () {
        return {
            createValuesCallback: function () {
                return [
                    {
                        text: "",
                        value: "",
                        type: ETagValueType.TAG
                    }
                ];
            }
        };
    };
    UITextareaTagsComponent.prototype.initializeNativeDropdown = function () {
        var _this = this;
        this.nativeDropdown = document.createElement('select');
        this.dropdownSection.appendChild(this.nativeDropdown);
        if (this.configuration.createValuesCallback) {
            var options = this.configuration.createValuesCallback();
            for (var i = 0, len = options.length; i < len; i++) {
                var option = document.createElement('option');
                option.text = options[i].text || options[i].value;
                option.value = options[i].value;
                this.nativeDropdown.add(option);
            }
            var expanderSign = document.createElement('span');
            expanderSign.className = 'i123-add';
            this.dropdownSection.appendChild(expanderSign);
        }
        this.nativeDropdown.value = null;
        this.nativeDropdown.selectedIndex = -1;
        setTimeout(function () {
            _this.nativeDropdown.value = null;
            _this.nativeDropdown.selectedIndex = -1;
        }, 10);
        this.nativeDropdown.addEventListener('change', function () {
            var selectedOption = _this.nativeDropdown.options[_this.nativeDropdown.selectedIndex];
            var newCaption = selectedOption.value;
            _this.nativeDropdown.value = null;
            _this.nativeDropdown.selectedIndex = -1;
            _this.appendFormInputText(_this.encodeFormInputValue(newCaption));
            _this.handleInputOnTextarea();
            _this.textarea.focus();
        }, true);
        this.nativeDropdown.onmouseover = function () {
            _this.nativeDropdown.value = null;
        };
    };
    UITextareaTagsComponent.prototype.initializeTextarea = function () {
        if (this.configuration.defaultValue) {
            this.textarea.value = this.configuration.defaultValue;
        }
    };
    UITextareaTagsComponent.prototype.appendFormInputText = function (formInput) {
        var text = this.textarea.value;
        text += ' ' + formInput + ' ';
        this.textarea.value = text;
    };
    UITextareaTagsComponent.prototype.encodeFormInputValue = function (formInput) {
        return '[%' + formInput + '%]';
    };
    UITextareaTagsComponent.prototype.handleInputOnTextarea = function () {
        var _this = this;
        var $ = UI.getJQuery();
        var text = this.textarea.value;
        this.textWithHighlightContainer.querySelector('.highlights')
            .innerHTML = this.applyHighlights(text);
        setTimeout(function () {
            _this.textarea.style.cssText = 'height:auto; padding:0';
            var height = _this.textarea.scrollHeight, containerHeight = _this.textarea.scrollHeight + 20;
            $(_this.textWithHighlightContainer).find('.backdrop')[0].style.cssText = 'height:' + height + 'px';
            _this.textWithHighlightContainer.style.cssText = 'height:' + containerHeight + 'px';
            _this.textarea.style.cssText = 'height:' + height + 'px';
        }, 0);
    };
    UITextareaTagsComponent.prototype.applyHighlights = function (text) {
        if (!this.configuration.highlightRegex) {
            return;
        }
        var regex = new RegExp(this.configuration.highlightRegex, 'g');
        return text
            .replace(/\n$/g, '\n\n')
            .replace(regex, '<mark>$&</mark>');
    };
    UITextareaTagsComponent.prototype.handleScrollOnTextarea = function () {
        var $ = UI.getJQuery();
        var scrollTop = $(this.textarea).scrollTop();
        $(this.textWithHighlightContainer.querySelector('.backdrop')).scrollTop(scrollTop);
    };
    UITextareaTagsComponent.prototype.updateTextarea = function () {
        this.handleInputOnTextarea();
    };
    UITextareaTagsComponent.prototype.overwriteDefaultValue = function () {
        this.textarea.value = '';
    };
    return UITextareaTagsComponent;
}());
var ERuleExtraVariable;
(function (ERuleExtraVariable) {
    ERuleExtraVariable["LANGUAGE"] = "language";
    ERuleExtraVariable["COUPON_CODE"] = "couponCode";
    ERuleExtraVariable["QUIZ_SCORE"] = "quizScore";
})(ERuleExtraVariable || (ERuleExtraVariable = {}));
var RuleContainer = (function (_super) {
    __extends(RuleContainer, _super);
    function RuleContainer(divRuleContainer, rulePosition, ruleContainerConfiguration) {
        if (ruleContainerConfiguration === void 0) { ruleContainerConfiguration = {}; }
        var _this = _super.call(this) || this;
        _this.canTrackMetrics = true;
        _this.cloneDivRuleContainer = divRuleContainer;
        _this.rootNode = _this.cloneDivRuleContainer.cloneNode(true);
        _this.rulePosition = rulePosition;
        if (ruleContainerConfiguration.ruleConditionConfigurations && ruleContainerConfiguration.ruleConditionConfigurations.length > 0) {
            _this.ruleConditionConfigurations = __spreadArrays(ruleContainerConfiguration.ruleConditionConfigurations);
        }
        else {
            _this.ruleConditionConfigurations = [];
        }
        if (ruleContainerConfiguration.ruleStatementConfigurations && ruleContainerConfiguration.ruleStatementConfigurations.length > 0) {
            _this.ruleStatementConfigurations = __spreadArrays(ruleContainerConfiguration.ruleStatementConfigurations);
        }
        else {
            _this.ruleStatementConfigurations = [];
        }
        return _this;
    }
    RuleContainer.prototype.getRootNode = function () {
        return this.rootNode;
    };
    Object.defineProperty(RuleContainer.prototype, "getNrOfConditions", {
        get: function () {
            return this.nrOfConditions;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuleContainer.prototype, "getRulePosition", {
        get: function () {
            return this.rulePosition;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuleContainer.prototype, "getIsRuleSelected", {
        get: function () {
            return this.isRuleSelected;
        },
        enumerable: true,
        configurable: true
    });
    RuleContainer.prototype.getRuleConditionList = function () {
        return this.ruleConditionList;
    };
    RuleContainer.prototype.getRuleStatementList = function () {
        return this.ruleStatementList;
    };
    RuleContainer.prototype.getCanTrackMetrics = function () {
        return this.canTrackMetrics;
    };
    RuleContainer.prototype.withI18n = function (i18n) {
        this.i18n = i18n;
        return this;
    };
    RuleContainer.prototype.initialize = function () {
        this.initVars();
        this.initRuleComponent();
        this.initEventListeners();
    };
    RuleContainer.prototype.initVars = function () {
        this.isRuleSelected = false;
        this.ruleConditionList = [];
        this.nrOfConditions = 0;
        this.ruleStatementList = [];
        this.nrOfStatements = 0;
        this.divRuleContent = this.getRootNode().querySelector(RuleContainer.QUERY_SELECTOR_RULE_CONTENT);
        this.ruleDuplicateBtn = this.getRootNode().querySelector(RuleContainer.QUERY_SELECTOR_RULE_DUPLICATE);
        this.ruleDeleteBtn = this.getRootNode().querySelector(RuleContainer.QUERY_SELECTOR_RULE_DELETE);
        this.divRuleCondition = this.divRuleContent.querySelector(RuleContainer.QUERY_SELECTOR_RULE_CONDITION);
        this.divRuleStatement = this.divRuleContent.querySelector(RuleContainer.QUERY_SELECTOR_RULE_STATEMENT);
        this.divRuleContent.removeChild(this.divRuleCondition);
        this.divRuleContent.removeChild(this.divRuleStatement);
    };
    RuleContainer.prototype.initRuleComponent = function () {
        var _this = this;
        var divRulePosition = this.getRootNode()
            .querySelector(RuleContainer.QUERY_SELECTOR_RULE_POSITION);
        divRulePosition.textContent = "#" + this.rulePosition.toString();
        this.getRootNode().setAttribute('data-rule-position', this.rulePosition.toString());
        this.initCustomRuleComponent();
        if (this.ruleConditionConfigurations.length === 0) {
            var ruleConditionConfiguration = {
                variables: this.getRuleConditionConfigVariables(true)
            };
            if (this.rulePosition > 1) {
                ruleConditionConfiguration.selectedVariable = ruleConditionConfiguration.variables[1].value;
            }
            this.ruleConditionConfigurations.push(ruleConditionConfiguration);
        }
        this.ruleConditionConfigurations.forEach(function (ruleConditionConfiguration, index) {
            if (!ruleConditionConfiguration.variables) {
                ruleConditionConfiguration.variables = _this.getRuleConditionConfigVariables(true);
                if (_this.rulePosition > 1) {
                    ruleConditionConfiguration.selectedVariable = ruleConditionConfiguration.variables[1].value;
                }
            }
            _this.nrOfConditions++;
            var ruleCondition = new RuleCondition(_this.nrOfConditions, _this.onConditionVariableChanged.bind(_this), ruleConditionConfiguration)
                .withI18n(_this.i18n);
            _this.ruleConditionList.push(ruleCondition);
            ruleCondition.onConditionAdded = _this.onConditionAdded.bind(_this);
            ruleCondition.onConditionRemoved = _this.onConditionRemoved.bind(_this);
            ruleCondition.onStatementAdded = _this.onStatementAdded.bind(_this);
            ruleCondition.onStatementRemoved = _this.onStatementRemoved.bind(_this);
            ruleCondition.onVariableBeforeChange = _this.onVariableBeforeChange.bind(_this);
            ruleCondition.initialize();
            _this.onConditionVariableChanged(true);
            var divRuleCondition = _this.divRuleCondition.cloneNode(true);
            divRuleCondition.appendChild(ruleCondition.getRootNode());
            _this.divRuleContent.appendChild(divRuleCondition);
            ruleCondition.on('count-email-rules-not-supported', function () {
                _this.trigger('count-email-rules-not-supported');
            });
            ruleCondition.updateOptionVisibility(ERulesOptionsVisibilityState.NONE);
            if (_this.ruleStatementConfigurations[index]) {
                ruleCondition.addStatement(_this.ruleStatementConfigurations[index]);
            }
        });
        this.updateRuleConditionOptions();
        if (this.getRuleConditionList()[0].getVariables().length === 1
            && this.getRuleConditionList()[0].getVariable().skipConditions) {
            this.ruleDuplicateBtn.style.pointerEvents = 'none';
            this.ruleDuplicateBtn.style.color = 'rgba(170, 170, 170, 0.5)';
        }
    };
    RuleContainer.prototype.initCustomRuleComponent = function () {
    };
    RuleContainer.prototype.initEventListeners = function () {
        var _this = this;
        if (!MouseUtils.isMobile()) {
            this.getRootNode().onmouseenter = function () {
                _this.divRuleContent.setAttribute('data-role-hover', 'rule-content');
                [_this.ruleDuplicateBtn, _this.ruleDeleteBtn].forEach(function (ruleBtn) {
                    ruleBtn.style.display = 'block';
                });
            };
            this.getRootNode().onmouseleave = function () {
                _this.divRuleContent.removeAttribute('data-role-hover');
                [_this.ruleDuplicateBtn, _this.ruleDeleteBtn].forEach(function (ruleBtn) {
                    ruleBtn.style.display = 'none';
                });
            };
        }
        else {
            this.ruleDuplicateBtn.ontouchend = this.ruleDuplicateBtn.ontouchcancel = function () {
                setTimeout(function () {
                    _this.ruleDuplicateBtn.classList.remove('ruleHasHover');
                }, 300);
            };
            this.ruleDuplicateBtn.ontouchstart = function () {
                _this.ruleDuplicateBtn.classList.add('ruleHasHover');
            };
        }
        this.ruleDuplicateBtn.onclick = function (event) {
            event.stopPropagation();
            _this.onDuplicateBtnClick();
        };
        this.ruleDeleteBtn.onclick = function (event) {
            event.stopPropagation();
            _this.deleteRule();
        };
    };
    RuleContainer.prototype.onDuplicateBtnClick = function () {
        this.duplicateRule();
    };
    RuleContainer.prototype.getRuleConditionConfigVariables = function (withAllSubmissions) {
        return [
            {
                value: 'test',
                text: 'Test',
                type: ERuleConditionVariableType.DEFAULT
            }
        ];
    };
    RuleContainer.prototype.getRuleContainerInstance = function (ruleConditionConfigurations, ruleStatementConfigurations) {
        return new RuleContainer(this.cloneDivRuleContainer, this.rulePosition, {
            ruleConditionConfigurations: ruleConditionConfigurations,
            ruleStatementConfigurations: ruleStatementConfigurations
        })
            .withI18n(this.i18n);
    };
    RuleContainer.prototype.onConditionVariableChanged = function (allSubmissionsSelected) {
        if (this.onRuleConditionVariableChanged) {
            this.onRuleConditionVariableChanged(!allSubmissionsSelected, this.getRulePosition);
        }
        this.updateRuleConditionOptions();
    };
    RuleContainer.prototype.onConditionAdded = function (addedCondition) {
        this.nrOfConditions++;
        var divRuleCondition = this.divRuleCondition.cloneNode(true);
        divRuleCondition.appendChild(addedCondition.getRootNode());
        if (addedCondition.getConditionPosition === this.nrOfConditions) {
            this.divRuleContent.appendChild(divRuleCondition);
            this.ruleConditionList.push(addedCondition);
        }
        else {
            this.divRuleContent.insertBefore(divRuleCondition, this.ruleStatementList[addedCondition.getConditionPosition - 1].getRootNode().parentElement);
            this.ruleConditionList.splice(addedCondition.getConditionPosition - 1, 0, addedCondition);
        }
        this.updateConditionsPosition();
        if (this.nrOfConditions === 2 && this.ruleConditionList[0].getVariables()[0].skipConditions) {
            this.updateRuleConditionVariables(false);
        }
        this.updateRuleConditionOptions();
    };
    RuleContainer.prototype.onConditionRemoved = function (removedCondition) {
        this.nrOfConditions--;
        this.divRuleContent.removeChild(removedCondition.getRootNode().parentElement);
        this.ruleConditionList.splice(removedCondition.getConditionPosition - 1, 1);
        this.updateConditionsPosition();
        if (this.nrOfConditions === 1) {
            this.ruleConditionList[0].onVariableChanged(false);
        }
        this.updateRuleConditionOptions();
    };
    RuleContainer.prototype.onStatementAdded = function (addedStatement) {
        this.nrOfStatements++;
        var divRuleStatement = this.divRuleStatement.cloneNode(true);
        divRuleStatement.appendChild(addedStatement.getRootNode());
        if (addedStatement.getStatementPosition === this.nrOfStatements) {
            this.divRuleContent.appendChild(divRuleStatement);
            this.ruleStatementList.push(addedStatement);
        }
        else {
            this.divRuleContent.insertBefore(divRuleStatement, this.ruleStatementList[addedStatement.getStatementPosition - 1].getRootNode().parentElement);
            this.ruleStatementList.splice(addedStatement.getStatementPosition - 1, 0, addedStatement);
        }
        this.updateStatementsPosition();
        if (this.onStatementChanged) {
            this.onStatementChanged();
        }
    };
    RuleContainer.prototype.onStatementRemoved = function (position) {
        this.nrOfStatements--;
        this.divRuleContent.removeChild(this.ruleStatementList[position].getRootNode().parentElement);
        this.ruleStatementList.splice(position, 1);
        this.updateStatementsPosition();
        if (this.onStatementChanged) {
            this.onStatementChanged();
        }
    };
    RuleContainer.prototype.updateRuleConditionOptions = function () {
        if (this.ruleConditionList[0].getVariable().skipConditions) {
            this.ruleConditionList[0].setCanAddCondition = false;
            this.ruleConditionList[0].setCanRemoveCondition = false;
        }
        else {
            for (var i = 0; i < this.nrOfConditions; i++) {
                if (this.nrOfConditions < 2) {
                    this.ruleConditionList[i].setCanAddCondition = true;
                    this.ruleConditionList[i].setCanRemoveCondition = false;
                }
                else if (this.nrOfConditions < RuleCondition.MAX_NR_OF_CONDITIONS) {
                    this.ruleConditionList[i].setCanAddCondition = true;
                    this.ruleConditionList[i].setCanRemoveCondition = true;
                }
                else {
                    this.ruleConditionList[i].setCanAddCondition = false;
                    this.ruleConditionList[i].setCanRemoveCondition = true;
                }
                if (MouseUtils.isMobile()) {
                    this.ruleConditionList[i].autoUpdateOptionVisibility();
                }
            }
        }
        if (!MouseUtils.isMobile()) {
            if (this.nrOfConditions < RuleCondition.MAX_NR_OF_CONDITIONS) {
                this.ruleConditionList[this.nrOfConditions - 1].autoUpdateOptionVisibility();
            }
            else {
                this.ruleConditionList[this.nrOfConditions - 1].updateOptionVisibility(ERulesOptionsVisibilityState.NONE);
            }
        }
    };
    RuleContainer.prototype.updateConditionsPosition = function () {
        for (var i = 0; i < this.nrOfConditions; i++) {
            this.ruleConditionList[i].updateConditionPosition(i + 1);
        }
    };
    RuleContainer.prototype.updateStatementsPosition = function () {
        for (var i = 0; i < this.nrOfStatements; i++) {
            this.ruleStatementList[i].updateStatementPosition(i + 1);
        }
    };
    RuleContainer.prototype.getRuleConditionAt = function (index) {
        return this.ruleConditionList[index];
    };
    RuleContainer.prototype.updateRuleConditionVariables = function (addAllSubmissions) {
        this.ruleConditionList[0].updateVariables(this.getRuleConditionConfigVariables(addAllSubmissions));
    };
    RuleContainer.prototype.updateRulePosition = function (rulePosition) {
        this.rulePosition = rulePosition;
        var divRulePosition = this.getRootNode()
            .querySelector(RuleContainer.QUERY_SELECTOR_RULE_POSITION);
        divRulePosition.textContent = "#" + this.rulePosition.toString();
        this.getRootNode().setAttribute('data-rule-position', this.rulePosition.toString());
    };
    RuleContainer.prototype.selectRule = function () {
        if (!this.isRuleSelected) {
            this.divRuleContent.classList.add('ruleContentSelected');
            this.isRuleSelected = true;
            if (this.onRuleSelected) {
                this.onRuleSelected(this);
            }
        }
    };
    RuleContainer.prototype.deselectRule = function () {
        if (this.isRuleSelected) {
            this.divRuleContent.classList.remove('ruleContentSelected');
            this.isRuleSelected = false;
            if (this.onRuleDeselected) {
                this.onRuleDeselected(this);
            }
        }
    };
    RuleContainer.prototype.duplicateRule = function (canTrackMetrics) {
        if (canTrackMetrics === void 0) { canTrackMetrics = true; }
        this.canTrackMetrics = canTrackMetrics;
        var ruleConditionConfigurations = [];
        this.ruleConditionList.forEach(function (ruleCondition) {
            var selectedVariable = ruleCondition.getVariable().skipConditions
                ? ruleCondition.getVariables()[1].value
                : ruleCondition.getSelectedVariable();
            var selectedOperator = ruleCondition.getVariable().skipConditions
                ? null
                : ruleCondition.getSelectedOperator();
            var selectedValue = ruleCondition.getVariable().skipConditions
                ? null
                : ruleCondition.getSelectedValue();
            ruleConditionConfigurations.push({
                variables: ruleCondition.getVariables(),
                selectedVariable: selectedVariable,
                selectedOperator: selectedOperator,
                selectedValue: selectedValue
            });
        });
        var ruleStatementConfigurations = [];
        this.ruleStatementList.forEach(function (ruleStatement) {
            ruleStatementConfigurations.push({
                selectedStatement: ruleStatement.getSelectedStatement()
            });
        });
        var ruleContainer = this.getRuleContainerInstance(ruleConditionConfigurations, ruleStatementConfigurations);
        ruleContainer.initialize();
        ruleContainer.onRuleConditionVariableChanged = this.onRuleConditionVariableChanged;
        ruleContainer.onRuleSelected = this.onRuleSelected;
        ruleContainer.onRuleDeselected = this.onRuleDeselected;
        ruleContainer.onDeselectAllRules = this.onDeselectAllRules;
        ruleContainer.onRuleDuplicated = this.onRuleDuplicated;
        ruleContainer.onRuleDeleted = this.onRuleDeleted;
        ruleContainer.onStatementChanged = this.onStatementChanged;
        this.deselectRule();
        if (this.onRuleDuplicated) {
            this.onRuleDuplicated(ruleContainer);
        }
        this.onConditionVariableChanged(true);
    };
    RuleContainer.prototype.deleteRule = function (canTrackMetrics) {
        if (canTrackMetrics === void 0) { canTrackMetrics = true; }
        this.canTrackMetrics = canTrackMetrics;
        this.deselectRule();
        if (this.onRuleDeleted) {
            this.onRuleDeleted(this);
        }
        this.onConditionVariableChanged(false);
    };
    RuleContainer.prototype.onVariableBeforeChange = function () {
        return true;
    };
    RuleContainer.RULE_ALLOWED_CONTROL_TYPES = [
        ElementTypes.CONTROL_TYPE_TEXT,
        ElementTypes.CONTROL_TYPE_TEXTAREA,
        ElementTypes.CONTROL_TYPE_DROPDOWN,
        ElementTypes.CONTROL_TYPE_RADIO,
        ElementTypes.CONTROL_TYPE_CHECKBOX,
        ElementTypes.CONTROL_TYPE_NUMBER,
        ElementTypes.CONTROL_TYPE_FORMULA,
        ElementTypes.CONTROL_TYPE_EMAIL,
        ElementTypes.CONTROL_TYPE_LIKERT_SCALE,
        ElementTypes.CONTROL_TYPE_NAME,
        ElementTypes.CONTROL_TYPE_ADDRESS,
        ElementTypes.CONTROL_TYPE_PHONE,
        ElementTypes.CONTROL_TYPE_DATE,
        ElementTypes.CONTROL_TYPE_TIME,
        ElementTypes.CONTROL_TYPE_PRICE,
        ElementTypes.CONTROL_TYPE_WEBSITE,
        ElementTypes.CONTROL_TYPE_PASSWORD,
        ElementTypes.CONTROL_TYPE_STAR_RATING,
        ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
        ElementTypes.CONTROL_TYPE_COUPON
    ];
    RuleContainer.RULE_EXTRA_VARIABLES = [
        ERuleExtraVariable.LANGUAGE,
        ERuleExtraVariable.COUPON_CODE,
        ERuleExtraVariable.QUIZ_SCORE
    ];
    RuleContainer.RULE_ALLOWED_EXTRA = [
        EVariableIdentifier.LANGUAGE,
        EVariableIdentifier.PAYMENT_COUPON,
        EVariableIdentifier.QUIZ_SCORE
    ];
    RuleContainer.QUERY_SELECTOR_RULE_CONTENT = 'div[data-role="rule-content"]';
    RuleContainer.QUERY_SELECTOR_RULE_POSITION = 'div[data-role="rule-position"]';
    RuleContainer.QUERY_SELECTOR_RULE_DUPLICATE = 'div[data-role="rule-duplicate"]';
    RuleContainer.QUERY_SELECTOR_RULE_DELETE = 'div[data-role="rule-delete"]';
    RuleContainer.QUERY_SELECTOR_RULE_CONDITION = 'div[data-role="placeholder"][data-control-name="rule-condition"]';
    RuleContainer.QUERY_SELECTOR_RULE_STATEMENT = 'div[data-role="placeholder"][data-control-name="rule-statement"]';
    return RuleContainer;
}(EventEmitter));
var ERuleConditionOperator;
(function (ERuleConditionOperator) {
    ERuleConditionOperator[ERuleConditionOperator["IS"] = 0] = "IS";
    ERuleConditionOperator[ERuleConditionOperator["IS_NOT"] = 1] = "IS_NOT";
    ERuleConditionOperator[ERuleConditionOperator["CONTAINS"] = 2] = "CONTAINS";
    ERuleConditionOperator[ERuleConditionOperator["DOES_NOT_CONTAIN"] = 3] = "DOES_NOT_CONTAIN";
    ERuleConditionOperator[ERuleConditionOperator["BEGINS_WITH"] = 4] = "BEGINS_WITH";
    ERuleConditionOperator[ERuleConditionOperator["ENDS_WITH"] = 5] = "ENDS_WITH";
    ERuleConditionOperator[ERuleConditionOperator["IS_GREATER_THAN"] = 6] = "IS_GREATER_THAN";
    ERuleConditionOperator[ERuleConditionOperator["IS_LESS_THAN"] = 7] = "IS_LESS_THAN";
    ERuleConditionOperator[ERuleConditionOperator["IS_CHECKED"] = 8] = "IS_CHECKED";
    ERuleConditionOperator[ERuleConditionOperator["IS_NOT_CHECKED"] = 9] = "IS_NOT_CHECKED";
    ERuleConditionOperator[ERuleConditionOperator["IS_SELECTED"] = 10] = "IS_SELECTED";
    ERuleConditionOperator[ERuleConditionOperator["IS_NOT_SELECTED"] = 11] = "IS_NOT_SELECTED";
})(ERuleConditionOperator || (ERuleConditionOperator = {}));
var ERuleConditionLogicalType;
(function (ERuleConditionLogicalType) {
    ERuleConditionLogicalType[ERuleConditionLogicalType["is"] = 0] = "is";
    ERuleConditionLogicalType[ERuleConditionLogicalType["is_not"] = 1] = "is_not";
    ERuleConditionLogicalType[ERuleConditionLogicalType["contains"] = 2] = "contains";
    ERuleConditionLogicalType[ERuleConditionLogicalType["does_not_contain"] = 3] = "does_not_contain";
    ERuleConditionLogicalType[ERuleConditionLogicalType["begins_with"] = 4] = "begins_with";
    ERuleConditionLogicalType[ERuleConditionLogicalType["ends_with"] = 5] = "ends_with";
    ERuleConditionLogicalType[ERuleConditionLogicalType["is_greater_than"] = 6] = "is_greater_than";
    ERuleConditionLogicalType[ERuleConditionLogicalType["is_less_than"] = 7] = "is_less_than";
    ERuleConditionLogicalType[ERuleConditionLogicalType["is_checked"] = 8] = "is_checked";
    ERuleConditionLogicalType[ERuleConditionLogicalType["is_not_checked"] = 9] = "is_not_checked";
    ERuleConditionLogicalType[ERuleConditionLogicalType["is_selected"] = 10] = "is_selected";
    ERuleConditionLogicalType[ERuleConditionLogicalType["is_not_selected"] = 11] = "is_not_selected";
})(ERuleConditionLogicalType || (ERuleConditionLogicalType = {}));
var ERuleConditionVariableType;
(function (ERuleConditionVariableType) {
    ERuleConditionVariableType[ERuleConditionVariableType["DEFAULT"] = 0] = "DEFAULT";
    ERuleConditionVariableType[ERuleConditionVariableType["CHECKABLE"] = 1] = "CHECKABLE";
    ERuleConditionVariableType[ERuleConditionVariableType["SELECTABLE"] = 2] = "SELECTABLE";
    ERuleConditionVariableType[ERuleConditionVariableType["COMPARABLE"] = 3] = "COMPARABLE";
    ERuleConditionVariableType[ERuleConditionVariableType["MISSING"] = 4] = "MISSING";
})(ERuleConditionVariableType || (ERuleConditionVariableType = {}));
var RuleCondition = (function (_super) {
    __extends(RuleCondition, _super);
    function RuleCondition(conditionPosition, onVariableChangedCallback, configuration) {
        var _this = _super.call(this) || this;
        _this.conditionPosition = conditionPosition;
        _this.onVariableChanged = onVariableChangedCallback;
        _this.CONFIGURATION = __assign(__assign({}, RuleCondition.createDefaultConfiguration()), configuration);
        _this.variableValueToConfigurationMap = {};
        _this.canAddCondition = false;
        _this.canRemoveCondition = false;
        _this.rootNode = document.createElement('div');
        _this.variableNode = document.createElement('div');
        _this.operatorNode = document.createElement('div');
        _this.valueNode = document.createElement('div');
        _this.optionNode = document.createElement('div');
        _this.variableComponent = new InspectorDropdownComponent();
        _this.operatorComponent = new InspectorDropdownComponent();
        _this.valueComponent = new InspectorDropdownComponent();
        _this.valueInput = document.createElement('input');
        _this.variableNode.setAttribute('data-role', 'rules-condition-variable');
        _this.variableNode.onclick = function (event) {
            event.stopPropagation();
        };
        _this.variableNode.appendChild(_this.variableComponent.getRoot());
        _this.operatorNode.setAttribute('data-role', 'rules-condition-operator');
        _this.operatorNode.onclick = function (event) {
            event.stopPropagation();
        };
        _this.operatorNode.appendChild(_this.operatorComponent.getRoot());
        _this.valueNode.setAttribute('data-role', 'rules-condition-value');
        _this.valueNode.onclick = function (event) {
            event.stopPropagation();
        };
        _this.valueNode.appendChild(_this.valueComponent.getRoot());
        _this.valueNode.appendChild(_this.valueInput);
        _this.optionNode.setAttribute('data-role', 'rules-condition-option');
        var i123Remove = document.createElement('span');
        i123Remove.setAttribute('class', 'i123-close');
        i123Remove.setAttribute('data-role', 'rules-condition-remove');
        i123Remove.setAttribute('title', FormUtils.getUiTranslatedString('notifications_tooltip_remove_condition', 'Remove condition'));
        i123Remove.onclick = function (event) {
            event.stopPropagation();
            _this.removeCondition();
        };
        var i123Add = document.createElement('span');
        i123Add.setAttribute('class', 'i123-add');
        i123Add.setAttribute('data-role', 'rules-condition-add');
        i123Add.setAttribute('title', FormUtils.getUiTranslatedString('notifications_tooltip_add_condition', 'Add condition'));
        i123Add.onclick = function (event) {
            event.stopPropagation();
            _this.addCondition();
        };
        _this.optionNode.appendChild(i123Remove);
        _this.optionNode.appendChild(i123Add);
        _this.updateOptionVisibility(ERulesOptionsVisibilityState.NONE, true);
        _this.getRootNode().setAttribute('data-role', 'rules-condition');
        _this.getRootNode().appendChild(_this.variableNode);
        _this.getRootNode().appendChild(_this.operatorNode);
        _this.getRootNode().appendChild(_this.valueNode);
        _this.getRootNode().appendChild(_this.optionNode);
        return _this;
    }
    Object.defineProperty(RuleCondition.prototype, "setCanAddCondition", {
        set: function (value) {
            this.canAddCondition = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuleCondition.prototype, "setCanRemoveCondition", {
        set: function (value) {
            this.canRemoveCondition = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuleCondition.prototype, "getConditionPosition", {
        get: function () {
            return this.conditionPosition;
        },
        enumerable: true,
        configurable: true
    });
    RuleCondition.prototype.withI18n = function (i18n) {
        this.i18n = i18n;
        return this;
    };
    RuleCondition.prototype.getRootNode = function () {
        return this.rootNode;
    };
    RuleCondition.prototype.initialize = function () {
        var _this = this;
        this.updateVariableComponentOptions();
        var updateVariableStatus = function () {
            var variable = _this.getVariable();
            if (variable.type === ERuleConditionVariableType.MISSING) {
                _this.variableNode.setAttribute('data-missing', 'true');
            }
            else {
                _this.variableNode.removeAttribute('data-missing');
            }
            if (variable.skipConditions) {
                _this.getRootNode().setAttribute('data-skip', 'operator');
            }
            else if (variable.type === ERuleConditionVariableType.CHECKABLE
                || variable.type === ERuleConditionVariableType.SELECTABLE) {
                _this.getRootNode().setAttribute('data-skip', 'value');
            }
            else {
                _this.getRootNode().setAttribute('data-skip', '');
            }
        };
        var oldIndex = this.variableComponent.getSelectedIndex();
        this.variableComponent.getRoot().addEventListener('focus', function () {
            oldIndex = _this.variableComponent.getSelectedIndex();
        });
        this.variableComponent.getRoot().addEventListener('change', function () {
            if (_this.onVariableBeforeChange) {
                if (!_this.onVariableBeforeChange()) {
                    _this.variableComponent.setSelectedIndex(oldIndex);
                    _this.trigger('count-email-rules-not-supported');
                    return;
                }
            }
            else {
                throw new Error('onVariableBeforeChange must be assigned!');
            }
            updateVariableStatus();
            _this.updateOperator() && _this.updateValue();
            var variable = _this.getVariable();
            var canUpdateVariables = (_this.lastSelectedVariable.value !== variable.value && variable.skipConditions) ||
                (_this.lastSelectedVariable.skipConditions && _this.lastSelectedVariable.value !== variable.value);
            if (_this.onVariableChanged && canUpdateVariables) {
                _this.onVariableChanged(variable.skipConditions);
            }
            if (!variable.skipConditions && _this.conditionPosition === 1) {
                _this.autoUpdateOptionVisibility();
            }
            _this.lastSelectedVariable = variable;
        });
        this.operatorComponent.getRoot().addEventListener('change', function () {
            _this.updateValue(true);
        });
        this.valueComponent.getRoot().addEventListener('change', function () {
            if (_this.valueNode.hasAttribute('data-missing')) {
                _this.valueNode.removeAttribute('data-missing');
            }
        });
        updateVariableStatus();
        if (this.updateOperator()) {
            var selectedOperator = this.CONFIGURATION.selectedOperator;
            if (selectedOperator !== null) {
                this.operatorComponent.setValue(String(selectedOperator));
            }
            if (this.updateValue()) {
                var selectedValue = this.CONFIGURATION.selectedValue;
                if (selectedValue !== null) {
                    if (this.getValueType() === RuleCondition.VALUE_TYPE_SELECT) {
                        if (this.valueComponent.getValues().indexOf(selectedValue) !== -1) {
                            this.valueComponent.setValue(selectedValue);
                        }
                        else if (this.valueComponent.getTexts().indexOf(selectedValue) !== -1) {
                            this.valueComponent.setValueByText(selectedValue);
                        }
                        else {
                            this.valueComponent.addOption({
                                value: selectedValue,
                                text: this.i18n.translateText('payments_deletedField'),
                                isSeparator: true,
                                hidden: true
                            });
                            this.valueComponent.setValue(selectedValue);
                            this.valueNode.setAttribute('data-missing', 'true');
                        }
                    }
                    else {
                        this.valueInput.value = selectedValue;
                    }
                }
            }
        }
        this.initEventListeners();
        this.lastSelectedVariable = this.getVariable();
    };
    RuleCondition.prototype.initEventListeners = function () {
        var _this = this;
        if (!MouseUtils.isMobile()) {
            var isOptionHidden_1 = false;
            this.getRootNode().onmouseenter = function () {
                if (!_this.getVariable().skipConditions) {
                    isOptionHidden_1 = _this.getRootNode().getAttribute('data-option-type') === 'none';
                    if (isOptionHidden_1) {
                        _this.autoUpdateOptionVisibility();
                    }
                }
            };
            this.getRootNode().onmouseleave = function () {
                if (isOptionHidden_1 && !_this.getVariable().skipConditions) {
                    _this.updateOptionVisibility(ERulesOptionsVisibilityState.NONE);
                }
            };
        }
    };
    RuleCondition.prototype.getOperator = function () {
        return parseInt(this.operatorComponent.getValue(), 10);
    };
    RuleCondition.prototype.getValue = function () {
        return this.getValueType() === RuleCondition.VALUE_TYPE_SELECT
            ? this.valueComponent.getValue()
            : this.valueInput.value;
    };
    RuleCondition.prototype.getValueType = function () {
        return parseInt(this.getRootNode().getAttribute('data-value-type'), 10);
    };
    RuleCondition.prototype.setValueType = function (type) {
        this.getRootNode().setAttribute('data-value-type', String(type));
    };
    RuleCondition.prototype.updateOperator = function () {
        var _this = this;
        if (this.getRootNode().getAttribute('data-skip') === 'operator') {
            return false;
        }
        var variable = this.getVariable();
        var options = [];
        var translate = function (label) { return _this.i18n.translateText(label); };
        switch (variable.type) {
            case ERuleConditionVariableType.CHECKABLE:
                options = [
                    { value: ERuleConditionOperator.IS_CHECKED, text: translate('notifications_ROPischecked') },
                    { value: ERuleConditionOperator.IS_NOT_CHECKED, text: translate('notifications_ROPisnotchecked') }
                ];
                break;
            case ERuleConditionVariableType.SELECTABLE:
                options = [
                    { value: ERuleConditionOperator.IS_SELECTED, text: translate('notifications_ROPisselected') },
                    { value: ERuleConditionOperator.IS_NOT_SELECTED, text: translate('notifications_ROPisnotselected') }
                ];
                break;
            case ERuleConditionVariableType.COMPARABLE:
                options = [
                    { value: ERuleConditionOperator.IS, text: translate('notifications_ROPis') },
                    { value: ERuleConditionOperator.IS_GREATER_THAN, text: translate('reports_rulesGreaterThan') },
                    { value: ERuleConditionOperator.IS_LESS_THAN, text: translate('reports_rulesLessThan') }
                ];
                break;
            default:
                options = [
                    { value: ERuleConditionOperator.IS, text: translate('notifications_ROPis') },
                    { value: ERuleConditionOperator.IS_NOT, text: translate('notifications_ROPisnot') },
                    { value: ERuleConditionOperator.CONTAINS, text: translate('notifications_ROPcontains') },
                    {
                        value: ERuleConditionOperator.DOES_NOT_CONTAIN,
                        text: translate('notifications_ROPdoesntcontain')
                    },
                    { value: ERuleConditionOperator.BEGINS_WITH, text: translate('notifications_ROPbeginswith') },
                    { value: ERuleConditionOperator.ENDS_WITH, text: translate('notifications_ROPendswith') },
                    { value: ERuleConditionOperator.IS_GREATER_THAN, text: translate('reports_rulesGreaterThan') },
                    { value: ERuleConditionOperator.IS_LESS_THAN, text: translate('reports_rulesLessThan') }
                ];
        }
        this.operatorComponent.setOptions(options);
        return true;
    };
    RuleCondition.prototype.updateValue = function (keepValueState) {
        var _this = this;
        if (keepValueState === void 0) { keepValueState = false; }
        if (this.getRootNode().getAttribute('data-skip') !== '') {
            return false;
        }
        var variable = this.getVariable();
        var operator = this.getOperator();
        var valueType = this.getValueType();
        if (variable.values) {
            if (!keepValueState) {
                if (valueType !== RuleCondition.VALUE_TYPE_SELECT) {
                    this.setValueType(RuleCondition.VALUE_TYPE_SELECT);
                }
                this.valueComponent.clear();
                this.valueInput.value = '';
                variable.values.forEach(function (value, index) {
                    _this.valueComponent.addOption({
                        value: index,
                        text: value,
                        isDefault: index === 0
                    });
                });
            }
            else {
                if (operator !== ERuleConditionOperator.IS
                    && operator !== ERuleConditionOperator.IS_NOT) {
                    if (valueType !== RuleCondition.VALUE_TYPE_INPUT) {
                        this.setValueType(RuleCondition.VALUE_TYPE_INPUT);
                    }
                }
                else {
                    if (valueType !== RuleCondition.VALUE_TYPE_SELECT) {
                        this.setValueType(RuleCondition.VALUE_TYPE_SELECT);
                    }
                }
            }
        }
        else {
            if (!keepValueState) {
                if (valueType !== RuleCondition.VALUE_TYPE_INPUT) {
                    this.setValueType(RuleCondition.VALUE_TYPE_INPUT);
                }
                this.valueInput.placeholder = variable.placeholder || '';
                this.valueInput.value = '';
            }
        }
        return true;
    };
    RuleCondition.createDefaultConfiguration = function () {
        return {
            variables: [],
            selectedVariable: null,
            selectedOperator: null,
            selectedValue: null
        };
    };
    RuleCondition.prototype.selectedVariableHasGroup = function () {
        return this.variableValueToConfigurationMap[this.getSelectedVariable()].group != undefined;
    };
    RuleCondition.prototype.isSelectedVariableControlTypeOf = function (controlType) {
        return this.getVariable().controlType && this.getVariable().controlType === controlType;
    };
    RuleCondition.prototype.updateVariableComponentOptions = function () {
        var _this = this;
        this.variableComponent.clear();
        var createdGroups = {};
        this.CONFIGURATION.variables.forEach(function (variable) {
            if (variable.group) {
                if (typeof createdGroups[variable.group.id] === 'undefined') {
                    createdGroups[variable.group.id] = true;
                    _this.variableComponent.addGroup(variable.group.id, variable.group.name);
                }
                _this.variableComponent.addOption({
                    value: variable.value,
                    text: variable.text
                }, null, variable.group.id);
            }
            else {
                _this.variableComponent.addOption({
                    value: variable.value,
                    text: variable.text
                });
            }
            _this.variableValueToConfigurationMap[variable.value] = variable;
        });
        var selectedVariable = this.CONFIGURATION.selectedVariable;
        if (selectedVariable !== null) {
            if (this.variableValueToConfigurationMap.hasOwnProperty(selectedVariable)) {
                if (this.variableComponent.getOptionByValue(selectedVariable)) {
                    this.variableComponent.setValue(selectedVariable);
                }
                else {
                    this.variableComponent.addOption({
                        value: this.variableValueToConfigurationMap[selectedVariable].value,
                        text: this.variableValueToConfigurationMap[selectedVariable].text,
                        isSeparator: true
                    });
                    this.variableComponent.setValue(this.variableValueToConfigurationMap[selectedVariable].value);
                }
            }
            else {
                var missingVariable = {
                    value: selectedVariable,
                    text: this.i18n.translateText('payments_deletedField'),
                    type: ERuleConditionVariableType.MISSING
                };
                this.variableValueToConfigurationMap[missingVariable.value] = missingVariable;
                this.variableComponent.addOption({
                    value: missingVariable.value,
                    text: missingVariable.text,
                    isSeparator: true
                });
                this.variableComponent.setValue(missingVariable.value);
            }
        }
    };
    RuleCondition.prototype.getVariable = function () {
        return this.variableValueToConfigurationMap[this.getSelectedVariable()];
    };
    RuleCondition.prototype.getVariables = function () {
        return this.CONFIGURATION.variables;
    };
    RuleCondition.prototype.getSelectedVariable = function () {
        return this.variableComponent.getValue();
    };
    RuleCondition.prototype.getSelectedGroup = function () {
        if (this.selectedVariableHasGroup()) {
            return this.variableValueToConfigurationMap[this.getSelectedVariable()].group.id;
        }
        return '';
    };
    RuleCondition.prototype.getSelectedVariableControlType = function () {
        return this.getVariable().controlType;
    };
    RuleCondition.prototype.isSelectedVariableAnyControlTypeOf = function (controlTypes) {
        for (var i = 0, n = controlTypes.length; i < n; i++) {
            if (this.isSelectedVariableControlTypeOf(controlTypes[i])) {
                return true;
            }
        }
        return false;
    };
    RuleCondition.prototype.getNotificationSelectedVariable = function () {
        if (this.variableValueToConfigurationMap[this.getSelectedVariable()].value === this.getSelectedVariable()) {
            return this.variableValueToConfigurationMap[this.getSelectedVariable()].text;
        }
        else {
            return this.getSelectedValue();
        }
    };
    RuleCondition.prototype.getNotificationSelectedValue = function () {
        if (this.getValueType() === RuleCondition.VALUE_TYPE_SELECT) {
            return this.valueComponent.getText();
        }
        else {
            return this.getSelectedValue();
        }
    };
    RuleCondition.prototype.updateVariables = function (newVariables) {
        this.CONFIGURATION.variables = newVariables;
        this.updateVariableComponentOptions();
    };
    RuleCondition.prototype.getSelectedOperator = function () {
        return this.getOperator();
    };
    RuleCondition.prototype.getSelectedValue = function () {
        return this.getValue();
    };
    RuleCondition.prototype.updateConditionPosition = function (conditionPosition) {
        this.conditionPosition = conditionPosition;
    };
    RuleCondition.prototype.addCondition = function () {
        if (this.canAddCondition) {
            if (!MouseUtils.isMobile()) {
                this.updateOptionVisibility(ERulesOptionsVisibilityState.NONE);
            }
            this.addStatement();
            var newVariables = this.getVariables().filter(function (value) { return !value.skipConditions; });
            var selVarIndex = this.conditionPosition < newVariables.length
                ? this.conditionPosition
                : newVariables.length - 1;
            var ruleCondition = new RuleCondition(this.conditionPosition + 1, this.onVariableChanged, {
                variables: newVariables,
                selectedVariable: newVariables[selVarIndex].value,
                selectedOperator: null,
                selectedValue: null
            })
                .withI18n(this.i18n);
            ruleCondition.onConditionAdded = this.onConditionAdded;
            ruleCondition.onConditionRemoved = this.onConditionRemoved;
            ruleCondition.onStatementAdded = this.onStatementAdded;
            ruleCondition.onStatementRemoved = this.onStatementRemoved;
            ruleCondition.onVariableBeforeChange = this.onVariableBeforeChange;
            ruleCondition.initialize();
            if (this.onConditionAdded) {
                this.onConditionAdded(ruleCondition);
            }
            if (MouseUtils.isMobile()) {
                this.autoUpdateOptionVisibility();
            }
        }
    };
    RuleCondition.prototype.removeCondition = function () {
        if (this.canRemoveCondition) {
            if (!MouseUtils.isMobile()) {
                this.updateOptionVisibility(ERulesOptionsVisibilityState.NONE);
            }
            this.removeStatement();
            if (this.onConditionRemoved) {
                this.onConditionRemoved(this);
            }
            if (MouseUtils.isMobile()) {
                this.autoUpdateOptionVisibility();
            }
        }
    };
    RuleCondition.prototype.autoUpdateOptionVisibility = function () {
        if (this.canAddCondition && this.canRemoveCondition) {
            this.updateOptionVisibility(ERulesOptionsVisibilityState.BOTH);
        }
        else if (this.canAddCondition) {
            this.updateOptionVisibility(ERulesOptionsVisibilityState.ADD);
        }
        else if (this.canRemoveCondition) {
            this.updateOptionVisibility(ERulesOptionsVisibilityState.REMOVE);
        }
        else {
            this.updateOptionVisibility(ERulesOptionsVisibilityState.NONE, true);
        }
    };
    RuleCondition.prototype.updateOptionVisibility = function (type, forceUpdate) {
        if (forceUpdate === void 0) { forceUpdate = false; }
        if (!forceUpdate && MouseUtils.isMobile() && type === ERulesOptionsVisibilityState.NONE) {
            return;
        }
        this.getRootNode().setAttribute('data-option-type', type);
    };
    RuleCondition.prototype.addStatement = function (configuration) {
        var ruleStatement = new RuleStatement(this.conditionPosition, configuration)
            .withI18n(this.i18n);
        ruleStatement.initialize();
        if (this.onStatementAdded) {
            this.onStatementAdded(ruleStatement);
        }
    };
    RuleCondition.prototype.removeStatement = function () {
        if (this.onStatementRemoved) {
            var position = this.getConditionPosition > 1
                ? this.getConditionPosition - 2
                : 0;
            this.onStatementRemoved(position);
        }
    };
    RuleCondition.MAX_NR_OF_CONDITIONS = 10;
    RuleCondition.VALUE_TYPE_INPUT = 1;
    RuleCondition.VALUE_TYPE_SELECT = 2;
    return RuleCondition;
}(EventEmitter));
var ERuleStatementOperator;
(function (ERuleStatementOperator) {
    ERuleStatementOperator[ERuleStatementOperator["AND"] = 0] = "AND";
    ERuleStatementOperator[ERuleStatementOperator["OR"] = 1] = "OR";
})(ERuleStatementOperator || (ERuleStatementOperator = {}));
var ERuleStatementLogicalType;
(function (ERuleStatementLogicalType) {
    ERuleStatementLogicalType[ERuleStatementLogicalType["and"] = 0] = "and";
    ERuleStatementLogicalType[ERuleStatementLogicalType["or"] = 1] = "or";
})(ERuleStatementLogicalType || (ERuleStatementLogicalType = {}));
var RuleStatement = (function () {
    function RuleStatement(statementPosition, configuration) {
        if (statementPosition > RuleStatement.MAX_NR_OF_STATEMENTS) {
            console.error('reached MAX_NR_OF_STATEMENTS');
            return;
        }
        this.statementPosition = statementPosition;
        this.CONFIGURATION = __assign(__assign({}, RuleStatement.createDefaultConfiguration()), configuration);
        this.rootNode = document.createElement('div');
        this.statementNode = document.createElement('div');
        this.statementComponent = new InspectorDropdownComponent();
        this.statementNode.setAttribute('data-role', 'rules-statement-component');
        this.statementNode.appendChild(this.statementComponent.getRoot());
        this.statementComponent.getRoot().onclick = function (event) {
            event.stopPropagation();
        };
        this.getRootNode().setAttribute('data-role', 'rules-statement');
        this.getRootNode().appendChild(this.statementNode);
    }
    Object.defineProperty(RuleStatement.prototype, "getStatementPosition", {
        get: function () {
            return this.statementPosition;
        },
        enumerable: true,
        configurable: true
    });
    RuleStatement.prototype.withI18n = function (i18n) {
        this.i18n = i18n;
        return this;
    };
    RuleStatement.prototype.getRootNode = function () {
        return this.rootNode;
    };
    RuleStatement.prototype.initialize = function () {
        var _this = this;
        var translate = function (i18nKey, defaultText) { return _this.i18n.translateTextDefault(i18nKey, defaultText); };
        var options = [
            { value: ERuleStatementOperator.AND, text: translate('notifications_rule_statement_and', 'and') },
            { value: ERuleStatementOperator.OR, text: translate('notifications_rule_statement_or', 'or') }
        ];
        this.statementComponent.setOptions(options);
        var selectedStatement = this.CONFIGURATION.selectedStatement;
        if (selectedStatement !== null) {
            this.statementComponent.setValue(String(selectedStatement));
        }
    };
    RuleStatement.prototype.updateStatementPosition = function (statementPosition) {
        this.statementPosition = statementPosition;
    };
    RuleStatement.prototype.getSelectedStatement = function () {
        return parseInt(this.statementComponent.getValue(), 10);
    };
    RuleStatement.createDefaultConfiguration = function () {
        return {
            selectedStatement: null
        };
    };
    RuleStatement.MAX_NR_OF_STATEMENTS = 9;
    return RuleStatement;
}());
var PaymentsAttributeHelper = (function () {
    function PaymentsAttributeHelper() {
    }
    PaymentsAttributeHelper.getValueForSingleValueControl = function (control) {
        var values = FormUtils.clone(control.getProperty('payments.value') || [0.00]);
        return values[0];
    };
    PaymentsAttributeHelper.setValueForSingleValueControl = function (control, value) {
        var virtualValue = (null === value)
            ? [0.00]
            : [value];
        control.hasProperty('payments.value') && control.setProperty('payments.value', virtualValue);
        if (null === value) {
            $('#item').find('[data-role="attribute-group"][data-name="payments"] [data-role="property"][data-property-name="payments-virtualValue"] input[type="number"]').val(virtualValue[0]);
        }
        var hasProductsSettingEntry = control.getProperty('payments.hasProductsSettingsEntry'), loader = control.getForm().getEngine().getLoader();
        if (!hasProductsSettingEntry && !loader.getCommandDispatcher().isErrorStateNotification(loader.getUI().getCurrentNotification())) {
            var settings = control.getForm().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), products = settings.getProperty('productsData'), paymentProcessorsLink = window.location.href.replace('p=edit_fields', 'p=settings&tab=4'), notificationMessage = loader.getI18n().translateText('edt_UI_msg_payments_products_first_add_notification', paymentProcessorsLink), configuration = control.getForm().getEngine().getDocument().getConfiguration(), hasProcessorsInjected = configuration.getProperty('hasProcessorsInjected');
            if ((!products || products.length === 0) && !hasProcessorsInjected) {
                loader.getUI().createNotification(notificationMessage, false, ENotificationStyle.DEFAULT, true);
            }
            if (control.getProperty('payments.isProduct') === false) {
                settings.hasProperty('productsData') && settings.setProperty('productsData', settings.getProperty('productsData') || []);
            }
            else {
                settings.hasProperty('productsData') && settings.setProperty('productsData', (settings.getProperty('productsData') || []).concat([{
                        controlId: control.getId(),
                        tax: 0,
                        taxType: 0,
                        discount: 0,
                        discountType: 0
                    }]));
            }
            control.hasProperty('payments.hasProductsSettingsEntry') && control.setProperty('payments.hasProductsSettingsEntry', true);
            loader.execCommand('track-event', 'payments_products_add');
        }
        loader.execCommand('track-event', 'payments_products_price_change');
        loader.trigger('payments_products_price_change');
    };
    PaymentsAttributeHelper.getValueForOptionsBasedControl = function (control) {
        var values = FormUtils.clone(control.getProperty('payments.value') || []), choices = FormUtils.clone(control.getProperty('choices.values') || []);
        return choices.map(function (choice, index) {
            choice.paymentsValue = (values[index] || null);
            return choice;
        });
    };
    PaymentsAttributeHelper.setValueForOptionsBasedControl = function (control, choices) {
        var atLeastOneChoiceIsNotNull = false, hasProductsSettingEntry = control.getProperty('payments.hasProductsSettingsEntry'), loader = control.getForm().getEngine().getLoader();
        control.hasProperty('choices.values') && control.setProperty('choices.values', choices);
        control.hasProperty('payments.value') && control.setProperty('payments.value', choices.map(function (choice) {
            if (null !== choice.paymentsValue) {
                atLeastOneChoiceIsNotNull = true;
                return choice.paymentsValue;
            }
            else {
                return 0;
            }
        }));
        if (!atLeastOneChoiceIsNotNull) {
            return;
        }
        if (!hasProductsSettingEntry && !loader.getCommandDispatcher().isErrorStateNotification(loader.getUI().getCurrentNotification())) {
            var settings = control.getForm().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), products = settings.getProperty('productsData'), paymentProcessorsLink = window.location.href.replace('p=edit_fields', 'p=settings&tab=4'), notificationMessage = loader.getI18n().translateText('edt_UI_msg_payments_products_first_add_notification', paymentProcessorsLink), configuration = control.getForm().getEngine().getDocument().getConfiguration(), hasProcessorsInjected = configuration.getProperty('hasProcessorsInjected');
            if ((!products || products.length === 0) && !hasProcessorsInjected) {
                loader.getUI().createNotification(notificationMessage, false, ENotificationStyle.DEFAULT, true);
            }
            if (control.getProperty('payments.isProduct') === false) {
                settings.hasProperty('productsData') && settings.setProperty('productsData', settings.getProperty('productsData') || []);
            }
            else {
                settings.hasProperty('productsData') && settings.setProperty('productsData', (settings.getProperty('productsData') || []).concat([{
                        controlId: control.getId(),
                        tax: 0,
                        taxType: 0,
                        discount: 0,
                        discountType: 0
                    }]));
            }
            control.hasProperty('payments.hasProductsSettingsEntry') && control.setProperty('payments.hasProductsSettingsEntry', true);
            loader.execCommand('track-event', 'payments_products_add');
        }
        loader.execCommand('track-event', 'payments_products_price_change');
        loader.trigger('payments_products_price_change');
    };
    PaymentsAttributeHelper.getValueForComposedControl = function (control) {
        var children = control.getChildren();
        if (children.length === 0) {
            return [];
        }
        var values = children.map(function (child) { return child.getProperty('payments.value'); }), choices = children.map(function (child) { return child.getProperty('choices.values'); });
        return choices.map(function (choice, topLevelIndex) {
            choice.map(function (choiceValue, secondLevelIndex) {
                if (null === values[topLevelIndex]) {
                    choiceValue.paymentsValue = null;
                    return choiceValue;
                }
                choiceValue.paymentsValue = values[topLevelIndex][secondLevelIndex] || null;
            });
            return choice;
        });
    };
    PaymentsAttributeHelper.setValueForComposedControl = function (control, choices) {
        var hasProductsSettingEntry = false, loader = control.getForm().getEngine().getLoader(), children = control.getChildren();
        var _loop_4 = function (i, len) {
            var atLeastOneChoiceIsNotNull = false;
            if (undefined !== children[i] && children[i] instanceof LikertScaleControl) {
                hasProductsSettingEntry = children[i].getProperty('payments.hasProductsSettingsEntry');
                children[i].hasProperty('choices.values') && children[i].setProperty('choices.values', FormUtils.trimChoices(choices[i]));
                children[i].hasProperty('payments.value') && children[i].setProperty('payments.value', choices[i].map(function (choice) {
                    if (null !== choice.paymentsValue) {
                        atLeastOneChoiceIsNotNull = true;
                        return choice.paymentsValue;
                    }
                    else {
                        return 0;
                    }
                }));
                if (!atLeastOneChoiceIsNotNull) {
                    return "continue";
                }
                if (!hasProductsSettingEntry && !loader.getCommandDispatcher().isErrorStateNotification(loader.getUI().getCurrentNotification())) {
                    var settings = loader.getEngine().getDocument().getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), products = settings.getProperty('productsData'), paymentProcessorsLink = window.location.href.replace('p=edit_fields', 'p=settings&tab=4'), notificationMessage = loader.getI18n().translateText('edt_UI_msg_payments_products_first_add_notification', paymentProcessorsLink), configuration = loader.getEngine().getDocument().getConfiguration(), hasProcessorsInjected = configuration.getProperty('hasProcessorsInjected');
                    if ((!products || products.length === 0) && !hasProcessorsInjected) {
                        loader.getUI().createNotification(notificationMessage, false, ENotificationStyle.DEFAULT, true);
                    }
                    if (children[i].getProperty('payments.isProduct') === false) {
                        settings.hasProperty('productsData') && settings.setProperty('productsData', settings.getProperty('productsData') || []);
                    }
                    else {
                        settings.hasProperty('productsData') && settings.setProperty('productsData', (settings.getProperty('productsData') || []).concat([{
                                controlId: children[i].getId(),
                                tax: 0,
                                taxType: 0,
                                discount: 0,
                                discountType: 0
                            }]));
                    }
                    children[i].hasProperty('payments.hasProductsSettingsEntry') && children[i].setProperty('payments.hasProductsSettingsEntry', true);
                    loader.execCommand('track-event', 'payments_products_add');
                }
            }
        };
        for (var i = 0, len = choices.length; i < len; i++) {
            _loop_4(i, len);
        }
        loader.execCommand('track-event', 'payments_products_price_change');
        loader.trigger('payments_products_price_change');
    };
    return PaymentsAttributeHelper;
}());
var PageContainer = (function (_super) {
    __extends(PageContainer, _super);
    function PageContainer(form, elementProperties) {
        var _this = _super.call(this, form, elementProperties) || this;
        _this.actionBarButtonsVisibilityStates = [];
        _this.header = document.createElement('div');
        _this.header.setAttribute('data-role', 'page-header');
        _this.rootNode.appendChild(_this.header);
        _this.body = document.createElement('div');
        _this.body.setAttribute('data-role', 'page-body');
        _this.rootNode.appendChild(_this.body);
        _this.footer = document.createElement('div');
        _this.footer.setAttribute('data-role', 'page-footer');
        _this.rootNode.appendChild(_this.footer);
        _this.emptyPageContainer = document.createElement('div');
        _this.emptyPageContainer.setAttribute('data-role', 'empty-state-view');
        _this.rootNode.appendChild(_this.emptyPageContainer);
        _this.separator = document.createElement('div');
        _this.separator.setAttribute('data-role', 'page-break');
        _this.separator.innerHTML = '<div data-role="merge-pages">' +
            '<div data-role="page-separator-line"></div>' +
            '<button data-role="merge-pages-button" data-i18n-text="edt_text_merge_button">Merge pages</button>' +
            '<div data-role="page-separator-line"></div></div>';
        _this.updateActionBarButtonsThrottled = Throttle.create(function () {
            _this.updateActionBarButtonsInImmediateMode();
        }, 50);
        return _this;
    }
    PageContainer.prototype.getDOMInsertionNode = function () {
        return this.body;
    };
    PageContainer.prototype.getTypeId = function () {
        return ElementTypes.CONTAINER_TYPE_PAGE;
    };
    PageContainer.prototype.getElementName = function () {
        return 'Page';
    };
    PageContainer.getConfiguration = function () {
        return {
            category: "containers",
            icon: "i123-date",
            isContainer: true,
            keywords: "page",
            name: "Page",
            typeId: ElementTypes.CONTAINER_TYPE_PAGE,
            isVirtual: true,
            index: 99999,
            accessibilityFields: EFieldAccessibilityNodesBitmask.NONE,
        };
    };
    PageContainer.prototype.createRootNodeElement = function () {
        this.rootNode = document.createElement('div');
        this.rootNode.setAttribute('data-role', 'page');
        this.rootNode.setAttribute('data-type', this._static().nodeName);
        this.rootNode.setAttribute('data-hash', this.getHash());
        this.rootNode.setAttribute('data-type-id', String(this.getTypeId()));
    };
    PageContainer.prototype.onCreated = function () {
        this.renderHeader();
        this.renderFooter();
        this.rootNode.appendChild(this.getForm().getEngine().getTheme().getGridContainerElement().cloneNode(true));
        (function (self) {
            setTimeout(function () {
                self.loadEmptyStateMarkup();
                self.renderHeader();
                self.renderFooter();
            }, 10);
        })(this);
    };
    PageContainer.prototype.getIndex = function () {
        return this.index;
    };
    PageContainer.prototype.withIndex = function (newIndex) {
        this.index = ~~newIndex;
        this.rootNode.setAttribute('data-page-index', String(this.index));
        this.separator.setAttribute('data-page-index', String(this.index));
        if (0 === newIndex) {
            this.rootNode.setAttribute('data-is-first-page', '1');
        }
        else {
            this.rootNode.removeAttribute('data-is-first-page');
        }
        return this;
    };
    PageContainer.prototype.isLastPage = function () {
        return Boolean(this.lastPage);
    };
    PageContainer.prototype.withIsLastPage = function (isLastPage) {
        this.lastPage = Boolean(isLastPage);
        if (this.lastPage) {
            this.rootNode.setAttribute('data-is-last-page', 'yes');
            this.separator.setAttribute('data-is-last-page', 'yes');
        }
        else {
            this.rootNode.removeAttribute('data-is-last-page');
            this.separator.removeAttribute('data-is-last-page');
        }
        return this;
    };
    PageContainer.prototype.addRealtimeCalculationsToPageHeader = function () {
        var ribbon = document.createElement('div');
        ribbon.setAttribute('data-role', 'control');
        ribbon.setAttribute('data-type', 'realtime-calculations');
        var calculationHTML = '...';
        if (this.getLoaderType() === EFormLoaderType.VIEW) {
            ribbon.setAttribute('data-is-empty', '1');
            ribbon.setAttribute('data-page', 'viewer');
            ribbon.setAttribute('aria-labelledby', 'floating-payments-header-text floating-payments-header-calculation-total');
            var lastCalculationResponse = this.getForm().getLastCalculationServerResponse(), hasAccessibilityEnabled = this.getForm().getConfiguration()
                .getProperty('hasAccessibilityEnabled', false);
            if (hasAccessibilityEnabled) {
                ribbon.tabIndex = 0;
            }
            else {
                ribbon.removeAttribute('tabindex');
            }
            if (lastCalculationResponse) {
                calculationHTML = lastCalculationResponse.currencyHTML + String(lastCalculationResponse.invoiceObject.total);
            }
        }
        else if (this.getLoaderType() === EFormLoaderType.EDIT) {
            ribbon.setAttribute('data-page', 'editor');
            var currencyId = this.getForm().getEngine().getLoader().getSelectedCurrencyId()
                || PaymentsProductsDialog.DEFAULT_CURRENCY_ID;
            var currencySymbol = this.getForm().getEngine().getCurrency().getCurrencySymbolById(currencyId);
            calculationHTML = "" + currencySymbol + PageContainer.DUMMY_VALUE_FOR_RTS_RIBBON;
        }
        ribbon.innerHTML =
            "<span data-i18n-text=\"realtime_summary_total\" id=\"floating-payments-header-text\">\n                Total:\n            </span>\n            <span data-role=\"calculation-total\" id=\"floating-payments-header-calculation-total\"> \n                " + calculationHTML + "\n            </span>";
        this.getForm().getEngine().getI18n().translateDOMNode(ribbon);
        this.header.appendChild(ribbon);
    };
    PageContainer.prototype.getLoaderType = function () {
        return this.getForm().getEngine().getLoader().getLoaderType();
    };
    PageContainer.prototype.addPaymentsSummaryToPageFooter = function () {
        var detailedInvoiceOptions = this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS);
        if (!detailedInvoiceOptions || !detailedInvoiceOptions.showPaymentsSummaryBelowForm) {
            return;
        }
        var paymentSummaryContainer = document.createElement('div');
        paymentSummaryContainer.setAttribute('data-type', 'payment-summary');
        if (!this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY)) {
            paymentSummaryContainer.setAttribute('data-is-empty', '1');
        }
        paymentSummaryContainer.innerHTML = this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.LAST_CALCULATION_HTML_MARKUP) || '';
        this.getForm().getEngine().getLoader().execCommand('add-payment-summary-listeners', paymentSummaryContainer);
        this.footer.appendChild(paymentSummaryContainer);
    };
    PageContainer.prototype.selectPaymentSummaryContainer = function () {
        var $ = this.getForm().getEngine().getJQuery();
        $('[data-type=payment-summary]').children(':first').attr('data-is-selected', 1);
    };
    PageContainer.prototype.unselectPaymentSummaryContainer = function () {
        var $ = this.getForm().getEngine().getJQuery();
        $('[data-type=payment-summary]').children(':first').removeAttr('data-is-selected');
    };
    PageContainer.prototype.addLanguageSelectorToPageHeader = function () {
        if (this.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.EDIT && this.getIndex() !== 0) {
            return;
        }
        var d = document.createElement('div');
        d.setAttribute('data-role', 'control');
        d.setAttribute('data-type', 'language-selector');
        this.header.appendChild(d);
        (function (self, resourceManager, availableLanguageCodes, i18n, geolocation, $) {
            resourceManager.get('/modules/Typescript/Form/resources/language-selector.html')
                .then(function (templateText) {
                var hasAccessibilityEnabled = self.getForm().getConfiguration().getProperty('hasAccessibilityEnabled', false), currentLanguage = i18n
                    ? i18n.getLanguageCode()
                    : null, model = {
                    languages: [],
                    hasAccessibilityEnabled: hasAccessibilityEnabled,
                }, allWorldLanguages = TranslationsService.getLanguagesList();
                if (self.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW) {
                    for (var i = 0, len = allWorldLanguages.length; i < len; i++) {
                        if (availableLanguageCodes.indexOf(allWorldLanguages[i].code3) > -1 || (allWorldLanguages[i].code2 && availableLanguageCodes.indexOf(allWorldLanguages[i].code2) > -1)) {
                            model.languages.push({
                                code: allWorldLanguages[i].code2 || allWorldLanguages[i].code3,
                                name: allWorldLanguages[i].name,
                                nativeName: allWorldLanguages[i].native_name,
                                selected: currentLanguage === allWorldLanguages[i].code3 || (allWorldLanguages[i].code2 && currentLanguage === allWorldLanguages[i].code2),
                            });
                        }
                    }
                    model.languages.sort(function (a, b) {
                        if (~~a.selected !== ~~b.selected) {
                            return ~~b.selected - ~~a.selected;
                        }
                        else {
                            var aLower = a.nativeName.toLowerCase(), bLower = b.nativeName.toLowerCase();
                            if (aLower === bLower) {
                                return 0;
                            }
                            else {
                                return aLower < bLower
                                    ? -1
                                    : 1;
                            }
                        }
                    });
                }
                else {
                    model.languages.push({
                        code: "",
                        name: "Default",
                        nativeName: "Default",
                        selected: true,
                    });
                    d.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        setTimeout(function () {
                            try {
                                self.getForm().getEngine().getLoader().getEditorPanelGroup().setActivePanel('translations');
                            }
                            catch (e) { }
                        }, 100);
                    }, true);
                }
                var template = new Salvage(templateText);
                d.innerHTML = template.parse(model);
                $(d).find('select').each(function () {
                    UIDropDown.upgradeDropdown(this).getRootNode().setAttribute('data-role', 'i123-input');
                });
                if (i18n) {
                    i18n.translateDOMNode(d);
                }
            });
        })(this, this.getForm().getEngine().getResourceManager(), this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.TRANSLATIONS_LANGUAGE_CODES), this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.I18N), this.getForm().getEngine().getGeolocation(), this.getForm().getEngine().getJQuery());
    };
    PageContainer.prototype.addPaginationToPageHeader = function (paginationType) {
        var d = window.document.createElement('div'), model = {
            pagination: {
                isNone: false,
                isSteps: false,
                isPercentage: false,
                isPageNumbers: false,
            },
            pages: [],
            numPages: 0,
            moreThan5Pages: false,
        }, document = this.getForm(), numberOfPages = document.getNumberOfPages(), onePagePercent = 100 / numberOfPages, showTitle = this.getPageTitlesVisibility();
        model.numPages = numberOfPages;
        model.moreThan5Pages = numberOfPages > 5;
        model.isAccessibilityEnabled = this.getForm().getConfiguration().getProperty('hasAccessibilityEnabled', false);
        for (var i = 0, len = numberOfPages; i < len; i++) {
            model.pages.push({
                index: i,
                paddedOrder: FormUtils.padString(String(i + 1), '0', 2, EPadType.LEFT),
                order: String(i + 1),
                isCurrent: i === this.index,
                title: String(document.getPageByIndex(i).getProperty('label.labelText') || 'Untitled Page'),
                percent: String(Math.round((i + 1) * onePagePercent)),
                unitPercent: onePagePercent.toFixed(2) + '%',
                showTitle: showTitle,
                numPages: numberOfPages,
                isAccessibilityEnabled: model.isAccessibilityEnabled,
            });
        }
        d.setAttribute('data-role', 'pagination');
        switch (paginationType) {
            case EFormPaginationType.STEPS:
                model.pagination.isSteps = true;
                d.setAttribute('data-type', 'steps');
                break;
            case EFormPaginationType.PERCENTAGE:
                model.pagination.isPercentage = true;
                d.setAttribute('data-type', 'percents');
                break;
            case EFormPaginationType.PAGE_NUMBERS:
                model.pagination.isPageNumbers = true;
                d.setAttribute('data-type', 'page-numbers');
                break;
            default:
                model.pagination.isNone = true;
                d.setAttribute('data-type', 'none');
                break;
        }
        this.header.appendChild(d);
        (function (resourceManager, i18n, $) {
            resourceManager.get('/modules/Typescript/Form/resources/pagination.html')
                .then(function (templateMarkup) {
                var template = new Salvage(templateMarkup);
                d.innerHTML = template.parse(model);
                Tooltip.init($);
            })
                .fail(function (e) {
                var error = window.document.createElement('span');
                error.setAttribute('data-role', 'error');
                error.textContent = String(e || 'Error occured fetching pagination');
                d.appendChild(error);
            });
        })(this.getForm().getEngine().getResourceManager(), this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.I18N), this.getForm().getEngine().getJQuery());
    };
    PageContainer.prototype.renderHeader = function () {
        while (this.header.firstChild) {
            this.header.removeChild(this.header.firstChild);
        }
        var loader = this.getForm().getEngine().getLoader(), document = this.getForm();
        if (this.isAttached()) {
            var numberOfPages = document.getNumberOfPages(), paginationType = document.getProperty('options.paginationType');
            if (numberOfPages > 1 && paginationType !== EFormPaginationType.NONE && this.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
                this.addPaginationToPageHeader(paginationType);
            }
            if (EngineToggles.ALLOW_QUIZ_TIMER) {
                if (null !== loader.getLoaderDependency(ELoaderDependency.INITIAL_QUIZ_TIMER)) {
                    this.addQuizTimerContainerToPageHeader();
                    this.header.setAttribute('data-has-quiz-timer', '');
                }
                else {
                    this.header.removeAttribute('data-has-quiz-timer');
                }
            }
            if (EngineToggles.ALLOW_REAL_TIME_CALCULATIONS) {
                if (loader.getLoaderDependency(ELoaderDependency.SHOW_REALTIME_CALCULATIONS)) {
                    this.addRealtimeCalculationsToPageHeader();
                    this.header.setAttribute('data-has-realtime-calculations', '');
                }
                else {
                    this.header.removeAttribute('data-has-realtime-calculations');
                }
            }
            if (EngineToggles.ALLOW_I18N_DROPDOWN_SELECTOR) {
                if (null !== loader.getLoaderDependency(ELoaderDependency.TRANSLATIONS_LANGUAGE_CODES)
                    && 1 < loader.getLoaderDependency(ELoaderDependency.TRANSLATIONS_LANGUAGE_CODES).length) {
                    this.addLanguageSelectorToPageHeader();
                    this.header.setAttribute('data-has-language-selector', '');
                }
                else {
                    this.header.removeAttribute('data-has-language-selector');
                }
            }
            this.header.appendChild(document.getHeader().getRootNode().cloneNode(true));
        }
    };
    PageContainer.prototype.addQuizTimerContainerToPageHeader = function () {
        var d = document.createElement('div');
        d.setAttribute('data-role', 'quiz-timer');
        this.header.appendChild(d);
        (function (resourceManager) {
            resourceManager.get('/modules/Typescript/Form/resources/quiz-timer.html')
                .then(function (templateText) {
                d.innerHTML = templateText;
            });
        })(this.getForm().getEngine().getResourceManager());
    };
    PageContainer.prototype.addPaymentProcessorsToPageFooter = function () {
        var paymentProcessors = this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.PAYMENT_PROCESSORS_LIST), detailedInvoiceOptions = this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS);
        if (!detailedInvoiceOptions || !detailedInvoiceOptions.showPaymentsSummaryBelowForm || null === paymentProcessors) {
            return;
        }
        var model = {
            processors: (function () {
                var result = [];
                for (var i = 0, len = paymentProcessors.length; i < len; i++) {
                    result.push({
                        isRadio: paymentProcessors[i].displayType === EPaymentProcessorDisplayType.DISPLAY_BOTH_AS_RADIO_AND_AS_DROPDOWN
                            || paymentProcessors[i].displayType === EPaymentProcessorDisplayType.DISPLAY_ONLY_AS_RADIO,
                        isDropdown: paymentProcessors[i].displayType === EPaymentProcessorDisplayType.DISPLAY_BOTH_AS_RADIO_AND_AS_DROPDOWN
                            || paymentProcessors[i].displayType === EPaymentProcessorDisplayType.DISPLAY_ONLY_AS_DROPDOWN,
                        displayType: paymentProcessors[i].displayType,
                        typeId: paymentProcessors[i].typeId,
                        name: paymentProcessors[i].name,
                        brandLogo: paymentProcessors[i].pictures[0] || null,
                        creditCardLogos: btoa(JSON.stringify(paymentProcessors[i].pictures.slice(1))),
                        isDefault: paymentProcessors[i].isDefault,
                        frontendPluginTypeId: paymentProcessors[i].frontendPluginTypeId || null,
                    });
                }
                return result;
            })(),
            hasDropdown: false,
            hasRadio: false,
            hasAccessibilityEnabled: false,
        }, domNode = document.createElement('div');
        model.hasAccessibilityEnabled = this.getForm().getConfiguration().getProperty('hasAccessibilityEnabled', false);
        domNode.setAttribute('data-role', 'control');
        domNode.setAttribute('data-type', 'payments-selector');
        domNode.setAttribute('data-renderer-type', 'tln');
        for (var i = 0, len = model.processors.length; i < len; i++) {
            if (model.processors[i].isDropdown) {
                model.hasDropdown = true;
            }
            if (model.processors[i].isRadio) {
                model.hasRadio = true;
            }
        }
        this.footer.appendChild(domNode);
        (function (resourceManager, targetNode, model, loader) {
            resourceManager.get('/modules/Typescript/Form/resources/payments-choose-processor.html')
                .then(function (templateText) {
                var template = new Salvage(templateText);
                targetNode.innerHTML = template.parse(model);
                loader.getI18n().translateDOMNode(targetNode);
                loader.trigger('plugin-rendered', 'payments-selector', domNode);
                FormUtils.refreshFrameHeightOnWix();
            })
                .fail(function (e) {
                targetNode.textContent = String(e || 'Error fetching /modules/Typescript/Form/resources/payments-choose-processor.html');
            });
        })(this.getForm().getEngine().getResourceManager(), domNode, model, this.getForm().getEngine().getLoader());
    };
    PageContainer.prototype.addCaptchaControlToPageFooter = function () {
        (function (self) {
            var loader = self.getForm().getEngine().getLoader();
            if (true !== loader.getLoaderDependency(ELoaderDependency.SKIP_CAPTCHA)
                && EViewFormContext.EDIT_SUBMISSION !== loader.getLoaderDependency(ELoaderDependency.VIEW_FORM_CONTEXT)) {
                self.footer.appendChild(self.getForm().getCaptcha().getParent().getRootNode());
            }
        })(this);
    };
    PageContainer.prototype.addActionBarControlToPageFooter = function () {
        (function (self) {
            var actionBarDOMNode = self.getForm().getActionBar().getRootNode().cloneNode(true);
            self.updateActionBarButtonsVisibilityStates(actionBarDOMNode);
            self.footer.appendChild(actionBarDOMNode);
            self.getForm().getEngine().getResourceManager().get('/modules/Typescript/Form/resources/action-bar.html')
                .then(function (templateText) {
                var template = new Salvage(templateText), model = {
                    isFirstPage: 0 === self.getIndex(),
                    isLastPage: self.isLastPage(),
                    index: self.getIndex(),
                    hasNextPage: !self.isLastPage() && self.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE,
                    hasPreviousPage: self.getIndex() > 0 && self.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE,
                    nextPageIndex: self.getIndex() + 1,
                    previousPageIndex: self.getIndex() - 1,
                    isPaymentSummaryPage: self.getTypeId() === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE,
                    properties: self.getForm().getActionBar().getComputedProperties(),
                };
                if (self.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW) {
                    if (self.getForm().getEngine().getLoader().isEnabledAutoSubmit()) {
                        model.properties.autosubmit = true;
                    }
                }
                else {
                    var formSettings = self.getForm().getEngine().getLoader().getFormSettings();
                    if (formSettings.autoSubmit === true) {
                        model.properties.autosubmit = true;
                    }
                }
                actionBarDOMNode.innerHTML = template.parse(model);
                if (self.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW) {
                    self.getForm().getEngine().getLoader().getI18n().translateDOMNode(actionBarDOMNode);
                }
            })
                .fail(function (e) {
                actionBarDOMNode.textContent = String(e || 'Error fetching /modules/Typescript/Form/resources/action-bar.html');
            });
        })(this);
    };
    PageContainer.prototype.addPaymentCouponCodeControlToPageFooter = function () {
        var couponCode = this.getForm().getCouponCode();
        if (!couponCode)
            return;
        this.footer.appendChild(couponCode.getRootNode());
    };
    PageContainer.prototype.renderFooter = function () {
        while (this.footer.firstChild) {
            this.footer.removeChild(this.footer.firstChild);
        }
        if (this.isAttached()) {
            if (this.isLastPage()) {
                if (EngineToggles.ALLOW_COUPON_CODES_ON_LAST_PAGE_FOOTER) {
                    this.addPaymentCouponCodeControlToPageFooter();
                }
                if (EngineToggles.ALLOW_PAYMENTS_SELECTOR) {
                    this.addPaymentProcessorsToPageFooter();
                }
                if (EngineToggles.ALLOW_PAYMENTS_SUMMARY) {
                    this.addPaymentsSummaryToPageFooter();
                }
                this.addCaptchaControlToPageFooter();
            }
            this.addActionBarControlToPageFooter();
        }
    };
    PageContainer.prototype.isRemovable = function () {
        return false;
    };
    PageContainer.prototype.getParentPage = function () {
        return this;
    };
    PageContainer.prototype.getMaxColspan = function () {
        return 20;
    };
    PageContainer.prototype.getColspan = function () {
        return 20;
    };
    PageContainer.prototype.split = function (referenceRow, referenceRowEdge) {
        if (referenceRowEdge !== EElementEdge.TOP && referenceRowEdge !== EElementEdge.BOTTOM) {
            throw new Error('Invalid argument: referenceRowEdge: EElementEdge.TOP || EElementEdge.BOTTOM expected!');
        }
        var splitIndex = null;
        for (var i = 0, len = this.children.length; i < len; i++) {
            if (this.children[i] === referenceRow) {
                splitIndex = i;
            }
        }
        if (splitIndex === null) {
            throw new Error('Invalid reference row!');
        }
        if (referenceRowEdge === EElementEdge.BOTTOM) {
            splitIndex++;
        }
        var newPage = this.getForm().getEngine().createElement(ElementTypes.CONTAINER_TYPE_PAGE), numChilds;
        this.getParent().insertAfter(this, newPage);
        while (this.children.length - 1 >= splitIndex) {
            newPage.appendChild(this.children[splitIndex]);
        }
    };
    PageContainer.prototype.mergeWith = function (page) {
        var pageChildren = page.getChildren().slice(0);
        for (var i = 0, len = pageChildren.length; i < len; i++) {
            this.appendChild(pageChildren[i]);
        }
        page.getParent().removeChild(page);
    };
    PageContainer.prototype.getPageSeparatorDOMNode = function () {
        return this.separator;
    };
    PageContainer.prototype.isDragable = function () {
        return false;
    };
    PageContainer.prototype.isDuplicatable = function () {
        return false;
    };
    PageContainer.prototype.getHeaderContainerDOMNode = function () {
        return this.header;
    };
    PageContainer.prototype.getPaginationType = function () {
        return this.getForm().getProperty('options.paginationType');
    };
    PageContainer.prototype.setPaginationType = function (paginationType) {
        switch (paginationType) {
            case EFormPaginationType.NONE:
            case EFormPaginationType.PAGE_NUMBERS:
            case EFormPaginationType.PERCENTAGE:
            case EFormPaginationType.STEPS:
                console.warn('set pagination type: ', paginationType);
                this.getForm().setProperty('options.paginationType', paginationType);
                break;
            default:
                this.getForm().setProperty('options.paginationType', EFormPaginationType.NONE);
                break;
        }
    };
    PageContainer.prototype.getPageTitlesVisibility = function () {
        return this.getForm().getProperty('options.showPageTitles');
    };
    PageContainer.prototype.setPageTitlesVisibility = function (visibility) {
        this.getForm().setProperty('options.showPageTitles', !!visibility);
    };
    PageContainer.prototype.loadEmptyStateMarkup = function () {
        var _this = this;
        this.getForm().getEngine().getResourceManager().get('/modules/Typescript/Form/resources/empty-state-page.html').then(function (htmlMarkup) {
            _this.emptyPageContainer.innerHTML = htmlMarkup;
            _this.getForm().getEngine().getI18n().translateDOMNode(_this.emptyPageContainer);
        });
    };
    PageContainer.prototype.setActionBarButtonVisibility = function (button, visible) {
        if (null === button) {
            return;
        }
        for (var i = 0, len = this.actionBarButtonsVisibilityStates.length; i < len; i++) {
            if (this.actionBarButtonsVisibilityStates[i].button === button) {
                if (null === visible) {
                    this.actionBarButtonsVisibilityStates.splice(i, 1);
                }
                else {
                    this.actionBarButtonsVisibilityStates[i].visible = visible;
                }
                this.updateActionBarButtonsThrottled();
                return;
            }
        }
        if (null !== visible) {
            this.actionBarButtonsVisibilityStates.push({
                button: button,
                visible: visible,
            });
        }
        this.updateActionBarButtonsThrottled();
    };
    PageContainer.prototype.getActionBarButtonVisibility = function (button) {
        for (var i = 0, len = this.actionBarButtonsVisibilityStates.length; i < len; i++) {
            if (this.actionBarButtonsVisibilityStates[i].button === button) {
                return this.actionBarButtonsVisibilityStates[i].visible;
            }
        }
        return null;
    };
    PageContainer.isActionBarDOMAttributeName = function (attributeName) {
        return PageContainer.ACTIONBAR_DOM_NODE_ATTRIBUTE_NAMES.indexOf(attributeName) > -1;
    };
    PageContainer.getActionBarButtonFromDOMAttributeName = function (attributeName) {
        switch (attributeName) {
            case 'data-button-submit':
                return EActionBarButton.SUBMIT;
            case 'data-button-calculate':
                return EActionBarButton.CALCULATE;
            case 'data-button-show-summary':
                return EActionBarButton.SHOW_SUMMARY;
            case 'data-button-next-page':
                return EActionBarButton.NEXT_PAGE;
            case 'data-button-previous-page':
                return EActionBarButton.PREVIOUS_PAGE;
            case 'data-button-approve':
                return EActionBarButton.APPROVE;
            case 'data-button-preview':
                return EActionBarButton.PREVIEW;
            case 'data-button-print':
                return EActionBarButton.PRINT;
            case 'data-button-reset':
                return EActionBarButton.RESET;
            case 'data-button-save-for-later':
                return EActionBarButton.SAVE_FOR_LATER;
            default:
                return null;
        }
    };
    PageContainer.getActionBarDOMAttributeNameFromButtonType = function (buttonType) {
        switch (buttonType) {
            case EActionBarButton.SUBMIT:
                return 'data-button-submit';
            case EActionBarButton.CALCULATE:
                return 'data-button-calculate';
            case EActionBarButton.SHOW_SUMMARY:
                return 'data-button-show-summary';
            case EActionBarButton.NEXT_PAGE:
                return 'data-button-next-page';
            case EActionBarButton.PREVIOUS_PAGE:
                return 'data-button-previous-page';
            case EActionBarButton.APPROVE:
                return 'data-button-approve';
            case EActionBarButton.PREVIEW:
                return 'data-button-preview';
            case EActionBarButton.PRINT:
                return 'data-button-print';
            case EActionBarButton.RESET:
                return 'data-button-reset';
            case EActionBarButton.SAVE_FOR_LATER:
                return 'data-button-save-for-later';
            default:
                return null;
        }
    };
    PageContainer.prototype.updateActionBarButtonsVisibilityStates = function (actionBarDOMNode) {
        if (!actionBarDOMNode) {
            return;
        }
        var buttonType;
        for (var attributes = Array.prototype.slice.call(actionBarDOMNode.attributes, 0), len = attributes.length, i = 0; i < len; i++) {
            if (PageContainer.isActionBarDOMAttributeName(attributes[i].name)) {
                buttonType = PageContainer.getActionBarButtonFromDOMAttributeName(attributes[i].name);
                actionBarDOMNode.setAttribute(attributes[i].name, !this.getActionBarButtonVisibility(buttonType) ? '0' : '1');
            }
        }
        var attributeName;
        for (var i = 0, len = this.actionBarButtonsVisibilityStates.length; i < len; i++) {
            attributeName = PageContainer.getActionBarDOMAttributeNameFromButtonType(this.actionBarButtonsVisibilityStates[i].button);
            if (!actionBarDOMNode.hasAttribute(attributeName)) {
                actionBarDOMNode.setAttribute(attributeName, this.actionBarButtonsVisibilityStates[i].visible
                    ? '1'
                    : '0');
            }
        }
    };
    PageContainer.prototype.updateActionBarButtonsInImmediateMode = function () {
        this.updateActionBarButtonsVisibilityStates(this.footer.querySelector('div[data-role=control][data-type=form-action-bar]'));
    };
    PageContainer.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return false;
    };
    PageContainer.prototype.enumerateTranslations = function () {
        var result = [];
        var pageTitle = this.getProperty('label.labelText') || '';
        if (pageTitle) {
            result.push({
                key: 'page_' + this.getIndex() + '_label',
                sourceText: pageTitle,
            });
        }
        return result;
    };
    PageContainer.ACTIONBAR_DOM_NODE_ATTRIBUTE_NAMES = [
        'data-button-submit',
        'data-button-calculate',
        'data-button-show-summary',
        'data-button-next-page',
        'data-button-previous-page',
        'data-button-approve',
        'data-button-preview',
        'data-button-print',
        'data-button-reset',
        'data-button-save-for-later',
    ];
    PageContainer.nodeName = 'page';
    PageContainer.attributes = {};
    PageContainer.runtime = null;
    PageContainer.DUMMY_VALUE_FOR_RTS_RIBBON = '99';
    return PageContainer;
}(FormContainer));
var PaymentSummaryPageContainer = (function (_super) {
    __extends(PaymentSummaryPageContainer, _super);
    function PaymentSummaryPageContainer(form, elementProperties) {
        var _this = _super.call(this, form, elementProperties) || this;
        _this.rootNode.removeChild(_this.emptyPageContainer);
        _this.separator = document.createElement('div');
        _this.separator.setAttribute('data-role', 'after-submit-page-break');
        _this.separator.innerHTML =
            "<div><div data-role=\"page-separator-line\"></div>\n            <button data-role=\"after-submit-button\" data-i18n-text=\"edt_text_after_submit_button\">After submit</button>\n            <div data-role=\"page-separator-line\"></div></div>";
        _this.updateActionBarButtonsThrottled = Throttle.create(function () {
            _this.updateActionBarButtonsInImmediateMode();
        }, 50);
        return _this;
    }
    PaymentSummaryPageContainer.prototype.getTypeId = function () {
        return ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE;
    };
    PaymentSummaryPageContainer.prototype.renderFooter = function () {
        while (this.footer.firstChild) {
            this.footer.removeChild(this.footer.firstChild);
        }
        if (this.isAttached()) {
            if (EngineToggles.ALLOW_PAYMENTS_SUMMARY) {
                this.addPaymentsSummaryToPageFooter();
            }
            this.addActionBarControlToPageFooter();
        }
    };
    PaymentSummaryPageContainer.prototype.addPaymentsSummaryToPageFooter = function () {
        var detailedInvoiceOptions = this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS);
        if (!detailedInvoiceOptions || detailedInvoiceOptions.showPaymentsSummaryBelowForm) {
            return;
        }
        var paymentSummaryContainer = document.createElement('div');
        paymentSummaryContainer.setAttribute('data-type', 'payment-summary');
        if (!this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY)) {
            paymentSummaryContainer.setAttribute('data-is-empty', '1');
        }
        paymentSummaryContainer.innerHTML = this.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.LAST_CALCULATION_HTML_MARKUP) || '';
        this.getForm().getEngine().getLoader().execCommand('add-payment-summary-listeners', paymentSummaryContainer);
        this.footer.appendChild(paymentSummaryContainer);
    };
    PaymentSummaryPageContainer.nodeName = 'payment-summary-page';
    return PaymentSummaryPageContainer;
}(PageContainer));
var RowContainer = (function (_super) {
    __extends(RowContainer, _super);
    function RowContainer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RowContainer.prototype.getTypeId = function () {
        return ElementTypes.CONTAINER_TYPE_ROW;
    };
    RowContainer.prototype.getElementName = function () {
        return 'Row';
    };
    RowContainer.getConfiguration = function () {
        return null;
    };
    RowContainer.prototype.getLayoutDirection = function () {
        return ELayoutDirection.LEFT_TO_RIGHT;
    };
    RowContainer.prototype.getMinColspan = function () {
        var result = 0;
        for (var i = 0, len = this.children.length; i < len; i++) {
            result += this.children[i].getMinColspan();
        }
        return result || 1;
    };
    RowContainer.prototype.makeElementsToFitColspanUsingTheFairResizingAlgorithm = function (colspan, fillUnusedColspan) {
        if (fillUnusedColspan === void 0) { fillUnusedColspan = false; }
        if (null === colspan || 0 === this.children.length) {
            return;
        }
        var electedNodes, colspanSum = 0, canDecrease = 0, elementColspan = 0, loops = 0;
        if (colspan < 0) {
            return;
        }
        do {
            electedNodes = [];
            colspanSum = 0;
            canDecrease = 0;
            for (var i = 0, len = this.children.length; i < len; i++) {
                if ((canDecrease = (elementColspan = this.children[i].getColspan()) - this.children[i].getMinColspan()) > 0) {
                    electedNodes.push({
                        element: this.children[i],
                        canDecreaseColspan: canDecrease,
                        colspan: elementColspan
                    });
                }
                colspanSum += elementColspan;
            }
            if (0 === electedNodes.length) {
                break;
            }
            if (colspanSum <= colspan) {
                break;
            }
            electedNodes.sort(function (a, b) {
                return b.canDecreaseColspan - a.canDecreaseColspan;
            });
            for (var i = 0, len = electedNodes.length; i < len; i++) {
                electedNodes[i].element.withColspan(electedNodes[i].colspan - 1);
                if (electedNodes[i].element.getColspan() !== electedNodes[i].colspan) {
                    colspanSum--;
                    break;
                }
            }
            loops++;
            if (loops > 20) {
                console.warn('fair resize: infinite loop detected while shrinking!');
                break;
            }
        } while (colspanSum >= colspan);
        if (!fillUnusedColspan) {
            return;
        }
        loops = 0;
        do {
            electedNodes = [];
            colspanSum = 0;
            for (var i = 0, len = this.children.length; i < len; i++) {
                electedNodes.push({
                    element: this.children[i],
                    canDecreaseColspan: 0,
                    colspan: (elementColspan = this.children[i].getColspan()),
                });
                colspanSum += elementColspan;
            }
            if (colspanSum >= colspan) {
                break;
            }
            electedNodes.sort(function (a, b) {
                return a.canDecreaseColspan - b.canDecreaseColspan;
            });
            for (var i = 0, len = electedNodes.length; i < len; i++) {
                electedNodes[i].element.withColspan(electedNodes[i].colspan + 1);
                if (electedNodes[i].element.getColspan() != electedNodes[i].colspan) {
                    colspanSum++;
                    break;
                }
            }
            loops++;
            if (loops > 20) {
                console.warn('fair resize: infinite loop detected while enlarging!');
                break;
            }
        } while (colspanSum < colspan);
    };
    RowContainer.prototype.withColspan = function (colspan) {
        if (null === colspan) {
            return _super.prototype.withColspan.call(this, colspan);
        }
        this.makeElementsToFitColspanUsingTheFairResizingAlgorithm(colspan);
        return _super.prototype.withColspan.call(this, colspan);
    };
    RowContainer.prototype.getColspan = function () {
        var colspan = _super.prototype.getColspan.call(this);
        if (null === colspan) {
            if (null !== this.getParent()) {
                colspan = this.getParent().getColspan();
            }
        }
        return null === colspan
            ? 20
            : colspan;
    };
    RowContainer.prototype.isRemovable = function () {
        return true;
    };
    RowContainer.prototype.isDuplicatable = function () {
        return false;
    };
    RowContainer.prototype.isSelectable = function () {
        return false;
    };
    RowContainer.prototype.isDragable = function () {
        return false;
    };
    RowContainer.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return false;
    };
    RowContainer.prototype.enumerateTranslations = function () {
        return [];
    };
    RowContainer.nodeName = 'virtual-form-table-row';
    RowContainer.attributes = {};
    RowContainer.runtime = null;
    return RowContainer;
}(FormContainer));
var DivContainer = (function (_super) {
    __extends(DivContainer, _super);
    function DivContainer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DivContainer.prototype.getTypeId = function () {
        return ElementTypes.CONTAINER_TYPE_DIV;
    };
    DivContainer.prototype.getElementName = function () {
        return 'Div';
    };
    DivContainer.getConfiguration = function () {
        return {
            category: "containers",
            icon: "i123-date",
            isContainer: true,
            keywords: "div container",
            name: "Div",
            typeId: ElementTypes.CONTAINER_TYPE_DIV,
            isVirtual: true,
            index: 99999,
            accessibilityFields: EFieldAccessibilityNodesBitmask.NONE,
        };
    };
    DivContainer.prototype.getResizingCapability = function () {
        return EResizingCapability.LEFT_AND_RIGHT;
    };
    DivContainer.prototype.withColspan = function (colspan) {
        _super.prototype.withColspan.call(this, colspan);
        if (this.children.length) {
            for (var i = 0, len = this.children.length; i < len; i++) {
                if (this.children[i].getTypeId() === ElementTypes.CONTAINER_TYPE_ROW) {
                    this.children[i].withColspan(colspan);
                    this.children[i].makeElementsToFitColspanUsingTheFairResizingAlgorithm(colspan, true);
                }
            }
        }
        return this;
    };
    DivContainer.prototype.unwrap = function () {
        while (this.children.length) {
            this.getParent().getParent().insertBefore(this.getParent(), this.getFirstChild());
        }
        this.getParent().removeChild(this);
        this.getForm().normalize();
    };
    DivContainer.prototype.isSelectable = function () {
        return false;
    };
    DivContainer.prototype.isDragable = function () {
        return false;
    };
    DivContainer.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return false;
    };
    DivContainer.prototype.enumerateTranslations = function () {
        return [];
    };
    DivContainer.attributes = {};
    DivContainer.runtime = null;
    DivContainer.nodeName = 'div';
    return DivContainer;
}(FormContainer));
var removeControlsAction = EditorUI.Actions.removeControls;
var appendUniqueControl = EditorUI.Actions.appendUniqueControl;
var LikertContainer = (function (_super) {
    __extends(LikertContainer, _super);
    function LikertContainer(form, elementProperties) {
        var _this = _super.call(this, form, elementProperties) || this;
        _this.headerScaleI18nTexts = [];
        _this.labelI18nText = null;
        var hash = _this.getHash();
        _this.labelDOMNode = document.createElement('label');
        _this.labelDOMNode.setAttribute('data-role', 'label');
        _this.labelDOMNode.setAttribute('id', "likertwrapper-" + hash + "-acc");
        _this.errorDOMNode = document.createElement('label');
        _this.errorDOMNode.setAttribute('data-role', 'error');
        _this.errorDOMNode.setAttribute('id', "likertwrapper-" + hash + "-error-acc");
        _this.instructionsDOMNode = document.createElement('dt');
        _this.instructionsDOMNode.setAttribute('data-role', 'instructions');
        _this.instructionsDOMNode.setAttribute('aria-labelledby', "likertwrapper-" + hash + "-instr-acc");
        _this.likertHeaderDOMNode = document.createElement('div');
        _this.likertHeaderDOMNode.setAttribute('data-role', 'likert-header');
        _this.likertHeaderCSSDOMNode = document.createElement('style');
        _this.rootNode.tabIndex = 0;
        _this.rootNode.setAttribute('aria-labelledby', "likertwrapper-" + hash + "-acc " +
            ("likertwrapper-" + hash + "-error-acc ") +
            ("likertwrapper-" + hash + "-instr-acc"));
        _this.init();
        _this.updateAccessibilityTabIndexes();
        return _this;
    }
    LikertContainer.prototype.onCreated = function () {
        var _this = this;
        this.updateLabelText();
        this.updateErrorsText();
        this.updateInstructionsText();
        this.updateRequiredState();
        this.updateShowInstructionsOnClick();
        this.updateBoldOptionsState();
        this.updateChoiceTextAlignment();
        this.updateHiddenAttribute();
        this.setupDOMEvents();
        for (var i = 0, children = this.getChildren() || [], len = children.length; i < len; i++) {
            children[i].onCreated();
        }
        setTimeout(function () {
            _this.updateRequiredState();
            if (_this.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW) {
                _this.randomizeOptions();
            }
        }, 100);
    };
    LikertContainer.prototype.getTypeId = function () {
        return ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER;
    };
    LikertContainer.prototype.getElementName = function () {
        return 'Likert scale';
    };
    LikertContainer.getConfiguration = function () {
        return {
            typeId: ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
            name: 'Likert Scale',
            isContainer: false,
            category: 'advanced',
            keywords: 'likert scale radio radios matrix',
            icon: 'i123-editor_field_likertscale',
            isVirtual: false,
            i18nName: 'edt_UI_control_type_likert_scale_name',
            i18nKeywords: 'edt_UI_control_type_likert_scale_keywords',
            index: 105,
            accessibilityFields: EFieldAccessibilityNodesBitmask.ROOT_NODE,
        };
    };
    LikertContainer.prototype.appendChild = function (child) {
        if (!child) {
            throw new Error('Attempted to append a invalid element!');
        }
        if (child.getTypeId() === ElementTypes.CONTROL_TYPE_LIKERT_SCALE) {
            var result = _super.prototype.appendChild.call(this, child);
            this.reRender();
            child.setupI18n();
            var action = appendUniqueControl(result);
            this.store.dispatch(action);
            return result;
        }
        else {
            throw new Error('Attempted to append a non-likert-scale element inside a likert wrapper');
        }
    };
    LikertContainer.prototype.insertBefore = function (referenceChild, child) {
        if (!child) {
            throw new Error('Invalid argument "child": IFormElement expected!');
        }
        if (child.getTypeId() === ElementTypes.CONTROL_TYPE_LIKERT_SCALE) {
            var result = _super.prototype.insertBefore.call(this, referenceChild, child);
            this.reRender();
            child.setupI18n();
            return result;
        }
        else {
            throw new Error('Attempted to insert a non-likert-scale element inside a likert wrapper');
        }
    };
    LikertContainer.prototype.insertAfter = function (referenceChild, child) {
        if (!child) {
            throw new Error('Invalid argument "child": IFormElement expected!');
        }
        if (child.getTypeId() === ElementTypes.CONTROL_TYPE_LIKERT_SCALE) {
            var result = _super.prototype.insertAfter.call(this, referenceChild, child);
            this.reRender();
            child.setupI18n();
            return result;
        }
        else {
            throw new Error('Attempted to insert a non-likert-scale element inside a likert wrapper');
        }
    };
    LikertContainer.prototype.removeChild = function (child) {
        var result = _super.prototype.removeChild.call(this, child);
        this.reRender();
        var action = removeControlsAction([child]);
        this.store.dispatch(action);
        return result;
    };
    LikertContainer.prototype.isRenderingSupported = function () {
        return true;
    };
    LikertContainer.prototype.getResizingCapability = function () {
        return EResizingCapability.LEFT_AND_RIGHT;
    };
    LikertContainer.prototype.getChoiceStatements = function () {
        var result = [];
        for (var i = 0, children = this.getChildren() || [], len = children.length; i < len; i++) {
            result.push({
                text: this.children[i].getProperty('label.labelText'),
                i18n: this.children[i].getProperty('label.i18nLabelKey')
            });
        }
        return result && result.length
            ? result
            : null;
    };
    LikertContainer.prototype.setupNewStatement = function (statement, options) {
        statement.setProperty('label.widthInUnits', options.labelWidthInUnits);
        statement.setProperty('options.inlineOptions', options.inlineOptions);
        statement.setProperty('options.boldOptions', options.boldOptions);
        if (null !== options.choices) {
            var choices = [];
            for (var i = 0, len = options.choices.length; i < len; i++) {
                var choice = {
                    isCorrect: typeof options.choices[i].isCorrect !== 'undefined' && options.choices[i].isCorrect !== null
                        ? options.choices[i].isCorrect
                        : null,
                    isDefault: typeof options.choices[i].isDefault !== 'undefined' && options.choices[i].isDefault !== null
                        ? options.choices[i].isDefault
                        : null,
                    numberOfTimesThisOptionCanBeChosen: 0,
                    numberOfTimesThisOptionHasBeenChosen: 0,
                    quizPoints: 0,
                    text: options.choices[i].text
                };
                choices.push(choice);
            }
            statement.setProperty('choices.values', choices);
        }
        statement.reRender();
        statement.updateChoices();
    };
    LikertContainer.prototype.setChoiceStatements = function (statements) {
        var _this = this;
        var newStatements = FormUtils.trimChoices(statements) || [], children = this.getChildren(), diffChildren = newStatements.length - children.length, engine = this.getForm().getEngine(), statement, labelWidthInUnits = children[0]
            ? children[0].getProperty('label.widthInUnits')
            : null, boldOptions = this.getProperty('options.boldOptions'), inlineOptions = this.getProperty('options.inlineOptions'), choices = children[0]
            ? children[0].getProperty('choices.values')
            : null;
        while (diffChildren != 0) {
            if (diffChildren < 0) {
                this.removeChild(children.pop());
                diffChildren++;
            }
            else {
                statement = engine.createElement(ElementTypes.CONTROL_TYPE_LIKERT_SCALE);
                this.setupNewStatement(statement, {
                    labelWidthInUnits: labelWidthInUnits,
                    boldOptions: boldOptions,
                    inlineOptions: inlineOptions,
                    choices: choices
                });
                children.push(statement);
                this.appendChild(statement);
                diffChildren--;
            }
        }
        var updateLabelText;
        for (var i = 0, len = children.length; i < len; i++) {
            updateLabelText = false;
            if (children[i].getProperty('label.labelText') !== newStatements[i].text) {
                children[i].setProperty('label.labelText', newStatements[i].text);
                updateLabelText = true;
            }
            newStatements[i].i18n = newStatements[i].i18n || null;
            if (children[i].getProperty('label.i18nLabelKey') !== newStatements[i].i18n) {
                children[i].setProperty('label.i18nLabelKey', newStatements[i].i18n);
                updateLabelText = true;
            }
            if (updateLabelText) {
                children[i].updateLabelText();
            }
        }
        setTimeout(function () {
            _this.reRender();
        }, 100);
    };
    LikertContainer.prototype.getInputDOMNodes = function () {
        var inlineOptions = this.getProperty('options.inlineOptions'), result = [], children = this.getChildren() || [];
        if (inlineOptions) {
        }
        else if (!this.getForm().getEngine().getTheme().isMobileLayout()) {
            result.push({
                inputs: [
                    {
                        input: this.likertHeaderDOMNode,
                        width: EInputWidth.FULL
                    }
                ]
            });
        }
        for (var i = 0, len = children.length; i < len; i++) {
            children[i].updateChoices();
            result.push({
                inputs: [
                    {
                        input: children[i].getRootNode(),
                        width: EInputWidth.FULL
                    }
                ]
            });
        }
        return result;
    };
    LikertContainer.prototype.getChoiceScale = function () {
        var children = this.getChildren() || [];
        if (children.length === 0) {
            return null;
        }
        else {
            return children.map(function (child) { return child.getProperty('choices.values'); });
        }
    };
    LikertContainer.prototype.setChoiceScale = function (scale) {
        var children = this.getChildren() || [];
        for (var i = 0, len = children.length; i < len; i++) {
            var statementScale = [];
            for (var j = 0, len2 = scale[i].length; j < len2; j++) {
                var scaleChoice = {
                    text: scale[i][j].text,
                    isDefault: typeof scale[i][j].isDefault !== 'undefined' && scale[i][j].isDefault !== null
                        ? scale[i][j].isDefault
                        : null,
                    isCorrect: scale[i][j] && typeof scale[i][j].isCorrect !== 'undefined' && scale[i][j].isCorrect !== null
                        ? scale[i][j].isCorrect
                        : null,
                    quizPoints: scale[i][j] && typeof scale[i][j].quizPoints !== 'undefined' && scale[i][j].quizPoints !== null
                        ? scale[i][j].quizPoints
                        : null,
                    numberOfTimesThisOptionCanBeChosen: typeof scale[i][j].numberOfTimesThisOptionCanBeChosen !== 'undefined'
                        && scale[i][j].numberOfTimesThisOptionCanBeChosen !== null
                        ? scale[i][j].numberOfTimesThisOptionCanBeChosen
                        : null,
                    paymentsValue: typeof scale[i][j].paymentsValue !== 'undefined' && scale[i][j].paymentsValue !== null
                        ? scale[i][j].paymentsValue
                        : null,
                    i18nLabel: typeof scale[i][j].i18nLabel !== 'undefined' && scale[i][j].i18nLabel !== null
                        ? scale[i][j].i18nLabel
                        : null,
                };
                statementScale.push(scaleChoice);
            }
            children[i].setProperty('choices.values', statementScale);
        }
        this.updateLikertHeader();
    };
    LikertContainer.prototype.updateLikertHeader = function (widthOnly) {
        if (widthOnly === void 0) { widthOnly = false; }
        if (!widthOnly) {
            var inlineOptions = this.getProperty('options.inlineOptions');
            var scale = this.getChildren().length > 0 && this.getChildren()[0].getProperty('choices.values') || [], scaleColumn = void 0;
            var numScaleColumns = scale.length, likertHashId = this.getHash();
            var cssContent = "width: calc( (100% - " + numScaleColumns + "px) / " + numScaleColumns + ") !important;";
            if (this.getForm().getEngine().getTheme().isMobileLayout()) {
                cssContent = 'display: block !important';
            }
            this.likertHeaderCSSDOMNode.textContent = "\n            div[data-role=container][data-type=likert-wrapper][data-hash=\"" + likertHashId + "\"] div[data-role=likert-header] > * {" + cssContent + "}";
            this.getRootNode().appendChild(this.likertHeaderCSSDOMNode);
            if (!inlineOptions) {
                this.likertHeaderDOMNode.innerHTML = '';
                for (var i = 0, len = scale.length; i < len; i++) {
                    scaleColumn = document.createElement('div');
                    scaleColumn.setAttribute('data-role', 'scale-column');
                    scaleColumn.setAttribute('id', "likert-scale-column-" + likertHashId + "-" + i);
                    scaleColumn.setAttribute('data-skip-markdown', 'true');
                    scaleColumn.textContent = scale[i].text;
                    this.likertHeaderDOMNode.appendChild(scaleColumn);
                    if (this.headerScaleI18nTexts[i]) {
                        scaleColumn.setAttribute('data-i18n-text', this.headerScaleI18nTexts[i]);
                        scaleColumn.setAttribute('data-skip-markdown', this.headerScaleI18nTexts[i]);
                    }
                }
            }
        }
        var inputColumnWidth = null;
        (function ($, rootNode) {
            $(rootNode).find('> div[data-role=input-row]:not([data-is-first-row])').first().each(function () {
                $(this).find('> div[data-role=control] > div[data-role=input-column]').first().each(function () {
                    inputColumnWidth = this.getAttribute('data-colspan');
                });
            });
        })(this.getForm().getEngine().getJQuery(), this.rootNode);
        inputColumnWidth = String(inputColumnWidth || '');
        if (inputColumnWidth) {
            this.likertHeaderDOMNode.setAttribute('data-colspan', inputColumnWidth);
        }
        else {
            this.likertHeaderDOMNode.removeAttribute('data-colspan');
        }
    };
    LikertContainer.prototype.setRendererType = function (rendererType) {
        switch (rendererType) {
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD:
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL:
            case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                _super.prototype.setRendererType.call(this, rendererType);
                break;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD:
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD:
                _super.prototype.setRendererType.call(this, EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD);
                break;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL:
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL:
                _super.prototype.setRendererType.call(this, EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL);
                break;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
                _super.prototype.setRendererType.call(this, EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD);
                break;
            case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
            case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                _super.prototype.setRendererType.call(this, EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD);
                break;
            default:
                _super.prototype.setRendererType.call(this, EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD);
                break;
        }
        this.updateLikertHeader();
    };
    LikertContainer.prototype.updateLabelWidthInUnitsToChildNodes = function (newLabelWidthInUnits) {
        var children = this.getChildren() || [];
        for (var i = 0, len = children.length; i < len; i++) {
            if (children[i].getProperty('label.widthInUnits') !== newLabelWidthInUnits) {
                children[i].setProperty('label.widthInUnits', newLabelWidthInUnits);
                children[i].reRender();
            }
        }
        this.updateLikertHeader(true);
    };
    LikertContainer.prototype.setupDefaults = function () {
        this.setProperty('choices.statements', [
            {
                'text': 'Statement 1',
            },
            {
                'text': 'Statement 2',
            },
            {
                'text': 'Statement 3',
            }
        ]);
        this.setProperty('choices.scale', [
            [
                {
                    text: 'Very Good',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Good',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Fair',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Poor',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Very Poor',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                }
            ],
            [
                {
                    text: 'Very Good',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    numberOfTimesThisOptionHasBeenChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Good',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    numberOfTimesThisOptionHasBeenChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Fair',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    numberOfTimesThisOptionHasBeenChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Poor',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    numberOfTimesThisOptionHasBeenChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Very Poor',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    numberOfTimesThisOptionHasBeenChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                }
            ],
            [
                {
                    text: 'Very Good',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Good',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Fair',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Poor',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                },
                {
                    text: 'Very Poor',
                    isCorrect: null,
                    isDefault: null,
                    numberOfTimesThisOptionCanBeChosen: null,
                    paymentsValue: null,
                    quizPoints: null,
                }
            ]
        ]);
        this.setProperty('label.labelText', this.getForm().getEngine().getI18n().translateText('edt_UI_control_type_likert_scale_name'));
        this.updateLabelText();
        return this;
    };
    LikertContainer.prototype.updateBoldOptionsState = function () {
        var hasBoldOptions = this.getProperty('options.boldOptions');
        for (var childNodes = this.getChildren() || [], i = 0, len = childNodes.length; i < len; i++) {
            childNodes[i].setProperty('options.boldOptions', hasBoldOptions);
        }
        if (hasBoldOptions) {
            this.rootNode.setAttribute('data-has-bold-options', '');
        }
        else {
            this.rootNode.removeAttribute('data-has-bold-options');
        }
    };
    LikertContainer.prototype.updateInlineOptionsState = function () {
        var hasInlineOptions = this.getProperty('options.inlineOptions');
        for (var childNodes = this.getChildren() || [], i = 0, len = childNodes.length; i < len; i++) {
            childNodes[i].setProperty('options.inlineOptions', hasInlineOptions);
        }
        this.reRender();
    };
    LikertContainer.prototype.updateChoiceTextAlignment = function () {
        var choiceTextAlignment = this.getProperty('options.choiceTextAlignment');
        switch (choiceTextAlignment) {
            case 'center':
                this.rootNode.setAttribute('data-choice-text-alignment', 'center');
                break;
            case 'right':
                this.rootNode.setAttribute('data-choice-text-alignment', 'right');
                break;
            case 'left':
            default:
                this.rootNode.setAttribute('data-choice-text-alignment', 'left');
                break;
        }
    };
    LikertContainer.prototype.isRequired = function () {
        var children = this.getChildren();
        for (var i = 0, len = children.length; i < len; i++) {
            if (!children[i].getProperty('options.required')) {
                return false;
            }
        }
        return children.length > 0
            ? true
            : false;
    };
    LikertContainer.prototype.setRequired = function (value) {
        var children = this.getChildren();
        for (var i = 0, len = children.length; i < len; i++) {
            if (children[i].hasProperty('options.required')) {
                children[i].setProperty('options.required', value);
            }
        }
        this.updateRequiredState();
    };
    LikertContainer.prototype.setupDOMEvents = function () {
        (function ($, self) {
            function handleFocusInternally(direction, forceTabbingInsideTheSameRow) {
                if (-1 === direction && self.rootNode === document.activeElement) {
                    return false;
                }
                var radios = Array.prototype.slice.call(self.rootNode.querySelectorAll('label[data-role=checkbox]'), 0), currentFocusedRadioIndex = null;
                for (var i = 0, len = radios.length; i < len; i++) {
                    if (document.activeElement === radios[i]) {
                        currentFocusedRadioIndex = i;
                        break;
                    }
                }
                if (null === currentFocusedRadioIndex) {
                    return false;
                }
                var currentRadioInputRow = null, nextFocusedParentInputRow = null;
                if (forceTabbingInsideTheSameRow) {
                    currentRadioInputRow = $(radios[currentFocusedRadioIndex]).closest('div[data-role=input-row]').get(0);
                }
                currentFocusedRadioIndex += direction;
                if (forceTabbingInsideTheSameRow) {
                    nextFocusedParentInputRow = $(radios[currentFocusedRadioIndex]).closest('div[data-role=input-row]').get(0);
                    if (currentRadioInputRow !== nextFocusedParentInputRow) {
                        return false;
                    }
                }
                if (currentFocusedRadioIndex < 0) {
                    return false;
                }
                if (currentFocusedRadioIndex >= radios.length) {
                    return false;
                }
                radios[currentFocusedRadioIndex].focus();
                if (document.activeElement !== radios[currentFocusedRadioIndex]) {
                    setTimeout(function () {
                        $(radios[currentFocusedRadioIndex]).focus();
                    }, 0);
                    return false;
                }
                return true;
            }
            self.rootNode.addEventListener('keydown', function (e) {
                var key = e.keyCode || e.charCode, cancelKey = false, numberOfChoicesPerRow = 1;
                try {
                    numberOfChoicesPerRow = self.rootNode.querySelector('div[data-role=input-row]').querySelectorAll('label[data-role=checkbox], div[data-role=scale-column]').length;
                }
                catch (e) {
                }
                switch (key) {
                    case KeyboardUtils.KEY_TAB:
                        if (e.shiftKey) {
                            cancelKey = handleFocusInternally(-1, false);
                        }
                        else {
                            cancelKey = handleFocusInternally(1, false);
                        }
                        break;
                    case KeyboardUtils.KEY_LEFT:
                        cancelKey = handleFocusInternally(-1, true);
                        break;
                    case KeyboardUtils.KEY_UP:
                        cancelKey = handleFocusInternally(-numberOfChoicesPerRow, false);
                        break;
                    case KeyboardUtils.KEY_RIGHT:
                        cancelKey = handleFocusInternally(1, true);
                        break;
                    case KeyboardUtils.KEY_DOWN:
                        cancelKey = handleFocusInternally(numberOfChoicesPerRow, false);
                        break;
                }
                if (cancelKey) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            }, true);
        })(this.getForm().getEngine().getJQuery(), this);
    };
    LikertContainer.prototype.init = function () {
        var _this = this;
        this.setupI18nAsync = Throttle.create(function () {
            _this.setupI18n();
        }, 0);
        this.on('translation-set', function (scaleIndex, scaleTranslation) {
            if (null !== scaleIndex) {
                _this.headerScaleI18nTexts[scaleIndex] = _this.headerScaleI18nTexts[scaleIndex] || scaleTranslation;
            }
            else {
                _this.labelI18nText = scaleTranslation;
            }
            _this.setupI18nAsync();
        });
        this.on('child-visibility-changed', function () {
            _this.hideContainerIfAllChildrenAreNotShown();
        });
    };
    LikertContainer.prototype.setupI18n = function () {
        if (this.headerScaleI18nTexts.length) {
            if (this.likertHeaderDOMNode) {
                for (var i = 0, nodes = this.likertHeaderDOMNode.children, len = nodes.length; i < len; i++) {
                    if (this.headerScaleI18nTexts[i]) {
                        nodes[i].setAttribute('data-i18n-text', this.headerScaleI18nTexts[i]);
                    }
                }
            }
        }
        if (this.labelI18nText) {
            this.labelDOMNode.setAttribute('data-i18n-text', this.labelI18nText);
        }
        this.getForm().getEngine().getI18n().translateDOMNode(this.getRootNode());
        return _super.prototype.setupI18n.call(this);
    };
    LikertContainer.prototype.updateHiddenAttribute = function () {
        var isHidden = this.hasProperty('options.hidden') && this.getProperty('options.hidden');
        if (isHidden) {
            this.rootNode.setAttribute('data-is-hidden', '1');
        }
        else {
            this.rootNode.removeAttribute('data-is-hidden');
        }
    };
    LikertContainer.prototype.randomizeOptions = function () {
        if (this.hasProperty('options.randomizeOrder') && this.getProperty('options.randomizeOrder')) {
            var elements = [];
            for (var i = 0, children = this.getChildren(), len = children.length; i < len; i++) {
                elements.push({
                    index: i,
                    child: children[i],
                    node: children[i].getRootNode()
                });
            }
            elements = FormUtils.shuffle(elements);
            for (var i = 0, len = elements.length; i < len; i++) {
                this.rootNode.appendChild(elements[i].node);
            }
        }
        else {
            if (this.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.EDIT) {
                for (var i = 0, children = this.getChildren(), len = children.length; i < len; i++) {
                    this.rootNode.appendChild(children[i].getRootNode());
                }
            }
        }
    };
    LikertContainer.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return true;
    };
    LikertContainer.prototype.updateAccessibilityTabIndexes = function () {
        var _this = this;
        _super.prototype.updateAccessibilityTabIndexes.call(this);
        var hasAccessibilityEnabled = this.getForm().getConfiguration().getProperty('hasAccessibilityEnabled', false);
        setTimeout(function () {
            if (hasAccessibilityEnabled) {
                for (var i = 0, children = _this.getChildren(), len = children.length; i < len; i++) {
                    var choices = children[i].flatten()[0];
                    var label = choices.getRootNode().querySelectorAll('label[data-role=checkbox]');
                    for (var k = 0, length_6 = label.length; k < length_6; k++) {
                        label[k].setAttribute('aria-labelledby', "likert-scale-column-" + _this.getHash() + "-" + k);
                    }
                }
            }
        }, 500);
    };
    LikertContainer.prototype.hideContainerIfAllChildrenAreNotShown = function () {
        var likertScalesAreHidden = true;
        for (var i = 0, children = this.getChildren() || [], len = children.length; i < len; i++) {
            if (children[i].isVisible()) {
                likertScalesAreHidden = false;
                break;
            }
        }
        if (likertScalesAreHidden) {
            this.rootNode.setAttribute('data-is-hidden', '1');
        }
        else {
            this.rootNode.removeAttribute('data-is-hidden');
        }
    };
    LikertContainer.prototype.onFocusEnter = function () {
        if (!this.getRootNode().hasAttribute('data-is-active')) {
            this.getRootNode().setAttribute('data-is-active', '1');
        }
    };
    LikertContainer.prototype.onFocusLeave = function () {
        if (this.getRootNode().hasAttribute('data-is-active')) {
            this.getRootNode().removeAttribute('data-is-active');
        }
    };
    LikertContainer.prototype.enumerateTranslations = function () {
        var result = [];
        var labelText = this.getProperty('label.labelText') || '', instructionsText = this.getProperty('instructions.text') || '';
        var children = this.getChildren() || [], syncWith, addIndex = 0, childLabel, choiceScale;
        for (var i = 0, len = children.length; i < len; i++) {
            if (!children[i].getId()) {
                continue;
            }
            if (0 === addIndex) {
                syncWith = String(children[i].getId());
                if (labelText) {
                    result.push({
                        key: "likert_headline_" + children[i].getId(),
                        sourceText: labelText,
                    });
                }
                if (instructionsText) {
                    result.push({
                        key: "likert_instructions_" + children[i].getId(),
                        sourceText: instructionsText,
                    });
                }
                childLabel = children[i].getProperty('label.labelText') || '';
                if (childLabel) {
                    result.push({
                        key: "control_label_" + children[i].getId(),
                        sourceText: childLabel,
                    });
                }
                choiceScale = children[i].getProperty('choices.values') || [];
                for (var j = 0, n = choiceScale.length; j < n; j++) {
                    result.push({
                        key: "control_label_" + children[i].getId() + "_choice_" + j,
                        sourceText: choiceScale[j].text,
                    });
                }
            }
            else {
                if (labelText) {
                    result.push({
                        key: "likert_headline_" + children[i].getId(),
                        sourceText: labelText,
                        hidden: true,
                        syncWith: "likert_headline_" + syncWith
                    });
                }
                if (instructionsText) {
                    result.push({
                        key: "likert_instructions_" + children[i].getId(),
                        sourceText: instructionsText,
                        hidden: true,
                        syncWith: "likert_instructions_" + syncWith,
                    });
                }
                childLabel = children[i].getProperty('label.labelText') || '';
                if (childLabel) {
                    result.push({
                        key: "control_label_" + children[i].getId(),
                        sourceText: childLabel,
                    });
                }
                choiceScale = children[i].getProperty('choices.values') || [];
                for (var j = 0, n = choiceScale.length; j < n; j++) {
                    result.push({
                        key: "control_label_" + children[i].getId() + "_choice_" + j,
                        sourceText: choiceScale[j].text,
                        hidden: true,
                        syncWith: "control_label_" + syncWith + "_choice_" + j,
                    });
                }
            }
            addIndex++;
        }
        return result;
    };
    LikertContainer.prototype.setStatementsWithChoicesValues = function (statementsWithChoices) {
        var children = this.getChildren() || [];
        for (var i = 0, len1 = statementsWithChoices.statements.length; i < len1; i++) {
            var statement = statementsWithChoices.statements[i];
            for (var j = 0, len2 = statement.choices.length; j < len2; j++) {
                var choice = statement.choices[j];
                choice.quizPoints = parseInt(choice.quizPoints);
                choice.i18nLabel = null;
            }
        }
        for (var i = 0, len = children.length; i < len; i++) {
            children[i].setProperty('choices.values', statementsWithChoices.statements[i].choices);
        }
    };
    LikertContainer.attributes = {};
    LikertContainer.runtime = null;
    LikertContainer.nodeName = 'likert-wrapper';
    return LikertContainer;
}(FormContainer));
var RepeatableContainer = (function (_super) {
    __extends(RepeatableContainer, _super);
    function RepeatableContainer(form, elementProperties) {
        var _this = _super.call(this, form, elementProperties) || this;
        var hash = _this.getHash();
        _this.labelDOMNode = document.createElement('label');
        _this.labelDOMNode.setAttribute('data-role', 'label');
        _this.labelDOMNode.setAttribute('id', 'repeatable-' + hash + '-acc');
        _this.instructionsDOMNode = document.createElement('dt');
        _this.instructionsDOMNode.setAttribute('data-role', 'instructions');
        _this.instructionsDOMNode.setAttribute('aria-labelledby', 'repeatable-' + hash + '-instr-acc');
        _this.rootNode.tabIndex = 0;
        _this.rootNode.setAttribute('aria-labelledby', 'repeatable-' + hash + '-acc ' +
            'repeatable-' + hash + '-error-acc ' +
            'repeatable-' + hash + '-instr-acc');
        _this.body = document.createElement('div');
        _this.body.setAttribute('data-role', 'body');
        _this.addGroupButton = document.createElement('button');
        _this.addGroupButton.setAttribute('data-role', 'add-group-button');
        _this.addGroupButton.setAttribute('type', 'button');
        _this.rootNode.appendChild(_this.labelDOMNode);
        _this.rootNode.appendChild(_this.instructionsDOMNode);
        _this.rootNode.appendChild(_this.body);
        _this.rootNode.appendChild(_this.addGroupButton);
        _this.init();
        return _this;
    }
    RepeatableContainer.prototype.init = function () {
        this.onAddButtonTextChanged();
        this.onBorderSettingsChanged();
        if (this.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW) {
            this.initViewFormEvents();
        }
    };
    RepeatableContainer.prototype.onCreated = function () {
        this.updateLabelText();
        this.updateInstructionsText();
        this.onAddButtonTextChanged();
        this.onBorderSettingsChanged();
        this.updateMaxLimitReachedAttribute(null, null);
    };
    RepeatableContainer.prototype.setupDefaults = function () {
        this.appendChild(this.getForm().getEngine().getFactory().createItemByTypeId(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP, this.getForm()));
        this.setProperty('label.labelText', 'Repeatable container');
        this.updateLabelText();
        return this;
    };
    RepeatableContainer.prototype.getTypeId = function () {
        return ElementTypes.CONTAINER_TYPE_REPEATABLE;
    };
    RepeatableContainer.prototype.getElementName = function () {
        return 'Repeatable container';
    };
    RepeatableContainer.getConfiguration = function () {
        return {
            typeId: ElementTypes.CONTAINER_TYPE_REPEATABLE,
            name: 'Repeatable container',
            isContainer: true,
            category: 'advanced',
            keywords: 'repeatable container',
            icon: 'i123-repeatable_container',
            isVirtual: false,
            i18nName: 'edt_UI_container_type_repeatable',
            i18nKeywords: 'edt_UI_container_type_repeatable_keywords',
            index: 155,
            accessibilityFields: EFieldAccessibilityNodesBitmask.ROOT_NODE,
            isBetaFeature: true,
        };
    };
    RepeatableContainer.prototype.appendChild = function (child) {
        if (!child || (child.getTypeId() !== ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP)) {
            throw new Error('Element type ' + child.getElementName() + ' is not supported directly in the form root!');
        }
        return _super.prototype.appendChild.call(this, child);
    };
    RepeatableContainer.prototype.insertBefore = function (referenceChild, child) {
        if (!child || (child.getTypeId() !== ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP)) {
            throw new Error('Element type not supported directly in the form root!');
        }
        if (referenceChild === child) {
            throw new Error('Invalid argument: reference and child are the same!');
        }
        return _super.prototype.insertBefore.call(this, referenceChild, child);
    };
    RepeatableContainer.prototype.insertAfter = function (referenceChild, child) {
        if (!child || (child.getTypeId() !== ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP)) {
            throw new Error('Element type not supported directly in the form root!');
        }
        if (referenceChild === child) {
            throw new Error('Invalid argument: reference and child are the same!');
        }
        return _super.prototype.insertAfter.call(this, referenceChild, child);
    };
    RepeatableContainer.prototype.removeChild = function (child) {
        return _super.prototype.removeChild.call(this, child);
    };
    RepeatableContainer.prototype.isRenderingSupported = function () {
        return true;
    };
    RepeatableContainer.prototype.getResizingCapability = function () {
        return EResizingCapability.LEFT_AND_RIGHT;
    };
    RepeatableContainer.prototype.setRendererType = function (rendererType) {
    };
    RepeatableContainer.prototype.setupI18n = function () {
        return this;
    };
    RepeatableContainer.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return true;
    };
    RepeatableContainer.prototype.getDOMInsertionNode = function () {
        return this.body;
    };
    RepeatableContainer.prototype.setProperty = function (attributeFQNAccessorPath, propertyValue) {
        return _super.prototype.setProperty.call(this, attributeFQNAccessorPath, propertyValue);
    };
    RepeatableContainer.prototype.onAddButtonTextChanged = function () {
        var addButtonText = this.getProperty('configuration.addButtonText');
        this.addGroupButton.textContent = String(addButtonText || '') || 'Add more';
    };
    RepeatableContainer.prototype.onBorderSettingsChanged = function () {
        var showBorders = this.getProperty('configuration.showBorders');
        if (showBorders) {
            this.rootNode.setAttribute('data-show-borders', '1');
        }
        else {
            this.rootNode.removeAttribute('data-show-borders');
        }
    };
    RepeatableContainer.prototype.initViewFormEvents = function () {
        var _this = this;
        this.addGroupButton.onclick = function () {
            _this.addNewGroup();
            FormUtils.refreshFrameHeightOnWix();
        };
    };
    RepeatableContainer.prototype.addNewGroup = function () {
        var numberOfGroupsAllowed = this.getProperty('configuration.maxNumberOfGroupsAllowed'), children = this.getChildren(), actualNumberOfGroups = children.length;
        if (numberOfGroupsAllowed <= actualNumberOfGroups) {
            return;
        }
        if (children.length < 1) {
            return;
        }
        this.updateMaxLimitReachedAttribute(numberOfGroupsAllowed, actualNumberOfGroups);
        var newGroup = children[0].cloneNode(true);
        this.getForm().getEngine().getI18n().translateDOMNode(newGroup.getDOMInsertionNode());
        this.appendChild(newGroup);
        return newGroup;
    };
    RepeatableContainer.prototype.updateMaxLimitReachedAttribute = function (numberOfGroupsAllowed, actualNumberOfGroups) {
        if (!numberOfGroupsAllowed) {
            numberOfGroupsAllowed = this.getProperty('configuration.maxNumberOfGroupsAllowed');
        }
        if (!actualNumberOfGroups) {
            actualNumberOfGroups = this.getChildren().length;
        }
        if (numberOfGroupsAllowed <= actualNumberOfGroups + 1) {
            this.rootNode.setAttribute('data-max-limit-reached', '1');
        }
    };
    RepeatableContainer.prototype.updateNumberOfGroupsAllowed = function () {
        var numberOfGroupsAllowed = this.getProperty('configuration.maxNumberOfGroupsAllowed');
        if (numberOfGroupsAllowed) {
            this.rootNode.setAttribute('data-max-number-of-groups', numberOfGroupsAllowed);
        }
    };
    RepeatableContainer.prototype.isRemovable = function () {
        return true;
    };
    RepeatableContainer.prototype.onRemoveGroupButtonClicked = function (group) {
        var children = this.getChildren(), groupIndex = children.indexOf(group), actualNumberOfGroups = children.length, numberOfGroupsAllowed = this.getProperty('configuration.maxNumberOfGroupsAllowed');
        if (children.length < 1) {
            return;
        }
        if (groupIndex === -1) {
            return;
        }
        if (numberOfGroupsAllowed >= actualNumberOfGroups - 1) {
            this.rootNode.removeAttribute('data-max-limit-reached');
        }
        this.removeChild(group);
        FormUtils.refreshFrameHeightOnWix();
    };
    RepeatableContainer.getDropDestinationCSSSelector = function () {
        return '#form > div[data-role=page] > div[data-role=page-body] *:not([data-role=container][data-type=repeatable]), #form > div[data-role=page] > div[data-role=page-body] *:not([data-role=container][data-type=repeatable]) *';
    };
    RepeatableContainer.prototype.enumerateDisabledProperties = function () {
        var result = this.getParent()
            ? this.getParent().enumerateDisabledProperties()
            : null, disabledPropertiesForRepeatableControls = [
            'synchronize.enabled',
            'synchronize.withControlId',
            'configuration.isLimitSubmissionsEnabled',
            'configuration.limitSubmissionsTotal',
            'configuration.currentSubmissionsValue'
        ];
        if (result) {
            result = result.concat(disabledPropertiesForRepeatableControls);
        }
        else {
            result = disabledPropertiesForRepeatableControls;
        }
        return result;
    };
    RepeatableContainer.prototype.isSelectable = function () {
        return true;
    };
    RepeatableContainer.prototype.cloneNode = function (cloneAttributes) {
        return _super.prototype.cloneNode.call(this, true, false);
    };
    RepeatableContainer.prototype.getPropertyDescriptorByInputIndex = function (inputIndex) {
        switch (inputIndex) {
            case 0:
                return {
                    targetPropertyFQN: 'label.label',
                    type: 'string',
                    optional: true,
                };
            default:
                return null;
        }
    };
    RepeatableContainer.prototype.isVisible = function (ignoreVisibilityFromConfig) {
        if (ignoreVisibilityFromConfig === void 0) { ignoreVisibilityFromConfig = false; }
        return this.visible;
    };
    RepeatableContainer.prototype.setVisible = function (visibilityState) {
        visibilityState = !!visibilityState;
        this.visible = visibilityState;
        if (this.visible) {
            this.getRootNode().removeAttribute('data-is-hidden');
            this.getForm().getEngine().getLoader().execCommand('control-has-changed-visibility', { controlId: this.getId(), visibility: this.visible, element: this });
        }
        else {
            this.getRootNode().setAttribute('data-is-hidden', '');
        }
        FormUtils.refreshFrameHeightOnWix();
    };
    RepeatableContainer.MAX_ALLOWED_NUMBER_OF_GROUPS = 60;
    RepeatableContainer.attributes = {};
    RepeatableContainer.runtime = null;
    RepeatableContainer.nodeName = 'repeatable';
    return RepeatableContainer;
}(FormContainer));
var RepeatableGroup = (function (_super) {
    __extends(RepeatableGroup, _super);
    function RepeatableGroup(form, elementProperties) {
        var _this = _super.call(this, form, elementProperties) || this;
        _this.body = document.createElement('div');
        _this.body.setAttribute('data-role', 'body');
        _this.removeGroupButton = document.createElement('button');
        _this.removeGroupButton.setAttribute('data-role', 'remove-group-button');
        _this.removeGroupButton.setAttribute('type', 'button');
        _this.removeGroupButton.innerHTML = '<i class="i123-close"></i>';
        _this.removeGroupButton.setAttribute('type', 'button');
        _this.rootNode.appendChild(_this.body);
        _this.rootNode.appendChild(_this.removeGroupButton);
        _this.init();
        return _this;
    }
    RepeatableGroup.prototype.init = function () {
        var _this = this;
        if (this.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.VIEW) {
            this.initViewFormEvents();
            setTimeout(function () {
                _this.updateRepeatableElementAttributes();
                _this.updateRepeatableElementPrefillAttributes();
            }, 1);
        }
        if (this.getForm().getEngine().getLoader().getLoaderType() === EFormLoaderType.EDIT) {
            this.updateEmptyStateDomNodes();
            setTimeout(function () {
                _this.updateEmptyStateAttribute();
            }, 1);
        }
    };
    RepeatableGroup.prototype.getTypeId = function () {
        return ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP;
    };
    RepeatableGroup.prototype.getElementName = function () {
        return 'Repeatable group';
    };
    RepeatableGroup.getConfiguration = function () {
        return {
            category: "containers",
            icon: "i123-date",
            isContainer: true,
            keywords: "div container",
            name: "Div",
            typeId: ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP,
            isVirtual: true,
            index: 12,
            accessibilityFields: EFieldAccessibilityNodesBitmask.NONE,
        };
    };
    RepeatableGroup.prototype.appendChild = function (child) {
        var _this = this;
        setTimeout(function () {
            _this.updateEmptyStateAttribute();
        }, 1);
        return _super.prototype.appendChild.call(this, child);
    };
    RepeatableGroup.prototype.insertBefore = function (referenceChild, child) {
        var _this = this;
        setTimeout(function () {
            _this.updateEmptyStateAttribute();
        }, 1);
        return _super.prototype.insertBefore.call(this, referenceChild, child);
    };
    RepeatableGroup.prototype.insertAfter = function (referenceChild, child) {
        var _this = this;
        setTimeout(function () {
            _this.updateEmptyStateAttribute();
        }, 1);
        return _super.prototype.insertAfter.call(this, referenceChild, child);
    };
    RepeatableGroup.prototype.removeChild = function (child) {
        var _this = this;
        setTimeout(function () {
            _this.updateEmptyStateAttribute();
        }, 1);
        return _super.prototype.removeChild.call(this, child);
    };
    RepeatableGroup.prototype.isRenderingSupported = function () {
        return false;
    };
    RepeatableGroup.prototype.getResizingCapability = function () {
        return EResizingCapability.NONE;
    };
    RepeatableGroup.prototype.setRendererType = function (rendererType) {
    };
    RepeatableGroup.prototype.setupI18n = function () {
        return this;
    };
    RepeatableGroup.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return false;
    };
    RepeatableGroup.prototype.getDOMInsertionNode = function () {
        return this.body;
    };
    RepeatableGroup.prototype.isRemovable = function () {
        return true;
    };
    RepeatableGroup.prototype.isDuplicatable = function () {
        return false;
    };
    RepeatableGroup.prototype.isDragable = function () {
        return false;
    };
    RepeatableGroup.prototype.isSelectable = function () {
        return false;
    };
    RepeatableGroup.prototype.getRepeatableGroupIndexAttribute = function () {
        return ~~this.rootNode.getAttribute('data-repeatable-index');
    };
    RepeatableGroup.prototype.setRepeatableGroupIndexAttribute = function (index) {
        this.rootNode.setAttribute('data-repeatable-index', String(index));
    };
    RepeatableGroup.prototype.getRepeatableGroupPathAttribute = function () {
        return this.rootNode.getAttribute('data-repeatable-path');
    };
    RepeatableGroup.prototype.setRepeatableGroupPathAttribute = function (path) {
        this.rootNode.setAttribute('data-repeatable-path', path);
    };
    RepeatableGroup.prototype.initViewFormEvents = function () {
        var _this = this;
        this.removeGroupButton.onclick = function () {
            var parent = _this.getParent();
            if (parent) {
                parent.onRemoveGroupButtonClicked(_this);
            }
        };
    };
    RepeatableGroup.prototype.updateEmptyStateDomNodes = function () {
        var emptyStateIcon = document.createElement('span'), emptyStateText = document.createElement('span');
        emptyStateIcon.className = 'i-lg i123-empty-page';
        emptyStateIcon.setAttribute('data-role', 'empty-state-icon');
        emptyStateText.textContent = 'Drag and drop fields here';
        emptyStateText.setAttribute('data-role', 'empty-state-text');
        this.body.appendChild(emptyStateIcon);
        this.body.appendChild(emptyStateText);
    };
    RepeatableGroup.prototype.hasControls = function () {
        return this.getChildren().length > 0;
    };
    RepeatableGroup.prototype.updateEmptyStateAttribute = function () {
        if (!this.hasControls()) {
            this.rootNode.setAttribute('data-empty-state', '1');
        }
        else {
            this.rootNode.removeAttribute('data-empty-state');
        }
    };
    RepeatableGroup.prototype.updateRepeatableElementAttributes = function () {
        var parentGroup = this.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP), parentContainer = this.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE), children = parentContainer.getChildren(), lastChild = children.slice(-2)[0], lastChildIndex = lastChild.getRepeatableGroupIndexAttribute(), newIndex = ~~lastChildIndex + 1, newGroupPath;
        if (parentGroup) {
            var oldGroupPath = parentGroup.getRepeatableGroupPathAttribute();
            newGroupPath = oldGroupPath + '.' + newIndex;
        }
        else {
            newGroupPath = newIndex;
        }
        this.setRepeatableGroupIndexAttribute(newIndex);
        this.setRepeatableGroupPathAttribute(newGroupPath);
    };
    RepeatableGroup.prototype.resetRepeatableElementAttributes = function () {
        var parentGroup = this.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP), parentContainer = this.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE), children = parentContainer.getChildren(), newGroupPath;
        if (parentGroup) {
            var oldGroupPath = parentGroup.getRepeatableGroupPathAttribute();
            if (children.length) {
                for (var i = 0, len = children.length; i < len; i++) {
                    var newIndex = i + 1;
                    newGroupPath = oldGroupPath + '.' + newIndex;
                    children[i].setRepeatableGroupIndexAttribute(newIndex);
                    children[i].setRepeatableGroupPathAttribute(newGroupPath);
                }
            }
        }
        else {
            if (children.length) {
                for (var i = 0, len = children.length; i < len; i++) {
                    var newIndex = i + 1;
                    newGroupPath = i + 1;
                    children[i].setRepeatableGroupIndexAttribute(newIndex);
                    children[i].setRepeatableGroupPathAttribute(newGroupPath);
                }
            }
        }
    };
    RepeatableGroup.prototype.removeRepeatableAttributes = function (element) {
        this.rootNode.removeAttribute('data-repeatable-index');
        this.rootNode.removeAttribute('data-repeatable-path');
    };
    RepeatableGroup.prototype.updateRepeatableElementPrefillAttributes = function () {
        var controls = this.getControlsRecursively(this);
        this.markSalesforceControlsWithDOMAttributeOnRepeatedControl(controls, this.getForm().getEngine().getLoader().getRules().getSalesforceAffectedControlsTriggers(), 'trigger');
        this.markSalesforceControlsWithDOMAttributeOnRepeatedControl(controls, this.getForm().getEngine().getLoader().getRules().getSalesforceAffectedControls(), 'normalField');
    };
    RepeatableGroup.prototype.getControlsRecursively = function (element) {
        var controls = [];
        if (element.getElementKind() === EElementKind.CONTAINER) {
            for (var i = 0, children = element.getChildren(), len = children.length; i < len; i++) {
                if (children[i].getElementKind() === EElementKind.CONTAINER) {
                    controls = controls.concat(this.getControlsRecursively(children[i]));
                }
                else if (children[i].getElementKind() === EElementKind.CONTROL) {
                    controls.push(children[i]);
                }
            }
        }
        else if (element.getElementKind() === EElementKind.CONTROL) {
            controls.push(element);
        }
        return controls;
    };
    RepeatableGroup.prototype.markSalesforceControlsWithDOMAttributeOnRepeatedControl = function (controls, salesforceAffectedControls, fieldType) {
        for (var i = 0, len = controls.length; i < len; i++) {
            var control = controls[i], rootNode = void 0;
            if (control && salesforceAffectedControls.indexOf('control_' + control.getId()) !== -1 && (rootNode = control.getRootNode())) {
                if (fieldType === 'trigger') {
                    rootNode.setAttribute('data-is-salesforce-prefill-trigger', '1');
                }
                else {
                    rootNode.setAttribute('data-is-salesforce-prefill-normal', '1');
                }
            }
        }
    };
    RepeatableGroup.attributes = {};
    RepeatableGroup.runtime = null;
    RepeatableGroup.nodeName = 'repeatable-group';
    return RepeatableGroup;
}(FormContainer));
var VirtualSelectionControl = (function (_super) {
    __extends(VirtualSelectionControl, _super);
    function VirtualSelectionControl(form, elements) {
        var _this = _super.call(this, form) || this;
        _this.commonProperties = {};
        _this.propertyValues = {};
        _this.addElements(elements);
        _this.computeCommonProperties();
        return _this;
    }
    VirtualSelectionControl.getConfiguration = function () {
        return {
            typeId: ElementTypes.VIRTUAL_SELECTION_CONTROL,
            name: 'Selection',
            isContainer: false,
            category: '',
            keywords: '',
            icon: '',
            isVirtual: false,
            i18nName: '',
            i18nKeywords: '',
            index: -1,
            accessibilityFields: EFieldAccessibilityNodesBitmask.NONE,
        };
    };
    VirtualSelectionControl.prototype.getId = function () {
        return null;
    };
    VirtualSelectionControl.prototype.getTypeId = function () {
        return ElementTypes.VIRTUAL_SELECTION_CONTROL;
    };
    VirtualSelectionControl.prototype.getHash = function () {
        return VirtualSelectionControl.STATIC_HASH;
    };
    VirtualSelectionControl.prototype.getElementName = function () {
        return 'Selection';
    };
    VirtualSelectionControl.prototype.createRootNodeElement = function () {
    };
    VirtualSelectionControl.prototype.getElementKind = function () {
        return EElementKind.CONTROL;
    };
    VirtualSelectionControl.prototype.serialize = function () {
        return null;
    };
    VirtualSelectionControl.prototype.isCountableWhenComputingFormNumberOfControls = function () {
        return false;
    };
    VirtualSelectionControl.prototype.computeCommonProperties = function () {
        var props, propertyName, optional, type;
        for (var j = 0, n = this.elements.length; j < n; j++) {
            props = this.elements[j].enumerateProperties();
            for (var i = 0, len = props.length; i < len; i++) {
                propertyName = props[i].name;
                optional = props[i].optional;
                type = props[i].type;
                if (VirtualSelectionControl.SUPPORTED_PROPERTIES[propertyName] !== true) {
                    continue;
                }
                if (j > 0) {
                    if (this.commonProperties[propertyName] === undefined) {
                        continue;
                    }
                    if (this.commonProperties[propertyName].type !== type || this.commonProperties[propertyName].optional !== optional) {
                        delete this.commonProperties[propertyName];
                        continue;
                    }
                    for (var k in this.commonProperties) {
                        if (this.commonProperties.hasOwnProperty(k) && !this.elements[j].hasProperty(k)) {
                            delete this.commonProperties[k];
                        }
                    }
                }
                else {
                    this.commonProperties[propertyName] = {
                        name: propertyName,
                        optional: optional,
                        type: type,
                        virtual: false,
                    };
                }
                if (propertyName === 'configuration.defaultValue'
                    && undefined !== this.commonProperties[propertyName]
                    && [
                        ElementTypes.CONTROL_TYPE_TIME,
                        ElementTypes.CONTROL_TYPE_DATE,
                    ].indexOf(this.elements[j].getTypeId()) > -1) {
                    delete this.commonProperties[propertyName];
                }
            }
        }
        var value;
        for (var k in this.commonProperties) {
            if (this.commonProperties.propertyIsEnumerable(k)) {
                for (var i = 0, len = this.elements.length; i < len; i++) {
                    if (!this.elements[i].hasProperty(k)) {
                        delete this.commonProperties[k];
                        break;
                    }
                    value = this.elements[i].getProperty(k);
                    if (i === 0) {
                        this.propertyValues[k] = value;
                    }
                    else {
                        if (this.propertyValues[k] !== value) {
                            this.propertyValues[k] = this.getDefaultValueForPropertyType(this.commonProperties[k]);
                            break;
                        }
                    }
                }
            }
        }
    };
    VirtualSelectionControl.prototype.hasProperty = function (attributeFQNAccessorPath) {
        return undefined !== this.commonProperties[attributeFQNAccessorPath];
    };
    VirtualSelectionControl.prototype.getProperty = function (propertyName) {
        if (!this.hasProperty(propertyName)) {
            throw new Error('Unknown property ' + JSON.stringify(propertyName));
        }
        return this.propertyValues[propertyName];
    };
    VirtualSelectionControl.prototype.setProperty = function (attributeFQNAccessorPath, propertyValue) {
        this.propertyValues[attributeFQNAccessorPath] = propertyValue;
        for (var i = 0, len = this.elements.length; i < len; i++) {
            this.elements[i].setProperty(attributeFQNAccessorPath, propertyValue);
        }
        return this;
    };
    VirtualSelectionControl.prototype.enumerateProperties = function () {
        var result = [];
        for (var k in this.commonProperties) {
            if (this.commonProperties.hasOwnProperty(k)) {
                result.push(this.commonProperties[k]);
            }
        }
        return result;
    };
    VirtualSelectionControl.prototype.isRemovable = function () {
        for (var i = 0, len = this.elements.length; i < len; i++) {
            if (!this.elements[i].isRemovable()) {
                return false;
            }
        }
        return true;
    };
    VirtualSelectionControl.prototype.isResizable = function () {
        return false;
    };
    VirtualSelectionControl.prototype.isDuplicatable = function () {
        var len = this.elements.length;
        if (16 < this.elements.length) {
            return false;
        }
        for (var i = 0; i < len; i++) {
            if (!this.elements[i].isDuplicatable()) {
                return false;
            }
        }
        return true;
    };
    VirtualSelectionControl.prototype.isSelectable = function () {
        return false;
    };
    VirtualSelectionControl.prototype.isDragable = function () {
        return false;
    };
    VirtualSelectionControl.prototype.isCompactFieldPlaceholderSupported = function () {
        return false;
    };
    VirtualSelectionControl.prototype.getResizingCapability = function () {
        return EResizingCapability.NONE;
    };
    VirtualSelectionControl.prototype.getParentPage = function () {
        return null;
    };
    VirtualSelectionControl.prototype.getParent = function () {
        return null;
    };
    VirtualSelectionControl.prototype.hasValueCompatibleWith = function (element) {
        return false;
    };
    VirtualSelectionControl.prototype.getPropertyDescriptorByInputIndex = function (inputIndex) {
        return null;
    };
    VirtualSelectionControl.prototype.getValue = function () {
        return null;
    };
    VirtualSelectionControl.prototype.onValueChanged = function () {
    };
    VirtualSelectionControl.prototype.getDefaultValueForPropertyType = function (iFormAttributeProperty) {
        switch (iFormAttributeProperty.type) {
            case 'string':
                return '';
            case 'int':
            case 'float':
            case 'number':
                return 0;
            case 'snumber':
            case 'sfloat':
                return '0';
            case 'bool':
            case 'boolean':
                return false;
            default:
                return null;
        }
    };
    VirtualSelectionControl.prototype.getElements = function () {
        return this.elements;
    };
    VirtualSelectionControl.prototype.addElements = function (elements) {
        var elementType;
        this.elements = [];
        for (var i = 0, len = elements.length; i < len; i++) {
            elementType = elements[i].getTypeId();
            if (elementType === ElementTypes.CONTAINER_TYPE_PAGE || elementType === ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
                continue;
            }
            if (elements[i].isSelectable()) {
                this.elements.push(elements[i]);
            }
        }
    };
    VirtualSelectionControl.STATIC_HASH = 'zzzzzzzz';
    VirtualSelectionControl.SUPPORTED_PROPERTIES = {
        'label.labelText': true,
        'label.isBold': true,
        'label.isItalic': true,
        'instructions.text': true,
        'instructions.showInstructionsOnClick': true,
        'label.visibilityMode': true,
        'options.required': true,
        'options.hidden': true,
        'configuration.defaultValue': true,
        'options.hipaaField': true,
    };
    return VirtualSelectionControl;
}(FormControl));
var ResourceManager = (function (_super) {
    __extends(ResourceManager, _super);
    function ResourceManager(jq, preloadResources) {
        var _this = _super.call(this) || this;
        _this.cache = {};
        _this.started = {};
        _this.loadedJS = {};
        _this.jq = jq;
        if (preloadResources) {
            for (var resourceURL in preloadResources) {
                if (preloadResources.hasOwnProperty(resourceURL)) {
                    _this.preloadResource(resourceURL, preloadResources[resourceURL]);
                }
            }
        }
        return _this;
    }
    ResourceManager.prototype.preloadResource = function (resourceURL, resourceData) {
        this.cache[resourceURL] = resourceData;
    };
    ResourceManager.prototype.isPageNotFoundBuffer = function (buffer) {
        return buffer && 'string' === typeof buffer && buffer.indexOf('data-page-name="404error">') > -1;
    };
    ResourceManager.prototype.get = function (resourcePath) {
        if (!resourcePath || typeof resourcePath !== 'string') {
            throw new Error('Invalid argument: non-empty string expected!');
        }
        return (function (self, $) {
            if (undefined !== self.cache[resourcePath]) {
                return $.Deferred(function (defer) {
                    defer.resolve(self.cache[resourcePath]);
                }).promise();
            }
            else {
                if (self.started[resourcePath]) {
                    return $.Deferred(function (defer) {
                        self.on('fetch_' + resourcePath, function () {
                            defer.resolve(self.cache[resourcePath]);
                        });
                        self.on('error_' + resourcePath, function () {
                            defer.reject(new Error('Failed fetching resource: "' + resourcePath + '"'));
                        });
                    }).promise();
                }
                else {
                    self.started[resourcePath] = (new Date()).toString();
                    return $.Deferred(function (defer) {
                        var targetResource = resourcePath.indexOf('?') === -1
                            ? resourcePath + '?_=' + (+new Date)
                            : resourcePath + '&_=' + (+new Date);
                        $.get(targetResource).then(function (response) {
                            if (self.isPageNotFoundBuffer(response)) {
                                defer.reject(new Error('Resource ' + resourcePath + ' seems to be a not-found page!'));
                                self.trigger('error_' + resourcePath);
                                self.off('fetch_' + resourcePath);
                                self.off('error_' + resourcePath);
                                return;
                            }
                            self.cache[resourcePath] = response;
                            delete self.started[resourcePath];
                            defer.resolve(self.cache[resourcePath]);
                            self.trigger('fetch_' + resourcePath);
                            self.off('fetch_' + resourcePath);
                            self.off('error_' + resourcePath);
                        }).fail(function (e) {
                            setTimeout(function () {
                                throw new Error('Failed to load resource from editor: ' + resourcePath);
                            }, 0);
                            if (window['CFTracker']) {
                                window['CFTracker'].event('editor_load_resource_error');
                            }
                            defer.reject(new Error('Failed fetching resource: "' + resourcePath + '"'));
                            self.trigger('error_' + resourcePath);
                            self.off('fetch_' + resourcePath);
                            self.off('error_' + resourcePath);
                        });
                    }).promise();
                }
            }
        })(this, this.jq);
    };
    ResourceManager.prototype.loadJavascript = function (scriptURL) {
        return (function ($, self) {
            if (self.loadedJS[scriptURL]) {
                return $.Deferred(function (defer) {
                    defer.resolve(true);
                }).promise();
            }
            else {
                return $.Deferred(function (defer) {
                    var script = document.createElement('script');
                    script.setAttribute('type', 'text/javascript');
                    script.setAttribute('src', scriptURL);
                    script.onload = function () {
                        defer.resolve(true);
                    };
                    script.onerror = function () {
                        if (window['CFTracker']) {
                            window['CFTracker'].event('editor_load_resource_error');
                        }
                        defer.reject(new Error('Failed to load external javascript: "' + scriptURL + '"'));
                    };
                    document.getElementsByTagName('head')[0].appendChild(script);
                }).promise();
            }
        })(this.jq, this);
    };
    return ResourceManager;
}(EventEmitter));
var FontsManager = (function (_super) {
    __extends(FontsManager, _super);
    function FontsManager(resourceManager, $, loadFonts) {
        if (loadFonts === void 0) { loadFonts = true; }
        var _this = _super.call(this) || this;
        _this.fonts = [];
        _this.loadedFonts = {};
        if (loadFonts) {
            _this.initializeFonts(resourceManager);
        }
        _this.jq = $;
        return _this;
    }
    FontsManager.prototype.initializeFonts = function (resourceManager) {
        var _this = this;
        resourceManager.get('/modules/Typescript/Form/resources/google-web-fonts.json').then(function (fontsAsJSON) {
            _this.fonts = JSON.parse(fontsAsJSON).sort(function (a, b) {
                var aName = a.family.toLowerCase(), bName = b.family.toLowerCase();
                if (aName === bName) {
                    return 0;
                }
                else {
                    if (aName < bName) {
                        return -1;
                    }
                    else {
                        return 1;
                    }
                }
            });
            _this.trigger('load');
        }).fail(function (e) {
            this.trigger('error', e);
        });
    };
    FontsManager.prototype.getFontsList = function () {
        var result = [], cssClass;
        for (var i = 0, len = this.fonts.length; i < len; i++) {
            cssClass = this.fonts[i].family.toLowerCase().replace(/ /g, '-');
            result.push({
                fontFamily: this.fonts[i].family,
                cssClassAaBbCc: 'gf-' + cssClass + '-abc',
                cssClassFontName: 'gf-' + cssClass,
            });
        }
        return result;
    };
    FontsManager.prototype.getFontByName = function (name) {
        var lcName = name.toLowerCase();
        for (var i = 0, len = this.fonts.length; i < len; i++) {
            var cssClass = this.fonts[i].family.toLowerCase().replace(/ /g, '-');
            if (this.fonts[i].family.toLowerCase() === lcName) {
                return {
                    fontFamily: this.fonts[i].family,
                    cssClassAaBbCc: 'gf-' + cssClass + '-abc',
                    cssClassFontName: 'gf-' + cssClass,
                };
            }
        }
        return null;
    };
    FontsManager.prototype.loadFont = function (name) {
        if (this.loadedFonts[name] !== undefined) {
            return this.loadedFonts[name];
        }
        var result = (function (self, $) {
            if (!name) {
                return $.Deferred(function (defer) {
                    defer.reject(new Error('Invalid font name:' + JSON.stringify(name)));
                });
            }
            if (self.isSystemFont(name)) {
                return $.Deferred(function (defer) {
                    defer.resolve(true);
                }).promise();
            }
            return $.Deferred(function (defer) {
                var link = document.createElement('link');
                link.setAttribute('type', 'text/css');
                link.setAttribute('rel', 'stylesheet');
                link.setAttribute('href', '//fonts.googleapis.com/css?family=' + encodeURIComponent(name));
                link.onload = function () {
                    defer.resolve(true);
                };
                link.onerror = function () {
                    defer.reject(new Error('Failed to load Google Web Font: "' + name + '"'));
                };
                document.getElementsByTagName('head')[0].appendChild(link);
            }).promise();
        })(this, this.jq);
        this.loadedFonts[name] = result;
        return result;
    };
    FontsManager.prototype.isSystemFont = function (name) {
        var fontFamilyInfo = name.split(',');
        for (var i = 0, len = fontFamilyInfo.length; i < len; i++) {
            var parsedFontName = fontFamilyInfo[i].replace(/(^[ '"]+|[ "']+$)/g, '').toLowerCase();
            if (FontsManager.SYSTEM_FONTS.indexOf(parsedFontName) > -1) {
                return true;
            }
        }
        return false;
    };
    FontsManager.SYSTEM_FONTS = [
        'open sans',
        'georgia',
        'panatino linotype',
        'palatino linotype',
        'book antiqua',
        'palatino',
        'times new roman',
        'times',
        'arial',
        'helvetica',
        'arial black',
        'gadget',
        'comic sans ms',
        'cursive',
        'impact',
        'charcoal',
        'lucida sans unicode',
        'lucida grande',
        'tahoma',
        'geneva',
        'verdana',
        'courier new',
        'courier',
        'monospace',
        'sans-serif',
        'serif'
    ];
    return FontsManager;
}(EventEmitter));
var EngineToggles = (function () {
    function EngineToggles() {
    }
    EngineToggles.ALLOW_I18N_DROPDOWN_SELECTOR = true;
    EngineToggles.ALLOW_QUIZ_TIMER = true;
    EngineToggles.ENABLE_SUBMISSION_PREVENTION_ON_QUIZ_TIMER_EXPIRATION = true;
    EngineToggles.ALLOW_PAYMENTS_SELECTOR = true;
    EngineToggles.ALLOW_THEME_ADVANCED_SETTINGS = false;
    EngineToggles.ALLOW_SECOND_COMPONENT_IN_UI_TIME_CONTROL = false;
    EngineToggles.ALLOW_COUPON_CODES_ON_LAST_PAGE_FOOTER = true;
    EngineToggles.ALLOW_REAL_TIME_CALCULATIONS = true;
    EngineToggles.ALLOW_PAYMENTS_SUMMARY = true;
    EngineToggles.VERBOSE_CONSOLE = false;
    EngineToggles.ALLOW_CSS_OPTIMIZATIONS = true;
    return EngineToggles;
}());
var Engine = (function (_super) {
    __extends(Engine, _super);
    function Engine(loader, factory, jq, form, capabilities, resources) {
        var _this = _super.call(this) || this;
        UI.withJQuery(jq);
        _this.form = form;
        _this.loader = loader;
        _this.factory = factory;
        _this.jq = jq;
        _this.capabilities = capabilities;
        _this.resourceManager = new ResourceManager(_this.jq, resources);
        switch (_this.loader.getLoaderDependency(ELoaderDependency.THEME_STRATEGY)) {
            case EThemeStrategy.WIX_THEME_MANAGED_BY_WIX:
                _this.theme = new Theme(_this, new ExternalThemeManagedByWix());
                break;
            case EThemeStrategy.WIX_THEME:
                _this.theme = new Theme(_this, new WixThemeWithExternalStorage(_this.loader.getLoaderType() === EFormLoaderType.VIEW, _this));
                break;
            case EThemeStrategy.INTERNAL:
            default:
                _this.theme = new Theme(_this, new InternalTheme());
                break;
        }
        _this.document = new Form(_this);
        _this.runtime = Runtime.createFromString(capabilities.factory.attributeDefinitions);
        _this.unserializer = new FormUnserializer(_this);
        _this.globalEventHandler = new GlobalEventHandler(_this, _this.document);
        _this.geolocation = new GeolocationService(_this.loader.getI18n(), _this.loader.getLoaderDependency(ELoaderDependency.GEOLOCATION_USER_COUNTRY_CODE));
        _this.phoneUtils = new PhoneUtils(_this.geolocation);
        _this.validator = new DataValidator(_this.loader.getI18n(), capabilities, _this.phoneUtils);
        _this.currency = CurrencyService.share(_this.loader.getI18n());
        _this.uploadsService = new UploadsService(_this.jq, _this.document, _this.loader.getUserId(), new MimeTypeService(_this.loader.getI18n()));
        _this.fileUtils = new FileUtils(_this.loader.getI18n());
        _this.timeUtils = TimeUtils.createInstanceInNonSingletonModeWithoutInternationalizationSupport();
        _this.paymentProcessorsPluginFactory = (new PaymentProcessorsPluginFactory(_this))
            .withPlugin(new NullPaymentProcessorPlugin())
            .withPlugin(new SisowPaymentProcessorPlugin());
        _this.init();
        return _this;
    }
    Engine.prototype.getI18n = function () {
        return this.loader.getI18n();
    };
    Engine.prototype.getJQuery = function () {
        return this.jq;
    };
    Engine.prototype.getFactory = function () {
        return this.factory;
    };
    Engine.prototype.getLoader = function () {
        return this.loader;
    };
    Engine.prototype.getResourceManager = function () {
        return this.resourceManager;
    };
    Engine.prototype.getForm = function () {
        return this.form;
    };
    Engine.prototype.getDocumentSize = function () {
        return this.documentSize;
    };
    Engine.prototype.getDocument = function () {
        return this.document;
    };
    Engine.prototype.getTheme = function () {
        return this.theme;
    };
    Engine.prototype.getUnserializer = function () {
        return this.unserializer;
    };
    Engine.prototype.getGeolocation = function () {
        return this.geolocation || null;
    };
    Engine.prototype.getCurrency = function () {
        return this.currency || null;
    };
    Engine.prototype.getValidator = function () {
        return this.validator;
    };
    Engine.prototype.getCapabilities = function () {
        return this.capabilities;
    };
    Engine.prototype.onResize = function () {
        var formWidth = this.form.offsetWidth, formHeight = this.form.offsetHeight, needsThemeRecompute = !this.documentSize || formWidth !== this.documentSize.width;
        this.documentSize = this.documentSize || {
            width: 0,
            height: 0,
        };
        this.documentSize.width = formWidth;
        this.documentSize.height = formHeight;
        if (needsThemeRecompute) {
            this.theme.recompute();
        }
        FormUtils.refreshFrameHeightOnWix();
        this.trigger('resize');
    };
    Engine.prototype.reconfigureLayoutInImmediateMode = function () {
        var suggestedRenderer, formLabelPlacement = this.document.getLabelPlacement(), formInstructionsPlacement = this.document.getInstructionsPlacement();
        for (var i = 0, children = this.document.flatten(), len = children.length; i < len; i++) {
            if (children[i].isRenderingSupported()) {
                suggestedRenderer = RenderersFactory.getSuggestedRenderer(children[i], formLabelPlacement, formInstructionsPlacement);
                children[i]['rendererType'] = undefined;
                children[i].setRendererType(suggestedRenderer);
            }
        }
        suggestedRenderer = RenderersFactory.getSuggestedRenderer(this.document.getCaptcha(), formLabelPlacement, formInstructionsPlacement);
        this.document.getCaptcha()['rendererType'] = undefined;
        this.document.getCaptcha().setRendererType(suggestedRenderer);
    };
    Engine.prototype.init = function () {
        console.log('engine::init()');
        (function ($, self) {
            self.reconfigureLayout = Throttle.create(function () {
                self.reconfigureLayoutInImmediateMode();
            }, 0);
            self.on('theme-ready', function () {
                self.document.getRootNode().setAttribute('data-theme-is-ready', '1');
                FormUtils.refreshFrameHeightOnWix();
            });
            self.factory.runEditorCapabilitiesUnitTests(self.runtime, self.capabilities);
            self.factory.addControlsCapabilities(self.runtime, self.capabilities);
            self.factory.addEditorSettingCapabilities(self.runtime, self.capabilities);
            self.form.appendChild(self.theme.getStyleElement());
            document.body.appendChild(self.theme.getFormCustomCSSFromUrlElement());
            document.body.appendChild(self.theme.getFormCustomCSSTextStyleElement());
            window.document.body.appendChild(self.theme.getThemeThumbnailsStyleElement());
            self.document.on('node-property-changed', function (target, propertyFQN, newValue, oldValue) {
                self.globalEventHandler.dispatch(target, propertyFQN, newValue, oldValue);
            });
            self.document.on('node-attribute-changed', function (target, attributeName, newValue) {
                self.globalEventHandler.dispatch(target, attributeName, newValue, null);
            });
            self.document.getHeader().onCreated();
            self.document.getHeader().setupI18n();
            self.document.getCaptcha().onCreated();
            self.document.getCaptcha().setupI18n();
            self.document.getActionBar().onCreated();
            self.document.getActionBar().setupI18n();
            $(window)
                .on('resize', function () {
                self.onResize();
            });
            self.loader.on('i18n-loaded', function () {
                self.timeUtils = new TimeUtils(self.getI18n());
                self.document.updateI18n();
            });
            self.onResize();
            setTimeout(function () {
                FormUtils.refreshFrameHeightOnWix();
            }, 300);
        })(this.jq, this);
    };
    Engine.prototype.createElement = function (elementTypeId, elementProperties, inDocument) {
        var result = this.factory.createItemByTypeId(elementTypeId, inDocument || this.document, elementProperties);
        result.onCreated();
        result.setupI18n();
        if (this.document) {
            var formLabelPlacement = this.document.getLabelPlacement(), formInstructionsPlacement = this.document.getInstructionsPlacement();
            if (result.isRenderingSupported()) {
                var suggestedRenderer = RenderersFactory.getSuggestedRenderer(result, formLabelPlacement, formInstructionsPlacement);
                result.setRendererType(suggestedRenderer);
            }
        }
        return result;
    };
    Engine.prototype.loadFromString = function (formSerializedDataInJSONFormat, useUnserializerBag) {
        this.unserializer.unserialize(JSON.parse(formSerializedDataInJSONFormat), useUnserializerBag || false);
    };
    Engine.prototype.updateState = function (state) {
        if (!state) {
            return;
        }
        var element, setting, changedElements = [];
        this.document.disableEvents();
        for (var elementHash in state) {
            if (elementHash !== 'settings') {
                if (state.hasOwnProperty(elementHash) && state.propertyIsEnumerable(elementHash)) {
                    element = this.document.getElementByHash(elementHash);
                    if (null !== element) {
                        if (changedElements.indexOf(element) === -1
                            && element.getErrors() !== (state[elementHash].errors || null)) {
                            changedElements.push(element);
                        }
                        element.withId(state[elementHash].id || null).withErrors(state[elementHash].errors || null);
                        if ([
                            ElementTypes.CONTROL_TYPE_DROPDOWN,
                            ElementTypes.CONTROL_TYPE_CHECKBOX,
                            ElementTypes.CONTROL_TYPE_RADIO
                        ].indexOf(element.getTypeId()) > -1) {
                            this.getLoader().execCommand('reset-used-choices', element);
                        }
                    }
                }
            }
            else {
                for (var settingTypeId in state.settings) {
                    if (state.settings.propertyIsEnumerable(settingTypeId)) {
                        setting = this.document.getEditorSettingByTypeId(settingTypeId);
                        if (null !== setting) {
                            if (changedElements.indexOf(setting) === -1
                                && setting.getErrors() !== (state.settings[settingTypeId] || null)) {
                                changedElements.push(setting);
                            }
                            setting.withErrors(state.settings[settingTypeId]);
                        }
                    }
                }
                this.loader.getCommandDispatcher().trackPaymentsActivation();
            }
        }
        this.document.enableEvents();
        for (var x = 0, len = changedElements.length; x < len; x++) {
            this.document.trigger('errors-changed', changedElements[x]);
        }
    };
    Engine.prototype.getUploadsService = function () {
        return this.uploadsService;
    };
    Engine.prototype.getFileUtils = function () {
        return this.fileUtils;
    };
    Engine.prototype.getTimeUtils = function () {
        return this.timeUtils;
    };
    Engine.prototype.getPhoneUtils = function () {
        return this.phoneUtils;
    };
    Engine.prototype.getPaymentProcessorsPluginFactory = function () {
        return this.paymentProcessorsPluginFactory;
    };
    Engine.prototype.getRuntime = function () {
        return this.runtime;
    };
    Engine.getSubmissionPhaseName = function (phase) {
        switch (phase) {
            case EFormResponseAction.SHOW_REPORT:
                return 'show-report';
            case EFormResponseAction.SHOW_QUIZ_RESULTS:
                return 'show-quiz-results';
            case EFormResponseAction.SHOW_HTML:
                return 'show-html';
            case EFormResponseAction.REDIRECT:
                return 'redirect';
            case EFormResponseAction.TEXT_AND_REDIRECT:
                return 'text-and-redirect';
            case EFormResponseAction.SHOW_TEXT:
                return 'show-text';
            case null:
            default:
                return 'unhandled';
        }
    };
    Engine.prototype.setSubmissionPhase = function (phase, details) {
        this.getDocument().getRootNode().setAttribute('data-submission-phase', Engine.getSubmissionPhaseName(!details ? null : phase));
        var rootSubmissionPhaseDOMNode = document.createElement('div');
        rootSubmissionPhaseDOMNode.setAttribute('data-submission-phase', Engine.getSubmissionPhaseName(!details ? null : phase));
        this.getDocument().getRootNode().appendChild(rootSubmissionPhaseDOMNode);
        switch (phase) {
            case EFormResponseAction.SHOW_REPORT:
                this.loader.getCommandDispatcher().onSubmissionPhaseShowReport(details, rootSubmissionPhaseDOMNode);
                break;
            case EFormResponseAction.SHOW_QUIZ_RESULTS:
                this.loader.getCommandDispatcher().onSubmissionPhaseShowQuizResults(details, rootSubmissionPhaseDOMNode);
                break;
            case EFormResponseAction.SHOW_HTML:
                this.loader.getCommandDispatcher().onSubmissionPhaseShowHTML(details, rootSubmissionPhaseDOMNode);
                break;
            case EFormResponseAction.REDIRECT:
                this.loader.getCommandDispatcher().onSubmissionPhaseRedirect(details, rootSubmissionPhaseDOMNode);
                break;
            case EFormResponseAction.TEXT_AND_REDIRECT:
                this.loader.getCommandDispatcher().onSubmissionPhaseTextAndRedirect(details, rootSubmissionPhaseDOMNode);
                break;
            case EFormResponseAction.SHOW_TEXT:
                this.loader.getCommandDispatcher().onSubmissionPhaseShowText(details, rootSubmissionPhaseDOMNode);
                break;
            case null:
            default:
                this.loader.getCommandDispatcher().onSubmissionPhaseUnhandled(details, rootSubmissionPhaseDOMNode);
                break;
        }
        if (details && undefined !== details.setURL) {
            this.loader.getCommandDispatcher().setPageURL(details.setURL);
        }
    };
    return Engine;
}(EventEmitter));
var AbstractionLayerV2 = (function (_super) {
    __extends(AbstractionLayerV2, _super);
    function AbstractionLayerV2(loader, translator) {
        var _this = _super.call(this) || this;
        _this.controlsCache = {};
        _this.loader = loader;
        _this.translator = translator;
        _this.init();
        _this.repeatablePromisesChain = _this.getJQuery().Deferred(function (defer) {
            defer.resolve();
        }).promise();
        return _this;
    }
    AbstractionLayerV2.prototype.clearControlsCache = function () {
        this.controlsCache = {};
    };
    AbstractionLayerV2.prototype.getControlInstanceById = function (controlId) {
        var def = this.translator.getMapping(controlId);
        if (null === def) {
            return null;
        }
        var mapping = this.translator.getMapping(controlId);
        return mapping
            ? mapping.element
            : null;
    };
    AbstractionLayerV2.prototype.getControlValueById = function (controlId) {
        if ('language' === controlId) {
            return this.loader.getI18n().getLanguageCode();
        }
        if ('quiz_score' === controlId) {
            return this.loader.getQuizScoreService().getCurrentQuizScore();
        }
        var def = this.translator.getMapping(controlId);
        if (null === def) {
            return undefined;
        }
        var value;
        if (def.element.getElementKind() === EElementKind.CONTROL
            && !def.element.isVisible(true)) {
            value = 0;
        }
        else {
            value = def.element.getProperty(def.targetPropertyFQN);
        }
        if (def.parser) {
            return def.parser(value);
        }
        else {
            return value;
        }
    };
    AbstractionLayerV2.castToStringArray = function (value) {
        if (!(value instanceof Array)) {
            return null;
        }
        var result = [];
        for (var i = 0, len = value.length; i < len; i++) {
            switch (true) {
                case null === value[i]:
                    result.push('');
                    break;
                case 'number' === typeof value[i]:
                    result.push(isFinite(value[i]) ? String(value[i]) : '0');
                    break;
                case 'string' === typeof value[i]:
                    result.push(value[i]);
                    break;
                default:
                    return null;
            }
        }
        return result;
    };
    AbstractionLayerV2.castToString2Array = function (value) {
        var result, row;
        if (!(value instanceof Array)) {
            return null;
        }
        result = [];
        for (var i = 0, len = value.length; i < len; i++) {
            if (!(value[i] instanceof Array)) {
                return null;
            }
            if (value[i].length < 1) {
                return null;
            }
            row = [];
            for (var j = 0; j < 2; j++) {
                switch (true) {
                    case undefined === value[i][j]:
                        if (1 === j) {
                            row.push(value[i][0]);
                        }
                        else {
                            return null;
                        }
                        break;
                    case null === value[i][j]:
                        row.push('');
                        break;
                    case 'number' === typeof value[i][j]:
                        row.push(isFinite(value[i][j]) ? String(value[i][j]) : '0');
                        break;
                    case 'string' === typeof value[i][j]:
                        row.push(value[i][j]);
                        break;
                    default:
                        return null;
                }
            }
            result.push(row);
        }
        return result;
    };
    AbstractionLayerV2.prototype.setControlValueById = function (controlId, value, repeatedData, repeatablePath) {
        var _this = this;
        if (repeatablePath !== null
            && repeatedData !== null
            && typeof repeatablePath === "object"
            && repeatedData.length > 0
            && repeatedData.length === repeatablePath.length) {
            try {
                if (this.loader.getRules().getRules().length) {
                    this.loader.getRules().getDatabase().on('idle', function () {
                        var rulesEngine = _this.loader.getRules(), rules = rulesEngine.getRules(), newRules = [];
                        for (var i = 0, len = rules.length; i < len; i++) {
                            var rule = rules[i];
                            if (typeof rule.repeatablePath !== 'undefined')
                                continue;
                            newRules.push(JSON.parse(JSON.stringify(rule)));
                        }
                        rulesEngine.resetRules(newRules);
                        _this.setControlValueWithRepeatableSubmitData(controlId, value, repeatedData, repeatablePath);
                    });
                }
                else {
                    this.setControlValueWithRepeatableSubmitData(controlId, value, repeatedData, repeatablePath);
                }
            }
            catch (e) {
                console.warn("Failed to populate repeatable data. Occurred error is displayed in console.");
                console.error(e);
            }
        }
        else {
            var allowedFields = [
                ElementTypes.CONTROL_TYPE_TEXT,
                ElementTypes.CONTROL_TYPE_NUMBER,
                ElementTypes.CONTROL_TYPE_PHONE,
                ElementTypes.CONTROL_TYPE_ADDRESS,
                ElementTypes.CONTROL_TYPE_EMAIL,
                ElementTypes.CONTROL_TYPE_NAME,
                ElementTypes.CONTROL_TYPE_DATE
            ];
            if (typeof value === 'object' && allowedFields.includes(this.translator.getMapping(controlId, 0).element.getTypeId())) {
                var controlMapping = this.translator.getMapping(controlId, 0, repeatablePath);
                try {
                    var rows = value;
                    var inputRepeatableGroup = controlMapping.element.getFirstParentContainer(), inputRepeatableContainer = (FormUtils.getRepeatableContainerParent(inputRepeatableGroup)), numberOfRepeatedGroups = rows.length || inputRepeatableContainer.getChildren().length;
                    inputRepeatableContainer.setProperty('configuration.maxNumberOfGroupsAllowed', numberOfRepeatedGroups);
                    value = rows.shift()[0];
                    repeatedData = rows.map(function (row) { return row[0]; });
                }
                catch (e) {
                }
            }
            this.setControlValueByIdOnRepeatedIndex(controlId, value, 0, repeatablePath);
            try {
                if (repeatedData) {
                    var controlMapping = this.translator.getMapping(controlId, 0, repeatablePath), inputRepeatableGroup = controlMapping.element.getFirstParentContainer(), inputRepeatableContainer_1 = (FormUtils.getRepeatableContainerParent(inputRepeatableGroup)), numberOfRepeatedGroups = inputRepeatableContainer_1.getChildren().length;
                    for (var i = 0, len = repeatedData.length - numberOfRepeatedGroups + 1; i < len; i++) {
                        this.repeatablePromisesChain = this.repeatablePromisesChain
                            .then(function () {
                            return inputRepeatableContainer_1["addNewGroup"]();
                        })
                            .then(function (group) { return _this.waitForGroupPaths(group); })
                            .then(function (group) { return _this.cloneElementRules(group); });
                    }
                    this.repeatablePromisesChain.then(function () {
                        setTimeout(function () {
                            _this.loader.getEngine().getDocument().rebuildHashMap();
                        }, 1);
                        setTimeout(function () {
                            for (var i = 0, len = repeatedData.length; i < len; i++) {
                                _this.setControlValueByIdOnRepeatedIndex(controlId, repeatedData[i], i + 1, repeatablePath);
                            }
                        }, 1);
                    })
                        .then(function () {
                        _this.loader.getEngine().trigger('repeatable-prefill-done');
                    });
                }
            }
            catch (e) {
                console.warn("Failed to populate repeatable data. Occurred error is displayed in console.");
                console.error(e);
            }
        }
    };
    AbstractionLayerV2.prototype.calculateRepeatablePathNumbers = function (repeatablePath) {
        var countNumbers = {};
        if (typeof repeatablePath === "object"
            && repeatablePath[0] !== null) {
            repeatablePath.forEach(function (path) {
                var splitPath = path.split('.');
                if (typeof splitPath === "object"
                    && splitPath[0] !== undefined) {
                    if (typeof countNumbers[splitPath[0]] === "number"
                        && countNumbers[splitPath[0]]) {
                        countNumbers[splitPath[0]] += 1;
                    }
                    else {
                        countNumbers[splitPath[0]] = 1;
                    }
                }
            });
        }
        return countNumbers;
    };
    AbstractionLayerV2.prototype.setControlValueWithRepeatableSubmitData = function (controlId, value, repeatedData, repeatablePath) {
        var _this = this;
        var promisesChain = this.getJQuery().Deferred(function (defer) {
            defer.resolve();
        }).promise();
        var countNumber = this.calculateRepeatablePathNumbers(repeatablePath);
        var _loop_5 = function (i, len) {
            promisesChain = promisesChain
                .then(function () {
                var controlMapping = _this.translator.getMapping(controlId, 0, repeatablePath[i]), inputRepeatableGroup = controlMapping.element.getFirstParentContainer(), inputRepeatableContainer = (FormUtils.getRepeatableContainerParent(inputRepeatableGroup)), maxNumberOfGroupsAllowed = inputRepeatableContainer.getProperty('configuration.maxNumberOfGroupsAllowed'), maxNumberOfGroupsAllowedPrefill = 0;
                for (var k = 0, len_1 = repeatablePath.length; k < len_1; k++) {
                    if (repeatablePath[i] !== null && repeatablePath[i].replace(/(\.[\d]*)$/, '') === repeatablePath[k].replace(/(\.[\d]*)$/, '')) {
                        maxNumberOfGroupsAllowedPrefill++;
                    }
                    else if (repeatablePath[i] === null) {
                        maxNumberOfGroupsAllowedPrefill++;
                    }
                }
                if (maxNumberOfGroupsAllowedPrefill > maxNumberOfGroupsAllowed) {
                    maxNumberOfGroupsAllowed = maxNumberOfGroupsAllowedPrefill;
                }
                else {
                    if (repeatablePath[i] !== null) {
                        var splitPath = repeatablePath[i].split('.');
                        if (typeof splitPath === "object"
                            && splitPath[0] !== undefined
                            && typeof countNumber[splitPath[0]] === "number"
                            && inputRepeatableContainer.getChildren() !== undefined
                            && countNumber[splitPath[0]] <= inputRepeatableContainer.getChildren().length) {
                            return;
                        }
                    }
                    else if (inputRepeatableContainer.getChildren().length - 1 >= i
                        && repeatablePath[i] === null) {
                        return;
                    }
                }
                inputRepeatableContainer.setProperty('configuration.maxNumberOfGroupsAllowed', maxNumberOfGroupsAllowed);
                return inputRepeatableContainer["addNewGroup"]();
            })
                .then(function (group) { return _this.waitForGroupPaths(group); });
        };
        for (var i = 0, len = repeatedData.length; i < len; i++) {
            _loop_5(i, len);
        }
        promisesChain.then(function () {
            setTimeout(function () {
                _this.loader.getEngine().getDocument().rebuildHashMap();
            }, 1);
            setTimeout(function () {
                for (var i = 0, len = repeatedData.length; i < len; i++) {
                    if (repeatablePath[i] !== null) {
                        var repeatedIndexRegex = "([\\d]*)$", repeatedIndex = parseInt(repeatablePath[i].match(repeatedIndexRegex)[0]);
                        var path = repeatablePath[i].replace(/(\.[\d]*)$/, '');
                        _this.setControlValueByIdOnRepeatedIndex(controlId, repeatedData[i], repeatedIndex - 1, path);
                    }
                    else {
                        _this.setControlValueByIdOnRepeatedIndex(controlId, repeatedData[i], i, repeatablePath[i]);
                    }
                }
            }, 1);
        });
    };
    AbstractionLayerV2.prototype.shouldAddPathsToPrefillValue = function (controlId) {
        var controlsThatHaveRepeatablePathsAddedToPrefillValue = this.loader.getControlsThatHaveRepeatablePathsAddedToPrefillValue();
        return controlsThatHaveRepeatablePathsAddedToPrefillValue.indexOf(controlId.replace('control_', '')) !== -1;
    };
    AbstractionLayerV2.prototype.waitForGroupPaths = function (group) {
        return this.getJQuery().Deferred(function (defer) {
            (function (group) {
                var interval = setInterval(function () { pathChecker(defer, group); }, 1);
                function pathChecker(defer, group) {
                    if (typeof group === 'undefined') {
                        clearInterval(interval);
                        defer.resolve();
                    }
                    else {
                        group.updateRepeatableElementAttributes();
                        group.flatten().forEach(function (control) {
                            if (control.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP) {
                                var repeatableGroupUpdate = control;
                                if (repeatableGroupUpdate.getRepeatableGroupIndexAttribute() === 1) {
                                    repeatableGroupUpdate.resetRepeatableElementAttributes();
                                }
                            }
                        });
                        var path = group.getRepeatableGroupPathAttribute() || '';
                        if (path.length) {
                            clearInterval(interval);
                            defer.resolve(group);
                        }
                    }
                }
            })(group);
        }).promise();
    };
    AbstractionLayerV2.prototype.cloneElementRules = function (groupChild) {
        var _this = this;
        return this.getJQuery().Deferred(function (defer) {
            if (typeof groupChild !== 'undefined') {
                var rulesEngine = _this.loader.getRules(), rules = rulesEngine.getRules(), newRules = [];
                for (var i = 0, len = rules.length; i < len; i++) {
                    var rule = rules[i], ruleControlId = rule.controlId, repeatablePath = String(groupChild.getRepeatableGroupPathAttribute()), groupChildren = groupChild.flatten();
                    if (typeof rule.repeatablePath !== 'undefined')
                        continue;
                    for (var j = 0, groupChildLen = groupChildren.length; j < groupChildLen; j++) {
                        var control = groupChildren[j], controlId = control.getId();
                        if (null !== controlId && rulesEngine.areTheSameControlIDs(String(ruleControlId), String(controlId))) {
                            if (repeatablePath.length) {
                                var newRule = JSON.parse(JSON.stringify(rule)), actions = newRule.actions, newActions = [];
                                newRule.controlId = 'control_' + controlId + '_rp' + repeatablePath;
                                newRule.eventType = EFormRuleEventType.TEXT_INPUT;
                                newRule.repeatablePath = repeatablePath;
                                for (var k = 0, actionsLength = actions.length; k < actionsLength; k++) {
                                    var action = actions[k];
                                    if (!/^REMOTE/.test(action.jql))
                                        continue;
                                    action.jql = action.jql.replace(':control_' + controlId, ':this') + ' AND RepeatablePath=' + repeatablePath;
                                    newActions.push(action);
                                }
                                if (newActions.length) {
                                    newRule.actions = newActions;
                                    newRules.push(newRule);
                                }
                            }
                        }
                    }
                }
                rulesEngine.withRules(newRules);
            }
            defer.resolve();
        }).promise();
    };
    AbstractionLayerV2.prototype.setControlValueByIdOnRepeatedIndex = function (controlId, value, repeatedIndex, repeatedPath) {
        var def = this.translator.getMapping(controlId, repeatedIndex, repeatedPath), valueType = typeof value, castedValue = value;
        if (null === def) {
            return;
        }
        var control = def.element;
        if (valueType === 'string' && value.length && this.shouldAddPathsToPrefillValue(controlId)) {
            var firstRepeatableGroup = control.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP), firstParentRepeatablePath = firstRepeatableGroup.getRepeatableGroupPathAttribute();
            value = castedValue = firstParentRepeatablePath + '. ' + value;
        }
        if ('string' === valueType) {
            try {
                castedValue = JSON.parse(value);
                valueType = typeof castedValue;
            }
            catch (e) {
                castedValue = value;
            }
        }
        switch (def.element.getTypeId()) {
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                if (def.targetPropertyFQN === 'value.value') {
                    if (this.setDropdownValue(def.element, value)) {
                        control.trigger('change.rules');
                        break;
                    }
                }
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
                if (!this.setCheckboxValue(def.element, value, def)) {
                    console.warn('Abstraction layer: Failed to set CheckBox value');
                }
                else {
                    control.trigger('change.rules');
                }
                break;
            case ElementTypes.CONTROL_TYPE_RADIO:
                var radioCastVal = this.castValueToNativeFormat(castedValue, def);
                if (!this.setRadioValue(def.element, radioCastVal, def)) {
                    console.warn('Abstraction layer: Failed to set Radio value');
                }
                else {
                    control.trigger('change.rules');
                }
                break;
            case ElementTypes.CONTROL_TYPE_TEXT:
            case ElementTypes.CONTROL_TYPE_TEXTAREA:
            case ElementTypes.CONTROL_TYPE_EMAIL:
            case ElementTypes.CONTROL_TYPE_WEBSITE:
                if (!this.setTextBasedControlValue(def.element, value, def)) {
                    console.warn('Abstraction layer: Failed to set text control value!');
                }
                if (this.castValueToNativeFormat(castedValue, def) === '') {
                    def.element.setProperty(def.targetPropertyFQN, null);
                }
                control.trigger('change.rules');
                break;
            case ElementTypes.CONTROL_TYPE_PHONE:
                var phone = def.element;
                if (phone.hasError(FormElement.BACKEND_ERR_INVALID_VALUE)) {
                    phone.removeError(FormElement.BACKEND_ERR_INVALID_VALUE);
                }
                var castVal = this.castValueToNativeFormat(castedValue, def);
                var phoneElement = def.element;
                var invalidPhoneValue = (castVal === '' || castVal === null);
                var phoneValue = invalidPhoneValue ? null : phoneElement.getFormattedPhoneNumberAccordingToValidationType(castVal).replace(/\s+/g, '-');
                def.element.setProperty(def.targetPropertyFQN, phoneValue);
                control.trigger('change.rules');
                break;
            case ElementTypes.CONTROL_TYPE_DATE:
                var castDateVal = this.castValueToNativeFormat(castedValue, def), dateElement = def.element;
                if (castDateVal) {
                    var dateValueFormatted = dateElement.formatDateString(castDateVal);
                    def.element.setProperty(def.targetPropertyFQN, dateValueFormatted);
                    control.trigger('change.rules');
                }
                break;
            default:
                var v = this.castValueToNativeFormat(castedValue, def);
                def.element.setProperty(def.targetPropertyFQN, v);
                control.trigger('change.rules');
                break;
        }
        try {
            def.element["synchronizeValue"]();
        }
        catch (e) {
        }
    };
    AbstractionLayerV2.prototype.setRadioValue = function (radio, value, mapping) {
        if (Array.isArray(value)) {
            for (var i = 0, len = value.length; i < len; i++) {
                if (!Array.isArray(value[i]) || value[i].length !== 1 || ('string' !== typeof value[i][0] && 'boolean' !== typeof value[i][0])) {
                    return false;
                }
            }
            for (var i = 0, len = value.length; i < len; i++) {
                if (!this.setRadioValue(radio, value[i][0], mapping)) {
                    return false;
                }
            }
            return true;
        }
        if ('boolean' !== typeof value && 'string' !== typeof value) {
            return false;
        }
        var targetIndex = mapping.inputIndex, currentValue = radio.getValue(), options = radio.getProperty('choices.values'), purposedValue = { value: currentValue.value, index: currentValue.index }, isChanged;
        if ('boolean' === typeof value) {
            for (var i = 0, len = options.length; i < len; i++) {
                if (i === targetIndex) {
                    if (value) {
                        purposedValue.value = options[i].text;
                        purposedValue.index = i;
                    }
                    if (purposedValue.value !== currentValue.value || purposedValue.index !== currentValue.index) {
                        radio.setValue(purposedValue);
                    }
                    return true;
                }
            }
            return false;
        }
        if ('string' === typeof value) {
            isChanged = false;
            for (var i = 0, len = options.length; i < len; i++) {
                if (value === '') {
                    radio.clearValue();
                }
                if (options[i].text.trim() == value) {
                    purposedValue.index = i;
                    purposedValue.value = options[i].text;
                    isChanged = purposedValue.value !== currentValue.value || purposedValue.index !== currentValue.index;
                    if (isChanged) {
                        radio.setValue(purposedValue);
                    }
                    return true;
                }
            }
            if (radio.getProperty('choices.allowOther')) {
                purposedValue.value = value || null;
                purposedValue.index = null;
                isChanged = purposedValue.value !== currentValue.value || purposedValue.index !== currentValue.index;
                if (isChanged) {
                    radio.setValue(purposedValue);
                }
            }
            else {
                return false;
            }
            return true;
        }
        return false;
    };
    AbstractionLayerV2.prototype.setCheckboxValue = function (checkbox, value, mapping) {
        if (Array.isArray(value)) {
            var options_1 = [];
            checkbox.setValue({ values: [] });
            for (var i = 0, len = value.length; i < len; i++) {
                if (Array.isArray(value[i][0])) {
                    var valuesOfCheckboxInRow = value[i][0];
                    for (var j = 0, arrLen = valuesOfCheckboxInRow.length; j < arrLen; j++) {
                        if (valuesOfCheckboxInRow[j] === "") {
                            return false;
                        }
                        options_1.push(valuesOfCheckboxInRow[j]);
                    }
                }
                else {
                    if (!Array.isArray(value[i]) || value[i].length !== 1 || ('string' !== typeof value[i][0] && 'boolean' !== typeof value[i][0])) {
                        return false;
                    }
                    options_1.push(value[i][0]);
                }
            }
            var checkboxOptions = checkbox.getProperty('choices.values') || [], mappingClone = {
                element: checkbox,
                targetPropertyFQN: mapping.targetPropertyFQN,
                optional: mapping.optional,
                type: mapping.type,
                inputIndex: mapping.inputIndex,
            }, isBooleanValue = false;
            try {
                isBooleanValue = (options_1 && options_1[0]) && typeof JSON.parse(options_1[0]) === 'boolean';
            }
            catch (e) {
            }
            if (checkboxOptions.length === 1 && options_1.length === 1 && isBooleanValue) {
                mappingClone.inputIndex = 0;
                if (!this.setCheckboxValue(checkbox, JSON.parse(options_1[0]), mappingClone)) {
                    return false;
                }
            }
            else {
                for (var i = 0, len = checkboxOptions.length; i < len; i++) {
                    var foundIndex = options_1.indexOf(checkboxOptions[i].text);
                    if (foundIndex > -1) {
                        mappingClone.inputIndex = i;
                        if (!this.setCheckboxValue(checkbox, checkboxOptions[i].text, mappingClone)) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }
        if ('boolean' !== typeof value && 'string' !== typeof value) {
            return false;
        }
        var targetIndex = mapping.inputIndex, currentValue = JSON.parse(JSON.stringify(checkbox.getValue().values)), options = checkbox.getProperty('choices.values'), choiceText, result;
        if (null === options) {
            return false;
        }
        if ('string' === typeof value) {
            value = this.castValueToNativeFormat(value, mapping);
        }
        if ('boolean' === typeof value) {
            choiceText = options[targetIndex].text;
            if (undefined === choiceText) {
                return false;
            }
            if (value) {
                if (currentValue.indexOf(choiceText) === -1) {
                    currentValue.push(choiceText);
                    checkbox.setValue({ values: currentValue });
                }
                return true;
            }
            else {
                if ((targetIndex = currentValue.indexOf(choiceText)) !== -1) {
                    currentValue.splice(targetIndex, 1);
                    checkbox.setValue({ values: currentValue });
                }
                return true;
            }
        }
        if ('string' === typeof value) {
            if ('no' !== value) {
                result = [];
                for (var i = 0, len = options.length; i < len; i++) {
                    if (!options[i].isOther && currentValue.indexOf(options[i].text) > -1) {
                        result.push(options[i].text);
                    }
                }
                if (value !== 'no') {
                    result.push(value);
                }
                checkbox.setValue({ values: result });
            }
            return true;
        }
        return false;
    };
    AbstractionLayerV2.prototype.setDropdownValue = function (dropDown, value) {
        if ('string' === typeof value || 'number' === typeof value || null === value) {
            dropDown.setValue({ value: null === value ? null : String(value) });
            return true;
        }
        var valueOnly = AbstractionLayerV2.castToStringArray(value);
        if (null !== valueOnly) {
            var choices = [];
            for (var i = 0, len = valueOnly.length; i < len; i++) {
                choices.push({
                    text: valueOnly[i],
                    isDefault: i === 0,
                });
            }
            dropDown.setProperty('choices.values', choices);
            dropDown.updateChoices();
            dropDown.withForceSelectedIndex(-2);
            if (choices.length) {
                dropDown.setProperty('value.index', 0);
                dropDown.setProperty('value.value', choices[0].text);
            }
            else {
                dropDown.setProperty('value.index', null);
                dropDown.setProperty('value.value', null);
            }
            return true;
        }
        var value2Only = AbstractionLayerV2.castToString2Array(value);
        if (null !== value2Only) {
            var choices = [];
            for (var i = 0, len = value2Only.length; i < len; i++) {
                choices.push({
                    value: value2Only[i][0],
                    text: value2Only[i][1],
                    isDefault: i === 0,
                });
            }
            dropDown.setProperty('choices.values', choices);
            dropDown.updateChoices();
            dropDown.withForceSelectedIndex(-2);
            if (choices.length) {
                dropDown.setProperty('value.index', 0);
                dropDown.setProperty('value.value', choices[0].value);
            }
            else {
                dropDown.setProperty('value.index', null);
                dropDown.setProperty('value.value', null);
            }
            return true;
        }
        return false;
    };
    AbstractionLayerV2.prototype.castValueToNativeFormat = function (value, def) {
        if ((null === value || '' === value) && def.optional) {
            return null;
        }
        switch (def.type) {
            case 'int':
                if (true === value || false === value) {
                    value = ~~value;
                }
                return Math.floor(parseInt(String(value || '0')) || 0);
            case 'float':
            case 'number':
                if (true === value || false === value) {
                    value = ~~value;
                }
                return parseFloat(String(value || '0')) || 0;
            case 'sint':
                return String(Math.floor(parseInt(String(value || '0')) || 0));
            case 'sfloat':
                return String(parseFloat(String(value || '0')) || 0);
            case 'bool':
            case 'boolean':
                switch (value) {
                    case true:
                    case 1:
                    case 'yes':
                    case 'y':
                    case 'on':
                    case '1':
                    case 'true':
                        return true;
                    case false:
                    case 0:
                    case 'no':
                    case 'n':
                    case 'off':
                    case '':
                    case '0':
                    case 'false':
                        return false;
                    default:
                        return !!value;
                }
            case 'string':
                if (true === value || false === value) {
                    value = ~~value;
                }
                return String(value) || '';
            default:
                return value;
        }
    };
    AbstractionLayerV2.prototype.isControlChecked = function (controlId) {
        var controlIdAsString = String(controlId || ''), matches = /^(control[-_]{0,1})?([\d]+)[-_]([\d]+)$/.exec(controlIdAsString);
        if (!matches) {
            return false;
        }
        var controlIdAsNumber = parseInt(matches[2]), choiceIndex = parseInt(matches[3]);
        if (!controlIdAsNumber) {
            return false;
        }
        var control = this.translator.getDocument().getElementById(controlIdAsNumber);
        if (!control) {
            return false;
        }
        switch (control.getTypeId()) {
            case ElementTypes.CONTROL_TYPE_RADIO:
            case ElementTypes.CONTROL_TYPE_LIKERT_SCALE:
                return this.isRadioControlOptionChecked(control, choiceIndex);
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
            case ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE:
                return this.isCheckboxControlOptionChecked(control, choiceIndex);
            default:
                return false;
        }
    };
    AbstractionLayerV2.prototype.isRadioControlOptionChecked = function (control, choiceIndex) {
        var input;
        if (input = this.controlsCache[control.getHash() + '_' + choiceIndex]) {
            return input.checked;
        }
        else {
            input = control.getRootNode().querySelector('input[type=radio][data-index="' + choiceIndex + '"]');
            if (!input) {
                var controlChoices = control.getProperty('choices.values');
                if (Array.isArray(controlChoices) && choiceIndex === controlChoices.length) {
                    var isOtherChoiceEnabled = control.getProperty('choices.allowOther');
                    if (isOtherChoiceEnabled) {
                        input = control.getRootNode().querySelector('input[type=radio][data-index="-1"]');
                    }
                }
            }
            this.controlsCache[control.getHash() + '_' + choiceIndex] = input;
            return input ? input.checked : false;
        }
    };
    AbstractionLayerV2.prototype.isCheckboxControlOptionChecked = function (control, choiceIndex) {
        var input;
        if (input = this.controlsCache[control.getHash() + '_' + choiceIndex]) {
            return input.checked;
        }
        else {
            input = control.getRootNode().querySelector('input[type=checkbox][data-index="' + choiceIndex + '"]');
            this.controlsCache[control.getHash() + '_' + choiceIndex] = input;
            return input ? input.checked : false;
        }
    };
    AbstractionLayerV2.prototype.getControlById = function (controlId) {
        throw new Error("Method not implemented.");
    };
    AbstractionLayerV2.prototype.controlExistsInForm = function (controlId) {
        if (controlId === 'language') {
            return true;
        }
        if (controlId === 'quiz_score') {
            return true;
        }
        return null !== this.translator.getMapping(controlId);
    };
    AbstractionLayerV2.prototype.getControlUpdateValueStrategy = function (controlId) {
        return EControlSetValueTypeStrategy.BY_USING_PROPRIETARY_DOM_ABSTRACTION_LAYER_METHOD;
    };
    AbstractionLayerV2.prototype.initializeControlValueWhenTheFormIsPrefillingASubmission = function (controlId, controlValue) {
        this.setControlValueById(controlId, controlValue);
    };
    AbstractionLayerV2.prototype.getControls = function () {
        throw new Error("Method not implemented.");
    };
    AbstractionLayerV2.prototype.reinitializeControlThirdPartyPluginsAfterItsValueHasBeenUpdated = function (element) {
        throw new Error("Method not implemented.");
    };
    AbstractionLayerV2.prototype.getJQuery = function () {
        return this.loader.getJQuery();
    };
    AbstractionLayerV2.prototype.init = function () {
        (function (self) {
            self.on('initialize', function () {
                var triggerInited = [];
                self.loader.getRules().getLogger().log('Abstraction Layer V2: triggering startup control events');
                for (var i = 0, config = self.loader.getRules().getRules(), len = config.length; i < len; i++) {
                    if (config[i].isRule || config[i].eventType === EFormRuleEventType.INIT || config[i].eventType === EFormRuleEventType.ALL_EVENTS) {
                        if (triggerInited.indexOf(config[i].controlId) === -1) {
                            self.trigger('control-event', EFormRuleEventType.INIT, null, config[i].controlId, self.getControlValueById(config[i].controlId));
                            triggerInited.push(config[i].controlId);
                        }
                    }
                    else {
                        if (self.loader.getLoaderType() === EFormLoaderType.VIEW
                            && (self.loader.getViewFormContext() === EViewFormContext.SAVE_FOR_LATER
                                || self.loader.getViewFormContext() === EViewFormContext.EDIT_SUBMISSION
                                || self.loader.getViewFormContext() === EViewFormContext.APPROVAL)) {
                            if (config[i].eventType === EFormRuleEventType.REINITIALIZE) {
                                self.trigger('control-event', EFormRuleEventType.REINITIALIZE, null, config[i].controlId, self.getControlValueById(config[i].controlId));
                                triggerInited.push(config[i].controlId);
                            }
                        }
                    }
                }
            });
            self.on('compute-form-rules', function (doneCallback) {
                var wasAnyRuleTriggered = false;
                var runCallbackAsync = function () {
                    if (doneCallback) {
                        doneCallback();
                    }
                    self.loader.getRules().getDatabase().off('idle', runCallbackAsync);
                };
                for (var i = 0, config = self.loader.getRules().getRules(), len = config.length; i < len; i++) {
                    if (config[i].isRule) {
                        if (!wasAnyRuleTriggered) {
                            wasAnyRuleTriggered = true;
                        }
                        self.trigger('control-event', config[i].eventType, self.getControlValueById(config[i].controlId), config[i].controlId);
                    }
                }
                if (wasAnyRuleTriggered) {
                    self.loader.getRules().getDatabase().on('idle', runCallbackAsync);
                }
                else {
                    if (doneCallback) {
                        doneCallback();
                    }
                }
            });
            self.on('compute-single-control-rule', function (targetedControl) {
                var target = targetedControl.target;
                var allRules = self.loader.getRules().getRules();
                var rulesWithTargetControl = allRules.filter(function (e) {
                    var ruleQuery = e.actions[0].jql;
                    var regexControl = new RegExp("WHERE name IN\\( 'control_" + target + "'\\)", 'g');
                    var regexCalculation = new RegExp("calculated = 1", 'g');
                    var matchControl = ruleQuery.match(regexControl) && ruleQuery.match(regexCalculation);
                    if (matchControl) {
                        return e;
                    }
                });
                for (var i = 0, config = rulesWithTargetControl, len = config.length; i < len; i++) {
                    if (config[i].isRule) {
                        self.trigger('control-event', config[i].eventType, self.getControlValueById(config[i].controlId), config[i].controlId);
                    }
                }
            });
        })(this);
    };
    AbstractionLayerV2.prototype.getCurrentLanguage = function () {
        return this.loader.getI18n().getLanguageCode();
    };
    AbstractionLayerV2.prototype.getBindingProvider = function () {
        return (function (self) {
            return {
                canBind: function (bindingName) {
                    return bindingName && /^control_([\d]+)(_[\d]+)?$/.test(bindingName);
                },
                getBindedValue: function (bindingName) {
                    return self.getControlValueById(bindingName);
                }
            };
        })(this);
    };
    AbstractionLayerV2.prototype.setTextBasedControlValue = function (control, value, def) {
        if (!control.hasProperty("options.suggestions") || !Array.isArray(value) || (Array.isArray(value) && value.length === 1)) {
            var v = this.castValueToNativeFormat(value, def);
            def.element.setProperty(def.targetPropertyFQN, v);
            if (control.hasSuggestions) {
                control.setProperty("options.suggestions", null);
            }
            return true;
        }
        def.element.setProperty(def.targetPropertyFQN, null);
        if (!control.hasSuggestions) {
            return;
        }
        var autoSuggestions = [], row = '';
        for (var i = 0, len = value.length; i < len; i++) {
            if (Array.isArray(value[i])) {
                row = value[i].join(", ");
            }
            else {
                row = String(value[i] === 0
                    ? "0"
                    : (value[i]
                        ? value[i]
                        : ""));
            }
            if (row) {
                autoSuggestions.push(row);
            }
        }
        control.setProperty("options.suggestions", autoSuggestions.join("\n"));
    };
    return AbstractionLayerV2;
}(EventEmitter));
var CalculationsDatabaseBindingProvider = (function () {
    function CalculationsDatabaseBindingProvider(engine) {
        this.engine = engine;
    }
    CalculationsDatabaseBindingProvider.prototype.canBind = function (bindingName) {
        return bindingName === 'fixed_amount';
    };
    CalculationsDatabaseBindingProvider.prototype.getBindedValue = function (bindingName) {
        var fixedAmount = this.engine.getDocument().getConfiguration().getProperty('fixedAmount');
        return (bindingName === 'fixed_amount' && fixedAmount !== null)
            ? fixedAmount
            : 0;
    };
    return CalculationsDatabaseBindingProvider;
}());
var RequestQueryStringParameterBindingProvider = (function () {
    function RequestQueryStringParameterBindingProvider() {
        this.parsedQueryString = {};
        var parsedURL = UrlUtils.parse(window.location.toString());
        this.parsedQueryString = UrlUtils.parseQueryString((parsedURL.search || "?").substr(1));
    }
    RequestQueryStringParameterBindingProvider.prototype.canBind = function (bindingName) {
        return bindingName && /^request_/.test(bindingName);
    };
    RequestQueryStringParameterBindingProvider.prototype.getBindedValue = function (bindingName) {
        if (!this.parsedQueryString) {
            return '';
        }
        var queryParam = /^request_(.*)$/.exec(bindingName);
        return undefined === this.parsedQueryString[queryParam[1]]
            ? ''
            : this.parsedQueryString[queryParam[1]];
    };
    return RequestQueryStringParameterBindingProvider;
}());
var LanguageBindingProvider = (function () {
    function LanguageBindingProvider(engine) {
        this.engine = engine;
    }
    LanguageBindingProvider.prototype.canBind = function (bindingName) {
        return bindingName === 'language';
    };
    LanguageBindingProvider.prototype.getBindedValue = function (bindingName) {
        var result = this.engine.getLoader().getI18n().getLanguageCode();
        if (result === 'en') {
            result = 'gb';
        }
        return result;
    };
    return LanguageBindingProvider;
}());
var QuizScoreBindingProvider = (function () {
    function QuizScoreBindingProvider(engine, quizScoreService) {
        this.engine = engine;
        this.quizScoreService = quizScoreService;
    }
    QuizScoreBindingProvider.prototype.canBind = function (bindingName) {
        return bindingName === 'quiz_score';
    };
    QuizScoreBindingProvider.prototype.getBindedValue = function (bindingName) {
        return this.quizScoreService.getCurrentQuizScore();
    };
    return QuizScoreBindingProvider;
}());
var FormV2Table = (function () {
    function FormV2Table(translator, domAbstractionLayer) {
        this.calculatedControlsWhichNeedToTriggerRulesAgain = [];
        this.translator = translator;
        this.domAbstractionLayer = domAbstractionLayer;
        (function (self) {
            self.calculationsThrottler = Throttle.create(function () {
                self.translator.getDocument().realTimeCalculationsThrottler();
            }, 1);
            self.triggerRulesForCalculatedControlsThrottle = Throttle.create(function () {
                self.triggerRulesAgainForCalculatedControls();
            }, 100);
        })(this);
        this.initializeTableColumns();
        this.initializeControls();
    }
    FormV2Table.prototype.createSubPropertyInputRow = function (inputLegacyName, tableInputIndex, controlInputIndex, element, abstractionLayer) {
        var _this = this;
        var row = this.table.createRow()
            .withPropertyGetter('index', function () {
            return tableInputIndex;
        })
            .withPropertyGetter('name', function () {
            return inputLegacyName;
        })
            .withPropertyGetter('readOnly', function () {
            return element.isReadOnly(controlInputIndex);
        })
            .withPropertySetter('readOnly', function (readOnly) {
            element.setReadOnly(controlInputIndex, readOnly);
        })
            .withPropertyGetter('disabled', function () {
            return element.isDisabled(controlInputIndex);
        })
            .withPropertySetter('disabled', function (disabled) {
            element.setDisabled(controlInputIndex, disabled);
        })
            .withPropertyGetter('value', function () {
            return abstractionLayer.getControlValueById(inputLegacyName);
        })
            .withPropertySetter('value', function (value) {
            abstractionLayer.setControlValueById(inputLegacyName, value);
        })
            .withPropertyGetter('visible', function () {
            return element.isVisible();
        })
            .withPropertySetter('visible', function (visible) {
            element.setVisible(visible);
        })
            .withPropertyGetter('calculated', function () {
            return false;
        })
            .withPropertySetter('calculated', function (on) {
            if (on) {
                _this.calculatedControlsWhichNeedToTriggerRulesAgain.push(element.getId());
                _this.triggerRulesForCalculatedControlsThrottle();
                _this.calculationsThrottler();
            }
        });
        if (element.getTypeId() === ElementTypes.CONTROL_TYPE_RADIO || element.getTypeId() === ElementTypes.CONTROL_TYPE_CHECKBOX) {
            row
                .withPropertyGetter('checked', function () {
                return abstractionLayer.isControlChecked(inputLegacyName);
            })
                .withPropertySetter('checked', function (checked) {
                console.warn('Failed to set checked state of the control ' + inputLegacyName);
            });
        }
    };
    FormV2Table.prototype.appendMainControlRow = function (inputLegacyName, tableInputIndex, element, abstractionLayer) {
        var _this = this;
        this.table.createRow()
            .withPropertyGetter('index', function () {
            return tableInputIndex;
        })
            .withPropertyGetter('name', function () {
            return inputLegacyName;
        })
            .withPropertyGetter('readOnly', function () {
            return element.isReadOnly(null);
        })
            .withPropertySetter('readOnly', function (readOnly) {
            element.setReadOnly(null, readOnly);
        })
            .withPropertyGetter('disabled', function () {
            return element.isDisabled(null);
        })
            .withPropertySetter('disabled', function (disabled) {
            element.setDisabled(null, disabled);
        })
            .withPropertyGetter('value', function () {
            return abstractionLayer.getControlValueById(inputLegacyName);
        })
            .withPropertySetter('value', function (value) {
            abstractionLayer.setControlValueById(inputLegacyName, value);
        })
            .withPropertyGetter('visible', function () {
            return element.isVisible(true);
        })
            .withPropertySetter('visible', function (visible) {
            element.setVisible(visible);
        })
            .withPropertyGetter('label', function () {
            if (element.hasProperty('label.labelText')) {
                return element.getProperty('label.labelText');
            }
            else {
                return null;
            }
        })
            .withPropertySetter('label', function (labelText) {
            if (element.hasProperty('label.labelText')) {
                element.setProperty('label.labelText', String(labelText) || null);
            }
        })
            .withPropertyGetter('calculated', function () {
            return false;
        })
            .withPropertySetter('calculated', function (on) {
            if (on) {
                _this.calculationsThrottler();
                if (element.getTypeId() === ElementTypes.CONTROL_TYPE_FORMULA) {
                    element.onValueCalculatedThrottler();
                }
                _this.calculatedControlsWhichNeedToTriggerRulesAgain.push(element.getId());
                _this.triggerRulesForCalculatedControlsThrottle();
            }
        });
    };
    FormV2Table.prototype.appendRowForElementWithoutValue = function (imageControl, tableInputIndex) {
        this.table.createRow()
            .withPropertyGetter('index', function () {
            return tableInputIndex;
        })
            .withPropertyGetter('name', function () {
            return 'control_' + imageControl.getId();
        })
            .withPropertyGetter('readOnly', function () {
            return false;
        })
            .withPropertyGetter('disabled', function () {
            return false;
        })
            .withPropertyGetter('value', function () {
            return null;
        })
            .withPropertyGetter('visible', function () {
            return imageControl.isVisible();
        })
            .withPropertySetter('visible', function (visible) {
            imageControl.setVisible(visible);
        })
            .withPropertyGetter('label', function () {
            return null;
        })
            .withPropertyGetter('calculated', function () {
            return false;
        });
    };
    FormV2Table.prototype.appendRowForRepeatableContainer = function (repeatable, tableInputIndex, repeatableIndex) {
        this.table.createRow()
            .withPropertyGetter('index', function () {
            return tableInputIndex;
        })
            .withPropertyGetter('name', function () {
            return "control_repeatable-" + repeatableIndex;
        })
            .withPropertyGetter('readOnly', function () {
            return false;
        })
            .withPropertyGetter('disabled', function () {
            return false;
        })
            .withPropertyGetter('value', function () {
            return null;
        })
            .withPropertyGetter('visible', function () {
            return repeatable.isVisible();
        })
            .withPropertySetter('visible', function (visible) {
            repeatable.setVisible(visible);
        })
            .withPropertyGetter('label', function () {
            return null;
        })
            .withPropertyGetter('calculated', function () {
            return false;
        });
    };
    FormV2Table.prototype.initializeControls = function () {
        var abstractionLayer = this.domAbstractionLayer;
        var index = 0, repeatableIndex = 0;
        for (var i = 0, items = this.translator.getDocument().flatten(), len = items.length; i < len; i++) {
            if (EElementKind.CONTROL === items[i].getElementKind()) {
                if (items[i].getTypeId() === ElementTypes.CONTROL_TYPE_IMAGE || items[i].getTypeId() === ElementTypes.CONTROL_TYPE_SOCIAL) {
                    this.appendRowForElementWithoutValue(items[i], index);
                    index++;
                    continue;
                }
                if (items[i].getTypeId() === ElementTypes.CONTROL_TYPE_HTML_BLOCK) {
                    this.appendHTMLElementRow(items[i], index);
                    index++;
                    continue;
                }
                var inputIndex = 0, controlId = items[i].getId(), customEnumeratedIndexes = items[i].enumerateIndexes();
                if (null !== controlId) {
                    if (null === customEnumeratedIndexes) {
                        while (null !== items[i].getPropertyDescriptorByInputIndex(inputIndex)) {
                            this.createSubPropertyInputRow('control_' + controlId + '_' + inputIndex, index, inputIndex, items[i], abstractionLayer);
                            if (0 === inputIndex) {
                                index++;
                                this.appendMainControlRow('control_' + controlId, index, items[i], abstractionLayer);
                            }
                            index++;
                            inputIndex++;
                        }
                    }
                    else {
                        customEnumeratedIndexes.sort(function (a, b) {
                            return a - b;
                        });
                        for (var j = 0, n = customEnumeratedIndexes.length; j < n; j++) {
                            inputIndex = customEnumeratedIndexes[j];
                            this.createSubPropertyInputRow('control_' + controlId + '_' + inputIndex, index, inputIndex, items[i], abstractionLayer);
                            index++;
                        }
                        this.appendMainControlRow('control_' + controlId, index, items[i], abstractionLayer);
                    }
                }
            }
            else if (EElementKind.CONTAINER === items[i].getElementKind()
                && (items[i].getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE)) {
                repeatableIndex++;
                this.appendRowForRepeatableContainer(items[i], index, repeatableIndex);
                index++;
                continue;
            }
        }
        this.addVirtualLanguageRow();
        this.addActionBarButtonRows();
    };
    FormV2Table.prototype.addVirtualLanguageRow = function () {
        var i18n = this.translator.getDocument().getEngine().getLoader().getI18n(), formId = this.translator.getDocument().getId(), apiRootAddress = this.translator.getDocument().getEngine().getLoader().getApiRootAddress();
        this.table.createRow()
            .withPropertyGetter('visible', function () {
            return false;
        })
            .withPropertyGetter('disabled', function () {
            return false;
        })
            .withPropertyGetter('readOnly', function () {
            return false;
        })
            .withPropertyGetter('index', function () {
            return null;
        })
            .withPropertyGetter('name', function () {
            return 'language';
        })
            .withPropertyGetter('value', function () {
            return i18n.getLanguageCode();
        })
            .withPropertySetter('value', function (languageCode) {
            if ('string' !== typeof languageCode || languageCode.length != 2) {
                return;
            }
            i18n.clear().get(apiRootAddress + '/v2/language/' + languageCode + '/' + formId);
        })
            .withPropertyGetter("html", function () {
            return null;
        });
    };
    FormV2Table.prototype.addActionBarButtonRows = function () {
        var document = this.translator.getDocument(), numberOfPages = document.getNumberOfPages();
        for (var i = 0; i < numberOfPages; i++) {
            if (i + 1 < numberOfPages) {
                (function (pageNumber, self) {
                    self.table.createRow()
                        .withPropertyGetter('name', function () {
                        return 'control_button_next_page_' + pageNumber;
                    })
                        .withPropertyGetter('visible', function () {
                        return document.getPageByIndex(pageNumber).getActionBarButtonVisibility(EActionBarButton.NEXT_PAGE);
                    })
                        .withPropertySetter('visible', function (visible) {
                        document.getPageByIndex(pageNumber).setActionBarButtonVisibility(EActionBarButton.NEXT_PAGE, !!visible);
                    })
                        .withPropertyGetter('disabled', function () {
                        return false;
                    })
                        .withPropertyGetter('readOnly', function () {
                        return false;
                    })
                        .withPropertyGetter('index', function () {
                        return null;
                    })
                        .withPropertyGetter('value', function () {
                        return null;
                    })
                        .withPropertyGetter("html", function () {
                        return null;
                    });
                })(i, this);
            }
            if (i > 0) {
                (function (pageNumber, self) {
                    self.table.createRow()
                        .withPropertyGetter('name', function () {
                        return 'control_button_previous_page_' + pageNumber;
                    })
                        .withPropertyGetter('visible', function () {
                        return document.getPageByIndex(pageNumber).getActionBarButtonVisibility(EActionBarButton.PREVIOUS_PAGE);
                    })
                        .withPropertySetter('visible', function (visible) {
                        document.getPageByIndex(pageNumber).setActionBarButtonVisibility(EActionBarButton.PREVIOUS_PAGE, !!visible);
                    })
                        .withPropertyGetter('disabled', function () {
                        return false;
                    })
                        .withPropertyGetter('readOnly', function () {
                        return false;
                    })
                        .withPropertyGetter('index', function () {
                        return null;
                    })
                        .withPropertyGetter('value', function () {
                        return null;
                    })
                        .withPropertyGetter("html", function () {
                        return null;
                    });
                })(i, this);
            }
            if (i === numberOfPages - 1) {
                (function (pageNumber, self) {
                    self.table.createRow()
                        .withPropertyGetter('name', function () {
                        return 'control_button_submit';
                    })
                        .withPropertyGetter('visible', function () {
                        return document.getPageByIndex(pageNumber).getActionBarButtonVisibility(EActionBarButton.SUBMIT);
                    })
                        .withPropertySetter('visible', function (visible) {
                        document.getPageByIndex(pageNumber).setActionBarButtonVisibility(EActionBarButton.SUBMIT, !!visible);
                    })
                        .withPropertyGetter('disabled', function () {
                        return false;
                    })
                        .withPropertyGetter('readOnly', function () {
                        return false;
                    })
                        .withPropertyGetter('index', function () {
                        return null;
                    })
                        .withPropertyGetter('value', function () {
                        return null;
                    })
                        .withPropertyGetter('html', function () {
                        return null;
                    });
                })(i, this);
                (function (pageNumber, self) {
                    self.table.createRow()
                        .withPropertyGetter('name', function () {
                        return 'control_button_reset';
                    })
                        .withPropertyGetter('visible', function () {
                        return document.getPageByIndex(pageNumber).getActionBarButtonVisibility(EActionBarButton.RESET);
                    })
                        .withPropertySetter('visible', function (visible) {
                        document.getPageByIndex(pageNumber).setActionBarButtonVisibility(EActionBarButton.RESET, !!visible);
                    })
                        .withPropertyGetter('disabled', function () {
                        return false;
                    })
                        .withPropertyGetter('readOnly', function () {
                        return false;
                    })
                        .withPropertyGetter('index', function () {
                        return null;
                    })
                        .withPropertyGetter('value', function () {
                        return null;
                    })
                        .withPropertyGetter("html", function () {
                        return null;
                    });
                })(i, this);
            }
        }
    };
    FormV2Table.prototype.getTable = function () {
        return this.table;
    };
    FormV2Table.prototype.initializeTableColumns = function () {
        var tableFactory = window['JQLTableFactory'];
        if (!tableFactory) {
            throw new Error('Cannot load JQLTableFactory module!');
        }
        this.table = tableFactory.createVirtualTable([
            {
                default: 0,
                type: EJQLTableColumnType.NUMBER,
                name: 'index',
            },
            {
                default: '',
                type: EJQLTableColumnType.STRING,
                name: 'name',
            },
            {
                default: '',
                type: EJQLTableColumnType.STRING,
                name: 'label',
            },
            {
                default: true,
                type: EJQLTableColumnType.BOOLEAN,
                name: 'visible',
            },
            {
                default: false,
                type: EJQLTableColumnType.BOOLEAN,
                name: 'readOnly',
            },
            {
                default: false,
                type: EJQLTableColumnType.BOOLEAN,
                name: 'disabled',
            },
            {
                default: null,
                type: EJQLTableColumnType.NULL,
                name: 'value',
            },
            {
                default: false,
                type: EJQLTableColumnType.BOOLEAN,
                name: 'checked',
            },
            {
                default: false,
                type: EJQLTableColumnType.BOOLEAN,
                name: 'calculated',
            },
            {
                default: "",
                type: EJQLTableColumnType.STRING,
                name: "html",
            }
        ]);
    };
    FormV2Table.create = function (translator, domAbstractionLayer) {
        return (new FormV2Table(translator, domAbstractionLayer)).getTable();
    };
    FormV2Table.prototype.triggerRulesAgainForCalculatedControls = function () {
        if (!this.calculatedControlsWhichNeedToTriggerRulesAgain || !this.calculatedControlsWhichNeedToTriggerRulesAgain.length) {
            return;
        }
        var uniqueIds = [];
        for (var i = 0, len = this.calculatedControlsWhichNeedToTriggerRulesAgain.length; i < len; i++) {
            if (-1 === uniqueIds.indexOf(this.calculatedControlsWhichNeedToTriggerRulesAgain[i])) {
                uniqueIds.push(this.calculatedControlsWhichNeedToTriggerRulesAgain[i]);
            }
        }
        this.calculatedControlsWhichNeedToTriggerRulesAgain = [];
        var form = this.translator.getDocument(), controlsList = form.getControlsList();
        for (var i = 0, len = controlsList.length; i < len; i++) {
            if (uniqueIds.indexOf(controlsList[i].getId()) > -1) {
                this.triggerControlChangeForControl(controlsList[i]);
            }
        }
    };
    FormV2Table.prototype.triggerControlChangeForControl = function (control) {
        switch (control.getTypeId()) {
            case ElementTypes.CONTROL_TYPE_CHECKBOX:
            case ElementTypes.CONTROL_TYPE_RADIO:
                this.domAbstractionLayer.trigger('control-event', EFormRuleEventType.CHECK, null, 'control_' + control.getId(), null);
                break;
            case ElementTypes.CONTROL_TYPE_DROPDOWN:
                this.domAbstractionLayer.trigger('control-event', EFormRuleEventType.CHANGE, null, 'control_' + control.getId(), null);
                break;
            default:
                this.domAbstractionLayer.trigger('control-event', EFormRuleEventType.TEXT_INPUT, null, 'control_' + control.getId(), null);
                break;
        }
    };
    FormV2Table.prototype.appendHTMLElementRow = function (htmlBlockControl, index) {
        this.table.createRow()
            .withPropertyGetter('index', function () {
            return index;
        })
            .withPropertyGetter('name', function () {
            return 'control_' + htmlBlockControl.getId();
        })
            .withPropertyGetter('readOnly', function () {
            return false;
        })
            .withPropertyGetter('disabled', function () {
            return false;
        })
            .withPropertyGetter('value', function () {
            return null;
        })
            .withPropertyGetter('visible', function () {
            return htmlBlockControl.isVisible();
        })
            .withPropertySetter('visible', function (visible) {
            htmlBlockControl.setVisible(visible);
        })
            .withPropertyGetter('label', function () {
            return null;
        })
            .withPropertyGetter('calculated', function () {
            return false;
        })
            .withPropertyGetter("html", function () {
            return htmlBlockControl.getProperty("configuration.innerHTML");
        })
            .withPropertySetter("html", function (html) {
            htmlBlockControl.setProperty("configuration.innerHTML", String(html));
        });
    };
    return FormV2Table;
}());
var JQLDatabaseFunctionsV2 = (function () {
    function JQLDatabaseFunctionsV2(domAbstractionLayer) {
        this.domAbstractionLayer = domAbstractionLayer;
    }
    JQLDatabaseFunctionsV2.prototype.IS_CONTROL_CHECKED = function (controlId) {
        return this.domAbstractionLayer.isControlChecked(controlId);
    };
    JQLDatabaseFunctionsV2.prototype.IS_NOT_CONTROL_CHECKED = function (controlId) {
        return !this.domAbstractionLayer.isControlChecked(controlId);
    };
    return JQLDatabaseFunctionsV2;
}());
var RulesQueryBuilder = (function () {
    function RulesQueryBuilder(abstractionLayer, database, document) {
        this.calculationSQLByTargetControl = {};
        this.abstractionLayer = abstractionLayer;
        this.database = database;
        this.document = document;
    }
    RulesQueryBuilder.prototype.getControlEventTypeWhenUserChangesControl = function (controlId, defaultAction) {
        if (null === controlId) {
            return defaultAction;
        }
        var matches;
        if (matches = /^control_([\d]+)/.exec(controlId)) {
            var controlId_1 = parseInt(matches[1]), control = this.document.getElementById(controlId_1);
            if (control) {
                switch (control.getTypeId()) {
                    case ElementTypes.CONTROL_TYPE_DROPDOWN:
                    case ElementTypes.CONTROL_TYPE_FILE:
                        return EFormRuleEventType.CHANGE;
                }
            }
        }
        return defaultAction;
    };
    RulesQueryBuilder.prototype.indexRuleTarget = function (rule, computedSQL) {
        if (rule && rule.action && rule.action.target && Array.isArray(rule.action.target)) {
            for (var i = 0, len = rule.action.target.length; i < len; i++) {
                var target = String(rule.action.target[i] || '');
                if (target) {
                    this.calculationSQLByTargetControl[target] = this.calculationSQLByTargetControl[target] || [];
                    this.calculationSQLByTargetControl[target].push(computedSQL);
                }
            }
        }
    };
    RulesQueryBuilder.prototype.buildAction = function (rule) {
        var _this = this;
        var result = [], jql, statementAffectedControls = [], self = this;
        switch (rule.action.type) {
            case ERuleActionType.HIDE_CONTROL:
                jql = "UPDATE controls SET visible = IF(" + rule.expression + " , false, true) WHERE name IN( 'control_" + rule.action.target.join("','control_") + "') LIMIT " + rule.action.target.length;
                break;
            case ERuleActionType.SHOW_CONTROL:
                jql = "UPDATE controls SET visible = IF(" + rule.expression + " , true, false) WHERE name IN( 'control_" + rule.action.target.join("','control_") + "') LIMIT " + rule.action.target.length;
                break;
            case ERuleActionType.CALCULATE:
                jql = "UPDATE controls SET readOnly = true, calculated = 1, value = IF( visible, STRING(" + rule.expression + "), STRING(0)) WHERE name IN( 'control_" + rule.action.target.join("','control_") + "') LIMIT " + rule.action.target.length;
                this.indexRuleTarget(rule, jql);
                break;
        }
        try {
            var statement = this.database.createStatement(jql);
        }
        catch (statementCreationError) {
            console.warn('Failed to create JQL rule statement: ' + jql);
            console.error(statementCreationError);
            return null;
        }
        rule.expression
            .replace(/IS_(NOT_)?CONTROL_CHECKED\('(control_[\d]+_[\d]+)'\)/g, function (substring) {
            var matches = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                matches[_i - 1] = arguments[_i];
            }
            statementAffectedControls.push({
                controlId: matches[1],
                eventType: EFormRuleEventType.CHECK,
            });
            statementAffectedControls.push({
                controlId: matches[1],
                eventType: EFormRuleEventType.UNCHECK,
            });
            return '';
        })
            .replace(/:(control[-_]{0,1})?([\d]+)([-_]([\d]+))?/g, function (substring) {
            var matches = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                matches[_i - 1] = arguments[_i];
            }
            var controlId = substring.slice(1);
            statementAffectedControls.push({
                controlId: controlId,
                eventType: self.getControlEventTypeWhenUserChangesControl(controlId, self.getControlEventTypeForRules(controlId)),
            });
            return '';
        })
            .replace(/:language[^a-z0-9_]/g, function (substring) {
            var matches = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                matches[_i - 1] = arguments[_i];
            }
            statementAffectedControls.push({
                controlId: 'language',
                eventType: EFormRuleEventType.ALL_EVENTS
            });
            return '';
        })
            .replace(/:quiz_score/g, function (substring) {
            var matches = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                matches[_i - 1] = arguments[_i];
            }
            statementAffectedControls.push({
                controlId: "quiz_score",
                eventType: EFormRuleEventType.ALL_EVENTS
            });
            _this.document.getEngine().getLoader().getQuizScoreService().setEnabled(true);
            return '';
        });
        var isCalculateExpressionWithoutControls = null;
        if (ERuleActionType.CALCULATE === rule.action.type) {
            isCalculateExpressionWithoutControls = true;
            rule.expression.replace(/control[-_]{0,1}([\d]+)([-_]([\d]+))?/g, function (substring) {
                var matches = [];
                for (var _i = 1; _i < arguments.length; _i++) {
                    matches[_i - 1] = arguments[_i];
                }
                statementAffectedControls.push({
                    controlId: substring,
                    eventType: self.getControlEventTypeWhenUserChangesControl(substring, EFormRuleEventType.TEXT_INPUT),
                });
                isCalculateExpressionWithoutControls = false;
                return '';
            });
        }
        var addStatement;
        for (var i = 0, len = statementAffectedControls.length; i < len; i++) {
            addStatement = true;
            for (var j = 0, n = result.length; j < n; j++) {
                if (result[j].eventType === statementAffectedControls[i].eventType && result[j].controlId === statementAffectedControls[i].controlId) {
                    addStatement = false;
                    break;
                }
            }
            if (addStatement) {
                result.push({
                    controlId: statementAffectedControls[i].controlId,
                    eventType: statementAffectedControls[i].eventType,
                    actions: [
                        {
                            controlId: statementAffectedControls[i].controlId,
                            jql: jql
                        }
                    ],
                    isRule: true,
                });
            }
        }
        if (isCalculateExpressionWithoutControls === true && 0 === result.length && rule.action.target && rule.action.target.length === 1) {
            result.push({
                controlId: "control_" + rule.action.target[0],
                actions: [
                    {
                        controlId: "control_" + rule.action.target[0],
                        jql: jql,
                    }
                ],
                eventType: EFormRuleEventType.ALL_EVENTS,
                isRule: true
            });
        }
        return result;
    };
    RulesQueryBuilder.prototype.getControlEventTypeForRules = function (controlId) {
        if (typeof this.controlsFlattenCache === 'undefined') {
            this.controlsFlattenCache = this.document.flatten();
        }
        var searchControlId = null, searchControlIndexId = null;
        if ('number' === typeof controlId) {
            searchControlId = controlId;
        }
        else if ('string' === typeof controlId) {
            var matches = /^(control[\-_])?([\d]+)([\-_]([\d]+))?$/.exec(controlId);
            if (!matches) {
                return EFormRuleEventType.TEXT_INPUT;
            }
            searchControlId = parseInt(matches[2], 10);
            if (matches[4]) {
                searchControlIndexId = parseInt(matches[4], 10);
            }
        }
        if (null === searchControlId) {
            return EFormRuleEventType.TEXT_INPUT;
        }
        for (var i = 0, len = this.controlsFlattenCache.length; i < len; i++) {
            if (this.controlsFlattenCache[i].getId() === searchControlId) {
                var controlTypeId = this.controlsFlattenCache[i].getTypeId();
                switch (controlTypeId) {
                    case ElementTypes.CONTROL_TYPE_ADDRESS:
                        if (AddressControl.INDEX_COUNTRY === searchControlIndexId) {
                            return EFormRuleEventType.CHANGE;
                        }
                    default:
                        return EFormRuleEventType.TEXT_INPUT;
                }
            }
        }
        return EFormRuleEventType.TEXT_INPUT;
    };
    RulesQueryBuilder.prototype.getCalculationSQLStatements = function (controlId) {
        return this.calculationSQLByTargetControl[controlId] || null;
    };
    return RulesQueryBuilder;
}());
var QuizScoreService = (function (_super) {
    __extends(QuizScoreService, _super);
    function QuizScoreService() {
        var _this = _super.call(this) || this;
        _this.quizScore = 0;
        _this.enabled = false;
        setTimeout(function () {
            _this.updateInImmediateMode();
        }, 500);
        _this.updateInAsyncMode = Throttle.create(function () {
            _this.updateInImmediateMode();
        }, 500);
        return _this;
    }
    QuizScoreService.prototype.updateInImmediateMode = function () {
        var _this = this;
        if (!this.commandDispatcher) {
            return;
        }
        if (!this.enabled) {
            return;
        }
        console.warn('QUIZ SCORE: START UPDATE');
        this.commandDispatcher.getQuizScoreResults()
            .then(function (quizScoreResults) {
            var points = quizScoreResults.details.quizScore;
            console.warn('QUIZ SCORE: GOT POINTS: ' + points);
            if (_this.quizScore !== points) {
                _this.quizScore = points;
                _this.trigger('change');
            }
        })
            .fail(function (e) {
            console.error(e);
        });
    };
    QuizScoreService.prototype.getCurrentQuizScore = function () {
        return this.quizScore;
    };
    QuizScoreService.prototype.withCommandDispatcher = function (commandDispatcher) {
        this.commandDispatcher = commandDispatcher;
        return this;
    };
    QuizScoreService.prototype.isEnabled = function () {
        return this.enabled;
    };
    QuizScoreService.prototype.setEnabled = function (enabledState) {
        this.enabled = !!enabledState;
        return this;
    };
    return QuizScoreService;
}(EventEmitter));
var navigateAction = EditorUI.Actions.navigate;
var setPublishTab = EditorUI.Actions.setPublishTab;
var setFormIdAction = EditorUI.Actions.setFormId;
var setInitialFormControls = EditorUI.Actions.setInitialFormControls;
var setFormAsHipaa = EditorUI.Actions.setFormAsHipaa;
var updateControlsIds = EditorUI.Actions.updateControlsIds;
var updateApprovalOfSubmission = EditorUI.Actions.updateApprovalOfSubmission;
var EditorLoader = (function (_super) {
    __extends(EditorLoader, _super);
    function EditorLoader() {
        var _this = _super.call(this) || this;
        _this.header = null;
        _this.editUserAccessMode = EEditorUserAccessMode.FULL_EDIT;
        _this.mobileDevice = false;
        _this.mobileInteractionsEnabled = false;
        _this.readonlySubuser = false;
        _this.uiCSSSelectors = {
            'undo-button': '#menu_undo',
            'redo-button': '#menu_redo',
            'themes-button': '#hide-themes-options',
            'selection-delete-button': '',
            'view-form-button': '',
            'show-grid-checkbox': '',
            'form-name-input': '#myformnameinput',
            'saving-container': '',
            'editor-settings-panel': '#editor-settings-panel',
            'show-controls-list': '#show_controls_list',
            'mobile-item-editor-toolbar': '#mobile-item-editor-toolbar'
        };
        _this.saveToServer = false;
        _this.savingEnabled = true;
        _this.hasSaveRequests = false;
        _this.resources = {};
        _this.showDowngradeNotification = true;
        _this.isFirstTime = false;
        _this.shouldSeeMigrationToOldEditorNotification = false;
        _this.shouldSeeHipaaSecurityPopup = false;
        _this.themeStrategy = EThemeStrategy.INTERNAL;
        _this.openInspectorOnInsert = false;
        _this.translationsDropdownVisibleOnForm = false;
        _this.isFFTForm = false;
        _this.userFeatures = null;
        _this.popupNotifications = null;
        _this.mobileInteractionsDisabled = false;
        _this.dropdownsWithForms = false;
        _this.controlsThatHaveRepeatablePathsAddedToPrefillValue = [];
        _this.fetchExperimentResults = true;
        _this.selectedCurrencyId = PaymentsProductsDialog.DEFAULT_CURRENCY_ID;
        _this.summarySettingsCache = {};
        _this.rules = window['RulesV3'].getInstance();
        if (!_this.rules) {
            throw new Error('Cannot load RulesV3 module!');
        }
        if (!window['builderStore']) {
            throw new Error('Dependency not found: builderStore');
        }
        _this.store = window['builderStore'];
        if (!window['builderUrlHandler']) {
            throw new Error('Dependency not found: builderUrlHandler');
        }
        _this.URLHandler = window['builderUrlHandler'];
        if (!window['EditorPanelConfig']) {
            throw new Error('Dependency not found: EditorPanelConfig');
        }
        _this.editorPanelConfig = window['EditorPanelConfig'];
        _this.viewManager = new ViewManager();
        if (!window['userService']) {
            throw new Error('Dependency not found: userService');
        }
        _this.userService = window['userService'].getInstance();
        return _this;
    }
    EditorLoader.prototype.navigate = function (destination) {
        var action = navigateAction(destination);
        this.store.dispatch(action);
    };
    EditorLoader.prototype.setPublishTab = function (tabId) {
        var action = setPublishTab(tabId);
        this.store.dispatch(action);
    };
    EditorLoader.prototype.init = function () {
        var _this = this;
        this.mobileDevice = (BrowserDetector.meetsRequirements('* * mobile * *') === '');
        this.initPlatformBodyAttributes();
        this.jq = jQuery.noConflict();
        this.api = new Api(this.jq, this.apiRootAddress);
        this.engine = new Engine(this, ElementsFactory.createFactory(this.editorCapabilities.factory.name, this.editorCapabilities), this.jq, this.form, this.editorCapabilities, this.resources);
        PaymentsSummaryHelper.createInstance(this.engine);
        PaymentsSummaryHelper.addSalvageHelpers();
        this.formTranslationsService = new FormTranslationsService(this.engine.getDocument());
        this.editorPanelGroup = new window['EditorPanelGroup'](document.getElementById('inspector-panel-group'));
        this.viewManager.setLoader(this);
        this.viewManager.setPanelGroup(this.editorPanelGroup);
        this.i18n = new I18n(this.jq, this.api, this.lang, this.engine.getResourceManager());
        UI.withI18n(this.i18n);
        UI.withResourceManager(this.engine.getResourceManager());
        this.fontsManager = new FontsManager(this.engine.getResourceManager(), this.jq);
        this.i18n.on('load', function () {
            _this.engine.getDocument().updateI18n();
            console.warn('LOADED I18n');
            _this.displayTranslatedNotifications();
            if (_this.readonlySubuser) {
                _this.commands.displayReadonlySubuserCannotSave();
            }
        });
        this.i18n.get();
        this.storage = new PersistentStorage(this.engine);
        var undoServiceProvider;
        if (this.header) {
            undoServiceProvider = new HeaderUndoServiceInteractionProvider(this.header);
        }
        else {
            undoServiceProvider = new ButtonUndoServiceInteractionProvider(this.getUICssSelector("undo-button"), this.getUICssSelector("redo-button"));
        }
        this.undoService = new UndoService(this.engine, undoServiceProvider);
        this.ui = new EditorUserInterface(this.engine);
        UserFileExtensionsService.getInstance().withUI(this.ui).withResourceManager(this.engine.getResourceManager());
        this.oAuth = new EditorOAuthFlow(this);
        this.commands = new EditorCommandDispatcher(this.engine, this);
        this.selection = new FormSelection(this.engine.getDocument());
        this.mouseManager = new MouseManager(this.jq, this.form, this.engine.getDocument());
        this.editorPanelConfig.configurePanels(this.editorPanelGroup, this, this.jq, this.engine.getDocument());
        this.updateFormErrorStateNotificationThrottle = Throttle.create(function () {
            _this.commands.updateFormErrorStateNotification();
        }, 100);
        this.onEditorSettingsListChangedThrottle = Throttle.create(function () {
            _this.commands.updateEditorSettingsPanel();
            _this.commands.refreshPaymentsAvailabilityStatus();
            var publishPanel = _this.editorPanelConfig.getPublishPanel();
            if (!publishPanel)
                return;
            _this.editorPanelConfig
                .getPublishPanel()
                .withDependency('formName', _this.engine.getDocument().getProperty('name.value'))
                .withDependency('headerInstance', _this.header)
                .withDependency('undoServiceInstance', _this.undoService);
        }, 200);
        this.initEventingSystem(this.saveToServer ? 1000 : 10);
        if (undefined === this.initialSerializedForm) {
            this.storage.load();
        }
        else {
            this.engine.loadFromString(JSON.stringify(this.initialSerializedForm));
            this.initialSerializedForm = undefined;
        }
        if (this.shouldSeeMigrationToOldEditorNotification) {
            this.commands.displayMigrationNotification();
        }
        this.commands.displayNotificationForFinalizationPricesAndPaymentProviderIfNeeded();
        this.commands.displayNotificationForFirstValueAndProcessorIfNeeded();
        this.commands.notifyTrackerWithUserTimeSpentOnEditor(this.isFirstTime);
        this.setFormEditorInWixAttribute();
        this.commands.makePreviewOverlayCoverEditorElementsOnWix();
        this.engine.getDocument().on('editor-settings-changed', function () {
            _this.onEditorSettingsListChangedThrottle();
        });
        this.on('unserialize', function () {
            _this.onEditorSettingsListChangedThrottle();
        });
        this.loadStartupPanel();
        this.onEditorSettingsListChangedThrottle();
        this.updateClickOnPublishButtonForWeebly();
        this.formTranslationsService.on('translations-list-changed', function () {
            console.warn('TRANSLATIONS LIST CHANGED HOOK!');
            var languages = _this.getFormTranslationsService().getLanguages();
            _this.languages = [];
            for (var i = 0, n = languages.length; i < n; i++) {
                if (languages[i].getCode2()) {
                    _this.languages.push(languages[i].getCode2());
                }
                else {
                    _this.languages.push(languages[i].getCode3());
                }
            }
            _this.withTranslationsDropdownVisibleOnForm(_this.formTranslationsService.enumerateAvailableFormLanguages().length > 1);
            if (_this.isTranslationsDropdownVisibleOnForm()) {
                _this.form.setAttribute('data-has-language-selector', '');
                _this.engine.getDocument().getPageByIndex(0).renderHeader();
            }
            else {
                _this.form.removeAttribute('data-has-language-selector');
                _this.engine.getDocument().getPageByIndex(0).renderHeader();
            }
        });
        this.trigger('load');
        this.userService.init(this.getFormId()).then(function (response) {
            if (response[0]) {
                _this.identityResponse = response[0];
            }
            if (response[1]) {
                _this.contextualIdentityResponse = response[1];
            }
            _this.addPaymentSummaryPageContainerIfNeeded();
        });
        this.triggerPaywallForPaidTemplateFromFFT();
        this.initializeBlankDocumentFromOCRSerializedData();
        var paymentSettings = this.engine.getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING);
        if (paymentSettings && paymentSettings.hasProperty('currencyId')) {
            this.selectedCurrencyId = paymentSettings.getProperty('currencyId');
        }
        this.renderHeaderOnAllPages();
        this.engine.getDocument().on('editor-save-form-finished', function (response) {
            var action = updateControlsIds(response);
            _this.store.dispatch(action);
        });
        return this;
    };
    EditorLoader.prototype.getPublishPanelByTabId = function (tabId) {
        var result = EPublishPanelIds.LINK;
        switch (tabId) {
            case EPublishTabs.EMBED_JAVASCRIPT:
                return EPublishPanelIds.EMBED_JAVASCRIPT;
            case EPublishTabs.PLATFORM_BIG_COMMERCE:
                if (this.getPlatformDetails().isBigCommerce) {
                    return 'bigcommerce-embed-in-page-publish-method';
                }
                return EPublishPanelIds.PLATFORM_BIG_COMMERCE;
            case EPublishTabs.PLATFORM_BLOGGER:
                return EPublishPanelIds.PLATFORM_BLOGGER;
            case EPublishTabs.PLATFORM_FACEBOOK:
                return EPublishPanelIds.PLATFORM_FACEBOOK;
            case EPublishTabs.PLATFORM_GOOGLE_SITES:
                return EPublishPanelIds.PLATFORM_GOOGLE_SITES;
            case EPublishTabs.PLATFORM_JOOMLA:
                return EPublishPanelIds.PLATFORM_JOOMLA;
            case EPublishTabs.PLATFORM_SALESFORCE:
                return EPublishPanelIds.PLATFORM_SALESFORCE;
            case EPublishTabs.PLATFORM_SALESFORCE_COMMUNITY:
                return EPublishPanelIds.PLATFORM_SALESFORCE_COMMUNITY;
            case EPublishTabs.PLATFORM_SHOPIFY:
                if (this.getPlatformDetails().isShopify) {
                    return 'shopify-embed-in-page-publish-method';
                }
                return EPublishPanelIds.PLATFORM_SHOPIFY;
            case EPublishTabs.PLATFORM_TWITTER:
                return EPublishPanelIds.PLATFORM_TWITTER;
            case EPublishTabs.PLATFORM_UNBOUNCE:
                return EPublishPanelIds.PLATFORM_UNBOUNCE;
            case EPublishTabs.PLATFORM_WORDPRESS:
                return EPublishPanelIds.PLATFORM_WORDPRESS;
            case EPublishTabs.PLATFORM_WEEBLY:
                return EPublishPanelIds.PLATFORM_WEEBLY;
            case EPublishTabs.PUBLISH_PLATFORMS:
                return EPublishPanelIds.PUBLISH_PLATFORMS;
        }
        return result;
    };
    EditorLoader.prototype.triggerPaywallForPaidTemplateFromFFT = function () {
        var _this = this;
        if (this.isFFTForm) {
            var controlsNumber = this.getEngine().getDocument().getForm().getControlsList().length, toPlan_1 = null, hasPymentProcessors = this.getEngine().getDocument().getConfiguration().getProperty('isPaymentEnabled'), reason_1 = null, maxNumberOfControlsByFactory = this.engine.getFactory().getMaxNumberOfControls(null);
            switch (true) {
                case hasPymentProcessors:
                    toPlan_1 = 1;
                    reason_1 = EUpgradeReason.PAYMENTS_NOT_SUPPORTED_IN_CURRENT_USER_PLAN;
                    break;
                case this.platformDetails.isWixPlatform && this.userPlanName === EUserPlanNames.USER_PLAN_FREE
                    && controlsNumber < EFormFieldsLimit.USER_FIELDS_PLAN_STARTER:
                    toPlan_1 = 0;
                    reason_1 = EUpgradeReason.CREATE_NEW_FORM_NOT_SUPPORTED_IN_CURRENT_USER_PLAN;
                    break;
                case (this.userPlanName === EUserPlanNames.USER_PLAN_FREE || this.userPlanName === EUserPlanNames.USER_PLAN_STARTER)
                    && controlsNumber > maxNumberOfControlsByFactory:
                    toPlan_1 = 1;
                    reason_1 = EUpgradeReason.CREATE_NEW_FORM_NOT_SUPPORTED_IN_CURRENT_USER_PLAN;
                    break;
                default:
                    break;
            }
            if (toPlan_1 !== null) {
                setTimeout(function (e) {
                    _this.commands.triggerPaywall(reason_1, toPlan_1);
                }, 5000);
            }
        }
    };
    EditorLoader.prototype.displayTranslatedNotifications = function () {
        this.commands.displayPostMigrationNotification();
    };
    EditorLoader.prototype.withPlatformDetails = function (details) {
        this.platformDetails = details;
        return this;
    };
    EditorLoader.prototype.getPlatformDetails = function () {
        return this.platformDetails;
    };
    EditorLoader.prototype.withAPIRootAddress = function (apiRootAddress) {
        this.apiRootAddress = apiRootAddress;
        this.userService.setApiRoot(apiRootAddress);
        return this;
    };
    EditorLoader.prototype.withEditorCapabilities = function (editorCapabilities) {
        this.editorCapabilities = editorCapabilities;
        return this;
    };
    EditorLoader.prototype.withFormId = function (formId) {
        var action = setFormIdAction(formId);
        this.store.dispatch(action);
        return this;
    };
    EditorLoader.prototype.withFormDOMNode = function (form) {
        this.form = form;
        return this;
    };
    EditorLoader.prototype.withLanguageCode = function (lang) {
        this.lang = lang;
        return this;
    };
    EditorLoader.prototype.withUserId = function (userId) {
        this.userId = userId;
        return this;
    };
    EditorLoader.prototype.withCustomUICSSSelectors = function (selectors) {
        this.uiCSSSelectors = selectors || this.uiCSSSelectors;
        return this;
    };
    EditorLoader.prototype.withInitialSerializedForm = function (data) {
        var action = setInitialFormControls(data);
        this.store.dispatch(action);
        this.initialSerializedForm = data;
        this.saveToServer = undefined !== data;
        return this;
    };
    EditorLoader.prototype.withIsFirstTime = function (isFirstTime) {
        this.isFirstTime = isFirstTime;
        return this;
    };
    EditorLoader.prototype.withIsFFTForm = function (isFFTForm) {
        this.isFFTForm = isFFTForm;
        return this;
    };
    EditorLoader.prototype.withUserPlanName = function (userPlanName) {
        this.userPlanName = userPlanName;
        return this;
    };
    EditorLoader.prototype.withHeader = function (header) {
        this.header = header;
        return this;
    };
    EditorLoader.prototype.getHeader = function () {
        return this.header;
    };
    EditorLoader.prototype.withMigrationToOldEditorNotification = function (shouldSeeMigrationToOldEditorNotification) {
        this.shouldSeeMigrationToOldEditorNotification = shouldSeeMigrationToOldEditorNotification;
        return this;
    };
    EditorLoader.prototype.getSessionId = function () {
        return this.sessionId || null;
    };
    EditorLoader.prototype.withSessionId = function (sessionId) {
        this.sessionId = sessionId;
        return this;
    };
    EditorLoader.prototype.withWixAuthorizedRequestDetails = function (wixAuthorizedRequestDetails) {
        this.wixAuthorizedRequestDetails = wixAuthorizedRequestDetails || null;
        return this;
    };
    EditorLoader.prototype.getWixAuthorizedRequestDetails = function () {
        return JSON.parse(JSON.stringify(this.wixAuthorizedRequestDetails || null));
    };
    EditorLoader.prototype.getApiRootAddress = function () {
        return this.apiRootAddress;
    };
    EditorLoader.prototype.getEditorCapabilities = function () {
        return this.editorCapabilities;
    };
    EditorLoader.prototype.getFormId = function () {
        var state = this.store.getState();
        return parseInt(state.form.id);
    };
    EditorLoader.prototype.getEngine = function () {
        return this.engine;
    };
    EditorLoader.prototype.getJQuery = function () {
        return this.jq;
    };
    EditorLoader.prototype.getUndoService = function () {
        return this.undoService;
    };
    EditorLoader.prototype.withOpenInspectorOnInsert = function (openInspectorOnInsert) {
        this.openInspectorOnInsert = openInspectorOnInsert;
        return this;
    };
    EditorLoader.prototype.getOpenInspectorOnInsert = function () {
        return this.openInspectorOnInsert;
    };
    EditorLoader.prototype.getUICssSelector = function (uiElement) {
        if ('string' !== typeof this.uiCSSSelectors[uiElement]) {
            console.warn('EDITOR: feature-request not implemented on this page, UI component: ' + JSON.stringify(uiElement));
            return '';
        }
        return this.uiCSSSelectors[uiElement];
    };
    EditorLoader.prototype.initEventingSystem = function (saveAgresivity) {
        (function (self, engine, document, $, theme) {
            var windowWidth = window.innerWidth;
            window.addEventListener('resize', _.debounce(function () {
                self.onWindowResized();
                (windowWidth !== window.innerWidth) && self.editorPanelGroup.setVisible(false);
                windowWidth = window.innerWidth;
            }, 500), {
                capture: true,
                passive: true
            });
            self.onWindowResized();
            self.openEditorPanelGroupWhenStartupPanelIsPresent();
            self.on('unserialize', function () {
                self.commands.executeFormPostUnserializationActions();
                self.commands.insertTooltipIfNeeded('unserialize-form');
            });
            self.itemPanelOuterPlaceholder = window.document.getElementById('item');
            self.onDocumentChangedThrottler = Throttle.create(function () {
                self.saveDocumentInImmediateMode();
            }, saveAgresivity);
            document.on('change', function () {
                self.onDocumentChangedThrottler();
            });
            theme.on('change', function () {
                self.onDocumentChangedThrottler();
                theme.recompute();
            });
            theme.on('repaint-only', function () {
                theme.recompute();
            });
            theme.on('theme-font-changed', function (fontFamily) {
                self.commands.updateThemeThumbnailFont(fontFamily);
            });
            self.undoService.on('change', function () {
                self.saveDocumentInImmediateMode();
                self.commands.reloadVisiblePanel();
            });
            var $$undo = self.getUICssSelector('undo-button'), $$viewform = self.getUICssSelector('view-form-button'), $$themes = self.getUICssSelector('themes-button'), $$selectiondelete = self.getUICssSelector('selection-delete-button'), $$gridvisibilitycheckbox = self.getUICssSelector('show-grid-checkbox'), $$formnameinput = self.getUICssSelector('form-name-input'), $$editorSettingsPanel = self.getUICssSelector('editor-settings-panel'), $$showItemsListPanel = self.getUICssSelector('show-controls-list'), $$mobileItemEditorToolbar = self.getUICssSelector('mobile-item-editor-toolbar');
            $($$undo).on('click', function () {
                self.execCommand('undo');
            });
            $($$viewform).on('click', function () {
                self.execCommand('view-form');
            });
            $($$themes).on('click', function () {
                if (self.mobileInteractionsEnabled) {
                    var activePanel = void 0;
                    if (!self.editorPanelGroup.isVisible() || ((activePanel = self.editorPanelGroup.getActivePanel()) && activePanel.getId() !== 'options')) {
                        self.execCommand('set-active-panel', 'options');
                        self.editorPanelGroup.setVisible(true);
                    }
                    else {
                        self.editorPanelGroup.setVisible(false);
                    }
                }
                else {
                    self.execCommand('set-active-panel', 'options');
                }
            });
            $($$showItemsListPanel).on('click', function () {
                var activePanel;
                if (self.mobileInteractionsEnabled) {
                    if (!self.editorPanelGroup.isVisible() || ((activePanel = self.editorPanelGroup.getActivePanel()) && activePanel.getId() !== 'editor')) {
                        self.execCommand('set-active-panel', 'editor');
                        self.editorPanelGroup.setVisible(true);
                    }
                    else {
                        self.editorPanelGroup.setVisible(false);
                    }
                }
                else {
                    self.execCommand('set-active-panel', 'editor');
                }
            });
            $($$mobileItemEditorToolbar).on('click', 'button[data-action]', function () {
                var targetSettingId = this.getAttribute('data-target-setting-id');
                var buttonAction = this.getAttribute('data-action'), targetElementHash = this.getAttribute('data-target-element-hash');
                if (targetSettingId) {
                    var setting = self.engine.getDocument().getEditorSettingByTypeId(targetSettingId);
                    if (self.editorPanelGroup.isVisible()) {
                        self.editorPanelGroup.setVisible(false);
                        return;
                    }
                    self.commands.loadEditorSettingIntoPanel(setting);
                    self.editorPanelGroup.setActivePanel('item');
                    self.editorPanelGroup.setVisible(true);
                    return;
                }
                if (!buttonAction || !targetElementHash) {
                    return;
                }
                var element = self.engine.getDocument().getElementByHash(targetElementHash);
                if (!element) {
                    return;
                }
                self.commands.executeElementCommand(element, buttonAction);
            });
            $($$editorSettingsPanel).each(function () {
                self.editorSettingsPanel = this;
            });
            $($$editorSettingsPanel).on('click', '> [data-role=setting][data-type-id]', function () {
                var settingTypeId = this.getAttribute('data-type-id');
                self.selectSettingInPanel($$editorSettingsPanel, this, $);
                if (settingTypeId) {
                    self.execCommand('edit-setting', settingTypeId);
                }
            });
            self.bindHeaderEvents();
            $('#inspector-panel-group').on('click', '[data-role=panel-switcher]', function (e) {
                var activePanel = self.editorPanelGroup.getActivePanel();
                if (activePanel.getRootNode().getAttribute('data-target-setting-id') === 'setting_payment_summary') {
                    var numberOfPages = self.engine.getDocument().getNumberOfPagesIncludingPaymentSummary();
                    self.engine.getDocument().getPageByIndex(numberOfPages - 1).unselectPaymentSummaryContainer();
                }
                var target = (e.target || e.srcElement), panelName = $(this).attr('data-target-panel') || null;
                if ($(target).is('[data-role=back-button], [data-role=back-text]')) {
                    if (self.mobileInteractionsEnabled) {
                        self.editorPanelGroup.setVisible(false);
                    }
                    else {
                        self.URLHandler.setNewUrl(EBuilderRoutes.EDITOR);
                        var action = navigateAction(EBuilderRoutes.EDITOR);
                        self.store.dispatch(action);
                        self.execCommand('set-active-panel', panelName);
                    }
                }
            });
            $($$formnameinput).val(document.getProperty('name.value')).on('input', function () {
                if (this.value !== '') {
                    document.setProperty('name.value', this.value);
                }
            });
            $($$selectiondelete).on('click', function () {
                self.execCommand('delete-selection');
            });
            self.engine.getTheme().on('theme-changed', function () {
                self.commands.onThemeIdChanged(self.engine.getTheme().getCurrentThemeId());
            });
            self.engine.getTheme().on('enter-preview-mode', function () {
                self.commands.onThemeEnteringPreviewMode();
            });
            $(self.form)
                .on('click', function (e) {
                if ($($$editorSettingsPanel).find(e.target).length < 1) {
                    self.clearSelectionInSettingsPanel($$editorSettingsPanel, $);
                }
            })
                .on('click', '[data-hash]', function (e) {
                var targetIsPaymentSummary = ($(e.target).parents('[data-type=payment-summary]').length > 0);
                var elementHash = $(this).attr('data-hash'), element = document.getElementByHash(elementHash);
                if (!element) {
                    return;
                }
                if (!element.isSelectable()) {
                    return;
                }
                if (e.ctrlKey || e.metaKey) {
                    self.engine.getDocument().setActiveElement(null);
                    if (self.selection.has(element)) {
                        self.selection.remove(element);
                    }
                    else {
                        self.selection.add(element);
                    }
                }
                else {
                    if (!targetIsPaymentSummary) {
                        self.selection.set(element);
                        self.engine.getDocument().setActiveElement(element);
                        if (element === document.getHeader()) {
                            document.getHeader().openEditableHTMLDialog();
                        }
                        var numberOfPages = self.engine.getDocument().getNumberOfPagesIncludingPaymentSummary();
                        self.engine.getDocument().getPageByIndex(numberOfPages - 1).unselectPaymentSummaryContainer();
                    }
                    else {
                        var activeElement = self.engine.getDocument().getActiveElement();
                        if (activeElement) {
                            activeElement.getRootNode().removeAttribute('data-is-active');
                            activeElement.onFocusLeave();
                            self.engine.getDocument().trigger('blur', activeElement);
                        }
                    }
                }
                e.stopPropagation();
            })
                .on('click', function (e) {
                if (self.form === e.srcElement || self.form === e.target) {
                    self.selection.clear();
                }
            })
                .on('click', '> div[data-role=page-break] > div[data-role=merge-pages] button[data-role=merge-pages-button]', function (e) {
                var pageIndexAsString = $(this).closest('[data-role=page-break]').attr('data-page-index');
                e.preventDefault();
                e.stopPropagation();
                if (!pageIndexAsString) {
                    return;
                }
                self.commands.mergePageByIndexWithNextPage(~~pageIndexAsString);
            })
                .on('click', '[data-role=page] > [data-role=page-header] > [data-role=control][data-type=realtime-calculations]', function (e) {
                e.stopPropagation();
                self.execCommand('edit-setting', 'setting_payment_summary');
            });
            self.selection.on('add', function (node) {
                node.onEnterSelection();
            });
            self.selection.on('remove', function (node) {
                node.onLeaveSelection();
            });
            self.selection.on('change', function () {
                self.commands.onSelectionChanged();
            });
            $($$gridvisibilitycheckbox).on('click', function () {
                self.commands.setGridVisibility(this.checked);
            });
            $('#notifications-area')
                .on('click', 'a[data-role=downgrade-editor]', function () {
                self.commands.downgradeToOldEditor(false);
            })
                .on('click', 'a[data-role=downgrade-editor-with-backup]', function () {
                self.commands.downgradeToOldEditor(true);
            })
                .on('click', 'a[data-role=disable-downgrade-notification], div.close', function () {
                self.commands.disableMigrationNotification();
            });
            self.mouseManager.on('resize-start', function () {
                self.savingEnabled = false;
            });
            self.mouseManager.on('drag-start', function () {
                self.savingEnabled = false;
            });
            self.mouseManager.on('label-resize-start', function () {
                self.savingEnabled = false;
            });
            self.mouseManager.on('resize-end', function () {
                self.savingEnabled = true;
                if (self.hasSaveRequests) {
                    self.saveDocumentInImmediateMode();
                }
            });
            self.mouseManager.on('drag-end', function () {
                self.savingEnabled = true;
                if (self.hasSaveRequests) {
                    self.saveDocumentInImmediateMode();
                }
            });
            self.mouseManager.on('label-resize-end', function () {
                self.savingEnabled = true;
                if (self.hasSaveRequests) {
                    self.saveDocumentInImmediateMode();
                }
            });
            Salvage.addHelper({
                name: "LABEL_CONVERTER_TO_WORDS",
                func: function (camelCaseLabel) {
                    return String(camelCaseLabel || '').replace(/([a-z])([A-Z])/g, '$1 $2');
                }
            });
            Salvage.addHelper({
                name: "json",
                func: function (a) {
                    return JSON.stringify(a);
                }
            });
            self.commands.loadEditorControlsIntoPanel();
            self.commands.setActiveEditorPanel('editor');
            self.getEngine().getDocument().getForm().on('errors-changed', function (element) {
                self.notifyInspectorPanelAboutErrorChanges(element);
                self.updateFormErrorStateNotificationThrottle();
                if (element instanceof EditorSetting) {
                    self.commands.updateSettingErrorStateInEditorSettingsPanel(element);
                }
            });
            self.undoService.trigger('resume');
            self.undoService.trigger('save');
            if (self.shouldSeeHipaaSecurityPopup) {
                self.commands.showHipaaDialog();
            }
            self.on('unserialize', function () {
                self.commands.repopulateCustomCSSPanelWithActualValues();
            });
            self.editorPanelGroup
                .on('visibility-state-changed', function () {
                setTimeout(function () {
                    self.engine.onResize();
                }, 300);
            })
                .on('panel-changed', function (panel, previousPanelId) {
                if (panel && panel.getId() === 'item') {
                    self.commands.updateMobileItemEditorPanel();
                }
                else {
                    $('#mobile-item-editor-toolbar').text('');
                }
                if (panel && panel.getId() === 'publish-form' && previousPanelId) {
                    self.trackPublishPanelViews(previousPanelId);
                }
            });
            self.on('load', function () {
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
            });
            self.on('payments_summary_realtime_changed', function () {
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
            });
            self.on('payments_currency_change', function (selectedCurrency) {
                self.setSelectedCurrencyId(selectedCurrency.id);
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
            });
            self.on('products_dialog_on_save', function () {
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
            });
            self.on('products_discount_tax_change', function () {
                self.renderPaymentSummary();
            });
            self.on('payments_summary_show_after_submit', function () {
                self.execCommand('append-element', ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE);
                self.engine.getDocument().repaginateInImmediateMode();
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
            });
            self.on('payments_summary_show_on_form', function () {
                self.execCommand('remove-payment-summary-page');
                self.engine.getDocument().repaginateInImmediateMode();
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
            });
            self.on('payments_status_changed', function () {
                self.removePaymentSummaryPageIfNeeded();
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
                self.commands.updateEditorSettingsPanel(false);
            });
            self.on('inserted_element', function () {
                self.renderPaymentSummary();
            });
            self.on('deleted_element', function () {
                self.renderPaymentSummary();
            });
            self.on('page_created', function () {
                self.renderFooterOnAllPages();
            });
            self.on('payments_products_price_change', function () {
                self.renderHeaderOnAllPages();
                self.renderPaymentSummary();
            });
            self.on('control_deleted', function () {
                self.renderHeaderOnAllPages();
            });
            self.on('payments_column_visibility_changed', function (columnData) {
                self.changePaymentSummaryColumnVisibility(columnData);
            });
            self.on('payments_column_name_changed', function (eventType, columnData) {
                switch (eventType) {
                    case EEventType.INPUT:
                        EditorLoader.changePaymentSummaryColumnNameOnInput(columnData);
                        break;
                    case EEventType.BLUR:
                        self.changePaymentSummaryColumnNameOnBlur(columnData);
                        break;
                }
            });
            self.on('payments_use_sandbox_changed', function () { return self.updateStripeConnectedAccountPlaceholder(); });
        })(this, this.engine, this.engine.getDocument(), this.getJQuery(), this.engine.getTheme());
    };
    EditorLoader.prototype.updateControlDisabledStateByPropertyName = function (element, propertyName, message) {
        var requiredOption = this.jq('[data-property-name=' + propertyName + ']'), checked = this.jq(element).is(':checked');
        var input = requiredOption.find('input[type="checkbox"]');
        if (checked) {
            input.attr('disabled', true);
            requiredOption.css('opacity', .3);
            requiredOption
                .find('input[type=checkbox],span.decorator')
                .attr('title', message)
                .css('cursor', 'default');
        }
        else {
            input.removeAttr('disabled');
            requiredOption.css('opacity', 1);
            requiredOption
                .find('input[type=checkbox],span.decorator')
                .attr('title', '')
                .css('cursor', 'pointer');
        }
    };
    EditorLoader.prototype.saveDocumentInImmediateMode = function () {
        if (this.savingEnabled && !this.readonlySubuser) {
            console.log('save...');
            this.hasSaveRequests = false;
            if (this.saveToServer) {
                this.commands.saveForm();
            }
            else {
                this.storage.save();
            }
        }
        else {
            this.hasSaveRequests = true;
        }
    };
    EditorLoader.prototype.getUI = function () {
        return this.ui;
    };
    EditorLoader.prototype.getAPI = function () {
        return this.api;
    };
    EditorLoader.prototype.getRules = function () {
        return this.rules;
    };
    EditorLoader.prototype.getCommandDispatcher = function () {
        return this.commands;
    };
    EditorLoader.prototype.getSelection = function () {
        return this.selection;
    };
    EditorLoader.prototype.execCommand = function (command) {
        var _this = this;
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        switch (command) {
            case 'view-form':
                this.commands.viewForm();
                break;
            case 'set-active-panel':
                var panelName = String(args[0] || '') || 'editor', panelId = args[1] ? String(args[1]) : null, canRedo = this.undoService.canRedo(), canUndo = this.undoService.canUndo();
                var unsavedChangesInNotificationsPanel = panelName &&
                    this.editorPanelGroup.getActivePanel().getId() === 'notifications'
                    && !this.editorPanelGroup.getActivePanel().getUserConfirmationForDiscardingUnsavedChanges();
                if (unsavedChangesInNotificationsPanel)
                    return;
                this.commands.setActiveEditorPanel(panelName);
                if (panelName !== 'editor' &&
                    panelName !== 'options' &&
                    panelName !== 'item') {
                    canRedo = false;
                    canUndo = false;
                }
                this.header.setButtonInteractionState(EInteractionableControlKeys.REDO, canRedo);
                this.header.setButtonInteractionState(EInteractionableControlKeys.UNDO, canUndo);
                if (panelId) {
                    var panel = this.editorPanelGroup.getPanelById('publish-form');
                    panel.openElementById(panelId);
                }
                break;
            case 'filter-settings':
                this.commands.filterSettingsProperties(String(args[0] || ''));
                break;
            case 'filter-controls':
                this.commands.filterControlsList(String(args[0] || ''));
                break;
            case 'form-name-changed':
                this.commands.onFormNameChanged();
                break;
            case 'append-element':
                this.commands.appendElement(~~args[0]);
                break;
            case 'repaint-footer':
                this.commands.repaintFooterOnAllPages();
                break;
            case 'edit-html':
                this.commands.createHTMLEditorDialog(args[0], args[1], args[2], args[3]);
                break;
            case 'delete-selection':
                this.commands.deleteSelection();
                break;
            case 'resize-element':
                this.commands.resizeElement(args[0], args[1], args[2]);
                break;
            case 'resize-label-by-delta':
                this.commands.resizeLabelByDelta(args[0], args[1], args[2]);
                break;
            case 'drop':
                this.commands.executeDropOperation(args[0], args[1], args[2], !!args[3], args[4]);
                break;
            case 'select-element':
                this.selection.set(args[0] || null);
                this.engine.getDocument().setActiveElement(args[0] || null);
                break;
            case 'select-rectangle':
                this.commands.selectElementsByMousePoints(args[0], args[1], !!args[2]);
                break;
            case 'select-rectangle-while-dragging':
                this.commands.interactiveDisplaySelectionFeedbackByMousePoints(args[0], args[1]);
                break;
            case 'element-command':
                this.commands.executeElementCommand(args[0], args[1]);
                break;
            case 'selection-command':
                this.commands.executeSelectionCommand(args[0]);
                break;
            case 'show-validator-upgrade-dialog':
                this.commands.triggerPaywall(EUpgradeReason.VALIDATOR_NOT_SUPPORTED_IN_CURRENT_USER_PLAN, null);
                break;
            case 'track-event':
                this.commands.trackEvent(args[0], args[1] || {}, args[2] || undefined);
                break;
            case 'save-external-theme':
                this.commands.saveExternalFormTheme(args[0] || undefined);
                break;
            case 'save-custom-css-text':
                this.commands.setCustomCssText(args[0]);
                break;
            case 'save-custom-css-url':
                this.commands.setCustomCssUrl(args[0]);
                break;
            case 'update-custom-css-errors':
                this.commands.updateCustomCSSErrorDOMNodes(args[0], args[1]);
                break;
            case 'add-setting':
                this.commands.addSetting(args[0]);
                break;
            case 'edit-setting':
                this.engine.getLoader().getSelection().clear();
                Throttle.create(function () {
                    _this.commands.loadEditorSettingIntoPanel(_this.engine.getDocument().getEditorSettingByTypeId(args[0]));
                }, 10)();
                break;
            case 'editor-setting-command':
                this.commands.executeEditorSettingCommand(args[0], args[1]);
                break;
            case 'reset-used-choices':
                this.commands.resetUsedChoicesOnElement(args[0]);
                break;
            case 'open-products-dialog':
                this.commands.trackEvent('product_dialog_open', {}, 50);
                PaymentsProductsDialog.openFromExternalSource();
                break;
            case 'scroll-inspector-to-payments':
                this.commands.scrollToPaymentsInInspector();
                break;
            case 'add-payment-summary-listeners':
                this.commands.addPaymentSummaryListener(args[0]);
                break;
            case 'remove-payment-summary-page':
                this.commands.removePaymentSummaryAfterSubmit();
                break;
            default:
                console.warn('EditorLoader.execCommand(' + JSON.stringify(command) + '): command not implemented');
                break;
        }
    };
    EditorLoader.prototype.getLoaderDependency = function (dependency) {
        switch (dependency) {
            case ELoaderDependency.USER_INTERFACE:
                return this.ui;
            case ELoaderDependency.SESSION_ID:
                return this.getSessionId();
            case ELoaderDependency.CURRENT_EDITABLE_ELEMENT:
                return this.getCurrentEditableElement();
            case ELoaderDependency.FORM_SETTINGS:
                return this.getFormSettings();
            case ELoaderDependency.SHOW_DOWNGRADE_NOTIFICATION:
                return this.showDowngradeNotification;
            case ELoaderDependency.UNDO_SERVICE:
                return this.undoService;
            case ELoaderDependency.FONTS_MANAGER:
                return this.fontsManager;
            case ELoaderDependency.GEOLOCATION_USER_COUNTRY_CODE:
                return this.geolocationUserCountryCode;
            case ELoaderDependency.WIX_AUTHORIZED_REQUEST_DETAILS:
                return this.getWixAuthorizedRequestDetails();
            case ELoaderDependency.THEME_STRATEGY:
                return this.getThemeStrategy();
            case ELoaderDependency.EXTERNAL_THEME_INITIAL_PROPERTIES:
                return this.getPreloadedExternalThemeProperties();
            case ELoaderDependency.EDITOR_SETTINGS_PANEL:
                return this.editorSettingsPanel || null;
            case ELoaderDependency.IS_HIPAA_FORM:
                return this.isHipaaForm();
            case ELoaderDependency.TRANSLATIONS_LANGUAGE_CODES:
                if (this.translationsDropdownVisibleOnForm) {
                    return this.getFormAvailableLanguages();
                }
                else {
                    return null;
                }
            case ELoaderDependency.EDITOR_HEADER:
                return this.header;
            case ELoaderDependency.WORKFLOWS_USERS_LIST:
                return this.workflowsUsersList || null;
            case ELoaderDependency.EDITOR_PLATFORM_DETAILS:
                return this.platformDetails;
            case ELoaderDependency.USER_FEATURES:
                return this.userFeatures || null;
            case ELoaderDependency.POPUP_NOTIFICATIONS:
                return this.popupNotifications || null;
            case ELoaderDependency.DISABLED_MOBILE_INTERACTION:
                return this.mobileInteractionsDisabled;
            case ELoaderDependency.DEFAULT_USER_PREFERENCES:
                return this.defaultUserPreferences || null;
            case ELoaderDependency.USER_PLAN_NAME:
                return this.userPlanName;
            case ELoaderDependency.DEFAULT_NOTIFICATIONS_PREFERENCES:
                return this.defaultNotificationsPreferences || null;
            case ELoaderDependency.USER_DETAILS:
                return this.userDetails || null;
            case ELoaderDependency.SHOW_REALTIME_CALCULATIONS:
                return this.showRealtimeCalculations();
            case ELoaderDependency.DETAILED_INVOICE_OPTIONS:
                return this.getDetailedInvoiceOptions();
            case ELoaderDependency.LAST_CALCULATION_HTML_MARKUP:
                return this.commands.getLastCalculationHTMLMarkup();
            case ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY:
                return this.checkFormHasPaymentProcessor() && this.checkFormHasFormulasOrProductsOrFixedFees();
            case ELoaderDependency.HAS_ENABLED_PAYMENT_PROCESSORS:
                return this.checkFormHasPaymentProcessor();
            case ELoaderDependency.HAS_CALCULATE_BUTTON:
                var paymentsConfiguration = this.getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS), showRealtimeCalculations = this.getLoaderDependency(ELoaderDependency.SHOW_REALTIME_CALCULATIONS), shouldShowPaymentSummary = this.getLoaderDependency(ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY);
                return shouldShowPaymentSummary && !showRealtimeCalculations && paymentsConfiguration && paymentsConfiguration.showPaymentsSummaryBelowForm;
            default:
                return null;
        }
    };
    EditorLoader.prototype.getI18n = function () {
        return this.i18n;
    };
    EditorLoader.prototype.getFormTranslationsService = function () {
        return this.formTranslationsService || null;
    };
    EditorLoader.prototype.getUserId = function () {
        return this.userId;
    };
    EditorLoader.prototype.getLoaderType = function () {
        return EFormLoaderType.EDIT;
    };
    EditorLoader.prototype.withEditUserAccessMode = function (accessMode) {
        this.editUserAccessMode = accessMode;
        return this;
    };
    EditorLoader.prototype.getEditUserAccessMode = function () {
        return this.editUserAccessMode;
    };
    EditorLoader.prototype.withReadonlySubuser = function (readonlySubuser) {
        this.readonlySubuser = readonlySubuser;
        return this;
    };
    EditorLoader.prototype.getReadonlySubuser = function () {
        return this.readonlySubuser;
    };
    EditorLoader.prototype.getCurrentEditableElement = function () {
        var elementHash = this.itemPanelOuterPlaceholder.getAttribute('data-target-element');
        if (!elementHash) {
            var settingTypeId = this.itemPanelOuterPlaceholder.getAttribute('data-target-setting-id');
            if (settingTypeId) {
                return this.engine.getDocument().getEditorSettingByTypeId(settingTypeId);
            }
        }
        else {
            return this.engine.getDocument().getElementByHash(elementHash);
        }
    };
    EditorLoader.prototype.notifyInspectorPanelAboutErrorChanges = function (element) {
        if (!element || element !== this.getCurrentEditableElement()) {
            return;
        }
        this.commands.updateElementErrorsInInspectorPanel(element);
    };
    EditorLoader.prototype.withFormSettings = function (formSettings) {
        this.formSettings = formSettings;
        this.setApprovalToStore(formSettings.approval);
        return this;
    };
    EditorLoader.prototype.setApprovalToStore = function (approval) {
        var action = updateApprovalOfSubmission(approval);
        this.store.dispatch(action);
    };
    EditorLoader.prototype.getFormSettings = function () {
        return this.formSettings;
    };
    EditorLoader.prototype.withResource = function (resourceURL, resourceDataInBase64) {
        if (resourceURL && 'string' === typeof resourceURL) {
            this.resources[resourceURL] = atob(resourceDataInBase64);
        }
        return this;
    };
    EditorLoader.prototype.withShowDowngradeNotification = function (state) {
        this.showDowngradeNotification = !!state;
        return this;
    };
    EditorLoader.prototype.setFormEditorInWixAttribute = function () {
        (function ($) {
            if (window.location.host && window.location.host === "wix.123formbuilder.com") {
                $('body').attr('data-form-editor-on-wix', '1');
            }
            else {
                $('body').attr('data-form-editor-on-wix', '0');
            }
        })(this.getJQuery());
    };
    EditorLoader.prototype.getThemeStrategy = function () {
        return this.themeStrategy;
    };
    EditorLoader.prototype.withThemeStrategy = function (themeStrategy) {
        this.themeStrategy = themeStrategy;
        return this;
    };
    EditorLoader.prototype.getPreloadedExternalThemeProperties = function () {
        return this.preloadedExternalThemeProperties;
    };
    EditorLoader.prototype.withPreloadedExternalThemeProperties = function (properties) {
        this.preloadedExternalThemeProperties = properties || null;
        return this;
    };
    EditorLoader.prototype.withFormAvailableLanguages = function (languages) {
        this.languages = languages;
        return this;
    };
    EditorLoader.prototype.getFormAvailableLanguages = function () {
        return this.languages;
    };
    EditorLoader.prototype.getShouldSeeHipaaSecurityPopup = function () {
        return this.shouldSeeHipaaSecurityPopup;
    };
    EditorLoader.prototype.withShouldSeeHipaaSecurityPopup = function (showPopup) {
        this.shouldSeeHipaaSecurityPopup = showPopup;
        return this;
    };
    EditorLoader.prototype.withMobileInteractionsDisabled = function (mobileInteractionsDisabled) {
        this.mobileInteractionsDisabled = mobileInteractionsDisabled;
        return this;
    };
    EditorLoader.prototype.getGeolocationUserCountryCode = function () {
        return this.geolocationUserCountryCode;
    };
    EditorLoader.prototype.withGeolocationUserCountryCode = function (geolocationUserCountryCode) {
        this.geolocationUserCountryCode = geolocationUserCountryCode || null;
        return this;
    };
    EditorLoader.prototype.isUserPreventedFromSelectingBothHiddenAndRequiredSettings = function (panel, event, $, document, domNode) {
        var elementHash = $(panel).attr('data-target-element'), element = document.getElementByHash(elementHash), propertyName = $(domNode).closest('[data-property-name]').attr('data-property-name');
        if (propertyName === 'options-hidden') {
            if (element.hasProperty('options.required') && element.getProperty('options.required') === true) {
                event.preventDefault();
                return true;
            }
            else {
                this.updateControlDisabledStateByPropertyName(domNode, 'options-required', 'Required option isn\'t compatible with the field property Hidden.');
            }
        }
        if (propertyName === 'options-required') {
            if (element.hasProperty('options.hidden') && element.getProperty('options.hidden') === true) {
                event.preventDefault();
                return true;
            }
            else {
                this.updateControlDisabledStateByPropertyName(domNode, 'options-hidden', 'Hidden option isn\'t compatible with the field property Required.');
            }
        }
        if (propertyName === 'options-isNumberOfTimesAnOptionCanBeChosen') {
            if (!this.userService.canLimitChoices()) {
                this.commands.triggerPaywall(EUpgradeReason.LIMIT_NUMBER_OF_TIME_OPTIONS_CAN_BE_CHOSEN);
                event.preventDefault();
                return true;
            }
        }
        return false;
    };
    EditorLoader.prototype.withIsHipaaForm = function (isHipaaForm) {
        var action = setFormAsHipaa(!!isHipaaForm);
        this.store.dispatch(action);
        if (!isHipaaForm) {
            InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('options.hipaaField', null, null);
        }
        return this;
    };
    EditorLoader.prototype.isHipaaForm = function () {
        var state = this.store.getState();
        return state.form.settings.isHipaa;
    };
    EditorLoader.prototype.getEditorPanelGroup = function () {
        return this.editorPanelGroup;
    };
    EditorLoader.prototype.openEditorPanelGroupWhenStartupPanelIsPresent = function () {
        if (this.mobileInteractionsEnabled) {
            if (window.location.href.indexOf('startup_panel') > 0) {
                this.editorPanelGroup.setVisible(true);
            }
        }
    };
    EditorLoader.prototype.onWindowResized = function () {
        var _this = this;
        var mobileInteractionsEnabled = !!this.mobileInteractionsDisabled ? false : this.mobileDevice || (document.body.offsetWidth <= 900);
        if (mobileInteractionsEnabled === this.mobileInteractionsEnabled) {
            return;
        }
        this.mobileInteractionsEnabled = mobileInteractionsEnabled;
        if (this.mobileInteractionsEnabled) {
            document.body.setAttribute('data-mobile-interactions', '1');
            this.editorPanelGroup.setVisible(false);
        }
        else {
            document.body.removeAttribute('data-mobile-interactions');
            this.editorPanelGroup.setVisible(true);
        }
        setTimeout(function () {
            _this.engine.onResize();
        }, 1000);
    };
    EditorLoader.prototype.isMobileInteractionsEnabled = function () {
        return this.mobileInteractionsEnabled;
    };
    EditorLoader.prototype.initPlatformBodyAttributes = function () {
        switch (true) {
            case BrowserDetector.meetsRequirements('* * mobile safari *') === '':
                document.body.setAttribute('data-host-type', 'mobile-safari');
                break;
            default:
                break;
        }
    };
    EditorLoader.prototype.installEditorPageErrorHandler = function () {
        var _this = this;
        Api.THROW_REQUEST_ERRORS_IN_CONSOLE = true;
        var errorReportingToBackend = true;
        window.addEventListener('error', function (e) {
            if (!errorReportingToBackend) {
                return;
            }
            var errorText = [
                'message: ' + e.message.substr(0, 2048),
                'file: ' + e.filename,
                'line: ' + e.lineno
            ].join('\n');
            _this.api.POST('/v2/errorLog', {
                error: errorText,
            }).fail(function (e) {
                console.warn('ERROR REPORTING TO BACKEND STOPPED - GOT ERROR ON ERROR REPORTING ENDPOINT');
                errorReportingToBackend = false;
            });
        });
    };
    EditorLoader.prototype.updateClickOnPublishButtonForWeebly = function () {
        var _this = this;
        var weeblyPublishButton = document.querySelector('#publish-button.publish-on-weebly-button');
        if (null !== weeblyPublishButton) {
            weeblyPublishButton.onclick = function () {
                _this.commands.publishFormOnWeebly(_this.getFormId());
            };
        }
    };
    EditorLoader.prototype.withTranslationsDropdownVisibleOnForm = function (translationsDropdownVisibleOnForm) {
        this.translationsDropdownVisibleOnForm = !!translationsDropdownVisibleOnForm;
        return this;
    };
    EditorLoader.prototype.isTranslationsDropdownVisibleOnForm = function () {
        return this.translationsDropdownVisibleOnForm;
    };
    EditorLoader.prototype.getOAuth = function () {
        return this.oAuth;
    };
    EditorLoader.prototype.withReusableDomainAliases = function (reusableDomainAliases) {
        this.reusableDomainAliases = reusableDomainAliases;
        return this;
    };
    EditorLoader.prototype.getReusableDomainAliases = function () {
        return this.reusableDomainAliases;
    };
    EditorLoader.prototype.withUsersList = function (usersList) {
        this.workflowsUsersList = usersList;
        if (!this.workflowsUsersList) {
            InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('choices.isWorkflowsUserDropdown', 'boolean', ElementTypes.CONTROL_TYPE_DROPDOWN);
        }
        InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('choices.isWorkflowsUserDropdownSelectAll', 'boolean', ElementTypes.CONTROL_TYPE_DROPDOWN);
        return this;
    };
    EditorLoader.prototype.replaceQueryStringParameter = function (parameterName, parameterValue) {
        var parsedQuery = UrlUtils.parseQueryString((location.search || '').substr(1));
        parsedQuery[parameterName] = parameterValue;
        var newQueryString = [];
        for (var k in parsedQuery) {
            if (parsedQuery.hasOwnProperty(k) && parsedQuery[k] && parsedQuery[k] !== '') {
                newQueryString.push(encodeURIComponent(k) + '=' + encodeURIComponent(parsedQuery[k] || ''));
            }
        }
        history.replaceState(null, document.title, '?' + newQueryString.join('&'));
    };
    EditorLoader.prototype.trackPublishPanelViews = function (previousPanelId) {
        this.commands.trackEvent('page_view_publish');
        var urlParams = UrlUtils.parseQueryString(location.search.substr(1)), platformMetricsManager = new PlatformMetricsManager(this.getPlatformDetails());
        switch (previousPanelId) {
            case 'item':
            case 'editor':
                if (urlParams["click_from"] && urlParams["click_from"] === 'settings') {
                    this.commands.trackEvent('page_view_publish_from_settings');
                    this.replaceQueryStringParameter('click_from', '');
                }
                else {
                    this.commands.trackEvent('page_view_publish_from_edit');
                }
                break;
        }
        if (previousPanelId !== 'publish-form') {
            platformMetricsManager.trackPlatformMetric('page_view_publish');
        }
    };
    EditorLoader.prototype.withUserFeatures = function (userFeatures) {
        this.userFeatures = userFeatures;
        if (userFeatures && userFeatures.allowIFrame) {
            SanitizeHTML.USER_HTML_TAGS.push('iframe');
        }
        return this;
    };
    EditorLoader.prototype.withPopupNotifications = function (popupNotifications) {
        this.popupNotifications = popupNotifications;
        return this;
    };
    EditorLoader.prototype.withDefaultUserPreferences = function (defaultUserPreferences) {
        this.defaultUserPreferences = defaultUserPreferences;
        return this;
    };
    EditorLoader.prototype.trackPlatformSpecificMetric = function (metric) {
        if (undefined === this.platformMetricsManager) {
            this.platformMetricsManager = new PlatformMetricsManager(this.getPlatformDetails());
        }
        this.platformMetricsManager.trackPlatformMetric(metric);
    };
    EditorLoader.prototype.initializeBlankDocumentFromOCRSerializedData = function () {
        try {
            var ocrData = JSON.parse(sessionStorage.getItem('ocr_data'));
            this.commands.initializeDocumentFromOCRData(ocrData);
            if (sessionStorage.getItem('lastDigitizedHash') !== undefined && sessionStorage.getItem('lastDigitizedHash').length == 32) {
                this.getJQuery().ajax({
                    type: 'POST',
                    cache: false,
                    url: '/modules/OCRForm/logger.php',
                    data: {
                        ocrData: ocrData,
                        formId: this.getFormId(),
                        lastDigitizedHash: sessionStorage.getItem('lastDigitizedHash')
                    }
                });
                sessionStorage.removeItem('lastDigitizedHash');
            }
            sessionStorage.removeItem('ocr_data');
        }
        catch (e) {
        }
    };
    EditorLoader.prototype.getPanelNameByKey = function (key) {
        switch (key) {
            case EInteractionableControlKeys.PUBLISH_WEEBLY:
                return 'weebly-embed-in-page-publish-method';
            case EInteractionableControlKeys.PUBLISH_WEEBLY_LINK:
                return 'weebly-link-to-form-publish-method';
            case EInteractionableControlKeys.PUBLISH_WEEBLY_LIGHTBOX:
                return 'weebly-lightbox-publish-method';
            case EInteractionableControlKeys.PUBLISH_BIG_COMMERCE:
                return 'bigcommerce-embed-in-page-publish-method';
            case EInteractionableControlKeys.PUBLISH_BIG_COMMERCE_LINK:
                return 'bigcommerce-link-to-form-publish-method';
            case EInteractionableControlKeys.PUBLISH_BIG_COMMERCE_LIGHTBOX:
                return 'bigcommerce-lightbox-publish-method';
            case EInteractionableControlKeys.PUBLISH_SHOPIFY:
                return 'shopify-embed-in-page-publish-method';
            case EInteractionableControlKeys.PUBLISH_SHOPIFY_LINK:
                return 'shopify-link-to-form-publish-method';
            case EInteractionableControlKeys.PUBLISH_SHOPIFY_LIGHTBOX:
                return 'shopify-lightbox-publish-method';
        }
        return 'weebly-embed-in-page-publish-method';
    };
    EditorLoader.prototype.openPublishPanel = function (panelId) {
        this.editorPanelGroup.setVisible(true);
        this.execCommand('set-active-panel', 'publish-form', panelId);
    };
    EditorLoader.prototype.openEditorPanel = function (panel) {
        if (window.innerWidth <= 900 && window.localStorage.getItem('noSidebarActiveState')) {
            return;
        }
        this.editorPanelGroup.setVisible(true);
        this.execCommand('set-active-panel', panel);
    };
    EditorLoader.prototype.getEmbedCodePanelId = function () {
        if (this.getPlatformDetails()) {
            if (this.getPlatformDetails().isShopify ||
                this.getPlatformDetails().isBigCommerce ||
                this.getPlatformDetails().isWeebly) {
                return 'iframe-publish-method';
            }
        }
        return 'javascript-publish-method';
    };
    EditorLoader.prototype.withDropdownsWithForms = function (dropdownsWithForms) {
        this.dropdownsWithForms = dropdownsWithForms;
        if (!this.dropdownsWithForms) {
            InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('choices.isDropdownWithForms', 'boolean', ElementTypes.CONTROL_TYPE_DROPDOWN);
        }
        return this;
    };
    EditorLoader.prototype.withDefaultNotificationsPreferences = function (defaultNotificationsPreferences) {
        this.defaultNotificationsPreferences = defaultNotificationsPreferences;
        return this;
    };
    EditorLoader.prototype.getDefaultNotificationsPreferences = function () {
        return this.defaultNotificationsPreferences;
    };
    EditorLoader.prototype.withUserDetails = function (userDetails) {
        this.userDetails = userDetails;
        return this;
    };
    EditorLoader.prototype.selectSettingInPanel = function (panelSelector, settingDOMNode, $) {
        this.clearSelectionInSettingsPanel(panelSelector, $);
        settingDOMNode.setAttribute('data-is-selected', '1');
    };
    EditorLoader.prototype.clearSelectionInSettingsPanel = function (panelSelector, $) {
        $(panelSelector).find(' > [data-role=setting][data-type-id][data-is-selected]').each(function () {
            this.removeAttribute('data-is-selected');
        });
    };
    EditorLoader.prototype.withControlsThatHaveRepeatablePathsAddedToPrefillValue = function (controlIds) {
        this.controlsThatHaveRepeatablePathsAddedToPrefillValue = controlIds;
        return this;
    };
    EditorLoader.prototype.getControlsThatHaveRepeatablePathsAddedToPrefillValue = function () {
        return this.controlsThatHaveRepeatablePathsAddedToPrefillValue;
    };
    EditorLoader.prototype.getUserDetails = function () {
        return this.userDetails;
    };
    EditorLoader.prototype.redirectToNotifications = function () {
        var model = this.header.getModel();
        if (!model)
            return;
        model.toggles.exp_notifications_v2
            ? this.redirectToNotificationsV2()
            : this.redirectToNotificationsV1();
    };
    EditorLoader.prototype.redirectToNotificationsV2 = function () {
        var action = navigateAction(EBuilderRoutes.NOTIFICATIONS);
        this.store.dispatch(action);
    };
    EditorLoader.prototype.redirectToNotificationsV1 = function () {
        var action = navigateAction(EBuilderRoutes.OLD_NOTIFICATIONS);
        this.store.dispatch(action);
    };
    EditorLoader.prototype.toggleExperiment = function () {
        return this.jq.ajax({
            "url": '/ajax-call.php?service=usersExperiments&do=exposeUser&experimentName=edt_notifications_v2',
            "data": {},
            "type": "GET",
            "crossDomain": true
        });
    };
    EditorLoader.prototype.getSummarySettingProperty = function (propertyName) {
        var summarySettings = this.engine.getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
        if (summarySettings) {
            this.summarySettingsCache[propertyName] = summarySettings.getProperty(propertyName);
        }
        return this.summarySettingsCache[propertyName];
    };
    EditorLoader.prototype.setSummarySettingProperty = function (propertyName, propertyValue) {
        var summarySettings = this.engine.getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
        if (summarySettings) {
            summarySettings.setProperty(propertyName, propertyValue);
        }
    };
    EditorLoader.prototype.getDetailedInvoiceOptions = function () {
        return {
            showDiscountAndTax: this.getSummarySettingProperty('showDiscountAndTax'),
            showPaymentsSummaryBelowForm: !this.getSummarySettingProperty('showSummaryAfterSubmit'),
            showQuantityColumn: this.getSummarySettingProperty('showQuantity'),
            showIndexColumn: this.getSummarySettingProperty('showIndexColumn'),
            columns: this.getSummarySettingProperty('columns')
        };
    };
    EditorLoader.prototype.showRealtimeCalculations = function () {
        var showRealTimeSummaryProperty = this.getSummarySettingProperty('showRealTimeSummary')
            ? this.getSummarySettingProperty('showRealTimeSummary')
            : false;
        return showRealTimeSummaryProperty
            && this.checkFormHasPaymentProcessor()
            && this.checkFormHasFormulasOrProductsOrFixedFees();
    };
    EditorLoader.prototype.renderFooterOnAllPages = function () {
        var numberOfPages = this.engine.getDocument().getNumberOfPagesIncludingPaymentSummary();
        for (var i = 0; i < numberOfPages; i++) {
            this.engine.getDocument().getPageByIndex(i).renderFooter();
        }
    };
    EditorLoader.prototype.renderPaymentSummary = function () {
        var _this = this;
        if (this.getLoaderDependency(ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY)) {
            this.commands.recalculateForm().done(function () {
                _this.renderFooterOnAllPages();
            });
        }
        else {
            this.renderFooterOnAllPages();
        }
    };
    EditorLoader.prototype.removePaymentSummaryPageIfNeeded = function () {
        var paymentsConfiguration = this.getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS), shouldShowPaymentSummary = this.getLoaderDependency(ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY);
        if (!shouldShowPaymentSummary && !paymentsConfiguration.showPaymentsSummaryBelowForm) {
            this.execCommand('remove-payment-summary-page');
        }
    };
    EditorLoader.prototype.renderHeaderOnAllPages = function () {
        var numberOfPages = this.engine.getDocument().getNumberOfPagesIncludingPaymentSummary();
        for (var i = 0, len = numberOfPages; i < len; i++) {
            this.engine.getDocument().getPageByIndex(i).renderHeader();
        }
    };
    EditorLoader.prototype.setSelectedCurrencyId = function (selectedCurrencyId) {
        if (typeof selectedCurrencyId === 'string') {
            this.selectedCurrencyId = parseInt(selectedCurrencyId);
        }
        else {
            this.selectedCurrencyId = selectedCurrencyId;
        }
    };
    EditorLoader.prototype.getSelectedCurrencyId = function () {
        return this.selectedCurrencyId;
    };
    EditorLoader.prototype.withShowSummaryAfterEachCalculation = function (enabledState) {
        this.isRealtimeSummaryOn = enabledState;
        return this;
    };
    EditorLoader.prototype.checkFormHasPaymentProcessor = function () {
        return this.engine.getDocument().getConfiguration().getProperty('isPaymentEnabled');
    };
    EditorLoader.prototype.checkFormHasFormulasOrProductsOrFixedFees = function () {
        var paymentSettings = this.engine.getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), fixedAmount = paymentSettings ? paymentSettings.getProperty('fixedAmount') : null, formulas = this.getFormulas(), products = this.getProductsWithValue();
        var flag = false;
        if (formulas.length > 0) {
            return true;
        }
        if (fixedAmount !== undefined && fixedAmount !== null && parseInt(fixedAmount) > 0) {
            return true;
        }
        _.forEach(products, function (product) {
            var value = product.value;
            if (_.some(value, function (value) { return value > 0; })) {
                flag = true;
                return;
            }
        });
        return flag;
    };
    EditorLoader.prototype.getFormulas = function () {
        var paymentSettings = this.engine.getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), products = paymentSettings ? paymentSettings.getProperty('productsData') : [], formControls = this.engine.getDocument().getControlsList(), formulas = [];
        _.forEach(products, function (product) {
            var control = _.find(formControls, function (formControl) { return formControl.getId() === product.controlId; });
            if (control && control.getTypeId() === ElementTypes.CONTROL_TYPE_FORMULA) {
                var formula = __assign(__assign({}, product), { type: control.getTypeId(), details: control.getProperty('label.labelText') });
                formulas.push(formula);
            }
        });
        return formulas;
    };
    EditorLoader.prototype.getProductsWithValue = function () {
        var paymentSettings = this.engine.getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING), products = paymentSettings ? paymentSettings.getProperty('productsData') : [], formControls = this.engine.getDocument().getControlsList(), productsWithValue = [];
        _.forEach(products, function (product) {
            var control = _.find(formControls, function (formControl) { return formControl.getId() === product.controlId; });
            if (control && control.hasProperty('payments.value')) {
                var value = control.getProperty('payments.value'), productWithValue = __assign(__assign({}, product), { value: value, type: control.getTypeId(), details: control.getProperty('label.labelText') });
                productsWithValue.push(productWithValue);
            }
        });
        return productsWithValue;
    };
    EditorLoader.prototype.enumeratePaymentSummaryTranslations = function () {
        var _this = this;
        var result = [], paymentSettings = this.getEngine().getDocument().getForm()
            .getEditorSettingByTypeId(EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING);
        var paymentSummaryColumns = [];
        if (paymentSettings && paymentSettings.hasProperty('columns')) {
            paymentSummaryColumns = paymentSettings.getProperty('columns');
        }
        _.forEach(paymentSummaryColumns, function (column) {
            result.push({
                key: column.i18n,
                sourceText: column.label || _this.getI18n().translateText(column.i18n)
            });
        });
        return result;
    };
    EditorLoader.prototype.changePaymentSummaryColumnVisibility = function (columnData) {
        var _this = this;
        var paymentSummaryColumns = this.getSummarySettingProperty(EPaymentSummaryProperties.COLUMNS);
        _.forEach(paymentSummaryColumns, function (column) {
            if (column.name === columnData.name && column.showFlag) {
                _this.setSummarySettingProperty(column.showFlag, columnData.isVisible);
                _this.renderPaymentSummary();
                return;
            }
        });
    };
    EditorLoader.changePaymentSummaryColumnNameOnInput = function (columnData) {
        var columns = PaymentsSummaryHelper.getPaymentSummaryColumn(columnData.name);
        if (!columns || !columns.length)
            return;
        _.forEach(columns, function (column) {
            if (column) {
                column.textContent = columnData.value;
            }
        });
    };
    EditorLoader.prototype.changePaymentSummaryColumnNameOnBlur = function (columnData) {
        var _this = this;
        this.updatePaymentSummaryColumnName(columnData);
        var columns = PaymentsSummaryHelper.getPaymentSummaryColumn(columnData.name);
        if (!columns || !columns.length)
            return;
        _.forEach(columns, function (column) {
            if (column && columnData.value === '') {
                var i18nKey = column.getAttribute('data-i18n-text');
                columnData.value = _this.getI18n().translateText(i18nKey);
                column.textContent = columnData.value;
            }
        });
    };
    EditorLoader.prototype.updatePaymentSummaryColumnName = function (columnData) {
        var columns = this.getSummarySettingProperty(EPaymentSummaryProperties.COLUMNS), newColumns = [];
        _.forEach(columns, function (column) {
            if (column.name === columnData.name) {
                newColumns.push(__assign(__assign({}, column), { label: columnData.value }));
            }
            else {
                newColumns.push(column);
            }
        });
        this.setSummarySettingProperty(EPaymentSummaryProperties.COLUMNS, newColumns);
    };
    EditorLoader.prototype.bindHeaderEvents = function () {
        var _this = this;
        this.header && this.header.on(EHeaderConstants.HEADER_EVENT, function (args) {
            var action;
            switch (args.key) {
                case EInteractionableControlKeys.PUBLISH_WEEBLY:
                    _this.commands.publishFormOnWeebly(_this.getFormId());
                    break;
                case EInteractionableControlKeys.PUBLISH_WEEBLY_LINK:
                case EInteractionableControlKeys.PUBLISH_WEEBLY_LIGHTBOX:
                case EInteractionableControlKeys.PUBLISH_BIG_COMMERCE_LINK:
                case EInteractionableControlKeys.PUBLISH_BIG_COMMERCE_LIGHTBOX:
                case EInteractionableControlKeys.PUBLISH_SHOPIFY_LINK:
                case EInteractionableControlKeys.PUBLISH_SHOPIFY_LIGHTBOX:
                    action = navigateAction(args.key);
                    _this.store.dispatch(action);
                    break;
                case EInteractionableControlKeys.PUBLISH_BIG_COMMERCE:
                case EInteractionableControlKeys.PUBLISH_SHOPIFY:
                    var panelGroup = _this.getEditorPanelGroup();
                    var component = panelGroup.getPanelById('publish-form');
                    var panelName = 'weebly-embed-in-page-publish-method';
                    panelGroup.setVisible(true);
                    _this.execCommand('set-active-panel', 'publish-form');
                    panelName = _this.getPanelNameByKey(args.key);
                    if (component) {
                        component.openElementById(panelName);
                    }
                    action = navigateAction(args.key);
                    _this.store.dispatch(action);
                    break;
                case EInteractionableControlKeys.CUSTOMIZE_THEME:
                    action = navigateAction(EBuilderRoutes.THEMES);
                    _this.store.dispatch(action);
                    break;
                case EInteractionableControlKeys.ADD_FIELDS:
                    action = navigateAction(EBuilderRoutes.EDITOR);
                    _this.store.dispatch(action);
                    break;
                case EInteractionableControlKeys.EMAIL_AND_SMS:
                    _this.redirectToNotifications();
                    break;
                case EInteractionableControlKeys.TRANSLATIONS:
                    action = navigateAction(EBuilderRoutes.TRANSLATIONS);
                    _this.store.dispatch(action);
                    break;
                case EInteractionableControlKeys.EDIT_TITLE_BOX:
                    _this.engine.getDocument().setProperty('name.value', args.value);
                    break;
                case EInteractionableControlKeys.PRODUCTS:
                    _this.execCommand('open-products-dialog');
                    break;
                case EInteractionableControlKeys.PAYMENTS:
                    action = navigateAction(EBuilderRoutes.PAYMENTS);
                    _this.store.dispatch(action);
                    break;
                case EInteractionableControlKeys.PUBLISH_GET_LINK:
                    action = navigateAction(EBuilderRoutes.PUBLISH_GET_LINK);
                    _this.store.dispatch(action);
                    break;
                case EInteractionableControlKeys.PUBLISH_EMBED_CODE:
                    action = navigateAction(EBuilderRoutes.PUBLISH_EMBED_CODE);
                    _this.store.dispatch(action);
                    panelName = _this.getEmbedCodePanelId();
                    console.error('PUBLISH_EMBED_CODE triggered');
                    _this.openPublishPanel(panelName);
                    _this.URLHandler.setNewUrl('publish-form', 'page_view_publish_embed');
                    _this.trackPlatformSpecificMetric('page_view_publish_embed');
                    break;
                case EInteractionableControlKeys.PUBLISH_WEEBLY_PLATFORMS:
                case EInteractionableControlKeys.PUBLISH_SHOPIFY_PLATFORMS:
                case EInteractionableControlKeys.PUBLISH_BIG_COMMERCE_PLATFORMS:
                    action = navigateAction(args.key);
                    _this.store.dispatch(action);
                    _this.trackPlatformSpecificMetric('page_view_publish_platforms');
                    break;
                case EInteractionableControlKeys.PUBLISH_FACEBOOK:
                    action = navigateAction(EBuilderRoutes.PUBLISH_FACEBOOK);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', EInteractionableControlKeys.PUBLISH_FACEBOOK);
                    _this.openPublishPanel('facebook-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_BLOGGER:
                    action = navigateAction(EBuilderRoutes.PUBLISH_BLOGGER);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'blogger-publish-method');
                    _this.openPublishPanel('blogger-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_WORDPRESS:
                    action = navigateAction(EBuilderRoutes.PUBLISH_WORDPRESS);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'wordpress-publish-method');
                    _this.openPublishPanel('wordpress-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_JOOMLA:
                    action = navigateAction(EBuilderRoutes.PUBLISH_JOOMLA);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'joomla-publish-method');
                    _this.openPublishPanel('joomla-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_SALESFORCE:
                    action = navigateAction(EBuilderRoutes.PUBLISH_SALESFORCE);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'salesforce-publish-method');
                    _this.openPublishPanel('salesforce-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_SALESFORCE_COMMUNITY:
                    action = navigateAction(EBuilderRoutes.PUBLISH_SALESFORCE_COMMUNITY);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'salesforce-community-publish-method');
                    _this.openPublishPanel('salesforce-community-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_UNBOUNCE:
                    action = navigateAction(EBuilderRoutes.PUBLISH_UNBOUNCE);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'unbounce-publish-method');
                    _this.openPublishPanel('unbounce-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_GOOGLE_SITES:
                    action = navigateAction(EBuilderRoutes.PUBLISH_GOOGLE_SITES);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'google-sites-publish-method');
                    _this.openPublishPanel('google-sites-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_TWITTER:
                    action = navigateAction(EBuilderRoutes.PUBLISH_TWITTER);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'twitter-publish-method');
                    _this.openPublishPanel('twitter-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_PLATFORMS:
                    action = navigateAction(EBuilderRoutes.PUBLISH_PLATFORMS);
                    _this.store.dispatch(action);
                    _this.URLHandler.setNewUrl('publish-form', 'platforms-publish-method');
                    _this.openPublishPanel('platforms-publish-method');
                    break;
                case EInteractionableControlKeys.PUBLISH_SALESFORCE_PLATFORMS:
                    action = navigateAction(EBuilderRoutes.PUBLISH_SALESFORCE_PLATFORMS);
                    _this.store.dispatch(action);
                    break;
            }
        });
    };
    EditorLoader.prototype.loadStartupPanel = function () {
        var _this = this;
        var currentURL = UrlUtils.parse(window.location.href);
        var queryParts = UrlUtils.parseQueryString((currentURL.search || '?').replace(/^\?/g, ''));
        var action;
        if (queryParts.startup_panel) {
            switch (queryParts.startup_panel) {
                case EPanelTypes.PRODUCTS:
                    this.on('load', PaymentsProductsDialog.openFromExternalSource);
                    break;
                case EPanelTypes.PUBLISH:
                    this.on('load', function () {
                        var _a, _b, _c, _d, _e, _f;
                        var platformDetails = _this.getPlatformDetails();
                        var route = EBuilderRoutes.PUBLISH_GET_LINK;
                        if (((_a = queryParts) === null || _a === void 0 ? void 0 : _a.tabid) && !((_b = platformDetails) === null || _b === void 0 ? void 0 : _b.isWeebly)) {
                            route = _this.viewManager.getPublishPanelByTabId(parseInt(queryParts.tabid));
                        }
                        else {
                            if ((_c = platformDetails) === null || _c === void 0 ? void 0 : _c.isShopify) {
                                route = EBuilderRoutes.PUBLISH_SHOPIFY;
                            }
                            else if ((_d = platformDetails) === null || _d === void 0 ? void 0 : _d.isBigCommerce) {
                                route = EBuilderRoutes.PUBLISH_BIG_COMMERCE;
                            }
                            else if ((_e = platformDetails) === null || _e === void 0 ? void 0 : _e.isSalesforce) {
                                route = EBuilderRoutes.PUBLISH_SALESFORCE;
                            }
                            else if ((_f = platformDetails) === null || _f === void 0 ? void 0 : _f.isWeebly) {
                                route = EBuilderRoutes.PUBLISH_WEEBLY;
                            }
                        }
                        action = navigateAction(route);
                        _this.store.dispatch(action);
                    });
                    break;
                case EPanelTypes.NOTIFICATIONS:
                    this.on('load', function () {
                        action = navigateAction(EBuilderRoutes.NOTIFICATIONS);
                        _this.store.dispatch(action);
                    });
                    break;
                case EBuilderRoutes.TRANSLATIONS:
                    this.on('load', function () {
                        action = navigateAction(EBuilderRoutes.TRANSLATIONS);
                        _this.store.dispatch(action);
                    });
                    break;
                case EBuilderRoutes.THEMES:
                    this.on('load', function () {
                        action = navigateAction(EBuilderRoutes.THEMES);
                        _this.store.dispatch(action);
                    });
                    break;
                case EBuilderRoutes.EDITOR:
                    this.on('load', function () {
                        var windowWidth = window.innerWidth;
                        var localStorage = window.localStorage;
                        var shouldHideInspector = localStorage.getItem('noSidebarActiveState');
                        if (windowWidth <= 900 && shouldHideInspector && _this.editorPanelGroup.isVisible()) {
                            localStorage.removeItem('noSidebarActiveState');
                            _this.editorPanelGroup.setVisible(false);
                        }
                        else {
                            action = navigateAction(EBuilderRoutes.EDITOR);
                            _this.store.dispatch(action);
                        }
                    });
                    break;
                case EBuilderRoutes.PAYMENTS:
                    this.on('load', function () {
                        action = navigateAction(EBuilderRoutes.PAYMENTS);
                        _this.store.dispatch(action);
                    });
                    break;
                default:
                    this.commands.setActiveEditorPanel(queryParts.startup_panel);
            }
        }
        else {
            action = navigateAction(EBuilderRoutes.EDITOR);
            this.store.dispatch(action);
        }
    };
    EditorLoader.prototype.updateStripeConnectedAccountPlaceholder = function () {
        var _this = this;
        var sidePanel = document.querySelector('#item [data-role="vertical-content"]');
        if (!sidePanel)
            return;
        var configuration = this.engine.getDocument().getConfiguration();
        if (!configuration)
            return;
        var elements = sidePanel.querySelectorAll('input[data-plugin="payments-string-read-only"]');
        var useSandbox = configuration.getProperty('isPaymentSandboxEnabled');
        elements.forEach(function (element) {
            element.placeholder = _this.i18n.translateText('payments_connected') || 'Connected';
            if (useSandbox) {
                element.placeholder = _this.i18n.translateText('edt_text_sandbox_placeholder') || 'Sandbox';
            }
        });
    };
    EditorLoader.prototype.addPaymentSummaryPageContainerIfNeeded = function () {
        var paymentsConfiguration = this.getLoaderDependency(ELoaderDependency.DETAILED_INVOICE_OPTIONS), shouldShowPaymentSummary = this.getLoaderDependency(ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY);
        if (shouldShowPaymentSummary
            && paymentsConfiguration
            && paymentsConfiguration.showPaymentsSummaryBelowForm === false
            && this.engine.getDocument().getHasPaymentSummaryPage() === false) {
            this.execCommand('append-element', ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE);
            this.engine.getDocument().repaginateInImmediateMode();
            this.renderHeaderOnAllPages();
            this.renderPaymentSummary();
        }
    };
    EditorLoader.prototype.getIdentityResponse = function () {
        return this.identityResponse;
    };
    return EditorLoader;
}(EventEmitter));
var ViewFormLoader = (function (_super) {
    __extends(ViewFormLoader, _super);
    function ViewFormLoader() {
        var _this = _super.call(this) || this;
        _this.resources = {};
        _this.previouslySubmittedData = null;
        _this.rulesData = [];
        _this.paymentProcessors = [];
        _this.quizTimer = null;
        _this.themeStrategy = EThemeStrategy.INTERNAL;
        _this.controlsThatHaveRepeatablePathsAddedToPrefillValue = [];
        _this.userFeatures = null;
        _this.allowAutoSubmit = true;
        _this.controlRelationships = [];
        _this.targetedControl = null;
        _this.isInitialFormCalculation = true;
        _this.hasProductsOrFixedFees = false;
        _this.rules = window['RulesV3'].getInstance();
        if (!_this.rules) {
            throw new Error('Cannot load RulesV3 module!');
        }
        _this.rules.getDuplicateQueryDiscarder().setActive(true);
        _this.rulesPageLoader = new GlobalPageLoader();
        return _this;
    }
    ViewFormLoader.prototype.execCommand = function (command) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        switch (command) {
            case 'dispatch-actionbar-command':
                this.commandDispatcher.handleActionBarCommand(args[0] || null);
                break;
            case 'execute-error-action':
                this.commandDispatcher.handleErrorActionCommand(args[0] || null);
                break;
            case 'set-language':
                this.commandDispatcher.setFormLanguage(args[0] || 'en');
                break;
            case 'explore-database':
                this.commandDispatcher.exploreJQLDatabase();
                break;
            case 'show-detailed-invoice-dialog':
                this.commandDispatcher.showDetailedInvoiceDialog();
                break;
            case 'control-has-changed-visibility':
                if (!this.isInitialFormCalculation) {
                    if (this.targetedControl !== args[0].controlId) {
                        this.targetedControl = args[0].controlId;
                        this.refreshCalculationForPreviouslyHiddenControl(args[0]);
                    }
                }
                break;
            case 'add-payment-summary-listeners':
            case 'remove-payment-summary-page':
            case 'form-name-changed':
                break;
            default:
                console.warn('ViewFormLoader::execCommand(' + JSON.stringify(command) + '): Unrecognized command');
                return;
        }
    };
    ViewFormLoader.prototype.withRules = function (rules) {
        this.rulesData = rules || [];
        return this;
    };
    ViewFormLoader.prototype.withPaymentProcessors = function (paymentProcessors) {
        if (this.viewFormContext === EViewFormContext.VIEW_FORM || this.viewFormContext === EViewFormContext.SAVE_FOR_LATER) {
            this.paymentProcessors = paymentProcessors && paymentProcessors.length
                ? paymentProcessors
                : null;
        }
        return this;
    };
    ViewFormLoader.prototype.getPaymentProcessors = function () {
        return this.paymentProcessors || null;
    };
    ViewFormLoader.prototype.getUI = function () {
        return this.ui;
    };
    ViewFormLoader.prototype.withSessionId = function (sessionId) {
        this.sessionId = sessionId;
        return this;
    };
    ViewFormLoader.prototype.getSessionId = function () {
        return this.sessionId || null;
    };
    ViewFormLoader.prototype.withFormId = function (formId) {
        this.formId = formId;
        return this;
    };
    ViewFormLoader.prototype.getFormId = function () {
        return this.formId;
    };
    ViewFormLoader.prototype.getSelection = function () {
        return null;
    };
    ViewFormLoader.prototype.getUICssSelector = function (uiElement) {
        return null;
    };
    ViewFormLoader.prototype.withJQuery = function (jq) {
        this.jq = jq;
        UI.withJQuery(jq);
        return this;
    };
    ViewFormLoader.prototype.getJQuery = function () {
        return this.jq;
    };
    ViewFormLoader.prototype.withSerializedFormData = function (serializedFormData) {
        this.serializedFormData = serializedFormData;
        return this;
    };
    ViewFormLoader.prototype.withApiRootAddress = function (apiRootAddress) {
        this.apiRootAddress = apiRootAddress;
        return this;
    };
    ViewFormLoader.prototype.getApiRootAddress = function () {
        return this.apiRootAddress;
    };
    ViewFormLoader.prototype.withEditorCapabilities = function (editorCapabilities) {
        this.editorCapabilities = editorCapabilities;
        return this;
    };
    ViewFormLoader.prototype.withResource = function (resourceURL, resourceDataInBase64) {
        if (resourceURL && 'string' === typeof resourceURL) {
            this.resources[resourceURL] = atob(resourceDataInBase64);
        }
        return this;
    };
    ViewFormLoader.prototype.withPreviouslySubmittedData = function (submittedData) {
        this.previouslySubmittedData = submittedData || null;
        return this;
    };
    ViewFormLoader.prototype.withFormLanguage = function (lang) {
        this.currentLanguage = lang;
        return this;
    };
    ViewFormLoader.prototype.withFormDefaultLanguage = function (lang) {
        this.defaultLanguage = lang;
        return this;
    };
    ViewFormLoader.prototype.withFormAvailableLanguages = function (languages) {
        this.languages = languages;
        return this;
    };
    ViewFormLoader.prototype.getFormAvailableLanguages = function () {
        return this.languages && this.languages.length > 1
            ? this.languages
            : null;
    };
    ViewFormLoader.prototype.getCurrentLanguage = function () {
        return this.currentLanguage;
    };
    ViewFormLoader.prototype.getDefaultLanguage = function () {
        return this.defaultLanguage;
    };
    ViewFormLoader.prototype.init = function () {
        var _this = this;
        this.hideFormIfWeAreInAutoApproveContext();
        document.body.setAttribute('data-view-form-context', this.getViewFormContextAsString());
        this.api = new Api(this.jq, this.apiRootAddress);
        this.form = document.getElementById('form');
        this.setupBodyDeviceAttribute();
        this.engine = new Engine(this, ElementsFactory.createFactory(this.editorCapabilities.factory.name, this.editorCapabilities), this.jq, this.form, this.editorCapabilities, this.resources);
        PaymentsSummaryHelper.createInstance(this.engine);
        PaymentsSummaryHelper.addSalvageHelpers();
        this.quizScoreService = new QuizScoreService();
        this.formTranslationsService = new FormTranslationsService(this.engine.getDocument());
        this.fontsManager = new FontsManager(this.engine.getResourceManager(), this.jq, false);
        this.focusManager = new FocusManager(this.engine.getDocument(), this.jq);
        this.i18n = new I18n(this.jq, this.api, this.currentLanguage, this.engine.getResourceManager());
        UI.withI18n(this.i18n);
        this.i18n.on('load', function () {
            _this.engine.getDocument().trigger('translate');
            _this.engine.getDocument().updateI18n();
            _this.currentLanguage = _this.i18n.getLanguageCode();
            _this.domAbstractionLayer.trigger('control-event', EFormRuleEventType.CHANGE, null, 'language', null);
        });
        this.quizScoreService.on('change', function () {
            _this.domAbstractionLayer.trigger('control-event', EFormRuleEventType.CHANGE, null, 'quiz_score', null);
        });
        this.ui = new EditorUserInterface(this.engine);
        UserFileExtensionsService.getInstance().withUI(this.ui).withResourceManager(this.engine.getResourceManager());
        this.engine.loadFromString(JSON.stringify(this.serializedFormData));
        this.engine.getDocument().initApplicationControls();
        this.forceHiddenFieldsVisibilityInEditSubmissionMode();
        this.i18n.get(this.apiRootAddress + '/v2/language/' + this.currentLanguage + '/' + this.formId);
        this.engine.getDocument().setCurrentPageIndex(0);
        this.engine.getDocument().withRules(this.rulesData);
        this.commandDispatcher = new ViewFormCommandDispatcher(this.engine, this);
        this.quizScoreService.withCommandDispatcher(this.commandDispatcher);
        this.translator = new LegacyDataTranslator(this.engine.getDocument());
        this.domAbstractionLayer = new AbstractionLayerV2(this, this.translator);
        this.queryBuilder = new RulesQueryBuilder(this.domAbstractionLayer, this.rules.getDatabase(), this.engine.getDocument());
        this.jqlAdditionalFunctionsLibrary = new JQLDatabaseFunctionsV2(this.domAbstractionLayer);
        this.injectCouponCodeControlIntoFormIfNeeded();
        this.initDOMEvents();
        (function (self) {
            self.on('plugin-rendered', function (pluginName, inDOMNode) {
                self.onPluginRendered(pluginName, inDOMNode);
            });
            self.engine.getDocument().on('calculate', function (manual) {
                self.commandDispatcher.recalculateForm(manual);
            });
            self.on('form_has_products_or_fixed_fees_changed', function (hasProductsOrFixedFees) {
                self.hasProductsOrFixedFees = hasProductsOrFixedFees;
            });
        })(this);
        this.rules.getDatabase()
            .withFunction('IS_CONTROL_CHECKED', this.wrapMethodCall('IS_CONTROL_CHECKED', this.jqlAdditionalFunctionsLibrary))
            .withFunction('IS_NOT_CONTROL_CHECKED', this.wrapMethodCall('IS_NOT_CONTROL_CHECKED', this.jqlAdditionalFunctionsLibrary));
        this.rules.withJQLTable('controls', FormV2Table.create(this.translator, this.domAbstractionLayer));
        console.log('Init view form');
        if (this.previouslySubmittedData) {
            this.loadPreviouslySubmittedData();
        }
        if (true === this.engine.getDocument().getActionBar().getProperty('configuration.hasApproveButton')
            && this.viewFormContextOptions && this.viewFormContextOptions.autoSubmitApproval) {
            var typeFormContextApproval_1 = 'approve';
            if (this.viewFormContextOptions.autoSubmitApprovalReject) {
                typeFormContextApproval_1 = 'reject';
            }
            if (this.rulesData.length > 0) {
                this.domAbstractionLayer.on('compute-form-rules', function () {
                    console.log('Approve automatically with rules');
                    _this.execCommand('dispatch-actionbar-command', typeFormContextApproval_1);
                });
            }
            else {
                console.log('Approve automatically without rules');
                this.execCommand('dispatch-actionbar-command', typeFormContextApproval_1);
            }
        }
        this.rules.getDatabase().initPlanner();
        this.injectExistingFormRulesToEngine();
        if (this.rules.shouldShowLoader()) {
            this.createLoader();
        }
        this.rules.withDOMAbstractionLayer(this.domAbstractionLayer);
        this.rules.getDatabase().withAutoBindingProvider(new RequestQueryStringParameterBindingProvider());
        this.rules.getDatabase().withAutoBindingProvider(this.rules.getDOMAbstractionLayer().getBindingProvider());
        this.rules.getDatabase().withAutoBindingProvider(new QuizScoreBindingProvider(this.engine, this.quizScoreService));
        this.rules.getDatabase().withAutoBindingProvider(new CalculationsDatabaseBindingProvider(this.engine));
        this.rules.getDatabase().withAutoBindingProvider(new LanguageBindingProvider(this.engine));
        var onDatabaseIdle = function () {
            _this.rules.getDatabase().off('idle', onDatabaseIdle);
            _this.loadPreviouslySubmittedData();
            if (_this.previouslySubmittedData) {
                _this.domAbstractionLayer.trigger('compute-form-rules', function () {
                    _this.loadPreviouslySubmittedData();
                    console.warn('FORM LOGIC INITIALIZATION DONE!');
                    _this.rules.getDuplicateQueryDiscarder().setActive(false);
                    _this.engine.trigger('compute-form-rules-done');
                    _this.isInitialFormCalculation = false;
                });
            }
            _this.onFormRulesAreLoadedFirstTimePageLoads();
            _this.hideLoader();
        };
        this.rules.getDatabase().on('idle', onDatabaseIdle);
        this.rules.initializeInFormViewMode();
        if (!this.rulesData || 0 === this.rulesData.length) {
            this.onFormRulesAreLoadedFirstTimePageLoads();
        }
        setTimeout(function () {
            _this.onFormRulesAreLoadedFirstTimePageLoads();
        }, 500);
        if (EngineToggles.ALLOW_REAL_TIME_CALCULATIONS) {
            if (this.isShowSummaryAfterEachCalculation()) {
                this.engine.getDocument().realTimeCalculationsThrottler();
            }
        }
        if (null !== this.quizTimer) {
            this.commandDispatcher.startQuizTimerCountdownThread();
        }
        this.engine.on('page-scroll', function () {
            console.log('scroll!');
        });
        if (this.formSettings && this.formSettings.autoFocusOnFirstInputField) {
            setTimeout(function () {
                _this.commandDispatcher.focusOnFirstFormField();
            }, 500);
        }
        if (this.formSettings && this.formSettings.formFooter) {
            this.commandDispatcher.displayFormFooter(this.formSettings.formFooter);
        }
        this.setFormIsEmbeddebAttribute();
        this.setWorkflowsViewFormFlag();
        this.notifyWindowParentWithFormDimensions();
        setTimeout(function () {
            FormUtils.addEditorModeChangeEventListenerForWix(_this.jq);
            FormUtils.getUserSessionTokenForWix();
        }, 100);
        setTimeout(function () {
            FormUtils.refreshFrameHeightOnWix();
        }, 400);
        this.markSalesforceControlsWithDOMAttribute(this.rules.getSalesforceAffectedControlsTriggers(), 'trigger');
        this.markSalesforceControlsWithDOMAttribute(this.rules.getSalesforceAffectedControls(), 'normalField');
        this.trigger('ready');
        this.verifyAutoSubmit();
        if (this.getViewFormContext() === EViewFormContext.PDF_EXPORT) {
            this.verifyRulesTypeForPdf();
        }
        this.addMobileAppActions();
    };
    ViewFormLoader.prototype.verifyRulesTypeForPdf = function () {
        var _this = this;
        var rulesData = this.rules.getRules();
        var rulesAfterSubmitCounter = 0, controlsNumber = this.engine.getDocument().getControlsList().length;
        for (var i = 0, lenActions = rulesData.length; i < lenActions; i++) {
            if (rulesData[i].eventType === EFormRuleEventType.APPROVED
                || rulesData[i].eventType === EFormRuleEventType.SUBMITTED) {
                rulesAfterSubmitCounter++;
            }
        }
        if (rulesAfterSubmitCounter === rulesData.length) {
            var checkControlsNumber_1 = setInterval(function () {
                if (controlsNumber === _this.engine.getDocument().getControlsList().length) {
                    console.warn('FORM LOGIC INITIALIZATION DONE!');
                    clearInterval(checkControlsNumber_1);
                }
                controlsNumber = _this.engine.getDocument().getControlsList().length;
            }, 1000);
        }
    };
    ViewFormLoader.prototype.addMobileAppActions = function () {
        (function (self) {
            self.engine.on('theme-ready', function () {
                setTimeout(function () {
                    if (!window['mobileApp']) {
                        return;
                    }
                    self.bindMobileAppSelect();
                    self.engine.getDocument().on('node-insertion-trigger', function (node) {
                        if (node.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP) {
                            node.flatten().forEach(function (control) {
                                if (control.getTypeId() === ElementTypes.CONTROL_TYPE_DROPDOWN) {
                                    self.bindMobileAppSelect();
                                }
                            });
                        }
                    });
                });
            });
        })(this);
    };
    ViewFormLoader.prototype.bindMobileAppSelect = function () {
        var mobileApp = window['mobileApp'];
        (function (self, $) {
            if (mobileApp.systemName && mobileApp.systemName === 'Android'
                && mobileApp.isTablet && mobileApp.isTablet === "true"
                && mobileApp.systemVersion && parseFloat(mobileApp.systemVersion.substring(0, 3)) <= 5.1) {
                $('select').mobileSelect({
                    theme: 'mac',
                    noValueSelected: '',
                    onClose: function () {
                        var controlId = this.closest('[data-role="control"]').attr('data-id');
                        var repeatablePath, value = this.val() === 'Please Select' ? '' : this.val();
                        if (this.parents('div[data-type="repeatable-group"]').length) {
                            repeatablePath = $(this.parents('div[data-type="repeatable-group"]')[0]).attr('data-repeatable-path');
                        }
                        if (repeatablePath) {
                            self.getDOMAbstractionLayer().setControlValueById(controlId.toString(), value, null, repeatablePath);
                        }
                        else {
                            self.getDOMAbstractionLayer().setControlValueById(controlId.toString(), value);
                        }
                        self.jq(this)[0].dispatchEvent(new Event('change'));
                        $('.mobileSelect-container').find('.mobileSelect-overlay').remove();
                    },
                    onOpen: function () {
                        var mobileContainerSelector = $('.mobileSelect-container[style*="display: block"]'), mobileContainerSelectorControl = $('.mobileSelect-control'), overlay = document.createElement('div');
                        overlay.className = "mobileSelect-overlay";
                        mobileContainerSelector.append(overlay).append(function () {
                            $(this).find('.mobileSelect-overlay').on('click', function () {
                                $(this).closest('.mobileSelect-container').find('.mobileSelect-cancelbtn').trigger('click');
                            });
                            return this;
                        });
                        mobileContainerSelector.find('.mobileSelect-title').css("display", "none");
                        mobileContainerSelector.find('.mobileSelect-buttons').css("display", "none");
                        setTimeout(function () {
                            mobileContainerSelectorControl.on('click', function (e) {
                                e.preventDefault();
                                e.stopPropagation();
                                $(this).closest('.mobileSelect-container').find('.mobileSelect-savebtn').trigger('click');
                            });
                            mobileContainerSelectorControl.on('click', function (e) {
                                e.preventDefault();
                                e.stopPropagation();
                                $(this).closest('.mobileSelect-container').find('.mobileSelect-savebtn').trigger('click');
                            });
                        });
                    },
                });
                $('[data-role="dropdown-skin"]').css('display', 'none');
                setTimeout(function () {
                    self.engine.getDocument().flatten().forEach(function (control) {
                        if (control.getTypeId() === ElementTypes.CONTROL_TYPE_DROPDOWN && control.getValue().value !== '') {
                            if (control.getRootNode().querySelector('button .text')) {
                                var text = control.getValue().value;
                                if (control.getValue().value === null) {
                                    text = '';
                                }
                                control.getRootNode().querySelector('button .text').innerText = text;
                            }
                        }
                    });
                    $('.btn-mobileSelect-gen .text').on("DOMSubtreeModified", function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        if (this.innerText === 'Please Select') {
                            this.innerText = '';
                        }
                    });
                }, 500);
            }
        })(this, this.jq);
    };
    ViewFormLoader.prototype.isEnabledAutoSubmit = function () {
        var formSettings = this.getFormSettings();
        if (formSettings.autoSubmit !== undefined
            && formSettings.autoSubmit
            && this.getAllowAutoSubmit() === true) {
            var viewFormContext = this.engine.getLoader().getLoaderDependency(ELoaderDependency.VIEW_FORM_CONTEXT);
            var formContextExclude = [EViewFormContext.EDIT_LATER, EViewFormContext.EDIT_SUBMISSION, EViewFormContext.APPROVAL];
            if (formContextExclude.indexOf(viewFormContext) > -1) {
                return false;
            }
            var rulesData = this.rules.getRules();
            if (rulesData.length) {
                for (var i = 0, len = rulesData.length; i < len; i++) {
                    if (rulesData[i].eventType !== EFormRuleEventType.INIT
                        && rulesData[i].eventType !== EFormRuleEventType.ALL_EVENTS
                        && rulesData[i].eventType !== EFormRuleEventType.SUBMITTED) {
                        return false;
                    }
                }
            }
            return true;
        }
        return false;
    };
    ViewFormLoader.prototype.verifyAutoSubmit = function () {
        (function (self) {
            if (self.isEnabledAutoSubmit()) {
                var rulesData_1 = self.rules.getRules();
                if (rulesData_1.length) {
                    var isRepeatable = false;
                    for (var i = 0, len = rulesData_1.length; i < len; i++) {
                        if (rulesData_1[i].actions !== undefined) {
                            for (var j = 0, lenActions = rulesData_1[i].actions.length; j < lenActions; j++) {
                                var controlId = rulesData_1[i].actions[j].controlId, control = self.engine.getDocument().getElementById(Number(controlId.replace('control_', ''))), repeatableGroup = control.getFirstParentOfType(ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP);
                                if (repeatableGroup !== null) {
                                    isRepeatable = true;
                                    break;
                                }
                            }
                        }
                    }
                    if (isRepeatable) {
                        self.engine.on('repeatable-prefill-done', function () {
                            var hasSalesforceRules = rulesData_1.some(function (rule) { return rule.isSalesforce === true; });
                            if (hasSalesforceRules) {
                                self.engine.on('compute-form-rules-done', function () {
                                    self.doAutoSubmit();
                                });
                            }
                            else {
                                self.doAutoSubmit();
                            }
                        });
                    }
                    else {
                        self.engine.on('compute-form-rules-done', function () {
                            self.doAutoSubmit();
                        });
                    }
                }
                else {
                    self.doAutoSubmit();
                }
            }
        })(this);
    };
    ViewFormLoader.prototype.doAutoSubmit = function () {
        (function (self, $) {
            self.setAllowAutoSubmit(false);
            self.commandDispatcher.submit(EFormSubmitAction.SUBMIT);
            self.setAllowAutoSubmit(true);
        }(this, this.jq));
    };
    ViewFormLoader.prototype.setFormIsEmbeddebAttribute = function () {
        var url = UrlUtils.parse(window.location.href), query = UrlUtils.parseQueryString(url.search);
        for (var i = 0, keys = Object.keys(query), len = keys.length; i < len; i++) {
            if (keys[i].indexOf('embed') > -1) {
                this.engine.getForm().setAttribute('data-form-is-embedded', '1');
                document.body.setAttribute('data-is-in-iframe', '1');
                break;
            }
        }
    };
    ViewFormLoader.prototype.setWorkflowsViewFormFlag = function () {
        var url = UrlUtils.parse(window.location.href), query = UrlUtils.parseQueryString(url.search);
        this.isWorkflowsViewForm = !!~~query.is_workflows;
    };
    ViewFormLoader.prototype.injectExistingFormRulesToEngine = function () {
        var rules = this.engine.getDocument().getRules(), result = [];
        if (!rules) {
            return;
        }
        for (var i = 0, len = rules.length; i < len; i++) {
            for (var actions = this.queryBuilder.buildAction(rules[i]), j = 0, n = actions.length; j < n; j++) {
                result.push(actions[j]);
            }
        }
        if (result.length) {
            this.rules.withRules(result);
        }
        this.setControlsRelationships();
    };
    ViewFormLoader.prototype.wrapMethodCall = function (methodName, thisObject) {
        return function () {
            return thisObject[methodName].apply(thisObject, Array.prototype.slice.call(arguments, 0));
        };
    };
    ViewFormLoader.prototype.loadPreviouslySubmittedData = function () {
        this.domAbstractionLayer['disableEvents']();
        for (var i = 0, len = this.previouslySubmittedData.length; i < len; i++) {
            this.domAbstractionLayer.setControlValueById(this.previouslySubmittedData[i].controlId, this.previouslySubmittedData[i].value, this.previouslySubmittedData[i].repeated || null, this.previouslySubmittedData[i].repeatedPath || null);
        }
        this.domAbstractionLayer['enableEvents']();
    };
    ViewFormLoader.prototype.initDOMEvents = function () {
        (function (self, $) {
            var formSpecialControlTypes = [ElementTypes.CONTROL_TYPE_TIME, ElementTypes.CONTROL_TYPE_DATE];
            var debouncedTriggers = {};
            var createDebouncedTrigger = function (key) {
                var debouncedTrigger = debouncedTriggers[key];
                if (!debouncedTrigger) {
                    debouncedTrigger = Debounce.create.bind(self)(self.onControlValueChangedBecauseOfUserInput, 200);
                    debouncedTriggers[key] = debouncedTrigger;
                }
                return debouncedTrigger;
            };
            self.getEngine().getDocument().on('node-property-changed', function (target, propertyFQN, newValue, oldValue) {
                if (formSpecialControlTypes.indexOf(target.getTypeId()) > -1
                    && propertyFQN === 'value.value') {
                    var element = target.getRootNode().querySelector('[data-role="i123-input"]');
                    createDebouncedTrigger.bind(self)(target.getHash())(element, EFormRuleEventType.TEXT_INPUT, 'input', true);
                }
            });
            $('#form').on('input', [
                '[data-role=control][data-hash] input[data-role=i123-input]:not([type=radio]):not([type=checkbox]):not([type=hidden])',
                '[data-role=control][data-hash] div[data-role=i123-input]:not([data-type=dropdown]):not([data-type=searchable-dropdown])',
                '[data-role=control][data-hash] textarea',
                '[data-role=control][data-hash][data-type=check-box] input[type=text][data-role=other]',
                '[data-role=control][data-hash][data-type=radio] input[type=text][data-role=other]',
            ].join(', '), function (e) {
                if (this.getAttribute('data-role') === 'other' && this.getAttribute('type') === 'text') {
                    createDebouncedTrigger.bind(self)(this.outerHTML)(this, this.value
                        ? EFormRuleEventType.CHECK
                        : EFormRuleEventType.UNCHECK, e.type, true);
                }
                else {
                    createDebouncedTrigger.bind(self)(this.outerHTML)(this, EFormRuleEventType.TEXT_INPUT, e.type, true);
                }
            }).on('change', [
                '[data-role=control][data-hash] select[data-role=i123-input]',
                '[data-role=control][data-hash] div[data-role=i123-input][data-type=dropdown]',
                '[data-role=control][data-hash] div[data-role=i123-input][data-type=searchable-dropdown]',
                '[data-role=control][data-hash] div[data-role=i123-input][data-type=file]',
                '[data-role=control][data-hash] input[type=text][data-role=i123-input]',
                '[data-role=control][data-hash] input[type=email][data-role=i123-input]',
                '[data-role=control][data-hash] input[type=password][data-role=i123-input]',
                '[data-role=control][data-hash] textarea[data-role=i123-input]',
            ].join(','), function (e) {
                self.onControlValueChangedBecauseOfUserInput(this, EFormRuleEventType.CHANGE, e.type, true);
            }).on('click change', [
                '[data-role=control][data-hash] input[data-role=i123-input][type=radio]',
                '[data-role=control][data-hash] input[data-role=i123-input][type=checkbox]',
            ].join(', '), function (e) {
                createDebouncedTrigger.bind(self)(this.outerHTML + e.type)(this, this.checked
                    ? EFormRuleEventType.CHECK
                    : EFormRuleEventType.UNCHECK, e.type, e.type === 'click');
            }).on('mousedown focus', 'div[data-hash], div[data-hash] *', function (e) {
                self.onElementFocusedByUser($(this).closest('[data-hash]').get(0));
                e.stopPropagation();
            }).on('input', [
                'div[data-role=control][data-type=check-box] [data-role=choice] input[type=text][data-role=other]',
                'div[data-role=control][data-type=radio] [data-role=choice] input[type=text][data-role=other]'
            ].join(','), function (e) {
                self.checkOrUncheckAssociateRadioOrCheckboxDependingOnTheOtherValue(this);
            }).on('submit', function (e) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }).on('click', '[data-role=page] > [data-role=page-footer] > [data-role=control][data-type=form-action-bar] button[data-role]', function (e) {
                if (document.activeElement !== this && document.activeElement !== document.body) {
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
                var buttonRole = $(this).attr('data-role');
                if (!buttonRole) {
                    return;
                }
                self.execCommand('dispatch-actionbar-command', buttonRole);
            }).on('click', '> [data-role=form-errors] [data-role=error] [data-action]', function (e) {
                var actionName = $(this).attr('data-action');
                if (actionName) {
                    self.execCommand('execute-error-action', actionName);
                }
            }).on('change', 'div[data-role=control][data-type=language-selector] [data-type=dropdown]', function () {
                self.execCommand('set-language', this.value);
            }).on('click', 'div[data-role=control][data-type=radio] label[data-role=label] span[data-role=clear-value]', function () {
                $(this).closest('[data-role=control]').each(function () {
                    self.clearControlValue(this);
                });
            }).on('blur', '[data-hash] [data-role=i123-input]', function (e) {
                var myElementHash = $(this).closest('[data-hash]').attr('data-hash');
                if (!myElementHash) {
                    return;
                }
                var targetElement = self.engine.getDocument().getElementByHash(myElementHash);
                if (targetElement) {
                    targetElement.onBlur();
                }
            }).on('click', '[data-role=page] > [data-role=page-header] > [data-role=control][data-type=realtime-calculations]', function (e) {
                self.execCommand('show-detailed-invoice-dialog');
            });
            if (self.quizTimer !== null || (self.paymentProcessors && self.paymentProcessors.length)) {
                var previousHeaderTop_1;
                setInterval(function () {
                    var currentPageIndex = self.engine.getDocument().getCurrentPageIndex(), currentPageElement = self.engine.getDocument().getPageByIndex(currentPageIndex), currentPageHeaderRect = currentPageElement.getHeaderContainerDOMNode().getBoundingClientRect();
                    if (previousHeaderTop_1 !== currentPageHeaderRect.top) {
                        previousHeaderTop_1 = currentPageHeaderRect.top;
                        self.onHeaderDOMNodeTopPositionChanged(currentPageHeaderRect.top);
                    }
                }, 100);
            }
            self.engine.getDocument().on('radio-uncheck', function (radio, uncheckedIndex) {
                var element = radio.getInputDOMNodeAtIndex(uncheckedIndex);
                self.domAbstractionLayer.trigger('control-event', EFormRuleEventType.UNCHECK, element, 'control_' + radio.getId() + '_' + uncheckedIndex, null);
            });
        })(this, this.jq);
    };
    ViewFormLoader.prototype.onControlValueChangedBecauseOfUserInput = function (element, eventType, eventName, triggerRules) {
        var controlHash = this.jq(Renderer.castToDOMElement(element)).closest('[data-role=control][data-hash]').attr('data-hash'), elementIndexes = String(element.getAttribute('data-index') || '').split(',');
        if (!controlHash) {
            return;
        }
        var targetControl = this.engine.getDocument().getElementByHash(controlHash);
        setTimeout(function () {
            targetControl.trigger('value-change');
        }, 10);
        if (!targetControl || EElementKind.CONTROL !== targetControl.getElementKind()) {
            return;
        }
        var legacyControlsIDList = [];
        for (var i = 0, len = elementIndexes.length; i < len; i++) {
            var items = void 0;
            if (elementIndexes[i] === "-1"
                && targetControl.getTypeId() === ElementTypes.CONTROL_TYPE_RADIO
                && (items = targetControl.getProperty('choices.values') || [])) {
                elementIndexes[i] = String(items.length);
            }
            if (elementIndexes[i]) {
                legacyControlsIDList.push('control_' + targetControl.getId() + '_' + elementIndexes[i]);
            }
            if ('0' === elementIndexes[i]) {
                legacyControlsIDList.push('control_' + targetControl.getId());
            }
        }
        if (!legacyControlsIDList.length) {
            legacyControlsIDList.push('control_' + targetControl.getId());
        }
        targetControl.removeAllBackendErrors();
        targetControl['onValueChanged']();
        if (triggerRules) {
            var abstractionLayer = this.rules.getDOMAbstractionLayer();
            if (abstractionLayer) {
                for (var i = 0, len = legacyControlsIDList.length; i < len; i++) {
                    abstractionLayer.trigger('control-event', eventType, element, legacyControlsIDList[i], null);
                }
            }
        }
        this.quizScoreService.updateInAsyncMode();
    };
    ViewFormLoader.prototype.onElementFocusedByUser = function (element) {
        var elementHash = element.getAttribute('data-hash'), el;
        if (elementHash && (el = this.engine.getDocument().getElementByHash(elementHash))) {
            this.engine.getDocument().setActiveElement(el);
        }
    };
    ViewFormLoader.prototype.checkOrUncheckAssociateRadioOrCheckboxDependingOnTheOtherValue = function (input) {
        (function ($) {
            if (input.value.replace(/(^[\s]+|[\s]+$)/g, '') !== '') {
                $(input).closest('[data-role=choice]').find('input[type=radio], input[type=checkbox]').each(function () {
                    if (!this.checked) {
                        this.checked = true;
                        $(this).trigger('change');
                    }
                });
            }
            else {
                $(input).closest('[data-role=choice]').find('input[type=radio], input[type=checkbox]').each(function () {
                    if (this.checked) {
                        this.checked = false;
                        $(this).trigger('change');
                    }
                });
            }
        })(this.jq);
    };
    ViewFormLoader.prototype.getRules = function () {
        return this.rules;
    };
    ViewFormLoader.prototype.getCommandDispatcher = function () {
        return this.commandDispatcher;
    };
    ViewFormLoader.prototype.withViewFormContext = function (viewFormContext) {
        this.viewFormContext = viewFormContext;
        return this;
    };
    ViewFormLoader.prototype.getViewFormContext = function () {
        return this.viewFormContext;
    };
    ViewFormLoader.prototype.withViewFormEnvironmentContext = function (viewFormEnvironmentContext) {
        this.viewFormEnvironmentContext = viewFormEnvironmentContext;
        return this;
    };
    ViewFormLoader.prototype.getViewFormEnvironmentContext = function () {
        return this.viewFormEnvironmentContext;
    };
    ViewFormLoader.prototype.withCSRFToken = function (token) {
        this.csrfToken = token;
        this.jq.ajaxSetup({
            headers: {
                'theToken': token
            }
        });
        return this;
    };
    ViewFormLoader.prototype.getCSRFToken = function () {
        return this.csrfToken;
    };
    ViewFormLoader.prototype.jql = function (statement, bindParams) {
        return this.rules.getDatabase().createStatement(statement);
    };
    ViewFormLoader.prototype.getDOMAbstractionLayer = function () {
        return this.domAbstractionLayer;
    };
    ViewFormLoader.prototype.getRulesQueryBuilder = function () {
        return this.queryBuilder;
    };
    ViewFormLoader.prototype.withShowSummaryAfterEachCalculation = function (enabledState) {
        if (this.viewFormContext === EViewFormContext.VIEW_FORM
            || this.viewFormContext === EViewFormContext.SAVE_FOR_LATER
            || this.viewFormContext === EViewFormContext.PDF_EXPORT) {
            this.showSummaryAfterEachCalculation = !!enabledState;
        }
        else {
            this.showSummaryAfterEachCalculation = false;
        }
        return this;
    };
    ViewFormLoader.prototype.isShowSummaryAfterEachCalculation = function () {
        return this.showSummaryAfterEachCalculation;
    };
    ViewFormLoader.prototype.getLoaderDependency = function (dependency) {
        switch (dependency) {
            case ELoaderDependency.PAYMENT_PROCESSORS_LIST:
                return this.getPaymentProcessors();
            case ELoaderDependency.SELECTED_PAYMENT_PROCESSOR_TYPE_ID:
                return this.commandDispatcher.getSelectedPaymentProcessorTypeId();
            case ELoaderDependency.SELECTED_PAYMENT_PROCESSOR_EXTRA_DATA:
                return this.commandDispatcher.getSelectedPaymentProcessorExtraData();
            case ELoaderDependency.INITIAL_QUIZ_TIMER:
                return this.getQuizTimer();
            case ELoaderDependency.CURRENT_QUIZ_TIMER:
                return this.commandDispatcher.quizTimerCountdownValue;
            case ELoaderDependency.SESSION_ID:
                return this.getSessionId();
            case ELoaderDependency.I18N:
                return this.getI18n();
            case ELoaderDependency.USER_INTERFACE:
                return this.getUI();
            case ELoaderDependency.SKIP_CAPTCHA:
                return this.isCaptchaSkipped();
            case ELoaderDependency.TRANSLATIONS_LANGUAGE_CODES:
                return this.getFormAvailableLanguages();
            case ELoaderDependency.VIEW_FORM_CONTEXT:
                return this.getViewFormContext();
            case ELoaderDependency.SUBMISSION_XML_DATETIME_START:
                return this.getSubmissionXMLDateTimeStart();
            case ELoaderDependency.PAYMENTS_COUPON_CODE_CONFIGURATION:
                return this.getCouponConfiguration();
            case ELoaderDependency.SUBMISSION_ID:
                return this.getSubmissionId();
            case ELoaderDependency.FORM_SETTINGS:
                return this.getFormSettings();
            case ELoaderDependency.SHOW_REALTIME_CALCULATIONS:
                return this.isShowSummaryAfterEachCalculation();
            case ELoaderDependency.DETAILED_INVOICE_OPTIONS:
                return this.getDetailedInvoiceOptions();
            case ELoaderDependency.LAST_CALCULATION_HTML_MARKUP:
                return this.commandDispatcher ? this.commandDispatcher.getLastCalculationHTMLMarkup() : '';
            case ELoaderDependency.FONTS_MANAGER:
                return this.fontsManager;
            case ELoaderDependency.GEOLOCATION_USER_COUNTRY_CODE:
                return this.getGeolocationUserCountryCode();
            case ELoaderDependency.WIX_AUTHORIZED_REQUEST_DETAILS:
                return this.getWixAuthorizedRequestDetails();
            case ELoaderDependency.THEME_STRATEGY:
                return this.getThemeStrategy();
            case ELoaderDependency.EXTERNAL_THEME_INITIAL_PROPERTIES:
                return this.getPreloadedExternalThemeProperties();
            case ELoaderDependency.DIFFERENCE_BETWEEN_CLIENT_AND_SERVER_TIME:
                return this.getDifferenceBetweenClientAndServerTime();
            case ELoaderDependency.RULES_QUERY_BUILDER:
                return this.queryBuilder || null;
            case ELoaderDependency.VIEW_FORM_CONTEXT_OPTIONS:
                return this.viewFormContextOptions || null;
            case ELoaderDependency.IS_WORKFLOWS_VIEW_FORM_EMBED:
                return this.isWorkflowsViewForm;
            case ELoaderDependency.WORKFLOWS_USERS_LIST:
                return this.getUsersList();
            case ELoaderDependency.USER_FEATURES:
                return this.userFeatures || null;
            case ELoaderDependency.SHOULD_SHOW_PAYMENT_SUMMARY:
                return this.hasProductsOrFixedFees;
            case ELoaderDependency.HAS_ENABLED_PAYMENT_PROCESSORS:
                return this.checkFormHasPaymentProcessor();
            case ELoaderDependency.HAS_CALCULATE_BUTTON:
                var paymentsConfiguration = this.getDetailedInvoiceOptions();
                return this.checkFormHasPaymentProcessor()
                    && !this.isShowSummaryAfterEachCalculation()
                    && (paymentsConfiguration === null
                        || (paymentsConfiguration !== null && paymentsConfiguration.showPaymentsSummaryBelowForm));
            default:
                return null;
        }
    };
    ViewFormLoader.prototype.onPluginRendered = function (pluginName, inDOMNode) {
        switch (pluginName) {
            case 'payments-selector':
                this.commandDispatcher.initPaymentsSelector(inDOMNode);
                break;
            default:
                console.warn('onPluginRendered: Unknown plugin: ', pluginName);
                break;
        }
    };
    ViewFormLoader.prototype.withQuizTimer = function (timer) {
        this.quizTimer = timer;
        return this;
    };
    ViewFormLoader.prototype.getQuizTimer = function () {
        return this.quizTimer;
    };
    ViewFormLoader.prototype.getI18n = function () {
        return this.i18n || null;
    };
    ViewFormLoader.prototype.getFormTranslationsService = function () {
        return this.formTranslationsService || null;
    };
    ViewFormLoader.prototype.withUserId = function (userId) {
        this.userId = userId;
        return this;
    };
    ViewFormLoader.prototype.getUserId = function () {
        return this.userId;
    };
    ViewFormLoader.prototype.getCouponConfiguration = function () {
        return this.couponConfiguration || null;
    };
    ViewFormLoader.prototype.withCouponConfiguration = function (configuration) {
        this.couponConfiguration = configuration || null;
        return this;
    };
    ViewFormLoader.prototype.getLoaderType = function () {
        return EFormLoaderType.VIEW;
    };
    ViewFormLoader.prototype.withIsCaptchaSkipped = function (skipped) {
        this.captchaSkipped = !!skipped;
        return this;
    };
    ViewFormLoader.prototype.isCaptchaSkipped = function () {
        return this.captchaSkipped;
    };
    ViewFormLoader.prototype.clearControlValue = function (control) {
        try {
            var hash = control.getAttribute('data-hash'), element = this.engine.getDocument().getElementByHash(hash);
            if (element) {
                element.clearValue();
            }
        }
        catch (error) { }
    };
    ViewFormLoader.prototype.onHeaderDOMNodeTopPositionChanged = function (headerTopPosition) {
        if (headerTopPosition < 0) {
            this.engine.getForm().setAttribute('data-has-fixed-header', '');
        }
        else {
            this.engine.getForm().removeAttribute('data-has-fixed-header');
        }
    };
    ViewFormLoader.prototype.getSubmissionXMLDateTimeStart = function () {
        return this.submissionXMLDateTimeStart || null;
    };
    ViewFormLoader.prototype.withSubmissionXMLDateTimeStart = function (submissionXMLDateTimeStart) {
        this.submissionXMLDateTimeStart = submissionXMLDateTimeStart || null;
        return this;
    };
    ViewFormLoader.prototype.injectCouponCodeControlIntoFormIfNeeded = function () {
        if (!this.couponConfiguration) {
            return;
        }
        var couponCodeControl = this.engine.createElement(ElementTypes.CONTROL_TYPE_TEXT, undefined, this.engine.getDocument());
        couponCodeControl.getLabelDOMNode().setAttribute('data-i18n-text', 'textdef_42');
        couponCodeControl.setProperty('label.labelText', this.couponConfiguration.label);
        couponCodeControl.updateLabelText();
        this.engine.getDocument().withCouponCode(couponCodeControl);
        couponCodeControl.setAttached(true);
    };
    ViewFormLoader.prototype.withSubmissionId = function (submissionId) {
        this.submissionId = submissionId;
        return this;
    };
    ViewFormLoader.prototype.getSubmissionId = function () {
        return this.submissionId || null;
    };
    ViewFormLoader.prototype.withUsersList = function (usersList) {
        this.usersList = usersList;
        return this;
    };
    ViewFormLoader.prototype.getUsersList = function () {
        return this.usersList || null;
    };
    ViewFormLoader.prototype.withFormSettings = function (formSettings) {
        this.formSettings = formSettings;
        return this;
    };
    ViewFormLoader.prototype.getFormSettings = function () {
        return this.formSettings;
    };
    ViewFormLoader.prototype.withPreviewOnlyMode = function (previewOnlyMode) {
        previewOnlyMode = !!previewOnlyMode;
        if (previewOnlyMode === this.previewOnlyMode) {
            return this;
        }
        this.previewOnlyMode = previewOnlyMode;
        if (this.previewOnlyMode) {
            this.engine.getDocument().getRootNode().setAttribute('data-is-preview-mode', '');
        }
        else {
        }
        return this;
    };
    ViewFormLoader.prototype.isPreviewOnlyMode = function () {
        return this.previewOnlyMode;
    };
    ViewFormLoader.prototype.withDetailedInvoiceOptions = function (options) {
        this.detailedInvoiceOptions = options || null;
        return this;
    };
    ViewFormLoader.prototype.getDetailedInvoiceOptions = function () {
        return this.detailedInvoiceOptions || null;
    };
    ViewFormLoader.prototype.setupBodyDeviceAttribute = function () {
        if (BrowserDetector.meetsRequirements('* * mobile * *') === '') {
            document.body.setAttribute('data-device', 'mobile');
            var htmlNode = document.getElementsByTagName('html')[0];
            htmlNode.style.height = '100%';
            document.body.style.height = '100%';
        }
        else {
            document.body.setAttribute('data-device', 'desktop');
        }
    };
    ViewFormLoader.prototype.getWixAuthorizedRequestDetails = function () {
        return JSON.parse(JSON.stringify(this.wixAuthorizedRequestDetails || null));
    };
    ViewFormLoader.prototype.notifyWindowParentWithFormDimensions = function () {
        var _this = this;
        var widthInPixels = this.engine.getDocument().getProperty('options.widthInPixels'), widthInPercents = this.engine.getDocument().getProperty('options.widthInPercents'), formId = this.getFormId(), formWidthAsString = ((null === widthInPixels || widthInPixels < 1)
            ? ~~widthInPercents + '%'
            : ~~widthInPixels + 'px');
        try {
            window.parent.postMessage({ 'message_type': 'embedParams', 'message_content': { 'width': formWidthAsString, 'formId': formId } }, '*');
        }
        catch (e) { }
        setTimeout(function () {
            _this.jq(window).trigger('resize');
        }, 100);
    };
    ViewFormLoader.prototype.getGeolocationUserCountryCode = function () {
        return this.geolocationUserCountryCode;
    };
    ViewFormLoader.prototype.withGeolocationUserCountryCode = function (geolocationUserCountryCode) {
        this.geolocationUserCountryCode = geolocationUserCountryCode || null;
        return this;
    };
    ViewFormLoader.prototype.withWixAuthorizedRequestDetails = function (wixAuthorizedRequestDetails) {
        this.wixAuthorizedRequestDetails = wixAuthorizedRequestDetails || null;
        return this;
    };
    ViewFormLoader.prototype.getThemeStrategy = function () {
        return this.themeStrategy;
    };
    ViewFormLoader.prototype.withThemeStrategy = function (themeStrategy) {
        this.themeStrategy = themeStrategy;
        return this;
    };
    ViewFormLoader.prototype.getPreloadedExternalThemeProperties = function () {
        return JSON.parse(JSON.stringify(this.preloadedExternalThemeProperties));
    };
    ViewFormLoader.prototype.withPreloadedExternalThemeProperties = function (properties) {
        this.preloadedExternalThemeProperties = properties || null;
        return this;
    };
    ViewFormLoader.prototype.getDifferenceBetweenClientAndServerTime = function () {
        var serverUTCOffset = this.serverUTCOffset || 0;
        var clientUTCOffset = (new Date()).getTimezoneOffset() * -60;
        var absoluteOffset = Math.abs(clientUTCOffset - serverUTCOffset);
        return clientUTCOffset >= serverUTCOffset
            ? absoluteOffset
            : -absoluteOffset;
    };
    ViewFormLoader.prototype.withServerUTCOffset = function (offset) {
        this.serverUTCOffset = offset;
        return this;
    };
    ViewFormLoader.prototype.withUserFeatures = function (userFeatures) {
        this.userFeatures = userFeatures;
        if (userFeatures && userFeatures.allowIFrame) {
            SanitizeHTML.USER_HTML_TAGS.push('iframe');
        }
        return this;
    };
    ViewFormLoader.prototype.getViewFormContextAsString = function () {
        switch (this.getViewFormContext()) {
            case EViewFormContext.VIEW_FORM:
                return 'view-form';
            case EViewFormContext.EDIT_FORM:
                return 'edit-form';
            case EViewFormContext.EDIT_SUBMISSION:
                return 'edit-submission';
            case EViewFormContext.APPROVAL:
                return 'approval';
            case EViewFormContext.QUIZ:
                return 'quiz';
            case EViewFormContext.SAVE_FOR_LATER:
                return 'save-for-later';
            case EViewFormContext.PDF_EXPORT:
                return 'pdf-export';
            case EViewFormContext.EDIT_LATER:
                return 'edit-later';
            default:
                return '';
        }
    };
    ViewFormLoader.prototype.onFormRulesAreLoadedFirstTimePageLoads = function () {
        var _this = this;
        if (!document.body.hasAttribute('data-rules-are-loaded')) {
            this.rules.getDatabase().on('busy', function () {
                _this.rulesPageLoader.onLoadRequestStart();
            });
            this.rules.getDatabase().on('idle', function () {
                _this.rulesPageLoader.onLoadRequestEnd();
            });
        }
        document.body.setAttribute('data-rules-are-loaded', '');
    };
    ViewFormLoader.prototype.forceHiddenFieldsVisibilityInEditSubmissionMode = function () {
        if (this.viewFormContext !== EViewFormContext.EDIT_SUBMISSION) {
            return;
        }
        for (var items = this.engine.getDocument().getControlsList(), i = 0, len = items.length; i < len; i++) {
            items[i].setVisible(true);
        }
    };
    ViewFormLoader.prototype.getEngine = function () {
        return this.engine;
    };
    ViewFormLoader.prototype.getQuizScoreService = function () {
        return this.quizScoreService;
    };
    ViewFormLoader.prototype.withViewFormContextOptions = function (viewFormContextOptions) {
        this.viewFormContextOptions = viewFormContextOptions || null;
        return this;
    };
    ViewFormLoader.prototype.hideFormIfWeAreInAutoApproveContext = function () {
        if (this.viewFormContext === EViewFormContext.APPROVAL && this.viewFormContextOptions && this.viewFormContextOptions.autoSubmitApproval) {
            document.body.setAttribute('data-is-approval-auto-submit-enabled', '');
        }
    };
    ViewFormLoader.prototype.markSalesforceControlsWithDOMAttribute = function (salesforceAffectedControls, fieldType) {
        for (var i = 0, controlIds = salesforceAffectedControls || [], len = controlIds.length; i < len; i++) {
            var control = this.domAbstractionLayer.getControlInstanceById(controlIds[i]), rootNode = void 0;
            if (control && (rootNode = control.getRootNode())) {
                if (fieldType === 'trigger') {
                    rootNode.setAttribute('data-is-salesforce-prefill-trigger', '1');
                }
                else {
                    rootNode.setAttribute('data-is-salesforce-prefill-normal', '1');
                }
                var fields = rootNode.querySelectorAll('input, select, textarea');
                var controlHash = control.getHash();
                for (var i_2 = 0; i_2 < fields.length; i_2++) {
                    fields[i_2].setAttribute('id', controlHash + "-" + (i_2 + 1));
                    fields[i_2].setAttribute('autocomplete', 'off');
                }
            }
        }
    };
    ViewFormLoader.prototype.withControlsThatHaveRepeatablePathsAddedToPrefillValue = function (controlIds) {
        this.controlsThatHaveRepeatablePathsAddedToPrefillValue = controlIds;
        return this;
    };
    ViewFormLoader.prototype.getControlsThatHaveRepeatablePathsAddedToPrefillValue = function () {
        return this.controlsThatHaveRepeatablePathsAddedToPrefillValue;
    };
    ViewFormLoader.prototype.setControlsRelationships = function () {
        var _this = this;
        var distinct = function (value, index, self) {
            return self.indexOf(value) === index;
        };
        this.rulesData.map(function (e) {
            var match = e.expression.match(/(\d+){5,}/g);
            if (match) {
                var matches = match.map(function (el) {
                    return parseInt(el);
                });
                var uniqueMatches = matches.filter(distinct);
                var actionTarget = parseInt(e.action.target[0]);
                var actionType = e.action.type;
                var control = {
                    actionType: actionType,
                    target: actionTarget,
                    targetedBy: uniqueMatches
                };
                _this.controlRelationships.push(control);
            }
        });
    };
    ViewFormLoader.prototype.refreshCalculationForPreviouslyHiddenControl = function (args) {
        if (args === null) {
            return;
        }
        function search(key, searchableArray) {
            var result = null;
            for (var i = 0; i < searchableArray.length; i++) {
                if (searchableArray[i].target === key) {
                    result = searchableArray[i];
                }
            }
            return result;
        }
        if (args['visibility'] === true) {
            var targetedControl = search(args['controlId'], this.controlRelationships.filter(function (e) {
                return e.actionType === ERuleActionType.CALCULATE;
            }));
            if (targetedControl) {
                this.domAbstractionLayer.trigger('compute-single-control-rule', targetedControl);
            }
        }
    };
    ViewFormLoader.prototype.getAllowAutoSubmit = function () {
        return this.allowAutoSubmit;
    };
    ViewFormLoader.prototype.setAllowAutoSubmit = function (autoSubmit) {
        this.allowAutoSubmit = autoSubmit;
    };
    ViewFormLoader.prototype.checkFormHasPaymentProcessor = function () {
        return (this.paymentProcessors && this.paymentProcessors.length > 0) || this.engine.getDocument().getConfiguration().getProperty('isPaymentEnabled');
    };
    ViewFormLoader.prototype.createLoader = function (loaderText) {
        var _this = this;
        if (loaderText === void 0) { loaderText = this.i18n.translateText('loading_pleaseWait'); }
        if (this.form && !this.loaderTarget) {
            this.loaderTarget = this.form;
            if (this.loaderNode) {
                this.form.appendChild(this.loaderNode);
                this.form.dataset['hasLoader'] = "1";
                return;
            }
            this.loaderNode = document.createElement('div');
            this.loaderNode.classList.add('loader-container');
            this.form.dataset['hasLoader'] = "1";
            this.form.appendChild(this.loaderNode);
            this.engine.getResourceManager().get('/modules/Typescript/Form/resources/preloader.html')
                .then(function (templateText) {
                var model = {
                    formHeader: _this.engine.getDocument().getHeader().getProperty('configuration.innerHTML') || '',
                    loaderText: loaderText
                };
                var template = new Salvage(templateText);
                _this.loaderNode.innerHTML = template.parse(model);
            }).fail(function (e) {
                _this.hideLoader();
            });
        }
    };
    ViewFormLoader.prototype.hideLoader = function () {
        if (this.loaderTarget && this.loaderNode && this.loaderTarget.contains(this.loaderNode)) {
            this.loaderTarget.removeChild(this.loaderNode);
            delete this.loaderTarget.dataset['hasLoader'];
            this.loaderTarget = null;
        }
    };
    return ViewFormLoader;
}(EventEmitter));
var MouseUtils = (function () {
    function MouseUtils() {
    }
    MouseUtils.getMouseButtonFromEvent = function (e) {
        if (this.isSafariOnMac) {
            return e.which;
        }
        else {
            return e.buttons;
        }
    };
    MouseUtils.init = function () {
        this.isSafariOnMac = BrowserDetector.meetsRequirements('mac * desktop safari *') === '';
        this.mobileOnAndroid = BrowserDetector.meetsRequirements('android * * * *') === '';
        if (BrowserDetector.meetsRequirements('* * mobile * *') === '') {
            this.mobile = true;
        }
        else {
            this.mobile = false;
        }
    };
    MouseUtils.isMobile = function () {
        return this.mobile;
    };
    MouseUtils.isAndroid = function () {
        return this.mobileOnAndroid;
    };
    MouseUtils.setCanMakeResize = function (value) {
        this._canMakeResize = value;
    };
    Object.defineProperty(MouseUtils, "canMakeResize", {
        get: function () {
            return this._canMakeResize;
        },
        enumerable: true,
        configurable: true
    });
    MouseUtils._canMakeResize = true;
    return MouseUtils;
}());
MouseUtils.init();
var MouseManager = (function (_super) {
    __extends(MouseManager, _super);
    function MouseManager(jq, formDOMNode, document) {
        var _this = _super.call(this) || this;
        _this.plugins = [];
        _this.autoScrollDirection = null;
        _this.autoScrollInterval = 0;
        _this.headerHeight = 0;
        _this.pageHeight = 0;
        _this.jq = jq;
        _this.rootNode = formDOMNode;
        _this.document = document;
        _this.operationType = EEditorMouseOperationType.NONE;
        _this.plugins.push(new MousePluginIdleState(_this.jq, _this.document, _this));
        _this.plugins.push(new MousePluginElementResize(_this.jq, _this.document, _this));
        _this.plugins.push(new MousePluginLabelResize(_this.jq, _this.document, _this));
        _this.plugins.push(new MousePluginDragAndDrop(_this.jq, _this.document, _this));
        _this.plugins.push(new MousePluginAreaSelect(_this.jq, _this.document, _this));
        _this.initAutoScrollingEngine();
        _this.init();
        return _this;
    }
    MouseManager.prototype.initAutoScrollingEngine = function () {
        var _this = this;
        this.scroller = document.createElement('div');
        this.scroller.setAttribute('data-role', 'mousemanager-scroller-helper');
        this.scrollJoystickUp = document.createElement('div');
        this.scrollJoystickUp.setAttribute('data-role', 'mousemanager-scroller-joystick-up');
        this.scrollJoystickDown = document.createElement('div');
        this.scrollJoystickDown.setAttribute('data-role', 'mousemanager-scroller-joystick-down');
        document.body.appendChild(this.scroller);
        document.body.appendChild(this.scrollJoystickUp);
        document.body.appendChild(this.scrollJoystickDown);
        this.jq(this.scrollJoystickUp).on('mouseenter', function () {
            _this.autoScrollDirection = EElementEdge.TOP;
        });
        this.jq(this.scrollJoystickUp).on('mouseleave', function () {
            _this.autoScrollDirection = null;
        });
        this.jq(this.scrollJoystickDown).on('mouseenter', function () {
            _this.autoScrollDirection = EElementEdge.BOTTOM;
        });
        this.jq(this.scrollJoystickDown).on('mouseleave', function () {
            _this.autoScrollDirection = null;
        });
    };
    MouseManager.prototype.startAutoscrollInterval = function () {
        var _this = this;
        if (!this.autoScrollInterval) {
            this.autoScrollInterval = setInterval(function () {
                if (_this.operationType !== EEditorMouseOperationType.NONE && null !== _this.autoScrollDirection) {
                    if (_this.autoScrollDirection === EElementEdge.TOP) {
                        _this.scrollUp();
                    }
                    else {
                        if (_this.autoScrollDirection === EElementEdge.BOTTOM) {
                            _this.scrollDown();
                        }
                    }
                }
            }, 100);
        }
    };
    MouseManager.prototype.stopAutoScrollInterval = function () {
        clearInterval(this.autoScrollInterval);
        this.autoScrollInterval = 0;
    };
    MouseManager.prototype.init = function () {
        (function (self, $) {
            document.body.addEventListener('mousemove', function (e) {
                for (var i = 0, len = self.plugins.length; i < len; i++) {
                    if (self.plugins[i].canBeExecutedWhenOperationTypeIs(self.operationType, EMouseEventType.MOUSE_MOVE, e)) {
                        if (self.plugins[i].handleMouseMove(e)) {
                            break;
                        }
                    }
                }
                if (self.operationType !== EEditorMouseOperationType.NONE) {
                    self.scroller.style.top = e.pageY + self.getScrollPosition() - self.headerHeight + "px";
                }
            }, true);
            document.body.addEventListener('mousedown', function (e) {
                for (var i = 0, len = self.plugins.length; i < len; i++) {
                    if (self.plugins[i].canBeExecutedWhenOperationTypeIs(self.operationType, EMouseEventType.MOUSE_DOWN, e)) {
                        if (self.plugins[i].handleMouseDown(e)) {
                            break;
                        }
                    }
                }
            }, true);
            document.body.addEventListener('mouseup', function (e) {
                for (var i = 0, len = self.plugins.length; i < len; i++) {
                    if (self.plugins[i].canBeExecutedWhenOperationTypeIs(self.operationType, EMouseEventType.MOUSE_UP, e)) {
                        if (self.plugins[i].handleMouseUp(e)) {
                            break;
                        }
                    }
                }
            }, true);
            document.body.addEventListener('scroll', function (e) {
                for (var i = 0, len = self.plugins.length; i < len; i++) {
                    self.plugins[i].handleDocumentBodyScroll(e);
                }
            }, true);
            window.addEventListener('scroll', function (e) {
                for (var i = 0, len = self.plugins.length; i < len; i++) {
                    self.plugins[i].handleDocumentBodyScroll(e);
                }
            }, true);
            window.addEventListener('keydown', function (e) {
                var code = e.keyCode || e.charCode;
                if (code !== 27 || self.operationType === EEditorMouseOperationType.NONE) {
                    return;
                }
                for (var i = 0, len = self.plugins.length; i < len; i++) {
                    if (self.plugins[i].canBeExecutedWhenOperationTypeIs(self.operationType, EMouseEventType.MOUSE_MOVE, e)) {
                        self.plugins[i].abortOperation();
                    }
                }
            }, false);
        })(this, this.jq);
    };
    MouseManager.prototype.setCurrentOperationType = function (operationType, additionalBodyElementAttributes) {
        if (additionalBodyElementAttributes === void 0) { additionalBodyElementAttributes = null; }
        var trigger = false, previousOperationType = this.operationType;
        if (this.operationType !== operationType) {
            trigger = true;
        }
        if (null !== additionalBodyElementAttributes) {
            for (var elementAttributeName in additionalBodyElementAttributes) {
                if (additionalBodyElementAttributes.hasOwnProperty(elementAttributeName)) {
                    document.body.setAttribute(elementAttributeName, additionalBodyElementAttributes[elementAttributeName]);
                }
            }
        }
        else {
            document.body.removeAttribute('data-drag-direction');
        }
        this.operationType = operationType;
        if (this.operationType === EEditorMouseOperationType.NONE) {
            this.scroller.style.display
                = this.scrollJoystickUp.style.display
                    = this.scrollJoystickDown.style.display = 'none';
            this.stopAutoScrollInterval();
        }
        else {
            try {
                this.headerHeight = this.document.getForm().getEngine().getLoader()
                    .getLoaderDependency(ELoaderDependency.EDITOR_HEADER).getDOMNode().offsetHeight;
            }
            catch (e) {
                this.headerHeight = 0;
            }
            this.pageHeight = this.getPageHeight();
            this.scroller.style.display = 'block';
            if (this.operationType === EEditorMouseOperationType.DRAG) {
                this.scrollJoystickUp.style.display = this.scrollJoystickDown.style.display = 'block';
            }
            this.startAutoscrollInterval();
        }
        switch (this.operationType) {
            case EEditorMouseOperationType.DRAG:
                document.body.setAttribute('data-mouse-gesture-type', 'drag');
                if (trigger) {
                    this.trigger('drag-start');
                }
                break;
            case EEditorMouseOperationType.LABEL_RESIZE:
                document.body.setAttribute('data-mouse-gesture-type', 'label-resize');
                if (trigger) {
                    this.trigger('label-resize-start');
                }
                break;
            case EEditorMouseOperationType.ELEMENT_RESIZE:
                if (trigger) {
                    this.trigger('resize-start');
                }
                document.body.setAttribute('data-mouse-gesture-type', 'element-resize');
                break;
            case EEditorMouseOperationType.SELECT:
                if (trigger) {
                    this.trigger('select-start');
                }
                document.body.setAttribute('data-mouse-gesture-type', 'select');
                break;
            case EEditorMouseOperationType.NONE:
            default:
                document.body.removeAttribute('data-mouse-gesture-type');
                switch (previousOperationType) {
                    case EEditorMouseOperationType.DRAG:
                        if (trigger) {
                            this.trigger('drag-end');
                            this.document.trigger('change');
                        }
                        break;
                    case EEditorMouseOperationType.LABEL_RESIZE:
                        if (trigger) {
                            this.trigger('label-resize-end');
                        }
                        break;
                    case EEditorMouseOperationType.ELEMENT_RESIZE:
                        if (trigger) {
                            this.trigger('resize-end');
                        }
                        break;
                    case EEditorMouseOperationType.SELECT:
                        if (trigger) {
                            this.trigger('select-end');
                        }
                        break;
                    default:
                        break;
                }
                break;
        }
    };
    MouseManager.prototype.getOperationTypeName = function (operationType) {
        switch (operationType) {
            case EEditorMouseOperationType.NONE:
                return 'none';
            case EEditorMouseOperationType.ELEMENT_RESIZE:
                return 'element-resize';
            case EEditorMouseOperationType.DRAG:
                return 'drag';
            case EEditorMouseOperationType.LABEL_RESIZE:
                return 'label-resize';
            case EEditorMouseOperationType.SELECT:
                return 'select';
            default:
                return JSON.stringify(operationType || null);
        }
    };
    MouseManager.prototype.getPageHeight = function () {
        return this.document.getRootNode().getBoundingClientRect().height;
    };
    MouseManager.prototype.getScrollPosition = function () {
        return -(this.document.getRootNode().getBoundingClientRect().top - this.headerHeight);
    };
    MouseManager.prototype.scrollDown = function () {
        var purposedScrollToPosition = parseInt(this.scroller.style.top) + 20;
        if (purposedScrollToPosition > this.pageHeight) {
            purposedScrollToPosition = this.pageHeight;
        }
        this.scroller.style.top = purposedScrollToPosition + "px";
        this.scroller.scrollIntoView(false);
    };
    MouseManager.prototype.scrollUp = function () {
        this.scroller.style.top = parseInt(this.scroller.style.top) - 20 + "px";
        this.scroller.scrollIntoView(true);
    };
    return MouseManager;
}(EventEmitter));
var MousePluginIdleState = (function () {
    function MousePluginIdleState(jq, document, manager) {
        this.jq = jq;
        this.document = document;
        this.manager = manager;
    }
    MousePluginIdleState.prototype.canBeExecutedWhenOperationTypeIs = function (operationType, inEventPhase, forEvent) {
        return false;
    };
    MousePluginIdleState.prototype.handleMouseMove = function (e) {
        return false;
    };
    MousePluginIdleState.prototype.handleMouseDown = function (e) {
        return false;
    };
    MousePluginIdleState.prototype.handleMouseUp = function (e) {
        return false;
    };
    MousePluginIdleState.prototype.handleDocumentBodyScroll = function () {
    };
    MousePluginIdleState.prototype.abortOperation = function () {
    };
    return MousePluginIdleState;
}());
var MousePluginElementResize = (function () {
    function MousePluginElementResize(jq, document, manager) {
        this.isResizing = false;
        this.targetEdgeThatIsResizing = null;
        this.visualResizerHandleElement = null;
        this.initialMouseCoordinatesWhenDragStarted = {
            left: 0,
            top: 0,
        };
        this.jq = jq;
        this.document = document;
        this.manager = manager;
        this.targetElementThatIsResizing = null;
        this.targetEdgeThatIsResizing = null;
        this.visualResizerHandleElement = window.document.createElement('div');
        this.visualResizerHandleElement.setAttribute('data-role', 'mouse-resizer');
        this.init();
    }
    MousePluginElementResize.prototype.canBeExecutedWhenOperationTypeIs = function (operationType, inEventPhase, forEvent) {
        switch (operationType) {
            case EEditorMouseOperationType.NONE:
                if (!forEvent.shiftKey && (inEventPhase === EMouseEventType.MOUSE_MOVE || inEventPhase === EMouseEventType.MOUSE_DOWN)) {
                    return true;
                }
                break;
            case EEditorMouseOperationType.ELEMENT_RESIZE:
                return true;
        }
        return false;
    };
    MousePluginElementResize.prototype.handleMouseMove = function (e) {
        if (this.isResizing) {
            if (EMouseButton.LEFT !== MouseUtils.getMouseButtonFromEvent(e)) {
                this.abortOperation();
                return false;
            }
            else {
                return this.handleMouseMoveWhenResizingIsActive(e);
            }
        }
        else {
            return this.handleMouseMoveWhenResizingIsInactive(e);
        }
    };
    MousePluginElementResize.prototype.handleMouseDown = function (e) {
        var elementTarget = (e.target || e.srcElement);
        if (null === this.targetEdgeThatIsResizing
            || null === this.targetElementThatIsResizing
            || this.isResizing
            || !this.jq(elementTarget).is('#form [data-role=page] > [data-role=mouse-resizer]')) {
            return false;
        }
        this.isResizing = true;
        this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.UNDO_SERVICE).trigger('user-action', 'resize-start');
        this.initialMouseCoordinatesWhenDragStarted.left = e.clientX;
        this.initialMouseCoordinatesWhenDragStarted.top = e.clientY;
        switch (this.targetEdgeThatIsResizing) {
            case EElementEdge.TOP:
            case EElementEdge.BOTTOM:
                this.manager.setCurrentOperationType(EEditorMouseOperationType.ELEMENT_RESIZE, {
                    'data-drag-direction': 'vertical',
                });
                break;
            case EElementEdge.LEFT:
            case EElementEdge.RIGHT:
                this.manager.setCurrentOperationType(EEditorMouseOperationType.ELEMENT_RESIZE, {
                    'data-drag-direction': 'horizontal',
                });
                break;
            default:
                this.manager.setCurrentOperationType(EEditorMouseOperationType.ELEMENT_RESIZE);
                break;
        }
        return true;
    };
    MousePluginElementResize.prototype.handleMouseUp = function (e) {
        var elementTarget = (e.target || e.srcElement);
        if (this.isResizing) {
            if (this.targetElementThatIsResizing.getTypeId() === ElementTypes.CONTAINER_TYPE_DIV
                && this.targetElementThatIsResizing.getColspan() === this.targetElementThatIsResizing.getParentPage().getColspan()) {
                this.targetElementThatIsResizing.unwrap();
            }
            this.cancelTheResizingMechanism();
            this.manager.setCurrentOperationType(EEditorMouseOperationType.NONE);
            var trackedEventName = null;
            console.log(elementTarget);
            var targetDataRole = elementTarget.attributes['data-role'];
            if (targetDataRole && targetDataRole.value === 'control') {
                if (elementTarget.attributes['data-type']) {
                    trackedEventName = elementTarget.attributes['data-type'].value;
                }
            }
            if (targetDataRole && targetDataRole.value === 'container') {
                if (elementTarget.childNodes.length > 0) {
                    if (elementTarget.childNodes[0].attributes['data-type']) {
                        trackedEventName = elementTarget.childNodes[0].attributes['data-type'].value;
                    }
                }
            }
            this.document.getEngine().getLoader().execCommand('track-event', 'control_resize_' + trackedEventName);
            this.document.getEngine().getLoader().execCommand('track-event', 'control_resize_element_' + trackedEventName);
            this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.UNDO_SERVICE).trigger('user-action', 'resize-end');
            return true;
        }
        return false;
    };
    MousePluginElementResize.prototype.handleMouseMoveWhenResizingIsActive = function (e) {
        var delta = 0, currentMouseCoordidates = {
            left: e.clientX,
            top: e.clientY,
        };
        switch (this.targetEdgeThatIsResizing) {
            case EElementEdge.TOP:
                delta = currentMouseCoordidates.top - this.initialMouseCoordinatesWhenDragStarted.top;
                break;
            case EElementEdge.RIGHT:
                delta = this.initialMouseCoordinatesWhenDragStarted.left - currentMouseCoordidates.left;
                break;
            case EElementEdge.BOTTOM:
                delta = this.initialMouseCoordinatesWhenDragStarted.top - currentMouseCoordidates.top;
                break;
            case EElementEdge.LEFT:
                delta = currentMouseCoordidates.left - this.initialMouseCoordinatesWhenDragStarted.left;
                break;
        }
        var currentElementColspan = this.targetElementThatIsResizing.getColspan(), currentElementHeight = this.targetElementThatIsResizing.getHeight();
        this.document.getEngine().getLoader().execCommand('resize-element', this.targetElementThatIsResizing, this.targetEdgeThatIsResizing, delta);
        if (currentElementColspan !== this.targetElementThatIsResizing.getColspan() || currentElementHeight !== this.targetElementThatIsResizing.getHeight()) {
            this.handleResizingInitialization(this.targetElementThatIsResizing.getRootNode(), e, this.targetEdgeThatIsResizing);
            this.isResizing = true;
            var resizerClientRect = this.visualResizerHandleElement.getBoundingClientRect();
            this.initialMouseCoordinatesWhenDragStarted.left = resizerClientRect.left + ~~(resizerClientRect.width / 2);
            this.initialMouseCoordinatesWhenDragStarted.top = resizerClientRect.top + ~~(resizerClientRect.height / 2);
        }
        e.stopPropagation();
        e.preventDefault();
        return true;
    };
    MousePluginElementResize.prototype.handleMouseMoveWhenResizingIsInactive = function (e) {
        var eventTarget = (e.target || e.srcElement || null);
        if (!MouseUtils.canMakeResize || eventTarget === null) {
            return false;
        }
        return this.handleResizingInitialization(eventTarget, e);
    };
    MousePluginElementResize.prototype.handleResizingInitialization = function (eventTarget, e, forceEdge) {
        return (function ($, self, eventTarget) {
            try {
                var elementAbsolutePositionOnScreen_1 = (function (rect) {
                    return {
                        left: rect.left,
                        right: rect.right,
                        top: rect.top,
                        bottom: rect.bottom,
                        width: rect.width,
                        height: rect.height
                    };
                })(eventTarget.getBoundingClientRect()), elementHash = $(eventTarget).closest('[data-hash]').attr('data-hash'), pageHash = $('[data-role=page]').attr('data-hash');
                if (!elementHash || pageHash == elementHash) {
                    return false;
                }
                var mouseAbsolutePositionOnScreen_1 = {
                    left: e.clientX,
                    top: e.clientY,
                }, targetElementThatIsResizing = (function (hash) {
                    var result = self.document.getElementByHash(hash), parentContainer = result.getFirstParentContainer(), isFirstChild, isLastChild, modifiedElementAbsolutePositionOnScreen;
                    if (parentContainer && parentContainer.getTypeId()) {
                        if (parentContainer.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP) {
                            return result;
                        }
                        isFirstChild = result.getParent().getFirstChild() === result;
                        isLastChild = result.getParent().getLastChild() === result;
                        if (isFirstChild || isLastChild) {
                            modifiedElementAbsolutePositionOnScreen = (function (rect) {
                                return {
                                    left: rect.left,
                                    right: rect.right,
                                    top: rect.top,
                                    bottom: rect.bottom,
                                    width: rect.width,
                                    height: rect.height
                                };
                            })(parentContainer.getRootNode().getBoundingClientRect());
                            switch (true) {
                                case isFirstChild && forceEdge === EElementEdge.LEFT:
                                case isLastChild && forceEdge === EElementEdge.RIGHT:
                                    eventTarget = parentContainer.getRootNode();
                                    elementAbsolutePositionOnScreen_1 = modifiedElementAbsolutePositionOnScreen;
                                    break;
                                case isFirstChild && isLastChild:
                                    if (MousePluginElementResize.DISTANCE_HORIZONTAL_PRIORITY * (mouseAbsolutePositionOnScreen_1.left - elementAbsolutePositionOnScreen_1.left) <= 8) {
                                        eventTarget = parentContainer.getRootNode();
                                        elementAbsolutePositionOnScreen_1 = modifiedElementAbsolutePositionOnScreen;
                                    }
                                    else if (MousePluginElementResize.DISTANCE_HORIZONTAL_PRIORITY * ((elementAbsolutePositionOnScreen_1.left + elementAbsolutePositionOnScreen_1.width) - mouseAbsolutePositionOnScreen_1.left) <= 8) {
                                        eventTarget = parentContainer.getRootNode();
                                        elementAbsolutePositionOnScreen_1 = modifiedElementAbsolutePositionOnScreen;
                                    }
                                    else {
                                        parentContainer = null;
                                    }
                                    break;
                                case isFirstChild:
                                    if (MousePluginElementResize.DISTANCE_HORIZONTAL_PRIORITY * (mouseAbsolutePositionOnScreen_1.left - elementAbsolutePositionOnScreen_1.left) <= 8) {
                                        eventTarget = parentContainer.getRootNode();
                                        elementAbsolutePositionOnScreen_1 = modifiedElementAbsolutePositionOnScreen;
                                    }
                                    else {
                                        parentContainer = null;
                                    }
                                    break;
                                case isLastChild:
                                    if (MousePluginElementResize.DISTANCE_HORIZONTAL_PRIORITY * ((elementAbsolutePositionOnScreen_1.left + elementAbsolutePositionOnScreen_1.width) - mouseAbsolutePositionOnScreen_1.left) <= 8) {
                                        eventTarget = parentContainer.getRootNode();
                                        elementAbsolutePositionOnScreen_1 = modifiedElementAbsolutePositionOnScreen;
                                    }
                                    else {
                                        parentContainer = null;
                                    }
                                    break;
                                default:
                                    parentContainer = null;
                            }
                        }
                        else {
                            parentContainer = null;
                        }
                    }
                    return parentContainer || result;
                })(elementHash), distanceToElementEdges = [
                    {
                        edge: EElementEdge.RIGHT,
                        distance: MousePluginElementResize.DISTANCE_HORIZONTAL_PRIORITY * ((elementAbsolutePositionOnScreen_1.left + elementAbsolutePositionOnScreen_1.width) - mouseAbsolutePositionOnScreen_1.left),
                    },
                    {
                        edge: EElementEdge.BOTTOM,
                        distance: MousePluginElementResize.DISTANCE_VERTICAL_PRIORITY * ((elementAbsolutePositionOnScreen_1.top + elementAbsolutePositionOnScreen_1.height) - mouseAbsolutePositionOnScreen_1.top),
                    },
                    {
                        edge: EElementEdge.LEFT,
                        distance: MousePluginElementResize.DISTANCE_HORIZONTAL_PRIORITY * (mouseAbsolutePositionOnScreen_1.left - elementAbsolutePositionOnScreen_1.left),
                    }
                ], targetEdgeThatIsResizing = void 0;
                if (undefined === forceEdge) {
                    distanceToElementEdges.sort(function (a, b) {
                        return a.distance - b.distance;
                    });
                    targetEdgeThatIsResizing = distanceToElementEdges[0].edge;
                    if (distanceToElementEdges[0].distance > 10) {
                        if (targetElementThatIsResizing.getTypeId() === ElementTypes.CONTROL_TYPE_LIKERT_SCALE
                            || targetElementThatIsResizing.getTypeId() === ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER) {
                            return false;
                        }
                        targetEdgeThatIsResizing = self.getDefaultTargetEdge(targetElementThatIsResizing);
                    }
                }
                else {
                    targetEdgeThatIsResizing = forceEdge;
                }
                var resizingCapabilityOfTheElement = targetElementThatIsResizing.getResizingCapability();
                switch (targetEdgeThatIsResizing) {
                    case EElementEdge.TOP:
                        if (resizingCapabilityOfTheElement !== EResizingCapability.TOP_ONLY && resizingCapabilityOfTheElement !== EResizingCapability.TOP_AND_BOTTOM && resizingCapabilityOfTheElement !== EResizingCapability.ALL) {
                            self.cancelTheResizingMechanism();
                            return false;
                        }
                        break;
                    case EElementEdge.RIGHT:
                        if (resizingCapabilityOfTheElement !== EResizingCapability.RIGHT_ONLY && resizingCapabilityOfTheElement !== EResizingCapability.LEFT_AND_RIGHT && resizingCapabilityOfTheElement !== EResizingCapability.ALL) {
                            self.cancelTheResizingMechanism();
                            return false;
                        }
                        break;
                    case EElementEdge.BOTTOM:
                        if (resizingCapabilityOfTheElement !== EResizingCapability.BOTTOM_ONLY && resizingCapabilityOfTheElement !== EResizingCapability.TOP_AND_BOTTOM && resizingCapabilityOfTheElement !== EResizingCapability.ALL) {
                            self.cancelTheResizingMechanism();
                            return false;
                        }
                        break;
                    case EElementEdge.LEFT:
                        if (resizingCapabilityOfTheElement !== EResizingCapability.LEFT_ONLY && resizingCapabilityOfTheElement !== EResizingCapability.LEFT_AND_RIGHT && resizingCapabilityOfTheElement !== EResizingCapability.ALL) {
                            self.cancelTheResizingMechanism();
                            return false;
                        }
                        break;
                }
                switch (targetEdgeThatIsResizing) {
                    case EElementEdge.TOP:
                        self.visualResizerHandleElement.setAttribute('data-resizer-orientation', 'horizontal');
                        self.visualResizerHandleElement.setAttribute('data-target-edge', 'top');
                        self.visualResizerHandleElement.style.top = elementAbsolutePositionOnScreen_1.top + "px";
                        self.visualResizerHandleElement.style.left = elementAbsolutePositionOnScreen_1.left + "px";
                        self.visualResizerHandleElement.style.width = elementAbsolutePositionOnScreen_1.width + "px";
                        self.visualResizerHandleElement.style.height = '';
                        break;
                    case EElementEdge.RIGHT:
                        self.visualResizerHandleElement.setAttribute('data-resizer-orientation', 'vertical');
                        self.visualResizerHandleElement.setAttribute('data-target-edge', 'right');
                        self.visualResizerHandleElement.style.top = elementAbsolutePositionOnScreen_1.top + "px";
                        self.visualResizerHandleElement.style.left = elementAbsolutePositionOnScreen_1.right + "px";
                        self.visualResizerHandleElement.style.height = elementAbsolutePositionOnScreen_1.height + "px";
                        self.visualResizerHandleElement.style.width = '';
                        break;
                    case EElementEdge.BOTTOM:
                        self.visualResizerHandleElement.setAttribute('data-resizer-orientation', 'horizontal');
                        self.visualResizerHandleElement.setAttribute('data-target-edge', 'bottom');
                        self.visualResizerHandleElement.style.top = elementAbsolutePositionOnScreen_1.bottom + "px";
                        self.visualResizerHandleElement.style.left = elementAbsolutePositionOnScreen_1.left + "px";
                        self.visualResizerHandleElement.style.width = elementAbsolutePositionOnScreen_1.width + "px";
                        self.visualResizerHandleElement.style.height = '';
                        break;
                    case EElementEdge.LEFT:
                        self.visualResizerHandleElement.setAttribute('data-resizer-orientation', 'vertical');
                        self.visualResizerHandleElement.setAttribute('data-target-edge', 'left');
                        self.visualResizerHandleElement.style.top = elementAbsolutePositionOnScreen_1.top + "px";
                        self.visualResizerHandleElement.style.left = elementAbsolutePositionOnScreen_1.left + "px";
                        self.visualResizerHandleElement.style.height = elementAbsolutePositionOnScreen_1.height + "px";
                        self.visualResizerHandleElement.style.width = '';
                        break;
                }
                self.setResizingMechanismTarget(targetElementThatIsResizing, targetEdgeThatIsResizing);
            }
            catch (e) {
                self.document.normalize();
            }
        })(this.jq, this, eventTarget);
    };
    MousePluginElementResize.prototype.cancelTheResizingMechanism = function () {
        if (this.visualResizerHandleElement.parentNode) {
            this.visualResizerHandleElement.parentNode.removeChild(this.visualResizerHandleElement);
        }
        this.targetElementThatIsResizing = null;
        this.targetEdgeThatIsResizing = null;
        this.isResizing = false;
        document.body.removeAttribute('data-drag-direction');
    };
    MousePluginElementResize.prototype.setResizingMechanismTarget = function (element, edge) {
        var elementOwnerPage;
        if (this.visualResizerHandleElement.parentNode !== (elementOwnerPage = element.getParentPage().getRootNode())) {
            if (elementOwnerPage) {
                elementOwnerPage.appendChild(this.visualResizerHandleElement);
            }
            else {
                if (this.visualResizerHandleElement.parentNode) {
                    this.visualResizerHandleElement.parentNode.removeChild(this.visualResizerHandleElement);
                }
            }
        }
        this.targetElementThatIsResizing = element;
        this.targetEdgeThatIsResizing = edge;
        this.isResizing = false;
    };
    MousePluginElementResize.prototype.handleDocumentBodyScroll = function () {
        this.cancelTheResizingMechanism();
    };
    MousePluginElementResize.prototype.init = function () {
        (function (self) {
            self.manager.on('resize-end', function () {
                try {
                    self.document.normalize();
                    console.log('resize: normalization completed');
                }
                catch (e) {
                    console.warn('Failed to perform document normalization after resize operation completed');
                    throw e;
                }
            });
        })(this);
    };
    MousePluginElementResize.prototype.abortOperation = function () {
        this.cancelTheResizingMechanism();
        this.manager.setCurrentOperationType(EEditorMouseOperationType.NONE);
    };
    MousePluginElementResize.prototype.getDefaultTargetEdge = function (targetElementThatIsResizing) {
        var elementTypeId = targetElementThatIsResizing.getTypeId(), textDirection = targetElementThatIsResizing.getForm().getProperty('options.direction'), labelPlacement = targetElementThatIsResizing.getForm().getProperty('options.labelPlacement');
        if (labelPlacement === EFormLabelPlacement.TOP_ALIGNED && textDirection === EFormTextDirection.RIGHT_TO_LEFT) {
            return EElementEdge.LEFT;
        }
        switch (elementTypeId) {
            case ElementTypes.CONTROL_TYPE_FORM_HEADER:
            case ElementTypes.CONTROL_TYPE_HEADING:
            case ElementTypes.CONTAINER_TYPE_REPEATABLE_GROUP:
            case ElementTypes.CONTAINER_TYPE_REPEATABLE:
            case ElementTypes.CONTROL_TYPE_HTML_BLOCK:
            case ElementTypes.CONTROL_TYPE_SIGNATURE:
            case ElementTypes.CONTROL_TYPE_WIDGET_PDF:
            case ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK:
            case ElementTypes.CONTROL_TYPE_IMAGE:
            case ElementTypes.CONTROL_TYPE_WIDGET_VIDEO:
            case ElementTypes.CONTROL_TYPE_SOCIAL:
                switch (textDirection) {
                    case EFormTextDirection.RIGHT_TO_LEFT:
                        return EElementEdge.LEFT;
                    case EFormTextDirection.LEFT_TO_RIGHT:
                    default:
                        return EElementEdge.RIGHT;
                }
            default:
                var elementRendererType = targetElementThatIsResizing.getRendererType();
                switch (elementRendererType) {
                    case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL:
                    case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD:
                        return EElementEdge.LEFT;
                    case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL:
                    case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD:
                    case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL:
                    case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD:
                    case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                    case EElementRendererType.LABEL_PLACEMENT_TOP_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
                    case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                    case EElementRendererType.LABEL_PLACEMENT_LEFT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
                    case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_LABEL_COMPACT_FIELD:
                    case EElementRendererType.LABEL_PLACEMENT_RIGHT_INSTRUCTIONS_BELOW_FIELD_COMPACT_FIELD:
                    case EElementRendererType.CUSTOM_CONTROL_RENDERER:
                    default:
                        try {
                            if (labelPlacement === EFormLabelPlacement.RIGHT_ALIGNED
                                && targetElementThatIsResizing.getProperty('label.isCompactField')
                                && textDirection === EFormTextDirection.RIGHT_TO_LEFT) {
                                return EElementEdge.LEFT;
                            }
                        }
                        catch (e) { }
                        return EElementEdge.RIGHT;
                }
        }
    };
    MousePluginElementResize.DISTANCE_VERTICAL_PRIORITY = 1;
    MousePluginElementResize.DISTANCE_HORIZONTAL_PRIORITY = 1;
    return MousePluginElementResize;
}());
var MousePluginLabelResize = (function () {
    function MousePluginLabelResize(jq, document, manager) {
        this.initialMouseCoordinatesWhenDragStarted = {
            left: 0,
            top: 0,
        };
        this.jq = jq;
        this.document = document;
        this.manager = manager;
        this.visualResizerHandleElement = window.document.createElement('div');
        this.visualResizerHandleElement.setAttribute('data-role', 'label-resizer');
    }
    MousePluginLabelResize.prototype.canBeExecutedWhenOperationTypeIs = function (operationType, inEventPhase, forEvent) {
        switch (operationType) {
            case EEditorMouseOperationType.NONE:
                if (!forEvent.shiftKey && (inEventPhase === EMouseEventType.MOUSE_MOVE || inEventPhase === EMouseEventType.MOUSE_DOWN)) {
                    return true;
                }
                break;
            case EEditorMouseOperationType.LABEL_RESIZE:
                return true;
        }
        return false;
    };
    MousePluginLabelResize.prototype.handleMouseMove = function (e) {
        if (this.isResizing) {
            if (EMouseButton.LEFT !== MouseUtils.getMouseButtonFromEvent(e)) {
                this.abortOperation();
                return false;
            }
            else {
                return this.handleMouseMoveWhenResizingIsActive(e);
            }
        }
        else {
            return this.handleMouseMoveWhenResizingIsInactive(e);
        }
    };
    MousePluginLabelResize.prototype.handleMouseMoveWhenResizingIsActive = function (e) {
        var currentMouseCoordidates = {
            left: e.clientX,
            top: e.clientY,
        }, isLabelLeftAligned = EFormLabelPlacement.LEFT_ALIGNED === this.document.getLabelPlacement()
            || this.targetElementThatIsResizing.getRenderedLabelPlacement() === EFormLabelPlacement.LEFT_ALIGNED, delta = isLabelLeftAligned
            ? currentMouseCoordidates.left - this.initialMouseCoordinatesWhenDragStarted.left
            : this.initialMouseCoordinatesWhenDragStarted.left - currentMouseCoordidates.left, currentElementLabelWidth = isLabelLeftAligned
            ? ~~this.targetElementThatIsResizing.getRootNode().getAttribute('data-label-width')
            : this.targetElementThatIsResizing.getColspan() - ~~this.targetElementThatIsResizing.getRootNode().getAttribute('data-label-width');
        this.document.getEngine().getLoader().execCommand('resize-label-by-delta', this.targetElementThatIsResizing, currentElementLabelWidth, delta);
        this.setResizingMechanismTarget(this.targetElementThatIsResizing);
        this.isResizing = true;
        var resizerClientRect = this.visualResizerHandleElement.getBoundingClientRect();
        this.initialMouseCoordinatesWhenDragStarted.left = resizerClientRect.left + ~~(resizerClientRect.width / 2);
        this.initialMouseCoordinatesWhenDragStarted.top = resizerClientRect.top + ~~(resizerClientRect.height / 2);
        return true;
    };
    MousePluginLabelResize.prototype.handleMouseMoveWhenResizingIsInactive = function (e) {
        var eventTarget = (e.target || e.srcElement || null);
        if (!(this.jq(eventTarget).is('[data-role=control]') || this.jq(eventTarget).is('[data-role=container][data-type=likert-wrapper]'))) {
            return false;
        }
        if (null === eventTarget) {
            return false;
        }
        return this.handleResizingInitialization(eventTarget, e);
    };
    MousePluginLabelResize.prototype.handleResizingInitialization = function (eventTarget, e) {
        return (function ($, self, eventTarget) {
            var elementAbsolutePositionOnScreen = (function (rect) {
                return {
                    left: rect.left,
                    right: rect.right,
                    top: rect.top,
                    bottom: rect.bottom,
                    width: rect.width,
                    height: rect.height
                };
            })(eventTarget.getBoundingClientRect()), elementHash = $(eventTarget).attr('data-hash');
            if (!elementHash) {
                return false;
            }
            var targetElementThatIsResizing = self.document.getElementByHash(elementHash);
            if (!targetElementThatIsResizing.hasProperty('label.widthInUnits')) {
                return;
            }
            self.visualResizerHandleElement.onmouseover = function () {
                $('[data-role=mouse-resizer]').hide();
            };
            self.visualResizerHandleElement.onmouseout = function () {
                if (!self.isResizing) {
                    $('[data-role=mouse-resizer]').show();
                }
            };
            self.setResizingMechanismTarget(targetElementThatIsResizing);
        })(this.jq, this, eventTarget);
    };
    MousePluginLabelResize.prototype.setResizingMechanismTarget = function (element) {
        if (this.visualResizerHandleElement.parentNode !== element.getRootNode()) {
            element.getRootNode().appendChild(this.visualResizerHandleElement);
        }
        this.targetElementThatIsResizing = element;
        this.isResizing = false;
    };
    MousePluginLabelResize.prototype.cancelTheResizingMechanism = function () {
        if (this.visualResizerHandleElement.parentNode) {
            this.visualResizerHandleElement.parentNode.removeChild(this.visualResizerHandleElement);
        }
        this.targetElementThatIsResizing = null;
        this.isResizing = false;
        this.jq(this.visualResizerHandleElement).trigger('mouseout');
    };
    MousePluginLabelResize.prototype.handleMouseDown = function (e) {
        var elementTarget = (e.target || e.srcElement);
        if (null === this.targetElementThatIsResizing || this.isResizing || elementTarget !== this.visualResizerHandleElement) {
            return false;
        }
        this.isResizing = true;
        this.manager.setCurrentOperationType(EEditorMouseOperationType.LABEL_RESIZE);
        this.initialMouseCoordinatesWhenDragStarted.left = e.clientX;
        this.initialMouseCoordinatesWhenDragStarted.top = e.clientY;
        this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.UNDO_SERVICE).trigger('user-action', 'label-resize-start');
        return true;
    };
    MousePluginLabelResize.prototype.handleMouseUp = function (e) {
        if (this.isResizing) {
            this.cancelTheResizingMechanism();
            this.manager.setCurrentOperationType(EEditorMouseOperationType.NONE);
            this.document.getEngine().getLoader().execCommand('track-event', 'control_resize');
            this.document.getEngine().getLoader().execCommand('track-event', 'control_resize_label');
            this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.UNDO_SERVICE).trigger('user-action', 'label-resize-end');
            return true;
        }
        return false;
    };
    MousePluginLabelResize.prototype.handleDocumentBodyScroll = function () {
        this.cancelTheResizingMechanism();
    };
    MousePluginLabelResize.prototype.abortOperation = function () {
        this.cancelTheResizingMechanism();
        this.manager.setCurrentOperationType(EEditorMouseOperationType.NONE);
    };
    return MousePluginLabelResize;
}());
var MousePluginDragAndDrop = (function () {
    function MousePluginDragAndDrop(jq, document, manager) {
        this.DRAG_AND_DROP_START_AFTER_INITIAL_DISTANCE = 20;
        this.initialMouseDownPosition = {
            left: 0,
            top: 0,
        };
        this.isDuplicateInsteadOfDrag = false;
        this.jq = jq;
        this.document = document;
        this.manager = manager;
        this.isDragging = false;
        this.dragOverlay = window.document.createElement('div');
        this.dragOverlay.setAttribute('data-role', 'drag-overlay');
        this.dragSource = null;
        this.createElementTypeId = null;
        this.dropReferenceElement = null;
        this.dropReferenceEdge = null;
        this.dropEdgeIndicator = window.document.createElement('div');
        this.dropEdgeIndicator.setAttribute('data-role', 'drop-edge-indicator');
        this.dragExistingElement = null;
        (function (self) {
            self.moveDropReferenceToDirectRowFromThePageDebouncer = Throttle.create(function () {
                self.moveDropReferenceToDirectRowFromThePage();
            }, 1500);
        })(this);
    }
    MousePluginDragAndDrop.prototype.canBeExecutedWhenOperationTypeIs = function (operationType, inEventPhase, forEvent) {
        switch (operationType) {
            case EEditorMouseOperationType.NONE:
                if (!forEvent.shiftKey && (inEventPhase === EMouseEventType.MOUSE_MOVE || inEventPhase === EMouseEventType.MOUSE_DOWN)) {
                    return true;
                }
                break;
            case EEditorMouseOperationType.DRAG:
                return true;
        }
        return false;
    };
    MousePluginDragAndDrop.prototype.handleMouseMove = function (e) {
        if (EMouseButton.LEFT !== MouseUtils.getMouseButtonFromEvent(e) && (this.isDragging || this.dragOverlay || this.dragSource)) {
            this.abortOperation();
            return false;
        }
        if (!this.isDragging) {
            return this.handleMouseMoveWhileDragAndDropIsInactive(e);
        }
        else {
            if (EMouseButton.LEFT !== MouseUtils.getMouseButtonFromEvent(e)) {
                this.abortOperation();
                return false;
            }
            else {
                return this.handleMouseMoveWhileDragAndDropIsActive(e);
            }
        }
    };
    MousePluginDragAndDrop.prototype.handleMouseMoveWhileDragAndDropIsInactive = function (e) {
        if (null === this.dragSource) {
            return false;
        }
        var currentMousePositionOnScreen = {
            left: e.clientX,
            top: e.clientY,
        };
        if (FormUtils.computeDistance(this.initialMouseDownPosition, currentMousePositionOnScreen) >= this.DRAG_AND_DROP_START_AFTER_INITIAL_DISTANCE) {
            this.isDuplicateInsteadOfDrag = (e.ctrlKey || e.metaKey);
            this.prepareDragAndDropOperation(currentMousePositionOnScreen);
            return true;
        }
        return false;
    };
    MousePluginDragAndDrop.prototype.prepareDragAndDropOperation = function (initialOverlayPositionOnScreen) {
        var _a;
        this.dragOverlay.style.left = initialOverlayPositionOnScreen.left + "px";
        this.dragOverlay.style.top = initialOverlayPositionOnScreen.top + "px";
        this.manager.setCurrentOperationType(EEditorMouseOperationType.DRAG);
        var selectedElements = (_a = this.document.getEngine().getLoader().getSelection().getVirtualControl()) === null || _a === void 0 ? void 0 : _a.getElements();
        if (selectedElements) {
            _.forEach(selectedElements, function (element) {
                element.getRootNode().setAttribute('data-is-drag-source', '1');
            });
        }
        else if (this.dragExistingElement) {
            this.dragExistingElement.getRootNode().setAttribute('data-is-drag-source', '1');
        }
        this.updateDragAndDropOverlayContent();
        this.isDragging = true;
        this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.UNDO_SERVICE).trigger('user-action', 'drag-and-drop-start');
    };
    MousePluginDragAndDrop.prototype.updateDragAndDropOverlayContent = function () {
        this.dragOverlay.innerHTML = 'Loading...';
        var elementConfiguration, unknownConfiguration = {
            category: 'basic',
            icon: 'i123-image',
            isContainer: false,
            keywords: "element",
            name: 'Element',
            typeId: this.createElementTypeId,
            isVirtual: false,
            index: 99999,
            accessibilityFields: EFieldAccessibilityNodesBitmask.NONE,
        };
        if (this.dragExistingElement) {
            elementConfiguration = JSON.parse(JSON.stringify(this.dragExistingElement._static().getConfiguration())) || unknownConfiguration;
            this.isDuplicateInsteadOfDrag = this.isDuplicateInsteadOfDrag && this.dragExistingElement && this.dragExistingElement.isDuplicatable();
            elementConfiguration.isMoveOperation = true;
            elementConfiguration.isDuplicateOperation = this.isDuplicateInsteadOfDrag;
        }
        else {
            var itemStaticClass = this.document.getEngine().getFactory().getItemStaticClassByTypeNameOrTypeId(this.createElementTypeId);
            elementConfiguration = itemStaticClass.getConfiguration
                ? JSON.parse(JSON.stringify(itemStaticClass.getConfiguration())) || unknownConfiguration
                : unknownConfiguration;
            elementConfiguration.isMoveOperation = false;
        }
        (function (self) {
            var _a, _b, _c, _d;
            var virtualControl = self.document.getEngine().getLoader().getSelection().getVirtualControl();
            var selectionLength = ((_a = virtualControl) === null || _a === void 0 ? void 0 : _a.getElements().length) || 0;
            var resource = '/modules/Typescript/Form/resources/drag-and-drop-overlay.html';
            if ((_c = (_b = virtualControl) === null || _b === void 0 ? void 0 : _b.getElements()[0]) === null || _c === void 0 ? void 0 : _c.hasProperty('label.labelText')) {
                var firstSelectedElement = virtualControl.getElements()[0];
                elementConfiguration.labelText = firstSelectedElement.getProperty('label.labelText');
                elementConfiguration.icon = firstSelectedElement._static().getConfiguration().icon;
            }
            if (!virtualControl && ((_d = self.dragExistingElement) === null || _d === void 0 ? void 0 : _d.hasProperty('label.labelText'))) {
                elementConfiguration.labelText = self.dragExistingElement.getProperty('label.labelText');
            }
            self.dragOverlay.classList.add('drag-overlay');
            if (selectionLength > 1) {
                self.dragOverlay.classList.add('drag-overlay--multiple');
                resource = '/modules/Typescript/Form/resources/drag-and-drop-multiple-elements.html';
                elementConfiguration.badgeText = selectionLength < 100 ? selectionLength.toString() : '99+';
            }
            self.document.getEngine().getResourceManager().get(resource)
                .then(function (templateText) {
                var salvage = new Salvage(templateText);
                elementConfiguration.isMac = !!!BrowserDetector.meetsRequirements('mac * desktop * *');
                self.dragOverlay.innerHTML = salvage.parse(elementConfiguration);
                self.document.getEngine().getI18n().translateDOMNode(self.dragOverlay);
                document.body.appendChild(self.dragOverlay);
            });
        })(this);
    };
    MousePluginDragAndDrop.prototype.handleMouseMoveWhileDragAndDropIsActive = function (e) {
        if (!this.isDragging) {
            return false;
        }
        var currentMousePosition = {
            left: e.clientX,
            top: e.clientY,
        };
        this.dragOverlay.style.left = currentMousePosition.left + "px";
        this.dragOverlay.style.top = currentMousePosition.top + "px";
        var destination = (e.target || e.srcElement);
        if (!this.document.getEngine().getJQuery()(destination).is('#form [data-role=page] [data-role=page-body], #form [data-role=page] [data-role=page-body] *, #form [data-role=repeatable-group] > [data-role=body]')) {
            this.document.getRootNode().setAttribute('data-no-dnd-reference', '');
            this.dropReferenceElement = null;
            this.dropReferenceEdge = null;
            return false;
        }
        else {
            this.document.getRootNode().removeAttribute('data-no-dnd-reference');
        }
        if (!destination) {
            return false;
        }
        return (function ($, self) {
            var isDragOverEmptyPage = false;
            if (!($(destination).is("[data-role=page-body] [data-role=control][data-hash],                             [data-role=page-body] [data-role=container][data-type=repeatable][data-hash],                             [data-role=page-body] [data-role=container][data-type=virtual-form-table-row][data-hash],                             [data-role=page-body] [data-role=container][data-type=repeatable-group][data-hash] > [data-role=body],                             [data-role=page-body] [data-role=container][data-type=likert-wrapper][data-hash]")
                ||
                    (isDragOverEmptyPage = $(destination).is('[data-role=page-body]:empty')))) {
                return false;
            }
            if ($(destination).is('div[data-role=container][data-type=likert-wrapper] div[data-role=input-row] *')) {
                return false;
            }
            var destinationElementHash, targetUnderMousePointer;
            if (!isDragOverEmptyPage) {
                destinationElementHash = $(destination).closest('[data-hash]').attr('data-hash');
            }
            else {
                destinationElementHash = $(destination).parent('[data-role=page][data-type=page]').attr('data-hash');
            }
            if (!destinationElementHash) {
                return false;
            }
            targetUnderMousePointer = self.document.getElementByHash(destinationElementHash);
            if (!targetUnderMousePointer) {
                return false;
            }
            if (!(function () {
                if (self.dragSource === EDragAndDropSource.STARTED_FROM_EDITOR_PANEL) {
                    var itemStaticClass = self.document.getEngine().getFactory().getItemStaticClassByTypeNameOrTypeId(self.createElementTypeId), itemStaticDropCSSSelector = void 0, targetDropDestinationNode_1 = null;
                    if (itemStaticClass && itemStaticClass.getDropDestinationCSSSelector && null !== (itemStaticDropCSSSelector = itemStaticClass.getDropDestinationCSSSelector())) {
                        $(targetUnderMousePointer.getRootNode()).closest(itemStaticDropCSSSelector).each(function () {
                            targetDropDestinationNode_1 = this;
                        });
                        if (!targetDropDestinationNode_1) {
                            return false;
                        }
                        if (targetDropDestinationNode_1.hasAttribute('data-hash')) {
                            destinationElementHash = targetDropDestinationNode_1.getAttribute('data-hash');
                            if (!destinationElementHash) {
                                return false;
                            }
                            targetUnderMousePointer = self.document.getElementByHash(destinationElementHash);
                            return !!targetUnderMousePointer;
                        }
                        return false;
                    }
                }
                return true;
            })()) {
                return false;
            }
            var targetUnderMousePointerClientRect;
            if (!isDragOverEmptyPage) {
                var edgeDistance = self.getElementClosestEdge(targetUnderMousePointer, currentMousePosition);
                if (null === edgeDistance) {
                    return false;
                }
                if (targetUnderMousePointer.getTypeId() === ElementTypes.CONTAINER_TYPE_ROW) {
                    self.setDropTargetElementWhenCursorIsDirectlyOverARowElement(targetUnderMousePointer, edgeDistance, currentMousePosition);
                }
                else {
                    targetUnderMousePointerClientRect = targetUnderMousePointer.getRootNode().getBoundingClientRect();
                    self.setDropTargetElement(targetUnderMousePointer, edgeDistance.edge, targetUnderMousePointerClientRect);
                }
            }
            else {
                targetUnderMousePointerClientRect = targetUnderMousePointer.getHeaderContainerDOMNode().getBoundingClientRect();
                self.setDropTargetElement(targetUnderMousePointer, EElementEdge.TOP, targetUnderMousePointerClientRect);
            }
            return true;
        })(this.jq, this);
    };
    MousePluginDragAndDrop.prototype.getElementClosestEdge = function (targetUnderMousePointer, currentMousePosition) {
        var supportedDropEdges, dropEdgesDistances, targetUnderMousePointerClientRect;
        targetUnderMousePointerClientRect = targetUnderMousePointer.getRootNode().getBoundingClientRect();
        dropEdgesDistances = [];
        supportedDropEdges = (this.dragSource === EDragAndDropSource.STARTED_FROM_EDITOR_PANEL
            ? (this.document.getEngine().getFactory().getItemStaticClassByTypeNameOrTypeId(this.createElementTypeId) || {}).getDropSupportedEdges
                ? this.document.getEngine().getFactory().getItemStaticClassByTypeNameOrTypeId(this.createElementTypeId).getDropSupportedEdges()
                : null
            : this.dragExistingElement._static().getDropSupportedEdges()) || [
            EElementEdge.TOP,
            EElementEdge.RIGHT,
            EElementEdge.BOTTOM,
            EElementEdge.LEFT,
        ];
        if (supportedDropEdges.indexOf(EElementEdge.TOP) > -1) {
            dropEdgesDistances.push({
                distance: currentMousePosition.top - targetUnderMousePointerClientRect.top,
                edge: EElementEdge.TOP,
            });
        }
        if (supportedDropEdges.indexOf(EElementEdge.LEFT) > -1) {
            dropEdgesDistances.push({
                distance: currentMousePosition.left - targetUnderMousePointerClientRect.left,
                edge: EElementEdge.LEFT
            });
        }
        if (supportedDropEdges.indexOf(EElementEdge.RIGHT) > -1) {
            dropEdgesDistances.push({
                distance: targetUnderMousePointerClientRect.left + targetUnderMousePointerClientRect.width - currentMousePosition.left,
                edge: EElementEdge.RIGHT,
            });
        }
        if (supportedDropEdges.indexOf(EElementEdge.BOTTOM) > -1) {
            dropEdgesDistances.push({
                distance: targetUnderMousePointerClientRect.top + targetUnderMousePointerClientRect.height - currentMousePosition.top,
                edge: EElementEdge.BOTTOM
            });
        }
        if (!dropEdgesDistances.length) {
            return null;
        }
        dropEdgesDistances.sort(function (a, b) {
            return a.distance - b.distance;
        });
        return dropEdgesDistances[0];
    };
    MousePluginDragAndDrop.prototype.setDropTargetElementWhenCursorIsDirectlyOverARowElement = function (row, edge, mousePosition) {
        var rowClientRect = row.getRootNode().getBoundingClientRect();
        if (edge.distance < 10 || this.createElementTypeId === ElementTypes.CONTROL_TYPE_PAGE_BREAK) {
            this.setDropTargetElement(row, edge.edge, rowClientRect);
            return;
        }
        var rowChildren = row.getChildren() || [], edgeDistance, purposedFormElement = null, candidateEdgeDistance = null;
        for (var i = 0, len = rowChildren.length; i < len; i++) {
            edgeDistance = this.getElementClosestEdge(rowChildren[i], mousePosition);
            if (null === edgeDistance) {
                continue;
            }
            if (null === purposedFormElement || edgeDistance.distance < candidateEdgeDistance.distance) {
                purposedFormElement = rowChildren[i];
                candidateEdgeDistance = edgeDistance;
            }
        }
        if (null === purposedFormElement) {
            this.setDropTargetElement(row, edge.edge, rowClientRect);
        }
        else {
            this.setDropTargetElement(purposedFormElement, candidateEdgeDistance.edge, purposedFormElement.getRootNode().getBoundingClientRect());
        }
    };
    MousePluginDragAndDrop.prototype.setDropTargetElement = function (element, edge, physicalGeometryOfElementOnScreen) {
        var isPageDropTargetElement = element.getTypeId() === ElementTypes.CONTAINER_TYPE_PAGE;
        if (element === this.dragExistingElement) {
            this.cancelDropTargetIndicator();
            return;
        }
        this.dropReferenceElement = element;
        this.dropReferenceEdge = edge;
        if (isPageDropTargetElement) {
            this.dropEdgeIndicator.style.width = physicalGeometryOfElementOnScreen.width + "px";
            this.dropEdgeIndicator.style.top = (physicalGeometryOfElementOnScreen.top + physicalGeometryOfElementOnScreen.height) + "px";
            this.dropEdgeIndicator.style.left = physicalGeometryOfElementOnScreen.left + "px";
            this.dropEdgeIndicator.style.height = '';
            this.dropEdgeIndicator.setAttribute('data-edge', 'top');
            if (this.dropEdgeIndicator.parentNode !== this.dropReferenceElement.getHeaderContainerDOMNode()) {
                this.dropReferenceElement.getHeaderContainerDOMNode().appendChild(this.dropEdgeIndicator);
            }
        }
        else {
            switch (edge) {
                case EElementEdge.TOP:
                    this.dropEdgeIndicator.style.width = physicalGeometryOfElementOnScreen.width + "px";
                    this.dropEdgeIndicator.style.top = physicalGeometryOfElementOnScreen.top + "px";
                    this.dropEdgeIndicator.style.left = physicalGeometryOfElementOnScreen.left + "px";
                    this.dropEdgeIndicator.style.height = '';
                    this.dropEdgeIndicator.setAttribute('data-edge', 'top');
                    break;
                case EElementEdge.BOTTOM:
                    this.dropEdgeIndicator.style.width = physicalGeometryOfElementOnScreen.width + "px";
                    this.dropEdgeIndicator.style.top = physicalGeometryOfElementOnScreen.top + physicalGeometryOfElementOnScreen.height + "px";
                    this.dropEdgeIndicator.style.left = physicalGeometryOfElementOnScreen.left + "px";
                    this.dropEdgeIndicator.style.height = '';
                    this.dropEdgeIndicator.setAttribute('data-edge', 'bottom');
                    break;
                case EElementEdge.RIGHT:
                    this.dropEdgeIndicator.style.left = physicalGeometryOfElementOnScreen.left + physicalGeometryOfElementOnScreen.width + "px";
                    this.dropEdgeIndicator.style.top = physicalGeometryOfElementOnScreen.top + "px";
                    this.dropEdgeIndicator.style.height = physicalGeometryOfElementOnScreen.height + "px";
                    this.dropEdgeIndicator.style.width = '';
                    this.dropEdgeIndicator.setAttribute('data-edge', 'right');
                    break;
                default:
                case EElementEdge.LEFT:
                    this.dropEdgeIndicator.style.left = physicalGeometryOfElementOnScreen.left + "px";
                    this.dropEdgeIndicator.style.top = physicalGeometryOfElementOnScreen.top + "px";
                    this.dropEdgeIndicator.style.height = physicalGeometryOfElementOnScreen.height + "px";
                    this.dropEdgeIndicator.style.width = '';
                    this.dropEdgeIndicator.setAttribute('data-edge', 'left');
                    break;
            }
            if (this.dropEdgeIndicator.parentNode !== this.dropReferenceElement.getParentPage().getRootNode()) {
                this.dropReferenceElement.getParentPage().getRootNode().appendChild(this.dropEdgeIndicator);
            }
            this.moveDropReferenceToDirectRowFromThePageDebouncer();
        }
    };
    MousePluginDragAndDrop.prototype.cancelDropTargetIndicator = function () {
        this.dropReferenceElement = null;
        this.dropReferenceEdge = null;
        if (this.dropEdgeIndicator.parentNode) {
            this.dropEdgeIndicator.parentNode.removeChild(this.dropEdgeIndicator);
        }
    };
    MousePluginDragAndDrop.prototype.handleMouseDown = function (e) {
        if (EMouseButton.LEFT !== MouseUtils.getMouseButtonFromEvent(e)) {
            return false;
        }
        var target = (e.target || e.srcElement);
        if (!target) {
            return false;
        }
        if (this.jq(target).is('[data-role=container][data-type=likert-wrapper] *')) {
            target = this.jq(target).closest('[data-role=container][data-type=likert-wrapper]').get(0);
        }
        return (function ($, self) {
            var elementTypeId;
            switch (true) {
                case $(target).is('[data-role=page-header], [data-role=page-header] *, [data-role=page-footer], [data-role=page-footer] *'):
                    return false;
                case $(target).is('#editor [data-role=control][data-type-id], #editor[data-role=container][data-type-id], #editor [data-role=control][data-type-id] *, #editor[data-role=container][data-type-id] *'):
                    elementTypeId = ~~$(target).closest('[data-type-id]').attr('data-type-id');
                    if (!elementTypeId) {
                        return false;
                    }
                    self.createElementTypeId = elementTypeId;
                    self.dragSource = EDragAndDropSource.STARTED_FROM_EDITOR_PANEL;
                    self.dragExistingElementHash = null;
                    self.dragExistingElement = null;
                    break;
                case $(target).is('#form [data-role=control][data-hash], #form [data-role=container][data-hash]'):
                    self.createElementTypeId = null;
                    self.dragSource = EDragAndDropSource.STARTED_FROM_FORM;
                    self.dragExistingElementHash = $(target).attr('data-hash');
                    self.dragExistingElement = self.document.getElementByHash(self.dragExistingElementHash);
                    if (!(!self.dragExistingElement || self.dragExistingElement.getTypeId() === ElementTypes.CONTAINER_TYPE_ROW)) {
                        if (!self.dragExistingElement.isDragable()) {
                            self.createElementTypeId = null;
                            self.dragExistingElementHash = null;
                            self.dragSource = null;
                            return false;
                        }
                        break;
                    }
                default:
                    self.createElementTypeId = null;
                    self.dragSource = null;
                    self.dragExistingElementHash = null;
                    self.dragExistingElement = null;
                    return false;
            }
            self.initialMouseDownPosition.left = e.clientX;
            self.initialMouseDownPosition.top = e.clientY;
            e.preventDefault();
            e.stopPropagation();
            return true;
        })(this.jq, this);
    };
    MousePluginDragAndDrop.prototype.cancelTheDragAndDropMechanism = function () {
        this.document.getEngine().getLoader().getSelection().rebuildVirtualSelectionControl();
        if (this.dragExistingElementHash) {
            this.document.getElementByHash(this.dragExistingElementHash).getRootNode().removeAttribute('data-is-drag-source');
        }
        this.document.getEngine().getJQuery()('[data-is-drag-source]').removeAttr('data-is-drag-source');
        this.createElementTypeId = null;
        this.dragSource = null;
        this.dragExistingElementHash = null;
        this.dragExistingElement = null;
        this.isDragging = false;
        this.isDuplicateInsteadOfDrag = false;
        if (this.dragOverlay.parentNode) {
            this.dragOverlay.parentNode.removeChild(this.dragOverlay);
        }
        this.document.getRootNode().removeAttribute('data-no-dnd-reference');
        this.cancelDropTargetIndicator();
        this.manager.setCurrentOperationType(EEditorMouseOperationType.NONE);
    };
    MousePluginDragAndDrop.prototype.isValidDropEvent = function (e) {
        var elementTarget = (e.target || e.srcElement);
        var result = this.jq(elementTarget)
            .is([
            '#form [data-role=control][data-hash]',
            '#form [data-role=container][data-hash]',
            '#form [data-role=virtual-form-table-row][data-hash]',
            '#form [data-role=page] > [data-role=page-body]:empty',
            '#form [data-role=page] > [data-role=page-header]',
            '#form [data-role=page] > [data-role=page-header] *',
            '#form [data-role=page] > [data-role=page-footer]',
            '#form [data-role=page] > [data-role=page-footer] *',
            '#form [data-role=container][data-type=repeatable-group] > [data-role=body]'
        ].join(","))
            && (null !== this.dropReferenceElement)
            && (null !== this.dropReferenceEdge);
        if (!result) {
            console.warn(elementTarget);
        }
        return result;
    };
    MousePluginDragAndDrop.prototype.handleMouseUp = function (e) {
        var _this = this;
        var _a;
        e.preventDefault();
        e.stopPropagation();
        var isDuplicateOperation = this.dragSource === EDragAndDropSource.STARTED_FROM_FORM
            && (e.ctrlKey || e.metaKey)
            && this.dragExistingElement
            && this.dragExistingElement.isDuplicatable();
        if (this.isDragging) {
            try {
                if (this.dropReferenceElement && this.isValidDropEvent(e)) {
                    switch (this.dragSource) {
                        case EDragAndDropSource.STARTED_FROM_FORM:
                            var virtualControl = this.document.getEngine().getLoader().getSelection().getVirtualControl();
                            var selectionElements_1 = ((_a = virtualControl) === null || _a === void 0 ? void 0 : _a.getElements()) || [];
                            var canDropInItself_1 = isDuplicateOperation;
                            if (selectionElements_1.length > 1) {
                                var orderedElements = this.document.getForm().getSelectableControls().filter(function (item) { return selectionElements_1.includes(item); });
                                if (this.dropReferenceEdge === EElementEdge.BOTTOM || this.dropReferenceEdge === EElementEdge.RIGHT) {
                                    orderedElements = orderedElements.reverse();
                                }
                                _.forEach(orderedElements, function (element) {
                                    if (!element.isDuplicatable() && isDuplicateOperation) {
                                        return;
                                    }
                                    _this.document.getEngine().getLoader().execCommand('drop', element, _this.dropReferenceElement, _this.dropReferenceEdge, isDuplicateOperation, canDropInItself_1);
                                });
                                break;
                            }
                            this.document.getEngine().getLoader().execCommand('drop', this.dragExistingElement, this.dropReferenceElement, this.dropReferenceEdge, isDuplicateOperation);
                            break;
                        case EDragAndDropSource.STARTED_FROM_EDITOR_PANEL:
                            this.document.getEngine().getLoader().execCommand('drop', this.createElementTypeId, this.dropReferenceElement, this.dropReferenceEdge, false);
                            break;
                    }
                }
                this.document.getEngine().getLoader().getLoaderDependency(ELoaderDependency.UNDO_SERVICE).trigger('user-action', 'drag-and-drop-end');
            }
            catch (e) {
                this.cancelTheDragAndDropMechanism();
                throw e;
            }
            this.cancelTheDragAndDropMechanism();
            return true;
        }
        return false;
    };
    MousePluginDragAndDrop.prototype.handleDocumentBodyScroll = function () {
        this.cancelDropTargetIndicator();
    };
    MousePluginDragAndDrop.prototype.handleFormPageLeave = function () {
    };
    MousePluginDragAndDrop.prototype.moveDropReferenceToDirectRowFromThePage = function () {
        if (!(this.isDragging && null !== this.dropReferenceElement && null !== this.dropReferenceEdge)) {
            return;
        }
        var cursor = this.dropReferenceElement;
        if (this.dropReferenceEdge === EElementEdge.TOP || this.dropReferenceEdge === EElementEdge.BOTTOM) {
            while (cursor.getParent().getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE) {
                cursor = cursor.getParent();
            }
        }
        else {
            if (!cursor || !cursor.getParent()) {
                return;
            }
            cursor = cursor.getFirstParentContainer();
            if (!cursor || !cursor.getParent()) {
                return;
            }
            if (cursor.getParent().getElementKind() !== ElementTypes.CONTAINER_TYPE_ROW) {
                return;
            }
        }
        if (cursor === this.dropReferenceElement) {
            return;
        }
        this.setDropTargetElement(cursor, this.dropReferenceEdge, cursor.getRootNode().getBoundingClientRect());
    };
    MousePluginDragAndDrop.prototype.abortOperation = function () {
        this.cancelTheDragAndDropMechanism();
    };
    return MousePluginDragAndDrop;
}());
var MousePluginAreaSelect = (function () {
    function MousePluginAreaSelect(jq, document, manager) {
        this.isSelecting = false;
        this.originalPointWhenSelectionStarted = {
            left: 0,
            top: 0,
        };
        this.currentSelectionPoint = {
            left: 0,
            top: 0,
        };
        this.jq = jq;
        this.document = document;
        this.manager = manager;
        this.selectOverlay = window.document.createElement('div');
        this.selectOverlay.setAttribute('data-role', 'select-area');
    }
    MousePluginAreaSelect.prototype.canBeExecutedWhenOperationTypeIs = function (operationType, inEventPhase, forEvent) {
        switch (operationType) {
            case EEditorMouseOperationType.NONE:
                if (forEvent.shiftKey && inEventPhase === EMouseEventType.MOUSE_DOWN) {
                    return true;
                }
                break;
            case EEditorMouseOperationType.SELECT:
                return true;
        }
        return false;
    };
    MousePluginAreaSelect.prototype.handleMouseMove = function (e) {
        if (!this.isSelecting) {
            return false;
        }
        this.currentSelectionPoint.left = e.clientX;
        this.currentSelectionPoint.top = e.clientY;
        this.updateSelectionOverlayCoordinates();
        this.document.getEngine().getLoader().execCommand('select-rectangle-while-dragging', this.originalPointWhenSelectionStarted, this.currentSelectionPoint);
        e.preventDefault();
        e.stopPropagation();
        return true;
    };
    MousePluginAreaSelect.prototype.handleMouseDown = function (e) {
        if (this.isSelecting) {
            return false;
        }
        var eventTarget = (e.srcElement || e.target);
        if (!eventTarget) {
            return false;
        }
        if (!this.jq(eventTarget).is('#form, #form *')) {
            return false;
        }
        this.originalPointWhenSelectionStarted.left = e.clientX;
        this.originalPointWhenSelectionStarted.top = e.clientY;
        this.currentSelectionPoint.left = e.clientX;
        this.currentSelectionPoint.top = e.clientY;
        this.updateSelectionOverlayCoordinates();
        document.body.appendChild(this.selectOverlay);
        this.isSelecting = true;
        this.manager.setCurrentOperationType(EEditorMouseOperationType.SELECT);
        e.preventDefault();
        e.stopPropagation();
    };
    MousePluginAreaSelect.prototype.updateSelectionOverlayCoordinates = function () {
        var left = Math.min(this.originalPointWhenSelectionStarted.left, this.currentSelectionPoint.left), top = Math.min(this.originalPointWhenSelectionStarted.top, this.currentSelectionPoint.top), width = Math.abs(this.originalPointWhenSelectionStarted.left - this.currentSelectionPoint.left), height = Math.abs(this.originalPointWhenSelectionStarted.top - this.currentSelectionPoint.top);
        this.selectOverlay.style.left = left + "px";
        this.selectOverlay.style.top = top + "px";
        this.selectOverlay.style.width = width + "px";
        this.selectOverlay.style.height = height + "px";
    };
    MousePluginAreaSelect.prototype.abortSelectionMechanism = function () {
        this.isSelecting = false;
        if (this.selectOverlay.parentNode) {
            this.selectOverlay.parentNode.removeChild(this.selectOverlay);
        }
        this.document.getEngine().getLoader().execCommand('select-rectangle-while-dragging', this.originalPointWhenSelectionStarted, this.originalPointWhenSelectionStarted);
    };
    MousePluginAreaSelect.prototype.handleMouseUp = function (e) {
        if (this.isSelecting) {
            (function (pointA, pointB, ctrlKey, loader) {
                setTimeout(function () {
                    loader.execCommand('select-rectangle', pointA, pointB, ctrlKey);
                }, 1);
            })(JSON.parse(JSON.stringify(this.originalPointWhenSelectionStarted)), JSON.parse(JSON.stringify(this.currentSelectionPoint)), !!e.ctrlKey || !!e.metaKey, this.document.getEngine().getLoader());
        }
        this.abortSelectionMechanism();
        this.manager.setCurrentOperationType(EEditorMouseOperationType.NONE);
        e.preventDefault();
        e.stopPropagation();
        return true;
    };
    MousePluginAreaSelect.prototype.handleDocumentBodyScroll = function (e) {
    };
    MousePluginAreaSelect.prototype.abortOperation = function () {
        this.abortSelectionMechanism();
        this.manager.setCurrentOperationType(EEditorMouseOperationType.NONE);
    };
    return MousePluginAreaSelect;
}());
var FormUtils = (function () {
    function FormUtils() {
    }
    FormUtils.isImageURL = function (url) {
        return /^((http(s)?:)?\/\/([^\/]+))?([^:]+)([^\/.]+)(\.(png|gif|jpg|jpeg|tiff|bmp))(\?(.*)?|#(.*)?)?$/i.test(String(url || ''));
    };
    FormUtils.getNormalizedCSSColorNotationFromString = function (str) {
        if (!str || typeof str !== 'string') {
            return null;
        }
        if (/^#[0-9a-f]{3}$/i.test(str)) {
            return '#' + str.charAt(1) + str.charAt(1) + str.charAt(2) + str.charAt(2) + str.charAt(3) + str.charAt(3);
        }
        if (str.match(/^(#(?:[0-9a-f]{2}){2,4}|#[0-9a-f]{3}|(?:rgba?|hsla?)\((?:\d+%?(?:deg|rad|grad|turn)?(?:,|\s)+){2,3}[\s\/]*[\d\.]+%?\))$/i)) {
            return str;
        }
        var stdStr = str.toLowerCase();
        if (typeof ColorUtils.standardHTMLColors[stdStr] !== 'undefined') {
            return ColorUtils.standardHTMLColors[stdStr];
        }
        return null;
    };
    FormUtils.shuffle = function (array, shuffleOnlyFirstNumberOfElements) {
        var currentIndex = shuffleOnlyFirstNumberOfElements === undefined
            ? array.length
            : Math.min(shuffleOnlyFirstNumberOfElements, array.length), temporaryValue, randomIndex;
        while (0 !== currentIndex) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }
        return array;
    };
    FormUtils.computeDistance = function (a, b) {
        return ~~(Math.sqrt(Math.pow(b.left - a.left, 2) + Math.pow(b.top - a.top, 2)));
    };
    FormUtils.rectangleIntersects = function (a, b) {
        return !(a.left + a.width < b.left
            || a.left > b.left + b.width
            || a.top + a.height < b.top
            || a.top > b.top + b.height);
    };
    FormUtils.nullFunction = function () {
        return null;
    };
    FormUtils.padString = function (str, withCharacter, untilReachesLength, padType) {
        if (padType === void 0) { padType = EPadType.RIGHT; }
        var result = String(str || ''), len = result.length, pad = String(withCharacter || ''), padLength = pad.length, needLength = ~~untilReachesLength;
        if (0 === padLength) {
            return str;
        }
        while (len < needLength) {
            if (padType === EPadType.RIGHT) {
                result = result.concat(pad);
            }
            else {
                result = pad.concat(result);
            }
            len += padLength;
        }
        return result;
    };
    FormUtils.scrollIntoView = function (node) {
        if (!node) {
            return;
        }
        if (node['scrollIntoViewIfNeeded']) {
            node['scrollIntoViewIfNeeded']();
        }
        else if (node['scrollIntoView']) {
            node['scrollIntoView']();
        }
    };
    FormUtils.synchronizeControlValue = function (control, value) {
        var isRadioOrCheckbox, isUIElement, actualControlValue = (isUIElement = control instanceof UIElement)
            ? control.getValue()
            : (isRadioOrCheckbox = ('input' === control.nodeName.toLowerCase() && ['radio', 'checkbox'].indexOf(control.type) > -1))
                ? control.checked
                : String(control.value), purposedControlValue;
        if (actualControlValue === true || actualControlValue === false) {
            purposedControlValue = !!value;
        }
        else {
            if (0 === value) {
                purposedControlValue = '0';
            }
            else {
                purposedControlValue = String(value || '');
            }
        }
        if (purposedControlValue !== actualControlValue) {
            if (isUIElement) {
                control.setValue(purposedControlValue);
            }
            else {
                control[isRadioOrCheckbox ? 'checked' : 'value'] = purposedControlValue;
            }
        }
    };
    FormUtils.getComputedStyle = function (node) {
        try {
            return window.getComputedStyle(node);
        }
        catch (e) {
            return null;
        }
    };
    FormUtils.areTheSame = function (a, b) {
        if (a === b) {
            return true;
        }
        else {
            var typeA = void 0, typeB = void 0, aLength = void 0;
            if ((typeA = typeof a) === (typeB = typeof b)) {
                if ('object' === typeA) {
                    if (a instanceof Array) {
                        if (b instanceof Array) {
                            if ((aLength = a.length) === b.length) {
                                for (var i = 0; i < aLength; i++) {
                                    if (!this.areTheSame(a[i], b[i])) {
                                        return false;
                                    }
                                }
                                return true;
                            }
                            else {
                                return false;
                            }
                        }
                        return false;
                    }
                    if (a) {
                        if (b) {
                            var seenProps = [];
                            for (var k in a) {
                                if (a.hasOwnProperty(k)) {
                                    seenProps.push(k);
                                    if (!this.areTheSame(a[k], b[k])) {
                                        return false;
                                    }
                                }
                            }
                            for (var k in b) {
                                if (b.hasOwnProperty(k)) {
                                    if (seenProps.indexOf(k) === -1) {
                                        return false;
                                    }
                                }
                            }
                            return true;
                        }
                        return false;
                    }
                }
                return false;
            }
            else {
                return false;
            }
        }
    };
    FormUtils.getImageURLAntiCache = function (imageURL) {
        if (!imageURL) {
            return imageURL;
        }
        if ('string' !== typeof imageURL) {
            return imageURL;
        }
        if (/^data\:/.test(imageURL)) {
            return imageURL;
        }
        else {
            if (imageURL.indexOf('?') === -1) {
                return imageURL + '?_=' + (+new Date);
            }
            return imageURL + '&_=' + (+new Date);
        }
    };
    FormUtils.getTextNumberOfWords = function (text) {
        var tmp = String(text || '').replace(/(^[\s]+|[\s]+$)/g, '');
        return '' === tmp
            ? 0
            : tmp.split(/[\s]+/).length;
    };
    FormUtils.getURLEmbedIframeSource = function (urlDetails) {
        switch (urlDetails.type) {
            case EURLType.YOUTUBE_VIDEO:
                return 'https://www.youtube.com/embed/' + urlDetails.identifier + '?enablejsapi=1';
            case EURLType.VIMEO_VIDEO:
                return 'https://player.vimeo.com/video/' + urlDetails.identifier;
            case EURLType.WORDPRESS_TV_VIDEO:
                return 'https://videopress.com/embed/' + urlDetails.identifier;
            case EURLType.TED_TALKS_VIDEO:
                return 'https://embed.ted.com/talks/' + urlDetails.identifier;
            case EURLType.DAILYMOTION_VIDEO:
                return 'https://www.dailymotion.com/embed/video/' + urlDetails.identifier;
            case EURLType.MIXCLOUD_AUDIO:
                return 'https://www.mixcloud.com/widget/iframe/?feed=https://www.mixcloud.com/' + urlDetails.identifier;
            case EURLType.SOUNDCLOUD_AUDIO:
                return 'https://w.soundcloud.com/player/?url=https://api.soundcloud.com/tracks/' + urlDetails.identifier + '&auto_play=false&visual=true';
            case EURLType.NFB_VIDEO:
                return 'https://www.nfb.ca/film/' + urlDetails.identifier + '/embed/player/';
            case EURLType.KICKSTARTER_VIDEO:
                return 'https://www.kickstarter.com/projects/' + urlDetails.identifier + '/widget/video.html';
            case EURLType.TWITCH_VIDEO:
                return 'https://player.twitch.tv/?video=' + urlDetails.identifier;
            case EURLType.PDF_FILE:
                return urlDetails.url;
            case EURLType.FACEBOOK_POST:
                return 'https://www.facebook.com/plugins/post.php?href=https://www.facebook.com/' + urlDetails.identifier;
            case EURLType.FACEBOOK_PAGE:
                return 'https://www.facebook.com/plugins/page.php?href=https://www.facebook.com/' + urlDetails.identifier + '&tabs=timeline&small_header=false&adapt_container_width=true&show_facepile=true&width=500px';
            case EURLType.MOBILE_EMBED:
                return 'https://docs.google.com/gview?url=' + urlDetails.url + '&embedded=true';
            default:
                return null;
        }
    };
    FormUtils.getFormTotalPoints = function (form) {
        var totalPoints = 0, formElements = form.flatten();
        for (var i = 0, len = formElements.length; i < len; i++) {
            if (formElements[i].hasProperty('choices.values')) {
                var choices = formElements[i].getProperty('choices.values');
                for (var j = 0, leng = choices.length; j < leng; j++) {
                    if (choices[j].isCorrect) {
                        totalPoints = totalPoints + choices[j].quizPoints;
                        break;
                    }
                }
            }
        }
        return totalPoints;
    };
    FormUtils.getFormPointsWithoutElements = function (form, hashes) {
        var totalPoints = 0, formElements = form.flatten();
        for (var i = 0, len = formElements.length; i < len; i++) {
            if (formElements[i].hasProperty('choices.values') && hashes.indexOf(formElements[i].getHash()) == -1) {
                var choices = formElements[i].getProperty('choices.values');
                for (var j = 0, leng = choices.length; j < leng; j++) {
                    if (choices[j].isCorrect) {
                        totalPoints = totalPoints + choices[j].quizPoints;
                        break;
                    }
                }
            }
        }
        return totalPoints;
    };
    FormUtils.scrollElementIntoView = function (element, scrollIntoViewArgs) {
        setTimeout(function () {
            try {
                if (FormUtils.isIE()) {
                    var _a = element.getBoundingClientRect(), top_4 = _a.top, height = _a.height;
                    document.documentElement.scrollTop = top_4 - height;
                }
                else {
                    element.scrollIntoView(scrollIntoViewArgs);
                }
            }
            catch (e) { }
            try {
                if (undefined === FormUtils.iframeID) {
                    var query = UrlUtils.parseQueryString(window.location.search.substr(1));
                    FormUtils.iframeID = (query && query._iframeID_) ? query._iframeID_ : null;
                }
            }
            catch (e) {
            }
        }, 10);
        setTimeout(function () {
            try {
                if (null !== FormUtils.iframeID) {
                    window.parent.postMessage({ command: 'scroll-into-view', iframeId: FormUtils.iframeID, top: element.getBoundingClientRect().top }, '*');
                }
            }
            catch (e) {
            }
        }, 100);
    };
    FormUtils.refreshFrameHeightOnWix = function () {
        if (window["Wix"]) {
            var form = document.getElementById('form');
            var newHeight = (undefined !== form)
                ? form.offsetHeight
                : document.body.offsetHeight;
            window["Wix"].setHeight(newHeight);
        }
    };
    FormUtils.getUserSessionTokenForWix = function () {
        if (window['Wix']) {
            Wix.Activities.getUserSessionToken(function onSuccess(wixUserToken) {
                document.body.setAttribute('data-wix-user-token', wixUserToken);
            });
        }
    };
    FormUtils.addEditorModeChangeEventListenerForWix = function ($) {
        if (window['Wix']) {
            Wix.addEventListener(Wix.Events.EDIT_MODE_CHANGE, function (mode) {
                if (mode && undefined !== mode.editMode) {
                    document.body.setAttribute('data-wix-edit-mode', mode.editMode);
                    FormUtils.refreshFrameHeightOnWix();
                }
            });
            Wix.addEventListener(Wix.Events.COMPONENT_DELETED, function (e) {
                $.ajax({
                    type: 'POST',
                    url: '/ajax_call.php',
                    data: {
                        module: 'modules/wixNew/class.WixFunctions.php',
                        class: 'wixFunctions',
                        function: 'deleteWixInstance',
                        iframeInstance: Wix.Utils.getInstanceId(),
                        iframeInstanceCompid: Wix.Utils.getCompId(),
                        iframeInstanceUserID: Wix.Utils.getUid(),
                        iframeInstanceSiteOwnerId: Wix.Utils.getSiteOwnerId()
                    }
                });
            });
        }
    };
    FormUtils.isRealCSSUrl = function (cssUrl, engine) {
        return (function (validator, $) {
            if (!cssUrl) {
                return $.Deferred(function (deferred) {
                    deferred.resolve(false);
                });
            }
            if (validator.validate(cssUrl, DataValidator.VALIDATOR_TYPE_URL_WEB_PAGE)) {
                return $.Deferred(function (deferred) {
                    var linkNode = window.document.createElement('link'), iframe = document.createElement('iframe');
                    iframe.setAttribute('contenteditable', 'true');
                    iframe.style.width = iframe.style.height = '1px';
                    linkNode.setAttribute('rel', 'stylesheet');
                    linkNode.setAttribute('type', 'text/css');
                    linkNode.setAttribute('href', cssUrl);
                    linkNode.addEventListener('load', function () {
                        document.body.removeChild(iframe);
                        deferred.resolve(true);
                    });
                    linkNode.addEventListener('error', function () {
                        document.body.removeChild(iframe);
                        deferred.resolve(false);
                    });
                    document.body.appendChild(iframe);
                    (iframe.contentWindow.document || iframe.contentDocument).getElementsByTagName('head')[0].appendChild(linkNode);
                }).promise();
            }
            else {
                return $.Deferred(function (deferred) {
                    deferred.resolve(false);
                }).promise();
            }
        })(engine.getValidator(), engine.getJQuery());
    };
    FormUtils.clone = function (mixed) {
        var result;
        if (mixed === null) {
            return null;
        }
        else {
            var type = typeof mixed;
            switch (type) {
                case 'boolean':
                case 'number':
                case 'string':
                case 'function':
                    return mixed;
                case 'object':
                    if (Array.isArray(mixed)) {
                        result = [];
                        for (var i = 0, len = mixed.length; i < len; i++) {
                            result.push(this.clone(mixed[i]));
                        }
                    }
                    else {
                        if (!mixed) {
                            return null;
                        }
                        result = {};
                        for (var k in mixed) {
                            if (mixed.hasOwnProperty(k) && mixed.propertyIsEnumerable(k)) {
                                result[k] = this.clone(mixed[k]);
                            }
                        }
                    }
                    return result;
            }
        }
    };
    FormUtils.merge = function (a, b) {
        var result = [];
        if (Array.isArray(a)) {
            for (var i = 0, len = a.length; i < len; i++) {
                result.push(a[i]);
            }
        }
        if (Array.isArray(b)) {
            for (var i = 0, len = b.length; i < len; i++) {
                result.push(b[i]);
            }
        }
        return result;
    };
    FormUtils.scrollElementIntoViewOnWix = function () {
        if (window["Wix"]) {
            window["Wix"].getBoundingRectAndOffsets(function (data) {
                window["Wix"].scrollTo(data.offsets.x, data.offsets.y);
            });
        }
    };
    FormUtils.isMobile = function () {
        return BrowserDetector.meetsRequirements('* * mobile * *') === '';
    };
    FormUtils.isIOS = function () {
        return BrowserDetector.meetsRequirements('* * mobile safari *') === '';
    };
    FormUtils.isMAC = function () {
        return BrowserDetector.meetsRequirements('mac * desktop safari *') === '';
    };
    FormUtils.isFirefox = function () {
        return BrowserDetector.meetsRequirements('* * * firefox *') === '';
    };
    FormUtils.isIE = function () {
        return (!!window.MSInputMethodContext && !!document.documentMode);
    };
    FormUtils.getRepeatableContainerParent = function (element) {
        if (element.getParent()) {
            if (element.getParent().getTypeId() !== ElementTypes.CONTAINER_TYPE_REPEATABLE) {
                return FormUtils.getRepeatableContainerParent(element.getParent());
            }
            else {
                return (element.getParent());
            }
        }
        return null;
    };
    FormUtils.htmlEntities = function (str) {
        this.escaper.textContent = String(str === 0 ? '0' : str || '');
        var result = this.escaper.innerHTML;
        this.escaper.textContent = '';
        return result;
    };
    FormUtils.htmlEntitiesWithBR = function (str) {
        var lines = String(str === 0 ? '0' : str || '').split("\n");
        for (var i = 0, len = lines.length; i < len; i++) {
            lines[i] = this.htmlEntities(lines[i]);
        }
        return lines.join("<br />");
    };
    FormUtils.getRootPanelComponent = function (element) {
        if (element.getParent()) {
            return FormUtils.getRootPanelComponent(element.getParent());
        }
        else {
            return element;
        }
    };
    FormUtils.getIframeID = function () {
        try {
            if (undefined === FormUtils.iframeID) {
                var query = UrlUtils.parseQueryString(window.location.search.substr(1));
                FormUtils.iframeID = (query && query._iframeID_) ? query._iframeID_ : null;
            }
        }
        catch (e) {
        }
        return FormUtils.iframeID || null;
    };
    FormUtils.scrollToTopOfFormWhenFormIsEmbeddedUnderIOS = function () {
        try {
            if (window.parent && this.getIframeID() && FormUtils.isIOS()) {
                window.parent.postMessage({
                    iframeId: FormUtils.getIframeID(),
                    top: 10,
                    command: 'scroll-into-view'
                }, '*');
            }
        }
        catch (e) {
        }
    };
    FormUtils.getLabelOfFormControl = function (control) {
        if (control) {
            return this.getUiTranslatedString(control.getProperty('label.i18nLabelKey'), MiniMarkdown.toPlainText(control.getProperty('label.labelText')));
        }
        return FormUtils.getUiTranslatedString('edt_notifications_deleted_field', 'Deleted field');
    };
    FormUtils.getUiTranslatedString = function (i18nKey, defaultText) {
        var _a;
        var i18nVars = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            i18nVars[_i - 2] = arguments[_i];
        }
        var textToTranslate;
        textToTranslate = (_a = UI.getI18n()).translateText.apply(_a, __spreadArrays([i18nKey], i18nVars));
        return i18nKey && textToTranslate && textToTranslate !== i18nKey
            ? textToTranslate
            : defaultText;
    };
    FormUtils.allBrowsersCompatibleScrollIntoView = function (element, scrollIntoViewOptions) {
        var _a = element.getBoundingClientRect(), top = _a.top, height = _a.height;
        if ((FormUtils.isIOS() || FormUtils.isMAC()) && window["Wix"]) {
            window["Wix"].getBoundingRectAndOffsets(function (data) {
                window["Wix"].scrollTo(data.offsets.x, data.offsets.y + top - height);
            });
        }
        else if (FormUtils.isMAC() && window['parentIFrame']) {
            window['parentIFrame'].scrollToOffset(0, top - height);
        }
        else if (FormUtils.isIE()) {
            document.documentElement.scrollTop = top - height;
        }
        else {
            setTimeout(function () {
                if (scrollIntoViewOptions) {
                    element.scrollIntoView(scrollIntoViewOptions);
                }
                else {
                    element.scrollIntoView();
                }
                try {
                    if (undefined === FormUtils.iframeID) {
                        var query = UrlUtils.parseQueryString(window.location.search.substr(1));
                        FormUtils.iframeID = (query && query._iframeID_) ? query._iframeID_ : null;
                    }
                }
                catch (e) { }
            }, 10);
            setTimeout(function () {
                try {
                    if (null !== FormUtils.iframeID) {
                        window.parent.postMessage({
                            command: 'scroll-into-view',
                            iframeId: FormUtils.iframeID,
                            top: element.getBoundingClientRect().top
                        }, '*');
                    }
                }
                catch (e) { }
            }, 100);
        }
    };
    FormUtils.addNoFollowOnLinks = function (htmlText) {
        var root = document.createElement('div'), links = root.getElementsByTagName('a');
        root.innerHTML = htmlText;
        Array.prototype.forEach.call(links, function (e) { return e.setAttribute('rel', 'nofollow ugc'); });
        return root.innerHTML;
    };
    FormUtils.getVariablesFromText = function (text, controls, acceptRepeatedControls) {
        var variables = text.match(/(\:([a-zA-Z0-9_\-]+)\:|(controlId:repeatable:)([0-9]+)|(controlId:)([0-9]+)(:[a-zA-Z0-9]+)?)/gm), possibleVariables = acceptRepeatedControls ?
            FormUtils.generateFormVariables(controls, undefined, undefined, true)
            : FormUtils.generateFormVariables(controls), result = [];
        if (variables) {
            for (var i = 0, len = variables.length; i < len; i++) {
                var variableDetails = FormUtils.getVariableInfoByCode(possibleVariables, variables[i]);
                var textSnippet = text.split(variables[i])[0].trim();
                if (textSnippet) {
                    result.push({
                        type: ETagValueType.TEXT,
                        value: textSnippet,
                        caption: textSnippet,
                        isRegularTag: true
                    });
                }
                if (variableDetails) {
                    result.push({
                        type: ETagValueType.TAG,
                        value: variableDetails.value,
                        caption: variableDetails.text
                    });
                }
                else {
                    result.push(FormUtils.createDeletedTag(variables[i]));
                }
                text = text.slice(text.indexOf(variables[i]) + variables[i].length);
            }
        }
        if (text) {
            result.push({
                type: ETagValueType.TEXT,
                value: text,
                caption: text,
                isRegularTag: true
            });
        }
        return result;
    };
    FormUtils.createDeletedTag = function (value) {
        return {
            type: ETagValueType.TAG,
            value: value,
            caption: FormUtils.getUiTranslatedString('edt_notifications_deleted_field', 'Deleted field'),
            isDeleted: true,
            isRegularTag: false
        };
    };
    FormUtils.generateFormVariables = function (controls, controlTypes, extraVariables, acceptRepeatedControls) {
        var _this = this;
        var index = 0;
        if (!controlTypes) {
            controlTypes = [
                ElementTypes.CONTROL_TYPE_TEXT,
                ElementTypes.CONTROL_TYPE_TEXTAREA,
                ElementTypes.CONTROL_TYPE_DROPDOWN,
                ElementTypes.CONTROL_TYPE_NAME,
                ElementTypes.CONTROL_TYPE_RADIO,
                ElementTypes.CONTROL_TYPE_CHECKBOX,
                ElementTypes.CONTROL_TYPE_FILE,
                ElementTypes.CONTROL_TYPE_NUMBER,
                ElementTypes.CONTROL_TYPE_EMAIL,
                ElementTypes.CONTROL_TYPE_LIKERT_SCALE,
                ElementTypes.CONTROL_TYPE_ADDRESS,
                ElementTypes.CONTROL_TYPE_PHONE,
                ElementTypes.CONTROL_TYPE_DATE,
                ElementTypes.CONTROL_TYPE_TIME,
                ElementTypes.CONTROL_TYPE_PRICE,
                ElementTypes.CONTROL_TYPE_WEBSITE,
                ElementTypes.CONTROL_TYPE_PASSWORD,
                ElementTypes.CONTROL_TYPE_SIGNATURE,
                ElementTypes.CONTROL_TYPE_STAR_RATING,
                ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
                ElementTypes.CONTROL_TYPE_FORMULA,
                ElementTypes.CONTROL_TYPE_COUPON,
                ElementTypes.CONTROL_TYPE_FEE,
                ElementTypes.CONTAINER_TYPE_REPEATABLE,
            ];
        }
        var result = [];
        var EXTRA_FIELDS = extraVariables !== undefined ? extraVariables : FormUtils.getExtraVariables();
        controls.forEach(function (control) {
            var controlFields = [];
            if (controlTypes.indexOf(control.getTypeId()) > -1) {
                if (!FormUtils.getRepeatableContainerParent(control) || (acceptRepeatedControls && FormUtils.getRepeatableContainerParent(control))) {
                    switch (control.getTypeId()) {
                        case ElementTypes.CONTROL_TYPE_NAME:
                            controlFields = _this.nameControlFields(control);
                            break;
                        case ElementTypes.CONTROL_TYPE_ADDRESS:
                            controlFields = FormUtils.addressControlFields(control);
                            break;
                        case ElementTypes.CONTROL_TYPE_RADIO:
                            controlFields = FormUtils.singleChoiceControlFields(control);
                            break;
                        case ElementTypes.CONTROL_TYPE_CHECKBOX:
                            controlFields = FormUtils.multipleChoiceControlFields(control);
                            break;
                        default:
                            if (!control.getId()) {
                                if (control.getTypeId() === ElementTypes.CONTAINER_TYPE_REPEATABLE) {
                                    result.push({
                                        text: FormUtils.getLabelOfFormControl(control),
                                        value: 'controlId:repeatable:' + index++,
                                    });
                                }
                            }
                            else {
                                result.push({
                                    text: FormUtils.getLabelOfFormControl(control),
                                    value: 'controlId:' + control.getId(),
                                });
                            }
                            break;
                    }
                    if (controlFields.length) {
                        result = result.concat(controlFields);
                    }
                }
            }
        });
        EXTRA_FIELDS.forEach(function (extraField) {
            result.push(extraField);
        });
        return result;
    };
    FormUtils.nameControlFields = function (control) {
        var result = [], label = FormUtils.getLabelOfFormControl(control);
        result.push({
            text: label,
            value: 'controlId:' + control.getId(),
        });
        result.push({
            text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_first', 'First'),
            value: 'controlId:' + control.getId() + ":first",
        });
        result.push({
            text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_last', 'Last'),
            value: 'controlId:' + control.getId() + ":last",
        });
        if (control.hasProperty('configuration.fieldMiddleName') && control.getProperty('configuration.fieldMiddleName')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_middle', 'Middle'),
                value: 'controlId:' + control.getId() + ":middle",
            });
        }
        if (control.hasProperty('configuration.fieldInitials') && control.getProperty('configuration.fieldInitials')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_initials', 'Initials'),
                value: 'controlId:' + control.getId() + ":initials",
            });
        }
        if (control.hasProperty('configuration.fieldTitle') && control.getProperty('configuration.fieldTitle')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_title', 'Title'),
                value: 'controlId:' + control.getId() + ":title",
            });
        }
        return result;
    };
    FormUtils.addressControlFields = function (control) {
        var result = [], label = FormUtils.getLabelOfFormControl(control);
        result.push({
            text: label,
            value: 'controlId:' + control.getId(),
        });
        if (control.hasProperty('configuration.fieldAddress1') && control.getProperty('configuration.fieldAddress1')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_street_address', 'Street Address'),
                value: 'controlId:' + control.getId() + ":fieldAddress1",
            });
        }
        if (control.hasProperty('configuration.fieldAddress2') && control.getProperty('configuration.fieldAddress2')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_street_address_line2', 'Street Address Line 2'),
                value: 'controlId:' + control.getId() + ":fieldAddress2",
            });
        }
        if (control.hasProperty('configuration.fieldCity') && control.getProperty('configuration.fieldCity')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_city', 'City'),
                value: 'controlId:' + control.getId() + ":city",
            });
        }
        if (control.hasProperty('configuration.fieldZone') && control.getProperty('configuration.fieldZone')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_region_state', 'Region/State'),
                value: 'controlId:' + control.getId() + ":region",
            });
        }
        if (control.hasProperty('configuration.fieldZipCode') && control.getProperty('configuration.fieldZipCode')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_zip_code', 'Zip code'),
                value: 'controlId:' + control.getId() + ":zipcode",
            });
        }
        if (control.hasProperty('configuration.fieldCountry') && control.getProperty('configuration.fieldCountry')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_country', 'Country'),
                value: 'controlId:' + control.getId() + ":country",
            });
        }
        return result;
    };
    FormUtils.singleChoiceControlFields = function (control) {
        var result = [], label = FormUtils.getLabelOfFormControl(control);
        result.push({
            text: label,
            value: 'controlId:' + control.getId(),
        });
        if (control.hasProperty('choices.allowOther') && control.getProperty('choices.allowOther')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_other', 'Other'),
                value: 'controlId:' + control.getId() + ":other",
            });
        }
        return result;
    };
    FormUtils.multipleChoiceControlFields = function (control) {
        var result = [], label = FormUtils.getLabelOfFormControl(control);
        result.push({
            text: label,
            value: "controlId:" + control.getId(),
        });
        if (control.hasProperty('choices.values') && control.getProperty('choices.values').length) {
            var choices = control.getProperty('choices.values');
            choices.forEach(function (choice, index) {
                result.push({
                    text: label + ' - ' + FormUtils.getUiTranslatedString(choice.i18nLabel, choice.text),
                    value: 'controlId:' + control.getId() + ":" + index,
                });
            });
        }
        if (control.hasProperty('choices.allowOther') && control.getProperty('choices.allowOther')) {
            result.push({
                text: label + ' - ' + FormUtils.getUiTranslatedString('notifications_other', 'Other'),
                value: 'controlId:' + control.getId() + ":other",
            });
        }
        return result;
    };
    FormUtils.getExtraVariables = function () {
        return [
            {
                text: FormUtils.getUiTranslatedString('notifications_entry_id', 'Entry ID'),
                value: EVariableIdentifier.ENTRY_ID
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_ip', 'IP'),
                value: EVariableIdentifier.IP
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_country', 'Country'),
                value: EVariableIdentifier.COUNTRY_CODE
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_browser', 'Browser'),
                value: EVariableIdentifier.BROWSER
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_device_type', 'Device type'),
                value: EVariableIdentifier.DEVICE_TYPE
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_referrer', 'Referrer'),
                value: EVariableIdentifier.REFERRER
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_form_host', 'Form Host'),
                value: EVariableIdentifier.FORM_HOST
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_reference_id', 'Reference ID'),
                value: EVariableIdentifier.REFERENCE_ID
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_edit_submission_link', 'Edit submission link'),
                value: EVariableIdentifier.EDIT_SUBMISSION_LINK
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_quiz_score', 'Quiz score'),
                value: EVariableIdentifier.QUIZ_SCORE
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_approval_link', 'Approval Link'),
                value: EVariableIdentifier.APPROVAL_LINK
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_approval_history', 'Approval History'),
                value: EVariableIdentifier.APPROVAL_HISTORY
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_payment_summary', 'Payment Summary'),
                value: EVariableIdentifier.PAYMENT_SUMMARY
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_payment_link', 'Payment Link'),
                value: EVariableIdentifier.PAYMENT_LINK
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_payment_amount', 'Payment Amount'),
                value: EVariableIdentifier.PAYMENT_AMOUNT
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_payment_currency', 'Payment Currency'),
                value: EVariableIdentifier.PAYMENT_CURRENCY
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_payment_status', 'Payment Status'),
                value: EVariableIdentifier.PAYMENT_STATUS
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_payment_processor_name', 'Payment Processor Name'),
                value: EVariableIdentifier.PAYMENT_PROCESSOR_NAME
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_coupon_codes', 'Coupon codes'),
                value: EVariableIdentifier.PAYMENT_COUPON
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_submission_status', 'Submission Status'),
                value: EVariableIdentifier.SUBMISSION_STATUS
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_submission_summary', 'Submission Summary'),
                value: EVariableIdentifier.SUBMISSION_SUMMARY
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_submission_language', 'Submission Language'),
                value: EVariableIdentifier.LANGUAGE
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_quiz_summary', 'Quiz Summary'),
                value: EVariableIdentifier.QUIZ_SUMMARY
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_submission_date', 'Submission Date'),
                value: EVariableIdentifier.SUBMISSION_DATE
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_submission_date_time', 'Submission Date and Time'),
                value: EVariableIdentifier.SUBMISSION_DATE_TIME
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_submission_time', 'Submission Time'),
                value: EVariableIdentifier.SUBMISSION_TIME
            },
            {
                text: FormUtils.getUiTranslatedString('notifications_form_name', 'Form Name'),
                value: EVariableIdentifier.FORM_NAME
            },
        ];
    };
    FormUtils.getVariableInfoByCode = function (variables, code) {
        for (var i = 0, len = variables.length; i < len; i++) {
            if (variables[i].value === code) {
                return variables[i];
            }
        }
        return null;
    };
    FormUtils.setAndRemoveMessageOnElement = function (element, message, typeOfMessage) {
        if (typeOfMessage === void 0) { typeOfMessage = ETypeOfMessages.SUCCESS; }
        element.textContent = message;
        element.setAttribute('data-is-' + typeOfMessage + '-message', '');
        element.setAttribute('data-show-message', '');
        element.setAttribute('data-is-visible', '');
        setTimeout(function () {
            element.removeAttribute('data-show-message');
            setTimeout(function () {
                element.removeAttribute('data-is-' + typeOfMessage + '-message');
                element.removeAttribute('data-is-visible');
                element.textContent = '';
            }, 500);
        }, 5000);
    };
    FormUtils.isMobileInteractionActive = function () {
        return document.body.hasAttribute('data-mobile-interactions');
    };
    FormUtils.isElementASpace = function (element) {
        return element.textContent === String.fromCharCode(UITag.THIN_SPACE_CHAR_CODE);
    };
    FormUtils.getRandomID = function (min, max) {
        if (min === void 0) { min = 1; }
        if (max === void 0) { max = 1000; }
        var randomID = Math.floor(Math.random() * max) + min;
        if (FormUtils.randomGeneratedIDs.length === 1000) {
            return NaN;
        }
        if (FormUtils.randomGeneratedIDs.indexOf(randomID) !== -1) {
            return FormUtils.getRandomID();
        }
        else {
            FormUtils.randomGeneratedIDs.push(randomID);
            return randomID;
        }
    };
    FormUtils.removeRandomID = function (removedID) {
        var removedIndex = FormUtils.randomGeneratedIDs.indexOf(removedID);
        if (removedIndex !== -1) {
            FormUtils.randomGeneratedIDs.splice(removedID, 1);
        }
    };
    FormUtils.removeAllRandomIDs = function () {
        while (FormUtils.randomGeneratedIDs.length > 0) {
            FormUtils.randomGeneratedIDs.pop();
        }
    };
    FormUtils.isInputTextSelected = function (input) {
        if (typeof input.selectionStart == "number") {
            return input.selectionStart == 0 && input.selectionEnd == input.value.length;
        }
    };
    FormUtils.trimChoices = function (choices) {
        var trimmedChoices = [];
        _.forEach(choices, function (choice) {
            choice.text = choice.text.trim();
            trimmedChoices.push(choice);
        });
        return trimmedChoices;
    };
    FormUtils.randomGeneratedIDs = [];
    FormUtils.escaper = document.createElement('div');
    return FormUtils;
}());
var ColorUtils = (function () {
    function ColorUtils() {
    }
    ColorUtils.HSVtoRGB = function (pixel) {
        var r, g, b, i, f, p, q, t, s = pixel[1], v = pixel[2], h = pixel[0];
        i = (h * 6) | 0;
        f = h * 6 - i;
        p = v * (1 - s);
        q = v * (1 - f * s);
        t = v * (1 - (1 - f) * s);
        switch (i % 6) {
            case 0:
                r = v, g = t, b = p;
                break;
            case 1:
                r = q, g = v, b = p;
                break;
            case 2:
                r = p, g = v, b = t;
                break;
            case 3:
                r = p, g = q, b = v;
                break;
            case 4:
                r = t, g = p, b = v;
                break;
            case 5:
                r = v, g = p, b = q;
                break;
        }
        return [
            (r * 255) | 0,
            (g * 255) | 0,
            (b * 255) | 0,
            (undefined === pixel[3] ? 1 : pixel[3])
        ];
    };
    ColorUtils.diffc = function (c, v, diff) {
        return (v - c) / 6 / diff + 1 / 2;
    };
    ColorUtils.RGBtoHSV = function (pixel) {
        var rr, gg, bb, r = pixel[0] / 255, g = pixel[1] / 255, b = pixel[2] / 255, h, s, v = Math.max(r, g, b), diff = v - Math.min(r, g, b);
        if (diff == 0) {
            h = s = 0;
        }
        else {
            s = diff / v;
            rr = this.diffc(r, v, diff);
            gg = this.diffc(g, v, diff);
            bb = this.diffc(b, v, diff);
            if (r === v) {
                h = bb - gg;
            }
            else if (g === v) {
                h = (1 / 3) + rr - bb;
            }
            else if (b === v) {
                h = (2 / 3) + gg - rr;
            }
            if (h < 0) {
                h += 1;
            }
            else if (h > 1) {
                h -= 1;
            }
        }
        return [
            h,
            s,
            v,
            (undefined === pixel[3] ? 1 : pixel[3])
        ];
    };
    ColorUtils.strPad = function (s) {
        if (s.length < 2) {
            return '0' + s;
        }
        else {
            return s;
        }
    };
    ColorUtils.RGBToString = function (rgb, convertToStandardPaletteColorName) {
        if (convertToStandardPaletteColorName === void 0) { convertToStandardPaletteColorName = true; }
        if (undefined === rgb[3] || rgb[3] > 0.99) {
            var standardCSSRGBColorNotation = '#' + this.strPad(rgb[0].toString(16)) + ColorUtils.strPad(rgb[1].toString(16)) + ColorUtils.strPad(rgb[2].toString(16));
            if (convertToStandardPaletteColorName) {
                for (var standardPaletteColorName in this.standardHTMLColors) {
                    if (this.standardHTMLColors[standardPaletteColorName] === standardCSSRGBColorNotation) {
                        return standardPaletteColorName;
                    }
                }
            }
            return standardCSSRGBColorNotation;
        }
        else {
            if (rgb[3] === 0) {
                return 'transparent';
            }
            else {
                return 'rgba(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ',' + (rgb[3].toFixed(2).replace(/^0\./, '.').replace(/\.00$/, '').replace(/[0]+$/, '').replace(/^\.$/, '') || '0') + ')';
            }
        }
    };
    ColorUtils.HSVToString = function (hsl) {
        return ColorUtils.RGBToString(ColorUtils.HSVtoRGB(hsl));
    };
    ColorUtils.stringToRGB = function (cssColor) {
        var result = [0, 0, 0, 1], color = String(cssColor || '').toLowerCase(), matches;
        switch (true) {
            case 'transparent' === color:
                result[3] = 0;
                break;
            case undefined !== ColorUtils.standardHTMLColors[color]:
                return ColorUtils.stringToRGB(ColorUtils.standardHTMLColors[color]);
            case !!(matches = /^#[a-f0-9]{3}$/.exec(color)):
                result[0] = parseInt(color[1] + color[1], 16);
                result[1] = parseInt(color[2] + color[2], 16);
                result[2] = parseInt(color[3] + color[3], 16);
                break;
            case !!(matches = /^#[a-f0-9]{6}$/.exec(color)):
                result[0] = parseInt(color[1] + color[2], 16);
                result[1] = parseInt(color[3] + color[4], 16);
                result[2] = parseInt(color[5] + color[6], 16);
                break;
            case !!(matches = /^rgb\(([\s]+)?([\d]+)([\s]+)?,([\s]+)?([\d]+)([\s]+)?,([\s]+)?([\d]+)([\s]+)?\)$/.exec(color)):
                result[0] = parseInt(matches[2]);
                result[1] = parseInt(matches[5]);
                result[2] = parseInt(matches[8]);
                if (result[0] > 255 || result[1] > 255 || result[2] > 255) {
                    return null;
                }
                break;
            case !!(matches = /^rgba\(([\s]+)?([\d]+)([\s]+)?,([\s]+)?([\d]+)([\s]+)?,([\s]+)?([\d]+)([\s]+)?,([\s]+)?([\d\.]+)([\s]+)?\)$/.exec(color)):
                result[0] = parseInt(matches[2]);
                result[1] = parseInt(matches[5]);
                result[2] = parseInt(matches[8]);
                result[3] = parseFloat(matches[11]);
                if (result[0] > 255 || result[1] > 255 || result[2] > 255 || isNaN(result[3]) || !isFinite(result[3]) || result[3] > 1) {
                    return null;
                }
                break;
            default:
                return null;
        }
        return result;
    };
    ColorUtils.areEqualRGBColors = function (a, b) {
        if (!a || !b) {
            return false;
        }
        if (a === b) {
            return true;
        }
        return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];
    };
    ColorUtils.removeAlpha = function (color) {
        var result = color['slice'](0, 3);
        result.push(1);
        return result;
    };
    ColorUtils.standardHTMLColors = {
        "aliceblue": "#f0f8ff",
        "antiquewhite": "#faebd7",
        "aqua": "#00ffff",
        "aquamarine": "#7fffd4",
        "azure": "#f0ffff",
        "beige": "#f5f5dc",
        "bisque": "#ffe4c4",
        "black": "#000000",
        "blanchedalmond": "#ffebcd",
        "blue": "#0000ff",
        "blueviolet": "#8a2be2",
        "brown": "#a52a2a",
        "burlywood": "#deb887",
        "cadetblue": "#5f9ea0",
        "chartreuse": "#7fff00",
        "chocolate": "#d2691e",
        "coral": "#ff7f50",
        "cornflowerblue": "#6495ed",
        "cornsilk": "#fff8dc",
        "crimson": "#dc143c",
        "cyan": "#00ffff",
        "darkblue": "#00008b",
        "darkcyan": "#008b8b",
        "darkgoldenrod": "#b8860b",
        "darkgray": "#a9a9a9",
        "darkgreen": "#006400",
        "darkkhaki": "#bdb76b",
        "darkmagenta": "#8b008b",
        "darkolivegreen": "#556b2f",
        "darkorange": "#ff8c00",
        "darkorchid": "#9932cc",
        "darkred": "#8b0000",
        "darksalmon": "#e9967a",
        "darkseagreen": "#8fbc8f",
        "darkslateblue": "#483d8b",
        "darkslategray": "#2f4f4f",
        "darkturquoise": "#00ced1",
        "darkviolet": "#9400d3",
        "deeppink": "#ff1493",
        "deepskyblue": "#00bfff",
        "dimgray": "#696969",
        "dodgerblue": "#1e90ff",
        "firebrick": "#b22222",
        "floralwhite": "#fffaf0",
        "forestgreen": "#228b22",
        "fuchsia": "#ff00ff",
        "gainsboro": "#dcdcdc",
        "ghostwhite": "#f8f8ff",
        "gold": "#ffd700",
        "goldenrod": "#daa520",
        "gray": "#808080",
        "green": "#008000",
        "greenyellow": "#adff2f",
        "honeydew": "#f0fff0",
        "hotpink": "#ff69b4",
        "indianred  ": "#cd5c5c",
        "indigo   ": "#4b0082",
        "ivory": "#fffff0",
        "khaki": "#f0e68c",
        "lavender": "#e6e6fa",
        "lavenderblush": "#fff0f5",
        "lawngreen": "#7cfc00",
        "lemonchiffon": "#fffacd",
        "lightblue": "#add8e6",
        "lightcoral": "#f08080",
        "lightcyan": "#e0ffff",
        "lightgoldenrodyellow": "#fafad2",
        "lightgray": "#d3d3d3",
        "lightgreen": "#90ee90",
        "lightpink": "#ffb6c1",
        "lightsalmon": "#ffa07a",
        "lightseagreen": "#20b2aa",
        "lightskyblue": "#87cefa",
        "lightslategray": "#778899",
        "lightsteelblue": "#b0c4de",
        "lightyellow": "#ffffe0",
        "lime": "#00ff00",
        "limegreen": "#32cd32",
        "linen": "#faf0e6",
        "magenta": "#ff00ff",
        "maroon": "#800000",
        "mediumaquamarine": "#66cdaa",
        "mediumblue": "#0000cd",
        "mediumorchid": "#ba55d3",
        "mediumpurple": "#9370db",
        "mediumseagreen": "#3cb371",
        "mediumslateblue": "#7b68ee",
        "mediumspringgreen": "#00fa9a",
        "mediumturquoise": "#48d1cc",
        "mediumvioletred": "#c71585",
        "midnightblue": "#191970",
        "mintcream": "#f5fffa",
        "mistyrose": "#ffe4e1",
        "moccasin": "#ffe4b5",
        "navajowhite": "#ffdead",
        "navy": "#000080",
        "oldlace": "#fdf5e6",
        "olive": "#808000",
        "olivedrab": "#6b8e23",
        "orange": "#ffa500",
        "orangered": "#ff4500",
        "orchid": "#da70d6",
        "palegoldenrod": "#eee8aa",
        "palegreen": "#98fb98",
        "paleturquoise": "#afeeee",
        "palevioletred": "#db7093",
        "papayawhip": "#ffefd5",
        "peachpuff": "#ffdab9",
        "peru": "#cd853f",
        "pink": "#ffc0cb",
        "plum": "#dda0dd",
        "powderblue": "#b0e0e6",
        "purple": "#800080",
        "rebeccapurple": "#663399",
        "red": "#ff0000",
        "rosybrown": "#bc8f8f",
        "royalblue": "#4169e1",
        "saddlebrown": "#8b4513",
        "salmon": "#fa8072",
        "sandybrown": "#f4a460",
        "seagreen": "#2e8b57",
        "seashell": "#fff5ee",
        "sienna": "#a0522d",
        "silver": "#c0c0c0",
        "skyblue": "#87ceeb",
        "slateblue": "#6a5acd",
        "slategray": "#708090",
        "snow": "#fffafa",
        "springgreen": "#00ff7f",
        "steelblue": "#4682b4",
        "tan": "#d2b48c",
        "teal": "#008080",
        "thistle": "#d8bfd8",
        "tomato": "#ff6347",
        "turquoise": "#40e0d0",
        "violet": "#ee82ee",
        "wheat": "#f5deb3",
        "white": "#ffffff",
        "whitesmoke": "#f5f5f5",
        "yellow": "#ffff00",
        "yellowgreen": "#9acd32"
    };
    return ColorUtils;
}());
var NameUtils = (function () {
    function NameUtils() {
    }
    NameUtils.parseName = function (fullastName) {
        fullastName = String(this.trim(fullastName) || '');
        var nameParts = [], lastName = "", firstNameAndMiddleName = "", initials = "", word = null, j = 0, i = 0;
        nameParts = fullastName.split(" ").filter(function (namePart) {
            return (namePart.indexOf("(") === -1);
        });
        var numWords = nameParts.length;
        var salutation = this.getSalutation(nameParts[0]);
        var suffix = this.getSuffix(nameParts[numWords - 1]);
        var start = (salutation) ? 1 : 0;
        var end = (suffix) ? numWords - 1 : numWords;
        word = nameParts[start];
        if (this.isInitialName(word)) {
            if (this.isInitialName(nameParts[start + 1])) {
                firstNameAndMiddleName += " " + word.toUpperCase();
            }
            else {
                initials += " " + word.toUpperCase();
            }
        }
        else {
            firstNameAndMiddleName += " " + this.fixCase(word);
        }
        for (i = start + 1; i < (end - 1); i++) {
            word = nameParts[i];
            if (this.is_compound_lastName(word)) {
                if (!(this.isInitialName(word) && word === word.toUpperCase())) {
                    break;
                }
            }
            if (this.isInitialName(word)) {
                initials += " " + word.toUpperCase();
            }
            else {
                firstNameAndMiddleName += " " + this.fixCase(word);
            }
        }
        if ((end - start) > 1) {
            for (j = i; j < end; j++) {
                lastName += " " + this.fixCase(nameParts[j]);
            }
        }
        return {
            title: this.trim(salutation) || null,
            firstName: this.getFirstName(firstNameAndMiddleName) || null,
            middleName: this.getMiddleName(firstNameAndMiddleName) || null,
            initials: this.trim(initials) || null,
            lastName: this.trim(lastName) || null,
            suffix: this.trim(suffix) || null,
        };
    };
    NameUtils.isInitialName = function (word) {
        if (!word) {
            return false;
        }
        word = this.removeIgnoredChars(word);
        return (word.length === 1);
    };
    NameUtils.fixCase = function (word) {
        word = this.safeUCFirst("-", String(word || ''));
        word = this.safeUCFirst(".", String(word || ''));
        return word;
    };
    NameUtils.safeUCFirst = function (seperator, word) {
        return word.split(seperator).map(function (thisWord) {
            if (this.isCamelCaseString(thisWord)) {
                return thisWord;
            }
            else {
                return thisWord.substr(0, 1).toUpperCase() + thisWord.substr(1).toLowerCase();
            }
        }, this).join(seperator);
    };
    NameUtils.is_compound_lastName = function (word) {
        word = word.toLowerCase();
        return (this.COMPOUND_LAST_NAME_WORDS.indexOf(word) >= 0);
    };
    NameUtils.getSalutation = function (word) {
        word = this.removeIgnoredChars(word).toLowerCase();
        if (word === "mr" || word === "master" || word === "mister") {
            return "Mr.";
        }
        else if (word === "mrs") {
            return "Mrs.";
        }
        else if (word === "miss" || word === "ms") {
            return "Ms.";
        }
        else if (word === "dr") {
            return "Dr.";
        }
        else if (word === "rev") {
            return "Rev.";
        }
        else if (word === "fr") {
            return "Fr.";
        }
        else {
            return null;
        }
    };
    NameUtils.trim = function (s) {
        if (null === s) {
            return null;
        }
        return String(s || '').replace(/(^[\s]+|[\s]+$)/g, '');
    };
    NameUtils.getFirstName = function (compoundName) {
        return this.trim(String(compoundName || '')).split(/[\s]+/)[0] || null;
    };
    NameUtils.getMiddleName = function (compoundName) {
        return this.trim(String(compoundName || '')).split(/[\s]+/).slice(1).join(' ') || null;
    };
    NameUtils.COMPOUND_LAST_NAME_WORDS = [
        'vere', 'von', 'van', 'de', 'del', 'della', 'di', 'da',
        'pietro', 'vanden', 'du', 'st.', 'st', 'la', 'lo',
        'ter', 'o', "o'", 'mac', 'fitz'
    ];
    NameUtils.SUFFIX_ARRAY = [
        'I', 'II', 'III', 'IV', 'V', 'Senior', 'Junior', 'Jr', 'Sr', 'PhD', 'APR', 'RPh', 'PE', 'MD', 'MA', 'DMD', 'CME',
        "BVM", "CFRE", "CLU", "CPA", "CSC", "CSJ", "DC", "DD", "DDS", "DO", "DVM", "EdD", "Esq",
        "JD", "LLD", "OD", "OSB", "PC", "Ret", "RGS", "RN", "RNC", "SHCJ", "SJ", "SNJM", "SSMO",
        "USA", "USAF", "USAFR", "USAR", "USCG", "USMC", "USMCR", "USN", "USNR"
    ];
    NameUtils.removeIgnoredChars = function (word) {
        return String(word || '').replace(/\./g, "");
    };
    NameUtils.isCamelCaseString = function (word) {
        return /[A-Z]+/.test(word) && /[a-z]+/.test(word);
    };
    NameUtils.getSuffix = function (word) {
        word = this.removeIgnoredChars(String(word || '')).toLowerCase();
        var suffixIndex = this.SUFFIX_ARRAY.map(function (suffix) {
            return suffix.toLowerCase();
        }).indexOf(word);
        if (suffixIndex >= 0) {
            return this.SUFFIX_ARRAY[suffixIndex];
        }
        else {
            return null;
        }
    };
    return NameUtils;
}());
var Caret = (function () {
    function Caret(element) {
        this.element = element;
        this.isContentEditable = element.hasAttribute('contenteditable') && element.getAttribute('contenteditable') === 'true';
    }
    Caret.prototype.position = function (position) {
        if (position === undefined) {
            return this.getCaretPosition();
        }
        this.setCaretPosition(position);
    };
    Caret.prototype.getCaretPosition = function () {
        if (!document.body.contains(this.element)) {
            return;
        }
        if (this.isContentEditable) {
            this.element.focus();
            var position = 0;
            if (document.getSelection().rangeCount) {
                var _range = document.getSelection().getRangeAt(0), range = _range.cloneRange();
                range.selectNodeContents(this.element);
                range.setEnd(_range.endContainer, _range.endOffset);
                position = range.toString().length;
            }
            return position;
        }
        return this.element.selectionStart || 0;
    };
    Caret.prototype.setCaretPosition = function (position) {
        if (!document.body.contains(this.element)) {
            return;
        }
        if (this.isContentEditable) {
            this.element.focus();
            var childNodes = this.element.childNodes, i = 0, len = childNodes.length;
            for (; i < len; i++) {
                if (childNodes[i].textContent.length < position) {
                    position -= childNodes[i].textContent.length;
                }
                else {
                    if (childNodes[i].nodeType !== Node.TEXT_NODE) {
                        position = 0;
                        continue;
                    }
                    document.getSelection().collapse(childNodes[i], position);
                    break;
                }
            }
            return;
        }
        this.element.setSelectionRange(position, position);
    };
    return Caret;
}());
var I18nUtils = (function () {
    function I18nUtils() {
    }
    I18nUtils.addNoFollowOnLinks = function (htmlText) {
        var root = document.createElement('div'), links = root.getElementsByTagName('a');
        root.innerHTML = htmlText;
        Array.prototype.forEach.call(links, function (e) { return e.setAttribute('rel', 'nofollow ugc'); });
        return root.innerHTML;
    };
    return I18nUtils;
}());
var FocusManager = (function (_super) {
    __extends(FocusManager, _super);
    function FocusManager(document, jq) {
        var _this = _super.call(this) || this;
        _this.document = document;
        _this.jq = jq;
        _this.init();
        return _this;
    }
    FocusManager.prototype.init = function () {
        (function ($, self) {
            $(self.document.getRootNode())
                .on('keydown', 'label[data-role=checkbox], label[data-role=radio], div[data-role=star]', function (e) {
                var code = e.keyCode || e.charCode;
                if (13 === code || 10 === code || 32 === code) {
                    $(this).trigger('click');
                    e.preventDefault();
                    e.stopPropagation();
                }
            }).on('focus', '[data-is-single-focused], [data-is-single-focused] *', function (e) {
                if (!$(this).is('[data-is-focus-target]')) {
                    $(this).closest('[data-is-single-focused]').find('[data-is-focus-target]').focus();
                }
            }).on('keydown', '[data-is-single-focused], [data-is-single-focused] *', function (e) {
                if (KeyboardUtils.KEY_TAB !== (e.keyCode || e.charCode)) {
                    return;
                }
                var currentPage = $(this).closest('div[data-role=page]').get(0) || null, focusTarget = $(this).closest('[data-is-single-focused]').get(0) || null, focusableElementsBeforeFocusTarget = [], focusableElementsAfterFocusTarget = [], wasFoundFocusTarget = false, isBackwards = e.shiftKey;
                $(currentPage).find('input:not([disabled]), a[href]:not([disabled]), select:not([disabled]), textarea:not([disabled]), label[data-role=checkbox], label[data-role=radio], button:not([disabled]), *[data-is-single-focused]').each(function () {
                    if ($.contains(focusTarget, this)) {
                        return;
                    }
                    if (!this.offsetWidth || !this.offsetHeight) {
                        return;
                    }
                    if (this === focusTarget) {
                        wasFoundFocusTarget = true;
                    }
                    else {
                        if (wasFoundFocusTarget) {
                            focusableElementsAfterFocusTarget.push(this);
                        }
                        else {
                            focusableElementsBeforeFocusTarget.push(this);
                        }
                    }
                });
                var electedFocusElement;
                if (isBackwards) {
                    electedFocusElement = focusableElementsBeforeFocusTarget.pop() || focusableElementsAfterFocusTarget.pop() || null;
                }
                else {
                    electedFocusElement = focusableElementsAfterFocusTarget.shift() || focusableElementsBeforeFocusTarget.shift() || null;
                }
                if (null !== electedFocusElement) {
                    electedFocusElement.focus();
                    if (document.activeElement !== electedFocusElement) {
                        setTimeout(function () {
                            $(electedFocusElement).focus();
                        }, 0);
                    }
                    else {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                }
            });
        })(this.jq, this);
    };
    return FocusManager;
}(EventEmitter));
var Theme = (function (_super) {
    __extends(Theme, _super);
    function Theme(engine, externalTheme) {
        var _this = _super.call(this) || this;
        _this.wasThemeRenderedAtLeastOnce = false;
        _this.lastThemeSnapshot = null;
        _this.needsToTriggerChangeWhenEnteringEditMode = false;
        _this.savedThemeCurrentId = null;
        _this.savedThemeCurrentName = null;
        _this.computedProperties = {
            grid: {
                pageWidth: 0,
                pageWidthWithoutPadding: 0,
                columnWidth: 0,
                columnSpacing: 0,
                paddingLeft: 0,
                paddingRight: 0,
                paddingTop: 0,
                paddingBottom: 0,
                isEnabled: true,
                spaceReservedForColumnSpacing: 0,
            },
            container: {
                computedHorizontalPadding: 0,
            },
            other: {
                forcePagebreaks: false,
            },
            device: {
                isMobile: false,
                isDesktop: true,
            }
        };
        _this.lastThemeThumbnailsStyleElementCSSText = '';
        _this.cssTemplateText = null;
        _this.columnSizes = [];
        _this.currentSelectedThemeId = null;
        _this.externalTheme = null;
        _this.dirtyThemeThumbnailUpdater = Throttle.create(function () {
            _this.updateThemeThumbnailsCSSOnlyForCurrentTheme();
        }, 100);
        _this.engine = engine;
        _this.externalTheme = externalTheme;
        _this.styleElement = document.createElement('style');
        _this.themeThumbnailsStyleElement = document.createElement('style');
        _this.formCustomCSSFromUrl = document.createElement('link');
        _this.formCustomCSSFromUrl.setAttribute('rel', 'stylesheet');
        _this.formCustomCSSFromUrl.setAttribute('type', 'text/css');
        _this.formCustomCSSText = document.createElement('style');
        _this.themeThumbnailsStyleElement.setAttribute('data-role', 'theme-thumbnails-style');
        _this.cssExpressionParser = new CSSExpressionParser();
        _this.isMobilePlatform = (BrowserDetector.meetsRequirements('* * mobile * *') === '');
        _this.properties = _this.externalTheme.getDefaultThemeProperties();
        _this.createDefaultTheme();
        _this.init();
        return _this;
    }
    Theme.prototype.getEngine = function () {
        return this.engine;
    };
    Theme.prototype.getStyleElement = function () {
        return this.styleElement;
    };
    Theme.prototype.getFormCustomCSSTextStyleElement = function () {
        return this.formCustomCSSText;
    };
    Theme.prototype.getFormCustomCSSFromUrlElement = function () {
        return this.formCustomCSSFromUrl;
    };
    Theme.prototype.getThemeThumbnailsStyleElement = function () {
        return this.themeThumbnailsStyleElement;
    };
    Theme.prototype.getGridContainerElement = function () {
        return this.gridContainer;
    };
    Theme.prototype.mergeObject = function (src, dest) {
        if (!src) {
            return;
        }
        for (var key in src) {
            if (src.hasOwnProperty(key) && src.propertyIsEnumerable(key)) {
                if (src[key].constructor && src[key].constructor === Object) {
                    if (undefined === dest[key]) {
                        dest[key] = {};
                    }
                    else {
                        if (!(dest[key].constructor && dest[key].constructor === Object)) {
                            throw new Error('Failed to merge property "' + key + '" in ' + JSON.stringify(dest) + ': property is already defined, but is not of type object!');
                        }
                    }
                    this.mergeObject(src[key], dest[key]);
                }
                else {
                    if (undefined !== dest[key]) {
                        throw new Error('Failed to merge property "' + key + '" in ' + JSON.stringify(dest) + ': property is already defined');
                    }
                    dest[key] = src[key];
                }
            }
        }
    };
    Theme.prototype.getMergedProperties = function () {
        var result = {};
        this.mergeObject(this.properties, result);
        this.mergeObject(this.computedProperties, result);
        result.cols = this.columnSizes;
        this.externalTheme.overrideExternalManagedThemeProperties(result);
        return result;
    };
    Theme.prototype.parseCalcExpressionToMatchCorrectNumberOfBrackets = function (s) {
        var stack = 1, result = s.substr(0, 5);
        for (var i = 5, len = s.length; i < len; i++) {
            if (s[i] === '(') {
                stack++;
                result += '(';
            }
            else {
                if (s[i] === ')') {
                    stack--;
                    result += ')';
                    if (stack === 0) {
                        return result;
                    }
                }
                else {
                    result += s[i];
                }
            }
        }
        return s;
    };
    Theme.prototype.optimizeCSS = function (css) {
        var _this = this;
        var initialCSSSize;
        if (EngineToggles.VERBOSE_CONSOLE) {
            initialCSSSize = css.length;
        }
        css = css.replace(/(calc\([\s\S]+?\))([\s]+)?(;|$|\})/g, function (substring) {
            var matches = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                matches[_i - 1] = arguments[_i];
            }
            var calcExpression = _this.parseCalcExpressionToMatchCorrectNumberOfBrackets(substring), remainingBuffer = substring.substr(calcExpression.length);
            return _this.cssExpressionParser.simplifyCSSCalcExpression(calcExpression) + remainingBuffer;
        }).replace(/[\s]+/g, ' ').replace(/\/\*([\s\S]+?)\*\//g, '');
        if (EngineToggles.VERBOSE_CONSOLE) {
            console.warn('minify: ', initialCSSSize, '=>', css.length, initialCSSSize - css.length);
        }
        return css;
    };
    Theme.prototype.recomputeInImmediateMode = function () {
        if (null === this.cssTemplateText) {
            return;
        }
        if (!this.wasThemeRenderedAtLeastOnce) {
            this.engine.trigger('theme-before-render');
        }
        console.log('theme: recompute');
        this.themeTemplate = this.themeTemplate || new Salvage(this.cssTemplateText);
        this.recomputeDynamicPropertiesInImmediateMode();
        var model = this.getMergedProperties();
        if (EngineToggles.ALLOW_CSS_OPTIMIZATIONS) {
            this.styleElement.textContent = this.optimizeCSS(this.themeTemplate.parse(model));
        }
        else {
            this.styleElement.textContent = this.themeTemplate.parse(model);
        }
        if (!this.wasThemeRenderedAtLeastOnce) {
            this.engine.trigger('theme-ready');
            this.wasThemeRenderedAtLeastOnce = true;
        }
        FormUtils.refreshFrameHeightOnWix();
    };
    Theme.prototype.init = function () {
        (function (self) {
            self.initializeGridDOMElementAndColumnsStructure();
            self.recompute = Throttle.create(function () {
                self.recomputeInImmediateMode();
            }, 0);
            self.externalTheme.on('change', function () {
                self.recompute();
                self.trigger('repaint-only');
            });
            self.onThemeSettingsChangedDeferred = Throttle.create(function () {
                console.log('theme-settings-changed-throttler');
                self.onThemeSettingsChanged();
            }, 0);
            self.engine
                .getResourceManager()
                .get('/modules/Typescript/Form/resources/theme.template.txt')
                .then(function (cssTemplateText) {
                self.cssTemplateText = cssTemplateText;
                self.recomputeInImmediateMode();
            })
                .fail(function (e) {
                console.error('Failed to initialize Form Theme');
                console.error(e);
            });
            self.on('load', function () {
                self.updateThemeThumbnailsCSS();
            });
            setTimeout(function () {
                self.engine.getDocument().getConfiguration().on('change', function (configurationPropertyName, configurationPropertyValue) {
                    if (configurationPropertyName === 'customCssFromUrl') {
                        self.updateCustomFormCSSFromUrl();
                    }
                    if (configurationPropertyName === 'customCss') {
                        self.updateCustomFormCSSText();
                    }
                });
            }, 50);
            Salvage.addHelper({
                name: 'LABEL_STATE_FORMATTER',
                func: function (str) {
                    return str.replace(/([\s]+)(Disabled|Error|Focused|Hover|Normal|Selected)([\s]+)/ig, ' <span class="state">$2</span> ');
                }
            });
        })(this);
    };
    Theme.prototype.recomputeDynamicPropertiesInImmediateMode = function () {
        this.computedProperties.grid.paddingBottom = ~~parseInt(this.properties.page.padding.bottom);
        this.computedProperties.grid.paddingLeft = ~~parseInt(this.properties.page.padding.left);
        this.computedProperties.grid.paddingRight = ~~parseInt(this.properties.page.padding.right);
        this.computedProperties.grid.paddingTop = ~~parseInt(this.properties.page.padding.top);
        this.computedProperties.device.isMobile = this.isMobilePlatform;
        this.computedProperties.device.isDesktop = !this.isMobilePlatform;
        var pageWidth = this.engine.getDocument().getPageWidth(), pageWidthWithoutPadding = pageWidth - this.computedProperties.grid.paddingLeft - this.computedProperties.grid.paddingRight;
        if (pageWidthWithoutPadding < 0) {
            pageWidthWithoutPadding = 0;
        }
        var containerHorizontalPadding = ~~parseInt(this.properties.container.padding.horizontal), columnSpacing = 2 * containerHorizontalPadding, spaceReservedForColumnSpacing = pageWidthWithoutPadding - (20 * columnSpacing), spaceReservedForGridColumns = pageWidthWithoutPadding - spaceReservedForColumnSpacing;
        this.computedProperties.grid.isEnabled = spaceReservedForColumnSpacing >= 200;
        var gridColumnWidth = ~~(spaceReservedForColumnSpacing / 20), numberOfColumnsDividedByThird, numberOfColumnsDividedByHalf, numberOfColumnsDividedByQuarter, columnUnitWidthWithHorizontalPaddingAdded = gridColumnWidth + columnSpacing;
        this.computedProperties.grid.spaceReservedForColumnSpacing = spaceReservedForColumnSpacing;
        this.computedProperties.grid.pageWidth = pageWidth - (pageWidthWithoutPadding % columnUnitWidthWithHorizontalPaddingAdded);
        this.computedProperties.grid.pageWidthWithoutPadding = pageWidthWithoutPadding - (pageWidthWithoutPadding % columnUnitWidthWithHorizontalPaddingAdded);
        this.computedProperties.container.computedHorizontalPadding = containerHorizontalPadding;
        this.computedProperties.grid.columnWidth = ~~gridColumnWidth;
        this.computedProperties.grid.columnSpacing = columnSpacing;
        for (var i = 0; i < 20; i++) {
            this.columnSizes[i].width = this.columnSizes[i].colspan * columnUnitWidthWithHorizontalPaddingAdded;
            this.columnSizes[i].widthWithoutPadding = this.columnSizes[i].width - columnSpacing;
            numberOfColumnsDividedByQuarter = ~~(this.columnSizes[i].colspan / 4);
            numberOfColumnsDividedByThird = ~~(this.columnSizes[i].colspan / 3);
            numberOfColumnsDividedByHalf = ~~(this.columnSizes[i].colspan / 2);
            this.columnSizes[i].full = this.columnSizes[i].colspan * columnUnitWidthWithHorizontalPaddingAdded - columnSpacing;
            this.columnSizes[i].quarter = numberOfColumnsDividedByQuarter * columnUnitWidthWithHorizontalPaddingAdded - columnSpacing;
            this.columnSizes[i].third = numberOfColumnsDividedByThird * columnUnitWidthWithHorizontalPaddingAdded - columnSpacing;
            this.columnSizes[i].half = numberOfColumnsDividedByHalf * columnUnitWidthWithHorizontalPaddingAdded - columnSpacing;
        }
        if (!this.computedProperties.grid.isEnabled !== this.mobileLayout) {
            this.mobileLayout = !this.computedProperties.grid.isEnabled;
            this.engine.reconfigureLayoutInImmediateMode();
            this.engine.getForm().setAttribute('data-layout-type', this.mobileLayout ? 'mobile' : 'desktop');
        }
        this.computedProperties.other.forcePagebreaks = ~~parseInt(this.properties.page.margin.bottom) + ~~parseInt(this.properties.page.margin.top) < 36;
    };
    Theme.prototype.isGridEnabled = function () {
        return this.computedProperties.grid.isEnabled;
    };
    Theme.prototype.initializeGridDOMElementAndColumnsStructure = function () {
        var column, edge;
        this.gridContainer = document.createElement('div');
        this.gridContainer.setAttribute('data-role', 'grid');
        edge = document.createElement('div');
        edge.setAttribute('data-role', 'edge');
        edge.setAttribute('data-edge', 'top');
        this.gridContainer.appendChild(edge);
        edge = document.createElement('div');
        edge.setAttribute('data-role', 'edge');
        edge.setAttribute('data-edge', 'left');
        this.gridContainer.appendChild(edge);
        edge = document.createElement('div');
        edge.setAttribute('data-role', 'edge');
        edge.setAttribute('data-edge', 'right');
        this.gridContainer.appendChild(edge);
        edge = document.createElement('div');
        edge.setAttribute('data-role', 'edge');
        edge.setAttribute('data-edge', 'bottom');
        this.gridContainer.appendChild(edge);
        for (var i = 0, len = 20; i < len; i++) {
            this.columnSizes.push({
                colspan: i + 1,
                width: 0,
                quarter: 0,
                third: 0,
                half: 0,
                full: 0,
                widthWithoutPadding: 0,
                additionalCSSClass: ['1u', '2u', '3u', '4u'][i] || undefined
            });
            column = document.createElement('div');
            column.setAttribute('data-index', String(i + 1));
            column.setAttribute('data-role', 'col');
            column.textContent = String(i + 1);
            this.gridContainer.appendChild(column);
        }
    };
    Theme.prototype.enumerateProperties = function (withIsColorProperty) {
        if (withIsColorProperty === void 0) { withIsColorProperty = true; }
        var result = [], property;
        this.flatten(this.properties, [], result, withIsColorProperty);
        for (var i = 0, len = Theme.virtualProperties.length; i < len; i++) {
            property = {
                name: Theme.virtualProperties[i].name,
                isColor: Theme.virtualProperties[i].isColor,
                value: undefined
            };
            Object.defineProperty(property, 'value', {
                get: Theme.virtualProperties[i].getter.bind(this),
                set: Theme.virtualProperties[i].setter.bind(this),
            });
            result.push(property);
        }
        result.sort(function (propA, propB) {
            var aName = propA.name.toLowerCase(), bName = propB.name.toLowerCase();
            return aName === bName
                ? 0
                : aName < bName
                    ? -1
                    : 1;
        });
        return result;
    };
    Theme.prototype.setProperty = function (propertyFQN, propertyValue) {
        if ('string' !== typeof propertyFQN) {
            return null;
        }
        if (Theme.PROPERTIES_THAT_TRIGGER_DIRTY_THEME_THUMBNAIL_UPDATE.indexOf(propertyFQN) > -1) {
            this.dirtyThemeThumbnailUpdater();
        }
        this.onThemeSettingsChangedDeferred();
        var parts = propertyFQN.split('_'), cursor = this.properties, numberOfParts = parts.length;
        for (var i = 0, len = numberOfParts - 1; i < len; i++) {
            if (!parts[i]) {
                console.warn('Invalid propertyFQN: ' + JSON.stringify(propertyFQN));
                return this;
            }
            if (cursor.hasOwnProperty(parts[i])) {
                cursor = cursor[parts[i]];
            }
            else {
                console.warn('Invalid propertyFQN: ' + JSON.stringify(propertyFQN));
                return this;
            }
        }
        if (typeof cursor[parts[numberOfParts - 1]] === 'object' || typeof cursor[parts[numberOfParts - 1]] === 'undefined') {
            console.warn('Theme: Invalid propertyFQN: ' + JSON.stringify(propertyFQN) + '. Property ignored');
            return this;
        }
        cursor[parts[numberOfParts - 1]] = propertyValue;
        if (null === this.lastThemeSnapshot) {
            this.trigger('property-changed', propertyFQN, propertyValue);
            this.trigger('change');
        }
        else {
            this.trigger('repaint-only');
            this.needsToTriggerChangeWhenEnteringEditMode = true;
        }
        if (/_font_family$/.test(propertyFQN) && propertyValue) {
            if (propertyFQN === Theme.THUMBNAIL_PROPERTY_NAME_FONT_FAMILY) {
                this.trigger('theme-font-changed', propertyValue);
            }
            this.getEngine().getLoader().getLoaderDependency(ELoaderDependency.FONTS_MANAGER).loadFont(propertyValue).then(function () {
                console.log('Font loaded:' + propertyValue);
            });
        }
        if (this.externalTheme.isPropertyManaged(propertyFQN)) {
            this.externalTheme.setProperty(propertyFQN, propertyValue);
        }
        if (propertyFQN === 'page_background_color') {
            this.onPageBackgroundColorChanged();
        }
        return this;
    };
    Theme.prototype.flatten = function (o, prefix, result, withIsColorProperty) {
        if (withIsColorProperty === void 0) { withIsColorProperty = true; }
        if (o && 'object' === typeof o) {
            for (var propertyName in o) {
                if (o.hasOwnProperty(propertyName)) {
                    prefix.push(propertyName);
                    if (typeof o[propertyName] === 'object') {
                        this.flatten(o[propertyName], prefix, result, withIsColorProperty);
                    }
                    else {
                        var valueAsColor = FormUtils.getNormalizedCSSColorNotationFromString(o[propertyName]), isColor = !!valueAsColor, item = {
                            name: prefix.join('_'),
                            value: isColor ? valueAsColor : o[propertyName],
                        };
                        if (withIsColorProperty) {
                            item.isColor = isColor;
                        }
                        result.push(item);
                    }
                    prefix.pop();
                }
            }
        }
    };
    Theme.prototype.getThemesList = function () {
        var result = [];
        var currentThemeHash = Hash.MD5(JSON.stringify(this.enumerateProperties(false))), themeHash;
        for (var i = 0, len = Theme.availableThemes.length; i < len; i++) {
            themeHash = Hash.MD5(Theme.availableThemes[i].value);
            result.push({
                id: Theme.availableThemes[i].id,
                userId: Theme.availableThemes[i].userId,
                name: Theme.availableThemes[i].name,
                isCurrentTheme: currentThemeHash === themeHash,
            });
        }
        return result;
    };
    Theme.prototype.onThemeSettingsChanged = function () {
        var currentSelectedThemeId = null;
        for (var themes = this.getThemesList(), i = 0, len = themes.length; i < len; i++) {
            if (themes[i].isCurrentTheme) {
                currentSelectedThemeId = themes[i].id;
                break;
            }
        }
        if (currentSelectedThemeId !== this.currentSelectedThemeId) {
            this.currentSelectedThemeId = currentSelectedThemeId;
            this.trigger('theme-changed', currentSelectedThemeId);
        }
    };
    Theme.prototype.getThemeById = function (themeId) {
        if (null === themeId && this.lastThemeSnapshot) {
            return this.lastThemeSnapshot;
        }
        for (var i = 0, len = Theme.availableThemes.length; i < len; i++) {
            if (Theme.availableThemes[i].id === themeId) {
                return Theme.availableThemes[i];
            }
        }
        return null;
    };
    Theme.prototype.applyTheme = function (theme) {
        if (null === theme) {
            return;
        }
        try {
            if (!(theme instanceof Object)) {
                throw new Error('Object expected!');
            }
            if ('number' !== typeof theme.id && 'null' !== theme.id && null !== theme.id) {
                throw new Error('Integer expected!');
            }
            if ('string' !== typeof theme.value) {
                throw new Error('String expected!');
            }
            var themeDecodedAsJSON = void 0;
            try {
                themeDecodedAsJSON = JSON.parse(theme.value);
            }
            catch (e) {
                throw new Error('Failed to decode theme! The theme.value is not a valid JSON structure!');
            }
            if (!(themeDecodedAsJSON instanceof Array)) {
                throw new Error('Decoded theme value as JSON is not of type Array!');
            }
            for (var i = 0, len = themeDecodedAsJSON.length; i < len; i++) {
                if (!(themeDecodedAsJSON[i] instanceof Object)) {
                    throw new Error('Failed to apply theme. Theme property #' + (i) + ' is not of type "Object"');
                }
                if ('string' !== typeof themeDecodedAsJSON[i].name) {
                    throw new Error('Failed to apply theme. At index ' + (i) + ' the property "name" is missing or is not of type "string"');
                }
                if (undefined === typeof themeDecodedAsJSON[i].value) {
                    throw new Error('Failed to apply theme. At index ' + (i) + ' the property "value" is undefined!');
                }
            }
            this.disableEvents();
            for (var i = 0, len = themeDecodedAsJSON.length; i < len; i++) {
                var themePropertyName = themeDecodedAsJSON[i].name, themePropertyValue = themeDecodedAsJSON[i].value;
                try {
                    this.setProperty(themePropertyName, themePropertyValue);
                    console.log(themePropertyName, themePropertyValue);
                }
                catch (e) {
                    console.warn('Apply Theme: Failed to apply theme property '
                        + JSON.stringify(themePropertyName)
                        + ' value '
                        + JSON.stringify(themePropertyValue)
                        + ': Either property does not exist, or has a invalid value');
                }
            }
            this.enableEvents();
            if (this.lastThemeSnapshot === null) {
                this.engine.getDocument().getConfiguration()
                    .withProperty('themeCurrentId', theme.id)
                    .withProperty('themeCurrentName', theme.name);
                this.trigger('change');
                for (var i = 0, properties = this.enumerateProperties(), len = properties.length; i < len; i++) {
                    this.trigger('property-changed', properties[i].name, properties[i].value);
                }
            }
            else {
                this.savedThemeCurrentId = theme.id;
                this.savedThemeCurrentName = theme.name;
                this.trigger('repaint-only');
                this.needsToTriggerChangeWhenEnteringEditMode = true;
            }
            this.externalTheme.trigger('theme-id-changed', theme.id);
        }
        catch (e) {
            console.warn('We could not apply your theme correctly! Please contact "http://www.123contactform.com" support for more information about this error!');
            console.error(e);
        }
    };
    Theme.prototype.getCurrentThemeId = function () {
        return this.currentSelectedThemeId;
    };
    Theme.prototype.isMobileLayout = function () {
        return this.mobileLayout || false;
    };
    Theme.prototype.getComputedColumnWidth = function () {
        return this.computedProperties.grid.columnWidth;
    };
    Theme.prototype.getComputedColumnSpacing = function () {
        return this.computedProperties.grid.columnSpacing;
    };
    Theme.addVirtualProperty = function (name, getter, setter, isColor) {
        this.virtualProperties.push({
            name: name,
            isColor: isColor,
            getter: getter,
            setter: setter,
        });
    };
    Theme.prototype.getCSSExpressionParser = function () {
        return this.cssExpressionParser;
    };
    Theme.prototype.createDefaultTheme = function () {
        if (undefined === Theme.defaultTheme) {
            Theme.defaultTheme = {
                id: 0,
                userId: null,
                value: JSON.stringify(this.enumerateProperties(false)),
                name: 'Default',
                customCSSText: null,
                customCSSUrl: null,
            };
            Theme.availableThemes = [
                Theme.defaultTheme
            ];
            Theme.PROPERTIES_THAT_TRIGGER_DIRTY_THEME_THUMBNAIL_UPDATE = [
                Theme.THUMBNAIL_PROPERTY_NAME_COLOR_0,
                Theme.THUMBNAIL_PROPERTY_NAME_COLOR_1,
                Theme.THUMBNAIL_PROPERTY_NAME_COLOR_2,
                Theme.THUMBNAIL_PROPERTY_NAME_COLOR_3,
                Theme.THUMBNAIL_PROPERTY_NAME_FONT_FAMILY,
                Theme.THUMBNAIL_PROPERTY_NAME_FONT_SIZE,
                Theme.THUMBNAIL_PROPERTY_NAME_FONT_WEIGHT,
                Theme.THUMBNAIL_PROPERTY_NAME_FONT_COLOR,
            ];
            this.updateThemeThumbnailsCSS();
        }
    };
    Theme.getDefaultTheme = function () {
        return this.defaultTheme;
    };
    Theme.prototype.updateThemeThumbnailsCSS = function () {
        var settings, cssText = '/** THEME THUMBNAILS (Theme::updateThemeThumbnailsCSS) **/\n';
        settings = this.getThemeThumbnailSettings({
            id: "null",
            value: JSON.stringify(this.enumerateProperties(false)),
        });
        cssText += this.generateThumbnailCSSText(settings);
        for (var i = 0, len = Theme.availableThemes.length; i < len; i++) {
            settings = this.getThemeThumbnailSettings(Theme.availableThemes[i]);
            cssText += this.generateThumbnailCSSText(settings);
        }
        this.lastThemeThumbnailsStyleElementCSSText = cssText;
        this.themeThumbnailsStyleElement.textContent = cssText;
    };
    Theme.prototype.updateThemeThumbnailsCSSOnlyForCurrentTheme = function () {
        var firstBlockIndex = this.lastThemeThumbnailsStyleElementCSSText.indexOf('/** DELIMITER **/ '), updatePart, keepPart = -1 === firstBlockIndex
            ? this.lastThemeThumbnailsStyleElementCSSText
            : this.lastThemeThumbnailsStyleElementCSSText.substr(firstBlockIndex + 17);
        updatePart = this.generateThumbnailCSSText(this.getThemeThumbnailSettings({
            id: "null",
            value: this.lastThemeSnapshot
                ? this.lastThemeSnapshot.value
                : JSON.stringify(this.enumerateProperties(false)),
        }));
        this.lastThemeThumbnailsStyleElementCSSText = updatePart + keepPart;
        this.themeThumbnailsStyleElement.textContent = this.lastThemeThumbnailsStyleElementCSSText;
    };
    Theme.prototype.generateThumbnailCSSText = function (settings) {
        var result = '', selector;
        selector = 'div[data-role=theme][data-theme-id="' + settings.theme_id + '"] > .thumbnail > ';
        if (settings.color_0) {
            result += (selector + 'div:nth-child(1) { background-color: ' + settings.color_0 + '; } ');
        }
        if (settings.color_1) {
            result += (selector + 'div:nth-child(2) { background-color: ' + settings.color_1 + '; } ');
        }
        if (settings.color_2) {
            result += (selector + 'div:nth-child(3) { background-color: ' + settings.color_2 + '; } ');
        }
        if (settings.color_3) {
            result += (selector + 'div:nth-child(4) { background-color: ' + settings.color_3 + '; } ');
        }
        if (settings.font_family || settings.font_size || settings.font_weight || settings.font_color) {
            result += (selector + 'div:nth-child(5) { ');
            if (settings.font_family) {
                result += 'font-family: ' + settings.font_family + ';';
            }
            if (settings.font_size) {
                result += 'font-size: ' + settings.font_size + ';';
            }
            if (settings.font_weight) {
                result += 'font-weight: ' + settings.font_weight + ';';
            }
            if (settings.font_color) {
                result += 'color: ' + settings.font_color + ';';
            }
            result += '}';
        }
        result += ' /** DELIMITER **/ ';
        return result;
    };
    Theme.prototype.getThemeThumbnailSettings = function (theme) {
        var fontsManager = this.engine.getLoader().getLoaderDependency(ELoaderDependency.FONTS_MANAGER);
        var values = JSON.parse(theme.value), result = {
            theme_id: String(theme.id),
            userId: theme.userId,
            color_0: '',
            color_1: '',
            color_2: '',
            color_3: '',
            font_family: 'Open Sans',
            font_size: '23px',
            font_weight: '',
            font_color: '#444',
            webfont_class: null
        }, propertiesFound = 0;
        for (var i = 0, len = values.length; i < len; i++) {
            switch (values[i].name) {
                case Theme.THUMBNAIL_PROPERTY_NAME_COLOR_0:
                    result.color_0 = values[i].value;
                    propertiesFound++;
                    break;
                case Theme.THUMBNAIL_PROPERTY_NAME_COLOR_1:
                    result.color_1 = values[i].value;
                    propertiesFound++;
                    break;
                case Theme.THUMBNAIL_PROPERTY_NAME_COLOR_2:
                    result.color_2 = values[i].value;
                    propertiesFound++;
                    break;
                case Theme.THUMBNAIL_PROPERTY_NAME_COLOR_3:
                    result.color_3 = values[i].value;
                    propertiesFound++;
                    break;
                case Theme.THUMBNAIL_PROPERTY_NAME_FONT_FAMILY:
                    result.font_family = values[i].value;
                    try {
                        var fontByName = fontsManager.getFontByName(values[i].value);
                        result.webfont_class = fontsManager.isSystemFont(values[i].value) ? null : (fontByName === null ? null : fontByName.cssClassAaBbCc);
                    }
                    catch (e) {
                        result.webfont_class = null;
                    }
                    propertiesFound++;
                    break;
                case Theme.THUMBNAIL_PROPERTY_NAME_FONT_SIZE:
                    propertiesFound++;
                    break;
                case Theme.THUMBNAIL_PROPERTY_NAME_FONT_WEIGHT:
                    result.font_weight = values[i].value;
                    propertiesFound++;
                    break;
                case Theme.THUMBNAIL_PROPERTY_NAME_FONT_COLOR:
                    result.font_color = values[i].value;
                    propertiesFound++;
                    break;
            }
            if (propertiesFound === 8) {
                break;
            }
        }
        return result;
    };
    Theme.prototype.getCurrentThemeName = function () {
        var lastAppliedThemeId = this.engine.getDocument().getConfiguration().getProperty('themeCurrentId', 0), lastAppliedThemeName = this.engine.getDocument().getConfiguration().getProperty('themeCurrentName', Theme.defaultTheme.name);
        for (var i = 0, len = Theme.availableThemes.length; i < len; i++) {
            if (Theme.availableThemes[i].id === lastAppliedThemeId) {
                return Theme.availableThemes[i].name;
            }
        }
        return lastAppliedThemeName;
    };
    Theme.prototype.enterPreviewMode = function () {
        if (this.lastThemeSnapshot) {
            return;
        }
        console.warn('Theme: ENTER PREVIEW MODE');
        this.needsToTriggerChangeWhenEnteringEditMode = false;
        var theme = {
            name: this.getCurrentThemeName(),
            id: null,
            userId: null,
            value: JSON.stringify(this.enumerateProperties(false)),
            customCSSText: null,
            customCSSUrl: null,
        };
        this.lastThemeSnapshot = theme;
        this.updateThemeThumbnailsCSSOnlyForCurrentTheme();
        this.trigger('enter-preview-mode');
    };
    Theme.prototype.enterEditMode = function () {
        if (this.lastThemeSnapshot === null) {
            return;
        }
        console.warn('Theme: ENTER EDIT MODE');
        this.lastThemeSnapshot = null;
        this.trigger('enter-edit-mode');
        if (this.needsToTriggerChangeWhenEnteringEditMode) {
            this.trigger('change');
            if (this.savedThemeCurrentId !== null) {
                this.engine.getDocument().getConfiguration()
                    .withProperty('themeCurrentName', this.savedThemeCurrentName);
                this.engine.getDocument().getConfiguration()
                    .withProperty('themeCurrentId', this.savedThemeCurrentId);
            }
            this.needsToTriggerChangeWhenEnteringEditMode = false;
        }
        this.updateThemeThumbnailsCSSOnlyForCurrentTheme();
    };
    Theme.prototype.updateCustomFormCSSText = function () {
        if (this.engine.getLoader().getLoaderType() === EFormLoaderType.VIEW) {
            this.formCustomCSSText.textContent = this.engine.getDocument().getConfiguration().getProperty('customCss') || '';
        }
        else {
            (function (self, $) {
                var customCSSText = self.engine.getDocument().getConfiguration().getProperty('customCss');
                if (!customCSSText) {
                    self.formCustomCSSText.textContent = '';
                    return;
                }
                $.ajax({
                    "url": "/modules/CSSProxy/inline_css/",
                    "data": {
                        "css": Hash.hexEncode(customCSSText)
                    },
                    "type": "POST",
                    cache: false,
                })
                    .then(function (result) {
                    self.formCustomCSSText.textContent = result;
                    self.getEngine().getLoader().getCommandDispatcher().updateCustomCSSErrorDOMNodes(false, "custom-css");
                })
                    .fail(function (result) {
                    self.formCustomCSSText.textContent = "";
                    self.getEngine().getLoader().getCommandDispatcher().updateCustomCSSErrorDOMNodes(true, "custom-css");
                });
            })(this, this.engine.getJQuery());
        }
    };
    Theme.prototype.updateCustomFormCSSFromUrl = function () {
        var customCssUrl = this.engine.getDocument().getConfiguration().getProperty('customCssFromUrl');
        if (!customCssUrl) {
            this.formCustomCSSFromUrl.removeAttribute('href');
        }
        else {
            if (this.engine.getLoader().getLoaderType() === EFormLoaderType.VIEW) {
                this.formCustomCSSFromUrl.setAttribute('href', customCssUrl || '');
            }
            else {
                var proxyfiedURL = '/modules/CSSProxy/url/' + Hash.hexEncode(customCssUrl) + '/';
                if (!proxyfiedURL) {
                    this.formCustomCSSFromUrl.removeAttribute('href');
                }
                else {
                    this.formCustomCSSFromUrl.setAttribute('href', proxyfiedURL || '');
                }
            }
        }
    };
    Theme.prototype.getExternalTheme = function () {
        return this.externalTheme;
    };
    Theme.prototype.onPageBackgroundColorChanged = function () {
        if (this.properties.page.background.color === 'transparent') {
            this.engine.getDocument().getRootNode().setAttribute('data-page-background-transparent', '1');
        }
        else {
            this.engine.getDocument().getRootNode().removeAttribute('data-page-background-transparent');
        }
    };
    Theme.THUMBNAIL_PROPERTY_NAME_COLOR_0 = 'form_background_color';
    Theme.THUMBNAIL_PROPERTY_NAME_COLOR_1 = 'page_background_color';
    Theme.THUMBNAIL_PROPERTY_NAME_COLOR_2 = 'input_normal_background_color';
    Theme.THUMBNAIL_PROPERTY_NAME_COLOR_3 = 'input_focused_background_color';
    Theme.THUMBNAIL_PROPERTY_NAME_FONT_FAMILY = 'form_font_family';
    Theme.THUMBNAIL_PROPERTY_NAME_FONT_SIZE = 'form_font_size';
    Theme.THUMBNAIL_PROPERTY_NAME_FONT_WEIGHT = 'form_font_weight';
    Theme.THUMBNAIL_PROPERTY_NAME_FONT_COLOR = 'input_normal_color';
    Theme.PROPERTIES_THAT_TRIGGER_DIRTY_THEME_THUMBNAIL_UPDATE = [];
    Theme.virtualProperties = [];
    Theme.availableThemes = [];
    return Theme;
}(EventEmitter));
var ExternalThemeManagedByWix = (function (_super) {
    __extends(ExternalThemeManagedByWix, _super);
    function ExternalThemeManagedByWix() {
        var _this = _super.call(this) || this;
        _this.defaults = {
            colors: {
                selected: {
                    color: "#0396ff"
                }
            },
            form: {
                background: {
                    color: "transparent",
                    image: "",
                    position: "top left",
                    repeat: "repeat",
                    size: "original",
                    attachment: "fixed"
                },
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                color: "#3e6680"
            },
            page: {
                background: {
                    color: "#ffffff",
                    image: "",
                    position: "center",
                    repeat: "no-repeat",
                    size: "cover",
                    attachment: "scroll"
                },
                border: {
                    width: "0px",
                    style: "none",
                    color: "#3e6680"
                },
                margin: {
                    bottom: "40px",
                    top: "40px"
                },
                padding: {
                    top: "20px",
                    left: "20px",
                    right: "20px",
                    bottom: "20px"
                },
                shadow: {
                    visibility: "1"
                }
            },
            container: {
                padding: {
                    horizontal: "8px",
                    vertical: "8px"
                }
            },
            control: {
                border: {
                    width: "0px",
                    style: "none",
                    radius: "0px"
                },
                disabled: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                focused: {
                    background: {
                        color: "rgba(204,204,204,.4)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                selected: {
                    background: {
                        color: "rgba(204,204,204,.4)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                error: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                hover: {
                    background: {
                        color: "rgba(204,204,204,.2)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                normal: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                required: {
                    star: {
                        color: "rgba(255, 0, 0, 1)"
                    }
                }
            },
            input: {
                border: {
                    width: "1px",
                    style: "solid",
                    radius: "3px"
                },
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    vertical: "8px",
                    horizontal: "8px"
                },
                margin: {
                    vertical: "16px"
                },
                disabled: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "rgba(204,204,204,.5)"
                    },
                    color: "rgba(76,76,76,.5)"
                },
                focused: {
                    background: {
                        color: "rgba(0, 148, 255, .1)"
                    },
                    border: {
                        color: "#0396ff"
                    },
                    color: "#4c4c4c"
                },
                selected: {
                    background: {
                        color: "rgba(0,153,204,.1)"
                    },
                    border: {
                        color: "#0099cc"
                    },
                    color: "#4c4c4c"
                },
                error: {
                    background: {
                        color: "rgba(250, 72, 72, .11)"
                    },
                    border: {
                        color: "#fa4848"
                    },
                    color: "#3e6680"
                },
                hover: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "#0396ff"
                    },
                    color: "#4c4c4c"
                },
                normal: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "#cccccc"
                    },
                    color: "#4c4c4c",
                    placeholderColor: "initial"
                }
            },
            checkbox: {
                width: "16px",
                height: "16px",
                margin: "8px"
            },
            radio: {
                width: "16px",
                height: "16px",
                margin: "8px",
                appearance: ""
            },
            label: {
                padding: {
                    top: "10px",
                    bottom: "8px"
                },
                margin: {
                    top: "0px",
                    bottom: "0px"
                },
                disabled: {
                    color: "rgba(76,76,76,.5)"
                },
                focused: {
                    color: "#3e6680"
                },
                selected: {
                    color: "#4c4c4c"
                },
                error: {
                    color: "#4c4c4c"
                },
                hover: {
                    color: "#3e6680"
                },
                normal: {
                    color: "#3e6680"
                }
            },
            instructions: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "12px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    top: "4px",
                    bottom: "0px"
                },
                margin: {
                    top: "0px",
                    bottom: "0px"
                },
                disabled: {
                    color: "rgba(170,170,170,.5)"
                },
                focused: {
                    color: "#aaaaaa"
                },
                selected: {
                    color: "#aaaaaa"
                },
                hover: {
                    color: "#aaaaaa"
                },
                error: {
                    color: "#aaaaaa"
                },
                normal: {
                    color: "#aaaaaa"
                }
            },
            error: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "12px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    top: "4px",
                    bottom: "0px"
                },
                normal: {
                    color: "#fa4848"
                }
            },
            button: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "2em"
                    }
                },
                padding: {
                    vertical: "8px",
                    horizontal: "40px"
                },
                border: {
                    width: "1px",
                    style: "solid",
                    radius: "3px"
                },
                primary: {
                    normal: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "#19a8ce"
                        },
                        color: "#ffffff"
                    },
                    hover: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "#17a7ce"
                        },
                        color: "#ffffff"
                    },
                    disabled: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "rgba(76,76,76,.5)"
                        },
                        color: "#ffffff"
                    }
                },
                secondary: {
                    normal: {
                        border: {
                            color: "#676573"
                        },
                        background: {
                            color: "#ffffff"
                        },
                        color: "#656573"
                    },
                    hover: {
                        border: {
                            color: "#656573"
                        },
                        background: {
                            color: "#ffffff"
                        },
                        color: "#656573"
                    },
                    disabled: {
                        border: {
                            color: "rgba(76,76,76,.5)"
                        },
                        background: {
                            color: "transparent"
                        },
                        color: "rgba(76,76,76,.5)"
                    }
                }
            },
            table: {
                header: {
                    background: {
                        color: '#ececec'
                    }
                }
            }
        };
        _this.localThemeProperties = JSON.parse(JSON.stringify(_this.defaults));
        _this.init();
        return _this;
    }
    ExternalThemeManagedByWix.prototype.overrideExternalManagedThemeProperties = function (inObject) {
        if (!inObject || !this.wixTheme) {
            return;
        }
        var self = this, primitiveTypes = ['string', 'number', 'boolean'], merge = function (src, dest) {
            if (!src || !dest) {
                return;
            }
            for (var k in src) {
                if (src.hasOwnProperty(k) && dest.hasOwnProperty(k)) {
                    var typeA = typeof src[k], typeB = typeof dest[k];
                    if (typeA === typeB) {
                        if (primitiveTypes.indexOf(typeA) > -1) {
                            dest[k] = src[k];
                        }
                        else {
                            if (src[k] instanceof Object && dest[k] instanceof Object) {
                                merge(src[k], dest[k]);
                            }
                        }
                    }
                }
            }
        };
        try {
            this.localThemeProperties.colors.selected.color = this.wixTheme.colors.linkColor.value;
            this.localThemeProperties.form.background.color = 'transparent';
            this.localThemeProperties.form.font.family = this.extractFontSettingPart(EFontSettingPart.FONT_FAMILY, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.form.font.size = this.extractFontSettingPart(EFontSettingPart.FONT_SIZE, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.form.font.weight = this.extractFontSettingPart(EFontSettingPart.FONT_WEIGHT, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.form.font.style = this.extractFontSettingPart(EFontSettingPart.FONT_STYLE, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.form.font.line.height = this.extractFontSettingPart(EFontSettingPart.FONT_LINE_HEIGHT, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.form.color = this.wixTheme.colors.nameColor.value;
            this.localThemeProperties.page.background.color = this.wixTheme.colors.bodyBg.value;
            this.localThemeProperties.page.border.color = 'transparent';
            this.localThemeProperties.control.focused.background.color = this.wixTheme.colors.focusFieldBg.value;
            this.localThemeProperties.control.focused.border.color = this.wixTheme.colors.focusTextdColor.value;
            this.localThemeProperties.control.error.background.color = 'transparent';
            this.localThemeProperties.control.error.border.color = 'transparent';
            this.localThemeProperties.control.hover.background.color = 'transparent';
            this.localThemeProperties.control.hover.border.color = 'transparent';
            this.localThemeProperties.control.normal.background.color = 'transparent';
            this.localThemeProperties.control.normal.border.color = 'transparent';
            this.localThemeProperties.control.required.star.color = this.wixTheme.colors.requireColor.value;
            this.localThemeProperties.input.font.family = this.extractFontSettingPart(EFontSettingPart.FONT_FAMILY, this.wixTheme.fonts.fieldFont);
            this.localThemeProperties.input.font.size = this.extractFontSettingPart(EFontSettingPart.FONT_SIZE, this.wixTheme.fonts.fieldFont);
            this.localThemeProperties.input.font.weight = this.extractFontSettingPart(EFontSettingPart.FONT_WEIGHT, this.wixTheme.fonts.fieldFont);
            this.localThemeProperties.input.font.style = this.extractFontSettingPart(EFontSettingPart.FONT_STYLE, this.wixTheme.fonts.fieldFont);
            this.localThemeProperties.input.font.line.height = this.extractFontSettingPart(EFontSettingPart.FONT_LINE_HEIGHT, this.wixTheme.fonts.fieldFont);
            this.localThemeProperties.input.focused.background.color = this.wixTheme.colors.focusFieldBg.value;
            this.localThemeProperties.input.focused.border.color = this.wixTheme.colors.borderColorFields.value;
            this.localThemeProperties.input.focused.color = this.wixTheme.colors.focusTextdColor.value;
            this.localThemeProperties.input.error.background.color = this.wixTheme.colors.validationBgColor.value;
            this.localThemeProperties.input.error.border.color = this.wixTheme.colors.borderColorFields.value;
            this.localThemeProperties.input.error.color = this.wixTheme.colors.errormsgColor.value;
            this.localThemeProperties.input.hover.background.color = this.wixTheme.colors.fieldBg.value;
            this.localThemeProperties.input.hover.border.color = this.wixTheme.colors.borderColorFields.value;
            this.localThemeProperties.input.hover.color = this.wixTheme.colors.fieldColor.value;
            this.localThemeProperties.input.normal.background.color = this.wixTheme.colors.fieldBg.value;
            this.localThemeProperties.input.normal.border.color = this.wixTheme.colors.borderColorFields.value;
            this.localThemeProperties.input.normal.color = this.wixTheme.colors.fieldColor.value;
            this.localThemeProperties.input.normal.placeholderColor = this.wixTheme.colors.placeholderColor.value;
            this.localThemeProperties.label.focused.color = this.wixTheme.colors.labelColor.value;
            this.localThemeProperties.label.error.color = this.wixTheme.colors.errormsgColor.value;
            this.localThemeProperties.label.hover.color = this.wixTheme.colors.labelColor.value;
            this.localThemeProperties.label.normal.color = this.wixTheme.colors.labelColor.value;
            this.localThemeProperties.instructions.font.family = this.extractFontSettingPart(EFontSettingPart.FONT_FAMILY, this.wixTheme.fonts.labelInfoFontStyle);
            this.localThemeProperties.instructions.font.size = this.extractFontSettingPart(EFontSettingPart.FONT_SIZE, this.wixTheme.fonts.labelInfoFontStyle);
            this.localThemeProperties.instructions.font.weight = this.extractFontSettingPart(EFontSettingPart.FONT_WEIGHT, this.wixTheme.fonts.labelInfoFontStyle);
            this.localThemeProperties.instructions.font.style = this.extractFontSettingPart(EFontSettingPart.FONT_STYLE, this.wixTheme.fonts.labelInfoFontStyle);
            this.localThemeProperties.instructions.font.line.height = this.extractFontSettingPart(EFontSettingPart.FONT_LINE_HEIGHT, this.wixTheme.fonts.labelInfoFontStyle);
            this.localThemeProperties.instructions.focused.color = this.wixTheme.colors.labelInfoColor.value;
            this.localThemeProperties.instructions.error.color = this.wixTheme.colors.errormsgColor.value;
            this.localThemeProperties.instructions.hover.color = this.wixTheme.colors.labelInfoColor.value;
            this.localThemeProperties.instructions.normal.color = this.wixTheme.colors.labelInfoColor.value;
            this.localThemeProperties.error.font.family = this.extractFontSettingPart(EFontSettingPart.FONT_FAMILY, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.error.font.size = this.extractFontSettingPart(EFontSettingPart.FONT_SIZE, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.error.font.weight = this.extractFontSettingPart(EFontSettingPart.FONT_WEIGHT, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.error.font.style = this.extractFontSettingPart(EFontSettingPart.FONT_STYLE, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.error.font.line.height = this.extractFontSettingPart(EFontSettingPart.FONT_LINE_HEIGHT, this.wixTheme.fonts.labelFontStyle);
            this.localThemeProperties.error.normal.color = this.wixTheme.colors.errormsgColor.value;
            this.localThemeProperties.button.font.family = this.extractFontSettingPart(EFontSettingPart.FONT_FAMILY, this.wixTheme.fonts.buttonFontStyle);
            this.localThemeProperties.button.font.size = this.extractFontSettingPart(EFontSettingPart.FONT_SIZE, this.wixTheme.fonts.buttonFontStyle);
            this.localThemeProperties.button.font.weight = this.extractFontSettingPart(EFontSettingPart.FONT_WEIGHT, this.wixTheme.fonts.buttonFontStyle);
            this.localThemeProperties.button.font.style = this.extractFontSettingPart(EFontSettingPart.FONT_STYLE, this.wixTheme.fonts.buttonFontStyle);
            this.localThemeProperties.button.font.line.height = this.extractFontSettingPart(EFontSettingPart.FONT_LINE_HEIGHT, this.wixTheme.fonts.buttonFontStyle);
            this.localThemeProperties.button.primary.normal.border.color = this.wixTheme.colors.borderColorButton.value;
            this.localThemeProperties.button.primary.normal.background.color = this.wixTheme.colors.buttonsBg.value;
            this.localThemeProperties.button.primary.normal.color = this.wixTheme.colors.buttonsColor.value;
            this.localThemeProperties.button.primary.hover.border.color = this.wixTheme.colors.borderColorButton.value;
            this.localThemeProperties.button.primary.hover.background.color = this.wixTheme.colors.buttonsBg.value;
            this.localThemeProperties.button.primary.hover.color = this.wixTheme.colors.buttonsColor.value;
            this.localThemeProperties.button.secondary.normal.border.color = this.wixTheme.colors.borderColorButton.value;
            this.localThemeProperties.button.secondary.normal.background.color = this.wixTheme.colors.buttonsBg.value;
            this.localThemeProperties.button.secondary.normal.color = this.wixTheme.colors.buttonsColor.value;
            this.localThemeProperties.button.secondary.hover.border.color = this.wixTheme.colors.borderColorButton.value;
            this.localThemeProperties.button.secondary.hover.background.color = this.wixTheme.colors.buttonsBg.value;
            this.localThemeProperties.button.secondary.hover.color = this.wixTheme.colors.buttonsColor.value;
            if (this.wixTheme.numbers && 'number' === typeof this.wixTheme.numbers.borderRadius) {
                this.localThemeProperties.button.border.radius = this.wixTheme.numbers.borderRadius + 'px';
                this.localThemeProperties.input.border.radius = this.wixTheme.numbers.borderRadius + 'px';
            }
            else {
                this.localThemeProperties.button.border.radius = this.defaults.button.border.radius;
                this.localThemeProperties.input.border.radius = this.defaults.input.border.radius;
            }
            if (this.wixTheme.numbers && 'number' === typeof this.wixTheme.numbers.borderWidth) {
                this.localThemeProperties.button.border.width = this.wixTheme.numbers.borderWidth + 'px';
                this.localThemeProperties.input.border.width = this.wixTheme.numbers.borderWidth + 'px';
            }
            else {
                this.localThemeProperties.button.border.width = this.defaults.button.border.width;
                this.localThemeProperties.input.border.width = this.defaults.input.border.width;
            }
            merge(this.localThemeProperties, inObject);
        }
        catch (e) {
            console.warn('WARNING: FAILED TO MEREG WIX DEFAULT PROPERTIES! EXCEPTION IS SHOWN BELOW');
            console.error(e);
        }
    };
    ExternalThemeManagedByWix.prototype.setWixTheme = function (theme) {
        this.wixTheme = theme;
        console.warn('THEME: ', this.wixTheme);
        this.trigger('change');
    };
    ExternalThemeManagedByWix.prototype.init = function () {
        if (!Wix) {
            return;
        }
        console.warn('WIX sdk detected! Initializing External Theme');
        (function (self) {
            Wix.addEventListener(Wix.Events.STYLE_PARAMS_CHANGE, function (styles) {
                console.warn('WIX: Events.STYLE_PARAMS_CHANGE event!');
                self.setWixTheme(styles);
            });
            Wix.Styles.getStyleParams(function (styles) {
                console.warn('WIX: GOT Styles.getStyleParams');
                self.setWixTheme(styles);
            });
        })(this);
    };
    ExternalThemeManagedByWix.prototype.extractFontSettingPart = function (part, wixFont) {
        var fontRegex = /^font\:([^ ]+) ([^ ]+) ([^ ]+) ([\d]+px)\/([^ ]+) ([\s\S]+)$/, matches;
        switch (part) {
            case EFontSettingPart.FONT_SIZE:
                return ~~wixFont.size + "px";
            case EFontSettingPart.FONT_FAMILY:
                if (matches = fontRegex.exec(wixFont.value)) {
                    return matches[6].replace(/"/g, "'");
                }
                else {
                    return '"Open Sans",sans-serif';
                }
            case EFontSettingPart.FONT_LINE_HEIGHT:
                if (matches = fontRegex.exec(wixFont.value)) {
                    return matches[4];
                }
                else {
                    return '14px';
                }
            case EFontSettingPart.FONT_STYLE:
                if (wixFont.style.italic) {
                    return 'italic';
                }
                else {
                    return 'normal';
                }
            case EFontSettingPart.FONT_WEIGHT:
                if (wixFont.style.bold) {
                    return 'bold';
                }
                else {
                    return 'normal';
                }
            default:
                return null;
        }
    };
    ExternalThemeManagedByWix.prototype.isPropertyManaged = function (themePropertyFQN) {
        var parts = String(themePropertyFQN || '').split(/[_.]/), cursor, root = this.localThemeProperties;
        for (var i = 0, len = parts.length; i < len; i++) {
            cursor = parts[i];
            if (undefined === root[cursor]) {
                return false;
            }
            root = root[cursor];
        }
        return true;
    };
    ExternalThemeManagedByWix.prototype.hasExternalStorage = function () {
        return true;
    };
    ExternalThemeManagedByWix.prototype.getThemeStrategy = function () {
        return EThemeStrategy.WIX_THEME_MANAGED_BY_WIX;
    };
    ExternalThemeManagedByWix.prototype.setProperty = function (propertyFQN, propertyValue) {
    };
    ExternalThemeManagedByWix.prototype.getDefaultThemeProperties = function () {
        return JSON.parse(JSON.stringify(this.defaults));
    };
    return ExternalThemeManagedByWix;
}(EventEmitter));
var InternalTheme = (function (_super) {
    __extends(InternalTheme, _super);
    function InternalTheme() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.defaults = {
            colors: {
                selected: {
                    color: "#0099cc"
                }
            },
            form: {
                background: {
                    color: "transparent",
                    image: "",
                    position: "center",
                    repeat: "no-repeat",
                    size: "cover",
                    attachment: "scroll"
                },
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                color: "#4c4c4c"
            },
            page: {
                background: {
                    color: "#ffffff",
                    image: "",
                    position: "center",
                    repeat: "no-repeat",
                    size: "cover",
                    attachment: "scroll"
                },
                border: {
                    width: "0px",
                    style: "none",
                    color: "#4c4c4c"
                },
                margin: {
                    bottom: "40px",
                    top: "40px"
                },
                padding: {
                    top: "20px",
                    left: "20px",
                    right: "20px",
                    bottom: "20px"
                },
                shadow: {
                    visibility: "1"
                }
            },
            container: {
                padding: {
                    horizontal: "8px",
                    vertical: "8px"
                }
            },
            control: {
                border: {
                    width: "0px",
                    style: "none",
                    radius: "0px"
                },
                disabled: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                focused: {
                    background: {
                        color: "rgba(204,204,204,.4)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                selected: {
                    background: {
                        color: "rgba(204,204,204,.4)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                error: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                hover: {
                    background: {
                        color: "rgba(204,204,204,.2)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                normal: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                required: {
                    star: {
                        color: "rgba(255, 0, 0, 1)"
                    }
                }
            },
            input: {
                border: {
                    width: "1px",
                    style: "solid",
                    radius: "3px"
                },
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    vertical: "8px",
                    horizontal: "8px"
                },
                margin: {
                    vertical: "16px"
                },
                disabled: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "rgba(204,204,204,.5)"
                    },
                    color: "rgba(76,76,76,.5)"
                },
                focused: {
                    background: {
                        color: "rgba(0,153,204,.1)"
                    },
                    border: {
                        color: "#0099cc"
                    },
                    color: "#4c4c4c"
                },
                selected: {
                    background: {
                        color: "rgba(0,153,204,.1)"
                    },
                    border: {
                        color: "#0099cc"
                    },
                    color: "#4c4c4c"
                },
                error: {
                    background: {
                        color: "rgba(250,72,72,.11)"
                    },
                    border: {
                        color: "#fa4848"
                    },
                    color: "#4c4c4c"
                },
                hover: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "#0099cc"
                    },
                    color: "#4c4c4c"
                },
                normal: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "#cccccc"
                    },
                    color: "#4c4c4c"
                }
            },
            checkbox: {
                width: "16px",
                height: "16px",
                margin: "8px"
            },
            radio: {
                width: "16px",
                height: "16px",
                margin: "8px",
                appearance: ""
            },
            label: {
                padding: {
                    top: "10px",
                    bottom: "8px"
                },
                margin: {
                    top: "0px",
                    bottom: "0px"
                },
                disabled: {
                    color: "rgba(76,76,76,.5)"
                },
                focused: {
                    color: "#4c4c4c"
                },
                selected: {
                    color: "#4c4c4c"
                },
                error: {
                    color: "#4c4c4c"
                },
                hover: {
                    color: "#4c4c4c"
                },
                normal: {
                    color: "#4c4c4c"
                }
            },
            instructions: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "12px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    top: "4px",
                    bottom: "0px"
                },
                margin: {
                    top: "0px",
                    bottom: "0px"
                },
                disabled: {
                    color: "rgba(170,170,170,.5)"
                },
                focused: {
                    color: "#aaaaaa"
                },
                selected: {
                    color: "#aaaaaa"
                },
                hover: {
                    color: "#aaaaaa"
                },
                error: {
                    color: "#aaaaaa"
                },
                normal: {
                    color: "#aaaaaa"
                }
            },
            error: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "12px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    top: "4px",
                    bottom: "0px"
                },
                normal: {
                    color: "#fa4848"
                }
            },
            button: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "2em"
                    }
                },
                padding: {
                    vertical: "8px",
                    horizontal: "40px"
                },
                border: {
                    width: "1px",
                    style: "solid",
                    radius: "3px"
                },
                primary: {
                    normal: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "#4c4c4c"
                        },
                        color: "#ffffff"
                    },
                    hover: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "#707070"
                        },
                        color: "#ffffff"
                    },
                    disabled: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "rgba(76,76,76,.5)"
                        },
                        color: "#ffffff"
                    }
                },
                secondary: {
                    normal: {
                        border: {
                            color: "#4c4c4c"
                        },
                        background: {
                            color: "transparent"
                        },
                        color: "#4c4c4c"
                    },
                    hover: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "#4c4c4c"
                        },
                        color: "#ffffff"
                    },
                    disabled: {
                        border: {
                            color: "rgba(76,76,76,.5)"
                        },
                        background: {
                            color: "transparent"
                        },
                        color: "rgba(76,76,76,.5)"
                    }
                }
            },
            table: {
                header: {
                    background: {
                        color: '#ececec'
                    }
                }
            }
        };
        return _this;
    }
    InternalTheme.prototype.getThemeStrategy = function () {
        return EThemeStrategy.INTERNAL;
    };
    InternalTheme.prototype.overrideExternalManagedThemeProperties = function (inObject) {
    };
    InternalTheme.prototype.isPropertyManaged = function (themePropertyFQN) {
        return false;
    };
    InternalTheme.prototype.hasExternalStorage = function () {
        return false;
    };
    InternalTheme.prototype.setProperty = function (propertyFQN, propertyValue) {
    };
    InternalTheme.prototype.getDefaultThemeProperties = function () {
        return JSON.parse(JSON.stringify(this.defaults));
    };
    return InternalTheme;
}(EventEmitter));
var WixThemeWithExternalStorage = (function (_super) {
    __extends(WixThemeWithExternalStorage, _super);
    function WixThemeWithExternalStorage(readOnly, engine) {
        var _this = _super.call(this) || this;
        _this.defaults = {
            colors: {
                selected: {
                    color: "#0396ff"
                }
            },
            form: {
                background: {
                    color: "transparent",
                    image: "",
                    position: "top left",
                    repeat: "repeat",
                    size: "original",
                    attachment: "fixed"
                },
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                color: "#3e6680"
            },
            page: {
                background: {
                    color: "#ffffff",
                    image: "",
                    position: "center",
                    repeat: "no-repeat",
                    size: "cover",
                    attachment: "scroll"
                },
                border: {
                    width: "0px",
                    style: "none",
                    color: "#3e6680"
                },
                margin: {
                    bottom: "40px",
                    top: "40px"
                },
                padding: {
                    top: "20px",
                    left: "20px",
                    right: "20px",
                    bottom: "20px"
                },
                shadow: {
                    visibility: "1"
                }
            },
            container: {
                padding: {
                    horizontal: "8px",
                    vertical: "8px"
                }
            },
            control: {
                border: {
                    width: "0px",
                    style: "none",
                    radius: "0px"
                },
                disabled: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                focused: {
                    background: {
                        color: "rgba(204,204,204,.4)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                selected: {
                    background: {
                        color: "rgba(204,204,204,.4)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                error: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                hover: {
                    background: {
                        color: "rgba(204,204,204,.2)"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                normal: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "transparent"
                    }
                },
                required: {
                    star: {
                        color: "rgba(255, 0, 0, 1)"
                    }
                }
            },
            input: {
                border: {
                    width: "1px",
                    style: "solid",
                    radius: "3px"
                },
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    vertical: "8px",
                    horizontal: "8px"
                },
                margin: {
                    vertical: "16px"
                },
                disabled: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "rgba(204,204,204,.5)"
                    },
                    color: "rgba(76,76,76,.5)"
                },
                focused: {
                    background: {
                        color: "rgba(0, 148, 255, .1)"
                    },
                    border: {
                        color: "#0396ff"
                    },
                    color: "#4c4c4c"
                },
                selected: {
                    background: {
                        color: "rgba(0,153,204,.1)"
                    },
                    border: {
                        color: "#0099cc"
                    },
                    color: "#4c4c4c"
                },
                error: {
                    background: {
                        color: "rgba(250, 72, 72, .11)"
                    },
                    border: {
                        color: "#fa4848"
                    },
                    color: "#3e6680"
                },
                hover: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "#0396ff"
                    },
                    color: "#4c4c4c"
                },
                normal: {
                    background: {
                        color: "transparent"
                    },
                    border: {
                        color: "#cccccc"
                    },
                    color: "#4c4c4c"
                }
            },
            checkbox: {
                width: "16px",
                height: "16px",
                margin: "8px"
            },
            radio: {
                width: "16px",
                height: "16px",
                margin: "8px",
                appearance: ""
            },
            label: {
                padding: {
                    top: "10px",
                    bottom: "8px"
                },
                margin: {
                    top: "0px",
                    bottom: "0px"
                },
                disabled: {
                    color: "rgba(76,76,76,.5)"
                },
                focused: {
                    color: "#3e6680"
                },
                selected: {
                    color: "#4c4c4c"
                },
                error: {
                    color: "#4c4c4c"
                },
                hover: {
                    color: "#3e6680"
                },
                normal: {
                    color: "#3e6680"
                }
            },
            instructions: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "12px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    top: "4px",
                    bottom: "0px"
                },
                margin: {
                    top: "0px",
                    bottom: "0px"
                },
                disabled: {
                    color: "rgba(170,170,170,.5)"
                },
                focused: {
                    color: "#aaaaaa"
                },
                selected: {
                    color: "#aaaaaa"
                },
                hover: {
                    color: "#aaaaaa"
                },
                error: {
                    color: "#aaaaaa"
                },
                normal: {
                    color: "#aaaaaa"
                }
            },
            error: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "12px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "1.2em"
                    }
                },
                padding: {
                    top: "4px",
                    bottom: "0px"
                },
                normal: {
                    color: "#fa4848"
                }
            },
            button: {
                font: {
                    family: "'Open Sans', sans-serif",
                    size: "14px",
                    weight: "normal",
                    style: "normal",
                    line: {
                        height: "2em"
                    }
                },
                padding: {
                    vertical: "8px",
                    horizontal: "40px"
                },
                border: {
                    width: "1px",
                    style: "solid",
                    radius: "3px"
                },
                primary: {
                    normal: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "#19a8ce"
                        },
                        color: "#ffffff"
                    },
                    hover: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "#17a7ce"
                        },
                        color: "#ffffff"
                    },
                    disabled: {
                        border: {
                            color: "transparent"
                        },
                        background: {
                            color: "rgba(76,76,76,.5)"
                        },
                        color: "#ffffff"
                    }
                },
                secondary: {
                    normal: {
                        border: {
                            color: "#676573"
                        },
                        background: {
                            color: "#ffffff"
                        },
                        color: "#656573"
                    },
                    hover: {
                        border: {
                            color: "#656573"
                        },
                        background: {
                            color: "#ffffff"
                        },
                        color: "#656573"
                    },
                    disabled: {
                        border: {
                            color: "rgba(76,76,76,.5)"
                        },
                        background: {
                            color: "transparent"
                        },
                        color: "rgba(76,76,76,.5)"
                    }
                }
            },
            table: {
                header: {
                    background: {
                        color: '#ececec'
                    }
                }
            }
        };
        _this.themeId = null;
        _this.localThemeProperties = JSON.parse(JSON.stringify(_this.defaults));
        _this.readOnlyMode = readOnly;
        _this.engine = engine;
        _this.saveThemeToExternalStorageThrottler = Throttle.create(function () {
            _this.saveTheme(_this.themeId);
            _this.themeId = null;
        }, 1000);
        engine.on('theme-before-render', function () {
            _this.loadInitialThemeProperties();
        });
        _this.on('theme-id-changed', function (newThemeId) {
            _this.themeId = newThemeId;
            _this.saveThemeToExternalStorageThrottler();
        });
        return _this;
    }
    WixThemeWithExternalStorage.prototype.getThemeStrategy = function () {
        return EThemeStrategy.WIX_THEME;
    };
    WixThemeWithExternalStorage.prototype.hasExternalStorage = function () {
        return true;
    };
    WixThemeWithExternalStorage.prototype.overrideExternalManagedThemeProperties = function (inObject) {
        if (!inObject || !this.localThemeProperties) {
            return;
        }
        var primitiveTypes = ['string', 'number', 'boolean'], merge = function (src, dest) {
            if (!src || !dest) {
                return;
            }
            for (var k in src) {
                if (src.hasOwnProperty(k) && dest.hasOwnProperty(k)) {
                    var typeA = typeof src[k], typeB = typeof dest[k];
                    if (typeA === typeB) {
                        if (primitiveTypes.indexOf(typeA) > -1) {
                            dest[k] = src[k];
                        }
                        else {
                            if (src[k] instanceof Object && dest[k] instanceof Object) {
                                merge(src[k], dest[k]);
                            }
                        }
                    }
                }
            }
        };
        merge(this.localThemeProperties, inObject);
    };
    WixThemeWithExternalStorage.prototype.isPropertyManaged = function (themePropertyFQN) {
        return true;
    };
    WixThemeWithExternalStorage.prototype.setProperty = function (propertyFQN, propertyValue) {
        this.setPropertyWithoutEmittingEvents(propertyFQN, propertyValue);
        this.saveThemeToExternalStorageThrottler();
    };
    WixThemeWithExternalStorage.prototype.flatten = function (o, prefix, result) {
        if (o && 'object' === typeof o) {
            for (var propertyName in o) {
                if (o.hasOwnProperty(propertyName)) {
                    prefix.push(propertyName);
                    if (typeof o[propertyName] === 'object') {
                        this.flatten(o[propertyName], prefix, result);
                    }
                    else {
                        var valueAsColor = FormUtils.getNormalizedCSSColorNotationFromString(o[propertyName]), isColor = !!valueAsColor, item = {
                            name: prefix.join('_'),
                            value: isColor ? valueAsColor : o[propertyName],
                        };
                        result.push(item);
                    }
                    prefix.pop();
                }
            }
        }
    };
    WixThemeWithExternalStorage.prototype.enumerateProperties = function () {
        var result = [];
        this.flatten(this.localThemeProperties, [], result);
        return result;
    };
    WixThemeWithExternalStorage.prototype.saveTheme = function (themeId) {
        if (this.readOnlyMode) {
            return;
        }
        this.engine.getLoader().execCommand('save-external-theme', themeId);
    };
    WixThemeWithExternalStorage.prototype.loadInitialThemeProperties = function () {
        var preloadedThemeProperties = this.engine.getLoader().getLoaderDependency(ELoaderDependency.EXTERNAL_THEME_INITIAL_PROPERTIES);
        if (!preloadedThemeProperties || !Array.isArray(preloadedThemeProperties)) {
            return;
        }
        for (var i = 0, len = preloadedThemeProperties.length; i < len; i++) {
            this.setPropertyWithoutEmittingEvents(preloadedThemeProperties[i].name, preloadedThemeProperties[i].value);
        }
        this.trigger('change');
    };
    WixThemeWithExternalStorage.prototype.setPropertyWithoutEmittingEvents = function (propertyFQN, value) {
        if (null !== value && typeof value !== 'string') {
            console.warn('WixThemeWithExternalStorage.setPropertyWithoutEmittingEvents: Invalid property value!');
            return;
        }
        var parts = String(propertyFQN || '').split(/[_.]/), cursor, root = this.localThemeProperties;
        for (var i = 0, len = parts.length; i < len; i++) {
            cursor = parts[i];
            if (undefined === root[cursor]) {
                console.warn('WixThemeWithExternalStorage.setPropertyWithoutEmittingEvents: Invalid property name!');
                return;
            }
            if (i < len - 1) {
                root = root[cursor];
            }
            else {
                root[cursor] = value;
            }
        }
    };
    WixThemeWithExternalStorage.prototype.getDefaultThemeProperties = function () {
        return JSON.parse(JSON.stringify(this.defaults));
    };
    return WixThemeWithExternalStorage;
}(EventEmitter));
var EditorSetting = (function (_super) {
    __extends(EditorSetting, _super);
    function EditorSetting(properties, configuration, typescriptInterfaceName, document, runtime) {
        var _this = _super.call(this) || this;
        _this.properties = FormUtils.clone(properties);
        _this.configuration = configuration;
        _this.typescriptInterfaceName = typescriptInterfaceName;
        _this.document = document;
        _this.runtime = runtime;
        _this.propertyDescriptors = _this.runtime.getTypeDescriptor(_this.typescriptInterfaceName).properties;
        return _this;
    }
    EditorSetting.prototype.getConfiguration = function () {
        return this.configuration;
    };
    EditorSetting.prototype.hasProperty = function (propertyFQN) {
        return undefined !== this.properties[propertyFQN];
    };
    EditorSetting.prototype.getProperty = function (propertyFQN) {
        if (!this.hasProperty(propertyFQN)) {
            throw new Error('Property ' + JSON.stringify(propertyFQN) + ' does not exist!');
        }
        return this.properties[propertyFQN];
    };
    EditorSetting.prototype.setProperty = function (propertyFQN, propertyValue) {
        if (typeof propertyFQN !== 'string' || !propertyFQN) {
            throw new Error('Invalid argument: propertyFQN: string not empty expected!');
        }
        if (undefined === this.propertyDescriptors[propertyFQN]) {
            throw new Error('Property ' + JSON.stringify(propertyFQN) + ' does not exist!');
        }
        var oldValue = this.properties[propertyFQN];
        if (propertyValue === oldValue) {
            return;
        }
        this.properties[propertyFQN] = propertyValue;
        this.trigger('property-change', propertyFQN, propertyValue, oldValue, this);
        this.document.trigger('change');
    };
    EditorSetting.prototype.enumerateProperties = function () {
        var result = [];
        for (var propertyName in this.propertyDescriptors) {
            if (this.propertyDescriptors.propertyIsEnumerable(propertyName)) {
                result.push({
                    name: propertyName,
                    type: this.propertyDescriptors[propertyName].type,
                    optional: this.propertyDescriptors[propertyName].optional,
                    value: this.properties[propertyName] === undefined
                        ? null
                        : this.properties[propertyName]
                });
            }
        }
        return result;
    };
    EditorSetting.prototype.hasErrors = function () {
        return !!this.errors && !!this.errors.length;
    };
    EditorSetting.prototype.withError = function (error) {
        this.errors = undefined === this.errors
            ? []
            : this.errors;
        this.errors.push(error);
        if (this.document) {
            this.document.trigger('change');
            this.document.trigger('errors-changed', this);
        }
        return this;
    };
    EditorSetting.prototype.withoutError = function (errorCode) {
        if (undefined !== this.errors) {
            var removed = false;
            for (var i = this.errors.length - 1; i > -1; i--) {
                if (this.errors[i].code === errorCode) {
                    this.errors.splice(i, 1);
                    removed = true;
                }
            }
            if (!this.errors.length) {
                this.errors = undefined;
            }
            if (removed && this.document) {
                this.document.trigger('change');
                this.document.trigger('errors-changed', this);
            }
        }
        return this;
    };
    EditorSetting.prototype.serialize = function () {
        return [
            this.getTypeId(),
            this.properties,
            this.errors || null,
        ];
    };
    EditorSetting.prototype.getForm = function () {
        return this.document;
    };
    EditorSetting.prototype.isVisible = function () {
        return this.configuration.visible;
    };
    EditorSetting.prototype.getErrors = function () {
        return this.errors || null;
    };
    EditorSetting.prototype.withErrors = function (errors) {
        var numErrors;
        if (null !== errors && !(errors instanceof Array)) {
            throw new Error('Invalid argument: array expected!');
        }
        if (errors && (numErrors = errors.length)) {
            var newErrors = [], currentError = void 0;
            for (var i = 0; i < numErrors; i++) {
                if (errors[i] && 'number' === typeof errors[i].code && 'string' === typeof errors[i].message) {
                    currentError = {
                        code: ~~errors[i].code,
                        message: errors[i].message,
                        isHTML: !!errors[i].isHTML
                    };
                    if (errors[i].propertyName !== undefined && null !== errors[i].propertyName) {
                        if ('string' === typeof errors[i].propertyName) {
                            currentError.propertyName = errors[i].propertyName;
                        }
                        else {
                            throw new Error('Invalid argument!');
                        }
                    }
                    newErrors.push(currentError);
                }
                else {
                    throw new Error('Invalid argument: errors: ISettingError[] expected!');
                }
            }
            if (!this.errors && !newErrors.length) {
                return;
            }
            this.errors = newErrors.length
                ? newErrors
                : undefined;
            if (this.document) {
                this.document.trigger('change');
                this.document.trigger('errors-changed', this);
            }
        }
        else {
            this.errors = undefined;
            if (this.document) {
                this.document.trigger('change');
                this.document.trigger('errors-changed', this);
            }
        }
        return this;
    };
    return EditorSetting;
}(EventEmitter));
var EditorSettingTypes = (function () {
    function EditorSettingTypes() {
    }
    EditorSettingTypes.getAllSettingTypeIds = function () {
        return [
            EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_COUPON_CODES_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING,
            EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING,
        ];
    };
    EditorSettingTypes.getSettingClassByTypeId = function (settingTypeId) {
        switch (settingTypeId) {
            case this.PAYMENT_PRODUCTS_EDITOR_SETTING:
                return ProductsEditorSetting;
            case this.PAYMENT_SUMMARY_EDITOR_SETTING:
                return SummaryEditorSetting;
            case this.PAYMENT_COUPON_CODES_EDITOR_SETTING:
                return CouponCodesEditorSetting;
            case this.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING:
                return PaypalEditorSetting;
            case this.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING:
                return PaypalCheckoutEditorSetting;
            case this.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING:
                return PaypalProEditorSetting;
            case this.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING:
                return PaypalPayflowEditorSetting;
            case this.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING:
                return StripeEditorSetting;
            case this.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING:
                return StripeCheckoutEditorSetting;
            case this.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING:
                return SquareEditorSetting;
            case this.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING:
                return BraintreeEditorSetting;
            case this.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING:
                return PayUEditorSetting;
            case this.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING:
                return SisowEditorSetting;
            case this.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING:
                return PayfastEditorSetting;
            case this.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING:
                return WorldpayEditorSetting;
            case this.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING:
                return AuthorizeEditorSetting;
            case this.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING:
                return SagepayEditorSetting;
            case this.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING:
                return FreshbooksEditorSetting;
            case this.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING:
                return CivicaEditorSetting;
            default:
                return null;
        }
    };
    EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING = 'setting_payment_products';
    EditorSettingTypes.PAYMENT_COUPON_CODES_EDITOR_SETTING = 'setting_payment_coupons';
    EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING = 'setting_payment_summary';
    EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING = 'setting_payment_processor_paypal';
    EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING = 'setting_payment_processor_paypal_checkout';
    EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING = 'setting_payment_processor_paypal_payflow';
    EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING = 'setting_payment_processor_paypal_pro';
    EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING = 'setting_payment_processor_braintree';
    EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING = 'setting_payment_processor_stripe';
    EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING = 'setting_payment_processor_stripe_checkout';
    EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING = 'setting_payment_processor_payu';
    EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING = 'setting_payment_processor_square';
    EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING = 'setting_payment_processor_sisow';
    EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING = 'setting_payment_processor_payfast';
    EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING = 'setting_payment_processor_worldpay';
    EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING = 'setting_payment_processor_authorize';
    EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING = 'setting_payment_processor_sagepay';
    EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING = 'setting_payment_processor_freshbooks';
    EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING = 'setting_payment_processor_civica';
    return EditorSettingTypes;
}());
var EditorSettingGroups = (function () {
    function EditorSettingGroups() {
    }
    EditorSettingGroups.getGroupLabelTextByGroupTypeId = function (editorSettingGroupTypeId) {
        switch (editorSettingGroupTypeId) {
            case this.PAYMENT_PROCESSORS:
                return 'Payment Processors';
            case this.PAYMENT_PROCESSORS_SANDBOX:
                return 'Payment Processors (Testing Mode)';
            case this.PAYMENT_SETTINGS:
                return 'Payments';
            default:
                return 'Setting group not defined: ' + JSON.stringify(editorSettingGroupTypeId);
        }
    };
    EditorSettingGroups.getGroupLabelI18nTextByGroupTypeId = function (editorSettingGroupTypeId) {
        switch (editorSettingGroupTypeId) {
            case this.PAYMENT_PROCESSORS:
                return 'edt_UI_setting_group_payment_processors';
            case this.PAYMENT_PROCESSORS_SANDBOX:
                return 'edt_UI_setting_group_payment_processors_sandbox';
            case this.PAYMENT_SETTINGS:
                return 'edt_UI_setting_group_payment_settings';
            default:
                return '';
        }
    };
    EditorSettingGroups.getGroupSortIndex = function (editorSettingGroupTypeId) {
        switch (editorSettingGroupTypeId) {
            case this.PAYMENT_SETTINGS:
                return 5;
            case this.PAYMENT_PROCESSORS:
                return 10;
            default:
                return 10000;
        }
    };
    EditorSettingGroups.getGroupSettingTypeIds = function (groupTypeId) {
        var result = [];
        EditorSettingTypes.getAllSettingTypeIds().forEach(function (settingTypeId) {
            if (EditorSettingTypes.getSettingClassByTypeId(settingTypeId)
                .getConfiguration().group === groupTypeId) {
                result.push(settingTypeId);
            }
        });
        return result;
    };
    EditorSettingGroups.PAYMENT_PROCESSORS = 'payment-processors';
    EditorSettingGroups.PAYMENT_PROCESSORS_SANDBOX = 'payment-processors-sandbox';
    EditorSettingGroups.PAYMENT_SETTINGS = 'payment-settings';
    return EditorSettingGroups;
}());
var CouponCodesEditorSetting = (function (_super) {
    __extends(CouponCodesEditorSetting, _super);
    function CouponCodesEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || CouponCodesEditorSetting.defaultProperties, CouponCodesEditorSetting.getConfiguration(), 'ICouponSettings', document, runtime) || this;
    }
    CouponCodesEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_COUPON_CODES_EDITOR_SETTING;
    };
    CouponCodesEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_SETTINGS;
    };
    CouponCodesEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            groups: [
                {
                    name: 'settings',
                    i18nName: null,
                    label: 'Settings',
                    properties: [
                        {
                            label: 'Coupon Codes',
                            propertyFQN: 'codes',
                            i18nName: null,
                            type: 'ICouponCodeSettings[]'
                        }
                    ]
                }
            ]
        };
    };
    CouponCodesEditorSetting.getConfiguration = function () {
        return {
            name: 'Coupon Codes',
            keywords: 'coupon codes payments',
            typeId: EditorSettingTypes.PAYMENT_COUPON_CODES_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_SETTINGS,
            category: 'basic',
            visible: false,
            i18nName: 'edt_UI_attribute_coupons',
            i18nKeywords: 'edt_UI_attribute_coupons',
            icon: 'i123-field_coupon',
            index: 10,
        };
    };
    return CouponCodesEditorSetting;
}(EditorSetting));
var ProductsEditorSetting = (function (_super) {
    __extends(ProductsEditorSetting, _super);
    function ProductsEditorSetting(properties, document, runtime) {
        var _this = _super.call(this, properties || ProductsEditorSetting.defaultProperties, ProductsEditorSetting.getConfiguration(), 'IProductsSetting', document, runtime) || this;
        $('#notifications-area')
            .on('click', 'div.notification a[data-trigger=products-trigger]', function () {
            document.getEngine().getLoader().execCommand('track-event', 'payment_processors_reminder_click');
        });
        return _this;
    }
    ProductsEditorSetting.getConfiguration = function () {
        return {
            name: 'Products settings',
            keywords: '',
            typeId: EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_SETTINGS,
            category: 'basic',
            visible: false,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-settings',
            index: 20,
        };
    };
    ProductsEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PRODUCTS_EDITOR_SETTING;
    };
    ProductsEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_SETTINGS;
    };
    ProductsEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: false,
            groups: []
        };
    };
    return ProductsEditorSetting;
}(EditorSetting));
var SummaryEditorSetting = (function (_super) {
    __extends(SummaryEditorSetting, _super);
    function SummaryEditorSetting(properties, document, runtime) {
        var _this = _super.call(this, properties || SummaryEditorSetting.defaultProperties, SummaryEditorSetting.getConfiguration(), 'ISummarySetting', document, runtime) || this;
        var $ = document.getForm().getEngine().getJQuery(), self = _this;
        $('#item')
            .off('mouseover', 'div[data-role=review-products-trigger] > button')
            .on('mouseover', 'div[data-role=review-products-trigger] > button', function () {
            $(this).addClass('_hover');
        })
            .off('mouseout', 'div[data-role=review-products-trigger] > button')
            .on('mouseout', 'div[data-role=review-products-trigger] > button', function () {
            $(this).removeClass('_hover');
        });
        $('#item')
            .off('change, input', 'input')
            .on('change, input', 'input', function (e) {
            if (!$('div[id="item"][data-target-setting-id="setting_payment_summary"]').length) {
                return;
            }
            var propertyName = $(this).closest('div[data-role=property]')
                .attr('data-property-name');
            switch (propertyName) {
                case EPaymentSummaryProperties.SHOW_SUMMARY_AFTER_SUBMIT:
                    if (this.value === 'true') {
                        document.getEngine().getLoader().trigger('payments_summary_show_after_submit');
                        document.getEngine().getLoader().execCommand('track-event', 'payments_summary_show_after_submit');
                    }
                    else {
                        document.getEngine().getLoader().trigger('payments_summary_show_on_form');
                        document.getEngine().getLoader().execCommand('track-event', 'payments_summary_show_on_form');
                    }
                    document.getEngine().getLoader().trigger('payments_status_changed');
                    break;
                case EPaymentSummaryProperties.SHOW_REALTIME_SUMMARY:
                    if (this.checked) {
                        document.getEngine().getLoader().execCommand('track-event', 'payments_summary_realtime_on');
                    }
                    else {
                        document.getEngine().getLoader().execCommand('track-event', 'payments_summary_realtime_off');
                    }
                    break;
                case EPaymentSummaryProperties.COLUMNS:
                    self.updateColumnName(this, EEventType.INPUT);
                    break;
                default:
                    document.getEngine().getLoader().trigger('payments_status_changed');
                    break;
            }
        })
            .off('click', 'button.visibility-button')
            .on('click', 'button.visibility-button', function (event) {
            _this.updateColumnVisibility(event.target);
        })
            .off('blur', '[data-property-name="columns"] .list-element > input')
            .on('blur', '[data-property-name="columns"] .list-element > input', function (event) {
            _this.updateColumnName(event.target, EEventType.BLUR);
        });
        return _this;
    }
    SummaryEditorSetting.getConfiguration = function () {
        return {
            name: 'Payment summary',
            keywords: '',
            typeId: EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_SETTINGS,
            category: 'basic',
            visible: true,
            i18nName: 'edt_UI_setting_type_summary_name',
            i18nKeywords: 'edt_UI_setting_type_summary_keywords',
            icon: 'i123-setting_payment_summary',
            index: 30,
        };
    };
    SummaryEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_SUMMARY_EDITOR_SETTING;
    };
    SummaryEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_SETTINGS;
    };
    SummaryEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: false,
            hasProductsTrigger: true,
            groups: [
                {
                    name: 'order details',
                    i18nName: 'edt_UI_setting_type_order_details_group_name',
                    label: 'ORDER DETAILS',
                    properties: [
                        {
                            label: 'Currency',
                            type: 'int',
                            propertyFQN: 'currencyId',
                            i18nName: 'edt_UI_setting_summary_currency'
                        },
                        {
                            label: 'Discount on total',
                            type: 'int',
                            propertyFQN: 'discountOnTotal',
                            i18nName: 'edt_UI_setting_summary_discount_on_total'
                        },
                        {
                            label: 'Tax on total',
                            type: 'int',
                            propertyFQN: 'taxOnTotal',
                            i18nName: 'edt_UI_setting_summary_tax_on_total'
                        }
                    ]
                },
                {
                    name: 'rows',
                    i18nName: 'edt_UI_setting_type_rows_group_name',
                    label: 'ROWS',
                    properties: [
                        {
                            label: 'Show detailed formula',
                            type: 'boolean',
                            propertyFQN: 'showDetailedFormula',
                            i18nName: 'edt_UI_setting_summary_show_detailed_formula',
                        },
                        {
                            label: 'Show Discount & Tax',
                            type: 'boolean',
                            propertyFQN: 'showDiscountAndTax',
                            i18nName: 'edt_UI_setting_summary_show_discount_and_tax',
                        }
                    ]
                },
                {
                    name: 'payment summary',
                    i18nName: 'edt_UI_setting_type_summary_group_name',
                    label: 'SUMMARY',
                    properties: [
                        {
                            label: 'Show summary',
                            type: 'boolean',
                            propertyFQN: 'showSummaryAfterSubmit',
                            i18nName: 'payment_summary_show_summary',
                        },
                        {
                            label: 'Show live order summary',
                            type: 'boolean',
                            propertyFQN: 'showRealTimeSummary',
                            i18nName: 'payment_summary_show_live_order_summary',
                        }
                    ],
                },
                {
                    name: 'columns',
                    i18nName: 'edt_UI_setting_type_columns_group_name',
                    label: 'COLUMNS',
                    properties: [{
                            label: null,
                            type: 'array',
                            propertyFQN: 'columns',
                            i18nName: null,
                        },]
                }
            ]
        };
    };
    SummaryEditorSetting.prototype.updateColumnName = function (input, eventType) {
        var columnData = {
            name: input.parentElement.getAttribute('data-name'),
            value: input.value
        };
        this.document.getEngine().getLoader().trigger('payments_column_name_changed', eventType, columnData);
    };
    SummaryEditorSetting.prototype.updateColumnVisibility = function (button) {
        var columnData = {
            name: button.parentElement.getAttribute('data-name'),
            isVisible: (button.getAttribute('data-column-is-visible') === 'true')
        };
        this.document.getEngine().getLoader().trigger('payments_column_visibility_changed', columnData);
    };
    return SummaryEditorSetting;
}(EditorSetting));
var BraintreeEditorSetting = (function (_super) {
    __extends(BraintreeEditorSetting, _super);
    function BraintreeEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || BraintreeEditorSetting.defaultProperties, BraintreeEditorSetting.getConfiguration(), 'IBraintreeSetting', document, runtime) || this;
    }
    BraintreeEditorSetting.getConfiguration = function () {
        return {
            name: 'Braintree',
            keywords: 'braintree',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_braintree',
            index: 90,
        };
    };
    BraintreeEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_BRAINTREE_EDITOR_SETTING;
    };
    BraintreeEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    BraintreeEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Merchant ID',
                            type: 'string',
                            propertyFQN: 'merchantId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_merchantId',
                        },
                        {
                            label: 'Public Key',
                            type: 'string',
                            propertyFQN: 'publicKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_publicKey',
                        },
                        {
                            label: 'Private Key',
                            type: 'string',
                            propertyFQN: 'privateKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_privateKey',
                        },
                        {
                            label: 'Plan ID',
                            type: 'string',
                            propertyFQN: 'planId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_planId',
                        }
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'BILLING',
                    properties: [
                        {
                            label: 'Settlement',
                            type: 'boolean',
                            propertyFQN: 'automaticPaymentSettlement',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_settlement',
                        },
                        {
                            label: 'Billing Address',
                            type: 'boolean',
                            propertyFQN: 'requireBillingAddress',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_billingAddress',
                        }
                    ],
                }
            ]
        };
    };
    return BraintreeEditorSetting;
}(EditorSetting));
var PaypalCheckoutEditorSetting = (function (_super) {
    __extends(PaypalCheckoutEditorSetting, _super);
    function PaypalCheckoutEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || PaypalCheckoutEditorSetting.defaultProperties, PaypalCheckoutEditorSetting.getConfiguration(), 'IPaypalCheckoutSettings', document, runtime) || this;
    }
    PaypalCheckoutEditorSetting.getConfiguration = function () {
        return {
            name: 'PayPal Express Checkout',
            keywords: 'paypal express checkout',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_paypal',
            index: 10,
        };
    };
    PaypalCheckoutEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_CHECKOUT_EDITOR_SETTING;
    };
    PaypalCheckoutEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    PaypalCheckoutEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'Account',
                    properties: [
                        {
                            label: 'Client ID',
                            type: 'string',
                            propertyFQN: 'clientId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_clientId',
                        },
                        {
                            label: 'Language',
                            type: 'string',
                            propertyFQN: 'language',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_language',
                        },
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'Billing',
                    properties: [
                        {
                            label: 'Use detailed invoice',
                            type: 'boolean',
                            propertyFQN: 'useDetailedInvoice',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_useDetailedInvoice',
                        },
                        {
                            label: 'Use shipping',
                            type: 'boolean',
                            propertyFQN: 'useShipping',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_useShipping',
                        },
                    ],
                },
                {
                    name: 'shipping_information',
                    i18nName: 'edt_UI_setting_processor_attribute_shipping_label',
                    label: 'Shipping information',
                    properties: [
                        {
                            label: '',
                            type: 'IPaypalShippingInformationSettings',
                            propertyFQN: 'shippingInformation',
                            i18nName: null,
                        },
                    ],
                }
            ]
        };
    };
    return PaypalCheckoutEditorSetting;
}(EditorSetting));
var PaypalPayflowEditorSetting = (function (_super) {
    __extends(PaypalPayflowEditorSetting, _super);
    function PaypalPayflowEditorSetting(properties, document, runtime) {
        var _this = _super.call(this, properties || PaypalPayflowEditorSetting.defaultProperties, PaypalPayflowEditorSetting.getConfiguration(), 'IPaypalPayflowSetting', document, runtime) || this;
        var loader = document.getEngine().getLoader();
        _this.on('property-change', function (propertyFQN, propertyValue, oldValue, self) {
            if (propertyFQN === 'useRecurrentPayment') {
                loader.getCommandDispatcher().loadEditorSettingIntoPanel(self, true);
            }
        });
        return _this;
    }
    PaypalPayflowEditorSetting.getConfiguration = function () {
        return {
            name: 'Paypal Payflow',
            keywords: 'paypal payflow',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_paypal',
            index: 80,
        };
    };
    PaypalPayflowEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PAYFLOW_EDITOR_SETTING;
    };
    PaypalPayflowEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    PaypalPayflowEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        var model = {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Username',
                            type: 'string',
                            propertyFQN: 'userId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_userId',
                        },
                        {
                            label: 'Merchant',
                            type: 'string',
                            propertyFQN: 'merchantId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_merchantId_paypalPayflow',
                        },
                        {
                            label: 'Partner',
                            type: 'string',
                            propertyFQN: 'partner',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_partner',
                        },
                        {
                            label: 'Password',
                            type: 'string',
                            propertyFQN: 'password',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_password',
                        }
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'BILLING',
                    properties: [
                        {
                            label: 'User recurrent payment',
                            type: 'boolean',
                            propertyFQN: 'useRecurrentPayment',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_useRecurrentPayment',
                        }
                    ],
                }
            ]
        };
        if (this.getProperty('useRecurrentPayment') === true) {
            model.groups[1].properties = model.groups[1].properties.concat([
                {
                    label: 'Frequency',
                    type: 'int',
                    propertyFQN: 'recurrenceFrequency',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceFrequency',
                },
                {
                    label: 'Time expressed in',
                    type: 'int',
                    propertyFQN: 'recurrenceTimeUnit',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceTimeUnit',
                },
                {
                    label: 'Recurrence cycles',
                    type: 'int',
                    propertyFQN: 'recurrenceCycles',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceCycles',
                }
            ]);
        }
        return model;
    };
    return PaypalPayflowEditorSetting;
}(EditorSetting));
var StripeEditorSetting = (function (_super) {
    __extends(StripeEditorSetting, _super);
    function StripeEditorSetting(properties, document, runtime) {
        var _this = _super.call(this, properties || StripeEditorSetting.defaultProperties, StripeEditorSetting.getConfiguration(), 'IStripeSetting', document, runtime) || this;
        var loader = document.getEngine().getLoader();
        _this.on('property-change', function (propertyFQN, propertyValue, oldValue, self) {
            if (propertyFQN === 'useRecurrentPayment') {
                loader.getCommandDispatcher().loadEditorSettingIntoPanel(self, true);
            }
        });
        return _this;
    }
    StripeEditorSetting.getConfiguration = function () {
        return {
            name: 'Stripe',
            keywords: 'stripe',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_stripe',
            index: 30,
        };
    };
    StripeEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_EDITOR_SETTING;
    };
    StripeEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    StripeEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        var userPubKey = this.getProperty('userPubKey'), model = {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: false,
            isEnabled: this.getProperty('isEnabled'),
            needsOAuthConnect: true,
            groups: []
        };
        if (null !== userPubKey) {
            model.isToggleable = true;
            model.groups = [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Connected Account',
                            type: 'string',
                            propertyFQN: 'userEmail',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_email_stripeCheckout',
                        }
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'BILLING',
                    properties: [
                        {
                            label: 'Required billing address',
                            type: 'boolean',
                            propertyFQN: 'isBillingAddressRequired',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_isBillingAddressRequired',
                        },
                        {
                            label: 'User recurrent payment',
                            type: 'boolean',
                            propertyFQN: 'useRecurrentPayment',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_useRecurrentPayment',
                        }
                    ],
                },
                {
                    name: 'description_information',
                    i18nName: 'edt_UI_setting_processor_attribute_description_label',
                    label: 'DESCRIPTION',
                    properties: [
                        {
                            label: '',
                            type: 'string',
                            propertyFQN: 'description',
                            i18nName: null,
                        }
                    ],
                }
            ];
            if (this.getProperty('useRecurrentPayment') === true) {
                model.groups[1].properties = model.groups[1].properties.concat([
                    {
                        label: 'Frequency',
                        type: 'int',
                        propertyFQN: 'recurrenceFrequency',
                        i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceFrequency',
                    },
                    {
                        label: 'Time expressed in',
                        type: 'int',
                        propertyFQN: 'recurrenceTimeUnit',
                        i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceTimeUnit',
                    }
                ]);
            }
        }
        return model;
    };
    StripeEditorSetting.prototype.oAuthDisconnect = function () {
        this.setProperty('isEnabled', false);
        this.setProperty('userEmail', null);
        this.setProperty('userId', null);
        this.setProperty('userPubKey', null);
        this.setProperty('userSecKey', null);
        this.getForm().getEngine().getLoader().getCommandDispatcher().loadEditorSettingIntoPanel(this);
    };
    return StripeEditorSetting;
}(EditorSetting));
var StripeCheckoutEditorSetting = (function (_super) {
    __extends(StripeCheckoutEditorSetting, _super);
    function StripeCheckoutEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || StripeCheckoutEditorSetting.defaultProperties, StripeCheckoutEditorSetting.getConfiguration(), 'IStripeCheckoutSetting', document, runtime) || this;
    }
    StripeCheckoutEditorSetting.getConfiguration = function () {
        return {
            name: 'Stripe Checkout',
            keywords: 'stripe checkout',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_stripe',
            index: 120,
        };
    };
    StripeCheckoutEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_STRIPE_CHECKOUT_EDITOR_SETTING;
    };
    StripeCheckoutEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    StripeCheckoutEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        var userPubKey = this.getProperty('userPubKey'), model = {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: false,
            isEnabled: this.getProperty('isEnabled'),
            needsOAuthConnect: true,
            groups: []
        };
        if (null !== userPubKey) {
            model.isToggleable = true;
            model.groups = [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Connected Account',
                            type: 'string',
                            propertyFQN: 'userEmail',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_email_stripeCheckout',
                        },
                        {
                            label: 'Store Name',
                            type: 'string',
                            propertyFQN: 'storeName',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_storeName',
                        },
                        {
                            label: 'Store short description',
                            type: 'string',
                            propertyFQN: 'storeDescription',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_storeDescription',
                        },
                        {
                            label: 'Store image URL',
                            type: 'string',
                            propertyFQN: 'storeImage',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_storeImage',
                        }
                    ],
                }
            ];
        }
        return model;
    };
    StripeCheckoutEditorSetting.prototype.oAuthDisconnect = function () {
        this.setProperty('isEnabled', false);
        this.setProperty('userEmail', null);
        this.setProperty('userId', null);
        this.setProperty('userPubKey', null);
        this.setProperty('userSecKey', null);
        this.getForm().getEngine().getLoader().getCommandDispatcher().loadEditorSettingIntoPanel(this);
    };
    return StripeCheckoutEditorSetting;
}(EditorSetting));
var PayUEditorSetting = (function (_super) {
    __extends(PayUEditorSetting, _super);
    function PayUEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || PayUEditorSetting.defaultProperties, PayUEditorSetting.getConfiguration(), 'IPayUSetting', document, runtime) || this;
    }
    PayUEditorSetting.getConfiguration = function () {
        return {
            name: 'PayU',
            keywords: 'payu',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_payu',
            index: 100,
        };
    };
    PayUEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_PAYU_EDITOR_SETTING;
    };
    PayUEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    PayUEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Merchant ID',
                            type: 'string',
                            propertyFQN: 'merchantId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_merchantId',
                        },
                        {
                            label: 'Encryption Key',
                            type: 'string',
                            propertyFQN: 'encryptionKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_encryptionKey',
                        },
                        {
                            label: 'Collect VAT',
                            type: 'boolean',
                            propertyFQN: 'collectVat',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_collectVat',
                        }
                    ],
                }
            ]
        };
    };
    return PayUEditorSetting;
}(EditorSetting));
var PaypalEditorSetting = (function (_super) {
    __extends(PaypalEditorSetting, _super);
    function PaypalEditorSetting(properties, document, runtime) {
        var _this = _super.call(this, properties || PaypalEditorSetting.defaultProperties, PaypalEditorSetting.getConfiguration(), 'IPaypalSettings', document, runtime) || this;
        var loader = document.getEngine().getLoader();
        _this.on('property-change', function (propertyFQN, propertyValue, oldValue, self) {
            var radioLikeProperties = ['useRecurrentPayment', 'isDonation', 'useDetailedInvoice'];
            if (radioLikeProperties.indexOf(propertyFQN) > -1) {
                var update = false;
                if (propertyValue) {
                    update = true;
                    radioLikeProperties.forEach(function (prop) {
                        if (prop !== propertyFQN) {
                            self.setProperty(prop, false);
                        }
                    });
                }
                else if (propertyFQN === 'useRecurrentPayment') {
                    update = true;
                }
                if (update) {
                    loader.getCommandDispatcher().loadEditorSettingIntoPanel(self, true);
                }
            }
        });
        return _this;
    }
    PaypalEditorSetting.getConfiguration = function () {
        return {
            name: 'PayPal',
            keywords: 'paypal',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_paypal',
            index: 50,
        };
    };
    PaypalEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_EDITOR_SETTING;
    };
    PaypalEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    PaypalEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        var model = {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'Account',
                    properties: [
                        {
                            label: 'Email address',
                            type: 'string',
                            propertyFQN: 'clientId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_email',
                        },
                        {
                            label: 'Language',
                            type: 'string',
                            propertyFQN: 'language',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_language',
                        },
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'Billing',
                    properties: [
                        {
                            label: 'Use recurrent payment',
                            type: 'boolean',
                            propertyFQN: 'useRecurrentPayment',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_useRecurrentPayment',
                        }
                    ],
                },
                {
                    name: 'shipping_information',
                    i18nName: 'edt_UI_setting_processor_attribute_shipping_label',
                    label: 'Shipping information',
                    properties: [
                        {
                            label: '',
                            type: 'IPaypalShippingInformationSettings',
                            propertyFQN: 'shippingInformation',
                            i18nName: null,
                        },
                    ],
                }
            ]
        };
        if (this.getProperty('useRecurrentPayment')) {
            model.groups[1].properties = model.groups[1].properties.concat([
                {
                    label: 'Frequency',
                    type: 'int',
                    propertyFQN: 'recurrenceFrequency',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceFrequency',
                },
                {
                    label: 'Time expressed in',
                    type: 'int',
                    propertyFQN: 'recurrenceTimeUnit',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceTimeUnit',
                },
                {
                    label: 'Recurring cycles',
                    type: 'int',
                    propertyFQN: 'recurrenceCycles',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceCycles',
                }
            ]);
        }
        model.groups[1].properties = model.groups[1].properties.concat([
            {
                label: 'Payment represents a donation',
                type: 'boolean',
                propertyFQN: 'isDonation',
                i18nName: 'edt_UI_setting_processor_attribute_billing_property_isDonation',
            },
            {
                label: 'Use detailed invoice',
                type: 'boolean',
                propertyFQN: 'useDetailedInvoice',
                i18nName: 'edt_UI_setting_processor_attribute_billing_property_useDetailedInvoice',
            },
            {
                label: 'Use shipping',
                type: 'boolean',
                propertyFQN: 'useShipping',
                i18nName: 'edt_UI_setting_processor_attribute_billing_property_useShipping',
            }
        ]);
        return model;
    };
    return PaypalEditorSetting;
}(EditorSetting));
var PaypalProEditorSetting = (function (_super) {
    __extends(PaypalProEditorSetting, _super);
    function PaypalProEditorSetting(properties, document, runtime) {
        var _this = _super.call(this, properties || PaypalProEditorSetting.defaultProperties, PaypalProEditorSetting.getConfiguration(), 'IPaypalProSettings', document, runtime) || this;
        var loader = document.getEngine().getLoader();
        _this.on('property-change', function (propertyFQN, propertyValue, oldValue, self) {
            if (propertyFQN === 'useRecurrentPayment') {
                loader.getCommandDispatcher().loadEditorSettingIntoPanel(self, true);
            }
        });
        return _this;
    }
    PaypalProEditorSetting.getConfiguration = function () {
        return {
            name: 'PayPal Pro',
            keywords: 'paypal pro',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_paypal',
            index: 60,
        };
    };
    PaypalProEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_PAYPAL_PRO_EDITOR_SETTING;
    };
    PaypalProEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    PaypalProEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        var model = {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'Account',
                    properties: [
                        {
                            label: 'API Username',
                            type: 'string',
                            propertyFQN: 'apiUsername',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_apiUsername',
                        },
                        {
                            label: 'API Password',
                            type: 'string',
                            propertyFQN: 'apiPassword',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_apiPassword',
                        },
                        {
                            label: 'API Signature',
                            type: 'string',
                            propertyFQN: 'apiSignature',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_apiSignature',
                        },
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'Billing',
                    properties: [
                        {
                            label: 'Use recurrent payment',
                            type: 'boolean',
                            propertyFQN: 'useRecurrentPayment',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_useRecurrentPayment',
                        }
                    ],
                },
            ]
        };
        if (this.getProperty('useRecurrentPayment')) {
            model.groups[1].properties = model.groups[1].properties.concat([
                {
                    label: 'Frequency',
                    type: 'int',
                    propertyFQN: 'recurrenceFrequency',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceFrequency',
                },
                {
                    label: 'Time expressed in',
                    type: 'int',
                    propertyFQN: 'recurrenceTimeUnit',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceTimeUnit',
                },
                {
                    label: 'Recurring cycles',
                    type: 'int',
                    propertyFQN: 'recurrenceCycles',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_property_recurrenceCycles',
                }
            ]);
        }
        return model;
    };
    return PaypalProEditorSetting;
}(EditorSetting));
var SquareEditorSetting = (function (_super) {
    __extends(SquareEditorSetting, _super);
    function SquareEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || SquareEditorSetting.defaultProperties, SquareEditorSetting.getConfiguration(), 'ISquareSettings', document, runtime) || this;
    }
    SquareEditorSetting.getConfiguration = function () {
        return {
            name: 'Square',
            keywords: 'square',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_square',
            index: 20,
        };
    };
    SquareEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_SQUARE_EDITOR_SETTING;
    };
    SquareEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    SquareEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        var model = {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: false,
            isEnabled: this.getProperty('isEnabled'),
            needsOAuthConnect: true,
            groups: []
        };
        if (null !== this.getProperty('oAuthToken')) {
            model.isToggleable = true;
            model.groups = [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Location',
                            type: 'string',
                            propertyFQN: 'locationId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_locationId',
                        },
                        {
                            label: 'Locations',
                            type: 'string',
                            propertyFQN: 'locations',
                            i18nName: 'edt_UI_setting_processor_attribute_square_property_locations',
                        }
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'BILLING',
                    properties: [
                        {
                            label: 'Use detailed invoice',
                            type: 'boolean',
                            propertyFQN: 'useDetailedInvoice',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_useDetailedInvoice',
                        },
                    ],
                },
            ];
        }
        return model;
    };
    SquareEditorSetting.prototype.oAuthDisconnect = function () {
        this.setProperty('isEnabled', false);
        this.setProperty('oAuthToken', null);
        this.setProperty('locations', SquareEditorSetting.defaultProperties.locations);
        this.setProperty('locationId', null);
        this.setProperty('useDetailedInvoice', SquareEditorSetting.defaultProperties.useDetailedInvoice);
        this.getForm().getEngine().getLoader().getCommandDispatcher().loadEditorSettingIntoPanel(this);
    };
    return SquareEditorSetting;
}(EditorSetting));
var SisowEditorSetting = (function (_super) {
    __extends(SisowEditorSetting, _super);
    function SisowEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || SisowEditorSetting.defaultProperties, SisowEditorSetting.getConfiguration(), 'ISisowSetting', document, runtime) || this;
    }
    SisowEditorSetting.getConfiguration = function () {
        return {
            name: 'Sisow',
            keywords: 'sisow',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_sisow',
            index: 140,
        };
    };
    SisowEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_SISOW_EDITOR_SETTING;
    };
    SisowEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    SisowEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'Account',
                    properties: [
                        {
                            label: 'Merchant ID',
                            type: 'string',
                            propertyFQN: 'merchantId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_merchantId',
                        },
                        {
                            label: 'Merchant Key',
                            type: 'string',
                            propertyFQN: 'merchantKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_merchantKey',
                        },
                    ],
                },
            ]
        };
    };
    return SisowEditorSetting;
}(EditorSetting));
var PayfastEditorSetting = (function (_super) {
    __extends(PayfastEditorSetting, _super);
    function PayfastEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || PayfastEditorSetting.defaultProperties, PayfastEditorSetting.getConfiguration(), 'IPayfastSetting', document, runtime) || this;
    }
    PayfastEditorSetting.getConfiguration = function () {
        return {
            name: 'Payfast',
            keywords: 'payfast',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_payfast',
            index: 130,
        };
    };
    PayfastEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_PAYFAST_EDITOR_SETTING;
    };
    PayfastEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    PayfastEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Merchant ID',
                            type: 'string',
                            propertyFQN: 'merchantId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_merchantId',
                        },
                        {
                            label: 'Merchant Key',
                            type: 'string',
                            propertyFQN: 'merchantKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_merchantKey',
                        }
                    ],
                }
            ]
        };
    };
    return PayfastEditorSetting;
}(EditorSetting));
var WorldpayEditorSetting = (function (_super) {
    __extends(WorldpayEditorSetting, _super);
    function WorldpayEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || WorldpayEditorSetting.defaultProperties, WorldpayEditorSetting.getConfiguration(), 'IWorldpaySetting', document, runtime) || this;
    }
    WorldpayEditorSetting.getConfiguration = function () {
        return {
            name: 'Worldpay',
            keywords: 'worldpay',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_worldpay',
            index: 150,
        };
    };
    WorldpayEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_WORLDPAY_EDITOR_SETTING;
    };
    WorldpayEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    WorldpayEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Client Key',
                            type: 'string',
                            propertyFQN: 'clientKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_clientKey',
                        },
                        {
                            label: 'Service Key',
                            type: 'string',
                            propertyFQN: 'serviceKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_serviceKey',
                        }
                    ],
                }
            ]
        };
    };
    return WorldpayEditorSetting;
}(EditorSetting));
var AuthorizeEditorSetting = (function (_super) {
    __extends(AuthorizeEditorSetting, _super);
    function AuthorizeEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || AuthorizeEditorSetting.defaultProperties, AuthorizeEditorSetting.getConfiguration(), 'IAuthorizeSetting', document, runtime) || this;
    }
    AuthorizeEditorSetting.getConfiguration = function () {
        return {
            name: 'Authorize.Net',
            keywords: 'authorize net',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_authorize_net',
            index: 40,
        };
    };
    AuthorizeEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_AUTHORIZE_EDITOR_SETTING;
    };
    AuthorizeEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    AuthorizeEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'API Login ID',
                            type: 'string',
                            propertyFQN: 'apiLoginId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_apiLoginId',
                        },
                        {
                            label: 'Transaction Key',
                            type: 'string',
                            propertyFQN: 'transactionKey',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_transactionKey',
                        },
                        {
                            label: 'Create a Customer Information Profile (CIM)',
                            type: 'boolean',
                            propertyFQN: 'cimFlag',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_cimFlag',
                        }
                    ],
                }
            ]
        };
    };
    return AuthorizeEditorSetting;
}(EditorSetting));
var SagepayEditorSetting = (function (_super) {
    __extends(SagepayEditorSetting, _super);
    function SagepayEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || SagepayEditorSetting.defaultProperties, SagepayEditorSetting.getConfiguration(), 'ISagepaySetting', document, runtime) || this;
    }
    SagepayEditorSetting.getConfiguration = function () {
        return {
            name: 'SagePay',
            keywords: 'sagepay',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_sagepay',
            index: 70,
        };
    };
    SagepayEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_SAGEPAY_EDITOR_SETTING;
    };
    SagepayEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    SagepayEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'Account',
                    properties: [
                        {
                            label: 'Vendor name',
                            type: 'string',
                            propertyFQN: 'vendorName',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_vendorName',
                        },
                        {
                            label: 'Encryption password',
                            type: 'string',
                            propertyFQN: 'encryptionPassword',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_encryptionPassword',
                        },
                        {
                            label: 'Vendor email (optional)',
                            type: 'string',
                            propertyFQN: 'vendorEmail',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_vendorEmail',
                        },
                        {
                            label: 'Partner ID (optional)',
                            type: 'string',
                            propertyFQN: 'partnerId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_partnerId',
                        },
                    ],
                },
                {
                    name: 'billing',
                    i18nName: 'edt_UI_setting_processor_attribute_billing_label',
                    label: 'Billing',
                    properties: [
                        {
                            label: 'Customer email',
                            type: 'string',
                            propertyFQN: 'customerEmail',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_customerEmail',
                        }
                    ],
                },
            ]
        };
    };
    return SagepayEditorSetting;
}(EditorSetting));
var FreshbooksEditorSetting = (function (_super) {
    __extends(FreshbooksEditorSetting, _super);
    function FreshbooksEditorSetting(properties, document, runtime) {
        var _this = _super.call(this, properties || FreshbooksEditorSetting.defaultProperties, FreshbooksEditorSetting.getConfiguration(), 'IFreshbooksSetting', document, runtime) || this;
        _this.on('property-change', function (propertyFQN, propertyValue, oldValue, self) {
            if (propertyFQN === 'useOAuth') {
                document.getEngine().getLoader().getCommandDispatcher().loadEditorSettingIntoPanel(self);
            }
        });
        return _this;
    }
    FreshbooksEditorSetting.getConfiguration = function () {
        return {
            name: 'FreshBooks',
            keywords: 'freshbooks',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_freshbooks',
            index: 110,
        };
    };
    FreshbooksEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_FRESHBOOKS_EDITOR_SETTING;
    };
    FreshbooksEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    FreshbooksEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        var model = {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: false,
            isEnabled: this.getProperty('isEnabled'),
            needsOAuthConnect: false,
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'ACCOUNT',
                    properties: [
                        {
                            label: 'Use OAuth authorization',
                            type: 'boolean',
                            propertyFQN: 'useOAuth',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_useOAuth',
                        },
                    ],
                },
                {
                    name: 'client_information',
                    i18nName: 'edt_UI_setting_processor_attribute_clientInformation_label',
                    label: 'CLIENT INFORMATION',
                    properties: [
                        {
                            label: '',
                            type: 'IFreshbooksClientInformationSettings',
                            propertyFQN: 'clientInformation',
                            i18nName: null,
                        },
                        {
                            label: 'Update client if email exists',
                            type: 'boolean',
                            propertyFQN: 'updateMatchingEmailClient',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_updateClient',
                        },
                    ],
                },
                {
                    name: 'invoice_information',
                    i18nName: 'edt_UI_setting_processor_attribute_invoiceInformation_label',
                    label: 'INVOICE / ESTIMATE',
                    properties: [
                        {
                            label: '',
                            type: 'IFreshbooksInvoiceInformationSettings',
                            propertyFQN: 'invoiceInformation',
                            i18nName: null,
                        },
                    ],
                },
                {
                    name: 'options',
                    i18nName: 'edt_UI_setting_processor_attribute_options_label',
                    label: 'OPTIONS',
                    properties: [
                        {
                            label: 'Email on failure',
                            type: 'string',
                            propertyFQN: 'failureEmail',
                            i18nName: 'edt_UI_setting_processor_attribute_billing_property_failureEmail',
                        },
                    ],
                },
            ]
        };
        if (this.getProperty('useOAuth')) {
            model.needsOAuthConnect = true;
            if (this.getProperty('oAuthToken')) {
                model.isToggleable = true;
            }
        }
        else {
            model.isToggleable = true;
            model.groups[0].properties.push({
                label: 'URL',
                type: 'string',
                propertyFQN: 'oAuthCustomUrl',
                i18nName: 'edt_UI_setting_processor_attribute_account_property_oAuthCustomUrl',
            }, {
                label: 'Token',
                type: 'string',
                propertyFQN: 'oAuthCustomToken',
                i18nName: 'edt_UI_setting_processor_attribute_account_property_oAuthCustomToken',
            });
        }
        return model;
    };
    FreshbooksEditorSetting.prototype.oAuthDisconnect = function () {
        this.setProperty('isEnabled', false);
        this.setProperty('oAuthToken', null);
        this.getForm().getEngine().getLoader().getCommandDispatcher().loadEditorSettingIntoPanel(this);
    };
    return FreshbooksEditorSetting;
}(EditorSetting));
var CivicaEditorSetting = (function (_super) {
    __extends(CivicaEditorSetting, _super);
    function CivicaEditorSetting(properties, document, runtime) {
        return _super.call(this, properties || CivicaEditorSetting.defaultProperties, CivicaEditorSetting.getConfiguration(), 'ICivicaSetting', document, runtime) || this;
    }
    CivicaEditorSetting.getConfiguration = function () {
        return {
            name: 'Civica',
            keywords: 'civica',
            typeId: EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING,
            group: EditorSettingGroups.PAYMENT_PROCESSORS,
            category: 'e-commerce',
            visible: true,
            i18nName: '',
            i18nKeywords: '',
            icon: 'i123-processor_civica',
            index: 160,
        };
    };
    CivicaEditorSetting.prototype.getTypeId = function () {
        return EditorSettingTypes.PAYMENT_PROCESSOR_CIVICA_EDITOR_SETTING;
    };
    CivicaEditorSetting.prototype.getGroupTypeId = function () {
        return EditorSettingGroups.PAYMENT_PROCESSORS;
    };
    CivicaEditorSetting.prototype.getSettingsModelForInspectorPanel = function () {
        return {
            hasEditingCapabilities: true,
            isRemovable: true,
            isToggleable: true,
            isEnabled: this.getProperty('isEnabled'),
            groups: [
                {
                    name: 'account',
                    i18nName: 'edt_UI_setting_processor_attribute_account_label',
                    label: 'Account',
                    properties: [
                        {
                            label: 'Paylink',
                            type: 'string',
                            propertyFQN: 'payLink',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_payLink',
                        },
                        {
                            label: 'Calling application ID',
                            type: 'string',
                            propertyFQN: 'callingApplicationId',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_callingApplicationId',
                        },
                        {
                            label: 'Account Reference',
                            type: 'string',
                            propertyFQN: 'accountReference',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_accountReference',
                        },
                        {
                            label: 'Fund code',
                            type: 'string',
                            propertyFQN: 'fundCode',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_fundCode',
                        },
                        {
                            label: 'VAT code (optional)',
                            type: 'string',
                            propertyFQN: 'vatCode',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_vatCode',
                        },
                        {
                            label: 'General ledger code (optional)',
                            type: 'string',
                            propertyFQN: 'generalLedgerCode',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_generalLedgerCode',
                        },
                    ],
                },
                {
                    name: 'description',
                    i18nName: 'edt_UI_setting_processor_attribute_description_label',
                    label: 'Description',
                    properties: [
                        {
                            label: 'Description',
                            type: 'string',
                            propertyFQN: 'description',
                            i18nName: 'edt_UI_setting_processor_attribute_description_property_description_civica'
                        }
                    ]
                },
                {
                    name: 'testing_mode',
                    i18nName: 'edt_UI_setting_processor_attribute_testing_label',
                    label: 'Testing mode',
                    properties: [
                        {
                            label: 'Paylink for testing',
                            type: 'string',
                            propertyFQN: 'payLinkForTesting',
                            i18nName: 'edt_UI_setting_processor_attribute_account_property_payLinkForTesting',
                        }
                    ]
                },
            ]
        };
    };
    return CivicaEditorSetting;
}(EditorSetting));
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.ELEMENT_TYPE_FORM, /^options\.widthIn(Pixels|Percents)$/, function (engine) {
    engine.getTheme().recompute();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.ELEMENT_TYPE_FORM, /^options\.(label(Placement|WidthInUnits|TextAlignment)|instructions(Placement|TextAlignment)|direction|paginationType|showPageTitles)$/, function (engine, document, target, propertyFQN) {
    switch (propertyFQN) {
        case 'options.labelTextAlignment':
            document.updateLabelTextAlignment();
            break;
        case 'options.instructionsTextAlignment':
            document.updateInstructionsTextAlignment();
            break;
        case 'options.direction':
            document.updateTextDirection();
            break;
        case 'options.labelPlacement':
            document.updateLabelPlacement();
        case 'options.labelWidthInUnits':
        case 'options.instructionsPlacement':
            engine.reconfigureLayout();
            break;
        case 'options.paginationType':
        case 'options.showPageTitles':
            document.renderPageHeadersInImmediateMode();
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.ELEMENT_TYPE_FORM, 'name.value', function (engine, document, target, propertyFQN, newValue) {
    engine.getLoader().execCommand('form-name-changed');
    if (engine.getLoader().getLoaderType() === EFormLoaderType.EDIT) {
        window['EditorPanelConfig'].getPublishPanel().withDependency('formName', newValue);
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'label.labelText', function (engine, document, target) {
    if (target.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE && target.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE) {
        if (target.isRenderingSupported()) {
            target.updateLabelText();
        }
    }
    else {
        document.renderPageHeadersInImmediateMode();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_HEADING, 'configuration.fontSize', function (engine, document, target) {
    target.updateLabelText();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_DATE, /^(configuration\.(acceptedDaysOfWeek|weekStart)|validation\.(type))$/, function (engine, document, target) {
    target.setDateControlOptions();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_TIME, 'configuration.timeFormat', function (engine, document, target) {
    target.setTimeControlOptions();
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'instructions.text', function (engine, document, target) {
    if (target.isRenderingSupported()) {
        target.updateInstructionsText();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, /^label.is(CompactField|Removed)$/, function (engine, document, target, propertyFQN, propertyValue) {
    if (target.isRenderingSupported()) {
        target.reRender();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'label.isBold', function (engine, document, target) {
    if (target.isRenderingSupported()) {
        target.updateLabelBoldState();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'label.isItalic', function (engine, document, target) {
    if (target.isRenderingSupported()) {
        target.updateLabelItalicState();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'label.isHidden', function (engine, document, target) {
    if (target.isRenderingSupported()) {
        target.updateLabelHiddenState();
    }
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_HEADING], /(configuration.fieldName)|(label.isRemoved)/, function (engine, document, target, propertyFQN) {
    switch (propertyFQN) {
        case 'configuration.fieldName':
            target.updateFieldNameAttribute();
            break;
        case 'label.isRemoved':
            target.updateLabelRemovedState();
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'id', function (engine, document, target, attributeName, newValue) {
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'options.required', function (engine, document, target) {
    if (target.isRenderingSupported()) {
        target.updateRequiredState();
    }
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_FORM_HEADER, ElementTypes.CONTROL_TYPE_HTML_BLOCK], 'configuration.innerHTML', function (engine, document, target) {
    target.updateHTMLContent();
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_TEXT, ElementTypes.CONTROL_TYPE_TEXTAREA, ElementTypes.CONTROL_TYPE_EMAIL, ElementTypes.CONTROL_TYPE_NUMBER, ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, ElementTypes.CONTROL_TYPE_WEBSITE], /^configuration.defaultValue(IsUniqueId)?$/, function (engine, document, target) {
    target.updateDefaultValue();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.agreementLabelAdditionalText', function (engine, document, target) {
    target.updateTOSAdditionalLabelText();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_ACTION_BAR, null, function (engine, document, target) {
    target.updateDOMAttributes();
    engine.getLoader().execCommand('repaint-footer');
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_CAPTCHA, /^(configuration|label)\./, function (engine, document, target, attributeName) {
    if (true !== engine.getLoader().getLoaderDependency(ELoaderDependency.SKIP_CAPTCHA)) {
        if (attributeName === 'configuration.type') {
            target.onCaptchaTypeChanged();
            target.reRender();
        }
        var lastPage = document.getPageByIndex(document.getNumberOfPages() - 1);
        if (lastPage)
            lastPage.renderFooter();
    }
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_DROPDOWN, ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_RADIO, ElementTypes.CONTROL_TYPE_LIKERT_SCALE], /^(choices\.|options\.randomizeOrder$|layout\.(columns|isSideBySide)$)/, function (engine, document, target) {
    try {
        target.updateChoices();
    }
    catch (e) {
        console.warn('FAILED to update choices on element ' + target.getHash() + ' of type ' + target.getElementName());
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_LIKERT_SCALE, /^options\.(inlineOptions|boldOptions)$/, function (engine, document, target, attributeName) {
    switch (attributeName) {
        case 'options.inlineOptions':
            target.updateChoices();
            target.updateInlineOptionsAttribute();
            break;
        case 'options.boldOptions':
            target.updateBoldOptionsAttribute();
            break;
        default:
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, /^options\.(inlineOptions|boldOptions|choiceTextAlignment)$/, function (engine, document, target, attributeName) {
    switch (attributeName) {
        case 'options.inlineOptions':
            target.updateInlineOptionsState();
            break;
        case 'options.boldOptions':
            target.updateBoldOptionsState();
            break;
        case 'options.choiceTextAlignment':
            target.updateChoiceTextAlignment();
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_RADIO, 'options.clearable', function (engine, document, target) {
    target.updateClearableOption();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
], 'layout.direction', function (engine, document, target) {
    target.reRender();
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_RADIO], 'layout.isSideBySide', function (engine, document, target) {
    target.updateSideBySideAttribute();
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'options.hidden', function (engine, document, target) {
    target.updateHiddenAttribute();
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_RADIO, ElementTypes.CONTROL_TYPE_DROPDOWN], 'options.showNumberOfChoicesLeft', function (engine, document, target) {
    target.updateChoices();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_MAP, /^configuration\.(initialZoom|isInteractive|initialAddressText)$/, function (engine, document, target, propertyFQName) {
    switch (propertyFQName) {
        case 'configuration.initialZoom':
            target.updateMapZoomSetting();
            break;
        case 'configuration.isInteractive':
            target.updateMapInteractiveSetting();
            break;
        case 'configuration.initialAddressText':
            target.updateMarkerPositionInThrottledMode();
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, /^validation\./, function (engine, document, target) {
    if (target.getElementKind() === EElementKind.CONTROL && ('function' === typeof target.onValidationChanged)) {
        target.onValidationChanged();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, /^value\./, function (engine, document, target, attributeName, attributeValue, oldAttributeValue) {
    target.trigger('change');
    if (target.getElementKind() === EElementKind.CONTROL && oldAttributeValue !== attributeValue) {
        if (target['synchronizationEnabled']) {
            target['synchronizeValue']();
        }
        var showRealtimeCalcuations = target.getForm().getEngine().getLoader().getLoaderDependency(ELoaderDependency.SHOW_REALTIME_CALCULATIONS);
        if (showRealtimeCalcuations) {
            document.realTimeCalculationsThrottler();
        }
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_NAME, /^configuration\.field/, function (engine, document, target) {
    target.reRender();
});
ElementVirtualProperty.addVirtualProperty('configuration.uploadToCustomizeImage', 'string', [
    ElementTypes.CONTROL_TYPE_IMAGE,
], function () {
    if (this.hasProperty('configuration.remoteURL')) {
        return this.getProperty('configuration.remoteURL');
    }
    return null;
}, function (filePath) {
    if (this.hasProperty('configuration.remoteURL')) {
        this.setProperty('configuration.remoteURL', filePath);
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_IMAGE, /^configuration\.(remoteURL|name|align|alternateText)$/, function (engine, document, target, attributeName) {
    if (attributeName === 'configuration.alternateText') {
        target.updateAlternateTextAttribute();
    }
    else {
        target.updateImageOptions();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_SOCIAL, /^configuration\./, function (engine, document, target, attributeName) {
    if (attributeName === 'configuration.alignment') {
        target.updateAlignment();
    }
    else {
        target.refreshButtons();
    }
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'instructions.showInstructionsOnClick', function (engine, document, target) {
    target.updateShowInstructionsOnClick();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_HTML_BLOCK, 'configuration.fieldName', function (engine, document, target) {
    target.updateFieldNameAttribute();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_STAR_RATING, /^configuration\.(displayAs|starsCount)$/, function (engine, document, target, attributeName) {
    switch (attributeName) {
        case 'configuration.displayAs':
            target.updateStarShapeType();
            break;
        case 'configuration.starsCount':
            target.updateStarsCount();
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.zoneLabel', function (engine, document, target) {
    target.updateZoneLabelPlaceholder();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.postalCodeLabel', function (engine, document, target) {
    target.updatePostalCodeLabelPlaceholder();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.defaultCountry', function (engine, document, target) {
    target.setDefaultCountry();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_ADDRESS, /^configuration\.(addressStyle|countries)$/, function (engine, document, target) {
    target.populateCountryDOMNode();
    target.configureRegionDOMNode();
    target.updateZoneLabelPlaceholder();
    target.reRender();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_NAME, /^configuration\.(defaultValue|fieldInitials|fieldMiddleName|fieldTitle|titleChoices)$/, function (engine, document, target, attributeName) {
    switch (attributeName) {
        case 'configuration.titleChoices':
            target.updateTitleOptions();
        default:
            target.updateDefaultName();
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_FILE, /^configuration\.(allow|forbid)Extensions$/, function (engine, document, target, attributeName) {
    switch (attributeName) {
        case 'configuration.allowExtensions':
            target.updateAllowedFileExtensions();
            break;
        case 'configuration.forbidExtensions':
            target.updateDisabledFileExtensions();
            break;
    }
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_DATE], 'configuration.defaultValue', function (engine, document, target) {
    target.loadDefaultDateValueIntoForm();
});
GlobalEventHandler.addPropertyChangeEventListener([ElementTypes.CONTROL_TYPE_TIME], /^configuration\.(defaultValue|timeFormat)$/, function (engine, document, target) {
    target.loadDefaultTimeValueIntoForm();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_PRICE, 'options.intendedCurrencyISOCode', function (engine, document, target) {
    target.updateCurrencyLabel();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_PRICE, 'options.hideDecimals', function (engine, document, target) {
    target.updatePlaceholderValue();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_WEBSITE,
], 'synchronize.withControlId', function (engine, document, target) {
    target.onSynchronizeWithControlIdPropertyChanged();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_WEBSITE,
], 'synchronize.enabled', function (engine, document, target) {
    target.onSynchronizeEnabledPropertyChanged();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_TEXTAREA, 'size.heightInRows', function (engine, document, target) {
    target.setHeightInRows();
});
GlobalEventHandler.addPropertyChangeEventListener(null, 'validation.type', function (engine, document, target, propertyFQN, newValue, oldValue) {
    if (target.getElementKind() === EElementKind.CONTROL) {
        target.displayValidationUpgradePopupIfNeeded(oldValue);
    }
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'options.randomizeOrder', function (engine, document, target) {
    target.randomizeOptions();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], /^configuration\.(isLimitSubmissionsEnabled|limitSubmissionsTotal)$/, function (engine, document, target) {
    target.updateInstructionsText();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_WIDGET_VIDEO,
    ElementTypes.CONTROL_TYPE_WIDGET_PDF,
    ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK,
], 'configuration.url', function (engine, document, target) {
    target.generateProperLinkForIframe();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_EMAIL
], "options.suggestions", function (engine, document, target) {
    target.initializeSuggestions();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_TEXTAREA,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_NUMBER,
], 'options.readOnly', function (engine, document, target) {
    target.onReadonlyStateChanged();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTAINER_TYPE_REPEATABLE, "configuration.addButtonText", function (engine, document, target) {
    target.onAddButtonTextChanged();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTAINER_TYPE_REPEATABLE, "configuration.showBorders", function (engine, document, target) {
    target.onBorderSettingsChanged();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTAINER_TYPE_REPEATABLE, "configuration.maxNumberOfGroupsAllowed", function (engine, document, target) {
    target.updateNumberOfGroupsAllowed();
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_MAP, "configuration.apiKey", function (engine, document, target) {
    apiKeyDebounced(target);
});
var apiKeyDebounced = Debounce.create(function (target) {
    target.updateApiKey();
    target.initializeMapCanvas();
}, 500);
GlobalEventHandler.addPropertyChangeEventListener(null, "payments.value", function (engine, document, target) {
    engine.getLoader().getCommandDispatcher().trackFirstValueSaved(target);
});
GlobalEventHandler.addPropertyChangeEventListener(ElementTypes.CONTROL_TYPE_FEE, "payments.value", function (engine, document, target) {
    target.updatePriceFee();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], "configuration.prefix", function (engine, document, target) {
    target.updatePrefixLabel();
});
GlobalEventHandler.addPropertyChangeEventListener([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], /^label.(isCompactField|labelText)$/, function (engine, document, target) {
    if (target.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAGE && target.getTypeId() !== ElementTypes.CONTAINER_TYPE_PAYMENT_SUMMARY_PAGE && target.isRenderingSupported()) {
        target.syncInputCompactField();
    }
});
Form.addNormalizationSelector('#form div[data-type=virtual-form-table-row]:empty');
Form.addNormalizationSelector('#form div[data-role=control][data-type=separator][data-colspan="0"]');
Form.addNormalizationSelector('#form div[data-type=virtual-form-table-row][data-num-children="1"] > div[data-role=control][data-type=separator]');
Form.addNormalizationSelector('#form div[data-role=container][data-type=div][data-num-children="0"], #form div[data-role=container][data-type=div]:not([data-num-children])');
Form.addNormalizationSelector('#form div[data-role=container][data-type=div][data-num-children="1"] > div[data-role=container][data-role=virtual-form-table-row][data-num-children="1"] > div[data-hash]', function (unwrapElement) {
    var obsoleteDivContainer = unwrapElement.getParent(), elementUnwrapParent = obsoleteDivContainer.getParent();
    elementUnwrapParent.insertBefore(obsoleteDivContainer, unwrapElement);
    elementUnwrapParent.removeChild(obsoleteDivContainer);
});
Form.addNormalizationSelector('#form div[data-type=virtual-form-table-row] > div[data-role=control][data-type=page-break]');
ElementVirtualProperty.addVirtualProperty('label.visibilityMode', 'int', [
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_FILE,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_TEXTAREA,
    ElementTypes.CONTROL_TYPE_ADDRESS,
    ElementTypes.CONTROL_TYPE_DATE,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
    ElementTypes.CONTROL_TYPE_LIKERT_SCALE,
    ElementTypes.CONTROL_TYPE_NAME,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_PHONE,
    ElementTypes.CONTROL_TYPE_PRICE,
    ElementTypes.CONTROL_TYPE_TIME,
    ElementTypes.CONTROL_TYPE_MAP,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_SIGNATURE,
    ElementTypes.CONTROL_TYPE_STAR_RATING,
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_HEADING,
    ElementTypes.CONTROL_TYPE_COUPON,
    ElementTypes.CONTROL_TYPE_FORMULA,
    ElementTypes.CONTROL_TYPE_FEE,
], function () {
    return this.getVisibilityMode();
}, function (visibilityMode) {
    this.setVisibilityMode(visibilityMode);
});
ElementVirtualProperty.addVirtualProperty('choices.statements', 'I18nText[]', [ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER], function () {
    return this.getChoiceStatements();
}, function (value) {
    this.setChoiceStatements(value);
});
ElementVirtualProperty.addVirtualProperty('options.required', 'boolean', [ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER], function () {
    return this.isRequired();
}, function (value) {
    this.setRequired(value);
});
ElementVirtualProperty.addVirtualProperty('configuration.allowedPlatforms', 'int[]', [ElementTypes.CONTROL_TYPE_SOCIAL], function () {
    return this.getAllowedSocialPlatforms();
}, function (allowedPlatforms) {
    this.setAllowedSocialPlatforms(allowedPlatforms);
});
ElementVirtualProperty.addVirtualProperty('choices.scale', 'TextChoiceInterface[]', [ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER], function () {
    return this.getChoiceScale();
}, function (value) {
    this.setChoiceScale(value);
});
ElementVirtualProperty.addVirtualProperty('options.quizOptions', 'TextChoiceInterface[]', [
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
], function () {
    return this.getChoiceScale();
}, function (values) {
    this.setProperty('choices.scale', values);
});
ElementVirtualProperty.addVirtualProperty('options.paginationType', 'int', [ElementTypes.CONTAINER_TYPE_PAGE], function () {
    return this.getPaginationType();
}, function (paginationType) {
    this.setPaginationType(paginationType);
});
ElementVirtualProperty.addVirtualProperty('options.showPageTitles', 'boolean', [ElementTypes.CONTAINER_TYPE_PAGE], function () {
    return this.getPageTitlesVisibility();
}, function (visibility) {
    this.setPageTitlesVisibility(visibility);
});
ElementVirtualProperty.addVirtualProperty('options.widthUnit', 'string', [ElementTypes.ELEMENT_TYPE_FORM], function () {
    return this.getWidthUnit();
}, function (unitType) {
    this.setWidthUnit(unitType);
});
ElementVirtualProperty.addVirtualProperty('options.requiredFields', 'int[]', [ElementTypes.CONTROL_TYPE_ADDRESS], function () {
    return this.getRequiredFields();
}, function (requiredFields) {
    this.setRequiredFields(requiredFields);
});
ElementVirtualProperty.addVirtualProperty('configuration.allowedFields', 'int[]', [ElementTypes.CONTROL_TYPE_ADDRESS], function () {
    return this.getAllowedFields();
}, function (allowedFields) {
    this.setAllowedFields(allowedFields);
});
ElementVirtualProperty.addVirtualProperty('value.fullCountryName', 'string', [ElementTypes.CONTROL_TYPE_ADDRESS], function () {
    return this.getFullCountryName();
}, function (countryName) {
    if (countryName && countryName.length === 2) {
        this.setCountryByCountryCode(countryName);
    }
    else {
        this.setCountryByCountryName(countryName);
    }
});
ElementVirtualProperty.addVirtualProperty('configuration.optionalFields', 'int[]', [ElementTypes.CONTROL_TYPE_NAME], function () {
    return this.getOptionalFields();
}, function (fields) {
    this.setOptionalFields(fields);
});
ElementVirtualProperty.addVirtualProperty('configuration.configurableButtons', 'string[]', [ElementTypes.CONTROL_TYPE_ACTION_BAR], function () {
    return this.getConfigurableButtons();
}, function (configurableButtons) {
    this.setConfigurableButtons(configurableButtons);
});
ElementVirtualProperty.addVirtualProperty('configuration.acceptedDaysOfWeekString', 'string[]', [
    ElementTypes.CONTROL_TYPE_DATE,
], function () {
    return this.getAcceptedDaysOfWeekString();
}, function (acceptedDaysOfWeekString) {
    this.setAcceptedDaysOfWeekString(acceptedDaysOfWeekString);
});
ElementVirtualProperty.addVirtualProperty('value.stringValue', 'string', [ElementTypes.CONTROL_TYPE_DATE, ElementTypes.CONTROL_TYPE_TIME], function () {
    return this.getStringValue();
}, function (value) {
    this.setStringValue(value);
});
ElementVirtualProperty.addVirtualProperty('value.fixedPart', 'string', [ElementTypes.CONTROL_TYPE_PRICE], function () {
    return this.getIntPartAsString();
}, function (intPartAsString) {
    this.setIntPartFromString(intPartAsString);
});
ElementVirtualProperty.addVirtualProperty('value.decimalPart', 'string', [ElementTypes.CONTROL_TYPE_PRICE], function () {
    return this.getDecimalPartAsString();
}, function (decimalPartAsString) {
    this.setDecimalPartAsString(decimalPartAsString);
});
ElementVirtualProperty.addVirtualProperty('value.asFloat', 'number', [ElementTypes.CONTROL_TYPE_PRICE], function () {
    return this.getValueAsFloat();
}, function (floatValue) {
    if (this.getValueAsFloat() > 0 && floatValue != this.getValueAsFloat()) {
        this.getForm().getEngine().loader.getDOMAbstractionLayer().trigger('compute-form-rules', function () { });
    }
    this.setValueFromFloat(floatValue);
});
ElementVirtualProperty.addVirtualProperty('value.downloadURL', 'string', [ElementTypes.CONTROL_TYPE_FILE], function () {
    return this.getDownloadURL();
}, function (downloadURL) {
    this.setDownloadURL(downloadURL);
});
ElementVirtualProperty.addVirtualProperty('options.isNumberOfTimesAnOptionCanBeChosen', 'boolean', [ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_RADIO, ElementTypes.CONTROL_TYPE_DROPDOWN], function () {
    return this.isNumberOfTimesAnOptionCanBeChosen();
}, function (value) {
    this.setIsNumberOfTimesAnOptionCanBeChosen(value);
});
ElementVirtualProperty.addVirtualProperty('options.configureValues', 'TextChoiceInterface[]', [ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_RADIO, ElementTypes.CONTROL_TYPE_DROPDOWN], function () {
    return this.getChoicesValues();
}, function (values) {
    this.setChoicesValues(values);
});
ElementVirtualProperty.addVirtualProperty('options.quizOptions', 'TextChoiceInterface[]', [
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_DROPDOWN
], function () {
    return this.getChoicesValues();
}, function (values) {
    this.setChoicesValues(values);
});
ElementVirtualProperty.addVirtualProperty('payments.virtualValue', 'number', [
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_STAR_RATING,
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
    ElementTypes.CONTROL_TYPE_PRICE,
    ElementTypes.CONTROL_TYPE_FEE
], function () {
    return PaymentsAttributeHelper.getValueForSingleValueControl(this);
}, function (value) {
    PaymentsAttributeHelper.setValueForSingleValueControl(this, value);
});
ElementVirtualProperty.addVirtualProperty('payments.virtualValue', 'TextChoiceInterface[]', [
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
], function () {
    return PaymentsAttributeHelper.getValueForOptionsBasedControl(this);
}, function (choices) {
    PaymentsAttributeHelper.setValueForOptionsBasedControl(this, choices);
});
ElementVirtualProperty.addVirtualProperty('payments.virtualValue', 'TextChoiceInterface[]', [
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
], function () {
    return PaymentsAttributeHelper.getValueForComposedControl(this);
}, function (choices) {
    PaymentsAttributeHelper.setValueForComposedControl(this, choices);
});
ElementVirtualProperty.addVirtualProperty('payments.productsDialogTrigger', 'any', [
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_STAR_RATING,
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_PRICE,
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
], function () { }, function () { });
ElementVirtualProperty.addVirtualProperty('coupons.couponCodes', 'ICouponCodeSettings[]', [ElementTypes.CONTROL_TYPE_COUPON], function () {
    return this.getCouponCodes();
}, function (couponCodes) {
    this.setCouponCodes(couponCodes);
});
ElementVirtualProperty.addVirtualProperty('options.displaySuggestions', 'boolean', [
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_WEBSITE
], function () {
    return this.getSuggestionsVisibility();
}, function (displaySuggestions) {
    this.setSuggestionsVisibility(displaySuggestions);
});
ElementVirtualProperty.addVirtualProperty('configuration.minSizeInKiloBytes', 'number', [ElementTypes.CONTROL_TYPE_FILE], function () {
    return this.getMinSizeInKiloBytes();
}, function (sizeInKiloBytes) {
    this.setMinSizeInKiloBytes(sizeInKiloBytes);
});
ElementVirtualProperty.addVirtualProperty('configuration.maxSizeInKiloBytes', 'number', [ElementTypes.CONTROL_TYPE_FILE], function () {
    return this.getMaxSizeInKiloBytes();
}, function (sizeInKiloBytes) {
    this.setMaxSizeInKiloBytes(sizeInKiloBytes);
});
ElementVirtualProperty.addVirtualProperty('options.displayPrefix', 'boolean', [
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], function () {
    return this.getPrefixVisibility();
}, function (displayPrefix) {
    this.setPrefixVisibility(displayPrefix);
});
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/(^label\.(widthInUnits|isCompactField|isHidden|isRemoved)$|^configuration\.(remoteURL|id|name|size|mimeType)$|^value\.|^layoutSize\.|i18n|I18n)/, null, null);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^options\.(paginationType|showPageTitles)|name\.value$/, null, [ElementTypes.ELEMENT_TYPE_FORM]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^(options|configuration)\.(required|isRequiredField(Address1|Address2|City|Zone|ZipCode|Country)|field(Address1|Address2|City|Zone|ZipCode|Country))$/, null, ElementTypes.CONTROL_TYPE_ADDRESS);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^(size\.value|choices\.allowOther)$/, null, ElementTypes.CONTROL_TYPE_DROPDOWN);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^configuration\.hasButtonGooglePlus|hasButtonLinkedin|hasButtonTwitter|hasFacebookLike|hasFacebookShare$/, null, ElementTypes.CONTROL_TYPE_SOCIAL);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^configuration\.minValue|maxValue$/, null, [ElementTypes.CONTROL_TYPE_TEXT, ElementTypes.CONTROL_TYPE_EMAIL]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^(configuration\.mapHeight|instructions\.showInstructionsOnClick)$/, null, ElementTypes.CONTROL_TYPE_MAP);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^configuration\.(fieldInitials|fieldMiddleName|fieldTitle)$/, null, ElementTypes.CONTROL_TYPE_NAME);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^(configuration\.has(Approve|Calculate|Next|Preview|Previous|Print|Reset|SaveForLater|Submit|Update|Purchase)Button|label\.is(Bold|Italic))$/, null, ElementTypes.CONTROL_TYPE_ACTION_BAR);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel(/^configuration\.(maxValue|minValue)$/, null, ElementTypes.CONTROL_TYPE_WEBSITE);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('configuration.acceptedDaysOfWeek', null, ElementTypes.CONTROL_TYPE_DATE);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('validation.type', null, [
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_FORMULA,
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('configuration.disableSubmitButtonAfterClick', null, ElementTypes.CONTROL_TYPE_ACTION_BAR);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('instructions.showInstructionsOnClick', null, [
    ElementTypes.CONTROL_TYPE_FILE,
    ElementTypes.CONTAINER_TYPE_REPEATABLE
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('payments.value', null, [
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_STAR_RATING,
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_PRICE,
    ElementTypes.CONTROL_TYPE_LIKERT_SCALE
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('payments.hasProductsSettingsEntry', null, [
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_STAR_RATING,
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_PRICE,
    ElementTypes.CONTROL_TYPE_LIKERT_SCALE
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('payments.isProduct', null, null);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('configuration.minSizeInBytes', null, [
    ElementTypes.CONTROL_TYPE_FILE
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('configuration.maxSizeInBytes', null, [
    ElementTypes.CONTROL_TYPE_FILE
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('options.useDifferentValuesPerStatement', null, [
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('payments.hasProductsSettingsEntry', 'boolean', [
    ElementTypes.CONTROL_TYPE_FEE
]);
InspectorHiddenProperties.makePropertyHiddenInInspectorPanel('payments.value', 'number[]', [
    ElementTypes.CONTROL_TYPE_FEE
]);
ElementPropertyOrder.setPropertyGroup(null, 'configuration.maxLength', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(null, 'configuration.minLength', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(null, 'configuration.maxNumberOfWords', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(null, 'configuration.minNumberOfWords', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(null, 'options.required', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(null, 'options.noDuplicates', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_TEXTAREA,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_NAME,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.VIRTUAL_SELECTION_CONTROL,
], 'configuration.defaultValue', ElementPropertyOrder.ATTRIBUTE_DEFAULT_VALUE);
ElementPropertyOrder.setPropertyGroup([ElementTypes.CONTROL_TYPE_TEXT], 'configuration.defaultValueIsUniqueId', ElementPropertyOrder.ATTRIBUTE_DEFAULT_VALUE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_CHECKBOX, 'choices.maxNumberOfChoices', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_CHECKBOX, 'choices.minNumberOfChoices', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'choices.scale', ElementPropertyOrder.ATTRIBUTE_SCALE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'choices.statements', ElementPropertyOrder.ATTRIBUTE_STATEMENTS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'options.boldOptions', ElementPropertyOrder.ATTRIBUTE_LAYOUT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'options.choiceTextAlignment', ElementPropertyOrder.ATTRIBUTE_LAYOUT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'options.inlineOptions', ElementPropertyOrder.ATTRIBUTE_LAYOUT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_STAR_RATING, 'configuration.defaultValue', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_STAR_RATING, 'configuration.displayAs', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_STAR_RATING, 'configuration.starsCount', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FILE, 'options.multiple', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FILE, 'configuration.allowExtensions', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FILE, 'configuration.isAllowFolderUpload', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FILE, 'configuration.forbidExtensions', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FILE, 'configuration.maxSizeInBytes', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FILE, 'configuration.minSizeInBytes', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.maxValue', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.minValue', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.limitSubmissionsTotal', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_NAME, 'configuration.optionalFields', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_NAME, 'configuration.titleChoices', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.addressStyle', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.allowedFields', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.countries', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.defaultCountry', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.zoneLabel', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ADDRESS, 'options.requiredFields', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_DATE, 'configuration.acceptedDaysOfWeek', ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_DATE, 'configuration.acceptedDaysOfWeekString', ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_DATE, 'configuration.maxDateRelativeValue', ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_DATE, 'configuration.minDateRelativeValue', ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_DATE, 'configuration.defaultValue', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_DATE, 'configuration.weekStart', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TIME, 'configuration.defaultValue', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TIME, 'configuration.defaultValue', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TIME, 'configuration.timeFormat', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_PRICE, 'options.intendedCurrencyISOCode', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_PRICE, 'options.hideDecimals', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.agreementHTMLMarkup', ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.linkBehaviour', ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.popupHeightInPixels', ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.popupWidthInPixels', ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.url', ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.agreementLabelAdditionalText', ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.defaultValue', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_HEADING, 'label.labelText', ElementPropertyOrder.ATTRIBUTE_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_HEADING, 'label.visibilityMode', ElementPropertyOrder.ATTRIBUTE_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_HEADING, 'label.isBold', ElementPropertyOrder.ATTRIBUTE_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_HEADING, 'label.isItalic', ElementPropertyOrder.ATTRIBUTE_TEXT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_HEADING, 'configuration.fontSize', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_HTML_BLOCK, 'configuration.innerHTML', ElementPropertyOrder.ATTRIBUTE_HTML_CONTENT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_IMAGE, 'configuration.uploadToCustomizeImage', ElementPropertyOrder.ATTRIBUTE_IMAGE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_IMAGE, 'configuration.align', ElementPropertyOrder.ATTRIBUTE_IMAGE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_PAGE, 'label.labelText', ElementPropertyOrder.ATTRIBUTE_PAGE_TITLE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_PAGE, 'options.paginationType', ElementPropertyOrder.ATTRIBUTE_LAYOUT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTAINER_TYPE_PAGE, 'options.showPageTitles', ElementPropertyOrder.ATTRIBUTE_LAYOUT);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.allowedPlatforms', ElementPropertyOrder.ATTRIBUTE_BUTTONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.alignment', ElementPropertyOrder.ATTRIBUTE_BUTTONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.facebookTitle', ElementPropertyOrder.ATTRIBUTE_FACEBOOK_SHARE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.facebookDescription', ElementPropertyOrder.ATTRIBUTE_FACEBOOK_SHARE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.useCustomLink', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.customLink', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_MAP, 'configuration.initialAddressText', ElementPropertyOrder.ATTRIBUTE_DEFAULT_MAP);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_MAP, 'configuration.initialZoom', ElementPropertyOrder.ATTRIBUTE_DEFAULT_MAP);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_MAP, 'configuration.isInteractive', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_CAPTCHA, 'configuration.type', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.buttonsPosition', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.configurableButtons', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'label.submitButtonText', ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'label.autoSubmitButtonText', ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.disableSubmitButtonAfterClick', ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.hasSubmitButtonIcon', ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'label.resetButtonText', ElementPropertyOrder.ATTRIBUTE_RESET_BUTTON);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'label.isItalic', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'label.isBold', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_HEADING,
    ElementTypes.CONTROL_TYPE_HTML_BLOCK,
    ElementTypes.CONTROL_TYPE_IMAGE,
], 'configuration.fieldName', ElementPropertyOrder.ATTRIBUTE_FIELD_NAME);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_IMAGE,
], 'configuration.alternateText', ElementPropertyOrder.ATTRIBUTE_ALT_TEXT);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'synchronize.enabled', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'synchronize.withControlId', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_TEXTAREA, 'size.heightInRows', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.currentSubmissionsValue', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.isLimitSubmissionsEnabled', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_WIDGET_VIDEO,
    ElementTypes.CONTROL_TYPE_WIDGET_PDF,
    ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK,
], 'configuration.url', ElementPropertyOrder.ATTRIBUTE_URL);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_WIDGET_VIDEO,
    ElementTypes.CONTROL_TYPE_WIDGET_PDF,
    ElementTypes.CONTROL_TYPE_WIDGET_FACEBOOK,
], 'configuration.fieldName', ElementPropertyOrder.ATTRIBUTE_FIELD_NAME);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_MAP,
], 'synchronize.enabled', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_MAP,
], 'synchronize.withControlId', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_MAP,
], 'propagate.enabled', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_MAP,
], 'propagate.onControlId', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTAINER_TYPE_REPEATABLE
], 'configuration.addButtonText', ElementPropertyOrder.ATTRIBUTE_ADD_BUTTON);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_FILE
], 'configuration.minSizeInKiloBytes', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_FILE
], 'configuration.maxSizeInKiloBytes', ElementPropertyOrder.ATTRIBUTE_VALIDATION);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.postalCodeLabel', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_MAP, 'configuration.apiKey', ElementPropertyOrder.ATTRIBUTE_MAPS_API_KEY);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FEE, 'label.labelText', ElementPropertyOrder.ATTRIBUTE_FEE_DETAILS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FEE, 'instructions.text', ElementPropertyOrder.ATTRIBUTE_FEE_DETAILS);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FEE, 'payments.virtualValue', ElementPropertyOrder.ATTRIBUTE_FEE_PRICE);
ElementPropertyOrder.setPropertyGroup(ElementTypes.CONTROL_TYPE_FEE, 'label.visibilityMode', ElementPropertyOrder.ATTRIBUTE_FEE_DETAILS);
ElementPropertyOrder.setPropertyGroup([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.prefix', ElementPropertyOrder.ATTRIBUTE_OPTIONS);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_IMAGE, ElementPropertyOrder.ATTRIBUTE_IMAGE, 'uploadToCustomizeImage', 'align', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TEXT, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'type', 'customValue', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_SOCIAL, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'useCustomLink', 'customLink', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_CHECKBOX, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'hasGroupedAnswers', 'groupedAnswersSeparatorType', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(null, ElementPropertyOrder.ATTRIBUTE_INSTRUCTIONS, 'text', 'showInstructionsOnClick', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TEXT, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'required', 'type', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TEXT, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'type', 'minLength', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(null, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minLength', 'maxLength', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(null, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minNumberOfWords', 'maxNumberOfWords', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TEXT, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'maxLength', 'noDuplicates', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TEXTAREA, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minLength', 'required', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_RADIO, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'clearable', 'hidden', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_DROPDOWN, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'searchable', 'randomizeOrder', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([ElementTypes.CONTROL_TYPE_DROPDOWN, ElementTypes.CONTROL_TYPE_RADIO], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'randomizeOrder', 'resetChoicesCountEveryDay', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([ElementTypes.CONTROL_TYPE_DROPDOWN, ElementTypes.CONTROL_TYPE_RADIO, ElementTypes.CONTROL_TYPE_CHECKBOX], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'showNumberOfChoicesLeft', 'hidden', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([ElementTypes.CONTROL_TYPE_RADIO, ElementTypes.CONTROL_TYPE_CHECKBOX], ElementPropertyOrder.ATTRIBUTE_CHOICES, 'values', 'allowOther', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_CHECKBOX, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minNumberOfChoices', 'maxNumberOfChoices', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_CHECKBOX, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minNumberOfChoices', 'required', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_STAR_RATING, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'defaultValue', 'starsCount', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_FILE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'required', 'multiple', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_FILE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'multiple', 'isAllowFolderUpload', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_FILE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'isAllowFolderUpload', 'allowExtensions', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_FILE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'allowExtensions', 'forbidExtensions', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_FILE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'forbidExtensions', 'minSizeInKiloBytes', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_FILE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minSizeInKiloBytes', 'maxSizeInKiloBytes', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_NUMBER, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'type', 'minValue', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(null, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minValue', 'maxValue', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'maxValue', 'limitSubmissionsTotal', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'limitSubmissionsTotal', 'minLength', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minLength', 'maxLength', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'maxLength', 'noDuplicates', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_EMAIL, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'required', 'minLength', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_EMAIL, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minLength', 'maxLength', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_EMAIL, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'maxLength', 'noDuplicates', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_NAME, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'titleChoices', 'capitalize', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_NAME, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'capitalize', 'hidden', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_NAME, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'required', 'noDuplicates', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_ADDRESS, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'hidden', 'zoneLabel', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_PHONE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'type', 'noDuplicates', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_DATE, ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES, 'minDateRelativeValue', 'maxDateRelativeValue', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_DATE, ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES, 'maxDateRelativeValue', 'acceptedDaysOfWeekString', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_DATE, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'defaultValue', 'weekStart', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_DATE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'type', 'noDuplicates', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_PRICE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'required', 'intendedCurrencyISOCode', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_PRICE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'intendedCurrencyISOCode', 'hideDecimals', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_WEBSITE, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minLength', 'required', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_PASSWORD, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'minLength', 'type', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_PASSWORD, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'type', 'required', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT, 'linkBehaviour', 'agreementHTMLMarkup', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT, 'agreementHTMLMarkup', 'popupWidthInPixels', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_SOCIAL, ElementPropertyOrder.ATTRIBUTE_BUTTONS, 'allowedPlatforms', 'alignment', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_SOCIAL, ElementPropertyOrder.ATTRIBUTE_FACEBOOK_SHARE, 'facebookTitle', 'facebookDescription', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_ACTION_BAR, ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON, 'submitButtonText', 'disableSubmitButtonAfterClick', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_ACTION_BAR, ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON, 'disableSubmitButtonAfterClick', 'hasSubmitButtonIcon', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_ACTION_BAR, ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON, 'submitButtonText', 'autoSubmitButtonText', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TEXT, ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'type', 'customValue', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_DROPDOWN, ElementTypes.CONTROL_TYPE_RADIO], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'randomizeOrder', 'isNumberOfTimesAnOptionCanBeChosen', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_DROPDOWN, ElementTypes.CONTROL_TYPE_RADIO], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'isNumberOfTimesAnOptionCanBeChosen', 'configureValues', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_FORMULA,
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'withControlId', 'enabled', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_FORMULA,
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'noDuplicates', 'enabled', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER
], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'hidden', 'quizOptions', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'limitSubmissionsTotal', 'currentSubmissionsValue', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], ElementPropertyOrder.ATTRIBUTE_VALIDATION, 'currentSubmissionsValue', 'isLimitSubmissionsEnabled', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_STAR_RATING,
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_PRICE,
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
], ElementPropertyOrder.ATTRIBUTE_PAYMENTS, 'virtualValue', 'productsDialogTrigger', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_MAP,
], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'enabled', 'isInteractive', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_MAP,
], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'enabled', 'withControlId', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_WEBSITE
], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'suggestions', 'displaySuggestions', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder([ElementTypes.CONTROL_TYPE_DROPDOWN], ElementPropertyOrder.ATTRIBUTE_CHOICES, 'isWorkflowsUserDropdown', 'values', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([ElementTypes.CONTROL_TYPE_DROPDOWN], ElementPropertyOrder.ATTRIBUTE_CHOICES, 'values', 'isDropdownWithForms', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_ADDRESS, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'hidden', 'postalCodeLabel', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_FEE, ElementPropertyOrder.ATTRIBUTE_FEE_DETAILS, 'labelText', 'visibilityMode', EFormPropertyOrderPlacement.BEFORE);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_TEXT, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'suggestions', 'prefix', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder(ElementTypes.CONTROL_TYPE_NUMBER, ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'readOnly', 'prefix', EFormPropertyOrderPlacement.AFTER);
ElementPropertyOrder.setPropertyOrder([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], ElementPropertyOrder.ATTRIBUTE_OPTIONS, 'prefix', 'displayPrefix', EFormPropertyOrderPlacement.BEFORE);
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DATE, 'configuration.acceptedDaysOfWeekString', 'Accepted days:', 'edt_UI_property_configuration_acceptedDaysOfWeekString');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'label.visibilityMode', 'Visibility:', 'edt_UI_property_label_visibilityMode');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'instructions.showInstructionsOnClick', 'Show on click:', 'edt_UI_property_instructions_showInstructionsOnClick');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.required', 'Required field:', 'edt_UI_property_options_required');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL
], 'validation.type', 'Field validation:', 'edt_UI_property_validation_type_field');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.minValue', 'Min value:', 'edt_UI_property_configuration_minValue');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_NUMBER, 'configuration.defaultValue', 'Value', 'edt_UI_property_configuration_defaultValue_number');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_NUMBER, 'configuration.limitSubmissionsTotal', 'Limit submissions total value:', 'edt_UI_property_configuration_limitSubmissionsTotal');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.maxValue', 'Max value:', 'edt_UI_property_configuration_maxValue');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'configuration.maxLength', 'Max no. of characters:', 'edt_UI_property_configuration_maxLength');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'configuration.minLength', 'Min no. of characters:', 'edt_UI_property_configuration_minLength');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.noDuplicates', 'Don\'t allow duplicate values:', 'edt_UI_property_options_noDuplicates');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.hidden', 'Hide field:', 'edt_UI_property_options_hidden');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.suggestions', 'Suggestions:', 'edt_UI_property_options_suggestions');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.readOnly', 'Readonly field:', 'edt_UI_property_options_readonly');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'configuration.maxNumberOfWords', 'Max no. of words:', 'edt_UI_property_configuration_maxNumberOfWords');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'configuration.minNumberOfWords', 'Min no. of words:', 'edt_UI_property_configuration_minNumberOfWords');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DROPDOWN, 'options.searchable', 'Searchable:', 'edt_UI_property_options_searchable');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
], 'options.randomizeOrder', 'Randomize choices:', 'edt_UI_property_options_randomizeOrder');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER,
], 'options.randomizeOrder', 'Randomize statements:', 'edt_text_randomize_statements');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.resetChoicesCountEveryDay', 'Reset every day:', 'edt_UI_property_options_resetChoicesCountEveryDay');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.showNumberOfChoicesLeft', 'Show no. of choices left:', 'edt_UI_property_options_showNumberOfChoicesLeft');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_RADIO, 'options.clearable', 'Clearable:', 'edt_UI_property_options_clearable');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX
], 'layout.columns', 'No. of columns:', 'edt_UI_property_layout_columns');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX
], 'layout.direction', 'Direction:', 'edt_UI_property_layout_direction');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX
], 'layout.isSideBySide', 'Inline choices:', 'edt_UI_property_layout_isSideBySide');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'choices.allowOther', 'Accept other values:', 'edt_UI_property_choices_allowOther');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'choices.maxNumberOfChoices', 'Max no. of choices:', 'edt_UI_property_choices_maxNumberOfChoices');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'choices.minNumberOfChoices', 'Min no. of choices:', 'edt_UI_property_choices_minNumberOfChoices');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_CHECKBOX, 'options.hasGroupedAnswers', 'Group answers:', 'edt_UI_property_options_hasGroupedAnswers');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_CHECKBOX, 'options.groupedAnswersSeparatorType', 'Separator:', 'edt_UI_property_options_groupedAnswersSeparatorType');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'options.boldOptions', 'Bold scale values:', 'edt_UI_property_options_boldOptions');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'options.choiceTextAlignment', 'Scale values alignment:', 'edt_UI_property_options_choiceTextAlignment');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_LIKERT_WRAPPER, 'options.inlineOptions', 'Inline scale values:', 'edt_UI_property_options_inlineOptions');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_STAR_RATING, 'configuration.starsCount', 'No. of stars:', 'edt_UI_property_configuration_starsCount');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_STAR_RATING, 'configuration.displayAs', 'Display as:', 'edt_UI_property_configuration_displayAs');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_STAR_RATING, 'configuration.defaultValue', 'Default value:', 'edt_UI_property_configuration_defaultValue_star');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'options.multiple', 'Allow multiple files:', 'edt_UI_property_options_multiple');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'configuration.isAllowFolderUpload', 'Allow folder upload:', 'edt_UI_property_configuration_isAllowFolderUpload');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'configuration.allowExtensions', 'File types accepted:', 'edt_UI_property_configuration_allowExtensions');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'configuration.forbidExtensions', 'File types forbidden:', 'edt_UI_property_configuration_forbidExtensions');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'configuration.maxSizeInBytes', 'Max file size:', 'edt_UI_property_configuration_maxSizeInBytes');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'configuration.minSizeInBytes', 'Min file size:', 'edt_UI_property_configuration_minSizeInBytes');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'configuration.minSizeInKiloBytes', 'Min file size (KB):', 'edt_UI_property_configuration_minSizeInKiloBytes');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FILE, 'configuration.maxSizeInKiloBytes', 'Max file size (KB):', 'edt_UI_property_configuration_maxSizeInKiloBytes');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.capitalize', 'Capitalize first letter:', 'edt_UI_property_options_capitalize');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_NAME, 'configuration.optionalFields', 'Additional subfields:', 'edt_UI_property_configuration_optionalFields');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.addressStyle', 'Address style:', 'edt_UI_property_configuration_addressStyle');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.allowedFields', 'Visible subfields:', 'edt_UI_property_configuration_allowedFields');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.countries', 'Avaliable countries:', 'edt_UI_property_configuration_countries');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.defaultCountry', 'Default country:', 'edt_UI_property_configuration_defaultCountry');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.zoneLabel', 'Region label:', 'edt_UI_property_configuration_zoneLabel');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DATE, 'configuration.defaultValue', 'Default date:', 'edt_UI_property_configuration_defaultValue_date');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DATE, 'configuration.maxDateRelativeValue', 'Until:', 'edt_UI_property_configuration_maxDateRelativeValue');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DATE, 'configuration.minDateRelativeValue', 'From:', 'edt_UI_property_configuration_minDateRelativeValue');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DATE, 'configuration.weekStart', 'Week starts on:', 'edt_UI_property_configuration_weekStart');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DATE, 'validation.type', 'Date format:', 'edt_UI_property_validation_type_date');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_PHONE, 'validation.type', 'Number format', 'edt_UI_property_validation_type_number');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_TIME, 'configuration.defaultValue', 'Default time:', 'edt_UI_property_configuration_defaultValue_time');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_TIME, 'configuration.timeFormat', 'Time format:', 'edt_UI_property_configuration_timeFormat');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_PRICE, 'options.hideDecimals', 'Hide decimals:', 'edt_UI_property_options_hideDecimals');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_PRICE, 'options.intendedCurrencyISOCode', 'Currency:', 'edt_UI_property_options_intendedCurrencyISOCode');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_PASSWORD, 'validation.type', 'Password complexity:', 'edt_UI_property_validation_type_password');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_SIGNATURE, 'validation.type', 'Signature complexity:', 'edt_UI_property_validation_type_signature');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.linkBehaviour', 'Link behaviour:', 'edt_UI_property_configuration_linkBehaviour');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.popupHeightInPixels', 'Popup height:', 'edt_UI_property_configuration_popupHeightInPixels');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.popupWidthInPixels', 'Popup width:', 'edt_UI_property_configuration_popupWidthInPixels');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE, 'configuration.defaultValue', 'Checked by default:', 'edt_UI_property_configuration_defaultValue_TOS');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_HEADING, 'configuration.fontSize', 'Font size:', 'edt_UI_property_configuration_fontSize');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_IMAGE, 'configuration.align', 'Alignment', 'edt_UI_property_configuration_align');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_PAGE, 'options.showPageTitles', 'Show page titles:', 'edt_UI_property_options_showPageTitles');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_PAGE, 'options.paginationType', 'Display as:', 'edt_UI_property_options_paginationType');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_SOCIAL, 'options.showCount', 'Show count:', 'edt_UI_property_options_showCount');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.useCustomLink', 'Use custom link:', 'edt_UI_property_configuration_useCustomLink');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.allowedPlatforms', 'Display:', 'edt_UI_property_configuration_allowedPlatforms');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_SOCIAL, 'configuration.alignment', 'Alignment:', 'edt_UI_property_configuration_alignment');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_MAP, 'configuration.initialZoom', 'Zoom level:', 'edt_UI_property_configuration_initialZoom');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_MAP, 'configuration.apiKey', 'Google Maps API Key:', 'edt_UI_property_configuration_mapsApiKey');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_MAP, 'configuration.isInteractive', 'Interactive:', 'edt_UI_property_configuration_isInteractive');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_CAPTCHA, 'configuration.type', 'Type:', 'edt_UI_property_configuration_type');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.disableSubmitButtonAfterClick', 'Disable after click:', 'edt_UI_property_configuration_disableSubmitButtonAfterClick');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.hasSubmitButtonIcon', 'Show icon:', 'edt_UI_property_configuration_hasSubmitButtonIcon');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.buttonsPosition', 'Alignment:', 'edt_UI_property_configuration_buttonsPosition');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ACTION_BAR, 'configuration.configurableButtons', 'Additional buttons:', 'edt_UI_property_configuration_configurableButtons');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'synchronize.enabled', 'Match another field value:', 'edt_UI_property_synchronize_enabled');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_PASSWORD,
    ElementTypes.CONTROL_TYPE_WEBSITE,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'synchronize.withControlId', 'Match with:', 'edt_UI_property_synchronize_withControlId');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([ElementTypes.CONTROL_TYPE_CHECKBOX, ElementTypes.CONTROL_TYPE_DROPDOWN, ElementTypes.CONTROL_TYPE_RADIO], 'options.isNumberOfTimesAnOptionCanBeChosen', 'Limit choices', 'edt_UI_property_options_isNumberOfTimesAnOptionCanBeChosen');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_TEXTAREA, 'size.heightInRows', 'Input height in rows:', 'edt_UI_property_size_heightInRows');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.isLimitSubmissionsEnabled', 'Limit submissions total value:', 'edt_UI_property_configuration_isLimitSubmissionsEnabled');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.currentSubmissionsValue', 'Current total value:', 'edt_UI_property_configuration_currentSubmissionsValue');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA,
], 'configuration.limitSubmissionsTotal', 'Max total value:', 'edt_UI_property_number_configuration_limitSubmissionsTotal');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(null, 'options.hipaaField', 'HIPAA protected field', 'ajax_editFieldHipaa');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_STAR_RATING,
    ElementTypes.CONTROL_TYPE_TERMS_OF_SERVICE,
    ElementTypes.CONTROL_TYPE_RADIO,
    ElementTypes.CONTROL_TYPE_CHECKBOX,
    ElementTypes.CONTROL_TYPE_DROPDOWN,
    ElementTypes.CONTROL_TYPE_PRICE
], 'payments.virtualValue', 'Value / Price:', 'edt_UI_property_payments_value');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_MAP,
], 'propagate.enabled', 'Send coordinates to a field:', 'edt_UI_property_propagate_checkbox');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_MAP,
], 'propagate.onControlId', 'To field:', 'edt_UI_property_propagate_to_field');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_MAP,
], 'synchronize.enabled', 'Match with address field:', 'edt_UI_property_synchronize_checkbox');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_MAP,
], 'synchronize.withControlId', 'Field:', 'edt_UI_property_synchronize_with_field');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_EMAIL,
    ElementTypes.CONTROL_TYPE_WEBSITE
], 'options.displaySuggestions', 'Display suggestions:', 'edt_display_suggestions_text');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_TEXT
], 'configuration.defaultValueIsUniqueId', 'Unique ID');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_REPEATABLE, 'configuration.maxNumberOfGroupsAllowed', 'Max no. of rows allowed', 'edt_UI_property_max_number_of_rows_allowed');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_REPEATABLE, 'configuration.showBorders', 'Show borders', 'edt_UI_property_show_borders');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTAINER_TYPE_REPEATABLE, 'configuration.addButtonText', 'Add button text', 'edt_UI_property_add_button_text');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DROPDOWN, 'choices.isWorkflowsUserDropdown', 'Show users list', 'edt_workflows_users_list');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_ADDRESS, 'configuration.postalCodeLabel', 'Postal/Zip label:', 'edt_UI_property_configuration_postalCodeLabel');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_DROPDOWN, 'choices.isDropdownWithForms', 'Search within selected forms', 'hilti_importFormFieldCheckboxTitle');
ElementHardcodedPropertyLabel.addHardcodedPropertyName(ElementTypes.CONTROL_TYPE_FEE, 'payments.value', 'Price', 'XYZ');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], 'options.displayPrefix', 'Add prefix inside the field:', 'edt_UI_property_add_prefix');
ElementHardcodedPropertyLabel.addHardcodedPropertyName([
    ElementTypes.CONTROL_TYPE_TEXT,
    ElementTypes.CONTROL_TYPE_NUMBER,
    ElementTypes.CONTROL_TYPE_FORMULA
], 'configuration.prefix', 'Prefix:', 'edt_UI_property_prefix');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_ACCEPTED_DATES, 'Accepted dates', 'edt_UI_attribute_accepted_dates');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_LAYOUT_SIZE, 'Layout size', 'edt_UI_attribute_layout_size');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_DEFAULT_VALUE, 'Default value', 'edt_UI_attribute_default_value');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_AGREEMENT_TEXT, 'Agreement text', 'edt_UI_attribute_agreement_text');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_HTML_CONTENT, 'HTML Content', 'edt_UI_attribute_html_content');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_PAGE_TITLE, 'Page title', 'edt_UI_attribute_page_title');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_FACEBOOK_SHARE, 'Facebook share', 'edt_UI_attribute_facebook_share');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_DEFAULT_MAP, 'Default map', 'edt_UI_attribute_default_map');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_SUBMIT_BUTTON, 'Submit button', 'edt_UI_attribute_submit_button');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_RESET_BUTTON, 'Reset button', 'edt_UI_attribute_reset_button');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_FIELD_NAME, 'Field name', 'edt_UI_attribute_field_name');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_ALT_TEXT, 'Alt text', 'edt_UI_attribute_alt_text');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_PAYMENTS, 'Value and payments', 'edt_UI_attribute_payments');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_COUPONS, 'Coupon codes', 'edt_UI_attribute_coupons');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_CALCULATIONS, 'Formula', 'edt_UI_attribute_calculations');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_ADD_BUTTON, 'Add button', 'edt_UI_attribute_add_button');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_MAPS_API_KEY, 'Google Maps API Key', 'edt_UI_attribute_maps_api_key');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_FEE_DETAILS, 'Fee details', 'XYZ');
ElementHardcodedPropertyLabel.addHardcodedAttributeName(ElementPropertyOrder.ATTRIBUTE_FEE_PRICE, 'Price', 'XYZ');
EditorUserInterface.addPlugin(new DropDownInspectorPlugin());
EditorUserInterface.addPlugin(new InputTypeSizeInPixelsInspectorPlugin());
EditorUserInterface.addPlugin(new HTMLEditorInspectorPlugin());
EditorUserInterface.addPlugin(new CheckBoxAndRadioInputInspectorPlugin());
EditorUserInterface.addPlugin(new AcceptedDaysOfWeekInspectorPlugin());
EditorUserInterface.addPlugin(new ChoicesEditorInspectorPlugin());
EditorUserInterface.addPlugin(new CaptchaConfigurationInspectorPlugin());
EditorUserInterface.addPlugin(new TextAppearanceDropDownInspectorPlugin());
EditorUserInterface.addPlugin(new LikertStatementsEditorInspectorPlugin());
EditorUserInterface.addPlugin(new InputTypeNumberInspectorPlugin());
EditorUserInterface.addPlugin(new ImageUploaderInspectorPlugin());
EditorUserInterface.addPlugin(new PropagatedDOMAttributes());
EditorUserInterface.addPlugin(new DateEditorInspectorPlugin());
EditorUserInterface.addPlugin(new RangedPropertiesDeferredSliderAppearance());
EditorUserInterface.addPlugin(new PaymentsProductsPlugin());
EditorUserInterface.addPlugin(new CouponCodesInspectorPlugin());
EditorUserInterface.addPlugin(new FormulaInspectorPlugin());
EditorUserInterface.addPlugin(new MarkdownEditorInspectorPlugin());
EditorUserInterface.addPlugin(new SquareStoreLocationInspectorPlugin());
EditorUserInterface.addPlugin(new SquareStoreLocationsPopupInspectorPlugin());
EditorUserInterface.addPlugin(new PaymentProcessorsInspectorPlugin());
EditorUserInterface.addPlugin(new PaymentProcessorsAssocsInspectorPlugin());
EditorUserInterface.addPlugin(new SagepayCustomerEmailInspectorPlugin());
EditorUserInterface.addPlugin(new WorkflowEditUsersListInspectorPlugin());
EditorUserInterface.addPlugin(new DropdownsEditFormsListInspectorPlugin());
EditorUserInterface.addPlugin(new LikertQuizOptionsInspectorPlugin());
EditorUserInterface.addPlugin(new PriceEditorInspectorPlugin());
EditorUserInterface.addPlugin(new DiscountAndTaxOnTotalInspectorPlugin());
EditorUserInterface.addPlugin(new ListEditorPlugin());
EditorUserInterface.addPlugin(new PaymentsStringReadOnlyPlugin());
Object.defineProperty(window, 'EDITOR_V2', {
    get: function () {
        return true;
    },
    set: function (v) {
    },
    enumerable: false,
    configurable: false,
});
var EDatasetProviderType;
(function (EDatasetProviderType) {
    EDatasetProviderType[EDatasetProviderType["DEGREES_OF_AGREEMENT"] = 0] = "DEGREES_OF_AGREEMENT";
    EDatasetProviderType[EDatasetProviderType["DEGREES_OF_IMPORTANCE"] = 1] = "DEGREES_OF_IMPORTANCE";
    EDatasetProviderType[EDatasetProviderType["DEGREES_OF_PROBABILITY"] = 2] = "DEGREES_OF_PROBABILITY";
    EDatasetProviderType[EDatasetProviderType["DEGREES_OF_SATISFACTION"] = 3] = "DEGREES_OF_SATISFACTION";
    EDatasetProviderType[EDatasetProviderType["DEGREES_OF_QUALITY"] = 4] = "DEGREES_OF_QUALITY";
    EDatasetProviderType[EDatasetProviderType["DAYS_OF_WEEK"] = 5] = "DAYS_OF_WEEK";
    EDatasetProviderType[EDatasetProviderType["MONTHS_OF_YEAR"] = 6] = "MONTHS_OF_YEAR";
})(EDatasetProviderType || (EDatasetProviderType = {}));
var DatasetProvider = (function () {
    function DatasetProvider() {
        this.providers = [];
        this.providers.push(new DegreesOfAgreementDataset());
        this.providers.push(new DegreesOfImportanceDataset());
        this.providers.push(new DegreesOfProbabilityDataset());
        this.providers.push(new DegreesOfSatisfactionDataset());
        this.providers.push(new DegreesOfQualityDataset());
        this.providers.push(new DaysOfWeekDataset());
        this.providers.push(new MonthsOfTheYearDataset());
    }
    DatasetProvider.prototype.getDatasetByType = function (datasetType) {
        return this.providers[datasetType] || null;
    };
    return DatasetProvider;
}());
var GenericI18nDataset = (function () {
    function GenericI18nDataset() {
    }
    GenericI18nDataset.prototype.getValues = function () {
        return this.values;
    };
    GenericI18nDataset.prototype.getTranslationForText = function (userText) {
        for (var values = this.getValues() || [], i = 0, len = values.length; i < len; i++) {
            if (values[i].text === userText) {
                return values[i].i18n || null;
            }
        }
        return null;
    };
    return GenericI18nDataset;
}());
var BlankDataset = (function (_super) {
    __extends(BlankDataset, _super);
    function BlankDataset() {
        var _this = _super.call(this) || this;
        _this.values = [];
        return _this;
    }
    BlankDataset.prototype.getName = function () {
        return this.datasetName;
    };
    BlankDataset.prototype.withName = function (name) {
        this.datasetName = name;
        return this;
    };
    BlankDataset.prototype.getValues = function () {
        return this.values;
    };
    BlankDataset.prototype.withValue = function (value) {
        this.values.push(value);
        return this;
    };
    return BlankDataset;
}(GenericI18nDataset));
var DegreesOfAgreementDataset = (function (_super) {
    __extends(DegreesOfAgreementDataset, _super);
    function DegreesOfAgreementDataset() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.values = [
            {
                text: "Strongly Agree",
                i18n: 'edt_UI_dataset_strongly_agree',
            },
            {
                text: "Agree",
                i18n: 'edt_UI_dataset_agree',
            },
            {
                text: "Neutral",
                i18n: 'edt_UI_dataset_neutral',
            },
            {
                text: "Disagree",
                i18n: 'edt_UI_dataset_disagree',
            },
            {
                text: "Strongly Disagree",
                i18n: 'edt_UI_dataset_strongly_disagree',
            },
        ];
        return _this;
    }
    DegreesOfAgreementDataset.prototype.getName = function () {
        return {
            text: 'Degrees of Agreement',
            i18n: 'edt_UI_dataset_degrees_of_agreement',
        };
    };
    return DegreesOfAgreementDataset;
}(GenericI18nDataset));
var DegreesOfImportanceDataset = (function (_super) {
    __extends(DegreesOfImportanceDataset, _super);
    function DegreesOfImportanceDataset() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.values = [
            {
                text: "Very Important",
                i18n: "edt_UI_dataset_very_important",
            },
            {
                text: "Important",
                i18n: "edt_UI_dataset_important",
            },
            {
                text: "Neutral",
                i18n: "edt_UI_dataset_neutral",
            },
            {
                text: "Somewhat Important",
                i18n: "edt_UI_dataset_somewhat_important",
            },
            {
                text: "Not Important",
                i18n: "edt_UI_dataset_not_important",
            },
        ];
        return _this;
    }
    DegreesOfImportanceDataset.prototype.getName = function () {
        return {
            text: "Degrees of Importance",
            i18n: "edt_UI_dataset_degrees_of_importance",
        };
    };
    return DegreesOfImportanceDataset;
}(GenericI18nDataset));
var DegreesOfProbabilityDataset = (function (_super) {
    __extends(DegreesOfProbabilityDataset, _super);
    function DegreesOfProbabilityDataset() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.values = [
            {
                text: "Definitely",
                i18n: "edt_UI_dataset_definitely",
            },
            {
                text: "Probably",
                i18n: "edt_UI_dataset_probably",
            },
            {
                text: "Not Sure",
                i18n: "edt_UI_dataset_not_sure",
            },
            {
                text: "Probably Not",
                i18n: "edt_UI_dataset_probably_not",
            },
            {
                text: "Definitely Not",
                i18n: "edt_UI_dataset_definitely_not",
            },
        ];
        return _this;
    }
    DegreesOfProbabilityDataset.prototype.getName = function () {
        return {
            text: "Degrees of Probability",
            i18n: "edt_UI_dataset_degrees_of_probability",
        };
    };
    return DegreesOfProbabilityDataset;
}(GenericI18nDataset));
var DegreesOfSatisfactionDataset = (function (_super) {
    __extends(DegreesOfSatisfactionDataset, _super);
    function DegreesOfSatisfactionDataset() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.values = [
            {
                text: "Very Satisfied",
                i18n: "edt_UI_dataset_very_satisfied",
            },
            {
                text: "Satisfied",
                i18n: "edt_UI_dataset_satisfied",
            },
            {
                text: "Neutral",
                i18n: "edt_UI_dataset_neutral",
            },
            {
                text: "Unsatisfied",
                i18n: "edt_UI_dataset_unsatisfied",
            },
            {
                text: "Very Unsatisfied",
                i18n: "edt_UI_dataset_very_unsatisfied",
            },
        ];
        return _this;
    }
    DegreesOfSatisfactionDataset.prototype.getName = function () {
        return {
            text: "Degrees Of Satisfaction",
            i18n: "edt_UI_dataset_degrees_of_satisfaction",
        };
    };
    return DegreesOfSatisfactionDataset;
}(GenericI18nDataset));
var DegreesOfQualityDataset = (function (_super) {
    __extends(DegreesOfQualityDataset, _super);
    function DegreesOfQualityDataset() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.values = [
            {
                text: "Very Good",
                i18n: "edt_UI_dataset_very_good",
            },
            {
                text: "Good",
                i18n: "edt_UI_dataset_good",
            },
            {
                text: "Fair",
                i18n: "edt_UI_dataset_fair",
            },
            {
                text: "Poor",
                i18n: "edt_UI_dataset_poor",
            },
            {
                text: "Very Poor",
                i18n: "edt_UI_dataset_very_poor",
            },
        ];
        return _this;
    }
    DegreesOfQualityDataset.prototype.getName = function () {
        return {
            text: "Degrees of Quality",
            i18n: "edt_UI_dataset_degrees_of_quality",
        };
    };
    return DegreesOfQualityDataset;
}(GenericI18nDataset));
var DaysOfWeekDataset = (function (_super) {
    __extends(DaysOfWeekDataset, _super);
    function DaysOfWeekDataset() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.values = [
            {
                text: "Monday",
                i18n: "edt_text_monday",
            },
            {
                text: "Tuesday",
                i18n: "edt_text_tuesday",
            },
            {
                text: "Wednesday",
                i18n: "edt_text_wednesday",
            },
            {
                text: "Thursday",
                i18n: "edt_text_thursday",
            },
            {
                text: "Friday",
                i18n: "edt_text_friday",
            },
            {
                text: "Saturday",
                i18n: "edt_text_saturday",
            },
            {
                text: "Sunday",
                i18n: "edt_text_sunday",
            },
        ];
        return _this;
    }
    DaysOfWeekDataset.prototype.getName = function () {
        return {
            text: "Days of the Week",
            i18n: "edt_UI_dataset_days_of_week",
        };
    };
    return DaysOfWeekDataset;
}(GenericI18nDataset));
var MonthsOfTheYearDataset = (function (_super) {
    __extends(MonthsOfTheYearDataset, _super);
    function MonthsOfTheYearDataset() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.values = [
            {
                text: "January",
                i18n: "edt_UI_dataset_january",
            },
            {
                text: "February",
                i18n: "edt_UI_dataset_february",
            },
            {
                text: "March",
                i18n: "edt_UI_dataset_march",
            },
            {
                text: "April",
                i18n: "edt_UI_dataset_april",
            },
            {
                text: "May",
                i18n: "edt_UI_dataset_may",
            },
            {
                text: "June",
                i18n: "edt_UI_dataset_june",
            },
            {
                text: "July",
                i18n: "edt_UI_dataset_july",
            },
            {
                text: "August",
                i18n: "edt_UI_dataset_august",
            },
            {
                text: "September",
                i18n: "edt_UI_dataset_september",
            },
            {
                text: "October",
                i18n: "edt_UI_dataset_october",
            },
            {
                text: "November",
                i18n: "edt_UI_dataset_november",
            },
            {
                text: "December",
                i18n: "edt_UI_dataset_december",
            },
        ];
        return _this;
    }
    MonthsOfTheYearDataset.prototype.getName = function () {
        return {
            text: "Months of the Year",
            i18n: 'edt_UI_dataset_months_of_year',
        };
    };
    return MonthsOfTheYearDataset;
}(GenericI18nDataset));
var EditorOAuthFlow = (function (_super) {
    __extends(EditorOAuthFlow, _super);
    function EditorOAuthFlow(loader) {
        var _this = _super.call(this) || this;
        _this.loader = loader;
        return _this;
    }
    EditorOAuthFlow.prototype.connect = function (settingTypeId) {
        if (!settingTypeId) {
            return;
        }
        var formId = this.loader.getEngine().getDocument().getId(), params = 'formId=' + formId + '&settingTypeId=' + settingTypeId, url = location.hostname + '/modules/GenericOAuthFlow/index.php', protocol = location.protocol, oAuthWindow = open(encodeURI(protocol + '//' + url + '?' + params), 'newEditorOAuthWindow');
        this.oAuthReturnInterval = setInterval(function () {
            oAuthWindow.postMessage('123fb-finishOAuthFlow', '*');
        }, 500);
        this.oAuthTimeout = setTimeout(this.clearIntervals, 15 * 60 * 1000);
    };
    EditorOAuthFlow.prototype.clearIntervals = function () {
        clearInterval(this.oAuthReturnInterval);
        clearTimeout(this.oAuthTimeout);
    };
    EditorOAuthFlow.prototype.connectCallback = function (settingTypeId, settingData) {
        this.loader.getEngine().getDocument().oAuthApplicationSaveData(settingTypeId, settingData);
        this.clearIntervals();
    };
    EditorOAuthFlow.prototype.disconnect = function (settingTypeId) {
        this.loader.getEngine().getDocument().oAuthApplicationDisconnect(settingTypeId);
    };
    return EditorOAuthFlow;
}(EventEmitter));
